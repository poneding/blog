<!doctype html><html lang=cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='ğŸ  é¦–é¡µ / AWS / EKSé…ç½® ALB Ingress
EKSé…ç½® ALB Ingress # å®˜æ–¹æ–‡æ¡£ï¼š https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/controller/installation/
éƒ¨ç½²Alb Ingress Controller # IAMä¸­åˆ›å»ºPolicyï¼Œç»™é›†ç¾¤çš„NodeèŠ‚ç‚¹çš„Roleæ·»åŠ è¯¥Policyã€‚
Policyçš„JSONé…ç½®å¦‚ä¸‹ï¼š
{ "Version": "2012-10-17", "Statement": [ { "Effect": "Allow", "Action": [ "acm:DescribeCertificate", "acm:ListCertificates", "acm:GetCertificate" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "ec2:AuthorizeSecurityGroupIngress", "ec2:CreateSecurityGroup", "ec2:CreateTags", "ec2:DeleteTags", "ec2:DeleteSecurityGroup", "ec2:DescribeAccountAttributes", "ec2:DescribeAddresses", "ec2:DescribeInstances", "ec2:DescribeInstanceStatus", "ec2:DescribeInternetGateways", "ec2:DescribeNetworkInterfaces", "ec2:DescribeSecurityGroups", "ec2:DescribeSubnets", "ec2:DescribeTags", "ec2:DescribeVpcs", "ec2:ModifyInstanceAttribute", "ec2:ModifyNetworkInterfaceAttribute", "ec2:RevokeSecurityGroupIngress" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "elasticloadbalancing:AddListenerCertificates", "elasticloadbalancing:AddTags", "elasticloadbalancing:CreateListener", "elasticloadbalancing:CreateLoadBalancer", "elasticloadbalancing:CreateRule", "elasticloadbalancing:CreateTargetGroup", "elasticloadbalancing:DeleteListener", "elasticloadbalancing:DeleteLoadBalancer", "elasticloadbalancing:DeleteRule", "elasticloadbalancing:DeleteTargetGroup", "elasticloadbalancing:DeregisterTargets", "elasticloadbalancing:DescribeListenerCertificates", "elasticloadbalancing:DescribeListeners", "elasticloadbalancing:DescribeLoadBalancers", "elasticloadbalancing:DescribeLoadBalancerAttributes", "elasticloadbalancing:DescribeRules", "elasticloadbalancing:DescribeSSLPolicies", "elasticloadbalancing:DescribeTags", "elasticloadbalancing:DescribeTargetGroups", "elasticloadbalancing:DescribeTargetGroupAttributes", "elasticloadbalancing:DescribeTargetHealth", "elasticloadbalancing:ModifyListener", "elasticloadbalancing:ModifyLoadBalancerAttributes", "elasticloadbalancing:ModifyRule", "elasticloadbalancing:ModifyTargetGroup", "elasticloadbalancing:ModifyTargetGroupAttributes", "elasticloadbalancing:RegisterTargets", "elasticloadbalancing:RemoveListenerCertificates", "elasticloadbalancing:RemoveTags", "elasticloadbalancing:SetIpAddressType", "elasticloadbalancing:SetSecurityGroups", "elasticloadbalancing:SetSubnets", "elasticloadbalancing:SetWebACL" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "iam:CreateServiceLinkedRole", "iam:GetServerCertificate", "iam:ListServerCertificates" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "cognito-idp:DescribeUserPoolClient" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "waf-regional:GetWebACLForResource", "waf-regional:GetWebACL", "waf-regional:AssociateWebACL", "waf-regional:DisassociateWebACL" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "tag:GetResources", "tag:TagResources" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "waf:GetWebACL" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "shield:DescribeProtection", "shield:GetSubscriptionState", "shield:DeleteProtection", "shield:CreateProtection", "shield:DescribeSubscription", "shield:ListProtections" ], "Resource": "*" } ] } ä¸‹è½½alb-ingress-controller.'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://blog.poneding.com/aws/eks-config-alb-ingress/"><meta property="og:site_name" content="ç§‹æ²³è½å¶"><meta property="og:title" content="ç§‹æ²³è½å¶"><meta property="og:description" content='ğŸ  é¦–é¡µ / AWS / EKSé…ç½® ALB Ingress
EKSé…ç½® ALB Ingress # å®˜æ–¹æ–‡æ¡£ï¼š https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/controller/installation/
éƒ¨ç½²Alb Ingress Controller # IAMä¸­åˆ›å»ºPolicyï¼Œç»™é›†ç¾¤çš„NodeèŠ‚ç‚¹çš„Roleæ·»åŠ è¯¥Policyã€‚
Policyçš„JSONé…ç½®å¦‚ä¸‹ï¼š
{ "Version": "2012-10-17", "Statement": [ { "Effect": "Allow", "Action": [ "acm:DescribeCertificate", "acm:ListCertificates", "acm:GetCertificate" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "ec2:AuthorizeSecurityGroupIngress", "ec2:CreateSecurityGroup", "ec2:CreateTags", "ec2:DeleteTags", "ec2:DeleteSecurityGroup", "ec2:DescribeAccountAttributes", "ec2:DescribeAddresses", "ec2:DescribeInstances", "ec2:DescribeInstanceStatus", "ec2:DescribeInternetGateways", "ec2:DescribeNetworkInterfaces", "ec2:DescribeSecurityGroups", "ec2:DescribeSubnets", "ec2:DescribeTags", "ec2:DescribeVpcs", "ec2:ModifyInstanceAttribute", "ec2:ModifyNetworkInterfaceAttribute", "ec2:RevokeSecurityGroupIngress" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "elasticloadbalancing:AddListenerCertificates", "elasticloadbalancing:AddTags", "elasticloadbalancing:CreateListener", "elasticloadbalancing:CreateLoadBalancer", "elasticloadbalancing:CreateRule", "elasticloadbalancing:CreateTargetGroup", "elasticloadbalancing:DeleteListener", "elasticloadbalancing:DeleteLoadBalancer", "elasticloadbalancing:DeleteRule", "elasticloadbalancing:DeleteTargetGroup", "elasticloadbalancing:DeregisterTargets", "elasticloadbalancing:DescribeListenerCertificates", "elasticloadbalancing:DescribeListeners", "elasticloadbalancing:DescribeLoadBalancers", "elasticloadbalancing:DescribeLoadBalancerAttributes", "elasticloadbalancing:DescribeRules", "elasticloadbalancing:DescribeSSLPolicies", "elasticloadbalancing:DescribeTags", "elasticloadbalancing:DescribeTargetGroups", "elasticloadbalancing:DescribeTargetGroupAttributes", "elasticloadbalancing:DescribeTargetHealth", "elasticloadbalancing:ModifyListener", "elasticloadbalancing:ModifyLoadBalancerAttributes", "elasticloadbalancing:ModifyRule", "elasticloadbalancing:ModifyTargetGroup", "elasticloadbalancing:ModifyTargetGroupAttributes", "elasticloadbalancing:RegisterTargets", "elasticloadbalancing:RemoveListenerCertificates", "elasticloadbalancing:RemoveTags", "elasticloadbalancing:SetIpAddressType", "elasticloadbalancing:SetSecurityGroups", "elasticloadbalancing:SetSubnets", "elasticloadbalancing:SetWebACL" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "iam:CreateServiceLinkedRole", "iam:GetServerCertificate", "iam:ListServerCertificates" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "cognito-idp:DescribeUserPoolClient" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "waf-regional:GetWebACLForResource", "waf-regional:GetWebACL", "waf-regional:AssociateWebACL", "waf-regional:DisassociateWebACL" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "tag:GetResources", "tag:TagResources" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "waf:GetWebACL" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "shield:DescribeProtection", "shield:GetSubscriptionState", "shield:DeleteProtection", "shield:CreateProtection", "shield:DescribeSubscription", "shield:ListProtections" ], "Resource": "*" } ] } ä¸‹è½½alb-ingress-controller.'><meta property="og:locale" content="cn"><meta property="og:type" content="article"><meta property="article:section" content="aws"><meta property="article:modified_time" content="2024-06-13T15:37:18+08:00"><title>Eks Config Alb Ingress | ç§‹æ²³è½å¶</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/logo.png><link rel=canonical href=https://blog.poneding.com/aws/eks-config-alb-ingress/><link rel=stylesheet href=/book.min.4964903a822a7acb10dac6d1ab524833c97fb5f99b141976bcb8a47d539be9c0.css integrity="sha256-SWSQOoIqessQ2sbRq1JIM8l/tfmbFBl2vLikfVOb6cA=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/cn.search.min.9f81da9c77c2929029bc20be852764afac9bcc2703fe066d14074aa7904f6988.js integrity="sha256-n4HanHfCkpApvCC+hSdkr6ybzCcD/gZtFAdKp5BPaYg=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><link rel=stylesheet href=/css/syntax.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>ç§‹æ²³è½å¶</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=æœç´¢ aria-label=æœç´¢ maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><p>ğŸ¦‰ é›†ä¸­èµ·æ¥çš„æ„å¿—å¯ä»¥å‡»ç©¿é¡½çŸ³ã€‚</p><hr><ul><li><p><a href=/><strong>ğŸ  é¦–é¡µ</strong></a></p></li><li><p><strong>ğŸ“Œ ç½®é¡¶æ–‡ç« </strong></p><ul><li><a href=/git/common-usage/>Git å¸¸ç”¨</a></li><li><a href=/kubernetes/kubeadm-install-k8s-docker/>å®‰è£… Kubernetes (Docker)</a></li></ul></li><li><p><strong>ğŸ“Œ ç½®é¡¶åˆ†ç±»</strong></p><ul><li><a href=/go/>Golang ç¼–ç¨‹</a></li><li><a href=/kubernetes/>Kubernetes</a></li><li><a href=/rust/>Rust ç¼–ç¨‹</a></li><li><a href=/git/>Git</a></li></ul></li></ul><hr><ul><li><strong>ğŸ—ƒï¸ å¼€æºé¡¹ç›®</strong><ul><li><a href=https://github.com/ketches/registry-proxy>registry-proxy</a></li><li><a href=https://github.com/poneding/mdi>mdi</a></li></ul></li></ul><hr><ul><li><a href=https://github.com/poneding target=_blank rel=noopener>ğŸ™ GitHub</a></li><li><a href=mailto:poneding@gmail.com target=_blank rel=noopener>ğŸ“¬ é‚®ç®±</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Eks Config Alb Ingress</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#éƒ¨ç½²alb-ingress-controller>éƒ¨ç½²Alb Ingress Controller</a></li><li><a href=#é…ç½®alb-ingress-controller>é…ç½®Alb Ingress Controller</a></li><li><a href=#è®¾ç½®external-dns>è®¾ç½®External DNS</a><ul><li><a href=#èƒŒæ™¯>èƒŒæ™¯</a></li><li><a href=#å‰ææ¡ä»¶>å‰ææ¡ä»¶</a></li><li><a href=#å®‰è£…>å®‰è£…</a></li><li><a href=#ä½¿ç”¨æ–¹å¼>ä½¿ç”¨æ–¹å¼</a></li></ul></li><li><a href=#å®è·µè®°å½•>å®è·µè®°å½•</a></li></ul></nav></aside></header><article class="markdown book-article"><p><a href=/>ğŸ  é¦–é¡µ</a> /
<a href=/aws/>AWS</a> / EKSé…ç½® ALB Ingress</p><h1 id=eksé…ç½®-alb-ingress>EKSé…ç½® ALB Ingress
<a class=anchor href=#eks%e9%85%8d%e7%bd%ae-alb-ingress>#</a></h1><p>å®˜æ–¹æ–‡æ¡£ï¼š
<a href=https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/controller/installation/>https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/controller/installation/</a></p><h2 id=éƒ¨ç½²alb-ingress-controller>éƒ¨ç½²Alb Ingress Controller
<a class=anchor href=#%e9%83%a8%e7%bd%b2alb-ingress-controller>#</a></h2><p>IAMä¸­åˆ›å»ºPolicyï¼Œç»™é›†ç¾¤çš„NodeèŠ‚ç‚¹çš„Roleæ·»åŠ è¯¥Policyã€‚</p><p>Policyçš„JSONé…ç½®å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Version&#34;</span><span class=p>:</span> <span class=s2>&#34;2012-10-17&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Statement&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;acm:DescribeCertificate&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;acm:ListCertificates&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;acm:GetCertificate&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:AuthorizeSecurityGroupIngress&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:CreateSecurityGroup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:CreateTags&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:DeleteTags&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:DeleteSecurityGroup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:DescribeAccountAttributes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:DescribeAddresses&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:DescribeInstances&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:DescribeInstanceStatus&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:DescribeInternetGateways&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:DescribeNetworkInterfaces&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:DescribeSecurityGroups&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:DescribeSubnets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:DescribeTags&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:DescribeVpcs&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:ModifyInstanceAttribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:ModifyNetworkInterfaceAttribute&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ec2:RevokeSecurityGroupIngress&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:AddListenerCertificates&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:AddTags&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:CreateListener&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:CreateLoadBalancer&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:CreateRule&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:CreateTargetGroup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DeleteListener&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DeleteLoadBalancer&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DeleteRule&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DeleteTargetGroup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DeregisterTargets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DescribeListenerCertificates&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DescribeListeners&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DescribeLoadBalancers&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DescribeLoadBalancerAttributes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DescribeRules&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DescribeSSLPolicies&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DescribeTags&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DescribeTargetGroups&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DescribeTargetGroupAttributes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:DescribeTargetHealth&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:ModifyListener&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:ModifyLoadBalancerAttributes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:ModifyRule&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:ModifyTargetGroup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:ModifyTargetGroupAttributes&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:RegisterTargets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:RemoveListenerCertificates&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:RemoveTags&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:SetIpAddressType&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:SetSecurityGroups&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:SetSubnets&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;elasticloadbalancing:SetWebACL&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;iam:CreateServiceLinkedRole&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;iam:GetServerCertificate&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;iam:ListServerCertificates&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;cognito-idp:DescribeUserPoolClient&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;waf-regional:GetWebACLForResource&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;waf-regional:GetWebACL&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;waf-regional:AssociateWebACL&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;waf-regional:DisassociateWebACL&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;tag:GetResources&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;tag:TagResources&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;waf:GetWebACL&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shield:DescribeProtection&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shield:GetSubscriptionState&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shield:DeleteProtection&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shield:CreateProtection&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shield:DescribeSubscription&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;shield:ListProtections&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ä¸‹è½½alb-ingress-controller.yaml</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.6/docs/examples/alb-ingress-controller.yaml
</span></span></code></pre></div><p>ä¿®æ”¹alb-ingress-controller.yamlï¼Œä¿®æ”¹ä»¥ä¸‹ä¸‰ä¸ªé…ç½®é¡¹</p><ul><li><p><code>--cluster-name=dev-eks</code></p></li><li><p><code>--aws-vpc-id=vpc-xxxxxx</code></p></li><li><p><code>--aws-region=us-west-1</code></p></li></ul><p>éƒ¨ç½²ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.6/docs/examples/rbac-role.yaml
</span></span><span class=line><span class=cl>kubectl apply -f alb-ingress-controller.yaml
</span></span></code></pre></div><p>éªŒè¯éƒ¨ç½²æƒ…å†µï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -n kube-system <span class=k>$(</span>kubectl get po -n kube-system <span class=p>|</span> egrep -o <span class=s2>&#34;alb-ingress[a-zA-Z0-9-]+&#34;</span><span class=k>)</span>
</span></span></code></pre></div><h2 id=é…ç½®alb-ingress-controller>é…ç½®Alb Ingress Controller
<a class=anchor href=#%e9%85%8d%e7%bd%aealb-ingress-controller>#</a></h2><h2 id=è®¾ç½®external-dns>è®¾ç½®External DNS
<a class=anchor href=#%e8%ae%be%e7%bd%aeexternal-dns>#</a></h2><p>æœ¬ç¯‡å†…å®¹æ¥æºï¼š
<a href=https://kubernetes-sigs.github.io/aws-load-balancer-controller/v1.1/guide/external-dns/setup/>https://kubernetes-sigs.github.io/aws-load-balancer-controller/v1.1/guide/external-dns/setup/</a></p><h3 id=èƒŒæ™¯>èƒŒæ™¯
<a class=anchor href=#%e8%83%8c%e6%99%af>#</a></h3><p>åœ¨AWSä¸­ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä»¥æŸä¸ªåŸŸåè®¿é—®K8sé›†ç¾¤çš„æŸä¸ªæœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»´æŠ¤Route 53ä¸­Record Setå’ŒLoadBalanceræ˜ å°„æ¥å®ç°ï¼Œè¿™æ— ç–‘ä¼šå¢åŠ ä¸€äº›æ‰‹åŠ¨æ“ä½œçš„æˆæœ¬ï¼Œæœ¬ç¯‡å³ä»‹ç»ä½¿ç”¨<strong>external-dns</strong>æ¥è‡ªåŠ¨ç»´æŠ¤å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚</p><p><strong>external-dns</strong>é¡¹ç›®åœ°å€ï¼š
<a href=https://github.com/kubernetes-incubator/external-dns>https://github.com/kubernetes-incubator/external-dns</a></p><p>external-dnsæ ¹æ®hostçš„ä¿¡æ¯æä¾›DNSè®°å½•ï¼Œå®ƒå°†å»ºç«‹å’Œç®¡ç†Route 53ä¸­Record Setä¸LoadBalancerçš„æ˜ å°„å…³ç³»ã€‚</p><h3 id=å‰ææ¡ä»¶>å‰ææ¡ä»¶
<a class=anchor href=#%e5%89%8d%e6%8f%90%e6%9d%a1%e4%bb%b6>#</a></h3><h4 id=è§’è‰²æƒé™>è§’è‰²æƒé™
<a class=anchor href=#%e8%a7%92%e8%89%b2%e6%9d%83%e9%99%90>#</a></h4><p>å¿…é¡»ç»™K8sé›†ç¾¤è¿è¡Œexternal-dnsçš„Nodeé…ç½®è§’è‰²å’Œç­–ç•¥ã€‚</p><p>IAMä¸­åˆ›å»ºPolicyï¼Œç»™é›†ç¾¤çš„NodeèŠ‚ç‚¹çš„Roleæ·»åŠ è¯¥Policyã€‚</p><p>Policyçš„JSONé…ç½®å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Version&#34;</span><span class=p>:</span> <span class=s2>&#34;2012-10-17&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Statement&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;route53:ChangeResourceRecordSets&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;arn:aws:route53:::hostedzone/*&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;route53:ListHostedZones&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;route53:ListResourceRecordSets&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=å®‰è£…>å®‰è£…
<a class=anchor href=#%e5%ae%89%e8%a3%85>#</a></h3><ol><li>ä¸‹è½½external-dns.yamlç¤ºä¾‹æ–‡ä»¶</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>wget https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.6/docs/examples/external-dns.yaml
</span></span></code></pre></div><ol start=2><li>ä¿®æ”¹external-dns.yamlæ–‡ä»¶ï¼Œä¸»è¦ä¿®æ”¹``&ndash;domain-filter`è¿™ä¸ªé…ç½®å†…å®¹</li></ol><ul><li><code>--domain-filter=example.com</code></li></ul><ol start=3><li>éƒ¨ç½²external-dns</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f external-dns.yaml
</span></span></code></pre></div><ol start=4><li>éªŒè¯éƒ¨ç½²æ˜¯å¦æˆåŠŸå’Œå®æ—¶è®°å½•</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -f <span class=k>$(</span>kubectl get po <span class=p>|</span> egrep -o <span class=s1>&#39;external-dns[A-Za-z0-9-]+&#39;</span><span class=k>)</span>
</span></span></code></pre></div><h3 id=ä½¿ç”¨æ–¹å¼>ä½¿ç”¨æ–¹å¼
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e6%96%b9%e5%bc%8f>#</a></h3><ol><li>ä¸ºäº†åœ¨å­åŸŸåä¸­å»ºç«‹Record Setï¼Œéœ€è¦åœ¨<code>Ingress</code>æˆ–è€…<code>Service</code>èµ„æºä¸­æ·»åŠ å¦‚ä¸‹æ³¨é‡Šï¼š</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># for creating record-set</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>external-dns.alpha.kubernetes.io/hostname</span><span class=p>:</span><span class=w> </span><span class=l>nginx.example.com</span><span class=w> </span><span class=c># give your domain name here</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>å¦‚æœæ˜¯<code>service</code>ï¼Œéœ€è¦å°†<code>type</code>è®¾ç½®æˆ<code>LoadBalancer</code></p></blockquote><ol><li>æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼Œ2åˆ†é’Ÿååœ¨Route 53ä¸­æŸ¥çœ‹è®°å½•æ˜¯å¦ç”Ÿæˆæˆ–æ›´æ–°ã€‚</li></ol><h2 id=å®è·µè®°å½•>å®è·µè®°å½•
<a class=anchor href=#%e5%ae%9e%e8%b7%b5%e8%ae%b0%e5%bd%95>#</a></h2><ul><li>Podå†…å®¹å™¨ä½¿ç”¨Secrets Managerï¼Œéœ€è¦ç»™Nodeçš„Roleæ·»åŠ ç›¸åº”çš„æƒé™ï¼›</li></ul><hr><p><a href=/aws/create-eks-cluster/>Â« åˆ›å»º EKS é›†ç¾¤</a></p><p><a href=/aws/eks-details/>Â» EKSå°ç»†èŠ‚æ±‡æ€»</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/poneding/blog/commit/5faa4f1be5d4525c49e513962394eae7c15fb6f2 title='æœ€åä¿®æ”¹è€… poneding | 2024/06/13' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt>
<span>2024/06/13</span></a></div><div><a class="flex align-center" href=https://github.com/poneding/blog/edit/master/content/aws/eks-config-alb-ingress.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>ç¼–è¾‘æœ¬é¡µ</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=poneding/blog data-repo-id=R_kgDOMITIHg data-category=General data-category-id=DIC_kwDOMITIHs4CgB4x data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#éƒ¨ç½²alb-ingress-controller>éƒ¨ç½²Alb Ingress Controller</a></li><li><a href=#é…ç½®alb-ingress-controller>é…ç½®Alb Ingress Controller</a></li><li><a href=#è®¾ç½®external-dns>è®¾ç½®External DNS</a><ul><li><a href=#èƒŒæ™¯>èƒŒæ™¯</a></li><li><a href=#å‰ææ¡ä»¶>å‰ææ¡ä»¶</a></li><li><a href=#å®‰è£…>å®‰è£…</a></li><li><a href=#ä½¿ç”¨æ–¹å¼>ä½¿ç”¨æ–¹å¼</a></li></ul></li><li><a href=#å®è·µè®°å½•>å®è·µè®°å½•</a></li></ul></nav></div></aside></main></body></html>