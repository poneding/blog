[ğŸ  é¦–é¡µ](../_index.md) / [Golang ç¼–ç¨‹](_index.md) / Go ç¨‹åº SOLID è®¾è®¡åŸåˆ™

# Go ç¨‹åº SOLID è®¾è®¡åŸåˆ™

å¯é‡ç”¨è½¯ä»¶è®¾è®¡çš„äº”ä¸ªåŸåˆ™ï¼Œ**SOLID** åŸåˆ™ï¼š

- å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼‰
- å¼€æ”¾ / å°é—­åŸåˆ™ï¼ˆOpen / Closed Principleï¼‰
- é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰
- æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰
- ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principleï¼‰

## å•ä¸€èŒè´£åŸåˆ™

SOLID çš„ç¬¬ä¸€ä¸ªåŸåˆ™ï¼ŒSï¼Œæ˜¯å•ä¸€è´£ä»»åŸåˆ™ã€‚

> A class should have one, and only one, reason to change. `â€“ Robert C Martin`

ç°åœ¨ Go æ˜¾ç„¶æ²¡æœ‰ classses - ç›¸åï¼Œæˆ‘ä»¬æœ‰æ›´å¼ºå¤§çš„ç»„åˆæ¦‚å¿µ - ä½†æ˜¯å¦‚æœä½ èƒ½å›é¡¾ä¸€ä¸‹ class è¿™ä¸ªè¯çš„ç”¨æ³•ï¼Œæˆ‘è®¤ä¸ºæ­¤æ—¶ä¼šæœ‰ä¸€å®šä»·å€¼ã€‚

ä¸ºä»€ä¹ˆä¸€æ®µä»£ç åªæœ‰ä¸€ä¸ªæ”¹å˜çš„åŸå› å¾ˆé‡è¦ï¼Ÿå—¯ï¼Œå°±åƒä½ è‡ªå·±çš„ä»£ç å¯èƒ½ä¼šæ”¹å˜ä¸€æ ·ä»¤äººæ²®ä¸§ï¼Œå‘ç°æ‚¨çš„ä»£ç æ‰€ä¾èµ–çš„ä»£ç åœ¨æ‚¨è„šä¸‹å‘ç”Ÿå˜åŒ–æ›´ç—›è‹¦ã€‚å½“ä½ çš„ä»£ç å¿…é¡»æ”¹å˜æ—¶ï¼Œå®ƒåº”è¯¥å“åº”ç›´æ¥åˆºæ¿€ä½œå‡ºæ”¹å˜ï¼Œè€Œä¸åº”è¯¥æˆä¸ºé™„å¸¦æŸå®³çš„å—å®³è€…ã€‚

å› æ­¤ï¼Œå…·æœ‰å•ä¸€è´£ä»»çš„ä»£ç ä¿®æ”¹çš„åŸå› æœ€å°‘ã€‚

### è€¦åˆå’Œå†…èš

æè¿°æ”¹å˜ä¸€ä¸ªè½¯ä»¶æ˜¯å¤šä¹ˆå®¹æ˜“æˆ–å›°éš¾çš„ä¸¤ä¸ªè¯æ˜¯ï¼šè€¦åˆå’Œå†…èšã€‚

- è€¦åˆåªæ˜¯ä¸€ä¸ªè¯ï¼Œæè¿°äº†ä¸¤ä¸ªä¸€èµ·å˜åŒ–çš„ä¸œè¥¿ â€”â€” ä¸€ä¸ªè¿åŠ¨è¯±å¯¼å¦ä¸€ä¸ªè¿åŠ¨ã€‚
- ä¸€ä¸ªç›¸å…³ä½†ç‹¬ç«‹çš„æ¦‚å¿µæ˜¯å†…èšï¼Œä¸€ç§ç›¸äº’å¸å¼•çš„åŠ›é‡ã€‚

åœ¨è½¯ä»¶ä¸Šä¸‹æ–‡ä¸­ï¼Œå†…èšæ˜¯æè¿°ä»£ç ç‰‡æ®µä¹‹é—´è‡ªç„¶ç›¸äº’å¸å¼•çš„ç‰¹æ€§ã€‚

ä¸ºäº†æè¿° Go ç¨‹åºä¸­è€¦åˆå’Œå†…èšçš„å•å…ƒï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå°†è°ˆè°ˆå‡½æ•°å’Œæ–¹æ³•ï¼Œè¿™åœ¨è®¨è®º SRP æ—¶å¾ˆå¸¸è§ï¼Œä½†æ˜¯æˆ‘ç›¸ä¿¡å®ƒå§‹äº Go çš„ package æ¨¡å‹ã€‚

### åº“åç§°çš„è®¾è®¡

åœ¨ Go ä¸­ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½åœ¨æŸä¸ª package ä¸­ï¼Œä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ package ä»å…¶åç§°å¼€å§‹ã€‚åŒ…çš„åç§°æ—¢æ˜¯å…¶ç”¨é€”çš„æè¿°ï¼Œä¹Ÿæ˜¯åç§°ç©ºé—´å‰ç¼€ã€‚Go æ ‡å‡†åº“ä¸­çš„ä¸€äº›ä¼˜ç§€ package ç¤ºä¾‹ï¼š

- `net/http` - æä¾› http å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯
- `os/exec` - æ‰§è¡Œå¤–éƒ¨å‘½ä»¤
- `encoding/json` - å®ç° JSON æ–‡æ¡£çš„ç¼–ç å’Œè§£ç 
    å½“ä½ åœ¨è‡ªå·±çš„å†…éƒ¨ä½¿ç”¨å¦ä¸€ä¸ª pakcage çš„ symbols æ—¶ï¼Œè¦ä½¿ç”¨ `import` å£°æ˜ï¼Œå®ƒåœ¨ä¸¤ä¸ª package ä¹‹é—´å»ºç«‹ä¸€ä¸ªæºä»£ç çº§çš„è€¦åˆã€‚ ä»–ä»¬ç°åœ¨å½¼æ­¤çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ã€‚

### ç³Ÿç³•çš„åº“åç§°

è¿™ç§å¯¹åå­—çš„å…³æ³¨å¯ä¸æ˜¯è¿‚è…ã€‚å‘½åä¸ä½³çš„ package å¦‚æœçœŸçš„æœ‰ç”¨é€”ï¼Œä¼šå¤±å»ç½—åˆ—å…¶ç”¨é€”çš„æœºä¼šã€‚

- `server package` æä¾›ä»€ä¹ˆï¼Ÿ â€¦, å—¯ï¼Œå¸Œæœ›æ˜¯æœåŠ¡ç«¯ï¼Œä½†æ˜¯å®ƒä½¿ç”¨å“ªç§åè®®ï¼Ÿ
- `private package` æä¾›ä»€ä¹ˆï¼Ÿæˆ‘ä¸åº”è¯¥çœ‹åˆ°çš„ä¸œè¥¿ï¼Ÿå®ƒåº”è¯¥æœ‰å…¬å…±ç¬¦å·å—ï¼Ÿ
- `common package`ï¼Œå’Œå®ƒçš„ä¼´å„¿ `utils` package ä¸€æ ·ï¼Œç»å¸¸è¢«å‘ç°å’Œå…¶ä»–â€™ä¼™ä¼´â€™ä¸€èµ·å‘ç°
    æˆ‘ä»¬çœ‹åˆ°æ‰€æœ‰åƒè¿™æ ·çš„åŒ…è£¹ï¼Œå°±æˆäº†å„ç§å„æ ·çš„åƒåœ¾åœºï¼Œå› ä¸ºå®ƒä»¬æœ‰è®¸å¤šè´£ä»»ï¼Œæ‰€ä»¥ç»å¸¸æ¯«æ— ç†ç”±åœ°æ”¹å˜ã€‚

### Unix è®¾è®¡ç†å¿µ

åœ¨æˆ‘çœ‹æ¥ï¼Œå¦‚æœä¸æåŠ Doug McIlroy çš„ Unix å“²å­¦ï¼Œä»»ä½•å…³äºè§£è€¦è®¾è®¡çš„è®¨è®ºéƒ½å°†æ˜¯ä¸å®Œæ•´çš„ï¼›å°è€Œé”‹åˆ©çš„å·¥å…·ç»“åˆèµ·æ¥ï¼Œè§£å†³æ›´å¤§çš„ä»»åŠ¡ï¼Œé€šå¸¸æ˜¯åŸå§‹ä½œè€…æ— æ³•æƒ³è±¡çš„ä»»åŠ¡ã€‚

æˆ‘è®¤ä¸º Go package ä½“ç°äº† Unix å“²å­¦çš„ç²¾ç¥ã€‚å®é™…ä¸Šï¼Œæ¯ä¸ª Go package æœ¬èº«å°±æ˜¯ä¸€ä¸ªå°çš„ Go ç¨‹åºï¼Œä¸€ä¸ªå•ä¸€çš„å˜æ›´å•å…ƒï¼Œå…·æœ‰å•ä¸€çš„è´£ä»»ã€‚

## å¼€æ”¾ / å°é—­åŸåˆ™

ç¬¬äºŒä¸ªåŸåˆ™ï¼Œå³ Oï¼Œæ˜¯ Bertrand Meyer çš„å¼€æ”¾ / å°é—­åŸåˆ™ï¼Œä»–åœ¨ 1988 å¹´å†™é“ï¼š

> Software entities should be open for extension, but closed for modification. `â€“ Bertrand Meyer, Object-Oriented Software Construction`

è¯¥å»ºè®®å¦‚ä½•é€‚ç”¨äº 21 å¹´åå†™çš„è¯­è¨€ï¼Ÿ

```go
package main

type A struct {
        year int
}

func (a A) Greet() { fmt.Println("Hello GolangUK", a.year) }

type B struct {
        A
}

func (b B) Greet() { fmt.Println("Welcome to GolangUK", b.year) }

func main() {
        var a A
        a.year = 2016
        var b B
        b.year = 2016
        a.Greet() // Hello GolangUK 2016
        b.Greet() // Welcome to GolangUK 2016
}
```

æˆ‘ä»¬æœ‰ä¸€ä¸ªç±»å‹ A ï¼Œæœ‰ä¸€ä¸ªå­—æ®µ year å’Œä¸€ä¸ªæ–¹æ³• Greetã€‚æˆ‘ä»¬æœ‰ç¬¬äºŒç§ç±»å‹ï¼ŒB å®ƒåµŒå…¥äº†ä¸€ä¸ª Aï¼Œå› ä¸º A åµŒå…¥ï¼Œå› æ­¤è°ƒç”¨è€…çœ‹åˆ° B çš„æ–¹æ³•è¦†ç›–äº† A çš„æ–¹æ³•ã€‚å› ä¸º A ä½œä¸ºå­—æ®µåµŒå…¥ B ï¼ŒB å¯ä»¥æä¾›è‡ªå·±çš„ Greet æ–¹æ³•ï¼Œæ©ç›–äº† A çš„ Greet æ–¹æ³•ã€‚

ä½†åµŒå…¥ä¸ä»…é€‚ç”¨äºæ–¹æ³•ï¼Œè¿˜å¯ä»¥è®¿é—®åµŒå…¥ç±»å‹çš„å­—æ®µã€‚å¦‚æ‚¨æ‰€è§ï¼Œå› ä¸º A å’Œ B éƒ½åœ¨åŒä¸€ä¸ªåŒ…ä¸­å®šä¹‰ï¼Œæ‰€ä»¥ B å¯ä»¥è®¿é—® A çš„ç§æœ‰ year å­—æ®µï¼Œå°±åƒåœ¨ B ä¸­å£°æ˜ä¸€æ ·ã€‚

å› æ­¤åµŒå…¥æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå…è®¸ Go çš„ç±»å‹å¯¹æ‰©å±•å¼€æ”¾ã€‚

```go
package main

type Cat struct {
        Name string
}

func (c Cat) Legs() int { return 4 }

func (c Cat) PrintLegs() {
        fmt.Printf("I have %d legs.", c.Legs())
}

type OctoCat struct {
        Cat
}

func (o OctoCat) Legs() int { return 5 }

func main() {
        var octo OctoCat
        fmt.Println(octo.Legs()) // 5
        octo.PrintLegs()         // I have 4 legs
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª Cat ç±»å‹ï¼Œå¯ä»¥ç”¨å®ƒçš„ Legs æ–¹æ³•è®¡ç®—å®ƒçš„è…¿æ•°ã€‚æˆ‘ä»¬å°† Cat ç±»å‹åµŒå…¥åˆ°ä¸€ä¸ªæ–°ç±»å‹ OctoCat ä¸­ï¼Œå¹¶å£°æ˜ Octocats æœ‰äº”æ¡è…¿ã€‚ä½†æ˜¯ï¼Œè™½ç„¶ OctoCat å®šä¹‰äº†è‡ªå·±çš„ Legs æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å› 5ï¼Œä½†æ˜¯å½“è°ƒç”¨ PrintLegs æ–¹æ³•æ—¶ï¼Œå®ƒè¿”å› 4ã€‚

è¿™æ˜¯å› ä¸º PrintLegs æ˜¯åœ¨ Cat ç±»å‹ä¸Šå®šä¹‰çš„ã€‚ å®ƒéœ€è¦ Cat ä½œä¸ºå®ƒçš„æ¥æ”¶å™¨ï¼Œå› æ­¤å®ƒä¼šå‘é€åˆ° Cat çš„ Legs æ–¹æ³•ã€‚Cat ä¸çŸ¥é“å®ƒåµŒå…¥çš„ç±»å‹ï¼Œå› æ­¤åµŒå…¥æ—¶ä¸èƒ½æ”¹å˜å…¶æ–¹æ³•é›†ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¯´ Go çš„ç±»å‹è™½ç„¶å¯¹æ‰©å±•å¼€æ”¾ï¼Œä½†å¯¹ä¿®æ”¹æ˜¯å°é—­çš„ã€‚

äº‹å®ä¸Šï¼ŒGo ä¸­çš„æ–¹æ³•åªä¸è¿‡æ˜¯å›´ç»•åœ¨å…·æœ‰é¢„å…ˆå£°æ˜å½¢å¼å‚æ•°ï¼ˆå³æ¥æ”¶å™¨ï¼‰çš„å‡½æ•°çš„è¯­æ³•ç³–ã€‚

```go
func (c Cat) PrintLegs() {
        fmt.Printf("I have %d legs.", c.Legs())
}

func PrintLegs(c Cat) {
        fmt.Printf("I have %d legs.", c.Legs())
}
```

æ¥æ”¶å™¨æ­£æ˜¯ä½ ä¼ å…¥å®ƒçš„å‡½æ•°ï¼Œå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸”å› ä¸º Go ä¸æ”¯æŒå‡½æ•°é‡è½½ï¼ŒOctoCat ä¸èƒ½æ›¿ä»£æ™®é€šçš„ Cat ã€‚ è¿™è®©æˆ‘æƒ³åˆ°äº†ä¸‹ä¸€ä¸ªåŸåˆ™ã€‚

## é‡Œæ°æ›¿æ¢åŸåˆ™

ç”± Barbara Liskov æå‡ºçš„é‡Œæ°æ›¿æ¢åŸåˆ™ç²—ç•¥åœ°æŒ‡å‡ºï¼Œå¦‚æœä¸¤ç§ç±»å‹è¡¨ç°å‡ºçš„è¡Œä¸ºä½¿å¾—è°ƒç”¨è€…æ— æ³•åŒºåˆ†ï¼Œåˆ™è¿™ä¸¤ç§ç±»å‹æ˜¯å¯æ›¿ä»£çš„ã€‚

åœ¨åŸºäºç±»çš„è¯­è¨€ä¸­ï¼Œé‡Œæ°æ›¿æ¢åŸåˆ™é€šå¸¸è¢«è§£é‡Šä¸ºï¼Œå…·æœ‰å„ç§å…·ä½“å­ç±»å‹çš„æŠ½è±¡åŸºç±»çš„è§„èŒƒã€‚ ä½†æ˜¯ Go æ²¡æœ‰ç±»æˆ–ç»§æ‰¿ï¼Œå› æ­¤æ— æ³•æ ¹æ®æŠ½è±¡ç±»å±‚æ¬¡ç»“æ„å®ç°æ›¿æ¢ã€‚

### Interfaces

ç›¸åï¼Œæ›¿æ¢æ˜¯ Go æ¥å£çš„èŒƒå›´ã€‚åœ¨ Go ä¸­ï¼Œç±»å‹ä¸éœ€è¦æŒ‡å®šå®ƒä»¬å®ç°ç‰¹å®šæ¥å£ï¼Œè€Œæ˜¯ä»»ä½•ç±»å‹å®ç°æ¥å£ï¼Œåªè¦å®ƒå…·æœ‰ç­¾åä¸æ¥å£å£°æ˜åŒ¹é…çš„æ–¹æ³•ã€‚

æˆ‘ä»¬è¯´åœ¨ Go ä¸­ï¼Œæ¥å£æ˜¯éšå¼åœ°è€Œä¸æ˜¯æ˜¾å¼åœ°æ»¡è¶³çš„ï¼Œè¿™å¯¹å®ƒä»¬åœ¨è¯­è¨€ä¸­çš„ä½¿ç”¨æ–¹å¼äº§ç”Ÿäº†æ·±è¿œçš„å½±å“ã€‚

è®¾è®¡è‰¯å¥½çš„æ¥å£æ›´å¯èƒ½æ˜¯å°å‹æ¥å£ï¼›æµè¡Œçš„åšæ³•æ˜¯ä¸€ä¸ªæ¥å£åªåŒ…å«ä¸€ä¸ªæ–¹æ³•ã€‚ä»é€»è¾‘ä¸Šè®²ï¼Œå°æ¥å£ä½¿å®ç°å˜å¾—ç®€å•ï¼Œåä¹‹åˆ™å¾ˆéš¾ã€‚å› æ­¤å½¢æˆäº†ç”±æ™®é€šè¡Œä¸ºçš„ç®€å•å®ç°ç»„æˆçš„ packageã€‚

### io.Reader

```go
type Reader interface {
        // Read reads up to len(buf) bytes into buf.
        Read(buf []byte) (n int, err error)
}
```

è¿™ä»¤æˆ‘å¾ˆå®¹æ˜“æƒ³åˆ°äº†æˆ‘æœ€å–œæ¬¢çš„ Go æ¥å£ `io.Reader`ã€‚

`io.Reader` æ¥å£éå¸¸ç®€å•ï¼› `Read` å°†æ•°æ®è¯»å…¥æä¾›çš„ç¼“å†²åŒºï¼Œå¹¶å°†è¯»å–çš„å­—èŠ‚æ•°å’Œè¯»å–æœŸé—´é‡åˆ°çš„ä»»ä½•é”™è¯¯è¿”å›ç»™è°ƒç”¨è€…ã€‚çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†éå¸¸å¼ºå¤§ã€‚

å› ä¸º `io.Reader` å¯ä»¥å¤„ç†ä»»ä½•è¡¨ç¤ºä¸ºå­—èŠ‚æµçš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å‡ ä¹å¯ä»¥åœ¨ä»»ä½•ä¸œè¥¿ä¸Šåˆ›å»º `Reader`; å¸¸é‡å­—ç¬¦ä¸²ï¼Œå­—èŠ‚æ•°ç»„ï¼Œæ ‡å‡†è¾“å…¥ï¼Œç½‘ç»œæµï¼Œgzip çš„ tar æ–‡ä»¶ï¼Œé€šè¿‡ ssh è¿œç¨‹æ‰§è¡Œçš„å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºã€‚

å¹¶ä¸”æ‰€æœ‰è¿™äº›å®ç°éƒ½å¯ä»¥äº’ç›¸æ›¿ä»£ï¼Œå› ä¸ºå®ƒä»¬å®ç°äº†ç›¸åŒçš„ç®€å•å¥‘çº¦ã€‚

å› æ­¤ï¼Œé€‚ç”¨äº Go çš„é‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œå¯ä»¥é€šè¿‡å·²æ•… Jim Weirich çš„æ ¼è¨€æ¥æ¦‚æ‹¬ã€‚

> Require no more, promise no less. `â€“ Jim Weirich`

## æ¥å£éš”ç¦»åŸåˆ™

ç¬¬å››ä¸ªåŸåˆ™æ˜¯æ¥å£éš”ç¦»åŸåˆ™ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š

> Clients should not be forced to depend on methods they do not use. `â€“Robert C. Martin`

åœ¨ Go ä¸­ï¼Œæ¥å£éš”ç¦»åŸåˆ™çš„åº”ç”¨å¯ä»¥æŒ‡çš„æ˜¯ï¼Œéš”ç¦»åŠŸèƒ½å®Œæˆå…¶å·¥ä½œæ‰€éœ€çš„è¡Œä¸ºçš„è¿‡ç¨‹ã€‚ä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘å·²ç»å®Œæˆäº†â€˜ç¼–å†™ä¸€ä¸ªå°† Document ç»“æ„ä¿å­˜åˆ°ç£ç›˜çš„å‡½æ•°â€™çš„ä»»åŠ¡ã€‚

```go
// Save writes the contents of doc to the file f.
func Save(f *os.File, doc *Document) error
```

æˆ‘å¯ä»¥å®šä¹‰æ­¤å‡½æ•°ï¼Œè®©æˆ‘ä»¬ç§°ä¹‹ä¸º `Save`ï¼Œå®ƒå°†ç»™å®šçš„ Document å†™å…¥åˆ° `*os.File`ã€‚ ä½†æ˜¯è¿™æ ·åšä¼šæœ‰ä¸€äº›é—®é¢˜ã€‚

Save çš„ç­¾åæ’é™¤äº†å°†æ•°æ®å†™å…¥ç½‘ç»œä½ç½®çš„é€‰é¡¹ã€‚å‡è®¾ç½‘ç»œå­˜å‚¨å¯èƒ½ä»¥åæˆä¸ºéœ€æ±‚ï¼Œæ­¤åŠŸèƒ½çš„ç­¾åå¿…é¡»æ”¹å˜ï¼Œå¹¶å½±å“å…¶æ‰€æœ‰è°ƒç”¨è€…ã€‚

ç”±äº `Save` ç›´æ¥æ“ä½œç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œå› æ­¤æµ‹è¯•èµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚è¦éªŒè¯å…¶æ“ä½œï¼Œæµ‹è¯•å¿…é¡»åœ¨å†™å…¥åè¯»å–æ–‡ä»¶çš„å†…å®¹ã€‚ æ­¤å¤–ï¼Œæµ‹è¯•å¿…é¡»ç¡®ä¿å°† `f` å†™å…¥ä¸´æ—¶ä½ç½®å¹¶éšåå°†å…¶åˆ é™¤ã€‚

`*os.File` è¿˜å®šä¹‰äº†è®¸å¤šä¸ `Save` æ— å…³çš„æ–¹æ³•ï¼Œæ¯”å¦‚è¯»å–ç›®å½•å¹¶æ£€æŸ¥è·¯å¾„æ˜¯å¦æ˜¯æ–‡ä»¶é“¾æ¥ã€‚ å¦‚æœ `Save` å‡½æ•°çš„ç­¾åèƒ½åªæè¿° `*os.File` ç›¸å…³çš„éƒ¨åˆ†ï¼Œå°†ä¼šå¾ˆå®ç”¨ã€‚

æˆ‘ä»¬å¦‚ä½•å¤„ç†è¿™äº›é—®é¢˜å‘¢ï¼Ÿ

```go
// Save writes the contents of doc to the supplied ReadWriterCloser.
func Save(rwc io.ReadWriteCloser, doc *Document) error
```

ä½¿ç”¨ `io.ReadWriteCloser` æˆ‘ä»¬å¯ä»¥åº”ç”¨æ¥å£éš”ç¦»åŸåˆ™ï¼Œä½¿ç”¨æ›´é€šç”¨çš„æ–‡ä»¶ç±»å‹çš„æ¥å£æ¥é‡æ–°å®šä¹‰ Saveã€‚

é€šè¿‡æ­¤æ›´æ”¹ï¼Œä»»ä½•å®ç°äº† `io.ReadWriteCloser` æ¥å£çš„ç±»å‹éƒ½å¯ä»¥ä»£æ›¿ä¹‹å‰çš„ `*os.File`ã€‚ä½¿å¾— `Save` åº”ç”¨ç¨‹åºæ›´å¹¿æ³›ï¼Œå¹¶å‘ `Save` è°ƒç”¨è€…é˜æ˜ï¼Œ`*os.File` ç±»å‹çš„å“ªäº›æ–¹æ³•ä¸æ“ä½œç›¸å…³ã€‚

åšä¸º Save çš„ç¼–å†™è€…ï¼Œæˆ‘ä¸å†å¯ä»¥é€‰æ‹©è°ƒç”¨ *os.File çš„é‚£äº›ä¸ç›¸å…³çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒéšè—åœ¨ `io.ReadWriteCloser` æ¥å£èƒŒåã€‚æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥é‡‡ç”¨æ¥å£éš”ç¦»åŸç†ã€‚

é¦–å…ˆï¼Œå¦‚æœ `Save` éµå¾ªå•ä¸€è´£ä»»åŸåˆ™ï¼Œå®ƒå°†ä¸å¯èƒ½è¯»å–å®ƒåˆšåˆšç¼–å†™çš„æ–‡ä»¶æ¥éªŒè¯å…¶å†…å®¹ - è¿™åº”è¯¥æ˜¯å¦ä¸€æ®µä»£ç çš„è´£ä»»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬ä¼ é€’`ç»™` Save çš„æ¥å£çš„è§„èŒƒç¼©å°ï¼Œä»…å†™å…¥å’Œå…³é—­ã€‚

```go
// Save writes the contents of doc to the supplied WriteCloser.
func Save(wc io.WriteCloser, doc *Document) error
```

å…¶æ¬¡ï¼Œé€šè¿‡å‘ `Save` æä¾›ä¸€ä¸ªå…³é—­å…¶æµçš„æœºåˆ¶ï¼Œæˆ‘ä»¬ç»§ç»­è¿™ç§æœºåˆ¶ä»¥ä½¿å…¶çœ‹èµ·æ¥åƒæ–‡ä»¶ç±»å‹çš„ä¸œè¥¿ï¼Œè¿™å°±äº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œ`wc` ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å…³é—­ã€‚`Save` å¯èƒ½ä¼šæ— æ¡ä»¶åœ°è°ƒç”¨ `Close`ï¼ŒæŠ‘æˆ–åœ¨æˆåŠŸçš„æƒ…å†µä¸‹è°ƒç”¨ `Close`ã€‚

è¿™ç»™ Save çš„è°ƒç”¨è€…å¸¦æ¥äº†é—®é¢˜ï¼Œå› ä¸ºå®ƒå¯èƒ½å¸Œæœ›åœ¨å†™å…¥æ–‡æ¡£ä¹‹åå°†å…¶ä»–æ•°æ®å†™å…¥æµã€‚

```go
type NopCloser struct {
        io.Writer
}

// Close has no effect on the underlying writer.
func (c *NopCloser) Close() error { return nil }
```

ä¸€ä¸ªç²—ç•¥çš„è§£å†³æ–¹æ¡ˆæ˜¯å®šä¹‰ä¸€ä¸ªæ–°ç±»å‹ï¼Œå®ƒåµŒå…¥ä¸€ä¸ª `io.Writer` å¹¶è¦†ç›– `Close` æ–¹æ³•ï¼Œä»¥é˜»æ­¢ `Save` æ–¹æ³•å…³é—­åº•å±‚æ•°æ®æµã€‚

ä½†è¿™æ ·å¯èƒ½ä¼šè¿åé‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œå› ä¸º NopCloser å®é™…ä¸Šå¹¶æ²¡æœ‰å…³é—­ä»»ä½•ä¸œè¥¿ã€‚

```go
// Save writes the contents of doc to the supplied Writer.
func Save(w io.Writer, doc *Document) error
```

ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯é‡æ–°å®šä¹‰ `Save` åªæ¥æ”¶ `io.Writer`ï¼Œå®Œå…¨å‰¥ç¦»å®ƒé™¤äº†å°†æ•°æ®å†™å…¥æµä¹‹å¤–åšä»»ä½•äº‹æƒ…çš„è´£ä»»ã€‚

é€šè¿‡åº”ç”¨æ¥å£éš”ç¦»åŸåˆ™ï¼Œæˆ‘ä»¬çš„ `Save` åŠŸèƒ½ï¼ŒåŒæ—¶å¾—åˆ°äº†ä¸€ä¸ªåœ¨éœ€æ±‚æ–¹é¢æœ€å…·ä½“çš„å‡½æ•° - å®ƒåªéœ€è¦ä¸€ä¸ªå¯å†™çš„å‚æ•° - å¹¶ä¸”å…·æœ‰æœ€é€šç”¨çš„åŠŸèƒ½ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Save` ä¿å­˜æˆ‘ä»¬çš„æ•°æ®åˆ°ä»»ä½•ä¸€ä¸ªå®ç° `io.Writer` çš„åœ°æ–¹ã€‚

> A great rule of thumb for Go is accept interfaces, return structs. `â€“ Jack Lindamood`

é€€ä¸€æ­¥è¯´ï¼Œè¿™å¥è¯æ˜¯ä¸€ä¸ªæœ‰è¶£çš„æ¨¡å› ï¼Œåœ¨è¿‡å»çš„å‡ å¹´é‡Œï¼Œå®ƒæ¸—é€å…¥ Go æ€æ½®ã€‚

è¿™ä¸ªæ¨ç‰¹å¤§å°çš„ç‰ˆæœ¬ç¼ºä¹ç»†èŠ‚ï¼Œè¿™ä¸æ˜¯ Jack çš„é”™ï¼Œä½†æˆ‘è®¤ä¸ºå®ƒä»£è¡¨äº†ç¬¬ä¸€ä¸ªæ­£å½“æœ‰ç†çš„ Go è®¾è®¡ä¼ ç»Ÿ

## ä¾èµ–å€’ç½®åŸåˆ™

æœ€åä¸€ä¸ª SOLID åŸåˆ™æ˜¯ä¾èµ–å€’ç½®åŸåˆ™ï¼Œè¯¥åŸåˆ™æŒ‡å‡ºï¼š

> High-level modules should not depend on low-level modules. Both should depend on abstractions. Abstractions should not depend on details. Details should depend on abstractions. `â€“ Robert C. Martin`

ä½†æ˜¯ï¼Œå¯¹äº Go ç¨‹åºå‘˜æ¥è¯´ï¼Œä¾èµ–å€’ç½®åœ¨å®è·µä¸­æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ

å¦‚æœæ‚¨å·²ç»åº”ç”¨äº†æˆ‘ä»¬ä¹‹å‰è°ˆåˆ°çš„æ‰€æœ‰åŸåˆ™ï¼Œé‚£ä¹ˆæ‚¨çš„ä»£ç åº”è¯¥å·²ç»è¢«åˆ†è§£ä¸ºç¦»æ•£åŒ…ï¼Œæ¯ä¸ªåŒ…éƒ½æœ‰ä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„è´£ä»»æˆ–ç›®çš„ã€‚æ‚¨çš„ä»£ç åº”è¯¥æ ¹æ®æ¥å£æè¿°å…¶ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”åº”è¯¥è€ƒè™‘è¿™äº›æ¥å£ä»¥ä»…æè¿°è¿™äº›å‡½æ•°æ‰€éœ€çš„è¡Œä¸ºã€‚ æ¢å¥è¯è¯´ï¼Œé™¤æ­¤ä¹‹å¤–æ²¡ä»€ä¹ˆåº”è¯¥è¦åšçš„ã€‚

æ‰€ä»¥æˆ‘è®¤ä¸ºï¼Œåœ¨ Go çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒMartin æ‰€æŒ‡çš„æ˜¯ import graph çš„ç»“æ„ã€‚

åœ¨ Go ä¸­ï¼Œimport graph å¿…é¡»æ˜¯éå¾ªç¯çš„ã€‚ ä¸éµå®ˆè¿™ç§éå¾ªç¯è¦æ±‚å°†å¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼Œä½†æ›´ä¸ºä¸¥é‡åœ°æ˜¯å®ƒä»£è¡¨è®¾è®¡ä¸­å­˜åœ¨ä¸¥é‡é”™è¯¯ã€‚

åœ¨æ‰€æœ‰æ¡ä»¶ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œç²¾å¿ƒè®¾è®¡çš„ Go ç¨‹åºçš„ import graph åº”è¯¥æ˜¯å®½çš„ï¼Œç›¸å¯¹å¹³å¦çš„ï¼Œè€Œä¸æ˜¯é«˜è€Œçª„çš„ã€‚ å¦‚æœä½ æœ‰ä¸€ä¸ª packageï¼Œå…¶å‡½æ•°æ— æ³•åœ¨ä¸å€ŸåŠ©å¦ä¸€ä¸ª package çš„æƒ…å†µä¸‹è¿è¡Œï¼Œé‚£ä¹ˆè¿™æˆ–è®¸è¡¨æ˜ä»£ç æ²¡æœ‰å¾ˆå¥½åœ°æ²¿ pakcage è¾¹ç•Œåˆ†è§£ã€‚

ä¾èµ–å€’ç½®åŸåˆ™é¼“åŠ±æ‚¨å°†ç‰¹å®šçš„è´£ä»»ï¼Œæ²¿ç€ import graph å°½å¯èƒ½çš„æ¨å‘æ›´é«˜å±‚çº§ï¼Œæ¨ç»™ main package æˆ–é¡¶çº§å¤„ç†ç¨‹åºï¼Œç•™ä¸‹è¾ƒä½çº§åˆ«çš„ä»£ç æ¥å¤„ç†æŠ½è±¡æ¥å£ã€‚

## æ€»ç»“

å›é¡¾ä¸€ä¸‹ï¼Œå½“åº”ç”¨äº Go æ—¶ï¼Œæ¯ä¸ª SOLID åŸåˆ™éƒ½æ˜¯å…³äºè®¾è®¡çš„å¼ºæœ‰åŠ›é™ˆè¿°ï¼Œä½†ç»¼åˆèµ·æ¥å®ƒä»¬å…·æœ‰ä¸­å¿ƒä¸»é¢˜ã€‚

- å•ä¸€èŒè´£åŸåˆ™ï¼Œé¼“åŠ±æ‚¨å°†åŠŸèƒ½ï¼Œç±»å‹ã€æ–¹æ³•ç»“æ„åŒ–ä¸ºå…·æœ‰è‡ªç„¶å†…èšçš„åŒ…ï¼›ç±»å‹å±äºå½¼æ­¤ï¼Œå‡½æ•°æœåŠ¡äºå•ä¸€ç›®çš„ã€‚
- å¼€æ”¾ / å°é—­åŸåˆ™ï¼Œé¼“åŠ±æ‚¨ä½¿ç”¨åµŒå…¥å°†ç®€å•ç±»å‹ç»„åˆæˆæ›´å¤æ‚çš„ç±»å‹ã€‚
- é‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œé¼“åŠ±æ‚¨æ ¹æ®æ¥å£è€Œä¸æ˜¯å…·ä½“ç±»å‹æ¥è¡¨è¾¾åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚é€šè¿‡å®šä¹‰å°å‹æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥æ›´åŠ ç¡®ä¿¡ï¼Œå®ç°å°†å¿ å®åœ°æ»¡è¶³ä»–ä»¬çš„å¥‘çº¦ã€‚
- æ¥å£éš”ç¦»åŸåˆ™ï¼Œè¿›ä¸€æ­¥é‡‡ç”¨äº†è¿™ä¸ªæƒ³æ³•ï¼Œå¹¶é¼“åŠ±æ‚¨å®šä¹‰ä»…ä¾èµ–äºä»–ä»¬æ‰€éœ€è¡Œä¸ºçš„å‡½æ•°å’Œæ–¹æ³•ã€‚å¦‚æœæ‚¨çš„å‡½æ•°ä»…éœ€è¦å…·æœ‰å•ä¸ªæ¥å£ç±»å‹çš„å‚æ•°çš„æ–¹æ³•ï¼Œåˆ™è¯¥å‡½æ•°æ›´å¯èƒ½åªæœ‰ä¸€ä¸ªè´£ä»»ã€‚
- ä¾èµ–å€’ç½®åŸåˆ™ï¼Œé¼“åŠ±æ‚¨æŒ‰ç…§ä»ç¼–è¯‘æ—¶é—´åˆ°è¿è¡Œæ—¶é—´çš„æ—¶åºï¼Œè½¬ç§» package æ‰€ä¾èµ–çš„çŸ¥è¯†ã€‚åœ¨ Go ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç‰¹å®š package ä½¿ç”¨çš„ import è¯­å¥çš„æ•°é‡å‡å°‘çœ‹åˆ°äº†è¿™ä¸€ç‚¹ã€‚

å¦‚æœè¦æ€»ç»“ä¸€ä¸‹æœ¬æ¬¡æ¼”è®²ï¼Œé‚£å¯èƒ½å°±æ˜¯è¿™æ ·ï¼š`interfaces let you apply the SOLID principles to Go programs`ã€‚

å› ä¸ºæ¥å£è®© Go ç¨‹åºå‘˜æè¿°ä»–ä»¬çš„ package æä¾›äº†ä»€ä¹ˆ - è€Œä¸æ˜¯å®ƒæ€ä¹ˆåšçš„ã€‚æ¢ä¸ªè¯´æ³•å°±æ˜¯ â€œè§£è€¦â€ï¼Œè¿™ç¡®å®æ˜¯ç›®æ ‡ï¼Œå› ä¸ºè¶Šæ¾æ•£è€¦åˆçš„è½¯ä»¶è¶Šå®¹æ˜“ä¿®æ”¹ã€‚

æ­£å¦‚ Sandi Metz æ‰€è¯´ï¼š

> Design is the art of arranging code that needs to work today, and to be easy to change forever. `â€“ Sandi Metz`

å› ä¸ºå¦‚æœ Go æƒ³è¦æˆä¸ºå…¬å¸é•¿æœŸæŠ•èµ„çš„è¯­è¨€ï¼ŒGo ç¨‹åºçš„å¯ç»´æŠ¤æ€§ï¼Œæ›´å®¹æ˜“å˜æ›´ï¼Œå°†æ˜¯ä»–ä»¬å†³ç­–çš„å…³é”®å› ç´ ã€‚

---
[Â« Golang å‘å¸ƒç±»åº“ - 2](go-publish-package-02.md)

[Â» Golang æ ‡å‡†åº“](go-stdlib.md)
