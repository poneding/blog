<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ç§‹æ²³è½å¶</title><link>https://blog.poneding.com/kubernetes/</link><description>Recent content on ç§‹æ²³è½å¶</description><generator>Hugo</generator><language>cn</language><atom:link href="https://blog.poneding.com/kubernetes/index.xml" rel="self" type="application/rss+xml"/><item><title/><link>https://blog.poneding.com/kubernetes/anti-affinity-improves-service-availability/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/anti-affinity-improves-service-availability/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / åäº²å’Œæ€§æé«˜æœåŠ¡å¯ç”¨æ€§
åäº²å’Œæ€§æé«˜æœåŠ¡å¯ç”¨æ€§ # åœ¨ Kubernetes ä¸­éƒ¨ç½²æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šéƒ¨ç½²å¤šå‰¯æœ¬æ¥æé«˜æœåŠ¡çš„å¯ç”¨æ€§ã€‚ä½†æ˜¯å½“è¿™äº›å‰¯æœ¬é›†ä¸­éƒ¨ç½²åœ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸”å¾ˆä¸å¹¸ï¼Œè¯¥èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œé‚£ä¹ˆæœåŠ¡å¾ˆå®¹æ˜“é™·å…¥ä¸å¯ç”¨çŠ¶æ€ã€‚
ä¸‹é¢ä»‹ç»ä¸€ç§æ–¹æ³•ï¼Œå°†æœåŠ¡å‰¯æœ¬åˆ†æ•£éƒ¨ç½²åœ¨ä¸åŒçš„èŠ‚ç‚¹ï¼ˆæŠŠé¸¡è›‹æ”¾åœ¨ä¸åŒçš„ç¯®å­é‡Œï¼‰ï¼Œé¿å…å•ä¸ªèŠ‚ç‚¹æ•…éšœå¯¼è‡´æœåŠ¡å¤šå‰¯æœ¬æ¯åï¼Œæé«˜æœåŠ¡å¯ç”¨æ€§ã€‚
åäº²å’Œ # apiVersion: apps/v1 kind: Deployment metadata: name: nginx labels: app: nginx spec: selector: matchLabels: app: nginx replicas: 5 template: metadata: labels: app: nginx spec: affinity: podAntiAffinity: requiredDuringSchedulingIgnoredDuringExecution: podAffinityTerm: labelSelector: matchExpressions: - key: app operator: In values: - nginx topologyKey: kubernetes.io/hostname containers: - name: nginx image: nginx ports: - name: tcp containerPort: 80 ä½¿ç”¨ kubernetes.io/hostname ä½œä¸ºæ‹“æ‰‘åŸŸ,æŸ¥çœ‹åŒ¹é…è§„åˆ™ï¼Œå³åŒä¸€æ‰“æœ‰åŒæ ·æ ‡ç­¾ app=nginx çš„ pod ä¼šè°ƒåº¦åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚</description></item><item><title/><link>https://blog.poneding.com/kubernetes/apiserver-builder/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/apiserver-builder/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / apiserver-builder
apiserver-builder # å®‰è£… # go install sigs.k8s.io/apiserver-builder-alpha/cmd/apiserver-boot@v1.23.0 æ­å»º # åˆå§‹åŒ–é¡¹ç›®ï¼š
âš ï¸ æ³¨æ„ï¼šç”±äºå†å²åŸå› éœ€è¦è¿›å…¥ $(go env GOPATH)/src/&amp;lt;package&amp;gt; åŒ…ç›®å½•ä¸‹æ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤ã€‚
mkdir -p $(go env GOPATH)/src/github.com/poneding/apiserver-demo &amp;amp;&amp;amp; cd $(go env GOPATH)/src/github.com/poneding/apiserver-demo apiserver-boot init repo --domain k8sdev.pding.top åˆ›å»º APIï¼š
# apiserver-boot create &amp;lt;group&amp;gt; &amp;lt;version&amp;gt; &amp;lt;resource&amp;gt; apiserver-boot create demo v1alpha1 User apiserver-boot create group version resource --group demo --version v1alpha1 --kind User å‚è€ƒ # https://github.com/kubernetes-sigs/apiserver-builder-alpha/blob/master/docs/tools_user_guide.md https://github.com/kubernetes-sigs/apiserver-builder-alpha/blob/master/README.md Â« åäº²å’Œæ€§æé«˜æœåŠ¡å¯ç”¨æ€§
Â» apiserver</description></item><item><title/><link>https://blog.poneding.com/kubernetes/apiserver/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/apiserver/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / apiserver
apiserver # æ¯ä¸€ä¸ª api ç‰ˆæœ¬å‡æœ‰ä¸€ä¸ª apiservice ä¸ä¹‹å¯¹åº”
k api-versions | wc -l 30 k get apiservices.apiregistration.k8s.io| wc -l 30 Â« apiserver-builder
Â» äºŒè¿›åˆ¶æ­å»º K8s - 1 æœºå™¨å‡†å¤‡</description></item><item><title/><link>https://blog.poneding.com/kubernetes/binary-build-k8s-01-prepare-nodes/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/binary-build-k8s-01-prepare-nodes/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / äºŒè¿›åˆ¶æ­å»º K8s - 1 æœºå™¨å‡†å¤‡
äºŒè¿›åˆ¶æ­å»º K8s - 1 æœºå™¨å‡†å¤‡ # å†™åœ¨å‰é¢ # è®°å½•å’Œåˆ†äº«ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ï¼Œç”±äºæ“ä½œæ¯”è¾ƒå†—é•¿ï¼Œå¤§æ¦‚ä¼šåˆ†å››ç¯‡å†™å®Œï¼š
æœºå™¨å‡†å¤‡ï¼š éƒ¨ç½² etcd é›†ç¾¤ï¼š éƒ¨ç½² Masterï¼š éƒ¨ç½² Nodeï¼š æ•´ä¸ªç›®æ ‡æ˜¯ä½¿ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼æ­å»ºä¸€ä¸ªå°å‹ K8s é›†ç¾¤ï¼ˆ1 ä¸ª Masterï¼Œ2 ä¸ª Nodeï¼‰ï¼Œä¾›è‡ªå·±å­¦ä¹ æµ‹è¯•ã€‚
è‡³äºä¸ºä»€ä¹ˆè¦è‡ªå·±å»ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼å»æ­å»º K8sï¼Œè€Œä¸æ˜¯é€‰ç”¨ minikube æˆ–è€… kubeadm å»æ­å»ºï¼Ÿ
å› ä¸ºä½¿ç”¨äºŒè¿›åˆ¶æ­å»ºï¼ŒK8s çš„æ¯ä¸ªç»„ä»¶ï¼Œæ¯ä¸ªå·¥å…·éƒ½éœ€è¦ä½ æ‰‹åŠ¨çš„å®‰è£…å’Œé…ç½®ï¼Œå¸®åŠ©ä½ åŠ æ·±å¯¹ K8s ç»„ç»‡æ¶æ„å’Œå·¥ä½œåŸç†çš„äº†è§£ã€‚
å‡†å¤‡å·¥ä½œ # ä¸‰å° centos7 è™šæ‹Ÿæœºï¼Œè‡ªå·±å­¦ä¹ ä½¿ç”¨çš„è¯ 1 æ ¸ 1G åº”è¯¥å°±å¤Ÿäº†ã€‚
è™šæ‹Ÿæœºèƒ½å¤Ÿè¿ç½‘ï¼Œç›¸å…³çš„å®‰è£…åŒ…æ–‡ä»¶ä¸‹è½½å’Œ Docker ä¸‹è½½é•œåƒéœ€è¦ä½¿ç”¨åˆ°å¤–ç½‘ã€‚
å½“å‰è™šæ‹Ÿæœºï¼š
k8s-master01: 192.168.115.131 k8s-node01: 192.168.115.132 k8s-node02: 192.168.115.133 è™šæ‹Ÿæœºåˆå§‹åŒ– # ä¸åšç‰¹æ®Šè¯´æ˜çš„è¯ï¼š
ä»¥ä¸‹æ“ä½œéœ€è¦åœ¨ Master å’Œ Node çš„æ‰€æœ‰æœºå™¨ä¸Šæ‰§è¡Œ</description></item><item><title/><link>https://blog.poneding.com/kubernetes/binary-build-k8s-02-deploy-etcd/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/binary-build-k8s-02-deploy-etcd/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / äºŒè¿›åˆ¶æ­å»º K8s - 2 éƒ¨ç½² etcd é›†ç¾¤
äºŒè¿›åˆ¶æ­å»º K8s - 2 éƒ¨ç½² etcd é›†ç¾¤ # å†™åœ¨å‰é¢ # è®°å½•å’Œåˆ†äº«ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ï¼Œç”±äºæ“ä½œæ¯”è¾ƒå†—é•¿ï¼Œå¤§æ¦‚ä¼šåˆ†å››ç¯‡å†™å®Œï¼š
æœºå™¨å‡†å¤‡ï¼š éƒ¨ç½² etcd é›†ç¾¤ï¼š éƒ¨ç½² Masterï¼š éƒ¨ç½² Nodeï¼š etcd ä½œä¸º K8s çš„æ•°æ®åº“ï¼Œéœ€è¦é¦–å…ˆå®‰è£…ï¼Œä¸ºå…¶ä»–ç»„ä»¶åšæœåŠ¡åŸºç¡€ã€‚
etcd æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ•°æ®åº“ç³»ç»Ÿï¼Œä¸ºäº†æ¨¡æ‹Ÿ etcd çš„é«˜å¯ç”¨ï¼Œæˆ‘ä»¬å°† etcd éƒ¨ç½²åœ¨ä¸‰å°è™šæ‹Ÿæœºä¸Šï¼Œæ­£å¥½å°±éƒ¨ç½²åœ¨ K8s é›†ç¾¤æ‰€ä½¿ç”¨çš„ä¸‰å°æœºå™¨ä¸Šå§ã€‚
etcd é›†ç¾¤ï¼ŒK8s ç»„ä»¶ä¹‹é—´é€šä¿¡ï¼Œä¸ºäº†å®‰å…¨å¯é ï¼Œæˆ‘ä»¬æœ€å¥½å¯ç”¨ HTTPS å®‰å…¨æœºåˆ¶ã€‚K8s æä¾›äº†åŸºäº CA ç­¾åçš„åŒå‘æ•°å­—è¯ä¹¦è®¤è¯æ–¹å¼å’Œç®€å•çš„åŸºäº HTTP Base æˆ– Token çš„è®¤è¯æ–¹å¼ï¼Œå…¶ä¸­ CA è¯ä¹¦æ–¹å¼çš„å®‰å…¨æ€§æœ€é«˜ã€‚æˆ‘ä»¬ä½¿ç”¨ cfssl ä¸ºæˆ‘ä»¬çš„ K8s é›†ç¾¤é…ç½® CA è¯ä¹¦ï¼Œæ­¤å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨ opensslã€‚
å®‰è£… cfssl # åœ¨ Master æœºå™¨æ‰§è¡Œï¼š</description></item><item><title/><link>https://blog.poneding.com/kubernetes/binary-build-k8s-03-deploy-master/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/binary-build-k8s-03-deploy-master/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / äºŒè¿›åˆ¶æ­å»º K8s - 3 éƒ¨ç½² Master
äºŒè¿›åˆ¶æ­å»º K8s - 3 éƒ¨ç½² Master # å†™åœ¨å‰é¢ # è®°å½•å’Œåˆ†äº«ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ï¼Œç”±äºæ“ä½œæ¯”è¾ƒå†—é•¿ï¼Œå¤§æ¦‚ä¼šåˆ†å››ç¯‡å†™å®Œï¼š
æœºå™¨å‡†å¤‡ï¼š éƒ¨ç½² etcd é›†ç¾¤ï¼š éƒ¨ç½² Masterï¼š éƒ¨ç½² Nodeï¼š æˆ‘ä»¬å·²ç»çŸ¥é“åœ¨ K8s çš„ Master ä¸Šå­˜åœ¨ç€ kube-apiserverã€kube-controller-managerã€kube-scheduler ä¸‰å¤§ç»„ä»¶ã€‚æœ¬ç¯‡ä»‹ç»åœ¨ Master æœºå™¨å®‰è£…è¿™äº›ç»„ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœæƒ³åœ¨ Master æœºå™¨ä¸Šæ“ä½œé›†ç¾¤ï¼Œè¿˜éœ€è¦å®‰è£… kubectl å·¥å…·ã€‚
å®‰è£… kubectl # kubernetes çš„å®‰è£…åŒ…é‡Œå·²ç»å°† kubectl åŒ…å«è¿›å»äº†ï¼Œéƒ¨ç½²å¾ˆç®€å•ï¼š
cd /root/kubernetes/resources/ tar -zxvf ./kubernetes-server-linux-amd64.tar.gz cp kubernetes/server/bin/kubectl /usr/bin kubectl api-versions åˆ¶ä½œ kubernetes è¯ä¹¦ # mkdir /root/kubernetes/resources/cert/kubernetes /etc/kubernetes/{ssl,bin} -p cp kubernetes/server/bin/kube-apiserver kubernetes/server/bin/kube-controller-manager kubernetes/server/bin/kube-scheduler /etc/kubernetes/bin cd /root/kubernetes/resources/cert/kubernetes æ¥ä¸‹æ¥éƒ½åœ¨ Master æœºå™¨ä¸Šæ‰§è¡Œï¼Œç¼–è¾‘ ca-config.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/binary-build-k8s-04-deploy-worker/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/binary-build-k8s-04-deploy-worker/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / äºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node
äºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node # å†™åœ¨å‰é¢ # è®°å½•å’Œåˆ†äº«ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ï¼Œç”±äºæ“ä½œæ¯”è¾ƒå†—é•¿ï¼Œå¤§æ¦‚ä¼šåˆ†å››ç¯‡å†™å®Œï¼š
æœºå™¨å‡†å¤‡ï¼š éƒ¨ç½² etcd é›†ç¾¤ï¼š éƒ¨ç½² Masterï¼š éƒ¨ç½² Nodeï¼š K8s çš„ Node ä¸Šéœ€è¦è¿è¡Œ kubelet å’Œ kube-proxyã€‚æœ¬ç¯‡ä»‹ç»åœ¨ Node æœºå™¨å®‰è£…è¿™ä¸¤ä¸ªç»„ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®‰è£…é€šä¿¡éœ€è¦çš„ cni æ’ä»¶ã€‚
æœ¬ç¯‡çš„æ‰§è¡Œå‘½ä»¤éœ€è¦åœ¨å‡†å¤‡çš„ä¸¤å°Nodeæœºå™¨ä¸Šæ‰§è¡Œã€‚
å®‰è£… docker # å¯ä»¥å‚ç…§å®˜ç½‘ï¼š https://docs.docker.com/engine/install/
# å¸è½½è€ç‰ˆæœ¬æˆ–é‡è£… docker æ—¶æ‰§è¡Œç¬¬ä¸€è¡Œ yum remove docker \ docker-client \ docker-client-latest \ docker-common \ docker-latest \ docker-latest-logrotate \ docker-logrotate \ docker-engine -y # å®‰è£… docker yum install -y yum-utils yum-config-manager \ --add-repo \ https://download.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/cloud-native-devops/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/cloud-native-devops/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / äº‘åŸç”Ÿ DevOps åº”çŸ¥åº”ä¼š
äº‘åŸç”Ÿ DevOps åº”çŸ¥åº”ä¼š # 1. å®¹å™¨åŸºç¡€ # 1.1 å®¹å™¨æ¦‚è¿° # å®¹å™¨ vs è™šæ‹Ÿæœº å®¹å™¨çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š ä½•ä¸ºå®¹å™¨åŒ–ï¼Ÿå®ƒå¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ 1.2 å®¹å™¨è¿è¡Œæ—¶ # Dockerï¼š Docker å¿«é€Ÿå…¥é—¨ containerd / CRI-O åœ¨çº¿ä½“éªŒ Dockerï¼š Play with Docker
1.3 å®¹å™¨ç½‘ç»œ # Bridge, Host, None, Macvlan CNI æ’ä»¶ï¼š Flannel Calico Cilium 1.4 å®¹å™¨å­˜å‚¨ # Volumeã€Bind Mountã€OverlayFS å­˜å‚¨æ–¹æ¡ˆï¼š Longhorn Ceph 2. Kubernetes è¿è¡ŒåŸºç¡€ # Kubernetes æ¶æ„ï¼š 2.1 æ ¸å¿ƒç»„ä»¶ # API Server Scheduler Controller Manager Kubelet Kube-Proxy å‚è€ƒåšå®¢ï¼š kubernetes æ ¸å¿ƒç»„ä»¶è¿è¡Œæœºåˆ¶-åŸç†è§£æ</description></item><item><title/><link>https://blog.poneding.com/kubernetes/cloud-native-understood/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/cloud-native-understood/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 å°è¯•ç†è§£äº‘åŸç”Ÿ
Kubernetes 0-1 å°è¯•ç†è§£äº‘åŸç”Ÿ # æœ€åˆçš„äº‘åŸç”Ÿå®šä¹‰ï¼š
åº”ç”¨å®¹å™¨åŒ– é¢å‘å¾®æœåŠ¡æ¶æ„ åº”ç”¨æ”¯æŒå®¹å™¨ç¼–æ’è°ƒåº¦ é‡æ–°å®šä¹‰äº‘åŸç”Ÿï¼š
äº‘åŸç”ŸæŠ€æœ¯æœ‰åˆ©äºå„ç»„ç»‡åœ¨å…¬æœ‰äº‘ã€ç§æœ‰äº‘å’Œæ··åˆäº‘ç­‰æ–°å‹åŠ¨æ€ç¯å¢ƒä¸­ï¼Œæ„å»ºå’Œè¿è¡Œå¯å¼¹æ€§æ‰©å±•çš„åº”ç”¨ã€‚äº‘åŸç”Ÿçš„ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬å®¹å™¨ã€æœåŠ¡ç½‘æ ¼ã€å¾®æœåŠ¡ã€ä¸å¯å˜åŸºç¡€è®¾æ–½å’Œå£°æ˜å¼APIã€‚
è¿™äº›æŠ€æœ¯èƒ½å¤Ÿæ„å»ºå®¹é”™æ€§å¥½ã€æ˜“äºç®¡ç†å’Œä¾¿äºè§‚å¯Ÿçš„æ¾è€¦åˆç³»ç»Ÿã€‚ç»“åˆå¯é çš„è‡ªåŠ¨åŒ–æ‰‹æ®µï¼Œäº‘åŸç”ŸæŠ€æœ¯ä½¿å·¥ç¨‹å¸ˆèƒ½å¤Ÿè½»æ¾åœ°å¯¹ç³»ç»Ÿä½œå‡ºé¢‘ç¹å’Œå¯é¢„æµ‹çš„é‡å¤§å˜æ›´ã€‚
äº‘åŸç”Ÿæœ¬èº«ä¸èƒ½ç§°ä¸ºæ˜¯ä¸€ç§æ¶æ„ï¼Œå®ƒé¦–å…ˆæ˜¯ä¸€ç§åŸºç¡€è®¾æ–½ï¼Œè¿è¡Œåœ¨å…¶ä¸Šçš„åº”ç”¨ç§°ä½œäº‘åŸç”Ÿåº”ç”¨ï¼Œåªæœ‰ç¬¦åˆäº‘åŸç”Ÿè®¾è®¡å“²å­¦çš„åº”ç”¨æ¶æ„æ‰å«äº‘åŸç”Ÿåº”ç”¨æ¶æ„ã€‚
Â« äº‘åŸç”Ÿ DevOps åº”çŸ¥åº”ä¼š
Â» é›†ç¾¤è”é‚¦</description></item><item><title/><link>https://blog.poneding.com/kubernetes/cluster-federation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/cluster-federation/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / é›†ç¾¤è”é‚¦
é›†ç¾¤è”é‚¦ # äº‘æœåŠ¡æä¾›å•†çš„é›†ç¾¤è”é‚¦æ˜¯ä¸€ç§å°†å¤šä¸ªç‹¬ç«‹çš„ Kubernetes é›†ç¾¤ç»„åˆåœ¨ä¸€èµ·çš„æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•å…è®¸ç”¨æˆ·åœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´å…±äº«èµ„æºï¼Œä¾‹å¦‚ Podsã€Servicesã€Deployments ç­‰ã€‚é›†ç¾¤è”é‚¦çš„ç›®æ ‡æ˜¯åœ¨å¤šä¸ªé›†ç¾¤ä¸Šå¼•å…¥æ–°çš„æ§åˆ¶é¢æ¿ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„è§†å›¾ï¼Œä½¿ç”¨æˆ·å¯ä»¥åœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´æ— ç¼åœ°éƒ¨ç½²å’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚
æ¦‚å¿µ # æ•°æ®ä¸­å¿ƒï¼šRegionï¼Œæ˜¯ä¸€ä¸ªç‰©ç†ä½ç½®ï¼ŒåŒ…å«å¤šä¸ªå¯ç”¨æ€§åŒºåŸŸã€‚ å¯ç”¨æ€§åŒºåŸŸï¼šAvailability Zoneï¼ˆAZï¼‰ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®ä¸­å¿ƒï¼ŒåŒ…å« N å¤šæœåŠ¡å™¨èŠ‚ç‚¹ã€‚ ç®¡ç†é›†ç¾¤ï¼šæˆ–è€…å®¿ä¸»é›†ç¾¤ï¼Œæ˜¯ä¸€ä¸ªé›†ç¾¤è”é‚¦çš„æ ¸å¿ƒï¼Œç”¨äºç®¡ç†å¤šä¸ªå·¥ä½œé›†ç¾¤ã€‚ è”é‚¦é›†ç¾¤ï¼šæˆ–è€…å·¥ä½œé›†ç¾¤ï¼Œæ˜¯ä¸€ä¸ªæ™®é€šçš„ Kubernetes é›†ç¾¤ï¼Œç”¨äºéƒ¨ç½²å·¥ä½œè´Ÿè½½ã€‚ é›†ç¾¤è”é‚¦éœ€è¦è§£å†³çš„é—®é¢˜ # è·¨é›†ç¾¤æœåŠ¡å‘ç°ï¼šè¿é€šå¤šä¸ªé›†ç¾¤ï¼Œä½¿å¾—æœåŠ¡å¯ä»¥åœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´å‘ç°ï¼Œè®©è¯·æ±‚è·¨è¶Šé›†ç¾¤è¾¹ç•Œã€‚ è·¨é›†ç¾¤è°ƒåº¦ï¼šå°†è´Ÿè½½è°ƒåº¦åˆ°å¤šä¸ªé›†ç¾¤ï¼Œä¿è¯æœåŠ¡çš„ç¨³å®šæ€§ä»¥åŠå¯ç”¨æ€§ã€‚ é›†ç¾¤è”é‚¦å¼€æºé¡¹ç›® # Kubefed # é¡¹ç›®åœ°å€
ä¹‹å‰ç”± Kubernetes å®˜æ–¹å¤šé›†ç¾¤å…´è¶£å°ç»„å¼€å‘ï¼Œç›®å‰å·²ç»åœæ­¢ç»´æŠ¤ã€‚
æ¶æ„åŸç†ï¼š
å°†è”é‚¦èµ„æºï¼ˆFederationResourceï¼‰ä»ç®¡ç†é›†ç¾¤åŒæ­¥åˆ°å·¥ä½œé›†ç¾¤ã€‚
è¿™å…¶ä¸­é€šè¿‡ä¸‰ä¸ªæ¦‚å¿µæ¥å®ç°ï¼š
Templateï¼šå®šä¹‰äº†è”é‚¦èµ„æºçš„æ¨¡æ¿ï¼Œç”¨äºæŒ‡å®šè”é‚¦èµ„æºçš„å±æ€§ Placementï¼šå®šä¹‰äº†è”é‚¦é›†ç¾¤èµ„æºçš„éƒ¨ç½²ä½ç½®ï¼Œç”¨äºæŒ‡å®šè”é‚¦èµ„æºçš„éƒ¨ç½²ä½ç½®ã€‚ Overridesï¼šå®šä¹‰äº†è”é‚¦é›†ç¾¤èµ„æºçš„è¦†ç›–è§„åˆ™ï¼Œç”¨äºè¦†ç›–è”é‚¦èµ„æºçš„å±æ€§ã€‚ kubefed ä¸ºæ‰€æœ‰çš„ Kubernetes åŸç”Ÿèµ„æºæä¾›äº†å¯¹åº”çš„è”é‚¦èµ„æºï¼Œä¾‹å¦‚ FederatedServiceã€FederatedDeployment ç­‰ã€‚
è”é‚¦èµ„æºä¸­å®šä¹‰äº†åŸç”Ÿèµ„æºçš„ Templateã€åˆé€šè¿‡ Overrides å®šä¹‰äº†èµ„æºåŒæ­¥åˆ°ä¸åŒçš„å·¥ä½œé›†ç¾¤æ—¶éœ€è¦åšçš„å˜æ›´ï¼Œä¾‹å¦‚ï¼š
kind: FederatedDeployment ... spec: ... overrides: # Apply overrides to cluster1 - clusterName: cluster1 clusterOverrides: # Set the replicas field to 5 - path: &amp;#34;/spec/replicas&amp;#34; value: 5 # Set the image of the first container - path: &amp;#34;/spec/template/spec/containers/0/image&amp;#34; value: &amp;#34;nginx:1.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/configmap-understood/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/configmap-understood/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / äº†è§£ ConfigMap
äº†è§£ ConfigMap # å‡ ä¹æ‰€æœ‰çš„åº”ç”¨éƒ½éœ€è¦é…ç½®ä¿¡æ¯ï¼Œåœ¨ K8s éƒ¨ç½²åº”ç”¨ï¼Œæœ€ä½³å®è·µæ˜¯å°†åº”ç”¨çš„é…ç½®ä¿¡æ¯ï¼ˆç¯å¢ƒå˜é‡æˆ–è€…é…ç½®æ–‡ä»¶ï¼‰å’Œç¨‹åºæœ¬èº«åˆ†ç¦»ï¼Œè¿™æ ·é…ç½®ä¿¡æ¯çš„æ›´æ–°å’Œå¤ç”¨éƒ½å¯ä»¥æ›´ç®€å•ï¼Œä¹Ÿä½¿å¾—ç¨‹åºæ›´åŠ çµæ´»ã€‚
Kubernetes å…è®¸å°†é…ç½®é€‰é¡¹åˆ†ç¦»åˆ°å•ç‹¬çš„èµ„æºå¯¹è±¡ ConfigMap ä¸­ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé”®å€¼å¯¹æ˜ å°„ï¼Œå€¼å¯ä»¥æ˜¯ä¸€ä¸ªçŸ­ string ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„é…ç½®æ–‡ä»¶ã€‚
æœ¬ç¯‡ä¸»è¦ä»‹ç» ConfigMap èµ„æºçš„åˆ›å»ºå’Œä½¿ç”¨ã€‚
ConfigMap çš„åˆ›å»º # å¯ä»¥ç›´æ¥é€šè¿‡ kubectl create configmap å‘½ä»¤åˆ›å»ºï¼Œä¹Ÿå¯ä»¥å…ˆç¼–å†™ configmap çš„ yaml æ–‡ä»¶å†ä½¿ç”¨kubectl apply -f &amp;lt;filename&amp;gt;åˆ›å»ºï¼Œæ¨èä½¿ç”¨åè€…ã€‚
å•è¡Œå‘½ä»¤åˆ›å»º ConfigMap # åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹çš„ ConfigMapï¼š kubectl create configmap first-config --from-literal=user=admin åˆ›å»ºå®Œæˆä¹‹åï¼Œä½¿ç”¨ kubectl describe configmap first-config æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ª configmap çš„é”®å€¼å†…å®¹ã€‚
å¯ä»¥ä½¿ç”¨å¤šç»„ --from-literal=&amp;lt;key&amp;gt;=&amp;lt;value&amp;gt; å‚æ•°ï¼Œåœ¨ configmap ä¸­å®šä¹‰å¤šç»„é”®å€¼å¯¹ã€‚
åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å†…å®¹çš„ ConfigMap å‡å¦‚æˆ‘å½“å‰æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ app.jsonï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š
{ &amp;#34;App&amp;#34;: &amp;#34;MyApp&amp;#34;, &amp;#34;Version&amp;#34;: &amp;#34;v1.0&amp;#34; } ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»º ConfigMapï¼š</description></item><item><title/><link>https://blog.poneding.com/kubernetes/delete-es-log-index-scheduler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/delete-es-log-index-scheduler/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / å®šæœŸåˆ é™¤ ElasticSearch æ—¥å¿—ç´¢å¼•
å®šæœŸåˆ é™¤ ElasticSearch æ—¥å¿—ç´¢å¼• # èƒŒæ™¯ # å½“å‰åœ¨ K8s é›†ç¾¤ä¸­éƒ¨ç½²äº†ä¸€å¥— EFK æ—¥å¿—ç›‘æ§ç³»ç»Ÿï¼Œæ—¥å¤ä¸€æ—¥ï¼ŒElasticSearchæ”¶é›†çš„æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œå†…å­˜ä»¥åŠå­˜å‚¨å ç”¨è¶Šæ¥è¶Šé«˜ï¼Œéœ€è¦å®šæœŸæ¥åˆ é™¤è€æ—§çš„æ—¥å¿—æ•°æ®ï¼Œæ¥è§£æ”¾å†…å­˜å’Œå­˜å‚¨ç©ºé—´ï¼Œè€ƒè™‘åˆ° K8s ä¸­ cronjob çš„åŠŸèƒ½ç‰¹æ€§ï¼Œæ‰“ç®—ä½¿ç”¨å®ƒåˆ¶å®šä¸€ä¸ªesæ—¥å¿—ç´¢å¼•æ¸…é™¤è„šæœ¬ï¼Œå®šæ—¶æ¸…é™¤æ—¥å¿—æ•°æ®ã€‚
ConfigMap # è¿™ä¸ªconfigMapç”¨æ¥å­˜å‚¨ä¸€ä¸ªshellè„šæœ¬ï¼Œè¯¥shellè„šæœ¬æ‰§è¡Œæ—¥å¿—ç´¢å¼•æ¸…é™¤æ“ä½œï¼š
apiVersion: v1 kind: ConfigMap metadata: name: es-log-indices-clear-configmap namespace: efk data: clean-indices.sh: | #/bin/bash LAST_MONTH_DATE=`date -d &amp;#34;1 month ago&amp;#34; +&amp;#34;%Y.%m.%d&amp;#34;` echo Start clear es indices *-${LAST_MONTH_DATE} curl -XDELETE http://elasticsearch:9200/*-${LAST_MONTH_DATE} --- è¯´æ˜ï¼šè¿™é‡Œæˆ‘é…ç½®çš„configmapæ‰€åœ¨å‘½åç©ºé—´å’Œefkéƒ¨ç½²çš„å‘½åç©ºé—´ä¸€è‡´ï¼Œå¹¶ä¸”esçš„Serviceçš„åç§°æ˜¯elasticsearchï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ http://elasticsearch:9200è®¿é—®åˆ°esæœåŠ¡ï¼Œå¦åˆ™çš„è¯éœ€è¦æ˜¯æ— æ³•è®¿é—®åˆ°çš„ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µé…ç½®esçš„æœåŠ¡åœ°å€ï¼›
CronJob # CronJobä½¿ç”¨äº† poneding/sparrow
apiVersion: batch/v1beta1 kind: CronJob metadata: name: clean-indices namespace: efk spec: schedule: &amp;#34;0 0 1/1 * *&amp;#34; jobTemplate: spec: template: spec: containers: - name: auto-recycle-job image: poneding/sparrow args: [&amp;#34;/bin/sh&amp;#34;, &amp;#34;/job/clean-indices.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/delete-k8s-resource-force/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/delete-k8s-resource-force/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / å¼ºåˆ¶åˆ é™¤ K8s èµ„æº
å¼ºåˆ¶åˆ é™¤ K8s èµ„æº # å¼ºåˆ¶åˆ é™¤ Pod # kubectl delete po &amp;lt;pod&amp;gt; -n &amp;lt;namespace&amp;gt; --force --grace-period=0 å¼ºåˆ¶åˆ é™¤ PVC # kubectl patch pv &amp;lt;pv&amp;gt; -n &amp;lt;namespace&amp;gt; -p &amp;#39;{&amp;#34;metadata&amp;#34;:{&amp;#34;finalizers&amp;#34;:null}}&amp;#39; å¼ºåˆ¶åˆ é™¤ PV # kubectl patch pvc &amp;lt;pvc&amp;gt; -n &amp;lt;namespace&amp;gt; -p &amp;#39;{&amp;#34;metadata&amp;#34;:{&amp;#34;finalizers&amp;#34;:null}}&amp;#39; å¼ºåˆ¶åˆ é™¤å‘½åç©ºé—´ # åœ¨åˆ é™¤ kubesphere çš„å‘½åç©ºé—´æ—¶é‡åˆ°æ— æ³•åˆ é™¤æˆåŠŸçš„ç°è±¡ï¼Œå‘½åç©ºé—´ä¸€ç›´å¤„äº Terminating çŠ¶æ€ã€‚
$ kubectl get ns |grep kubesphere NAME STATUS AGE kubesphere-controls-system Terminating 22d kubesphere-monitoring-system Terminating 21d åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚
é¦–å…ˆè·å–å‘½åç©ºé—´çš„ json æ–‡ä»¶ï¼Œ</description></item><item><title/><link>https://blog.poneding.com/kubernetes/gateway-api-practice/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/gateway-api-practice/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Gateway API å®è·µ
Gateway API å®è·µ # Gateway API è¿˜åœ¨ç§¯æå¼€å‘ä¸­ï¼Œç›®å‰å·²ç»å‘å¸ƒäº† v1.0.0 ç‰ˆæœ¬ã€‚å¯ä»¥é€šè¿‡ gateway-api æ–‡æ¡£ è·å–æœ€æ–°è¿›å±•ã€‚
Gateway API æ¦‚è¿° # Gateway API æ˜¯ä¸€ä¸ª Kubernetes çš„æ‰©å±• APIï¼Œå®ƒå®šä¹‰äº†ä¸€å¥— API æ¥ç®¡ç†ç½‘å…³ã€è·¯ç”±ã€TLS ç­‰èµ„æºå¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£ä¼ ç»Ÿçš„ Ingressã€‚
å’Œ Ingress ä¸€æ ·ï¼ŒGateway API ä¹Ÿæ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå®ƒå®šä¹‰äº†ä¸€å¥— API æ¥å£ï¼Œè¿™äº›æ¥å£ç”±ç¤¾åŒºä¸­çš„ä¸åŒå‚å•†æ¥å®ç°ï¼Œæ¯”å¦‚ nginxã€envoyã€traefik ç­‰ã€‚
API æ¸…å• # GatewayClass Gateway HTTPRoute GRPCRoute BackendTLSPolicy ReferenceGrant å®‰è£… Gateway API # # å®‰è£…æœ€æ–°ç‰ˆ gateway-api CRDs export LATEST=$(curl -s https://api.github.com/repos/kubernetes-sigs/gateway-api/releases/latest | jq -r .tag_name) kubectl apply -f https://github.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/helm-k8s-package-management-tool/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/helm-k8s-package-management-tool/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 Helm Kubernetes çš„åŒ…ç®¡ç†å·¥å…·
Kubernetes 0-1 Helm Kubernetes çš„åŒ…ç®¡ç†å·¥å…· # Helm is the best way to find, share, and use software built for Kubernetes.
Helmæ˜¯ä¸ºKuberneteså¯»æ‰¾ï¼Œå…±äº«å’Œä½¿ç”¨è½¯ä»¶æ„å»ºçš„æœ€ä½³æ–¹å¼ã€‚
ç®€ä»‹ # Helmå¸®åŠ©ç®¡ç†Kubernetesåº”ç”¨ç¨‹åºï¼Œå³ä½¿æ˜¯é¢å¯¹å¤æ‚çš„K8så¼•ç”¨ï¼ŒHelm Chartsä¹Ÿå¯ä»¥è½»æ¾å®ç°å®šä¹‰ï¼Œå®‰è£…å’Œå‡çº§ã€‚
Helmæ˜¯CNCFçš„æ¯•ä¸šé¡¹ç›®ï¼Œç”±Helmç¤¾åŒºç»´æŠ¤ã€‚
Chartsï¼š
Chartså¯ä»¥çœ‹ä½œæ˜¯Helmçš„ç¨‹åºåŒ…ï¼Œä¸€ä¸ªChartæ˜¯æè¿°Kubernetesèµ„æºé›†çš„æ–‡ä»¶é›†åˆã€‚
Repositoryï¼š
å­˜å‚¨å’Œå…±äº«Chartsï¼Œå¯ä»¥çœ‹ä½œæ˜¯Kubernetesç¨‹åºåŒ…çš„å­˜å‚¨ä¸­å¿ƒã€‚
Releaseï¼š
ç”±ä¸€ä¸ªChartè¿è¡Œèµ·æ¥çš„å®ä¾‹ï¼Œè¿™å°†åœ¨kubernetesé›†ç¾¤ä¸­ç”Ÿæˆæˆ–æ›´æ–°ä¸€ç»„èµ„æºï¼Œå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªchartè¿è¡Œæˆå¤šä¸ªreleaseã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¿è¡Œå¤šä¸ªredisæœåŠ¡ï¼Œä½ å¯ä»¥é€šè¿‡å¤šæ¬¡å®‰è£…redisçš„chartå¾—åˆ°ã€‚
çœ‹åˆ°ä»¥ä¸Šä¸‰ä¸ªæ¦‚å¿µï¼Œä½ å¯èƒ½ä¼šè§‰å¾—ä¼¼æ›¾ç›¸è¯†ï¼Œæ²¡é”™ï¼Œä¸dockerä¸‰ä¸ªæ¦‚å¿µâ€”â€”imageï¼Œregistryï¼Œcontainerå¦‚å‡ºä¸€è¾™ï¼Œä¹Ÿè®¸ç°åœ¨ä½ ä¼šåŠ æ·±ç‚¹ç†è§£äº†ã€‚
å®‰è£… # å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨è„šæœ¬å®‰è£…
curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 chmod 700 ./get-helm.sh ./get-helm.sh ä¹Ÿå¯ä»¥ä¸‹è½½æŒ‡å®šç‰ˆæœ¬æ‰‹åŠ¨å®‰è£…
ä¸‹è½½åœ°å€ï¼š https://github.com/helm/helm/releases
wget https://get.helm.sh/helm-v3.5.2-linux-amd64.tar.gz tar -zxvf ./helm-v3.5.2-linux-amd64.tar.gz sudo mv linux-amd64/helm /usr/local/bin/helm ç¬¬ä¸€ä¸ªhelmå‘½ä»¤
helm help æ›´å¤šå®‰è£…æ–¹å¼å¯æŸ¥çœ‹ï¼š https://helm.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/hpa-usage/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/hpa-usage/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 å®ç°Podè‡ªåŠ¨æ‰©ç¼©HPA
Kubernetes 0-1 å®ç°Podè‡ªåŠ¨æ‰©ç¼©HPA # https://blog.51cto.com/14143894/2458468?source=dra
å‰è¨€ # åœ¨K8sé›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡éƒ¨ç½²Metrics Serveræ¥æŒç»­æ”¶é›†Podçš„èµ„æºåˆ©ç”¨æŒ‡æ ‡æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ”¶é›†åˆ°çš„æŒ‡æ ‡æ•°æ®æ¥è¯„ä¼°æ˜¯å¦éœ€è¦è°ƒæ•´Podçš„æ•°é‡ä»¥è´´åˆå®ƒçš„ä½¿ç”¨éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è§‚å¯Ÿåˆ°Podçš„CPUåˆ©ç”¨ç‡è¿‡é«˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‚å½“ä¸Šè°ƒDeploymentçš„Replicaså­—æ®µå€¼ï¼Œæ¥æ‰‹åŠ¨å®ç°Podçš„æ¨ªå‘æ‰©å®¹ã€‚
Metrics Serverçš„æŒ‡æ ‡æ•°æ®å¯ä»¥é€šè¿‡DashboardæŸ¥çœ‹åˆ°ï¼› å®‰è£…Metrics Server # HPAä»‹ç» # HPAï¼ˆHorizontal Pod Autoscalerï¼ŒPodæ°´å¹³è‡ªåŠ¨æ‰©ç¼©ï¼‰ï¼Œæ ¹æ®Podçš„èµ„æºåˆ©ç”¨ç‡è‡ªåŠ¨è°ƒæ•´Podç®¡ç†å™¨ä¸­å‰¯æœ¬æ•°ï¼šPodèµ„æºåˆ©ç”¨ç‡ä½ï¼Œé™ä½Podå‰¯æœ¬æ•°ï¼Œé™ä½èµ„æºçš„ä½¿ç”¨ï¼ŒèŠ‚çº¦æˆæœ¬ï¼›Podèµ„æºåˆ©ç”¨ç‡é«˜ï¼Œå¢åŠ Podå‰¯æœ¬æ•°ï¼Œæé«˜åº”ç”¨çš„è´Ÿè½½èƒ½åŠ›ã€‚
ç¤ºä¾‹ # ä»¥éƒ¨ç½²redisä¸ºä¾‹ï¼Œç°ä½¿ç”¨redis
Â« Kubernetes 0-1 Helm Kubernetes çš„åŒ…ç®¡ç†å·¥å…·
Â» HTTP å®¢æˆ·ç«¯è°ƒç”¨ Kubernetes APIServer</description></item><item><title/><link>https://blog.poneding.com/kubernetes/http-call-k8s-apiserver/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/http-call-k8s-apiserver/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / HTTP å®¢æˆ·ç«¯è°ƒç”¨ Kubernetes APIServer
HTTP å®¢æˆ·ç«¯è°ƒç”¨ Kubernetes APIServer # æœ¬ç¯‡ä»‹ç»å‡ ç§å¦‚ä½•é€šè¿‡ HTTP å®¢æˆ·ç«¯è°ƒç”¨ Kubernetes APIServer çš„å§¿åŠ¿ã€‚
å¦‚ä½•è·å– Kubernetes api-server åœ°å€ # æŸ¥çœ‹ api-server çš„å‡ ç§æ–¹å¼ï¼š
# 1. ç›´æ¥æŸ¥çœ‹ kubeconfig æ–‡ä»¶ $ cat ~/.kube/config apiVersion: v1 clusters: - cluster: server: https://192.168.58.2:8443 ... # 2. kubectl æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ $ kubectl cluster-info Kubernetes control plane is running at https://192.168.58.2:8443 ... # 3. kubectl æŸ¥çœ‹é›†ç¾¤é…ç½® $ kubectl config view clusters: - cluster: .</description></item><item><title/><link>https://blog.poneding.com/kubernetes/informer/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/informer/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Informer
Informer # Informeræ˜¯client-goä¸­å®ç°çš„ä¸€ä¸ªå·¥å…·åŒ…ï¼Œç›®å‰å·²ç»è¢«kubernetesä¸­å„ä¸ªç»„ä»¶æ‰€ä½¿ç”¨ï¼Œä¾‹å¦‚controller-managerã€‚Informeræœ¬è´¨æ˜¯ä¸€ä¸ªapièµ„æºçš„ç¼“å­˜ã€‚
ä¸»è¦åŠŸèƒ½ï¼š
å°†etcdæ•°æ®åŒæ­¥è‡³æœ¬åœ°ç¼“å­˜ï¼Œå®¢æˆ·ç«¯é€šè¿‡æœ¬åœ°ç¼“å­˜è¯»å–å’Œç›‘å¬èµ„æº
æ³¨å†Œèµ„æºAddï¼ŒUpdateï¼ŒDeleteçš„è§¦å‘äº‹ä»¶
ç›®çš„ï¼š
æœ¬åœ°ç¼“å­˜ï¼Œé¿å…ç»„ä»¶ç›´æ¥ä¸api-serveräº¤äº’ï¼Œå‡ç¼“å¯¹api-serveråŠetcdçš„è®¿é—®å‹åŠ›ã€‚
ç»„ä»¶ # Reflector
Delta FIFO Queue
Indexerï¼ˆlocal strorageï¼‰
ä¸‹é¢ç»“åˆæµç¨‹ç¤ºæ„å›¾ç®€å•ä»‹ç»è¿™äº›ç»„ä»¶çš„è§’è‰²ã€‚
æµç¨‹ç¤ºæ„å›¾ # è¿™å¼ ç¤ºæ„å›¾å±•ç¤ºäº†client-goç±»åº“ä¸­å„ä¸ªç»„ä»¶çš„å·¥ä½œæœºåˆ¶ï¼Œä»¥åŠå®ƒä»¬ä¸å’±ä»¬å°†è¦ç¼–å†™çš„è‡ªå®šä¹‰æ§åˆ¶å™¨çš„äº¤äº’ç‚¹ï¼ˆé»„é¢œè‰²æ ‡æ³¨çš„å—æ˜¯éœ€è¦è‡ªè¡Œå¼€å‘çš„éƒ¨åˆ†ï¼‰ã€‚
Reflectorï¼š
è´Ÿè´£ç›‘å¬ï¼ˆWatchï¼‰ç‰¹å®šKubernetesèµ„æºå¯¹è±¡ï¼Œç›‘å¬çš„èµ„æºå¯¹è±¡å¯ä»¥æ˜¯å†…ç½®çš„èµ„æºä¾‹å¦‚Podï¼ŒIngressç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å®šåˆ¶çš„CRå¯¹è±¡ã€‚
Reflettorä¸ApiServerå»ºç«‹è¿æ¥ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨List&amp;amp;Watchæœºåˆ¶ä»ApiServerä¸­Listç‰¹å®šèµ„æºçš„æ‰€æœ‰å®ä¾‹ï¼Œè¿™äº›å®ä¾‹é™„å¸¦çš„ResourceVersionå­—æ®µå¯ä»¥ç”¨æ¥åŒºåˆ†å®ä¾‹æ˜¯å¦æ›´æ–°ã€‚åç»­åœ¨ä½¿ç”¨List&amp;amp;Watchæœºåˆ¶ä»ApiServerä¸­Watchç‰¹å®šèµ„æºçš„æ–°å¢ï¼Œæ›´æ–°ï¼Œåˆ é™¤ç­‰å˜åŒ–ï¼ˆå¢é‡Deltaï¼‰ã€‚
å°†ç›‘å¬åˆ°çš„èµ„æºçš„æ–°å¢ï¼Œæ›´æ–°ï¼Œåˆ é™¤é¡ºåºå†™å…¥åˆ°DeltaFIFOé˜Ÿåˆ—ä¸­ã€‚
DeltaFIFOï¼š
ä¸€ä¸ªå¢é‡çš„å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œå­˜å‚¨ç›‘å¬åˆ°çš„èµ„æºï¼Œä»¥åŠèµ„æºäº‹ä»¶ç±»å‹ï¼Œä¾‹å¦‚Addedï¼ŒUpdatedï¼ŒDeletedï¼ŒReplacedï¼ŒSyncã€‚
Informerï¼š
Indexerï¼š
ä¸€ä¸ªè‡ªå¸¦ç´¢å¼•åŠŸèƒ½çš„æœ¬åœ°å­˜å‚¨ï¼Œç”¨äºå­˜å‚¨èµ„æºå¯¹è±¡ã€‚Informerä»DeltaFIFOä¸­Popå‡ºèµ„æºï¼Œå­˜å‚¨åˆ°Indexerã€‚Indexerä¸­èµ„æºä¸k8s etcdæ•°æ®ä¿æŒä¸€è‡´ã€‚æœ¬åœ°è¯»å–æ—¶ç›´æ¥æŸ¥è¯¢æœ¬åœ°å­˜å‚¨ï¼Œä»è€Œå‡å°‘k8s apiserverå’Œetcdçš„å‹åŠ›ã€‚
ä½¿ç”¨ç¤ºä¾‹ # è‡ªå®šä¹‰æ§åˆ¶å™¨
clientset, err := kubernetes.NewForConfig(config) stopCh := make(chan struct{}) defer close(stopch) sharedInformers := informers.NewSharedInformerFactory(clientset, time.Minute) informer := sharedInformer.Core().V1().Pods().Informer() informer.AddEventHandler(cache.ResourceEventHandlerFuncs{ AddFunc: func(obj interface{} { // ... }, UpdateFunc: func(obj interface{} { // .</description></item><item><title/><link>https://blog.poneding.com/kubernetes/ingress-gray-deploy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/ingress-gray-deploy/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / é€šè¿‡ Ingress è¿›è¡Œç°åº¦å‘å¸ƒ
é€šè¿‡ Ingress è¿›è¡Œç°åº¦å‘å¸ƒ # https://start.aliyun.com/handson/Tn0HcdCZ/grap_publish_by_ingress
Step 1 ï¼šå®éªŒä»‹ç» # æœ¬å®éªŒï¼Œä½ å°†è¿è¡Œè¿è¡Œä¸€ä¸ªç®€å•çš„åº”ç”¨ï¼Œéƒ¨ç½²ä¸€ä¸ªæ–°çš„åº”ç”¨ç”¨äºæ–°çš„å‘å¸ƒï¼Œå¹¶é€šè¿‡ Ingress èƒ½åŠ›å®ç°ç°åº¦å‘å¸ƒã€‚
ç°åº¦åŠè“ç»¿å‘å¸ƒæ˜¯ä¸ºæ–°ç‰ˆæœ¬åˆ›å»ºä¸€ä¸ªä¸è€ç‰ˆæœ¬å®Œå…¨ä¸€è‡´çš„ç”Ÿäº§ç¯å¢ƒï¼Œåœ¨ä¸å½±å“è€ç‰ˆæœ¬çš„å‰æä¸‹ï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™æŠŠéƒ¨åˆ†æµé‡åˆ‡æ¢åˆ°æ–°ç‰ˆæœ¬ï¼Œå½“æ–°ç‰ˆæœ¬è¯•è¿è¡Œä¸€æ®µæ—¶é—´æ²¡æœ‰é—®é¢˜åï¼Œå°†ç”¨æˆ·çš„å…¨é‡æµé‡ä»è€ç‰ˆæœ¬è¿ç§»è‡³æ–°ç‰ˆæœ¬ã€‚
é€šè¿‡æœ¬å®éªŒï¼Œä½ å°†å­¦ä¹ ï¼š
é€šè¿‡ Ingress æŒ‰æƒé‡è¿›è¡Œç°åº¦å‘å¸ƒ é€šè¿‡ Ingress æŒ‰ Header è¿›è¡Œç°åº¦å‘å¸ƒ å®¹å™¨æœåŠ¡ Kubernetes ç‰ˆï¼ˆç®€ç§° ACKï¼‰ æœ¬èŠ‚è¯¾ä½¿ç”¨çš„ Kubernetes(k8s) é›†ç¾¤å°±æ˜¯ç”± ACK æä¾›çš„ï¼Œæœ¬å®éªŒæ¶µç›–çš„éƒ½æ˜¯ä¸€äº›åŸºæœ¬æ“ä½œã€‚æ›´å¤šé«˜çº§ç”¨æ³•ï¼Œå¯ä»¥å» ACK çš„äº§å“é¡µé¢äº†è§£å“¦ã€‚
Step 2 ï¼šéƒ¨ç½² Deployment V1 åº”ç”¨ # åˆ›å»ºå¦‚ä¸‹ YAML æ–‡ä»¶(app-v1.yaml)
apiVersion: v1 kind: Service metadata: name: my-app-v1 labels: app: my-app spec: ports: - name: http port: 80 targetPort: http selector: app: my-app version: v1.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/installation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/installation/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / å®‰è£… Kubernetes
å®‰è£… Kubernetes # Â« é€šè¿‡ Ingress è¿›è¡Œç°åº¦å‘å¸ƒ
Â» K3s</description></item><item><title/><link>https://blog.poneding.com/kubernetes/k3s/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/k3s/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / K3s
K3s # k3s æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ Kubernetes å‘è¡Œç‰ˆï¼Œä¸“ä¸ºç‰©è”ç½‘åŠè¾¹ç¼˜è®¡ç®—è®¾è®¡ã€‚
è¦æ±‚ # K3s æœ‰æœ›åœ¨å¤§å¤šæ•°ç°ä»£ Linux ç³»ç»Ÿä¸Šè¿è¡Œã€‚
è§„æ ¼è¦æ±‚ï¼š
CPU: 1 æ ¸ Memoryï¼š512M ç«¯å£è¦æ±‚ï¼š
K3s Server èŠ‚ç‚¹çš„å…¥ç«™è§„åˆ™å¦‚ä¸‹ï¼š
åè®® ç«¯å£ æº æè¿° TCP 6443 K3s agent èŠ‚ç‚¹ Kubernetes API Server UDP 8472 K3s server å’Œ agent èŠ‚ç‚¹ ä»…å¯¹ Flannel VXLAN éœ€è¦ UDP 51820 K3s server å’Œ agent èŠ‚ç‚¹ åªæœ‰ Flannel Wireguard åç«¯éœ€è¦ UDP 51821 K3s server å’Œ agent èŠ‚ç‚¹ åªæœ‰ä½¿ç”¨ IPv6 çš„ Flannel Wireguard åç«¯æ‰éœ€è¦ TCP 10250 K3s server å’Œ agent èŠ‚ç‚¹ Kubelet metrics TCP 2379-2380 K3s server èŠ‚ç‚¹ åªæœ‰åµŒå…¥å¼ etcd é«˜å¯ç”¨æ‰éœ€è¦ å¯åŠ¨ # curl -sfL https://rancher-mirror.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/k8s-deploy-coredns/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/k8s-deploy-coredns/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 K8séƒ¨ç½²coredns
Kubernetes 0-1 K8séƒ¨ç½²coredns # åœ¨K8sé›†ç¾¤æœªéƒ¨ç½²DNSä¹‹å‰ï¼ŒK8sä¸­è¿è¡Œçš„Podæ˜¯æ— æ³•è®¿é—®å¤–éƒ¨ç½‘ç»œçš„ï¼Œå› ä¸ºæ— æ³•å®ŒæˆåŸŸåè§£æã€‚
æ¯”å¦‚æˆ‘ä»¬è¿è¡Œä¸€ä¸ªbusyboxçš„Podï¼Œç„¶ååœ¨Podé‡Œé¢æ˜¯æ— æ³•pingé€šå¤–éƒ¨ç½‘ç»œçš„ï¼š
[root@k8s-master01 ~]# kubectl run -it --rm busybox --image=busybox sh If you don&amp;#39;t see a command prompt, try pressing enter. / # ping www.baidu.com ping: bad address &amp;#39;www.baidu.com&amp;#39; æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨K8sä¸­éƒ¨ç½²corednsè§£å†³è¿™ä¸€é—®é¢˜ã€‚
å‡†å¤‡coredns.yamlæ–‡ä»¶ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹ï¼š
apiVersion: v1 kind: ServiceAccount metadata: name: coredns namespace: kube-system labels: kubernetes.io/cluster-service: &amp;#34;true&amp;#34; addonmanager.kubernetes.io/mode: Reconcile --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: labels: kubernetes.io/bootstrapping: rbac-defaults addonmanager.kubernetes.io/mode: Reconcile name: system:coredns rules: - apiGroups: - &amp;#34;&amp;#34; resources: - endpoints - services - pods - namespaces verbs: - list - watch - apiGroups: - &amp;#34;&amp;#34; resources: - nodes verbs: - get --- apiVersion: rbac.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/k8s-deploy-dashboard/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/k8s-deploy-dashboard/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 K8séƒ¨ç½²Dashboard
Kubernetes 0-1 K8séƒ¨ç½²Dashboard # é¦–å…ˆä¸‹è½½éƒ¨ç½²çš„å¿…è¦æ–‡ä»¶ï¼š
wget https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended.yaml -O kube-dash.yaml --no-check-certificate é»˜è®¤Dashboardçš„Serviceç±»å‹æ˜¯ClusterIPï¼Œæˆ‘ä»¬é›†ç¾¤å¤–é¢ä¸æ–¹ä¾¿è®¿é—®ï¼Œæˆ‘ä»¬æœ€å¥½æ˜¯å°†Serviceç±»å‹ä¿®æ”¹ä¸ºNodePoartæˆ–LoadBalancerï¼ˆå‰ææ˜¯ä½ çš„é›†ç¾¤æ”¯æŒLoadBalancerï¼‰ï¼Œä»¥LoadBalancerä¸ºä¾‹ã€‚
ä¿®æ”¹æ–‡ä»¶kube-dash.yamlæ–‡ä»¶ï¼Œå°†kubernetes-dashboard Serviceéƒ¨åˆ†ä¿®æ”¹æˆå¦‚ä¸‹ï¼š
kind: Service apiVersion: v1 metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard namespace: kubernetes-dashboard spec: type: LoadBalancer ports: - port: 443 targetPort: 8443 selector: k8s-app: kubernetes-dashboard åˆ›å»ºkube-dash-admin-user.yamlæ–‡ä»¶:
vim kube-dash-admin-user.yaml å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š
apiVersion: v1 kind: ServiceAccount metadata: name: admin-user namespace: kubernetes-dashboard --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: admin-user roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - kind: ServiceAccount name: admin-user namespace: kubernetes-dashboard æ‰§è¡Œå‘½ä»¤ï¼š</description></item><item><title/><link>https://blog.poneding.com/kubernetes/k8s-deploy-efk/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/k8s-deploy-efk/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 K8séƒ¨ç½²EFK
Kubernetes 0-1 K8séƒ¨ç½²EFK # å†™åœ¨å‰é¢ # æœ¬ç¯‡ç›®æ ‡æ˜¯åœ¨K8sé›†ç¾¤ä¸­æ­å»ºEFKã€‚
EFKæ˜¯ç”±ElasticSearchï¼ŒFluentdï¼ŒKibaneç»„æˆçš„ä¸€å¥—ç›®å‰æ¯”è¾ƒä¸»æµçš„æ—¥å¿—ç›‘æ§ç³»ç»Ÿï¼Œä½¿ç”¨EFKç›‘æ§åº”ç”¨æ—¥å¿—ï¼Œå¯ä»¥è®©å¼€å‘äººå‘˜åœ¨ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£æŸ¥çœ‹æ—¥å¿—ç„¶ååˆ†æåº”ç”¨è¿è¡Œæƒ…å†µã€‚
EFKç®€å•çš„å·¥ä½œåŸç†å¯ä»¥å‚è€ƒä¸‹å›¾ã€‚é€šè¿‡fluentdçš„agentæ”¶é›†æ—¥å¿—æ•°æ®ï¼Œå†™å…¥esï¼Œkibanaä»esä¸­è¯»å–æ—¥å¿—æ•°æ®å±•ç¤ºåˆ°uiã€‚
éƒ¨ç½²ElasticSearch # æœ€å¥½é€‰æ‹©éƒ¨ç½²ä¸€ä¸ªESé›†ç¾¤ï¼Œè¿™æ ·ä½ çš„ESå¯ç”¨æ€§æ›´é«˜ä¸€ç‚¹ã€‚
é‡‡ç”¨StatefulSetéƒ¨ç½²ESã€‚
ç¼–å†™es-statefulSet.yamlæ–‡ä»¶å¦‚ä¸‹ï¼š
apiVersion: apps/v1 kind: StatefulSet metadata: name: es-cluster namespace: dev spec: serviceName: elasticsearch replicas: 3 selector: matchLabels: app: elasticsearch template: metadata: labels: app: elasticsearch spec: containers: - name: elasticsearch image: docker.elastic.co/elasticsearch/elasticsearch:7.7.0 resources: limits: cpu: 1000m requests: cpu: 100m ports: - containerPort: 9200 name: rest protocol: TCP - containerPort: 9300 name: inter-node protocol: TCP volumeMounts: - name: data mountPath: /usr/share/elasticsearch/data env: - name: cluster.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/k8s-deploy-prometheus-grafana/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/k8s-deploy-prometheus-grafana/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / å¯èƒ½éœ€è¦è¿è¡Œå¤šæ¬¡ä»¥ä¸‹å‘½ä»¤ï¼Œç¡®ä¿k8sèµ„æºéƒ½åˆ›å»º
Step # ä¸‹è½½ç›¸å…³k8sèµ„æºæ–‡ä»¶ git clone https://github.com/coreos/kube-prometheus.git ä¿®æ”¹æ–‡ä»¶kube-prometheus/manifests/prometheus-prometheus.yamlï¼Œåšè¿™ä¸€æ­¥çš„ç›®çš„æ˜¯ä¸ºprometheusçš„è®¿é—®åˆ†é…å­è·¯å¾„ï¼Œè®¿é—®æ–¹å¼ä¸ºhttp(s)://xxx/prometheus
åœ¨prometheus.specä¸‹æ·»åŠ 
externalUrl: prometheus routePrefix: prometheus ä¿®æ”¹æ–‡ä»¶kube-prometheus/manifests/grafana-deployment.yamlï¼Œåšè¿™ä¸€æ­¥çš„ç›®çš„æ˜¯ä¸ºgrafanaçš„è®¿é—®åˆ†é…å­è·¯å¾„ï¼Œè®¿é—®æ–¹å¼ä¸ºï¼šhttp(s)://xxx/grafana
åœ¨deployment.spec.template.spec.container[0]ä¸‹æ·»åŠ 
env: - name: GF_SERVER_ROOT_URL value: &amp;#34;http://localhost:3000/grafana&amp;#34; - name: GF_SERVER_SERVE_FROM_SUB_PATH value: &amp;#34;true&amp;#34; Apply k8sèµ„æº # å¯èƒ½éœ€è¦è¿è¡Œå¤šæ¬¡ä»¥ä¸‹å‘½ä»¤ï¼Œç¡®ä¿k8sèµ„æºéƒ½åˆ›å»º kubectl create -f manifests/setup -f manifests # !å¦‚æœè¦åˆ é™¤ä»¥ä¸Šåˆ›å»ºçš„k8sèµ„æºï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ kubectl delete --ignore-not-found=true -f manifests/ -f manifests/setup Ingressè½¬å‘ apiVersion: extensions/v1beta1 kind: Ingress metadata: name: prometheus namespace: monitoring spec: rules: - host: dp.example.tech http: paths: - path: /prometheus backend: serviceName: prometheus-k8s servicePort: 9090 - path: /grafana backend: serviceName: grafana servicePort: 3000 - path: /alertmanager backend: serviceName: alertmanager-main servicePort: 9093 Â« Kubernetes 0-1 K8séƒ¨ç½²EFK</description></item><item><title/><link>https://blog.poneding.com/kubernetes/k8s-deploy-zookeeper-kafka/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/k8s-deploy-zookeeper-kafka/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 K8séƒ¨ç½²Zookeeperå’ŒKafka
Kubernetes 0-1 K8séƒ¨ç½²Zookeeperå’ŒKafka # æŒ‰ç…§å®˜æ–¹å®šä¹‰ï¼ŒKafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¤„ç†å¹³å°ã€‚æ›´å¤šäº†è§£å®˜æ–¹æ–‡æ¡£ï¼š http://kafka.apachecn.org/intro.html
é‚£ä¹ˆç›´æ¥å¼€å§‹åœ¨K8sä¸­éƒ¨ç½²kafkaå§ã€‚
éƒ¨ç½²kafkaï¼Œé¦–å…ˆè¦æœ‰ä¸€ä¸ªå¯ç”¨çš„Zookeeperé›†ç¾¤ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å…ˆéƒ¨ç½²ä¸€ä¸ªZookeeperé›†ç¾¤ã€‚
é¦–å…ˆè¯´æ˜ï¼Œæˆ‘çš„K8sé›†ç¾¤æ˜¯ä½¿ç”¨çš„AWSçš„EKSæœåŠ¡ï¼Œä¸è‡ªå»ºçš„K8sé›†ç¾¤çš„é…ç½®æ–¹é¢å¯èƒ½ä¼šæœ‰æ‰€å·®åˆ«ã€‚
éƒ¨ç½²Zookeeper # ç¼–å†™zookeeper-statefulSet.yamlæ–‡ä»¶ï¼š
vim zookeeper-statefulSet.yaml å†™å…¥å†…å®¹:
kind: StatefulSet apiVersion: apps/v1beta1 metadata: name: zookeeper-1 namespace: dev spec: serviceName: zookeeper-1 replicas: 1 selector: matchLabels: app: zookeeper-1 template: metadata: labels: app: zookeeper-1 spec: containers: - name: zookeeper image: digitalwonderland/zookeeper ports: - containerPort: 2181 env: - name: ZOOKEEPER_ID value: &amp;#34;1&amp;#34; - name: ZOOKEEPER_SERVER_1 value: zookeeper-1 - name: ZOOKEEPER_SERVER_2 value: zookeeper-2 - name: ZOOKEEPER_SERVER_3 value: zookeeper-3 volumeMounts: - name: zookeeper-data mountPath: &amp;#34;/var/lib/zookeeper/data&amp;#34; subPath: zookeeper volumeClaimTemplates: - metadata: name: zookeeper-data labels: app: zookeeper-1 spec: accessModes: [&amp;#34;ReadWriteOnce&amp;#34;] storageClassName: gp2 resources: requests: storage: 30Gi --- kind: StatefulSet apiVersion: apps/v1beta1 metadata: name: zookeeper-2 namespace: dev spec: serviceName: zookeeper-2 replicas: 1 selector: matchLabels: app: zookeeper-2 template: metadata: labels: app: zookeeper-2 spec: containers: - name: zookeeper image: digitalwonderland/zookeeper ports: - containerPort: 2181 env: - name: ZOOKEEPER_ID value: &amp;#34;2&amp;#34; - name: ZOOKEEPER_SERVER_1 value: zookeeper-1 - name: ZOOKEEPER_SERVER_2 value: zookeeper-2 - name: ZOOKEEPER_SERVER_3 value: zookeeper-3 volumeMounts: - name: zookeeper-data mountPath: &amp;#34;/var/lib/zookeeper/data&amp;#34; subPath: zookeeper-data volumeClaimTemplates: - metadata: name: zookeeper-data labels: app: zookeeper-2 spec: accessModes: [&amp;#34;ReadWriteOnce&amp;#34;] storageClassName: gp2 resources: requests: storage: 30Gi --- kind: StatefulSet apiVersion: apps/v1beta1 metadata: name: zookeeper-3 namespace: dev spec: serviceName: zookeeper-3 replicas: 1 selector: matchLabels: app: zookeeper-3 template: metadata: labels: app: zookeeper-3 spec: containers: - name: zookeeper image: digitalwonderland/zookeeper ports: - containerPort: 2181 env: - name: ZOOKEEPER_ID value: &amp;#34;3&amp;#34; - name: ZOOKEEPER_SERVER_1 value: zookeeper-1 - name: ZOOKEEPER_SERVER_2 value: zookeeper-2 - name: ZOOKEEPER_SERVER_3 value: zookeeper-3 volumeMounts: - name: zookeeper-data mountPath: &amp;#34;/var/lib/zookeeper/data&amp;#34; subPath: zookeeper volumeClaimTemplates: - metadata: name: zookeeper-data labels: app: zookeeper-3 spec: accessModes: [&amp;#34;ReadWriteOnce&amp;#34;] storageClassName: gp2 resources: requests: storage: 30Gi ç¼–å†™zookeeper-service.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/k8s-dev-01-api-concept/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/k8s-dev-01-api-concept/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ
Kubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ # åœ¨ K8s é›†ç¾¤ä¸­ï¼ŒAPI æ˜¯ä¸€åˆ‡çš„åŸºç¡€ï¼ŒK8s çš„æ‰€æœ‰èµ„æºå¯¹è±¡éƒ½æ˜¯é€šè¿‡ API æ¥ç®¡ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®šåˆ¶å¼€å‘çš„æ—¶å€™ï¼Œé¦–å…ˆè¦äº†è§£ K8s çš„ API æ¦‚å¿µã€‚
åŸºæœ¬æ¦‚å¿µ # Groupï¼ˆGï¼‰ï¼š
API ç»„ï¼Œä¾‹å¦‚ï¼šappsã€networking.k8s.io ç­‰
Versionï¼ˆVï¼‰ï¼š
API ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼šv1alpha1ã€v1ã€v2 ç­‰
Resourceï¼ˆRï¼‰ï¼š
API èµ„æºï¼Œä¾‹å¦‚ï¼špodsï¼Œconfigmaps ç­‰
Kindï¼ˆKï¼‰ï¼š
API ç±»å‹ï¼Œä¾‹å¦‚ï¼šDeploymentï¼ŒService ç­‰ é€šè¿‡ kubectl api-versions è·å–é›†ç¾¤ä¸­æ‰€æœ‰ API çš„ç‰ˆæœ¬åˆ—è¡¨ï¼š
$ kubectl api-versions acme.cert-manager.io/v1 admissionregistration.k8s.io/v1 apiextensions.k8s.io/v1 apiregistration.k8s.io/v1 apps/v1 authentication.k8s.io/v1 é€šè¿‡ kubectl api-resources å‘½ä»¤è·å–é›†ç¾¤æ‰€æœ‰ API çš„èµ„æºåˆ—è¡¨ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°èµ„æºçš„ç®€å†™åç§°ï¼Œç‰ˆæœ¬ä»¥åŠç±»å‹ï¼š
$ kubectl api-resources NAME SHORTNAMES APIVERSION NAMESPACED KIND bindings v1 true Binding componentstatuses cs v1 false ComponentStatus configmaps cm v1 true ConfigMap endpoints ep v1 true Endpoints events ev v1 true Event limitranges limits v1 true LimitRange namespaces ns v1 false Namespace nodes no v1 false Node API èµ„æºç«¯ç‚¹ # GVR ç«¯ç‚¹ï¼š</description></item><item><title/><link>https://blog.poneding.com/kubernetes/k8s-dev-02-crd/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/k8s-dev-02-crd/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes å®šåˆ¶å¼€å‘ 02ï¼šCRD
Kubernetes å®šåˆ¶å¼€å‘ 02ï¼šCRD # Â« Kubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ
Â» Kubernetes å®šåˆ¶å¼€å‘ 50ï¼šæ‰©å±•è°ƒåº¦å™¨</description></item><item><title/><link>https://blog.poneding.com/kubernetes/k8s-dev-50-extend-kube-scheduler/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/k8s-dev-50-extend-kube-scheduler/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes å®šåˆ¶å¼€å‘ 50ï¼šæ‰©å±•è°ƒåº¦å™¨
Kubernetes å®šåˆ¶å¼€å‘ 50ï¼šæ‰©å±•è°ƒåº¦å™¨ # ç®€ä»‹ # Kubernetes Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰æ˜¯ä¸€ä¸ªæ§åˆ¶é¢è¿›ç¨‹ï¼Œè´Ÿè´£å°† Pods æŒ‡æ´¾åˆ°èŠ‚ç‚¹ä¸Šã€‚è°ƒåº¦å™¨åŸºäºçº¦æŸå’Œå¯ç”¨èµ„æºä¸ºè°ƒåº¦é˜Ÿåˆ—ä¸­æ¯ä¸ª Pod ç¡®å®šå…¶å¯åˆæ³•æ”¾ç½®çš„èŠ‚ç‚¹ã€‚è°ƒåº¦å™¨ä¹‹åå¯¹æ‰€æœ‰åˆæ³•çš„èŠ‚ç‚¹è¿›è¡Œæ’åºï¼Œå°† Pod ç»‘å®šåˆ°ä¸€ä¸ªåˆé€‚çš„èŠ‚ç‚¹ã€‚
kube-scheduler æ˜¯ Kubernetes è‡ªå¸¦çš„ä¸€ä¸ªé»˜è®¤è°ƒåº¦å™¨ï¼Œå®ƒä¼šæ ¹æ® Pod çš„èµ„æºéœ€æ±‚å’ŒèŠ‚ç‚¹çš„èµ„æºå®¹é‡ï¼Œå°† Pod è°ƒåº¦åˆ°åˆé€‚çš„èŠ‚ç‚¹ä¸Šã€‚
å¦‚æœé»˜è®¤è°ƒåº¦å™¨ä¸ç¬¦åˆä½ çš„éœ€æ±‚ï¼Œä½ å¯ä»¥å®ç°è‡ªå·±çš„è°ƒåº¦å™¨ï¼Œå¹¶ä¸”ä½ çš„è°ƒåº¦å™¨å¯ä»¥å’Œé»˜è®¤è°ƒåº¦å™¨æˆ–å…¶ä»–è°ƒåº¦å™¨ä¸€èµ·è¿è¡Œåœ¨é›†ç¾¤ä¸­ã€‚ä½ å¯ä»¥é€šè¿‡å£°æ˜ Pod çš„ spec.schedulerName å­—æ®µæ¥æŒ‡å®šè¦ä½¿ç”¨çš„è°ƒåº¦å™¨ã€‚
æ‰©å±•è°ƒåº¦å™¨ # æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥å®ç°è‡ªå®šä¹‰è°ƒåº¦å™¨ï¼š
ä¿®æ”¹ kube-scheduler æºç è°ƒåº¦é€»è¾‘ï¼Œç„¶åç¼–è¯‘æˆå®šåˆ¶çš„è°ƒåº¦å™¨é•œåƒï¼Œç„¶åä½¿ç”¨è¿™ä¸ªé•œåƒéƒ¨ç½²è°ƒåº¦è¿›ç¨‹ è‡ªå®šä¹‰ Pod æ§åˆ¶å™¨ï¼Œç›‘å¬ Pod çš„ spec.schedulerName å­—æ®µï¼Œåœ¨ Pod è¢«åˆ›å»ºæ—¶ï¼Œä¸ºå…¶ç»‘å®šèŠ‚ç‚¹ ä½¿ç”¨ Scheduler Extender çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä¸éœ€è¦ä¿®æ”¹é»˜è®¤è°ƒåº¦å™¨çš„é…ç½®æ–‡ä»¶ ç¼–è¯‘å®šåˆ¶è°ƒåº¦å™¨é•œåƒ # å…‹éš† kubernetes æºç ï¼Œç„¶åä¿®æ”¹ kube-scheduler æºç ï¼Œç„¶åç¼–è¯‘æˆå®šåˆ¶çš„è°ƒåº¦å™¨é•œåƒã€‚
git clone https://github.com/kubernetes/kubernetes.git cd kubernetes # ä¿®æ”¹æºç  make ç¼–å†™ Dockerfileï¼š</description></item><item><title/><link>https://blog.poneding.com/kubernetes/k8s-get-started/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/k8s-get-started/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / ç®€å•ä»‹ç» K8s
ç®€å•ä»‹ç» K8s # ç®€ä»‹ # æˆ‘ä»¬çš„åº”ç”¨éƒ¨ç½²è¶‹åŠ¿ç”±å¤§å‹å•ä½“åº”ç”¨å‘å¾®æœåŠ¡æ¼”å˜ï¼Œå¾®æœåŠ¡åº”ç”¨ä¹‹é—´è§£è€¦ï¼Œå½¢æˆå¯è¢«ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²ã€å‡çº§ã€ä¼¸ç¼©çš„è½¯ä»¶å•å…ƒã€‚
å¦ä¸€æ–¹é¢å®¹å™¨æŠ€æœ¯ç”±äºå®ƒçš„è½»é‡çº§ï¼Œèµ„æºéš”ç¦»ï¼Œå¯ç§»æ¤ã€éƒ¨ç½²é«˜æ•ˆç­‰ç‰¹æ€§å¾—åˆ°äº†è¿…é€Ÿçš„å‘å±•å’Œæ™®åŠã€‚è¶Šæ¥è¶Šå¤šçš„åº”ç”¨é€‰æ‹©ä½¿ç”¨å®¹å™¨æ¥éƒ¨ç½²ï¼Œå¾®æœåŠ¡æ›´ä¸ä¾‹å¤–ã€‚
è¿™æ—¶ï¼Œä¾¿æœ‰äº†ç®¡ç†å¾®æœåŠ¡+å®¹å™¨çš„éœ€æ±‚ï¼ŒKubernetes å¼€å§‹å¤§æ”¾å¼‚å½©ã€‚
Kubernetes æ˜¯åŸºäºå®¹å™¨æŠ€æœ¯çš„æœåŠ¡å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼Œé€šè¿‡å®ƒï¼Œå¯ä»¥æ‰˜ç®¡æ•°é‡åºå¤§çš„åº”ç”¨é›†ï¼Œå¹¶ä¸”å†…ç½®å®Œå¤‡çš„é›†ç¾¤ç®¡ç†èƒ½åŠ›ï¼Œå®ƒæœ‰èƒ½åŠ›å¸®ä½ åšåˆ°è¿™äº›ï¼š
åº”ç”¨çš„å®¹å™¨åŒ–éƒ¨ç½²ã€å¥åº·æ£€æŸ¥ã€è‡ªæˆ‘ä¿®å¤ã€è‡ªåŠ¨ä¼¸ç¼©ã€æ»šåŠ¨æ›´æ–°ã€èµ„æºåˆ†é…ç­‰ æœåŠ¡çš„æ³¨å†Œã€å‘ç°ã€å‡è¡¡è´Ÿè½½ç­‰ Kubernetes å¯¹äºè¿ç»´å›¢é˜Ÿæ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¸®æ‰‹ï¼Œæ›´è‡ªåŠ¨åŒ–çš„éƒ¨ç½²å’Œç®¡ç†åº”ç”¨ï¼Œæ›´é«˜æ•ˆçš„åˆ©ç”¨ç¡¬ä»¶èµ„æºã€‚
åŸºæœ¬æ¦‚å¿µ # Kubernetes é›†ç¾¤ï¼Œåé¢ç®€ç§°ä¸ºK8sï¼Œä¸»è¦æ˜¯ç”±æ§åˆ¶èŠ‚ç‚¹ï¼ˆMasterï¼‰å’Œå·¥ä½œèŠ‚ç‚¹ï¼ˆNodeï¼‰ç»„æˆã€‚
åœ¨ Master èŠ‚ç‚¹ä¸­è¿è¡Œç€ä¸‰å¤§ç»„ä»¶ï¼škube-api-serverã€kube-controller-managerã€kube-schedulerï¼Œé€šå¸¸ä¹Ÿä¼šå°† etcd æ•°æ®åº“éƒ¨ç½²åœ¨ Master èŠ‚ç‚¹ã€‚
åœ¨ Node èŠ‚ç‚¹ä¸­ï¼Œä¹Ÿæ˜¯éœ€è¦éƒ¨ç½²ä¸‰ä¸ªä¸»è¦ç»„ä»¶ï¼Œå®¹å™¨å¼•æ“ï¼ˆåŸºæœ¬é»˜è®¤ docker äº†ï¼‰ã€kubeletã€kube-proxyã€‚
K8s çš„ç»„æˆç»“æ„å¤§è‡´å¦‚ä¸‹å›¾ï¼š
Master èŠ‚ç‚¹ # è´Ÿè´£ K8s èµ„æºçš„è°ƒåº¦ç®¡ç†ï¼Œç”± Master å‘ Node ä¸‹è¾¾æ§åˆ¶å‘½ä»¤ï¼Œå¹¶ä¸”ä¸€èˆ¬è¿ç»´äººå‘˜ä½¿ç”¨ Master æ“ä½œå’Œæ‰§è¡Œå‘½ä»¤ã€‚
Master èŠ‚ç‚¹æ‰®æ¼”çš„è§’è‰²ç›¸å½“äº K8s çš„å¤§è„‘ï¼Œå…¶é‡è¦æ€§å¯æƒ³è€ŒçŸ¥ï¼Œå› æ­¤å»ºè®®éƒ¨ç½² 3 å° Master èŠ‚ç‚¹ä¿è¯ K8s çš„é«˜å¯ç”¨æ€§ã€‚
kube-api-serverï¼šhttp rest æ¥å£æœåŠ¡ï¼Œä¸ K8s å…¶ä»–ç»„ä»¶é€šä¿¡ï¼Œè´Ÿè´£ K8s èµ„æºçš„ CURD çš„æ“ä½œå…¥å£ï¼›</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kubeadm-install-k8s-docker/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kubeadm-install-k8s-docker/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / kubeadm å®‰è£… Kubernetes (Docker)
kubeadm å®‰è£… Kubernetes (Docker) # ä½¿ç”¨ kubeadm å®‰è£… k8s é›†ç¾¤ï¼Œæ˜¯ç¤¾åŒºæ¨èçš„å®‰è£…æ–¹å¼ï¼Œæœ¬æ–‡æ¡£å°†ä»‹ç»ä½¿ç”¨ kubeadm å®‰è£… k8s é›†ç¾¤ï¼ˆä½¿ç”¨ Docker ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼‰çš„è¯¦ç»†è¿‡ç¨‹ã€‚
Notes:
éšç€ kubeadm &amp;amp; k8s ç‰ˆæœ¬çš„æ›´æ–°ï¼Œå®‰è£…è¿‡ç¨‹å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œæˆªè‡³ç›®å‰ï¼Œæœ¬æ–‡æ¡£ä½¿ç”¨çš„æ˜¯ kubeadm v1.32.2 &amp;amp; k8s v1.32.2 ç‰ˆæœ¬ï¼› æœ¬æ–‡æ¡£ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿæ˜¯ Ubuntu 22.04ï¼Œå…¶ä»–æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ è¦æ±‚ # è‡³å°‘ä¸€å°ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼ˆä¾‹å¦‚ï¼šUbuntu 22.04ï¼‰ä½œä¸ºé›†ç¾¤èŠ‚ç‚¹ï¼Œæœ€å°‘ 2 æ ¸ 2G å†…å­˜ï¼› å¤šèŠ‚ç‚¹ä¹‹å‰ç½‘ç»œäº’é€šï¼Œä¸”èŠ‚ç‚¹ä¸»æœºåä¸å†²çªï¼› Master èŠ‚ç‚¹éœ€è¦å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š6443ã€2379-2380ã€10250ã€10251ã€10252ï¼› å‡†å¤‡å·¥ä½œ # ç¦ç”¨äº¤æ¢åˆ†åŒºï¼š
# ä¸´æ—¶ç¦ç”¨äº¤æ¢åˆ†åŒº sudo swapoff -a vim /etc/fstab # æ³¨é‡Šæ‰ swap åˆ†åŒºçš„é…ç½® é…ç½®ç³»ç»Ÿï¼š
cat &amp;lt;&amp;lt;EOF | sudo tee /etc/modules-load.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kubeadm-install-k8s/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kubeadm-install-k8s/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / kubeadm å®‰è£… k8s (containerd)
kubeadm å®‰è£… k8s (containerd) # ä½¿ç”¨ kubeadm å®‰è£… k8s é›†ç¾¤ï¼Œæ˜¯ç¤¾åŒºæ¨èçš„å®‰è£…æ–¹å¼ï¼Œæœ¬æ–‡æ¡£å°†ä»‹ç»ä½¿ç”¨ kubeadm å®‰è£… k8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ã€‚
Notes:
éšç€ kubeadm &amp;amp; k8s ç‰ˆæœ¬çš„æ›´æ–°ï¼Œå®‰è£…è¿‡ç¨‹å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œæˆªè‡³ç›®å‰ï¼Œæœ¬æ–‡æ¡£ä½¿ç”¨çš„æ˜¯ kubeadm v1.28.3 &amp;amp; k8s v1.28.3 ç‰ˆæœ¬ï¼› æœ¬æ–‡æ¡£ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿæ˜¯ Ubuntu 22.04ï¼Œå…¶ä»–æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ è¦æ±‚ # è‡³å°‘ä¸€å°ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼ˆä¾‹å¦‚ï¼šUbuntu 22.04ï¼‰ä½œä¸ºé›†ç¾¤èŠ‚ç‚¹ï¼Œæœ€å°‘ 2 æ ¸ 2G å†…å­˜ï¼› å¤šèŠ‚ç‚¹ä¹‹å‰ç½‘ç»œäº’é€šï¼Œä¸”èŠ‚ç‚¹ä¸»æœºåä¸å†²çªï¼› Master èŠ‚ç‚¹éœ€è¦å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š6443ã€2379-2380ã€10250ã€10251ã€10252ï¼› å‡†å¤‡å·¥ä½œ # ç¦ç”¨äº¤æ¢åˆ†åŒºï¼š
# ä¸´æ—¶ç¦ç”¨äº¤æ¢åˆ†åŒº swapoff -a vim /etc/fstab # æ³¨é‡Šæ‰ swap åˆ†åŒºçš„é…ç½® é…ç½®ç³»ç»Ÿï¼š
cat &amp;lt;&amp;lt;EOF | sudo tee /etc/modules-load.d/k8s.conf overlay br_netfilter EOF modprobe overlay modprobe br_netfilter # sysctl params required by setup, params persist across reboots cat &amp;lt;&amp;lt;EOF | sudo tee /etc/sysctl.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kubeadm-renew-certs/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kubeadm-renew-certs/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / kubeadm æ›´æ–°è¯ä¹¦
kubeadm æ›´æ–°è¯ä¹¦ # æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ sudo kubeadm certs check-expiration å¦‚æœè¯ä¹¦è¿‡æœŸï¼Œå…ˆå¤‡ä»½è¯ä¹¦ï¼Œå†æ›´æ–° sudo cp -r /etc/kubernetes/pki /etc/kubernetes/pki.bak sudo cp /etc/kubernetes/admin.conf /etc/kubernetes/admin.conf.bak æ›´æ–°æ‰€æœ‰è¯ä¹¦ sudo kubeadm certs renew all æ£€æŸ¥è¯ä¹¦æ˜¯å¦æ›´æ–° sudo kubeadm certs check-expiration é‡å¯ kubernetes æ ¸å¿ƒç»„ä»¶ mkdir k8s_manifests.bak sudo mv /etc/kubernetes/manifests/* k8s_manifests.bak/ sudo mv k8s_manifests.bak/* /etc/kubernetes/manifests/ æ›´æ–° kubeconfig æ–‡ä»¶ sudo cp /etc/kubernetes/admin.conf ~/.kube/config æŸ¥çœ‹ kubernetes æ ¸å¿ƒç»„ä»¶è¿è¡Œæƒ…å†µ kubectl get pod -n kube-system Â« kubeadm å®‰è£… k8s (containerd)</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kubeadm-upgrade/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kubeadm-upgrade/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubeadm å‡çº§ K8s
Kubeadm å‡çº§ K8s # æœ¬ç¯‡ä»¥å‡çº§ 1.29.0ï¼ˆæ—§ç‰ˆæœ¬ï¼š1.28.x ï¼‰ ç‰ˆæœ¬ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•é€šè¿‡ kubeadm å·¥å…·æ¥å‡çº§ K8s é›†ç¾¤ã€‚
æ³¨æ„ï¼š
ä¸æ”¯æŒè·¨ä¸»ç‰ˆæœ¬å‡çº§ï¼Œå¦‚ 1.27.x å‡çº§åˆ° 1.29.xï¼Œä¸­é—´å¿…é¡»å…ˆå‡çº§åˆ° 1.28.x ä¸»ç‰ˆæœ¬æ›´æ–°å¿…é¡»å…ˆå‡çº§åˆ°æœ€æ–°çš„æ¬¡ç‰ˆæœ¬ï¼Œå¦‚ 1.28.3 å‡çº§åˆ° 1.28.4ï¼Œç„¶åå†å‡çº§åˆ° 1.29.x å‡çº§æ­¥éª¤ # æ§åˆ¶èŠ‚ç‚¹ï¼ˆcontrol plane nodeï¼‰å‡çº§ å·¥ä½œèŠ‚ç‚¹ï¼ˆworker nodeï¼‰å‡çº§ å‡çº§è¿‡ç¨‹ # 1ã€å‡çº§è‡³å½“å‰ä¸»ç‰ˆæœ¬çš„æœ€æ–°æ¬¡ç‰ˆæœ¬ # sudo apt update sudo apt-cache madison kubeadm ä»¥ä¸Šå‘½ä»¤åï¼Œå°†å¯ä»¥å¾—åˆ°ç±»ä¼¼å¦‚ä¸‹è¾“å‡ºï¼š
$ sudo apt-cache madison kubeadm kubeadm | 1.28.4-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb Packages kubeadm | 1.28.3-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb Packages kubeadm | 1.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kubebuilder-inaction/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kubebuilder-inaction/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / kubebuilder å®æˆ˜
kubebuilder å®æˆ˜ # ç®€ä»‹ # kubebuilder æ˜¯ä¸€ä¸ªæ„å»º Operatorï¼ˆCRD + Controllerï¼‰çš„æ¡†æ¶çš„å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„æ„å»ºä¸€ä¸ª Operator é¡¹ç›®ï¼Œå¹¶æä¾›äº†ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œä¾‹å¦‚ï¼šåˆ›å»º APIã€åˆ›å»º Controllerã€Webhook ç­‰ã€‚
å®‰è£… # æ¡ä»¶ # kustomize curl -s &amp;#34;https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh&amp;#34; | bash controller-gen go install sigs.k8s.io/controller-tools/cmd/controller-gen@latest âš ï¸ æ³¨æ„ï¼šä»¥ä¸Šå‘½ä»¤éƒ½æ˜¯ç›´æ¥ä¸‹è½½äº†å¯¹åº”å‘½ä»¤å·¥å…·æœ€æ–°çš„ç‰ˆæœ¬ï¼Œåœ¨ä½¿ç”¨ kubebuilder åˆ›å»ºé¡¹ç›®ä¹‹åï¼Œåœ¨ Makefile æ–‡ä»¶ä¸­ä¼šæŒ‡å®š kustomize å’Œ controller-gen çš„ç‰ˆæœ¬ï¼Œä¸ºäº†é¿å…ä¸å…¼å®¹ï¼Œæ¨èä¸‹è½½å¯¹åº”æŒ‡å®šçš„ç‰ˆæœ¬ã€‚
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… kubebuilderï¼š
# download kubebuilder and install locally. GOOS=$(go env GOOS) GOARCH=$(go env GOARCH) curl -L -o kubebuilder https://go.kubebuilder.io/dl/latest/$GOOS/$GOARCH chmod +x kubebuilder &amp;amp;&amp;amp; mv kubebuilder /usr/local/bin/ ä»£ç è‡ªåŠ¨è¡¥å…¨ï¼š</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kubectl/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kubectl/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / kubectl
kubectl # å®‰è£… # å‚è€ƒæ–‡æ¡£ï¼š kubectl å®‰è£…æ–‡æ¡£
å¸¸ç”¨å‘½ä»¤ # è‡ªåŠ¨è¡¥å…¨ # source &amp;lt;(kubectl completion bash) å¯ä»¥å°†ä¸Šé¢çš„å‘½ä»¤å†™å…¥ ~/.bashrc æˆ– /etc/bash.bashrc ä¸­ï¼Œè¿™æ ·æ¯æ¬¡ç™»å½•éƒ½ä¼šè‡ªåŠ¨è¡¥å…¨ã€‚
$ vim ~/.bashrc ... source &amp;lt;(kubectl completion bash) å‘½ä»¤åˆ«å # alias k=kubectl complete -F __start_kubectl k Troubleshooting # Q1. _get_comp_words_by_ref: command not found # è§£å†³æ–¹æ³•ï¼š
apt install bash-completion -y source /usr/share/bash-completion/bash_completion source &amp;lt;(kubectl completion bash) Â« kubebuilder å®æˆ˜
Â» Kubernetes 0-1 Kubernetesæœ€ä½³å®è·µ</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kubernetes-best-practice/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kubernetes-best-practice/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 Kubernetesæœ€ä½³å®è·µ
Kubernetes 0-1 Kubernetesæœ€ä½³å®è·µ # https://github.com/learnk8s/kubernetes-production-best-practices
Â« kubectl
Â» Kubernetes Dashboard</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kubernetes-dashboard/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kubernetes-dashboard/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes Dashboard
Kubernetes Dashboard # Installation # Steps # ç™»å…¥Kubernetes Masteræœºå™¨ã€‚
Copyæœ€æ–°çš„recommended.yamlæ–‡ä»¶å†…å®¹ï¼Œå†™å…¥æœ¬åœ°kubernetes-dashboard.yamlæ–‡ä»¶ã€‚recommended.yamlæ–‡ä»¶åœ°å€ï¼š kubernetes dashboard github
![image-20191223173827866](
C:\Users\dp\AppData\Roaming\Typora\typora-user-images\image-20191223173827866.png)
# Copyright 2017 The Kubernetes Authors. # # Licensed under the Apache License, Version 2.0 (the &amp;#34;License&amp;#34;); # you may not use this file except in compliance with the License. # You may obtain a copy of the License at # # http://www.apache.org/licenses/LICENSE-2.0 # # Unless required by applicable law or agreed to in writing, software # distributed under the License is distributed on an &amp;#34;AS IS&amp;#34; BASIS, # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kubernetes-naming-constraints/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kubernetes-naming-constraints/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes ä¸­èµ„æºåç§°è§„èŒƒ
Kubernetes ä¸­èµ„æºåç§°è§„èŒƒ # åœ¨Kubernetesä¸­ï¼ŒåŒä¸€ç§èµ„æºï¼ˆGVRï¼‰åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ä¸‹åç§°æ˜¯å”¯ä¸€ã€‚ä½†æ˜¯åç§°ä¹Ÿéœ€è¦éµå¾ªå‘½åè§„åˆ™ã€‚æœ¬ç¯‡ä¸»è¦ä»‹ç» Kubernetes ä¸­ä¸‰ç§èµ„æºåç§°çš„å‘½åè§„èŒƒã€‚
DNS1123Subdomain # ä¸èƒ½è¶…è¿‡ 253 ä¸ªå­—ç¬¦ åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ï¼Œä»¥åŠ &amp;lsquo;-&amp;rsquo; å’Œ &amp;lsquo;.&amp;rsquo; å¿…é¡»ä»¥å­—æ¯æ•°å­—å¼€å¤´ å¿…é¡»ä»¥å­—æ¯æ•°å­—ç»“å°¾ ä»¥æ­¤è§„èŒƒçº¦æŸçš„èµ„æºæœ‰ï¼š
Ingress Pod ConfigMap NetworkPolicy DNS1123Label # æœ€å¤š 63 ä¸ªå­—ç¬¦ åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ï¼Œä»¥åŠ &amp;lsquo;-&amp;rsquo; å¿…é¡»ä»¥å­—æ¯æ•°å­—å¼€å¤´ å¿…é¡»ä»¥å­—æ¯æ•°å­—ç»“å°¾ ä»¥æ­¤è§„èŒƒçº¦æŸçš„èµ„æºæœ‰ï¼š
Namespace Service DNS1035Label # æœ€å¤š 63 ä¸ªå­—ç¬¦ åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ï¼Œä»¥åŠ &amp;lsquo;-&amp;rsquo; å¿…é¡»ä»¥å­—æ¯å¼€å¤´ å¿…é¡»ä»¥å­—æ¯æ•°å­—ç»“å°¾ ä»¥æ­¤è§„èŒƒçº¦æŸçš„èµ„æºæœ‰ï¼š
Deployment StatefulSet å»ºè®® # å¦‚æœèµ„æºå‘½åç¬¦åˆ DNS1035Label è§„èŒƒï¼Œé‚£ä¹ˆä¸€å®šç¬¦åˆ Kubernetes èµ„æºå‘½åè§„èŒƒã€‚å‡å¦‚åœ¨å®¹å™¨å¹³å°å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†å‘½åçº¦æŸæ›´åŠ ç»Ÿä¸€ï¼Œå»ºè®®ä½¿ç”¨ DNS1035Label è§„èŒƒæ¥çº¦æŸèµ„æºå‘½åã€‚
å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼ˆGoï¼‰æ¥æ£€æŸ¥èµ„æºåç§°æ˜¯å¦ç¬¦åˆè§„èŒƒï¼š
å¼•å…¥åŒ…ï¼š
go get k8s.io/apimachinery/pkg/util/validation ç¤ºä¾‹ä»£ç ï¼š
package main import ( &amp;#34;k8s.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kubernetes/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kubernetes/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kuberentes
Kuberentes # Â« Kubernetes ä¸­èµ„æºåç§°è§„èŒƒ
Â» KubeVirt åˆ›å»º Windows è™šæ‹Ÿæœº</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kubevirt-create-windows-vm/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kubevirt-create-windows-vm/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / KubeVirt åˆ›å»º Windows è™šæ‹Ÿæœº
KubeVirt åˆ›å»º Windows è™šæ‹Ÿæœº # virtctl image-upload --image-path windows-10.iso --pvc-name=windows-10-iso --size 10G --uploadproxy-url https://&amp;lt;cdi-uploadproxy.cdi.svc&amp;gt; --insecure --wait-secs 240 apiVersion: v1 kind: PersistentVolumeClaim metadata: name: windows-10-data spec: accessModes: - ReadWriteOnce resources: requests: storage: 40G storageClassName: longhorn volumeMode: Filesystem --- apiVersion: kubevirt.io/v1 kind: VirtualMachine metadata: name: windows-10 spec: running: true template: metadata: labels: kubevirt.io/domain: windows-10 spec: domain: cpu: cores: 4 devices: networkInterfaceMultiqueue: true #å¼€å¯ç½‘å¡å¤šé˜Ÿåˆ—æ¨¡å¼ blockMultiQueue: true #å¼€å¯ç£ç›˜å¤šé˜Ÿåˆ—æ¨¡å¼ disks: - cdrom: bus: sata name: virtiocontainerdisk - cdrom: bus: sata name: cdromiso bootOrder: 1 - disk: bus: virtio name: harddrive bootOrder: 2 interfaces: - masquerade: {} model: virtio name: default resources: requests: memory: 8G networks: - name: default pod: {} volumes: - name: cdromiso persistentVolumeClaim: claimName: windows-10-iso - name: harddrive persistentVolumeClaim: claimName: windows-10-data - containerDisk: image: kubevirt/virtio-container-disk name: virtiocontainerdisk å‚è€ƒï¼š</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kubevirt-practice/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kubevirt-practice/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubevirt å®è·µ
Kubevirt å®è·µ # ç®€ä»‹ # Kubevirt æ˜¯ Redhat å¼€æºçš„ä»¥å®¹å™¨æ–¹å¼è¿è¡Œè™šæ‹Ÿæœºçš„é¡¹ç›®ï¼Œä»¥ k8s add-on æ–¹å¼ï¼Œåˆ©ç”¨ k8s CRD ä¸ºå¢åŠ èµ„æºç±»å‹ VirtualMachineInstanceï¼ˆVMIï¼‰ï¼Œ ä½¿ç”¨å®¹å™¨çš„ image registry å»åˆ›å»ºè™šæ‹Ÿæœºå¹¶æä¾› VM ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ CRD çš„æ–¹å¼ä½¿å¾— kubevirt å¯¹è™šæ‹Ÿæœºçš„ç®¡ç†ä¸å±€é™äº pod ç®¡ç†æ¥å£ï¼Œä½†æ˜¯ä¹Ÿæ— æ³•ä½¿ç”¨ pod çš„ RS DS Deployment ç­‰ç®¡ç†èƒ½åŠ›ï¼Œä¹Ÿæ„å‘³ç€ kubevirt å¦‚æœæƒ³è¦åˆ©ç”¨ pod ç®¡ç†èƒ½åŠ›ï¼Œè¦è‡ªä¸»å»å®ç°ï¼Œç›®å‰ kubevirt å®ç°äº†ç±»ä¼¼ RS çš„åŠŸèƒ½ã€‚ kubevirt ç›®å‰æ”¯æŒçš„ runtime æ˜¯ docker å’Œ runcã€‚
å®‰è£… # éƒ¨ç½² K8s èµ„æº # æœ€æ–°ç‰ˆæœ¬ export KUBEVIRT_VERSION=$(curl -s https://api.github.com/repos/kubevirt/kubevirt/releases/latest | jq -r .</description></item><item><title/><link>https://blog.poneding.com/kubernetes/kustomize/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/kustomize/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kustomize
Kustomize # Kustomize æ˜¯ä¸€ä¸ªé€šè¿‡ kustomization æ–‡ä»¶ å®šåˆ¶ Kubernetes å¯¹è±¡çš„å·¥å…·ã€‚å®ƒæä¾›ä»¥ä¸‹åŠŸèƒ½ç‰¹æ€§æ¥ç®¡ç†åº”ç”¨é…ç½®æ–‡ä»¶ï¼š
ä»å…¶ä»–æ¥æºç”Ÿæˆèµ„æº ä¸ºèµ„æºè®¾ç½®è´¯ç©¿æ€§ï¼ˆCross-Cuttingï¼‰å­—æ®µ ç»„ç»‡å’Œå®šåˆ¶èµ„æºé›†åˆ ä» 1.14 ç‰ˆæœ¬å¼€å§‹ï¼Œkubectl ä¹Ÿå¼€å§‹æ”¯æŒä½¿ç”¨ kustomization æ–‡ä»¶æ¥ç®¡ç† Kubernetes å¯¹è±¡ã€‚ è¦æŸ¥çœ‹åŒ…å« kustomization æ–‡ä»¶çš„ç›®å½•ä¸­çš„èµ„æºï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š
kubectl kustomize &amp;lt;kustomization_directory&amp;gt; è¦åº”ç”¨è¿™äº›èµ„æºï¼Œä½¿ç”¨ --kustomize æˆ– -k å‚æ•°æ¥æ‰§è¡Œ kubectl applyï¼š
kubectl apply -k &amp;lt;kustomization_directory&amp;gt; ç”Ÿæˆèµ„æº # ConfigMap å’Œ Secret åŒ…å«å…¶ä»– Kubernetes å¯¹è±¡ï¼ˆå¦‚ Podï¼‰æ‰€éœ€è¦çš„é…ç½®æˆ–æ•æ„Ÿæ•°æ®ã€‚ ConfigMap æˆ– Secret ä¸­æ•°æ®çš„æ¥æºå¾€å¾€æ˜¯é›†ç¾¤å¤–éƒ¨ï¼Œä¾‹å¦‚æŸä¸ª .properties æ–‡ä»¶æˆ–è€… SSH å¯†é’¥æ–‡ä»¶ã€‚ Kustomize æä¾› secretGenerator å’Œ configMapGeneratorï¼Œå¯ä»¥åŸºäºæ–‡ä»¶æˆ–å­—é¢å€¼æ¥ç”Ÿæˆ Secret å’Œ ConfigMapã€‚
configMapGenerator # è¦åŸºäºæ–‡ä»¶æ¥ç”Ÿæˆ ConfigMapï¼Œå¯ä»¥åœ¨ configMapGenerator çš„ files åˆ—è¡¨ä¸­æ·»åŠ è¡¨é¡¹ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ ¹æ® .</description></item><item><title/><link>https://blog.poneding.com/kubernetes/liveness-readiness-probe/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/liveness-readiness-probe/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 Podä¸­çš„livenessProbeå’ŒreadinessProbeè§£è¯»
Kubernetes 0-1 Podä¸­çš„livenessProbeå’ŒreadinessProbeè§£è¯» # å†™åœ¨å‰é¢ # K8så¯¹Podçš„å¥åº·çŠ¶æ€å¯ä»¥é€šè¿‡ä¸¤ç±»æ¢é’ˆæ¥æ£€æŸ¥ï¼šlivenessProbeå’ŒreadinessProbeï¼Œkubeleté€šè¿‡å®šæœŸæ‰§è¡Œè¿™ä¸¤ç±»æ¢é’ˆæ¥è¯Šæ–­å®¹å™¨çš„å¥åº·çŠ¶å†µã€‚
livenessProbeç®€ä»‹ # å­˜æ´»æŒ‡é’ˆï¼Œåˆ¤æ–­Podï¼ˆä¸­çš„åº”ç”¨å®¹å™¨ï¼‰æ˜¯å¦å¥åº·ï¼Œå¯ä»¥ç†è§£ä¸ºå¥åº·æ£€æŸ¥ã€‚æˆ‘ä»¬ä½¿ç”¨livenessProbeæ¥å®šæœŸçš„å»æ¢æµ‹ï¼Œå¦‚æœæ¢æµ‹æˆåŠŸï¼Œåˆ™PodçŠ¶æ€å¯ä»¥åˆ¤å®šä¸ºRunningï¼›å¦‚æœæ¢æµ‹å¤±è´¥ï¼Œå¯kubectlä¼šæ ¹æ®Podçš„é‡å¯ç­–ç•¥æ¥é‡å¯å®¹å™¨ã€‚
å¦‚æœæœªç»™Podè®¾ç½®livenessProbeï¼Œåˆ™é»˜è®¤æ¢é’ˆæ°¸è¿œè¿”å›Successã€‚
å½“æˆ‘ä»¬æ‰§è¡Œkubectl get podså‘½ä»¤ï¼Œè¾“å‡ºä¿¡æ¯ä¸­STATUSä¸€åˆ—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Podæ˜¯å¦å¤„äºRunningçŠ¶æ€ã€‚
readinessProbeç®€ä»‹ # å°±ç»ªæŒ‡é’ˆï¼Œå°±ç»ªçš„æ„æ€æ˜¯å·²ç»å‡†å¤‡å¥½äº†ï¼ŒPodçš„å°±ç»ªæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºè¿™ä¸ªPodå¯ä»¥æ¥å—è¯·æ±‚å’Œè®¿é—®ã€‚æˆ‘ä»¬ä½¿ç”¨readinessProbeæ¥å®šæœŸçš„å»æ¢æµ‹ï¼Œå¦‚æœæ¢æµ‹æˆåŠŸï¼Œåˆ™Pod çš„ReadyçŠ¶æ€åˆ¤å®šä¸ºTrueï¼›å¦‚æœæ¢æµ‹å¤±è´¥ï¼ŒPodçš„ReadyçŠ¶æ€åˆ¤å®šä¸ºFalseã€‚
ä¸livenessProbeä¸åŒçš„æ˜¯ï¼Œkubeletä¸ä¼šå¯¹readinessProbeçš„æ¢æµ‹æƒ…å†µæœ‰é‡å¯æ“ä½œã€‚
å½“æˆ‘ä»¬æ‰§è¡Œkubectl get podså‘½ä»¤ï¼Œè¾“å‡ºä¿¡æ¯ä¸­READYä¸€åˆ—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Podçš„READYçŠ¶æ€æ˜¯å¦ä¸ºTrueã€‚
å®šä¹‰å‚æ•° # livenessProbeå’ŒreadinessProbeçš„å®šä¹‰å‚æ•°æ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥é€šè¿‡kubectl explain pods.spec.containers.readinessProbeæˆ–kubectl explain pods.spec.containers.livenessProbeå‘½ä»¤äº†è§£ï¼š
å°±ç»ªæ¢é’ˆçš„å‡ ç§ç±»å‹ï¼š
httpGetï¼š
å‘å®¹å™¨å‘é€Http Getè¯·æ±‚ï¼Œè°ƒç”¨æˆåŠŸï¼ˆé€šè¿‡HttpçŠ¶æ€ç åˆ¤æ–­ï¼‰åˆ™ç¡®å®šPodå°±ç»ªï¼›
ä½¿ç”¨æ–¹å¼ï¼š
livenessProbe: httpGet: path: /app/healthz port: 80 execï¼š
åœ¨å®¹å™¨å†…æ‰§è¡ŒæŸå‘½ä»¤ï¼Œå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼ˆé€šè¿‡å‘½ä»¤é€€å‡ºçŠ¶æ€ç ä¸º0åˆ¤æ–­ï¼‰åˆ™ç¡®å®šPodå°±ç»ªï¼›
ä½¿ç”¨æ–¹å¼ï¼š
livenessProbe: exec: command: - cat - /app/healthz tcpSocketï¼š
æ‰“å¼€ä¸€ä¸ªTCPè¿æ¥åˆ°å®¹å™¨çš„æŒ‡å®šç«¯å£ï¼Œè¿æ¥æˆåŠŸå»ºç«‹åˆ™ç¡®å®šPodå°±ç»ªã€‚
ä½¿ç”¨æ–¹å¼ï¼š
livenessProbe: tcpSocket: port: 80 ä¸€èˆ¬å°±ç»ªæ¢é’ˆä¼šåœ¨å¯åŠ¨å®¹å™¨ä¸€æ®µæ—¶é—´åæ‰å¼€å§‹ç¬¬ä¸€æ¬¡çš„å°±ç»ªæ¢æµ‹ï¼Œä¹‹ååšå‘¨æœŸæ€§æ¢æµ‹ã€‚æ‰€ä»¥åœ¨å®šä¹‰å°±ç»ªæŒ‡é’ˆæ—¶ï¼Œä¼šç»™ä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼š
initialDelaySecondsï¼šåœ¨åˆå§‹åŒ–å®¹å™¨å¤šå°‘ç§’åå¼€å§‹ç¬¬ä¸€æ¬¡å°±ç»ªæ¢æµ‹ï¼› timeoutSecondsï¼šå¦‚æœè¯¥æ¬¡å°±ç»ªæ¢æµ‹è¶…è¿‡å¤šå°‘ç§’åè¿˜æœªæˆåŠŸï¼Œåˆ¤å®šä¸ºè¶…æ—¶ï¼Œè¯¥æ¬¡æ¢æµ‹å¤±è´¥ï¼ŒPodä¸å°±ç»ªã€‚é»˜è®¤å€¼1ï¼Œæœ€å°å€¼1ï¼› periodSecondsï¼šå¦‚æœPodæœªå°±ç»ªï¼Œåˆ™æ¯éš”å¤šå°‘ç§’å‘¨æœŸæ€§çš„åšå°±ç»ªæ¢æµ‹ã€‚é»˜è®¤å€¼10ï¼Œæœ€å°å€¼1ï¼› failureThresholdï¼šå¦‚æœå®¹å™¨ä¹‹å‰æ¢æµ‹æˆåŠŸï¼Œåç»­è¿ç»­å‡ æ¬¡æ¢æµ‹å¤±è´¥ï¼Œåˆ™ç¡®å®šå®¹å™¨æœªå°±ç»ªã€‚é»˜è®¤å€¼3ï¼Œæœ€å°å€¼1ï¼› successThresholdï¼šå¦‚æœå®¹å™¨ä¹‹å‰æ¢æµ‹å¤±è´¥ï¼Œåç»­è¿ç»­å‡ æ¬¡æ¢æµ‹æˆåŠŸï¼Œåˆ™ç¡®å®šå®¹å™¨å°±ç»ªã€‚é»˜è®¤å€¼1ï¼Œæœ€å°å€¼1ã€‚ ä½¿ç”¨ç¤ºä¾‹ # ç›®å‰æˆ‘åœ¨docker hubæœ‰ä¸€ä¸ªæµ‹è¯•é•œåƒï¼šponeding/helloweb:v1ï¼Œå®¹å™¨å¯åŠ¨åï¼Œæœ‰ä¸€ä¸ªå¥åº·æ£€æŸ¥è·¯ç”±/healthz/return200ï¼Œè®¿é—®è¯¥è·¯ç”±çŠ¶æ€ç è¿”å›200ï¼›æœ‰ä¸€ä¸ªæ£€æŸ¥è·¯ç”±/health/return404ï¼Œè®¿é—®è¯¥è·¯ç”±çŠ¶æ€ç è¿”å›404ã€‚</description></item><item><title/><link>https://blog.poneding.com/kubernetes/local-storageclass/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/local-storageclass/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / local å­˜å‚¨å·å®è·µ
local å­˜å‚¨å·å®è·µ # åœ¨ Kubernetes ä¸­æœ‰ä¸€ç§å­˜å‚¨å·ç±»å‹ä¸º localã€‚
local å·æ‰€ä»£è¡¨çš„æ˜¯æŸä¸ªè¢«æŒ‚è½½çš„æœ¬åœ°å­˜å‚¨è®¾å¤‡ï¼Œä¾‹å¦‚ç£ç›˜ã€åˆ†åŒºæˆ–è€…ç›®å½•ã€‚
local å·åªèƒ½ç”¨ä½œé™æ€åˆ›å»ºçš„æŒä¹…å·ã€‚ä¸æ”¯æŒåŠ¨æ€é…ç½®ã€‚
ä¸ hostPath å·ç›¸æ¯”ï¼Œlocal å·èƒ½å¤Ÿä»¥æŒä¹…å’Œå¯ç§»æ¤çš„æ–¹å¼ä½¿ç”¨ï¼Œè€Œæ— éœ€æ‰‹åŠ¨å°† Pod è°ƒåº¦åˆ°èŠ‚ç‚¹ã€‚ç³»ç»Ÿé€šè¿‡æŸ¥çœ‹ PersistentVolume çš„èŠ‚ç‚¹äº²å’Œæ€§é…ç½®ï¼Œå°±èƒ½äº†è§£å·çš„èŠ‚ç‚¹çº¦æŸã€‚
ç„¶è€Œï¼Œlocal å·ä»ç„¶å–å†³äºåº•å±‚èŠ‚ç‚¹çš„å¯ç”¨æ€§ï¼Œå¹¶ä¸é€‚åˆæ‰€æœ‰åº”ç”¨ç¨‹åºã€‚ å¦‚æœèŠ‚ç‚¹å˜å¾—ä¸å¥åº·ï¼Œé‚£ä¹ˆ local å·ä¹Ÿå°†å˜å¾—ä¸å¯è¢« Pod è®¿é—®ã€‚ä½¿ç”¨å®ƒçš„ Pod å°†ä¸èƒ½è¿è¡Œã€‚ ä½¿ç”¨ local å·çš„åº”ç”¨ç¨‹åºå¿…é¡»èƒ½å¤Ÿå®¹å¿è¿™ç§å¯ç”¨æ€§çš„é™ä½ï¼Œä»¥åŠå› åº•å±‚ç£ç›˜çš„è€ç”¨æ€§ç‰¹å¾è€Œå¸¦æ¥çš„æ½œåœ¨çš„æ•°æ®ä¸¢å¤±é£é™©ã€‚
åˆ›å»º local-storage å­˜å‚¨ç±» # apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: local-storage provisioner: kubernetes.io/no-provisioner volumeBindingMode: WaitForFirstConsumer æ‰‹åŠ¨åˆ›å»º PV/PVC # 1ã€ä½¿ç”¨ local å·æ—¶ï¼Œä½ éœ€è¦è®¾ç½® PersistentVolume å¯¹è±¡çš„ nodeAffinity å­—æ®µã€‚ Kubernetes è°ƒåº¦ï¨¸ä½¿ç”¨ PersistentVolume çš„ nodeAffinity ä¿¡æ¯æ¥å°†ä½¿ç”¨ local å·çš„ Pod è°ƒåº¦åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ï¼›</description></item><item><title/><link>https://blog.poneding.com/kubernetes/metallb/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/metallb/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 K8sè‡ªå»ºLoadBalancer
Kubernetes 0-1 K8sè‡ªå»ºLoadBalancer # Metallbä»‹ç» # ä¸€èˆ¬åªæœ‰äº‘å¹³å°æ”¯æŒLoadBalancerï¼Œå¦‚æœè„±ç¦»äº‘å¹³å°ï¼Œè‡ªå·±æ­å»ºçš„K8sé›†ç¾¤ï¼ŒServiceçš„ç±»å‹ä½¿ç”¨LoadBalanceræ˜¯æ²¡æœ‰ä»»ä½•æ•ˆæœçš„ã€‚ä¸ºäº†è®©ç§æœ‰ç½‘ç»œä¸­çš„K8sé›†ç¾¤ä¹Ÿèƒ½ä½“éªŒåˆ°LoadBalabcerï¼ŒMetallbæˆä¸ºäº†è§£å†³æ–¹æ¡ˆã€‚
Metallbè¿è¡Œåœ¨K8sé›†ç¾¤ä¸­ï¼Œç›‘è§†é›†ç¾¤å†…LoadBalancerç±»å‹çš„æœåŠ¡ï¼Œç„¶åä»é…ç½®çš„IPæ± ä¸­ä¸ºå…¶åˆ†é…ä¸€ä¸ªå¯ç”¨IPï¼Œä»¥ARP/NDPæˆ–BGPçš„æ–¹å¼å°†å…¶å¹¿æ’­å‡ºå»ï¼Œè¿™ä¸ªå¯ç”¨IPæˆä¸ºäº†LoadBalancerçš„Urlï¼Œå¯ä¾›é›†ç¾¤å¤–è®¿é—®ã€‚
Metallbæ­å»ºè¿‡ç¨‹ # åˆ›å»ºå‘½åç©ºé—´ metallb-systemï¼š
vim metallb-namespace.yaml å†™å…¥æ–‡ä»¶å†…å®¹ï¼š
apiVersion: v1 kind: Namespace metadata: name: metallb-system ä¸‹è½½metallb.yamlæ–‡ä»¶
wget https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/metallb.yaml -O metallb.yaml --no-check-certificate å®šä¹‰LoadBalancerçš„IPæ± ï¼Œå…ˆåˆ›å»ºconfigmap
vim metallb-configMap.yaml å†™å…¥æ–‡ä»¶å†…å®¹ï¼š
apiVersion: v1 kind: ConfigMap metadata: namespace: metallb-system name: config data: config: | address-pools: - name: default protocol: layer2 addresses: - 192.168.115.140-192.168.115.199 æ³¨æ„ï¼šIPæ± çš„ç½‘ç»œéœ€è¦å’ŒK8sé›†ç¾¤çš„IPå¤„äºåŒä¸€ç½‘æ®µï¼Œæˆ‘çš„K8sé›†ç¾¤ç½‘ç»œæ˜¯192.168.115.13xï¼Œè¿™é‡ŒIPæ± åˆ™æ˜¯ç»™åˆ°192.168.115.140-192.168.115.199çš„èŒƒå›´ã€‚
æ‰§è¡Œå‘½ä»¤ï¼š
kubectl apply -f metallb-namespace.yaml kubectl create secret generic -n metallb-system memberlist --from-literal=secretkey=&amp;#34;$(openssl rand -base64 128)&amp;#34; kubectl apply -f metallb.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/nfs-as-pvc/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/nfs-as-pvc/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / ä½¿ç”¨ nfs æŒä¹…åŒ–å­˜å‚¨
ä½¿ç”¨ nfs æŒä¹…åŒ–å­˜å‚¨ # ä¸€èˆ¬äº‘å¹³å°éƒ½ä¼šæä¾›äº‘å­˜å‚¨æœåŠ¡ï¼Œå¦‚ AWS EBS æœåŠ¡ï¼ŒK8s å¯ä»¥ç›´æ¥ä½¿ç”¨äº‘å­˜å‚¨æœåŠ¡åˆ›å»º PV å’Œ PVC ä½œä¸º Volume çš„å­˜å‚¨åç«¯ã€‚å‡è®¾ä½ æ²¡æœ‰ä½¿ç”¨åˆ°äº‘å­˜å‚¨ï¼Œé‚£ä¹ˆ NFS å¯èƒ½ä¼šé€‚åˆä½ ã€‚
NFSï¼ˆNetwork File Systemï¼‰ï¼Œç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œå…è®¸è®¡ç®—æœºä¹‹é—´å…±äº«å­˜å‚¨èµ„æºï¼Œè¿™é‡Œä¹Ÿå°±ä¸å…·ä½“ä»‹ç»äº†ã€‚
éƒ¨ç½² nfs # ä»¥ä¸‹å‘½ä»¤éœ€è¦rootæƒé™ï¼Œç¤ºä¾‹ä¸­æœºå™¨IPä¸º192.168.115.137ã€‚
å®‰è£… nfsï¼š # Ubuntu &amp;amp; Debian apt install nfs-kernel-server -y # CentOS yum install nfs-util -y åˆ›å»ºå…±äº«ç›®å½•ï¼š mkdir /nfs/data -p ä¿®æ”¹ nfs çš„é»˜è®¤é…ç½®ï¼Œåœ¨æ–‡æœ«æ·»åŠ é…ç½®ï¼š vim /etc/exports /nfs/data *(rw,sync,no_root_squash) å…¶ä¸­ï¼š
/nfs/dataï¼šå…±äº«ç›®å½• *ï¼šå¯¹æ‰€æœ‰å¼€æ”¾è®¿é—®ï¼Œå¯ä»¥é…ç½®æˆç½‘æ®µï¼ŒIPï¼ŒåŸŸåç­‰ rwï¼šè¯»å†™æƒé™ syncï¼šæ–‡ä»¶åŒæ—¶å†™å…¥ç£ç›˜å’Œå†…å­˜ no_root_squashï¼šå½“ç™»å½• NFS ä¸»æœºä½¿ç”¨å…±äº«ç›®å½•çš„ä½¿ç”¨è€…æ˜¯ root æ—¶ï¼Œå…¶æƒé™å°†è¢«è½¬æ¢æˆä¸ºåŒ¿åä½¿ç”¨è€…ï¼Œé€šå¸¸å®ƒçš„ UID ä¸ GIDï¼Œéƒ½ä¼šå˜æˆ nobody èº«ä»½ é‡å¯ rpcï¼Œnfs éœ€è¦å‘ rpc æ³¨å†Œï¼š systemctl restart rpcbind.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/pod-understood/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/pod-understood/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 äº†è§£ Pod
Kubernetes 0-1 äº†è§£ Pod # Pod ä»‹ç» # Podï¼Œæ˜¯ K8s å¯¹è±¡æ¨¡å‹ä¸­çš„æœ€å°å•å…ƒï¼ŒPod é‡Œé¢åŒ…å«ç€ä¸€ç»„å®¹å™¨ï¼ˆå•ä¸ªå®¹å™¨æˆ–å¤šä¸ªç´§å¯†è€¦åˆçš„å®¹å™¨ï¼‰ï¼Œè¿™æ—¶å€™ Pod å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœºå™¨ï¼Œè€Œ Pod é‡Œé¢çš„å®¹å™¨åˆ™ç†è§£ä¸ºè¯¥æœºå™¨é‡Œé¢çš„è¿›ç¨‹ã€‚
Pod çš„å®¹å™¨è¿è¡Œæ—¶ç”±å®¹å™¨å¼•æ“æä¾›ï¼Œé»˜è®¤çš„å®¹å™¨å¼•æ“æ˜¯ Dockerï¼›å¹¶ä¸” K8s ç®¡ç†çš„æ˜¯ Podï¼Œè€Œä¸æ˜¯å®¹å™¨ã€‚
ä¸€ä¸ª Pod å†…éƒ¨çš„å®¹å™¨å…±äº«ï¼š
å­˜å‚¨ï¼šä¸€ä¸ª Pod å¯ä»¥æŒ‡å®šä¸€ç»„å…±äº«å­˜å‚¨å·ã€‚ ç½‘ç»œï¼šæ¯ä¸ª Pod åˆ†é…ä¸€ä¸ªå”¯ä¸€ IPï¼ˆé›†ç¾¤å†… IPï¼‰ï¼Œå…±äº«ç½‘ç»œå‘½åç©ºé—´ï¼ŒåŒ…æ‹¬ IP åœ°å€å’Œç½‘ç»œç«¯å£ã€‚Pod å†…çš„å®¹å™¨å¯ä»¥ä½¿ç”¨ localhost äº’ç›¸é€šä¿¡ï¼Œé›†ç¾¤å†… Pod ä¸ Podé€šä¿¡å¯ä»¥ä½¿ç”¨ Pod åˆ†é…çš„ IPï¼Œä½†æ˜¯ç”±äº Pod çš„ IP æ˜¯éšæœºåˆ†é…çš„ï¼Œè¿™ç§äº’é€šä¿¡çš„æ–¹å¼ä¸å¤ªé€‚åˆä½¿ç”¨ã€‚ å°½ç®¡ä¸€ä¸ª Pod å†…å¯ä»¥åŒ…å«å¤šä¸ª Podï¼Œä½†æˆ‘ä»¬åœ¨éƒ¨ç½²åº”ç”¨å®¹å™¨æ—¶çš„æœ€ä½³å®è·µæ˜¯ä¸€ä¸ª Pod é‡Œé¢åªåŒ…å«ä¸€ä¸ªåº”ç”¨å®¹å™¨ä½œä¸ºä¸»å®¹å™¨ï¼Œå…¶ä»–å®¹å™¨ä¸ºä¸»å®¹å™¨æœåŠ¡ï¼Œç§°ä¹‹ä¸ºè¾…åŠ©å®¹å™¨ã€‚ä¾‹å¦‚ä¸»å®¹å™¨å´©æºƒäº†ï¼Œä¼šæœ‰ä¸€ä¸ªè¾…åŠ©å®¹å™¨å»é‡å¯ä¸»å®¹å™¨ã€‚è¾…åŠ©å®¹å™¨å¯ä»¥æœ‰ä¹Ÿå¯ä»¥æ²¡æœ‰ï¼Œå› ä¸º Pod é‡Œé¢å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥è¢« Pod çš„ç”Ÿå‘½å‘¨æœŸå–ä»£ï¼Œè€Œ Pod çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥é€šè¿‡ Pod ç®¡ç†å™¨æ¥ç®¡ç†ç»´æŠ¤ã€‚</description></item><item><title/><link>https://blog.poneding.com/kubernetes/prgramming-kubernetes/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/prgramming-kubernetes/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes ç¼–ç¨‹
Kubernetes ç¼–ç¨‹ # å¼€å§‹ Kuberntes ç¼–ç¨‹ä¹‹æ—…ï½
mkdir programming-kubernetes &amp;amp;&amp;amp; cd programming-kubernetes git mod init programming-kubernetes å¸¸ç”¨åŒ…ï¼š
kubeconfig å¯¹åº”çš„ç»“æ„ clientcmdapi &amp;#34;k8s.io/client-go/tools/clientcmd/api&amp;#34; clientcmdapi.Config ç¼–å†™è‡ªå®šä¹‰ API # éšæœºç”Ÿæˆå­—ç¬¦ &amp;#34;k8s.io/apimachinery/pkg/util/rand&amp;#34; rand.String(5) å‚è€ƒï¼š
kubernetes/code-generator: Generators for kube-like API types (github.com)
code-generator ä½¿ç”¨
Bç«™ code-generator ä»‹ç»
mkdir hack vim hack/boilerplate.go.txt /* Copyright 2022 programming-kubernetes. Licensed under the Apache License, Version 2.0 (the &amp;#34;License&amp;#34;); you may not use this file except in compliance with the License.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/prometheus-collect-kong-metrics/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/prometheus-collect-kong-metrics/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Prometheus-ç›‘æ§Kongå®Œæ•´æ“ä½œ
Prometheus-ç›‘æ§Kongå®Œæ•´æ“ä½œ # æœ¬ç¯‡è®°å½•ä½¿ç”¨Prometheusæ”¶é›†Kongæš´éœ²çš„/metricsæ¥å£ï¼Œæ”¶é›†æŒ‡æ ‡æ•°æ®ï¼Œä»è€Œå®ç°å¯¹Kongçš„ç›‘æ§ã€‚
å…ˆå†³æ¡ä»¶ # Prometheuséƒ¨ç½²å®Œæˆï¼› Kongï¼ˆKong æœåŠ¡ï¼Œç«¯å£8000ï¼‰éƒ¨ç½²å®Œæˆï¼› Kong çš„Admin Apiï¼ˆç«¯å£8001ï¼‰éƒ¨ç½²å®Œæˆ Kongaï¼ˆKongçš„WebUIï¼Œç«¯å£1337ï¼‰éƒ¨ç½²å®Œæˆã€‚ Kongæ·»åŠ Prometheusæ’ä»¶ # ç™»å½•è¿›å…¥Kongaï¼› ç‚¹å‡»å³è¾¹èœå•æ â€PLUGINSâ€œï¼Œè¿›å…¥Pluginsç®¡ç†ï¼Œç‚¹å‡»â€œAnalytics &amp;amp; Monitoringâ€ï¼Œé€‰æ‹©æ·»åŠ Promethusæ’ä»¶ Kongæ·»åŠ metricsæ¥å£ # æˆ‘ä»¬çŸ¥é“Prometheusä¸»è¦é€šè¿‡è¯»å– http://host/metricsæ¥å£, æ¥æ”¶é›†ç›¸å…³æœåŠ¡çš„æ€§èƒ½æ•°æ®ï¼Œä½†æ˜¯Kongçš„metricsæ¥å£æœåŠ¡é»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆä¸ºKongæ·»åŠ /metricsã€‚
ç™»å½•è¿›å…¥Kongaï¼› ç‚¹å‡»å³è¾¹èœå•æ â€SERVICESâ€œï¼Œè¿›å…¥Servicesç®¡ç†ï¼Œç‚¹å‡»â€œADD NEW SERVICEâ€ æ·»åŠ é¡µé¢è¾“å…¥â€œNameâ€å’Œâ€œUrlâ€å‚æ•°å³å¯ï¼Œä¾‹å¦‚â€œNameâ€=â€œprometheusServiceâ€ï¼Œâ€œUrlâ€=â€œ http://localhost:8001/metricsâ€ æ·»åŠ å®ŒPrometheus Serviceä¹‹åï¼ŒServiceåˆ—è¡¨é€‰ä¸­å¹¶ç‚¹å‡»è¿›å…¥prometheusServiceï¼Œé€‰æ‹©â€Routesâ€œèœå•ï¼Œç‚¹å‡»â€œADD ROUTEâ€ æ·»åŠ é¡µé¢è¾“å…¥â€œPathsâ€å‚æ•°å³å¯ï¼Œä¾‹å¦‚â€œPathsâ€=[â€œ/metricsâ€]ï¼ˆPathå¿…é¡»ä»¥â€œ/â€ä¸ºé¦–ï¼‰ è¿™æ—¶å€™è®¿é—®â€œ http://localhost:8000/metricsâ€ï¼Œçœ‹åˆ°é¡µé¢å¦‚ä¸‹æ˜¾ç¤ºï¼Œè¯´æ˜å·²ç»æˆåŠŸçš„æ·»åŠ äº†metricsæ¥å£ Prometheusæ·»åŠ KongæŒ‡æ ‡æ”¶é›† # ä¿®æ”¹Prometheusé…ç½®æ–‡ä»¶ï¼Œprometheus.yml
scrape_configsé…ç½®é¡¹ä¸‹æ·»åŠ å¦‚ä¸‹é…ç½®
- job_name: &amp;#39;kong&amp;#39; scrape_interval: 5s static_configs: - targets: [&amp;#39;localhost:8000&amp;#39;] é…ç½®å®Œä¹‹åé‡å¯Prometheusï¼Œè®¿é—®â€œ http://localhost:9090/graphâ€
å¯ä»¥çœ‹åˆ°ä¸€å·²ç»ç”Ÿæˆäº†å¾ˆå¤škongçš„æŒ‡æ ‡é¡¹ï¼Œå¦‚httpè®¿é—®ï¼Œnginxå½“å‰è®¿é—®é‡ç­‰æŒ‡æ ‡
Â« Kubernetes ç¼–ç¨‹
Â» Prometheus</description></item><item><title/><link>https://blog.poneding.com/kubernetes/prometheus/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/prometheus/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Prometheus
Prometheus # Intro # æ˜¯ä¸€ä¸ªé¢å‘äº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„å¼€æºçš„ç›‘æ§&amp;amp;æŠ¥è­¦å·¥å…·ã€‚
å¼€æºï¼šç»§Kubernetesä¹‹åçš„ç¬¬äºŒä¸ªCNCFå¼€æºé¡¹ç›®ï¼ŒGoè¯­è¨€å¼€å‘ ç›‘æ§ï¼šé€šè¿‡HTTPæœåŠ¡å®šæ—¶ä»é…ç½®çš„ç›®æ ‡æ”¶é›†æŒ‡æ ‡æ•°æ®ï¼Œè¯†åˆ«æ•°æ®å±•ç¤ºè§„åˆ™ï¼Œå±•ç¤ºç›‘æ§ç³»ç»Ÿå’ŒæœåŠ¡æŒ‡æ ‡æ•°æ® æŠ¥è­¦ï¼šç›‘æ§åˆ°çš„æŒ‡æ ‡æ•°æ®è¾¾åˆ°æŸä¸€è®¾å®šå¥½çš„æ¡ä»¶æ—¶ï¼Œè§¦å‘æŠ¥è­¦æœºåˆ¶ æ—¶é—´åºåˆ—æ•°æ®åº“ï¼š æ—¶é—´åºåˆ—æ˜¯ç”±å”¯ä¸€çš„æŒ‡æ ‡åç§°ï¼ˆMetricsï¼‰å’Œä¸€ç»„æ ‡ç­¾ï¼ˆkey=valueï¼‰çš„å½¢å¼ç»„æˆ PromeQLï¼šåŸºäºPrometheusæ—¶é—´åºåˆ—æ•°æ®åº“çš„ä¸€ä¸ªçµæ´»çš„æŸ¥è¯¢è¯­è¨€ Prometheusçš„ç›‘æ§å¯¹è±¡ # èµ„æºç›‘æ§ï¼š
æœåŠ¡å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œåœ¨Kubernetesé›†ç¾¤ä¸­ï¼Œåˆ™å¯ä»¥åšåˆ°å¯¹Kubernetes Nodeã€ Deployment ã€Podçš„èµ„æºåˆ©ç”¨ä»¥åŠapiserverï¼Œcontroller-managerï¼Œetcdç­‰ç»„ä»¶çš„ç›‘æ§ã€‚
åº”ç”¨ç›‘æ§ï¼š
ä¸šåŠ¡åº”ç”¨æš´éœ²ç«¯å£ä¾›Prometheusè°ƒç”¨å®ç°ç›‘æµ‹ï¼Œæ¯”å¦‚å®æ—¶çš„ç”¨æˆ·åœ¨çº¿äººæ•°ï¼Œæ•°æ®åº“çš„å½“å‰è¿æ¥æ•°ç­‰ã€‚
Prometheusä¼˜åŠ¿ # æ”¯æŒæœºå™¨èµ„æºå’ŒåŠ¨æ€é…ç½®çš„åº”ç”¨ç›‘æ§ï¼› å¤šç»´æ•°æ®æ”¶é›†å’ŒæŸ¥è¯¢ï¼› æœåŠ¡ç‹¬ç«‹ï¼Œå°‘ä¾èµ–ã€‚ Prometheusç»„ä»¶ # Prometheus Serverï¼šé‡‡é›†ç›‘æ§æ•°æ®ï¼Œå­˜å‚¨æ—¶åºæŒ‡æ ‡ï¼Œæä¾›æ•°æ®æŸ¥è¯¢ï¼› Prometheus Client SDKï¼šå¯¹æ¥å¼€å‘å·¥å…·åŒ…ï¼Œæä¾›è‡ªå®šä¹‰çš„æŒ‡æ ‡æ•°æ®ç­‰ï¼› Push Gatewayï¼šæ¨é€æŒ‡æ ‡æ•°æ®çš„ç½‘å…³ç»„ä»¶ï¼› Third-part Exporterï¼šå¤–éƒ¨æŒ‡æ ‡é‡‡é›†ç³»ç»Ÿï¼Œæš´éœ²æ¥å£ä¾›Prometheusé‡‡é›†ï¼› AlertManagerï¼šæŒ‡æ ‡æ•°æ®çš„åˆ†æå‘Šè­¦ç®¡ç†å™¨ï¼› Architecture overview # ä¸Šå›¾æ¥æºäºå®˜ç½‘ï¼š
å¤„ç†æµç¨‹ï¼š é…ç½®èµ„æºç›®æ ‡æˆ–åº”ç”¨æŠ“å–ï¼› æŠ“å–èµ„æºæˆ–åº”ç”¨æŒ‡æ ‡æ•°æ®ï¼› åˆ¶å®šæŠ¥è­¦è§„åˆ™ï¼Œæ¨é€æŠ¥è­¦ï¼› çµæ´»æŸ¥è¯¢è¯­è¨€ï¼Œç»“åˆGrafanaå±•ç¤º Installation &amp;amp; Start Up # 1. ä»¥æœåŠ¡è¿›ç¨‹è¿è¡ŒPrometheus # åœ¨ubuntuç³»ç»Ÿä¸Šå®‰è£…Prometheusï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼
ç¬¬ä¸€ç§ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š
wget https://github.com/prometheus/prometheus/releases/download/v2.13.1/prometheus-2.13.1.linux-amd64.tar.gz tar xvfz prometheus-2.13.1.linux-amd64.tar.gz # å¯åŠ¨Prometheus cd prometheus-2.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/pvc-expansion/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/pvc-expansion/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / PVC æ‰©å®¹
PVC æ‰©å®¹ # K8s éƒ¨ç½²çš„ Kafka ç¨‹åºçªç„¶æŒ‚äº†ï¼ŒæŸ¥çœ‹ç›¸å…³æ—¥å¿—å‘ç°åŸæ¥æ˜¯æŒ‚æ—¥å¿—çš„ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œé‚£ä¹ˆç°åœ¨éœ€è¦å¯¹ç£ç›˜è¿›è¡Œæ‰©å®¹ã€‚
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œ PVC æ‰©å®¹çš„æ“ä½œï¼š
kubectl edit pvc &amp;lt;pvc-name&amp;gt; -n &amp;lt;namespace&amp;gt; æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç°ï¼Œæ— æ³•å¯¹è¯¥ PVC è¿›è¡ŒåŠ¨æ€æ‰©å®¹ï¼Œéœ€è¦åˆ†é… PVC å­˜å‚¨çš„ StorageClass æ”¯æŒåŠ¨æ€æ‰©å®¹ã€‚
é‚£ä¹ˆæ€ä¹ˆæ˜¯çš„ StorageClass æ”¯æŒåŠ¨æ€æ‰©å®¹å‘¢ï¼Œå¾ˆç®€å•ï¼Œæ›´æ–° StorageClass å³å¯ã€‚
kubectl edit storageclass &amp;lt;storageclass-name&amp;gt; æ·»åŠ å±æ€§ï¼š
allowVolumeExpansion: true # å…è®¸å·æ‰©å…… ä¹‹åå†æ¬¡æ‰§è¡Œ PVC æ‰©å®¹çš„æ“ä½œå³å¯ã€‚
Â« Prometheus
Â» äº†è§£ Secret</description></item><item><title/><link>https://blog.poneding.com/kubernetes/secret-understood/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/secret-understood/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / äº†è§£ Secret
äº†è§£ Secret # é€šå¸¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„é…ç½®éƒ½ä¼šåŒ…å«ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œè¯ä¹¦ï¼Œç§é’¥ç­‰ï¼Œä¸ºäº†ä¿è¯å…¶å®‰å…¨æ€§ï¼ŒK8s æä¾›äº† Secret èµ„æºå¯¹è±¡æ¥ä¿å­˜æ•æ„Ÿæ•°æ®ï¼Œå®ƒå’Œ CongfigMap ç±»ä¼¼ï¼Œä¹Ÿæ˜¯é”®å€¼å¯¹çš„æ˜ å°„ï¼Œå¹¶ä¸”ä½¿ç”¨æ–¹å¼ä¹Ÿå‡ ä¹ä¸€æ ·ã€‚
ä»‹ç» Secret # Secret ä¸­å­˜å‚¨ç€é”®å€¼å¯¹æ•°æ®ï¼Œå¯ä»¥
ä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ç»™å®¹å™¨ ä½œä¸ºæ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„ Volume Secret ä¼šå­˜å‚¨åœ¨ Pod æ‰€è°ƒåº¦çš„èŠ‚ç‚¹çš„å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯å†™å…¥ç£ç›˜ã€‚
Pod é»˜è®¤ç”Ÿæˆçš„ Secret # æ¯ä¸ª Pod éƒ½ä¼šè¢«è‡ªåŠ¨æŒ‚è½½ä¸€ä¸ª Secret å·ï¼Œåªéœ€è¦ä½¿ç”¨ kubectl desribe pod å‘½ä»¤å°±èƒ½çœ‹åˆ°ä¸€ä¸ªåç§°ç±»ä¼¼ default-token-n4q6m çš„ Secretï¼ŒSecret ä¹Ÿæ˜¯ä¸€ç§ K8s èµ„æºï¼Œæ‰€ä»¥ï¼Œå¯ä»¥ä½¿ç”¨ kubectl get secret æˆ– kubectl describe secret è·å–æŸ¥çœ‹ã€‚
ä»ä¸Šé¢å›¾ä¾‹å¯ä»¥çœ‹å‡ºï¼ŒPod é»˜è®¤ç”Ÿæˆçš„ Secret ä¼šåŒ…å«ä¸‰ä¸ªé…ç½®é¡¹ï¼šca.crtã€namespaceã€tokenã€‚å…¶å®è¿™ä¸‰ä¸ªé…ç½®é¡¹æ˜¯ Pod å†…éƒ¨å®‰å…¨è®¿é—®Kubernetes API æœåŠ¡çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè€Œåœ¨ kubectl describe pod çš„æ—¶å€™ï¼Œä½ å¯ä»¥çœ‹åˆ° Secret æ‰€æŒ‚è½½çš„å…·ä½“ç›®å½•åœ¨ /var/run/secrets/kubernetes.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/service-understood/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/service-understood/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / äº†è§£ Service
äº†è§£ Service # Service ä»‹ç» # æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„è¯´æ³•ï¼Œåœ¨ K8s ä¸­ï¼ŒService æ˜¯å°†è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„ä¸€ç»„ Pod çš„åº”ç”¨å…¬å¼€ä¸ºç½‘ç»œæœåŠ¡çš„æŠ½è±¡æ–¹æ³•ï¼Œæ˜¯ K8s çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ï¼ŒService çš„ä¸»è¦ä½œç”¨æ˜¯ä½¿å®¢æˆ·ç«¯å‘ç° Pod å¹¶ä¸ä¹‹é€šä¿¡ã€‚
ç®€å•ç†è§£èµ·æ¥å°±æ˜¯ï¼Œç”± Service æä¾›ç»Ÿä¸€çš„å…¥å£åœ°å€ï¼Œç„¶åå°†è¯·æ±‚è´Ÿè½½åˆ†å‘åˆ°åç«¯ Pod çš„å®¹å™¨åº”ç”¨ã€‚
ä¸ºä»€ä¹ˆæœ‰ Service # é›†ç¾¤ä¸­éƒ¨ç½²äº† Podï¼Œåº”ç”¨æ˜¯æˆåŠŸçš„éƒ¨ç½²èµ·æ¥äº†ï¼Œä½†æ˜¯åªæ˜¯è‡³æ­¤çš„è¯ï¼ŒPod æä¾›æœåŠ¡è®¿é—®å­˜åœ¨ä»¥ä¸‹ä¸€äº›é—®é¢˜ã€‚
Pod æ˜¯çŸ­æš‚çš„ï¼Œå¯èƒ½ä¼šè¢«é”€æ¯æˆ–é‡æ–°è°ƒåº¦ï¼Œè¿™ä½¿å¾— Pod çš„ IP æ˜¯éšæ—¶å˜åŠ¨å’Œæ›´æ–°çš„ï¼› éƒ¨ç½²å¤šä¸ª Pod çš„ä¼¸ç¼©é—®é¢˜ï¼Œæµé‡åˆ†é…é—®é¢˜ï¼› é›†ç¾¤å¤–éƒ¨å®¢æˆ·ç«¯æ— æ³•ç›´æ¥è®¿é—® Podã€‚ è¿™æ—¶å€™å°±éœ€è¦ Serviceï¼ŒPod ä½œä¸º Service çš„åç«¯æä¾›æœåŠ¡ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æƒ³è±¡ï¼ŒService éœ€è¦å®Œæˆçš„äº‹æƒ…ï¼š
æœåŠ¡å‘ç°ï¼Œé€šè¿‡ Pod çš„ lable æŸ¥æ‰¾ç›®æ ‡ Podï¼Œå°†æŸ¥æ‰¾çš„ Pod çš„æ³¨å†Œåˆ°è‡ªå·±çš„åç«¯åˆ—è¡¨ï¼ŒPod çš„ IP ä¿¡æ¯å‘ç”Ÿæ›´æ”¹ï¼Œåç«¯åˆ—è¡¨ä¹ŸåŒæ­¥æ›´æ–°ï¼› è´Ÿè½½å‡è¡¡ï¼Œè¯·æ±‚åˆ°è¾¾ Service ä¹‹åï¼Œå°†è¯·æ±‚å‡è¡¡è½¬å‘çš„åç«¯åˆ—è¡¨ï¼› æœåŠ¡æš´éœ²ï¼šå¯¹å¤–æä¾›ç»Ÿä¸€çš„è¯·æ±‚åœ°å€ã€‚ åˆ›å»º Service # åœ¨åˆ›å»º Sercvice ä¹‹å‰æˆ‘ä»¬é¦–å…ˆåˆ›å»º service ä»£ç†çš„ Podï¼Œnginx-pod.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/telepresence/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/telepresence/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Telepresence
Telepresence # Telepresenceæ˜¯ä¸€æ¬¾
Â« äº†è§£ Service
Â» Kubernetes 0-1 ä½¿ç”¨preStopä¼˜é›…ç»ˆæ­¢Pod</description></item><item><title/><link>https://blog.poneding.com/kubernetes/terminate-pod-gracefully/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/terminate-pod-gracefully/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 ä½¿ç”¨preStopä¼˜é›…ç»ˆæ­¢Pod
Kubernetes 0-1 ä½¿ç”¨preStopä¼˜é›…ç»ˆæ­¢Pod # Kuberneteså…è®¸Podç»ˆæ­¢ä¹‹å‰ï¼Œæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚
å­—æ®µå®šä¹‰ # å­—æ®µå®šä¹‰ï¼špod.spec.containers.lifecycle.preStop
$ kubectl explain pod.spec.containers.lifecycle.preStop KIND: Pod VERSION: v1 RESOURCE: preStop &amp;lt;Object&amp;gt; DESCRIPTION: PreStop is called immediately before a container is terminated due to an API request or management event such as liveness/startup probe failure, preemption, resource contention, etc. The handler is not called if the container crashes or exits. The reason for termination is passed to the handler.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/terraform/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/terraform/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Terraform
Terraform # åˆ›å»ºec2åŒæ—¶å®‰è£…åº”ç”¨çš„ä¸‰ç§æ–¹å¼ # Mode 1: userdata # éœ€è¦shellè„šæœ¬æ–‡ä»¶install_nginx.sh resource &amp;#34;aws_instance&amp;#34; &amp;#34;demo&amp;#34; { # ... # Mode 1: userdata user_data = &amp;#34;${file(&amp;#34;../templates/install_nginx.sh&amp;#34;)}&amp;#34; # ... } Mode 2: remote-exec # éœ€è¦è¿æ¥ä¸»æœºï¼Œconnection; å¯†é’¥æ–‡ä»¶xxx.pem resource &amp;#34;aws_instance&amp;#34; &amp;#34;demo&amp;#34; { # ... # Mode 2: remote-exec connection { host = &amp;#34;${self.private_ip}&amp;#34; private_key = &amp;#34;${file(&amp;#34;xxx.pem&amp;#34;)}&amp;#34; user = &amp;#34;${var.ansible_user}&amp;#34; } provisioner &amp;#34;remote-exec&amp;#34; { inline = [ &amp;#34;sudo apt-get update&amp;#34;, &amp;#34;sudo apt-get install -y nginx&amp;#34;, &amp;#34;sudo service nginx start&amp;#34; ] } # .</description></item><item><title/><link>https://blog.poneding.com/kubernetes/velero-minio-backup-restore-volume/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/velero-minio-backup-restore-volume/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / Velero + Minio å¤‡ä»½ä¸æ¢å¤
Velero + Minio å¤‡ä»½ä¸æ¢å¤ # å®‰è£… Minio # docker run -d --name minio \\ -p 9000:9000 \\ -p 9001:9001 \\ -e MINIO_ROOT_USER=minio \\ -e MINIO_ROOT_PASSWORD=minio \\ -v /minio-data:/data \\ quay.io/minio/minio:latest server /data --console-address &amp;#34;:9001&amp;#34; åˆ›å»º Bucket # è®¾ç½® Region # ç‚¹å‡»ä¿å­˜åï¼Œä¼šå‡ºç°ä¸€ä¸ªæ¨ªå¹…ï¼Œç‚¹å‡»æ¨ªå¹…ä¸Šçš„ Restart å³å¯ã€‚
åˆ›å»º AccessKey # ä¿å­˜ AccessKey å’Œ SecretKey åˆ°æ–‡ä»¶ credentials-veleroï¼š
[default] aws_access_key_id = &amp;lt;access_key&amp;gt; aws_secret_access_key = &amp;lt;secret_key&amp;gt; å®‰è£… Velero CLI # # linux wget &amp;lt;https://github.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/volume-understood/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/volume-understood/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / äº†è§£ Volume
äº†è§£ Volume # æˆ‘ä»¬çŸ¥é“å®¹å™¨ä¸å®¹å™¨ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œæœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿã€‚å¹¶ä¸”å­˜å‚¨çš„æ–‡ä»¶æ€§è´¨æ—¶ä¸´æ—¶çš„ï¼Œå½“å®¹å™¨è¢«é”€æ¯æ—¶ï¼Œå®¹å™¨å†…çš„æ–‡ä»¶ä¸€å¹¶è¢«æ¸…é™¤ã€‚
åœ¨ Pod å†…å¯èƒ½è¿è¡Œç€å¤šä¸ªå®¹å™¨ï¼Œè¿™å¯èƒ½éœ€è¦å®¹å™¨å…±äº«æ–‡ä»¶ã€‚åœ¨ K8s ä¸­ï¼ŒæŠ½è±¡é™¤äº† Volume çš„æ¦‚å¿µæ¥æ»¡è¶³è¿™ç§éœ€æ±‚ã€‚
Volume ä»‹ç» # åœ¨ Docker ä¸­ï¼Œä¹Ÿæœ‰ Volume çš„æ¦‚å¿µï¼Œå®ƒæ˜¯å°†å®¹å™¨å†…æŸæ–‡ä»¶ç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœºçš„ç›®å½•ã€‚
åœ¨ K8s ä¸­ï¼ŒVolume ä¾› Pod å†…çš„å®¹å™¨ä½¿ç”¨ï¼Œä¸€ä¸ªå®¹å™¨å¯ä»¥ä½¿ç”¨å¤šä¸ª Volumeï¼ŒåŒä¸€ Pod å†…çš„å¤šä¸ªå®¹å™¨å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸€ä¸ª Volumeï¼Œå®ç°æ–‡ä»¶å…±äº«ï¼Œæˆ–æ•°æ®æŒä¹…å­˜å‚¨ã€‚
å®¹å™¨ä¸ Volume çš„ç®€å•å…³ç³»ï¼š
Volume å®šä¹‰ # å®šä¹‰åœ¨ pod.spec.container å±æ€§ä¸‹ï¼š
kind: Pod ... spec: container: ... volumeMounts: - mountPath: &amp;lt;path&amp;gt; name: &amp;lt;volume-name&amp;gt; subPath: &amp;lt;volume-path&amp;gt; volumes: - name: &amp;lt;volume-name&amp;gt; &amp;lt;volume-type&amp;gt;: ... mountPathï¼š å®¹å™¨å†…çš„ç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºè¯¥ç›®å½• subPathï¼šé»˜è®¤ä¼šå°† mountPath ç›´æ¥æ˜ å°„åˆ° volume çš„æ ¹ç›®å½•ï¼Œä½¿ç”¨ subpath æ˜ å°„åˆ° volume ç‰¹å®šçš„ç›®å½•ã€‚ Volume ç±»å‹ # Volume æœ‰å¤šç§ç±»å‹ï¼Œæœ‰çš„å¯ä»¥ç›´æ¥åœ¨é›†ç¾¤ä¸­ä½¿ç”¨ï¼Œæœ‰çš„åˆ™éœ€è¦ç¬¬ä¸‰æ–¹æœåŠ¡æˆ–äº‘å¹³å°çš„æ”¯æŒã€‚ç®€å•ç½—åˆ—å‡ ç§å¸¸è§ç±»å‹ï¼Œæ›´å¤šäº†ç±»å‹å‚è€ƒï¼š https://kubernetes.</description></item><item><title/><link>https://blog.poneding.com/kubernetes/vpa/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://blog.poneding.com/kubernetes/vpa/</guid><description>ğŸ  é¦–é¡µ / Kubernetes / VPA
VPA # å®‰è£… # git clone https://github.com/kubernetes/autoscaler.git cd ./autoscaler/vertical-pod-autoscaler ./hack/vpa-up.sh å¸è½½ï¼š
./hack/vpa-down.sh VPAè¿è¡Œæ¨¡å¼ # Autoï¼ˆé»˜è®¤æ¨¡å¼ï¼‰ï¼šVPAåœ¨podåˆ›å»ºæ—¶åˆ†é…èµ„æºè¯·æ±‚ï¼Œå¹¶ä½¿ç”¨é¦–é€‰çš„æ›´æ–°æœºåˆ¶åœ¨ç°æœ‰çš„podä¸Šæ›´æ–°å®ƒä»¬ã€‚ç›®å‰ï¼Œè¿™ç›¸å½“äºâ€œé‡å»ºâ€(è§ä¸‹æ–‡)ã€‚ä¸€æ—¦podè¯·æ±‚çš„å…è´¹é‡å¯(â€œåŸä½â€)æ›´æ–°å¯ç”¨ï¼Œå®ƒå°±å¯ä»¥è¢«â€œAutoâ€æ¨¡å¼ç”¨ä½œé¦–é€‰çš„æ›´æ–°æœºåˆ¶ã€‚æ³¨æ„:VPAçš„è¿™ä¸ªç‰¹æ€§æ˜¯å®éªŒæ€§çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‚¨çš„åº”ç”¨ç¨‹åºåœæœºã€‚
Recreateï¼šVPAåœ¨podåˆ›å»ºæ—¶åˆ†é…èµ„æºè¯·æ±‚ï¼Œå¹¶åœ¨ç°æœ‰podä¸Šæ›´æ–°å®ƒä»¬ï¼Œå½“è¯·æ±‚çš„èµ„æºä¸æ–°å»ºè®®æœ‰æ˜¾è‘—å·®å¼‚æ—¶(å¦‚æœå®šä¹‰äº†podä¸­æ–­é¢„ç®—ï¼Œåˆ™è€ƒè™‘åˆ°å®ƒä»¬)ï¼Œå°†å®ƒä»¬èµ¶å‡ºç°æœ‰podã€‚è¿™ç§æ¨¡å¼åº”è¯¥å¾ˆå°‘ä½¿ç”¨ï¼Œåªæœ‰å½“æ‚¨éœ€è¦ç¡®ä¿åœ¨èµ„æºè¯·æ±‚æ›´æ”¹æ—¶é‡æ–°å¯åŠ¨podsæ—¶æ‰ä¼šä½¿ç”¨ã€‚å¦åˆ™æ›´å–œæ¬¢â€œè‡ªåŠ¨â€æ¨¡å¼ï¼Œè¿™å¯èƒ½ä¼šåˆ©ç”¨é‡æ–°å¯åŠ¨å…è´¹æ›´æ–°ï¼Œä¸€æ—¦ä»–ä»¬å¯ç”¨ã€‚æ³¨æ„:VPAçš„è¿™ä¸ªç‰¹æ€§æ˜¯å®éªŒæ€§çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‚¨çš„åº”ç”¨ç¨‹åºåœæœºã€‚
Initialï¼šVPAåªåœ¨podåˆ›å»ºæ—¶åˆ†é…èµ„æºè¯·æ±‚ï¼Œä»¥åä¸ä¼šæ›´æ”¹å®ƒä»¬ã€‚
Offï¼šVPAä¸ä¼šè‡ªåŠ¨æ›´æ”¹podsçš„èµ„æºéœ€æ±‚ã€‚è®¡ç®—å¹¶å¯ä»¥åœ¨VPAå¯¹è±¡ä¸­æ£€æŸ¥å»ºè®®ã€‚
ç¤ºä¾‹ # Â« äº†è§£ Volume</description></item></channel></rss>