[{"id":0,"href":"/ai/","title":"Ai","section":"","content":" ğŸ  é¦–é¡µ / AI\nAI # åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ \nllama\n"},{"id":1,"href":"/ai/d2l/","title":"D2l","section":"Ai","content":" ğŸ  é¦–é¡µ / AI / åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ \nåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  # ç¯å¢ƒå‡†å¤‡ # å¤‡æ³¨ï¼šå¼€å‘æœºå™¨ä¸º MacOS M1 Pro\npython # https://www.python.org/ftp/python/3.12.4/python-3.12.4-macos11.pkg\nminiconda # wget https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-arm64.sh sh Miniconda3-latest-MacOSX-arm64.sh -b jupyter # PyTorch æ¡†æ¶ # pip install torch==1.12.0 pip install torchvision==0.13.0 d2l åŒ… # pip install d2l==0.17.6 D2L Notebook # wget https://zh-v2.d2l.ai/d2l-zh.zip unzip d2l-zh.zip rm d2l-zh.zip cd mxnet å¼€å§‹ # # å‰ææ—¶å®‰è£…äº† zshï¼Œå¦åˆ™ä½¿ç”¨ bash ./miniconda3/bin/conda init zsh source ~/.zshrc conda create --name d2l python3.12.4 -y conda activate d2l Â» llama\n"},{"id":2,"href":"/ai/llama/","title":"Llama","section":"Ai","content":" ğŸ  é¦–é¡µ / AI / llama\nllama # å®‰è£… # MacOSï¼š\nbrewÂ installÂ ollama Linuxï¼š\ncurlÂ -sSLÂ https://ollama.com/install.shÂ |Â sh å®‰è£…å®Œæˆä¹‹åï¼ŒæŸ¥çœ‹å®‰è£…ç‰ˆæœ¬ï¼š\nollama -v å¯åŠ¨ # ollamaÂ start # é€šè¿‡æ³¨å…¥ OLLAMA_HOST ç¯å¢ƒå˜é‡è®¾ç½®ç›‘å¬åœ°å€ # OLLAMA_HOST=0.0.0.0Â ollamaÂ start ä¸‹è½½å¹¶è¿è¡Œå¤§æ¨¡å‹ # Llama3 ç›®å‰å¯ä¾›ä¸‹è½½çš„å¤§æ¨¡å‹æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼š8B å’Œ 70Bï¼Œæœ¬åœ°è¿è¡Œå®¹é‡æœ‰é™ï¼Œé€‰æ‹© 8B ç‰ˆæœ¬å³å¯ï¼Œå¤§å°å¤§æ¦‚ 5G å·¦å³ã€‚\n# å¦‚æœæ²¡ä¸‹è½½æ¨¡å‹ï¼Œè¿è¡Œä¼šè‡ªåŠ¨å…ˆä¸‹è½½ ollamaÂ runÂ llama3 # ä¸‹è½½å¤§æ¨¡å‹ # ollama pulll llama3 æ‰§è¡Œå®Œæˆåï¼Œä¼šç›´æ¥è¿›å…¥ä¸€ä¸ªäº¤äº’ç•Œé¢ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œå¯¹è¯äº†ã€‚\næ‰§è¡Œç”Ÿæˆå‘½ä»¤ # curl http://localhost:11434/api/generate -d \u0026#39;{ \u0026#34;model\u0026#34;: \u0026#34;llama3\u0026#34;, \u0026#34;prompt\u0026#34;: \u0026#34;Why is the sky blue?\u0026#34;, \u0026#34;stream\u0026#34;: false }\u0026#39; Â« åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ \n"},{"id":3,"href":"/algo/","title":"Algo","section":"","content":" ğŸ  é¦–é¡µ / æ•°æ®ç»“æ„ä¸ç®—æ³•\næ•°æ®ç»“æ„ä¸ç®—æ³• # å †æ’åº\nå¿«é€Ÿæ’åº\n"},{"id":4,"href":"/algo/%E5%A0%86%E6%8E%92%E5%BA%8F/","title":"å †æ’åº","section":"Algo","content":" ğŸ  é¦–é¡µ / æ•°æ®ç»“æ„ä¸ç®—æ³• / å †æ’åº\nå †æ’åº # å †æ’åºæ˜¯åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„è€Œè®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ï¼Œå †æ’åºæ˜¯ä¸€ç§**é€‰æ‹©æ’åºï¼Œ**å®ƒçš„æœ€åï¼Œæœ€å¥½ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦å‡ä¸º O(nlogn)ï¼Œå®ƒä¹Ÿæ˜¯ä¸ç¨³å®šæ’åºã€‚é¦–å…ˆç®€å•äº†è§£ä¸‹å †ç»“æ„ã€‚\nå † # å †æ˜¯å…·æœ‰ä»¥ä¸‹æ€§è´¨çš„å®Œå…¨äºŒå‰æ ‘ï¼šæ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ï¼Œç§°ä¸ºå¤§é¡¶å †ï¼›æˆ–è€…æ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ï¼Œç§°ä¸ºå°é¡¶å †ã€‚ï¼š\nç®—æ³•å®ç°ï¼ˆgolangï¼‰ # package main import \u0026#34;fmt\u0026#34; type BinaryTreeNode struct { Value int Left, Right *BinaryTreeNode } func main() { tree := \u0026amp;BinaryTreeNode{ Left: \u0026amp;BinaryTreeNode{ Left: \u0026amp;BinaryTreeNode{ Value: 1, }, Right: \u0026amp;BinaryTreeNode{ Value: 2, }, Value: 3, }, Right: \u0026amp;BinaryTreeNode{ Value: 4, }, Value: 5, } res := HeapSort(tree) fmt.Println(res) } func HeapSort(tree *BinaryTreeNode) []int { var res []int if tree == nil { return []int{} } res = heapSortHelper(tree, res) return res } func heapSortHelper(tree *BinaryTreeNode, res []int) []int { if tree.Left == nil { res = append(res, tree.Value) } else { res = heapSortHelper(tree.Left, res) res = heapSortHelper(tree.Right, res) res = append(res, tree.Value) } return res } Â» å¿«é€Ÿæ’åº\n"},{"id":5,"href":"/algo/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/","title":"å¿«é€Ÿæ’åº","section":"Algo","content":" ğŸ  é¦–é¡µ / æ•°æ®ç»“æ„ä¸ç®—æ³• / å¿«é€Ÿæ’åº\nå¿«é€Ÿæ’åº # æ­¥éª¤å¦‚ä¸‹ï¼š\nå…ˆä»æ•°åˆ—ä¸­å–å‡ºä¸€ä¸ªæ•°ä½œä¸ºåŸºå‡†æ•°ã€‚ä¸€èˆ¬å–ç¬¬ä¸€ä¸ªæ•°ã€‚ åˆ†åŒºè¿‡ç¨‹ï¼Œå°†æ¯”è¿™ä¸ªæ•°å¤§çš„æ•°å…¨æ”¾åˆ°å®ƒçš„å³è¾¹ï¼Œå°äºæˆ–ç­‰äºå®ƒçš„æ•°å…¨æ”¾åˆ°å®ƒçš„å·¦è¾¹ã€‚ å†å¯¹å·¦å³åŒºé—´é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°å„åŒºé—´åªæœ‰ä¸€ä¸ªæ•°ã€‚ ä¸¾ä¸€ä¸ªä¾‹å­ï¼š5 9 1 6 8 14 6 49 25 4 6 3ã€‚\nä¸€èˆ¬å–ç¬¬ä¸€ä¸ªæ•° 5 ä½œä¸ºåŸºå‡†ï¼Œä»å®ƒå·¦è¾¹å’Œæœ€åä¸€ä¸ªæ•°ä½¿ç”¨[]è¿›è¡Œæ ‡å¿—ï¼Œ å¦‚æœå·¦è¾¹çš„æ•°æ¯”åŸºå‡†æ•°å¤§ï¼Œé‚£ä¹ˆè¯¥æ•°è¦å¾€å³è¾¹æ‰”ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ª[]æ•°äº¤æ¢ï¼Œè¿™æ ·å¤§äºå®ƒçš„æ•°å°±åœ¨å³è¾¹äº†ï¼Œç„¶åå³è¾¹[]æ•°å·¦ç§»ï¼Œå¦åˆ™å·¦è¾¹[]æ•°å³ç§»ã€‚ 5 [9] 1 6 8 14 6 49 25 4 6 [3] å› ä¸º 9 \u0026gt; 5ï¼Œä¸¤ä¸ª[]äº¤æ¢ä½ç½®åï¼Œå³è¾¹[]å·¦ç§» 5 [3] 1 6 8 14 6 49 25 4 [6] 9 å› ä¸º 3 !\u0026gt; 5ï¼Œä¸¤ä¸ª[]ä¸éœ€è¦äº¤æ¢ï¼Œå·¦è¾¹[]å³ç§» 5 3 [1] 6 8 14 6 49 25 4 [6] 9 å› ä¸º 1 !\u0026gt; 5ï¼Œä¸¤ä¸ª[]ä¸éœ€è¦äº¤æ¢ï¼Œå·¦è¾¹[]å³ç§» 5 3 1 [6] 8 14 6 49 25 4 [6] 9 å› ä¸º 6 \u0026gt; 5ï¼Œä¸¤ä¸ª[]äº¤æ¢ä½ç½®åï¼Œå³è¾¹[]å·¦ç§» 5 3 1 [6] 8 14 6 49 25 [4] 6 9 å› ä¸º 6 \u0026gt; 5ï¼Œä¸¤ä¸ª[]äº¤æ¢ä½ç½®åï¼Œå³è¾¹[]å·¦ç§» 5 3 1 [4] 8 14 6 49 [25] 6 6 9 å› ä¸º 4 !\u0026gt; 5ï¼Œä¸¤ä¸ª[]ä¸éœ€è¦äº¤æ¢ï¼Œå·¦è¾¹[]å³ç§» 5 3 1 4 [8] 14 6 49 [25] 6 6 9 å› ä¸º 8 \u0026gt; 5ï¼Œä¸¤ä¸ª[]äº¤æ¢ä½ç½®åï¼Œå³è¾¹[]å·¦ç§» 5 3 1 4 [25] 14 6 [49] 8 6 6 9 å› ä¸º 25 \u0026gt; 5ï¼Œä¸¤ä¸ª[]äº¤æ¢ä½ç½®åï¼Œå³è¾¹[]å·¦ç§» 5 3 1 4 [49] 14 [6] 25 8 6 6 9 å› ä¸º 49 \u0026gt; 5ï¼Œä¸¤ä¸ª[]äº¤æ¢ä½ç½®åï¼Œå³è¾¹[]å·¦ç§» 5 3 1 4 [6] [14] 49 25 8 6 6 9 å› ä¸º 6 \u0026gt; 5ï¼Œä¸¤ä¸ª[]äº¤æ¢ä½ç½®åï¼Œå³è¾¹[]å·¦ç§» 5 3 1 4 [14] 6 49 25 8 6 6 9 ä¸¤ä¸ª[]å·²ç»æ±‡æ€»ï¼Œå› ä¸º 14 \u0026gt; 5ï¼Œæ‰€ä»¥ 5 å’Œ[]ä¹‹å‰çš„æ•° 4 äº¤æ¢ä½ç½® ç¬¬ä¸€è½®åˆ‡åˆ†ç»“æœï¼š4 3 1 5 14 6 49 25 8 6 6 9 ç°åœ¨ç¬¬ä¸€è½®å¿«é€Ÿæ’åºå·²ç»å°†æ•°åˆ—åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š 4 3 1 å’Œ 14 6 49 25 8 6 6 9 å·¦è¾¹çš„æ•°åˆ—éƒ½å°äº 5ï¼Œå³è¾¹çš„æ•°åˆ—éƒ½å¤§äº 5ã€‚ ä½¿ç”¨é€’å½’åˆ†åˆ«å¯¹ä¸¤ä¸ªæ•°åˆ—è¿›è¡Œå¿«é€Ÿæ’åºã€‚ package main import \u0026#34;fmt\u0026#34; type BinaryTreeNode struct { Value int Left, Right *BinaryTreeNode } func main() { nums := []int{4, 7, 2, 9, 3, 1} quickSort(nums, 0, len(nums)-1) fmt.Println(nums) } func quickSort(nums []int, r, l int) { if r \u0026lt; l { loc := quickSortHelper(nums, r, l) quickSort(nums, r, loc-1) quickSort(nums, loc+1, l) } } func quickSortHelper(nums []int, r, l int) int { i := r + 1 j := l for i \u0026lt; j { if nums[i] \u0026gt; nums[r] { nums[i], nums[j] = nums[j], nums[i] j-- } else { i++ } } if nums[r] \u0026lt;= nums[i] { i-- } nums[r], nums[i] = nums[i], nums[r] return i } Â« å †æ’åº\n"},{"id":6,"href":"/architechture/","title":"Architechture","section":"","content":" ğŸ  é¦–é¡µ / architechture\narchitechture # ç¼“å­˜è®¾è®¡\n"},{"id":7,"href":"/architechture/cache-design/","title":"Cache Design","section":"Architechture","content":" ğŸ  é¦–é¡µ / architechture / ç¼“å­˜è®¾è®¡\nç¼“å­˜è®¾è®¡ # ç¼“å­˜ç©¿é€ # ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªåœ¨ç¼“å­˜å±‚ä¸å­˜åœ¨çš„æ•°æ®ï¼Œè¯·æ±‚ä¼šæ‰“åˆ°å­˜å‚¨å±‚ã€‚\nè§£å†³åŠæ³•ï¼š\nç¼“å­˜æ§å¯¹è±¡ï¼› å¸ƒéš†è¿‡æ»¤å™¨ï¼› ç¼“å­˜å‡»ç©¿ # å¤§æ‰¹é‡ç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤±æ•ˆï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚æ‰“åˆ°å­˜å‚¨å±‚é€ æˆæ•°æ®å­˜å‚¨æœåŠ¡å‹åŠ›è¿‡å¤§ã€‚\nè§£å†³åŠæ³•ï¼š\nä¸ºç¼“å­˜è®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ã€‚\nç¼“å­˜é›ªå´© # ç¼“å­˜å±‚æœåŠ¡å¤±æ•ˆï¼Œè¯·æ±‚å…¨éƒ¨æ‰“åˆ°å­˜å‚¨å±‚ã€‚\nè§£å†³åŠæ³•ï¼š\nç¼“å­˜å±‚é«˜å¯ç”¨ï¼› å­˜å‚¨å±‚é‡‡ç”¨é™æµã€ç†”æ–­æˆ–é™çº§ç­‰éš”ç¦»ç»„ä»¶ï¼› æ··æ²Œå·¥ç¨‹ï¼Œé¢„æ¼”ç¼“å­˜å±‚ä¸å¯ç”¨ï¼Œå­˜å‚¨å±‚å¤„ç†èƒ½åŠ›ã€‚ çƒ­ç‚¹ç¼“å­˜ # çƒ­ç‚¹æ•°æ®ï¼Œè¿˜æœªå»ºç«‹ç¼“å­˜æˆ–è€…ç¼“å­˜è¿‡æœŸï¼ŒåŒä¸€æ—¶é—´å·¨å¤§è¯·æ±‚é‡å¹¶å‘æ‰“è¿‡æ¥ã€‚\nè§£å†³åŠæ³•ï¼š\nä½¿ç”¨äº’æ–¥é”ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹å»ºç«‹ç¼“å­˜ã€‚ "},{"id":8,"href":"/aws/","title":"Aws","section":"","content":" ğŸ  é¦–é¡µ / AWS\nAWS # æ­å»ºEKSé›†ç¾¤\nCluster AutoScaler\nåˆ›å»º EKS é›†ç¾¤\nEKSé…ç½® ALB Ingress\nEKSå°ç»†èŠ‚æ±‡æ€»\nEKSå®è·µ é›†æˆGitlabè‡ªåŠ¨å‘å¸ƒï¼ˆä¸€ï¼‰\nEKSå®è·µ é›†æˆGitlabè‡ªåŠ¨å‘å¸ƒï¼ˆäºŒï¼‰\nEKS-ä½¿ç”¨EFS\nGitlab \u0026amp; EKS\nK8s éƒ¨ç½² Kong æœåŠ¡\nK8s éƒ¨ç½² konga\nK8s éƒ¨ç½² Postgres\nTerraform é‡æ–°ç®¡ç†èµ„æº\n"},{"id":9,"href":"/aws/build-eks-cluster/","title":"Build Eks Cluster","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / æ­å»ºEKSé›†ç¾¤\næ­å»ºEKSé›†ç¾¤ # å®‰è£…awsï¼Œkubectlå’Œeksctlå‘½ä»¤è¡Œå·¥å…· # å¼•è¨€ # å®‰è£…aws cli å®‰è£…kubectl cli å®‰è£…eksctl cli å®‰è£…aws cli # å‚è€ƒ # https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-chap-install.html\nå®‰è£…ç¤ºä¾‹ï¼ˆwindowsï¼‰ # ä¸‹è½½å®‰è£…åŒ…ï¼š https://awscli.amazonaws.com/AWSCLIV2.msi è¿è¡Œä¸‹è½½çš„å®‰è£…åŒ… ç¡®å®å®‰è£…æ˜¯å¦æˆåŠŸ aws --version ä½¿ç”¨Security Credentialsé…ç½®aws cli # è®¿é—®awsæ§åˆ¶å°ï¼šService =\u0026gt; IAM é€‰æ‹©IAM Userï¼Œä½¿ç”¨å­ç”¨æˆ·ï¼Œå¼ºçƒˆä¸å»ºè®®ä½¿ç”¨rootç”¨æˆ· è¿›å…¥ç”¨æˆ·è¯¦æƒ…é¡µé¢ï¼ŒSecurity Credentialsé¡µ åˆ›å»ºAccess Key æ‹·è´Access Key IDå’ŒSecret Access Key ä½¿ç”¨awså‘½ä»¤é…ç½® $ aws configure AWS Access Key ID [None]: ABCDEFGHIAZBERTUCNGG (æ›¿æ¢Access Key ID) AWS Secret Access Key [None]: uMe7fumK1IdDB094q2sGFhM5Bqt3HQRw3IHZzBDTm (æ›¿æ¢Secret Access Key) Default region name [None]: us-east-1 Default output format [None]: json æµ‹è¯•é…ç½®æ˜¯å¦ç”Ÿæ•ˆ aws ec2 describe-vpcs å¸è½½ï¼ˆwindowsï¼‰ # æ§åˆ¶é¢æ¿ =\u0026gt; ç¨‹åºå’ŒåŠŸèƒ½ï¼Œæ‰¾åˆ°aws cliï¼Œå¸è½½å³å¯ã€‚ å®‰è£…kubectl cli # å¦‚æœä½ ç¡®å®æ˜¯ä½¿ç”¨EKSçš„Kubernetesï¼Œå»ºè®®ä½¿ç”¨awsæä¾›çš„kubectlå‘½ä»¤å·¥å…·ã€‚\nå‚è€ƒ # AWS\nhttps://docs.aws.amazon.com/zh_cn/eks/latest/userguide/install-kubectl.html\nå®˜æ–¹\nhttps://kubernetes.io/docs/tasks/tools/\nå®‰è£…ç¤ºä¾‹ï¼ˆwindowsï¼‰ # ä¸‹è½½å®‰è£…åŒ…ï¼Œç¤ºä¾‹ä¸­ä¸‹è½½è·¯å¾„ï¼šC:\\apps\\kubectl curl -o kubectl.exe https://amazon-eks.s3.us-west-2.amazonaws.com/1.16.8/2020-04-16/bin/windows/amd64/kubectl.exe æ›´æ–°ç³»ç»ŸPATHç¯å¢ƒå˜é‡ï¼Œæ·»åŠ C:\\apps\\kubectl\néªŒè¯kubectlç‰ˆæœ¬\nkubectl version --client å¸è½½ï¼ˆwindowsï¼‰ # ç›´æ¥åˆ é™¤ç¨‹åºæ–‡ä»¶ä»¥åŠPATHç¯å¢ƒå˜é‡å³å¯ã€‚\nå®‰è£…eksctl cli # å‚è€ƒ # https://docs.aws.amazon.com/zh_cn/eks/latest/userguide/eksctl.html\nå®‰è£…ç¤ºä¾‹ï¼ˆwindowsï¼‰ # å¸è½½ï¼ˆwindowsï¼‰ # EKSæœ€ä½³å®è·µï¼š\nhttps://aws.github.io/aws-eks-best-practices/security/docs/iam/\nÂ» Cluster AutoScaler\n"},{"id":10,"href":"/aws/cluster-autoscaler/","title":"Cluster Autoscaler","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / Cluster AutoScaler\nCluster AutoScaler # æˆ‘å½“å‰å·²ç»æœ‰äº†ä¸€ä¸ªEKSæœåŠ¡æ­å»ºèµ·æ¥çš„K8sé›†ç¾¤ï¼Œæˆ‘ç°åœ¨å¸Œæœ›æˆ‘çš„é›†ç¾¤æ‹¥æœ‰è‡ªåŠ¨ä¼¸ç¼©ï¼ˆä½“ç°åœ¨èŠ‚ç‚¹çš„æ‰©ç¼©ï¼‰çš„èƒ½åŠ›ã€‚\nå½“æˆ‘çš„é›†ç¾¤èµ„æºå……è¶³ï¼Œè€Œæˆ‘éƒ¨ç½²åœ¨é›†ç¾¤ä¸­çš„åº”ç”¨åªä½¿ç”¨åˆ°äº†å¾ˆå°‘é‡çš„èµ„æºï¼Œæˆ‘å¸Œæœ›é›†ç¾¤å›æ”¶èµ„æºä»¥èŠ‚çœè´¹ç”¨ï¼›å½“æˆ‘çš„åº”ç”¨æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå½“å‰é›†ç¾¤èµ„æºä¸è¶³æ—¶ï¼Œæˆ‘å¸Œæœ›é›†ç¾¤èƒ½å¢åŠ èŠ‚ç‚¹ï¼Œä»¥æ»¡è¶³åº”ç”¨çš„éƒ¨ç½²æ¡ä»¶ã€‚\né‚£ä¹ˆæœ¬ç¯‡å°±æ˜¯ä»‹ç»å¦‚ä½•é€šè¿‡ä½¿ç”¨Kubernetes Cluster Autoscalerè®©ä½ çš„é›†ç¾¤æ‹¥æœ‰è‡ªåŠ¨ä¼¸ç¼©çš„èƒ½åŠ›ï¼Œè€Œä¸ç”¨ä½ æ—¶åˆ»å…³æ³¨é›†ç¾¤çš„èµ„æºæ˜¯å¦è¿‡äºå®½æ¾æˆ–ç´§å¼ ã€‚\nNodeGroupæ·»åŠ Tag # æˆ‘ä»¬åˆ›å»ºEKSæ—¶ï¼Œéœ€è¦å®šä¹‰NodeGroupï¼Œä¸€èˆ¬åœ¨è¿™ä¸ªNodeGroupä¸­å®šä¹‰:\nasg_desired_capacityï¼šæœŸæœ›åˆ›å»ºçš„Nodeæ•°é‡ï¼›\nasg_max_sizeï¼šæœ€å°Nodeæ•°é‡ï¼Œé»˜è®¤ä¸º1ï¼›\nasg_min_sizeï¼šæœ€å¤§Nodeæ•°é‡ã€‚\nå®šä¹‰çš„NodeGroupä¼šç”ŸæˆAuto Scaling Groupèµ„æºï¼Œå¹¶ä¸”ç”±Auto Scaling Groupæ¥ç®¡ç†Nodeçš„åˆ›å»ºã€‚\nç°åœ¨éœ€è¦åšçš„å°±æ˜¯ä¸ºä½ çš„Auto Scaling Groupæ·»åŠ Tagã€‚\ntagé”®å€¼ï¼š\nTag Key Tag Value k8s.io/cluster-autoscaler/\u0026lt;your_cluster_name\u0026gt; owned k8s.io/cluster-autoscaler/enabled true ç¬¬ä¸€ä¸ªTag Keyä¸­çš„é›†ç¾¤å\u0026lt;your_cluster_name\u0026gt;éœ€è¦æ›¿æ¢ï¼›\nTag Valueçš„å€¼æ˜¯ä»€ä¹ˆä¸é‡è¦ï¼Œä¸»è¦æ˜¯éœ€è¦è¿™ä¸¤ä¸ªTag Keyæ¥è¯†åˆ«æ˜¯å¦å¯¹è¿™ä¸ªé›†ç¾¤å¼€å¯Auto Scalingçš„èƒ½åŠ›ã€‚\næ·»åŠ Policy # åˆ›å»ºIAMç­–ç•¥ï¼Œå°†æ–°åˆ›å»ºçš„ç­–ç•¥Attachåˆ°é›†ç¾¤èŠ‚ç‚¹ç»‘å®šçš„IAM roleä¸Šï¼Œè®©ä½ çš„é›†ç¾¤èŠ‚ç‚¹æ‹¥æœ‰è‡ªåŠ¨ä¼¸ç¼©çš„èƒ½åŠ›ã€‚\nIAMç­–ç•¥Jsonå†…å®¹ï¼š\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Action\u0026#34;: [ \u0026#34;autoscaling:DescribeAutoScalingGroups\u0026#34;, \u0026#34;autoscaling:DescribeAutoScalingInstances\u0026#34;, \u0026#34;autoscaling:DescribeLaunchConfigurations\u0026#34;, \u0026#34;autoscaling:DescribeTags\u0026#34;, \u0026#34;autoscaling:SetDesiredCapacity\u0026#34;, \u0026#34;autoscaling:TerminateInstanceInAutoScalingGroup\u0026#34;, \u0026#34;ec2:DescribeLaunchTemplateVersions\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34; } ] } éƒ¨ç½²Cluster AutoScaler # åœ¨é›†ç¾¤ä¸­éƒ¨ç½²Cluster AutoScalerï¼Œå‡†å¤‡èµ„æºæ¸…å•æ–‡ä»¶cluster-autoscaler.yamlï¼š\n--- apiVersion: v1 kind: ServiceAccount metadata: labels: k8s-addon: cluster-autoscaler.addons.k8s.io k8s-app: cluster-autoscaler name: cluster-autoscaler namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: cluster-autoscaler labels: k8s-addon: cluster-autoscaler.addons.k8s.io k8s-app: cluster-autoscaler rules: - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;events\u0026#34;, \u0026#34;endpoints\u0026#34;] verbs: [\u0026#34;create\u0026#34;, \u0026#34;patch\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;pods/eviction\u0026#34;] verbs: [\u0026#34;create\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;pods/status\u0026#34;] verbs: [\u0026#34;update\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;endpoints\u0026#34;] resourceNames: [\u0026#34;cluster-autoscaler\u0026#34;] verbs: [\u0026#34;get\u0026#34;, \u0026#34;update\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;nodes\u0026#34;] verbs: [\u0026#34;watch\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;get\u0026#34;, \u0026#34;update\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: - \u0026#34;pods\u0026#34; - \u0026#34;services\u0026#34; - \u0026#34;replicationcontrollers\u0026#34; - \u0026#34;persistentvolumeclaims\u0026#34; - \u0026#34;persistentvolumes\u0026#34; verbs: [\u0026#34;watch\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;get\u0026#34;] - apiGroups: [\u0026#34;extensions\u0026#34;] resources: [\u0026#34;replicasets\u0026#34;, \u0026#34;daemonsets\u0026#34;] verbs: [\u0026#34;watch\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;get\u0026#34;] - apiGroups: [\u0026#34;policy\u0026#34;] resources: [\u0026#34;poddisruptionbudgets\u0026#34;] verbs: [\u0026#34;watch\u0026#34;, \u0026#34;list\u0026#34;] - apiGroups: [\u0026#34;apps\u0026#34;] resources: [\u0026#34;statefulsets\u0026#34;, \u0026#34;replicasets\u0026#34;, \u0026#34;daemonsets\u0026#34;] verbs: [\u0026#34;watch\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;get\u0026#34;] - apiGroups: [\u0026#34;storage.k8s.io\u0026#34;] resources: [\u0026#34;storageclasses\u0026#34;, \u0026#34;csinodes\u0026#34;] verbs: [\u0026#34;watch\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;get\u0026#34;] - apiGroups: [\u0026#34;batch\u0026#34;, \u0026#34;extensions\u0026#34;] resources: [\u0026#34;jobs\u0026#34;] verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;, \u0026#34;patch\u0026#34;] - apiGroups: [\u0026#34;coordination.k8s.io\u0026#34;] resources: [\u0026#34;leases\u0026#34;] verbs: [\u0026#34;create\u0026#34;] - apiGroups: [\u0026#34;coordination.k8s.io\u0026#34;] resourceNames: [\u0026#34;cluster-autoscaler\u0026#34;] resources: [\u0026#34;leases\u0026#34;] verbs: [\u0026#34;get\u0026#34;, \u0026#34;update\u0026#34;] --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: cluster-autoscaler namespace: kube-system labels: k8s-addon: cluster-autoscaler.addons.k8s.io k8s-app: cluster-autoscaler rules: - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;configmaps\u0026#34;] verbs: [\u0026#34;create\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;configmaps\u0026#34;] resourceNames: [\u0026#34;cluster-autoscaler-status\u0026#34;, \u0026#34;cluster-autoscaler-priority-expander\u0026#34;] verbs: [\u0026#34;delete\u0026#34;, \u0026#34;get\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;watch\u0026#34;] --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: cluster-autoscaler labels: k8s-addon: cluster-autoscaler.addons.k8s.io k8s-app: cluster-autoscaler roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-autoscaler subjects: - kind: ServiceAccount name: cluster-autoscaler namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: cluster-autoscaler namespace: kube-system labels: k8s-addon: cluster-autoscaler.addons.k8s.io k8s-app: cluster-autoscaler roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: cluster-autoscaler subjects: - kind: ServiceAccount name: cluster-autoscaler namespace: kube-system --- apiVersion: apps/v1 kind: Deployment metadata: name: cluster-autoscaler namespace: kube-system labels: app: cluster-autoscaler spec: replicas: 1 selector: matchLabels: app: cluster-autoscaler template: metadata: labels: app: cluster-autoscaler annotations: prometheus.io/scrape: \u0026#34;true\u0026#34; prometheus.io/port: \u0026#34;8085\u0026#34; cluster-autoscaler.kubernetes.io/safe-to-evict: \u0026#34;false\u0026#34; spec: serviceAccountName: cluster-autoscaler containers: - image: us.gcr.io/k8s-artifacts-prod/autoscaling/cluster-autoscaler:v1.16.5 name: cluster-autoscaler resources: limits: cpu: 100m memory: 300Mi requests: cpu: 100m memory: 300Mi command: - ./cluster-autoscaler - --v=4 - --stderrthreshold=info - --cloud-provider=aws - --skip-nodes-with-local-storage=false - --expander=least-waste - --node-group-auto-discovery=asg:tag=k8s.io/cluster-autoscaler/enabled,k8s.io/cluster-autoscaler/\u0026lt;your_cluster_name\u0026gt; - --balance-similar-node-groups - --skip-nodes-with-system-pods=false volumeMounts: - name: ssl-certs mountPath: /etc/ssl/certs/ca-certificates.crt readOnly: true imagePullPolicy: \u0026#34;Always\u0026#34; volumes: - name: ssl-certs hostPath: path: \u0026#34;/etc/ssl/certs/ca-bundle.crt\u0026#34; èµ„æºæ¸…å•å†…å®¹æ¯”è¾ƒé•¿ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ cluster-autoscaler çš„ Deployment èµ„æºä¸­å®šä¹‰çš„ command ä¸­ï¼Œæœ‰ä¸€è¡Œä½ ä¼šè§‰å¾—çœ¼ç†Ÿï¼Œæ²¡é”™å°±æ˜¯æˆ‘ä»¬ä¸Šé¢ä¸º Auto Scale Group æ·»åŠ çš„ Tagï¼Œè¿™é‡Œä½ ä¹Ÿéœ€è¦æ›¿æ¢ä½ çš„é›†ç¾¤å \u0026lt;your_cluster_name\u0026gt;ï¼Œæ­¤å¤–ä½ å¯èƒ½éœ€è¦æ›¿æ¢ä½¿ç”¨åˆ°çš„é•œåƒï¼Œä½ å¯ä»¥åœ¨ Cluster AutoScaler å‘ç‰ˆé¡µé¢å»æ‰¾å¯¹åº”çš„é•œåƒç‰ˆæœ¬ã€‚ä¾‹å¦‚æˆ‘çš„K8sé›†ç¾¤æ˜¯1.16ï¼Œé‚£ä¹ˆæˆ‘éœ€è¦æ‰¾ä¸€ä¸ª1.16.xç‰ˆæœ¬çš„é•œåƒã€‚ä¸Šé¢èµ„æºæ¸…å•é‡Œå°±æ˜¯ä½¿ç”¨äº† us.gcr.io/k8s-artifacts-prod/autoscaling/cluster-autoscaler:v1.16.5 çš„é•œåƒã€‚\nä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ›å»º Cluster AutoScaler èµ„æºï¼š\nkubectl apply -f cluster-autoscaler.yaml æŸ¥çœ‹Cluster AutoScaler # æˆ‘ä»¬éƒ¨ç½²å®Œæˆä¹‹åï¼ŒCluster é»˜è®¤æ¯ 10s æ£€æŸ¥ä¸€æ¬¡é›†ç¾¤çš„èµ„æºæƒ…å†µï¼Œå¹¶æ ¹æ®èµ„æºæƒ…å†µåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©ç¼©å®¹ã€‚\nä½¿ç”¨å‘½ä»¤æŸ¥çœ‹Cluster AutoScalerçš„æ£€æŸ¥æƒ…å†µï¼š\nkubectl logs -f deployment.apps/cluster-autoscaler -n kube-system åˆ†æåŸç† # ä½ å¯ä»¥é€šè¿‡çªç„¶å¢åŠ Podç¤ºä¾‹æ•°é‡ï¼Œå¹¶ä¸”å¢åŠ  Pod çš„ resource.request.cpu/memory è®¾ç½®ä¸ºè¾ƒé«˜çš„å€¼ï¼Œè¿™æ ·æ¥æ¨¡æ‹Ÿé›†ç¾¤èµ„æºç´§å¼ çš„åœºæ™¯ï¼Œè§‚å¯Ÿé›†ç¾¤èŠ‚ç‚¹æ˜¯å¦ä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œä¹‹åå°†å¢åŠ çš„ Pod èµ„æºåˆ é™¤ï¼Œå†è§‚å¯Ÿé›†ç¾¤èŠ‚ç‚¹æ˜¯å¦è‡ªåŠ¨å›æ”¶ã€‚è¿™é‡Œæˆ‘å·²ç»å®è·µè¿‡äº†ï¼Œç”±äºæ¼”ç¤ºèµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œå¯èƒ½ä¼šè€—è´¹å¾ˆé•¿çš„ç¯‡å¹…ï¼Œæ‰€ä»¥è¿™é‡Œå°±çœå»äº†ï¼Œä½ å¯ä»¥äº²è‡ªåŠ¨æ‰‹å®è·µå°è¯•ã€‚\nç›¸ä¿¡æœ‰ä¸€ä¸ªç–‘é—®ä¸€ç›´ç¯ç»•ç€ï¼ŒCluster AutoScaleræ˜¯æ€ä¹ˆåšåˆ°è‡ªåŠ¨ä¼¸ç¼©çš„å‘¢ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰ç»™å‡ºç±»ä¼¼äºCPUè¶…è¿‡75%å°±æ‰©å®¹çš„ä¼¸ç¼©æ¡ä»¶ã€‚æˆ‘æ²¡æœ‰æ·±å…¥å»ç ”ç©¶ï¼Œä½†æ˜¯æˆ‘è‡ªå·±æ ¹æ®Cluster AutoScalerçš„æ—¥å¿—è¾“å‡ºç†è§£äº†ä¸€ä¸‹ã€‚\nPodçš„ç”³è¯·çš„èµ„æºï¼ˆresources.requestsï¼‰ä¸ç°æœ‰èŠ‚ç‚¹èµ„æºä½œæ¯”è¾ƒï¼Œå¦‚æœå‘ç°é›†ç¾¤èµ„æºè¶…å‡ºç”³è¯·çš„èµ„æºèƒ½å¤Ÿä½¿å¾—æˆ‘ä»¬ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹çš„è¯ï¼Œé‚£ä¹ˆCluster AutoScalerä¾¿ä¼šä¿®æ”¹Auto Scaling Groupçš„asg_desired_capacityå€¼ï¼Œä¾‹å¦‚-1ï¼Œä½†æ˜¯ä¸ä¼šå°äºasg_max_sizeã€‚å½“æœ‰æ–°Podéƒ¨ç½²ï¼Œå‘ç°é›†ç¾¤èµ„æºè¾¾ä¸åˆ°æ–°Podç”³è¯·çš„èµ„æºæ—¶ï¼Œé‚£ä¹ˆCluster AutoScalerä¾¿ä¼šä¿®æ”¹Auto Scaling Groupçš„asg_desired_capacityå€¼ï¼Œä¾‹å¦‚+1ï¼Œä½†æ˜¯ä¸ä¼šå¤§äºasg_max_sizeã€‚åªè¦ä¿®æ”¹äº†Auto Scaling Groupçš„asg_desired_capacityå€¼ï¼Œé‚£ä¹ˆé›†ç¾¤èŠ‚ç‚¹ä¾¿ä¼šè‡ªåŠ¨ä¼¸ç¼©ã€‚\nÂ« æ­å»ºEKSé›†ç¾¤\nÂ» åˆ›å»º EKS é›†ç¾¤\n"},{"id":11,"href":"/aws/create-eks-cluster/","title":"Create Eks Cluster","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / åˆ›å»º EKS é›†ç¾¤\nåˆ›å»º EKS é›†ç¾¤ # 1. EKSç®€ä»‹ # Amazon Elastic Kubernetes Service (Amazon EKS) æ˜¯ä¸€é¡¹æ‰˜ç®¡æœåŠ¡ï¼Œå¯è®©æ‚¨åœ¨ AWS ä¸Šè½»æ¾è¿è¡Œ Kubernetesï¼Œè€Œæ— éœ€æ”¯æŒæˆ–ç»´æŠ¤æ‚¨è‡ªå·±çš„ Kubernetes æ§åˆ¶å±‚é¢ã€‚Kubernetes æ˜¯ä¸€ä¸ªç”¨äºå®ç°å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†çš„è‡ªåŠ¨åŒ–çš„å¼€æºç³»ç»Ÿã€‚ï¼ˆè¯¥æ®µä»‹ç»æ¥è‡ªAmazon EKSæ–‡æ¡£ï¼Œæ›´å¤šäº†è§£ https://docs.aws.amazon.com/zh_cn/eks/latest/userguide/what-is-eks.htmlï¼‰\n2. eksctlåˆ›å»ºeksé›†ç¾¤ # 2.1 ä»€ä¹ˆæ˜¯eksctl # eksctlæ˜¯ä¸€ç§ç”¨äºåœ¨ Amazon EKS ä¸Šåˆ›å»ºå’Œç®¡ç† Kubernetes é›†ç¾¤çš„ç®€å•å‘½ä»¤è¡Œå®ç”¨ç¨‹åºã€‚eksctl å‘½ä»¤è¡Œå®ç”¨ç¨‹åºæä¾›äº†ä½¿ç”¨å·¥ä½œçº¿ç¨‹èŠ‚ç‚¹ä¸º Amazon EKS åˆ›å»ºæ–°é›†ç¾¤çš„æœ€å¿«ã€æœ€ç®€å•çš„æ–¹å¼ã€‚\neksctlæ›´å¤šäº†è§£ https://eksctl.io\n2.2 ä¸ºä»€ä¹ˆç”¨eksctl # åˆ›å»ºEKSé›†ç¾¤å¯ä»¥åœ¨AWSçš„æ§åˆ¶å°åˆ›å»ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨AWSå¼€å‘çš„eksctlå·¥å…·åˆ›å»ºï¼Œä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨eksctlåˆ›å»ºeksé›†ç¾¤å‘¢ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹åŸå› ï¼š\nç›´æ¥åœ¨AWSçš„æ§åˆ¶å°åˆ›å»ºé›†ç¾¤ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºå„ç§Roleï¼Œä»¥åŠé€‰æ‹©åˆé€‚çš„Subnetï¼ŒSecurity Groupç­‰ç¹æ‚æ“ä½œï¼Œä½ éœ€è¦åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å¤šä¸ªé¡µé¢ï¼Œæ“ä½œè¿‡ç¨‹å¯èƒ½ä¹Ÿè¦æ—¶ä¸æ—¶å‚é˜…æ–‡æ¡£ï¼› eksctlåˆ›å»ºEKSé›†ç¾¤åªéœ€è¦ä¸€è¡Œeksctl create cluster \u0026lt;å‚æ•°\u0026gt;å‘½ä»¤å³å¯ï¼Œä¼šè‡ªåŠ¨çš„ç»™ä½ åˆ›å»ºRoleç­‰èµ„æºï¼› eksctlçš„å‘½ä»¤å¯ä»¥è®°å½•åˆ°è„šæœ¬ï¼Œä¾¿äºå¤ç”¨ã€‚ 2.3 å®‰è£…eksctlï¼ˆåŸºäºubuntuï¼‰ # ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸‹è½½å¹¶æå–æœ€æ–°ç‰ˆæœ¬çš„ eksctlã€‚ curl --silent --location \u0026#34;https://github.com/weaveworks/eksctl/releases/download/latest_release/eksctl_$(uname -s)_amd64.tar.gz\u0026#34; | tar xz -C /tmp å°†æå–çš„äºŒè¿›åˆ¶æ–‡ä»¶ç§»è‡³ /usr/local/binã€‚ sudo mv /tmp/eksctl /usr/local/bin ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•æ‚¨çš„å®‰è£…æ˜¯å¦æˆåŠŸã€‚ eksctl version æ³¨æ„ï¼š\nGitTag ç‰ˆæœ¬åº”è‡³å°‘ä¸º 0.11.1ã€‚å¦åˆ™ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç»ˆç«¯è¾“å‡ºæ˜¯å¦æœ‰ä»»ä½•å®‰è£…æˆ–å‡çº§é”™è¯¯ã€‚\n2.4 ä½¿ç”¨eksctlåˆ›å»ºé›†ç¾¤ # å‡†å¤‡å·¥ä½œï¼š\nä¸€å°æ‹¥æœ‰åˆ›å»ºeksæƒé™çš„æœºå™¨ å·²ç»å®‰è£…å¥½eksctl eksctl create cluster \\ --name prod-eks \\ --version 1.14 \\ --region us-east-1 \\ --nodegroup-name prod-eks-workers \\ --node-type t3.medium \\ --nodes 2 \\ --nodes-min 2 \\ --nodes-max 4 \\ --ssh-access \\ --ssh-public-key -eks-public-key \\ --managed --ssh-public-key å¯é€‰çš„ï¼Œä½†å»ºè®®æ‚¨åœ¨åˆ›å»ºåŒ…å«èŠ‚ç‚¹ç»„çš„é›†ç¾¤æ—¶æŒ‡å®šè¯¥é€‰é¡¹ã€‚é€šè¿‡æ­¤é€‰é¡¹ï¼Œå¯ä»¥å¯¹æ‰˜ç®¡èŠ‚ç‚¹ç»„ä¸­çš„èŠ‚ç‚¹è¿›è¡Œ SSH è®¿é—®ã€‚å¯ç”¨ SSH è®¿é—®åï¼Œå¦‚æœå‡ºç°é—®é¢˜ï¼Œæ‚¨å¯ä»¥è¿æ¥åˆ°å®ä¾‹å¹¶æ”¶é›†è¯Šæ–­ä¿¡æ¯ã€‚\næ³¨æ„ï¼šåœ¨us-east-1åŒºä¸­ï¼Œåˆ›å»ºeksé›†ç¾¤æ—¶æ‚¨å¯èƒ½ä¼šé‡åˆ°UnsupportedAvailabilityZoneExceptionç±»å‹çš„å¼‚å¸¸ã€‚å¦‚æœé‡åˆ°è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä¼ é€’zoneså‚æ•°ï¼Œä¾‹å¦‚ï¼Œ\neksctl create cluster \\ --name prod-eks \\ --version 1.14 \\ --region us-east-1 \\ --zones us-east-1a,us-east-1b \\ --nodegroup-name prod-eks-workers \\ --node-type t3.medium \\ --nodes 2 \\ --nodes-min 2 \\ --nodes-max 4 \\ --ssh-access \\ --ssh-public-key prod-eks-public-key \\ --managed ä»¥ä¸Šåˆ›å»ºeksé›†ç¾¤çš„å‘½ä»¤ä¼šå¤§è‡´è¾“å‡ºä»¥ä¸‹å†…å®¹ï¼Œé›†ç¾¤çš„æ•´ä¸ªåˆ›å»ºè¿‡ç¨‹å¯èƒ½ä¼šèŠ±è´¹10åˆ°15åˆ†é’Ÿï¼š\n[â„¹] CloudWatch logging will not be enabled for cluster \u0026#34;prod-eks\u0026#34; in \u0026#34;us-east-1\u0026#34; [â„¹] you can enable it with \u0026#39;eksctl utils update-cluster-logging --region=us-east-1 --cluster=prod-eks\u0026#39; [â„¹] Kubernetes API endpoint access will use default of {publicAccess=true, privateAccess=false} for cluster \u0026#34;prod-eks\u0026#34; in \u0026#34;us-east-1\u0026#34; [â„¹] 2 sequential tasks: { create cluster control plane \u0026#34;prod-eks\u0026#34;, create managed nodegroup \u0026#34;prod-eks-workers\u0026#34; } [â„¹] building cluster stack \u0026#34;eksctl-prod-eks-cluster\u0026#34; [â„¹] deploying stack \u0026#34;eksctl-prod-eks-cluster\u0026#34; [â„¹] building managed nodegroup stack \u0026#34;eksctl-prod-eks-nodegroup-prod-eks-workers\u0026#34; [â„¹] deploying stack \u0026#34;eksctl-prod-eks-nodegroup-prod-eks-workers\u0026#34; [âœ”] all EKS cluster resources for \u0026#34;prod-eks\u0026#34; have been created ... å¦‚æœè¾“å‡ºä¸­å­˜åœ¨ could not find any of the authenticator commands: aws-iam-authenticator, heptio-authenticator-awsï¼Œåˆ™éœ€è¦å®‰è£…aws-iam-authenticatorï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ncurl -o aws-iam-authenticator https://amazon-eks.s3-us-west-2.amazonaws.com/1.14.6/2019-08-22/bin/linux/amd64/aws-iam-authenticator chmod +x ./aws-iam-authenticator mkdir -p $HOME/bin \u0026amp;\u0026amp; cp ./aws-iam-authenticator $HOME/bin/aws-iam-authenticator \u0026amp;\u0026amp; export PATH=$PATH:$HOME/bin echo \u0026#39;export PATH=$PATH:$HOME/bin\u0026#39; \u0026gt;\u0026gt; ~/.bashrc aws-iam-authenticator help å¦‚æœæœ¬æ¬¡æ“ä½œæœºå™¨æ²¡æœ‰å®‰è£…kubectlï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼Œå¦‚æœå·²ç»å®‰è£…åˆ™è·³è¿‡ï¼š\nsudo apt-get update \u0026amp;\u0026amp; sudo apt-get install -y apt-transport-https curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add - echo \u0026#34;deb https://apt.kubernetes.io/ kubernetes-xenial main\u0026#34; | sudo tee -a /etc/apt/sources.list.d/kubernetes.list sudo apt-get update sudo apt-get install -y kubectl å¯ä»¥é€šè¿‡kubectlå‘½ä»¤æ“ä½œæœ¬æ¬¡åˆ›å»ºçš„é›†ç¾¤ï¼š\nkubectl get svc è¾“å‡ºå¦‚ä¸‹ï¼Œå¯ä»¥è¯´æ˜eksé›†ç¾¤å·²ç»æˆåŠŸåˆ›å»ºäº†ã€‚\nNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.100.0.1 \u0026lt;none\u0026gt; 443/TCP 31m 3. éƒ¨ç½² Kubernetes Metrics Server # æ‰“å¼€ç»ˆç«¯çª—å£ï¼Œå¯¼èˆªåˆ°æ‚¨è¦ä¸‹è½½æœ€æ–° metrics-server ç‰ˆæœ¬çš„ç›®å½•ã€‚\nå°†ä»¥ä¸‹å‘½ä»¤å¤åˆ¶å¹¶ç²˜è´´åˆ°æ‚¨çš„ç»ˆç«¯çª—å£ï¼Œç„¶åé”®å…¥ Enter æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚è¿™äº›å‘½ä»¤å°†ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼Œæå–å®ƒï¼Œç„¶ååœ¨é›†ç¾¤ä¸­åº”ç”¨ç‰ˆæœ¬ 1.8+ æ¸…å•ã€‚\nDOWNLOAD_URL=$(curl -Ls \u0026#34;https://api.github.com/repos/kubernetes-sigs/metrics-server/releases/latest\u0026#34; | jq -r .tarball_url) DOWNLOAD_VERSION=$(grep -o \u0026#39;[^/v]*$\u0026#39; \u0026lt;\u0026lt;\u0026lt; $DOWNLOAD_URL) curl -Ls $DOWNLOAD_URL -o metrics-server-$DOWNLOAD_VERSION.tar.gz mkdir metrics-server-$DOWNLOAD_VERSION tar -xzf metrics-server-$DOWNLOAD_VERSION.tar.gz --directory metrics-server-$DOWNLOAD_VERSION --strip-components 1 kubectl apply -f metrics-server-$DOWNLOAD_VERSION/deploy/1.8+/ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éªŒè¯ metrics-server éƒ¨ç½²æ˜¯å¦è¿è¡Œæ‰€éœ€æ•°é‡çš„ Podï¼š kubectl get deployment metrics-server -n kube-system è¾“å‡º:\nNAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE metrics-server 1 1 1 1 56m eksctl create cluster --name dev-devops-eks2 --version 1.14 --region ap-southeast-1 --nodegroup-name dev-devops-eks2-workers --node-type t3.medium --nodes 3 --nodes-min 1 --nodes-max 4 --ssh-access --ssh-public-key dev-devops-eks2-public-key --managed EKS Node é»˜è®¤ç»™çš„Roleæƒé™éœ€è¦attch s3ã€secrets managerçš„æƒé™ã€‚\nÂ« Cluster AutoScaler\nÂ» EKSé…ç½® ALB Ingress\n"},{"id":12,"href":"/aws/eks-config-alb-ingress/","title":"Eks Config Alb Ingress","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / EKSé…ç½® ALB Ingress\nEKSé…ç½® ALB Ingress # å®˜æ–¹æ–‡æ¡£ï¼š https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/controller/installation/\néƒ¨ç½²Alb Ingress Controller # IAMä¸­åˆ›å»ºPolicyï¼Œç»™é›†ç¾¤çš„NodeèŠ‚ç‚¹çš„Roleæ·»åŠ è¯¥Policyã€‚\nPolicyçš„JSONé…ç½®å¦‚ä¸‹ï¼š\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;acm:DescribeCertificate\u0026#34;, \u0026#34;acm:ListCertificates\u0026#34;, \u0026#34;acm:GetCertificate\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;ec2:AuthorizeSecurityGroupIngress\u0026#34;, \u0026#34;ec2:CreateSecurityGroup\u0026#34;, \u0026#34;ec2:CreateTags\u0026#34;, \u0026#34;ec2:DeleteTags\u0026#34;, \u0026#34;ec2:DeleteSecurityGroup\u0026#34;, \u0026#34;ec2:DescribeAccountAttributes\u0026#34;, \u0026#34;ec2:DescribeAddresses\u0026#34;, \u0026#34;ec2:DescribeInstances\u0026#34;, \u0026#34;ec2:DescribeInstanceStatus\u0026#34;, \u0026#34;ec2:DescribeInternetGateways\u0026#34;, \u0026#34;ec2:DescribeNetworkInterfaces\u0026#34;, \u0026#34;ec2:DescribeSecurityGroups\u0026#34;, \u0026#34;ec2:DescribeSubnets\u0026#34;, \u0026#34;ec2:DescribeTags\u0026#34;, \u0026#34;ec2:DescribeVpcs\u0026#34;, \u0026#34;ec2:ModifyInstanceAttribute\u0026#34;, \u0026#34;ec2:ModifyNetworkInterfaceAttribute\u0026#34;, \u0026#34;ec2:RevokeSecurityGroupIngress\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;elasticloadbalancing:AddListenerCertificates\u0026#34;, \u0026#34;elasticloadbalancing:AddTags\u0026#34;, \u0026#34;elasticloadbalancing:CreateListener\u0026#34;, \u0026#34;elasticloadbalancing:CreateLoadBalancer\u0026#34;, \u0026#34;elasticloadbalancing:CreateRule\u0026#34;, \u0026#34;elasticloadbalancing:CreateTargetGroup\u0026#34;, \u0026#34;elasticloadbalancing:DeleteListener\u0026#34;, \u0026#34;elasticloadbalancing:DeleteLoadBalancer\u0026#34;, \u0026#34;elasticloadbalancing:DeleteRule\u0026#34;, \u0026#34;elasticloadbalancing:DeleteTargetGroup\u0026#34;, \u0026#34;elasticloadbalancing:DeregisterTargets\u0026#34;, \u0026#34;elasticloadbalancing:DescribeListenerCertificates\u0026#34;, \u0026#34;elasticloadbalancing:DescribeListeners\u0026#34;, \u0026#34;elasticloadbalancing:DescribeLoadBalancers\u0026#34;, \u0026#34;elasticloadbalancing:DescribeLoadBalancerAttributes\u0026#34;, \u0026#34;elasticloadbalancing:DescribeRules\u0026#34;, \u0026#34;elasticloadbalancing:DescribeSSLPolicies\u0026#34;, \u0026#34;elasticloadbalancing:DescribeTags\u0026#34;, \u0026#34;elasticloadbalancing:DescribeTargetGroups\u0026#34;, \u0026#34;elasticloadbalancing:DescribeTargetGroupAttributes\u0026#34;, \u0026#34;elasticloadbalancing:DescribeTargetHealth\u0026#34;, \u0026#34;elasticloadbalancing:ModifyListener\u0026#34;, \u0026#34;elasticloadbalancing:ModifyLoadBalancerAttributes\u0026#34;, \u0026#34;elasticloadbalancing:ModifyRule\u0026#34;, \u0026#34;elasticloadbalancing:ModifyTargetGroup\u0026#34;, \u0026#34;elasticloadbalancing:ModifyTargetGroupAttributes\u0026#34;, \u0026#34;elasticloadbalancing:RegisterTargets\u0026#34;, \u0026#34;elasticloadbalancing:RemoveListenerCertificates\u0026#34;, \u0026#34;elasticloadbalancing:RemoveTags\u0026#34;, \u0026#34;elasticloadbalancing:SetIpAddressType\u0026#34;, \u0026#34;elasticloadbalancing:SetSecurityGroups\u0026#34;, \u0026#34;elasticloadbalancing:SetSubnets\u0026#34;, \u0026#34;elasticloadbalancing:SetWebACL\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;iam:CreateServiceLinkedRole\u0026#34;, \u0026#34;iam:GetServerCertificate\u0026#34;, \u0026#34;iam:ListServerCertificates\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;cognito-idp:DescribeUserPoolClient\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;waf-regional:GetWebACLForResource\u0026#34;, \u0026#34;waf-regional:GetWebACL\u0026#34;, \u0026#34;waf-regional:AssociateWebACL\u0026#34;, \u0026#34;waf-regional:DisassociateWebACL\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;tag:GetResources\u0026#34;, \u0026#34;tag:TagResources\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;waf:GetWebACL\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;shield:DescribeProtection\u0026#34;, \u0026#34;shield:GetSubscriptionState\u0026#34;, \u0026#34;shield:DeleteProtection\u0026#34;, \u0026#34;shield:CreateProtection\u0026#34;, \u0026#34;shield:DescribeSubscription\u0026#34;, \u0026#34;shield:ListProtections\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; } ] } ä¸‹è½½alb-ingress-controller.yaml\nwget https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.6/docs/examples/alb-ingress-controller.yaml ä¿®æ”¹alb-ingress-controller.yamlï¼Œä¿®æ”¹ä»¥ä¸‹ä¸‰ä¸ªé…ç½®é¡¹\n--cluster-name=dev-eks\n--aws-vpc-id=vpc-xxxxxx\n--aws-region=us-west-1\néƒ¨ç½²ï¼š\nkubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.6/docs/examples/rbac-role.yaml kubectl apply -f alb-ingress-controller.yaml éªŒè¯éƒ¨ç½²æƒ…å†µï¼š\nkubectl logs -n kube-system $(kubectl get po -n kube-system | egrep -o \u0026#34;alb-ingress[a-zA-Z0-9-]+\u0026#34;) é…ç½®Alb Ingress Controller # è®¾ç½®External DNS # æœ¬ç¯‡å†…å®¹æ¥æºï¼š https://kubernetes-sigs.github.io/aws-load-balancer-controller/v1.1/guide/external-dns/setup/\nèƒŒæ™¯ # åœ¨AWSä¸­ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä»¥æŸä¸ªåŸŸåè®¿é—®K8sé›†ç¾¤çš„æŸä¸ªæœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»´æŠ¤Route 53ä¸­Record Setå’ŒLoadBalanceræ˜ å°„æ¥å®ç°ï¼Œè¿™æ— ç–‘ä¼šå¢åŠ ä¸€äº›æ‰‹åŠ¨æ“ä½œçš„æˆæœ¬ï¼Œæœ¬ç¯‡å³ä»‹ç»ä½¿ç”¨external-dnsæ¥è‡ªåŠ¨ç»´æŠ¤å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚\nexternal-dnsé¡¹ç›®åœ°å€ï¼š https://github.com/kubernetes-incubator/external-dns\nexternal-dnsæ ¹æ®hostçš„ä¿¡æ¯æä¾›DNSè®°å½•ï¼Œå®ƒå°†å»ºç«‹å’Œç®¡ç†Route 53ä¸­Record Setä¸LoadBalancerçš„æ˜ å°„å…³ç³»ã€‚\nå‰ææ¡ä»¶ # è§’è‰²æƒé™ # å¿…é¡»ç»™K8sé›†ç¾¤è¿è¡Œexternal-dnsçš„Nodeé…ç½®è§’è‰²å’Œç­–ç•¥ã€‚\nIAMä¸­åˆ›å»ºPolicyï¼Œç»™é›†ç¾¤çš„NodeèŠ‚ç‚¹çš„Roleæ·»åŠ è¯¥Policyã€‚\nPolicyçš„JSONé…ç½®å¦‚ä¸‹ï¼š\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;route53:ChangeResourceRecordSets\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:route53:::hostedzone/*\u0026#34; ] }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;route53:ListHostedZones\u0026#34;, \u0026#34;route53:ListResourceRecordSets\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;*\u0026#34; ] } ] } å®‰è£… # ä¸‹è½½external-dns.yamlç¤ºä¾‹æ–‡ä»¶ wget https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.6/docs/examples/external-dns.yaml ä¿®æ”¹external-dns.yamlæ–‡ä»¶ï¼Œä¸»è¦ä¿®æ”¹``\u0026ndash;domain-filter`è¿™ä¸ªé…ç½®å†…å®¹ --domain-filter=example.com éƒ¨ç½²external-dns kubectl apply -f external-dns.yaml éªŒè¯éƒ¨ç½²æ˜¯å¦æˆåŠŸå’Œå®æ—¶è®°å½• kubectl logs -f $(kubectl get po | egrep -o \u0026#39;external-dns[A-Za-z0-9-]+\u0026#39;) ä½¿ç”¨æ–¹å¼ # ä¸ºäº†åœ¨å­åŸŸåä¸­å»ºç«‹Record Setï¼Œéœ€è¦åœ¨Ingressæˆ–è€…Serviceèµ„æºä¸­æ·»åŠ å¦‚ä¸‹æ³¨é‡Šï¼š annotations: # for creating record-set external-dns.alpha.kubernetes.io/hostname: nginx.example.com # give your domain name here å¦‚æœæ˜¯serviceï¼Œéœ€è¦å°†typeè®¾ç½®æˆLoadBalancer\næŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼Œ2åˆ†é’Ÿååœ¨Route 53ä¸­æŸ¥çœ‹è®°å½•æ˜¯å¦ç”Ÿæˆæˆ–æ›´æ–°ã€‚ å®è·µè®°å½• # Podå†…å®¹å™¨ä½¿ç”¨Secrets Managerï¼Œéœ€è¦ç»™Nodeçš„Roleæ·»åŠ ç›¸åº”çš„æƒé™ï¼› Â« åˆ›å»º EKS é›†ç¾¤\nÂ» EKSå°ç»†èŠ‚æ±‡æ€»\n"},{"id":13,"href":"/aws/eks-details/","title":"Eks Details","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / EKSå°ç»†èŠ‚æ±‡æ€»\nEKSå°ç»†èŠ‚æ±‡æ€» # å¦‚æœalbçš„ingressä½¿ç”¨äº†è‡ªå®šä¹‰çš„security groupï¼Œé‚£ä¹ˆéœ€è¦å°†è¯¥å®‰å…¨ç»„åŠ å…¥åˆ°worker\nÂ« EKSé…ç½® ALB Ingress\nÂ» EKSå®è·µ é›†æˆGitlabè‡ªåŠ¨å‘å¸ƒï¼ˆä¸€ï¼‰\n"},{"id":14,"href":"/aws/eks-intergrate-gitlab-auto-release-01/","title":"Eks Intergrate Gitlab Auto Release 01","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / EKSå®è·µ é›†æˆGitlabè‡ªåŠ¨å‘å¸ƒï¼ˆä¸€ï¼‰\nEKSå®è·µ é›†æˆGitlabè‡ªåŠ¨å‘å¸ƒï¼ˆä¸€ï¼‰ # ç³»åˆ—ä»‹ç»å¦‚ä½•ä½¿ç”¨Gitlab CI/CDè‡ªåŠ¨éƒ¨ç½²åº”ç”¨åˆ°EKSï¼ˆK8sï¼‰é›†ç¾¤ä¸­ã€‚æœ¬ç¯‡ä»‹ç»å¦‚ä½•åœ¨EKSï¼ˆK8sï¼‰é›†ç¾¤ä¸­ä¸ºGitlabçš„CI/CDåˆ›å»ºGitlab Runnerã€‚\nGitlabæ·»åŠ K8sé›†ç¾¤ # æ·»åŠ æ–¹å¼ # ç¬¬ä¸€ç§æ–¹å¼ï¼ŒåŸºäºå•ä¸ªä»“åº“æ·»åŠ K8sé›†ç¾¤ï¼š\nè¿›å…¥Gitlabä»“åº“ï¼Œä¾æ¬¡ä»å·¦è¾¹èœå•æ Operations =\u0026gt; Kubernetesè¿›å…¥æ·»åŠ é¡µé¢ï¼Œç‚¹å‡»Add Kubernetes clusteræŒ‰é’®ã€‚è¿™ç§æ–¹å¼æ·»åŠ çš„K8sé›†ç¾¤åªå¯¹è¯¥é¡¹ç›®ä»“åº“æœ‰æ•ˆã€‚\nç¬¬äºŒç§æ–¹å¼ï¼ŒåŸºäºGroupæ·»åŠ K8sé›†ç¾¤ï¼š\nè¿›å…¥Gitlabä¸»é¡µï¼Œä¾æ¬¡ä»ä¸Šè¾¹èœå•æ Groups =\u0026gt; Your groupsï¼Œé€‰æ‹©Groupè¿›å…¥é¡µé¢ï¼Œç„¶åä¾æ¬¡ä»å·¦è¾¹èœå•æ Kuberentesè¿›å…¥æ·»åŠ é¡µé¢ï¼Œç‚¹å‡»Add Kubernetes clusterã€‚è¿™ç§æ–¹å¼æ·»åŠ çš„K8sé›†ç¾¤å¯¹è¯¥Groupä¸‹çš„é¡¹ç›®ä»“åº“æœ‰æ•ˆã€‚\nç¬¬ä¸‰ç§æ–¹å¼ï¼ŒåŸºäºå…¨å±€æ·»åŠ K8sé›†ç¾¤ï¼š\nè¿™ç§æ–¹å¼éœ€è¦ç”¨åˆ°gitlabçš„rootæƒé™ã€‚è¿›å…¥Gitlabä¸»é¡µï¼Œä»ä¸Šè¾¹èœå•æ Admin Area(æ‰³æ‰‹å›¾æ ‡) è¿›å…¥é¡µé¢ï¼Œç„¶åä¾æ¬¡ä»å·¦è¾¹èœå•æ Kuberentesè¿›å…¥æ·»åŠ é¡µé¢ï¼Œç‚¹å‡»Add Kubernetes clusterã€‚è¿™ç§æ–¹å¼æ·»åŠ çš„K8sé›†ç¾¤å¯¹æ‰€æœ‰é¡¹ç›®ä»“åº“æœ‰æ•ˆã€‚\næ·»åŠ æ­¥éª¤ # æ·»åŠ å·²æœ‰çš„K8sé›†ç¾¤ï¼ŒæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤è·å–åˆ°å¯¹åº”çš„å€¼å¡«å…¥è¡¨å•å³å¯ã€‚\nCluster Nameï¼š è¿™ä¸ªå¯ä»¥è‡ªå®šä¹‰ï¼Œèƒ½è‡ªè¡ŒåŒºåˆ†å°±è¡Œã€‚\nAPI URLï¼š è¿è¡Œä»¥ä¸‹å‘½ä»¤å¾—åˆ°è¾“å‡ºå€¼ï¼š\nkubectl cluster-info | grep \u0026#39;Kubernetes master\u0026#39; | awk \u0026#39;/http/ {print $NF}\u0026#39; CA Certificateï¼š è¿è¡Œä»¥ä¸‹å‘½ä»¤å¾—åˆ°è¾“å‡ºå€¼ï¼š\nkubectl get secret $(kubectl get secret | grep default-token | awk \u0026#39;{print $1}\u0026#39;) -o jsonpath=\u0026#34;{[\u0026#39;data\u0026#39;][\u0026#39;ca\\.crt\u0026#39;]}\u0026#34; | base64 --decode Service Tokenï¼š åˆ›å»ºæ–‡ä»¶gitlab-admin-service-account.yamlï¼š\nvim gitlab-admin-service-account.yaml æ–‡ä»¶å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š\napiVersion: v1 kind: ServiceAccount metadata: name: gitlab-admin namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: gitlab-admin roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - kind: ServiceAccount name: gitlab-admin namespace: kube-system è¿è¡Œä»¥ä¸‹å‘½ä»¤å¾—åˆ°è¾“å‡ºå€¼ï¼š\nkubectl apply -f gitlab-admin-service-account.yaml kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep gitlab-admin | awk \u0026#39;{print $1}\u0026#39;) å®‰è£…Helmä»¥åŠRunner # æ·»åŠ å®ŒK8sé›†ç¾¤ä¹‹åï¼Œåœ¨é›†ç¾¤ä¸­å®‰è£…Helm Tillerã€‚\nå®‰è£…å®ŒHelm Tillerä¹‹åï¼Œå†å®‰è£…Helm TIllerä¸‹é¢çš„Runnerã€‚\nä¹‹åï¼Œä½ å¯ä»¥å‘ç°K8sèµ„æºä¸­å¤šäº†ä¸€ä¸ªgitlab-managed-appså‘½ä»¤ç©ºé—´ï¼Œå¹¶ä¸”åœ¨è¯¥å‘½åç©ºé—´ä¸‹ï¼ŒåŒ…å«äº†tillerå’Œrunnerçš„ä¸€äº›èµ„æºã€‚\nå®‰è£…Gitlab Runner # ä¸Šé¢ä»‹ç»äº†Gitlabé›†æˆEKSï¼Œå¹¶å®‰è£…Gitlab Runnerçš„æ“ä½œè¿‡ç¨‹ï¼Œå…¶å®ä¹Ÿå¯ä»¥å®Œå…¨ä¸ç”¨è¿™ç§æ–¹æ³•ã€‚ä¸‹é¢ä»‹ç»å¦ä¸€ç§å®‰è£…Gitlab Runnerçš„æ–¹æ³•ã€‚\nåœ¨Groupæˆ–é¡¹ç›®ä»“åº“ä¸‹éƒ½å¯ä»¥ï¼ŒSettings =\u0026gt; CI / CD =\u0026gt; Runners è·å–åˆ°Urlå’ŒTokenã€‚\nä»è¿™é‡Œä¸‹è½½values.yamlæ–‡ä»¶ï¼š https://gitlab.com/gitlab-org/charts/gitlab-runner/blob/master/values.yaml\nä¸‹è½½å®Œä¹‹åï¼Œå°†ä¸Šé¢è·å–åˆ°çš„Urlå’ŒTokenæ›¿æ¢æ–‡ä»¶ä¸­gitlabUrlå’ŒrunnerRegistrationTokenå€¼ã€‚\nç„¶åä½¿ç”¨helmå‘½ä»¤å®‰è£…Gitlab Runnerï¼š\nkubectl create -n gitlab-managed-apps # æ‰‹åŠ¨åˆ›å»ºå‘½åç©ºé—´ helm install -n gitlab-managed-apps \u0026lt;gitlab-runner-name\u0026gt; -f values.yaml gitlab/gitlab-runner # åˆ é™¤gitlab runner # helm uninstall -n gitlab-managed-apps \u0026lt;gitlab-runner-name\u0026gt; åœ¨å®‰è£…äº†ä¹‹åï¼ŒæŸ¥çœ‹å®‰è£…çš„Gitlab Runnerï¼š\næ­¤æ—¶ï¼Œè¿›å…¥Gitlab Groupé¡µé¢ Setting =\u0026gt; CI / CD =\u0026gt; Runnersä¸‹å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªå¯ç”¨çš„Group Runnerã€‚\nä¸€äº›ç»éªŒ # è¦æ±‚Gitlabçš„æœåŠ¡å’ŒK8så¯ä»¥äº’ç›¸è®¿é—®ï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œæ˜¯è¿é€šçš„ï¼›\né‡å¤æ·»åŠ é›†ç¾¤å®‰è£…Helm Tiller\nåŒä¸€ä¸ªK8sé›†ç¾¤å¯ä»¥è¢«åŒä¸€ä¸ªGitlabæœåŠ¡å¤šæ¬¡æ·»åŠ ï¼Œä½†æ˜¯Helm Tillerå’ŒRunneræ˜¯ä¸èƒ½å¤šæ¬¡å®‰è£…çš„ï¼Œè¿™æ˜¯å› ä¸ºå®‰è£…Helm Tillerå’ŒGitlab Runneråˆ›å»ºK8sèµ„æºï¼ˆgitlab-managed-appså‘½åç©ºé—´ä¸‹çš„Deploymentï¼‰ä¼šå†²çªã€‚\nGitlab Runnerçš„ä½œç”¨åŸŸ\nä¸€ä¸ªé¡¹ç›®å¯ä»¥é€‰æ‹©ä½¿ç”¨å¤šä¸ªGitlab Runnerï¼š\nSpecific Runnersï¼šåŸºäºå½“å‰é¡¹ç›®æ·»åŠ çš„K8sé›†ç¾¤ä¸­å®‰è£…çš„Gitlab Runner\nShared Runnersï¼šRootæƒé™åŸºäºå…¨å±€æ·»åŠ çš„K8sé›†ç¾¤ä¸­å®‰è£…çš„Gitlab Runner\nGroup Runnersï¼šå½“å‰é¡¹ç›®æ‰€å±Groupæ·»åŠ çš„K8sé›†ç¾¤ä¸­å®‰è£…çš„Gitlab Runner\nå¦‚æœä½¿ç”¨Rootæƒé™åŸºäºå…¨å±€æ·»åŠ äº†ä¸€ä¸ªK8sé›†ç¾¤ï¼Œå¹¶ä¸”å®‰è£…äº†Gitlab Runnerä¹‹åï¼Œéšä¾¿è¿›å…¥ä¸€ä¸ªé¡¹ç›®ä»“åº“ Settings =\u0026gt; CI / CD =\u0026gt; Runnersä¸‹é¢å¯ä»¥çœ‹åˆ°Shared Runnersä¸‹é¢ä¼šæœ‰ä¸€ä¸ªå¯ç”¨çš„Runnerï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä½ å¯èƒ½æ³¨æ„åˆ°äº†è¿™ä¸ªRunneré»˜è®¤æœ‰ä¸¤ä¸ªTagï¼šclusterï¼Œkubernetesï¼Œè¿™ä¸¤ä¸ªTagçš„ä½œç”¨ä¸‹æ¬¡å°†ä¼šä½¿ç”¨åˆ°ã€‚\nç»“æŸè¯­ # æœ¬ç¯‡ä»‹ç»å°†EKSï¼ˆK8sï¼‰é›†ç¾¤æ·»åŠ åˆ°é¡¹ç›®ä»“åº“ä¸­ï¼Œå¹¶ä¸”å®‰è£…æ‰€éœ€çš„Helm Tillerå’ŒGItlab Runnerã€‚\nHelmæ˜¯K8sçš„ç±»ä¼¼åŒ…ç®¡ç†å·¥å…·ï¼ŒHelmçš„å„ç±»Chartså¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„å®šä¹‰ï¼Œå®‰è£…å’Œå‡çº§K8såº”ã€‚Helmå¯¹K8sæ¥è¯´æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®ƒçš„æœåŠ¡ç«¯åˆ™æ˜¯å®‰è£…åœ¨K8sä¸­çš„Tillerã€‚\nå¯ä»¥ä½¿ç”¨Helmåœ¨K8sé›†ç¾¤ä¸­å®‰è£…Gitlab Runnerï¼Œä½¿ç”¨Gitlab Runnerå®ç°Gitlab è‡ªåŠ¨CI/CDï¼Œå‰é¢æˆ‘ä»¬çš„æ­¥éª¤å°±æ˜¯ä½¿ç”¨Helmå®‰è£…GItlab Runnerã€‚\nÂ« EKSå°ç»†èŠ‚æ±‡æ€»\nÂ» EKSå®è·µ é›†æˆGitlabè‡ªåŠ¨å‘å¸ƒï¼ˆäºŒï¼‰\n"},{"id":15,"href":"/aws/eks-intergrate-gitlab-auto-release-02/","title":"Eks Intergrate Gitlab Auto Release 02","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / EKSå®è·µ é›†æˆGitlabè‡ªåŠ¨å‘å¸ƒï¼ˆäºŒï¼‰\nEKSå®è·µ é›†æˆGitlabè‡ªåŠ¨å‘å¸ƒï¼ˆäºŒï¼‰ # ç³»åˆ—ä»‹ç»å¦‚ä½•ä½¿ç”¨Gitlab CI/CDè‡ªåŠ¨éƒ¨ç½²åº”ç”¨åˆ°EKSï¼ˆK8sï¼‰é›†ç¾¤ä¸­ã€‚æœ¬ç¯‡ä»‹ç»å¦‚ä½•ä¸ºRunnré•œåƒçš„åˆ¶ä½œã€‚\nä¸Šæ–‡ä¸­åˆ›å»ºçš„Gitlab Runnerä¼šæŒç»­å­˜æ´»åœ¨EKSé›†ç¾¤ä¸­ï¼Œä½†æ˜¯å®ƒä¸åšå…·ä½“çš„Pipelineä»»åŠ¡ï¼Œå½“æœ‰Pipelineä»»åŠ¡æ¥ä¸´æ—¶ï¼Œç”±å®ƒæ¥åˆ›å»ºä¸´æ—¶çš„Runneræ¥æ‰§è¡Œã€‚è€Œä¸´æ—¶æ‹†åŠŸåˆ›å»ºçš„Runnerä½¿ç”¨ä»€ä¹ˆå®¹å™¨ç¯å¢ƒä»¥åŠå…·ä½“æ‰§è¡Œä»€ä¹ˆä»»åŠ¡æ˜¯ç”±ä»“åº“ç›®å½•ä¸‹.gitlab-ci.ymlæ–‡ä»¶å®šä¹‰çš„ã€‚\nåˆ¶ä½œTemp Runneré•œåƒ # æˆ‘ä»¬åˆ¶ä½œè¿™ä¸ªé•œåƒçš„ç›®çš„æ˜¯ä¸ºäº†èƒ½è®©é•œåƒè¿è¡Œèµ·æ¥åï¼Œå¯ä»¥å®Œæˆæˆ‘ä»¬çš„è‡ªåŠ¨å‘å¸ƒä»»åŠ¡ã€‚æ¯”å¦‚åœ¨å®¹å™¨temp-runnerå®¹å™¨éœ€è¦å°†æˆ‘ä»¬çš„ä»£ç buildæˆåº”ç”¨é•œåƒï¼Œç„¶åå°†åº”ç”¨é•œåƒå‘å¸ƒåˆ°EKSé›†ç¾¤ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å®¹å™¨ä¸­æˆ‘ä»¬å°±å¿…é¡»å¯ä»¥ä½¿ç”¨docker buildåŠŸèƒ½ä»¥åŠkubectl applyåŠŸèƒ½ã€‚\næŒ‰ç…§ä»¥ä¸Šçš„éœ€è¦ï¼Œæˆ‘ä»¬åˆ¶ä½œçš„é•œåƒè‡³å°‘éœ€è¦å®‰è£…å¥½docker ä»¥åŠkubectlã€‚\nDockerfileå¦‚ä¸‹ï¼š\nFROM docker:18 RUN apk add --no-cache curl jq python3 git tar tree \u0026amp;\u0026amp; \\ curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl \u0026amp;\u0026amp; chmod +x ./kubectl \u0026amp;\u0026amp; mv ./kubectl /usr/local/bin/kubectl ç›´æ¥ä½¿ç”¨dockeré•œåƒä½œä¸ºåŸºç¡€é•œåƒï¼Œç„¶åå®‰è£…kubectl\nä½¿ç”¨å‘½ä»¤åˆ¶ä½œå¹¶æ¨é€é•œåƒåˆ°dockerhubï¼ˆå®é™…æˆ‘çš„é•œåƒæ¨åŠ¨åˆ°äº†ECRï¼‰\ndocker build . -t gitlab-runner-base:latest --rm --no-cache docker push gitlab-runner-base:latest ä»“åº“é…ç½® # é¡¹ç›®ä»“åº“æ ¹ç›®å½•ä¸‹æ–°å¢.gitlab-ci.ymlæ–‡ä»¶ï¼Œç„¶åæ–‡ä»¶å†…å®¹\nÂ« EKSå®è·µ é›†æˆGitlabè‡ªåŠ¨å‘å¸ƒï¼ˆä¸€ï¼‰\nÂ» EKS-ä½¿ç”¨EFS\n"},{"id":16,"href":"/aws/eks-use-efs/","title":"Eks Use Efs","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / EKS-ä½¿ç”¨EFS\nEKS-ä½¿ç”¨EFS # åˆ›å»ºEFS\naws efs create-file-system \\ --performance-mode generalPurpose \\ --throughput-mode bursting \\ --encrypted \\ --tags Key=Name,Value=\u0026lt;fs-name\u0026gt; Key=creator,Value=dp Key=env:dev,Value=1 # ä¸Šé¢çš„å‘½ä»¤ä¼šå¾—åˆ°fs-id aws efs create-mount-target \\ --file-system-id \u0026lt;fs-id\u0026gt; \\ --subnet-id subnet-08d7609e614373fb8 \\ --security-groups sg-0af0f0e8705380529 aws efs create-mount-target \\ --file-system-id \u0026lt;fs-id\u0026gt; \\ --subnet-id subnet-09c0707ea8ad281bb \\ --security-groups sg-0af0f0e8705380529 aws efs create-mount-target \\ --file-system-id \u0026lt;fs-id\u0026gt; \\ --subnet-id subnet-063a8f10feb97868d \\ --security-groups sg-0af0f0e8705380529 Â« EKSå®è·µ é›†æˆGitlabè‡ªåŠ¨å‘å¸ƒï¼ˆäºŒï¼‰\nÂ» Gitlab \u0026amp; EKS\n"},{"id":17,"href":"/aws/gitlab-eks/","title":"Gitlab Eks","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / Gitlab \u0026amp; EKS\nGitlab \u0026amp; EKS # åˆ›å»ºIAM User\u0026amp;Group # Userï¼šgitlab-ciï¼Œä¿å­˜ç”Ÿæˆçš„Access key IDå’ŒSecret Access Keyï¼Œåé¢ä¼šç”¨åˆ°\nGroupï¼šGitlab.CIï¼Œæ·»åŠ Policyå¦‚ä¸‹ï¼š\nPolicy Name AmazonEKSWorkerNodePolicy AmazonEC2ContainerRegistryFullAccess AmazonEC2ContainerRegistryReadOnly AmazonEC2ContainerServiceFullAccess AmazonEKS_CNI_Policy å°†user gitlab-ciæ·»åŠ åˆ°Group Gitlab.CI\nå°†IAM Useræ·»åŠ åˆ°ConfigMap # kubectl edit cm aws-auth -n kube-system åœ¨mapUsersé”®è¿½åŠ ï¼š\n- \u0026#34;groups\u0026#34;: - \u0026#34;system:masters\u0026#34; \u0026#34;userarn\u0026#34;: \u0026#34;arn:aws:iam::xxxxxxx:user/gitlab-ci\u0026#34; \u0026#34;username\u0026#34;: \u0026#34;gitlab-ci\u0026#34; Gitlabä»“åº“è®¾ç½® # Setting =\u0026gt; CI/CD =\u0026gt; Variablesï¼Œæ·»åŠ å˜é‡ï¼š\nAWS_ACCESS_KEY_IDï¼š\u0026lt;gitlab-ciç”¨æˆ·çš„Access key ID\u0026gt; AWS_SECRET_ACCESS_KEYï¼š\u0026lt;gitlab-ciç”¨æˆ·çš„Secret Access Key\u0026gt; Gitlabä»“åº“.gitlab-ci.yml # Â« EKS-ä½¿ç”¨EFS\nÂ» K8s éƒ¨ç½² Kong æœåŠ¡\n"},{"id":18,"href":"/aws/k8s-deploy-kong/","title":"K8s Deploy Kong","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / K8s éƒ¨ç½² Kong æœåŠ¡\nK8s éƒ¨ç½² Kong æœåŠ¡ # æœ¬ç¯‡åªæ¶‰åŠ Kong æœåŠ¡åœ¨ K8s é›†ç¾¤çš„éƒ¨ç½²æ“ä½œï¼Œä¸æ¶‰åŠæ¦‚å¿µçŸ¥è¯†ã€‚\næå‰å‡†å¤‡ # K8s é›†ç¾¤ï¼Œæœ¬æ–‡ä½¿ç”¨çš„æ˜¯ AWS EKS é›†ç¾¤æœåŠ¡ ä¸€å°å¯ä»¥è¿æ¥ K8s é›†ç¾¤çš„æœåŠ¡å™¨ï¼Œå·²ç»å®‰è£… kubectl å’Œ docker ç­‰åŸºç¡€åº”ç”¨ï¼Œä¹‹åç§°ä¹‹ä¸ºæ“ä½œæœºå™¨ Postgres æ•°æ®åº“ï¼Œä½œä¸º Kong æœåŠ¡çš„åç«¯æ•°æ®åº“ åˆå§‹åŒ–æ•°æ®åº“ # ä½¿ç”¨ Postgres ä½œä¸º Kong æœåŠ¡çš„åç«¯æ•°æ®åº“ï¼Œæˆ‘ä»¬éœ€è¦æå‰åšæ•°æ®åº“çš„åˆå§‹åŒ–ï¼Œå‡†å¤‡ Kong æœåŠ¡éœ€è¦çš„æ•°æ®è¡¨ç­‰ã€‚è¿™é‡Œä½¿ç”¨ K8s-Job æ¥å®ç°æ•°æ®åº“çš„åˆå§‹åŒ–å·¥ä½œã€‚\nkong-migrations-job.yamlï¼š\napiVersion: batch/v1 kind: Job metadata: name: kong-migrations namespace: kong spec: template: metadata: name: kong-migrations spec: containers: - command: - /bin/sh - -c - kong migrations bootstrap env: - name: KONG_PG_PASSWORD value: \u0026#34;kong\u0026#34; - name: KONG_PG_HOST value: \u0026#34;postgres/postgres\u0026#34; - name: KONG_PG_PORT value: \u0026#34;5432\u0026#34; image: kong:1.4 name: kong-migrations initContainers: - command: - /bin/sh - -c - until nc -zv $KONG_PG_HOST $KONG_PG_PORT -w1; do echo \u0026#39;waiting for db\u0026#39;; sleep 1; done env: - name: KONG_PG_HOST value: \u0026#34;localhost:5432\u0026#34; - name: KONG_PG_PORT value: \u0026#34;5432\u0026#34; image: busybox name: wait-for-postgres restartPolicy: OnFailure ä½¿ç”¨çš„æ˜¯ kong çš„é•œåƒï¼Œè¿™ä¸ªé•œåƒè¿è¡Œèµ·æ¥çš„å®¹å™¨é‡Œæ‰§è¡Œ kong migrations bootstrap å‘½ä»¤æ¥å®Œæˆ kong æ•°æ®åº“çš„åˆå§‹åŒ–æ“ä½œã€‚\ninitContainers å®¹å™¨çš„ä½œç”¨æ˜¯ä¿è¯ ping postgres çš„ç½‘ç»œå¯ä»¥è¿é€šï¼Œå¦‚æœæ— æ³•è¿é€šï¼Œä¸ä¼šæ‰§è¡Œåˆå§‹åŒ–ã€‚\nåœ¨æ“ä½œæœºå™¨ä¸Šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¼€å§‹ kong æ•°æ®åº“çš„åˆå§‹åŒ–ï¼š\nkubectl apply -f kong-migrations-job.yaml å¦‚æœ kong æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸï¼Œä½ å¯ä»¥åœ¨æ•°æ®åº“ä¸­çœ‹åˆ°æ–°å‡ºç°çš„è¡¨\nK8sèµ„æºæ–‡ä»¶ # kong-configmap.yamlï¼š\napiVersion: v1 data: servers.conf: | # Prometheus metrics server server { server_name kong_prometheus_exporter; listen 0.0.0.0:9542; # can be any other port as well access_log off; location /metrics { default_type text/plain; content_by_lua_block { local prometheus = require \u0026#34;kong.plugins.prometheus.exporter\u0026#34; prometheus:collect() } } location /nginx_status { internal; stub_status; } } # Health check server server { server_name kong_health_check; listen 0.0.0.0:9001; # can be any other port as well access_log off; location /health { return 200; } } kind: ConfigMap metadata: name: kong-server-blocks namespace: kong ä½¿ç”¨ nginx å¯¹å¤–æš´éœ² kong æŒ‡æ ‡æ•°æ®çš„æ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ï¼Œprometheus å¯ä»¥æŠ“å–åˆ° kong æœåŠ¡æŒ‡æ ‡æ•°æ®ã€‚\nÂ« Gitlab \u0026amp; EKS\nÂ» K8s éƒ¨ç½² konga\n"},{"id":19,"href":"/aws/k8s-deploy-konga/","title":"K8s Deploy Konga","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / K8s éƒ¨ç½² konga\nK8s éƒ¨ç½² konga # æœ¬ç¯‡åªæ¶‰åŠ konga çš„éƒ¨ç½²æ“ä½œï¼Œä¸æ¶‰åŠæ¦‚å¿µçŸ¥è¯†ã€‚\næå‰å‡†å¤‡ # K8s é›†ç¾¤ï¼Œæœ¬æ–‡ä½¿ç”¨çš„æ˜¯ AWS EKS é›†ç¾¤æœåŠ¡ ä¸€å°å¯ä»¥è¿æ¥ K8s é›†ç¾¤çš„æœåŠ¡å™¨ï¼Œå·²ç»å®‰è£… kubectl å’Œ docker ç­‰åŸºç¡€åº”ç”¨ï¼Œä¹‹åç§°ä¹‹ä¸ºæ“ä½œæœºå™¨ Postgresæ•°æ®åº“ ï¼æ³¨æ„ï¼šè¯¥æ•°æ®åº“ä½¿ç”¨ 9.5 ç‰ˆæœ¬ï¼Œå…¶ä»–æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®åº“åœ¨åˆå§‹åŒ– konga æ•°æ®åº“æ—¶ä¼šæŠ¥å¦‚ä¸‹é”™ï¼š\nerror: Failed to prepare database: error: column r.consrc does not exist è¿™æ˜¯éƒ¨ç½² konga è¸©è¿‡çš„å‘ä¹‹ä¸€ã€‚\nç¡®ä¿ K8s é›†ç¾¤ä¸­å·²ç»åˆ›å»ºäº† nginx-ingressï¼Œnginx-ingress ç”¨äºæ ¹æ®å®šåˆ¶çš„ Ruleï¼ˆå¦‚åæ–‡ kong-ingress çš„é…ç½®ï¼‰å°†æµé‡è½¬å‘è‡³ K8s é›†ç¾¤çš„ Service ä¸­å»ã€‚ åˆ›å»º nginx-ingress æŒ‡ä»¤ï¼ˆå¯å‚ç…§ https://kubernetes.github.io/ingress-nginx/deploy/ï¼‰æ­¥éª¤å¦‚ä¸‹ï¼š\nStep 1. æ‰§è¡Œä»¥ä¸‹å¼ºåˆ¶å‘½ä»¤\nkubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml Step 2. é’ˆå¯¹æˆ‘ä»¬ä½¿ç”¨çš„ AWS æœåŠ¡ï¼Œå¹¶ä¸”æ ¹æ®ä½ æƒ³é…ç½®çš„ ELB ç±»å‹é€‰æ‹©å±‚ï¼ˆL4æˆ–L7ï¼‰ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤\nâ€‹ # Layer 4: use TCP as the listener protocol for ports 80 and 443.\nâ€‹ # Layer 7: use HTTP as the listener protocol for port 80 and terminate TLS in the ELB\n# FOR Layer 4 kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/aws/service-l4.yaml kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/aws/patch-configmap-l4.yaml # FOR Layer 7 kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/aws/service-l7.yaml kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/aws/patch-configmap-l7.yaml åˆå§‹åŒ–æ•°æ®åº“ # åœ¨æ“ä½œæœºå™¨ä¸Šæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤\ndocker run --rm pantsel/konga:latest -c prepare -a {{adapter}} -u {{connection-uri}} adapterï¼šæ•°æ®åº“ç±»å‹ï¼Œå¯é€‰ï¼Œ\u0026lsquo;mongo\u0026rsquo;,\u0026lsquo;postgres\u0026rsquo;,\u0026lsquo;sqlserver\u0026rsquo; or \u0026lsquo;mysql\u0026rsquo;\nconnection-uriï¼šæ•°æ®åº“çš„è¿æ¥å­—ç¬¦ä¸²\nä½¿ç”¨ postgres æ•°æ®åº“ä½œä¸º konga çš„å­˜å‚¨ï¼ŒæŒ‡ä»¤å¤§æ¦‚é•¿è¿™ä¸ªæ ·å­ï¼š\ndocker run --rm pantsel/konga:latest -c prepare -a postgres -u postgresql://\u0026lt;user\u0026gt;:\u0026lt;password\u0026gt;@\u0026lt;host\u0026gt;:\u0026lt;port\u0026gt;/\u0026lt;database\u0026gt; è¿è¡ŒæŒ‡ä»¤ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼Œå¯ä»¥è¯´æ˜æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸã€‚\ndebug: Preparing database... Using postgres DB Adapter. Database exists. Continue... debug: Hook:api_health_checks:process() called debug: Hook:health_checks:process() called debug: Hook:start-scheduled-snapshots:process() called debug: Hook:upstream_health_checks:process() called debug: Hook:user_events_hook:process() called debug: Seeding User... debug: User seed planted debug: Seeding Kongnode... debug: Kongnode seed planted debug: Seeding Emailtransport... debug: Emailtransport seed planted debug: Database migrations completed! å¯ä»¥è¿æ¥postgreså‘ç°ä½ çš„æ•°æ®åº“ä¸­å¤šå‡ºäº†ä¸‹é¢è¿™äº›è¡¨\nK8s èµ„æºæ–‡ä»¶ # kanga-namespace.yamlï¼š\napiVersion: v1 kind: Namespace metadata: name: konga konga-deployment.yamlï¼š\napiVersion: extensions/v1beta1 kind: Deployment metadata: name: konga namespace: konga spec: replicas: 1 template: metadata: labels: name: konga app: konga spec: containers: - env: - name: \u0026#34;DB_ADAPTER\u0026#34; value: \u0026#34;postgres\u0026#34; - name: \u0026#34;DB_HOST\u0026#34; value: \u0026#34;postgres/postgres\u0026#34; - name: \u0026#34;DB_PORT\u0026#34; value: \u0026#34;5432\u0026#34; - name: \u0026#34;DB_USER\u0026#34; value: konga - name: \u0026#34;DB_PASSWORD\u0026#34; value: konga - name: \u0026#34;DB_DATABASE\u0026#34; value: konga - name: \u0026#34;DB_PG_SCHEMA\u0026#34; value: \u0026#34;public\u0026#34; # - name: BASE_URL # value: /konga/ name: konga image: pantsel/konga ports: - containerPort: 1337 è¯¥æ–‡ä»¶éœ€è¦è®¾ç½® postgres çš„æ•°æ®åº“é…ç½®ï¼Œéœ€è¦è‡ªè¡Œæ›¿æ¢ï¼›\nå¯ä»¥æ³¨æ„åˆ° yaml æ–‡ä»¶ä¸­çš„ BASE_URL ç¯å¢ƒå˜é‡è¢«æˆ‘æ³¨é‡Šæ‰äº†ï¼Œè¿™ä¸ªå‚æ•°çš„ä½œç”¨æœ¬æ¥æ˜¯è®¾ç½®æˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ http://www.example.com/konga/æ¥è®¿é—®kongaç¨‹åºçš„ï¼Œä½†æ˜¯é•œåƒçš„ä½œè€…ç›®å‰è¿˜æ²¡æœ‰å¤„ç†å¥½ç›¸å…³çš„è·¯ç”±é—®é¢˜ã€‚æ‰€ä»¥ç›®å‰è¿˜åªèƒ½é€šè¿‡http://konga.example.comä½¿ç”¨ã€‚\nkonga-service.yamlï¼š\napiVersion: v1 kind: Service metadata: name: konga namespace: konga spec: ports: - name: tcp port: 1337 targetPort: 1337 protocol: TCP selector: app: konga kong-ingress.yamlï¼š\napiVersion: extensions/v1beta1 kind: Ingress metadata: name: konga-ingress namespace: konga annotations: nginx.ingress.kubernetes.io/ssl-redirect: \u0026#34;false\u0026#34; nginx.ingress.kubernetes.io/force-ssl-redirect: \u0026#34;false\u0026#34; nginx.ingress.kubernetes.io/rewrite-target: / spec: tls: - hosts: - konga.example.com secretName: tls-secret rules: - host: konga.example.com http: paths: - path: / backend: serviceName: konga servicePort: 1337 è¿™é‡Œhost(s)éœ€è¦æ›¿æ¢æˆçœŸæ­£çš„åŸŸåã€‚\nåˆ›å»ºKonga # å…ˆåˆ›å»ºkongaå‘½ä»¤ç©ºé—´\nkubectl apply -f konga-namespace.yaml å†åˆ›å»ºå…¶ä»–èµ„æºå³å¯\nkubectl apply -f konga-deployment.yaml kubectl apply -f konga-service.yaml kubectl apply -f konga-ingress.yaml éªŒè¯konga # åœ¨ä»¥ä¸Šåˆ›å»ºå‘½ä»¤æ‰§è¡Œåå¤§æ¦‚1-2åˆ†é’Ÿï¼Œæµè§ˆå™¨è®¿é—® http://konga.example.comï¼Œå‡ºç°kongaæ³¨å†Œé¡µé¢è¯´æ˜å·²ç»éƒ¨ç½²æˆåŠŸã€‚\nÂ« K8s éƒ¨ç½² Kong æœåŠ¡\nÂ» K8s éƒ¨ç½² Postgres\n"},{"id":20,"href":"/aws/k8s-deploy-postgres/","title":"K8s Deploy Postgres","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / K8s éƒ¨ç½² Postgres\nK8s éƒ¨ç½² Postgres # æœ¬ç¯‡åªæ¶‰åŠ Postgres çš„éƒ¨ç½²æ“ä½œï¼Œä¸æ¶‰åŠæ¦‚å¿µçŸ¥è¯†ã€‚\nç‰¹åˆ«è¯´æ˜ï¼šPostgres ç›¸å¯¹äºæ™®é€šçš„ç¨‹åºåº”ç”¨è€Œè¨€ï¼Œå±äºæœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œå› ä¸ºå®ƒå­˜å‚¨çš„æ•°æ®æ˜¯éœ€è¦æŒä¹…ä¿å­˜çš„ï¼Œè¿™ç‚¹å†³å®šäº†æˆ‘ä»¬é€‰æ‹© K8s-StatefulSet çš„éƒ¨ç½²è€Œé K8s-Deploymentã€‚\næå‰å‡†å¤‡ # K8s é›†ç¾¤ï¼Œæœ¬æ–‡ä½¿ç”¨çš„æ˜¯AWS EKSé›†ç¾¤æœåŠ¡ ä¸€å°å¯ä»¥è¿æ¥ K8s é›†ç¾¤çš„æœåŠ¡å™¨ï¼Œå·²ç»å®‰è£… kubectl å’Œ docker ç­‰åŸºç¡€åº”ç”¨ K8sèµ„æºæ–‡ä»¶ # postgres-namespace.yamlï¼š\napiVersion: v1 kind: Namespace metadata: name: postgres postgres-config.yamlï¼š\napiVersion: v1 kind: ConfigMap metadata: name: postgres-config namespace: postgres labels: app: postgres data: POSTGRES_DB: master POSTGRES_USER: dba POSTGRES_PASSWORD: pg_pass è¿™é‡Œçš„æ•°æ®åº“å¯†ç æ¶‰åŠåˆ°ä¿¡æ¯æ•æ„Ÿï¼Œæ›´å»ºè®®ä½¿ç”¨ Secret èµ„æºè€Œé ConfigMapï¼Œè¿™é‡Œå°±å·æ‡’äº†ã€‚\npostgres-statefulset.yamlï¼š\napiVersion: apps/v1 kind: StatefulSet metadata: name: postgres namespace: postgres spec: serviceName: \u0026#34;postgres\u0026#34; replicas: 1 selector: matchLabels: app: postgres template: metadata: labels: app: postgres spec: containers: - name: postgres image: postgres:9.5 envFrom: - configMapRef: name: postgres-config ports: - containerPort: 5432 name: postgredb volumeMounts: - name: postgres-data mountPath: /var/lib/postgresql/data subPath: postgres volumeClaimTemplates: - metadata: name: postgres-data spec: accessModes: [\u0026#34;ReadWriteOnce\u0026#34;] storageClassName: gp2 resources: requests: storage: 4Gi åœ¨è¿™ä¸ª yaml ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä½¿ç”¨äº†ä¹‹å‰åˆ›å»ºçš„ configmap æ¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼›\nåœ¨æ–‡ä»¶çš„åº•éƒ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† gp2 çš„ storageClass å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨åˆ›å»º PVã€PVCï¼Œ ä»¥åŠå…³è”ï¼Œä½ å¯èƒ½éœ€è¦æ›¿æ¢ã€‚\npostgres-service.yamlï¼š\napiVersion: v1 kind: Service metadata: name: postgres namespace: postgres labels: app: postgres spec: ports: - port: 5432 name: postgres type: LoadBalancer selector: app: postgres åˆ›å»ºPostgres # å…ˆåˆ›å»º postgres å‘½ä»¤ç©ºé—´\nkubectl apply -f postgres-namespace.yaml å†åˆ›å»ºå…¶ä»–èµ„æºå³å¯\nkubectl apply -f postgres-config.yaml kubectl apply -f postgres-statefulset.yaml kubectl apply -f postgres-service.yaml å› ä¸ºæˆ‘ä»¬æ˜¯åœ¨ AWS çš„ EKS é›†ç¾¤ä¸­åˆ›å»ºèµ„æºï¼Œæ‰€ä»¥åœ¨ä»¥ä¸Šå‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ AWS çš„ Volume ä¸­æ‰¾åˆ°æˆ‘ä»¬åˆ›å»ºçš„å­˜å‚¨å·ã€‚\næŸ¥çœ‹è¯¥å·ä¿¡æ¯ï¼Œå‘ç°å®ƒå…¶å®å·²ç»æŒ‚è½½åœ¨é›†ç¾¤çš„ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå»äº†ã€‚\néªŒè¯Postgres # æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æˆ‘ä»¬åˆ›å»ºçš„ postgres-service\nkubectl get pod -n postgres kubectl get svc -n postgres è¾“å‡ºå¦‚ä¸‹ï¼Œè¯´æ˜æˆ‘ä»¬çš„ postgres å·²ç»éƒ¨ç½²æˆåŠŸ\næ¨èä½¿ç”¨ DBeaver æ•°æ®åº“å¯è§†åŒ–å·¥å…·æµ‹è¯•è¿æ¥ postgresï¼Œä½¿ç”¨çš„ host æ­£æ˜¯è¾“å‡ºçš„ EXTERNAL-IP åˆ—çš„ä¿¡æ¯ï¼Œè€Œå…¶ä»–è¿æ¥ä¿¡æ¯åœ¨æˆ‘ä»¬çš„ ConfigMap ä¸­ã€‚\nÂ« K8s éƒ¨ç½² konga\nÂ» Terraform é‡æ–°ç®¡ç†èµ„æº\n"},{"id":21,"href":"/aws/terraform-remanage-resource/","title":"Terraform Remanage Resource","section":"Aws","content":" ğŸ  é¦–é¡µ / AWS / Terraform é‡æ–°ç®¡ç†èµ„æº\nTerraform é‡æ–°ç®¡ç†èµ„æº # çœ‹åˆ°è¿™ä¸ªæ ‡é¢˜ä½ å¯èƒ½ä¼šæœ‰ç‚¹æ‡µï¼Œæˆ‘å…ˆæ¥è§£é‡Šä¸‹ã€‚\nåœ¨ä½¿ç”¨Terraformç®¡ç†AWSçš„VPC-Subnetèµ„æºæ—¶ï¼ˆä¸‹é¢æ˜¯å®šä¹‰èµ„æºçš„ä»£ç æ¸…å•ï¼‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼šå½“æˆ‘ä¿®æ”¹aws_subnet.eks-private-subnet-1èµ„æºçš„cidr_blockæ—¶ï¼Œå‡è®¾æˆ‘ä¿®æ”¹æˆäº†172.28.2.0/24ï¼Œè¿™æ—¶å€™æ—§çš„\nresource \u0026#34;aws_subnet\u0026#34; \u0026#34;eks-private-subnet-1\u0026#34; { vpc_id = \u0026#34;${var.vpc_id}\u0026#34; cidr_block = \u0026#34;172.28.1.0/24\u0026#34; map_public_ip_on_launch = \u0026#34;false\u0026#34; availability_zone = \u0026#34;${var.region}a\u0026#34; tags = merge( {Name = \u0026#34;${var.cluster_name}-private-subnet-1a\u0026#34;}, \u0026#34;${local.cluster_private_subnet_tags}\u0026#34;) } Â« K8s éƒ¨ç½² Postgres\n"},{"id":22,"href":"/cka/001/","title":"1st","section":"Cka","content":" ğŸ  é¦–é¡µ / CKA / 001\n001 # 01 Task - è‹±æ–‡ # Create a new ClusterRole named deployment-clusterrole that only allows the creation of the following resource types:\nDeployment StatefulSet DaemonSet Create a new ServiceAccount named cicd-token in the existing namespace app-team1. Limited to namespace app-team1, bind the new ClusterRole deployment-clusterrole to the new ServiceAccount cicd-token. kubectl create ns app-team1 kubectl create serviceaccount cicd-token -n app-team1 kubectl create clusterrole deployment-clusterrole --verb=create --resource=deployment,statefulset,daemonset #limted to the namespace app-team1ã€‚éœ€è¦é™åˆ¶çš„æ˜¯namespaceçº§åˆ«ï¼Œclusterrolebindingä¸ºè®¾ç½®å…¨å±€ï¼Œrolebindingæ­£ç¡® kubectl create rolebinding cicd-clusterrole -n app-team1 --clusterrole=deployment-clusterrole --serviceaccount=app-team1:cicd-token 02 Task - è‹±æ–‡ # Set the node named ek8s-node-1 as unavaliable and reschedule all the pods running on it.\nkubectl cordon ek8s-node-1 kubectl drain ek8s-node-1 --delete-local-data --ignore-daemonsets --force //åˆ é™¤æ‰€æœ‰podï¼ˆåŒ…æ‹¬daemonsetç®¡ç†çš„podï¼‰ï¼Œåˆ™éœ€è¦--ignore-daemonsetsæˆ–--ignore-daemonsets=true 03 Task - è‹±æ–‡ # Given an existing Kubernetes cluster running version 1.18.8ï¼Œupgrade all of Kubernetes control plane and node components on the master node only to version 1.19.0ã€‚\nYou are also expected to upgrade kubelet and kubectl on the master nodeã€‚\nBe sure to drain the master node before upgrading it and uncordon it after the upgrade. Do not upgrade the worker nodes,etcd,the container manager,the CNI plugin,the DNS service or any other addons.\napt update apt-cache policy kubeadm apt-get update \u0026amp;\u0026amp; apt-get install -y --allow-change-held-packages kubeadm=1.19.0 kubeadm version #æ£€æŸ¥kubeadmç‰ˆæœ¬ kubectl drain master --ignore-daemonsets --delete-local-data --force #è…¾ç©ºæ§åˆ¶å¹³é¢èŠ‚ç‚¹ sudo kubeadm upgrade plan # å‘½ä»¤æŸ¥çœ‹å¯å‡çº§çš„ç‰ˆæœ¬ä¿¡æ¯ sudo kubeadm upgrade apply v1.19.0 --etcd-upgrade=false #æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯æ—¶ï¼Œæ’é™¤etcdä»3.4.3-0å‡åˆ°3.4.7-0 kubectl uncordon master sudo kubeadm upgrade node #å‡çº§å…¶ä»–æ§åˆ¶é¢èŠ‚ç‚¹ apt-get update \u0026amp;\u0026amp; apt-get install -y --allow-change-held-packages kubelet=1.19.0 kubectl=1.19.0 #å‡çº§å…¶ä»–æ§åˆ¶é¢èŠ‚ç‚¹ sudo systemctl daemon-reload sudo systemctl restart kubelet 04 Task - ä¸­æ–‡ # é¦–å…ˆï¼Œä¸ºè¿è¡Œåœ¨ https://127.0.0.1:2379 ä¸Šçš„ç°æœ‰etcd å®ä¾‹åˆ›å»ºå¿«ç…§å¹¶å°†å¿«ç…§ä¿å­˜åˆ°/data/backup/etcd-snapshot.dbã€‚\nä¸ºç»™å®šå®ä¾‹åˆ›å»ºå¿«ç…§é¢„è®¡èƒ½åœ¨å‡ ç§’é’Ÿå†…å®Œæˆã€‚å¦‚æœè¯¥æ“ä½œä¼¼ä¹æŒ‚èµ·ï¼Œåˆ™å‘½ä»¤å¯èƒ½æœ‰é—®é¢˜ã€‚ç”¨ctrl+c æ¥å–æ¶ˆæ“ä½œï¼Œç„¶åé‡è¯•ã€‚\nç„¶åè¿˜åŸä½äº/var/data/etcd-snapshot-previous.dbçš„ç°æœ‰å…ˆå‰å¿«ç…§ã€‚\næä¾›äº†ä»¥ä¸‹TLSè¯ä¹¦å’Œå¯†é’¥ï¼Œä»¥é€šè¿‡etcdctlè¿æ¥åˆ°æœåŠ¡å™¨ã€‚\ncaè¯ä¹¦ï¼š/opt/KUIN00601/ca.crt å®¢æˆ·ç«¯è¯ä¹¦ï¼š/opt/KUIN00601/etcd-client.crt å®¢æˆ·ç«¯å¯†é’¥ï¼š/opt/KUIN00601/etcd-client.key ä¸€å®šè¦æŠŠè¿™å‚æ•°ç”¨ç†Ÿç»ƒï¼Œå¦‚æœè€ƒè¯•æ—¶æœ‰é—®é¢˜ï¼Œä¸è¦æ€¥ï¼Œå¤šè¯•è¯•ï¼ï¼ï¼\nä¸€æ—¦æ­£ç¡®é…ç½®äº† etcdï¼Œåªæœ‰å…·æœ‰æœ‰æ•ˆè¯ä¹¦çš„å®¢æˆ·ç«¯æ‰èƒ½è®¿é—®å®ƒã€‚è¦è®© Kubernetes API æœåŠ¡å™¨è®¿é—®ï¼Œå¯ä»¥ä½¿ç”¨å‚æ•° \u0026ndash;etcd-certfile=k8sclient.cert,â€“etcd-keyfile=k8sclient.key å’Œ \u0026ndash;etcd-cafile=ca.cert é…ç½®å®ƒã€‚\næˆ‘è®°å¾—æˆ‘è€ƒè¯•è¿›ç”¨çš„æ˜¯ï¼šâ€“certfile=/opt/KUIN00601/etcd-client.crt \u0026ndash;keyfile=/opt/KUIN00601/etcd-client.key \u0026ndash;cafile=/opt/KUIN00601/ca.crt\nETCDCTL_API=3 etcdctl --endpoint=https://127.0.0.1:2379 --certfile=/opt/KUIN00601/etcd-client.crt --keyfile=/opt/KUIN00601/etcd-client.key --cafile=/opt/KUIN00601/ca.crt snapshot save /data/backup/etcd-snapshot.db ETCDCTL_API=3 etcdctl --endpoint=https://127.0.0.1:2379 --cert-file=/opt/KUIN00601/etcd-client.crt --key-file=/opt/KUIN00601/etcd-client.key --ca-file=/opt/KUIN00601/ca.crt snapshot restore /var/data/etcd-snapshot-previous.db 05 Task - è‹±æ–‡ # Create a new NetworkPolicy named allow-port-from-namespace to allow Pods in the existing namespace internal to connect to port 8080 of other Pods in the same namespace. Ensure that the new NetworkPolicy:\ndoes not allow access to Pods not listening on port 8080. does not allow access from Pods not in namespace internal. #network.yaml apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: allow-port-from-namespace namespace: internal spec: podSelector: matchLabels: {} policyTypes: - Ingress ingress: - from: - podSelector: {} ports: - protocol: TCP port: 8080 #spec.podSelectoré™å®šäº†è¿™ä¸ªnamespaceé‡Œçš„podå¯ä»¥è®¿é—® kubectl create -f network.yaml 06 Task - è‹±æ–‡ # Reconfigure the existing deployment front-end and add a port specifiction named http exposing port 80/tcp of the existing container nginx.\nCreate a new service named front-end-svc exposing the container prot http.\nConfigure the new service to also expose the individual Pods via a NodePort on the nodes on which they are scheduled.\nkubectl get deploy front-end kubectl edit deploy front-end -o yaml #port specification named http #service.yaml apiVersion: v1 kind: Service metadata: name: front-end-svc labels: app: nginx spec: ports: - port: 80 protocol: tcp name: http selector: app: nginx type: NodePort # kubectl create -f service.yaml # kubectl get svc #æˆ–è€…ä¸€æ¡å‘½ä»¤æå®š,æ³¨æ„ä¼šé—æ¼port specification named http kubectl expose deployment front-end --name=front-end-svc --port=80 --tarport=80 --type=NodePort 07 Task - è‹±æ–‡ # Create a new nginx Ingress resource as follows:\nName: pingï¼š Namespace: ing-internalï¼š Exposing service hi on path /hi using service port 5678ï¼š The avaliability of service hi can be checked using the following command,which should return hi: curl -kL /hi\nvi ingress.yaml # apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: ping namespace: ing-internal spec: rules: - http: paths: - path: /hi pathType: Prefix backend: service: name: hi port: number: 5678 # kubectl create -f ingress.yaml 08 Task - è‹±æ–‡ # Scale the deployment presentation to 3 pods.\nkubectl get deployment kubectl scale deployment.apps/presentation --replicas=3 09 Task - è‹±æ–‡ # Task\nSchedule a pod as follows:\nname: nginx-kusc00401ï¼š Image: nginxï¼š Node selector: disk-spinningï¼š #yaml apiVersion: v1 kind: Pod metadata: name: nginx-kusc00401 spec: containers: - name: nginx image: nginx imagePullPolicy: IfNotPresent nodeSelector: disk: spinning # kubectl create -f node-select.yaml 10 Task - è‹±æ–‡ # Task Check to see how many nodes are ready (not including nodes tainted NoSchedule)and write the number to /opt/KUSC00402/kusc00402.txt.ï¼š\nkubectl describe nodes | grep ready|wc -l kubectl describe nodes | grep -i taint | grep -i noschedule |wc -l echo 3 \u0026gt; /opt/KUSC00402/kusc00402.txt # æŸ¥è¯¢é›†ç¾¤ReadyèŠ‚ç‚¹æ•°é‡ kubectl get node | grep -i ready |wc -l # æ‰¾å‡ºèŠ‚ç‚¹taintsã€noSchedule kubectl describe nodes | grep -i taints | grep -i noschedule |wc -l #å°†å¾—åˆ°çš„å‡æ•°ï¼Œå†™å…¥åˆ°æ–‡ä»¶ echo 2 \u0026gt; /opt/KUSC00402/kusc00402.txt 11 Task - è‹±æ–‡ # Create a pod named kucc8 with a single app container for each of the following images running inside (there may be between 1 and 4 images specified): nginx + redis + memcached + consul .ï¼š\nkubectl run kucc8 --image=nginx --dry-run -o yaml \u0026gt; kucc8.yaml # vi kucc8.yaml apiVersion: v1 kind: Pod metadata: creationTimestamp: null name: kucc8 spec: containers: - image: nginx name: nginx - image: redis name: redis - image: memcached name: memcached - image: consul name: consul # kubectl create -f kucc8.yaml #12.07 12 Task - è‹±æ–‡ # Task Create a persistent volume whit name app-config, of capacity 1Gi and access mode ReadOnlyMany . the type of volume is hostPath and its location is /srv/app-config .ï¼š\n#vi pv.yaml apiVersion: v1 kind: PersistentVolume metadata: name: app-config spec: capacity: storage: 1Gi accessModes: - ReadOnlyMany hostPath: path: /srv/app-config # kubectl create -f pv.yaml 13 Task - è‹±æ–‡ # Task Create a new PersistentVolumeClaim:\nName: pv-volumeï¼š Class: csi-hostpath-scï¼š Capacity: 10Miï¼š Create a new Pod which mounts the PersistentVolumeClaim as a volume:\nName: web-serverï¼š Image: nginxï¼š Mount path: /usr/share/nginx/htmlï¼š Configure the new Pod to have ReadWriteOnce access on the volume.\nFinally,using kubectl edit or Kubectl patch expand the PersistentVolumeClaim to a capacity of 70Mi and record that change.\nvi pvc.yaml #ä½¿ç”¨æŒ‡å®šstorageclassåˆ›å»ºä¸€ä¸ªpvc apiVersion: v1 kind: PersistentVolumeClaim metadata: name: pv-volume spec: accessModes: - ReadWriteOnce volumeMode: Filesystem resources: requests: storage: 10Mi storageClassName: csi-hostpath-sc # vi pod-pvc.yaml apiVersion: v1 kind: Pod metadata: name: web-server spec: containers: - name: web-server image: nginx volumeMounts: - mountPath: \u0026#34;/usr/share/nginx/html\u0026#34; name: my-volume volumes: - name: my-volume persistentVolumeClaim: claimName: pv-volume # craete kubectl create -f pod-pvc.yaml #edit ä¿®æ”¹å®¹é‡ kubectl edit pvc pv-volume --record 14 Task - è‹±æ–‡ # Task Monitor the logs of pod bar and:\nExtract log lines corresponding to error unable-to-access-websiteï¼š Write them to /opt/KUTR00101/barï¼š kubectl logs bar | grep \u0026#39;unable-to-access-website\u0026#39; \u0026gt; /opt/KUTR00101/bar cat /opt/KUTR00101/bar 15 Task - è‹±æ–‡ # Context Without changing its existing containers,an existing Pod needs to be integrated into Kubernetesâ€™s build-in logging architecture (e.g. kubectl logs). Adding a streaming sidecar container is a good and common way to accomplish this requirement.\nTask Add a busybox sidecar container to the existing Pod big-corp-app. The new sidecar container has to run the following command:\n/bin/sh -c tail -n+1 -f /var/log/big-corp-app.log Use a volume mount named logs to make the file /var/log/big-corp-app.log available to the sidecar container.\nDonâ€™t modify the existing container. Donâ€™t modify the path of the log file,both containers must access it at /var/log/big-corp-app.log.\n# kubectl get pod big-corp-app -o yaml # apiVersion: v1 kind: Pod metadata: name: big-corp-app spec: containers: - name: big-corp-app image: busybox args: - /bin/sh - -c - \u0026gt; i=0; while true; do echo \u0026#34;$(date) INFO $i\u0026#34; \u0026gt;\u0026gt; /var/log/big-corp-app.log; i=$((i+1)); sleep 1; done volumeMounts: - name: logs mountPath: /var/log - name: count-log-1 image: busybox args: [/bin/sh, -c, \u0026#39;tail -n+1 -f /var/log/big-corp-app.log\u0026#39;] volumeMounts: - name: logs mountPath: /var/log volumes: - name: logs emptyDir: {} #éªŒè¯ï¼š kubectl logs big-corp-app -c count-log-1 16 Task - è‹±æ–‡ # Form the pod label name-cpu-loader,find pods running high CPU workloads and write the name of the pod consuming most CPU to the file /opt/KUTR00401/KURT00401.txt(which alredy exists).\næŸ¥çœ‹Podæ ‡ç­¾ä¸ºname=cpu-user-loader çš„CPUä½¿ç”¨ç‡å¹¶ä¸”æŠŠcpuä½¿ç”¨ç‡æœ€é«˜çš„podåç§°å†™å…¥/opt/KUTR00401/KUTR00401.txtæ–‡ä»¶é‡Œ\nkubectl top pods -l name=name-cpu-loader --sort-by=cpu echo \u0026#39;æ’åç¬¬ä¸€çš„podåç§°\u0026#39; \u0026gt;\u0026gt;/opt/KUTR00401/KUTR00401.txt 17 Task - è‹±æ–‡ # Task A Kubernetes worker node,named wk8s-node-0 is in state NotReady . Investigate why this is the case,and perform any appropriate steps to bring the node to a Ready state,ensuring that any changes are made permanent.\nYon can ssh to teh failed node using:\nssh wk8s-node-o You can assume elevated privileges on the node with the following command:\nsudo -i #åä¸ºwk8s-node-1 çš„èŠ‚ç‚¹å¤„äºNotReadyçŠ¶æ€ï¼Œå°†å…¶æ¢å¤æˆReadyçŠ¶æ€ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºå¼€æœºè‡ªå¯ # è¿æ¥åˆ°NotReadyèŠ‚ç‚¹ ssh wk8s-node-0 #è·å–æƒé™ sudo -i # æŸ¥çœ‹æœåŠ¡æ˜¯å¦è¿è¡Œæ­£å¸¸ systemctl status kubelet #å¦‚æœæœåŠ¡éæ­£å¸¸è¿è¡Œè¿›è¡Œæ¢å¤ systemctl start kubelet #è®¾ç½®å¼€æœºè‡ªå¯ systemctl enable kubelet 19 Task - è‹±æ–‡ # Set configuration context $ kubectl config use-context wk8s\nconfigure the kubelet systemed managed service, on the node labelled with name=wk8s-node-1,to launch a pod containing a single container of image nginx named myservice automatically.\nAny spec file requried should be placed in the /etc/kuberneteds/mainfests directory on the node\nHints:\nYou can ssh to the failed node using $ ssh wk8s-node-0\nYou can assume elevated privileges on the node with the following command $ sudo -i\né™æ€Podåˆ›å»ºæ–¹æ³•ä¸æ³¨æ„ç‚¹ # Set configuration context $ kubectl config use-context wk8s\nconfigure the kubelet systemed managed service, on the node labelled with name=wk8s-node-1,to launch a pod containing a single container of image nginx named myservice automatically.\nAny spec file requried should be placed in the /etc/kuberneteds/mainfests directory on the node\nHints:\nYou can ssh to the failed node using $ ssh wk8s-node-0\nYou can assume elevated privileges on the node with the following command $ sudo -i\nkubectl config use-context wk8s kubectl get node -l=name=wk8s-node-0 -o wide # or kubectl get node -l name=wk8s-node-0 -o wide sudo wk8s-node-0 sudo -i systemctl status kubelet -l |grep config #æ‰¾åˆ°--configé…ç½®çš„æ–‡ä»¶è·¯å¾„ cat /var/lib/kubelet/config.yaml |grep staticPodPath # å¾—åˆ°/etc/kubernetes/manifests cd /etc/kubernetes/manifests kubectl run myservice --image=nginx --dry-run=client -o yaml \u0026gt; myservice.yaml kubectl get pod -A|grep myservice #å¯ä»¥å¾—åˆ°é™æ€Pod Â» å‡†å¤‡CKA\n"},{"id":23,"href":"/cka/","title":"Cka","section":"","content":" ğŸ  é¦–é¡µ / CKA\nCKA # 001\nå‡†å¤‡CKA\nè€ƒé¢˜\n"},{"id":24,"href":"/cka/prepare-cka/","title":"Prepare Cka","section":"Cka","content":" ğŸ  é¦–é¡µ / CKA / å‡†å¤‡CKA\nå‡†å¤‡CKA # åŠç†æŠ¤ç…§ # ä¼˜æƒ åˆ¸ï¼š\nAffkub95-268483\nFrequently Asked Questions: CKA and CKAD \u0026amp; CKS - T\u0026amp;C DOC (linuxfoundation.org)\nÂ« 001\nÂ» è€ƒé¢˜\n"},{"id":25,"href":"/cka/tasks/","title":"Tasks","section":"Cka","content":" ğŸ  é¦–é¡µ / CKA / è€ƒé¢˜\nè€ƒé¢˜ # kubectl scale deployment nginx --replicas=3 åˆ›å»ºbusyboxï¼š\nkubectl run busybox --image=busybox --generator=run-pod/v1 --command=true -- sleep 7d # nslookup kubectl run nginx-dns --image=nginx kubectl run busybox --image=busybox --generator=run-pod/v1 --command=true -- sleep 7d kubectl exec -it busybox -- nslookup nginx-dns kubectl exec -it busybox -- nslookup \u0026lt;pod-ip\u0026gt; etcdå¤‡ä»½å’Œè¿˜åŸï¼š\nETCDCTL_API=3 etcdctl --endpoints=https://[127.0.0.1]:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt \\ --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key \\ snapshot save ETCDCTL_API=3 etcdctl --endpoints=https://[127.0.0.1]:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt \\ --name=master \\ --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key \\ --data-dir /var/lib/etcd-from-backup \\ --initial-cluster=master=https://127.0.0.1:2380 \\ --initial-cluster-token etcd-cluster-1 \\ --initial-advertise-peer-urls=https://127.0.0.1:2380 \\ snapshot restore ... Â« å‡†å¤‡CKA\n"},{"id":26,"href":"/cs/","title":"Cs","section":"","content":" ğŸ  é¦–é¡µ / è®¡ç®—æœºç§‘å­¦\nè®¡ç®—æœºç§‘å­¦ # äº’è”ç½‘å¦‚ä½•è¿ä½œï¼Ÿ\nç½‘ç»œé€šä¿¡\nè™šæ‹Ÿå†…å­˜\n"},{"id":27,"href":"/cs/internet/","title":"Internet","section":"Cs","content":" ğŸ  é¦–é¡µ / è®¡ç®—æœºç§‘å­¦ / äº’è”ç½‘å¦‚ä½•è¿ä½œï¼Ÿ\näº’è”ç½‘å¦‚ä½•è¿ä½œï¼Ÿ # æœ¬ç¯‡æ–‡ç« ç¿»è¯‘è‡ªï¼š åŸæ–‡åœ°å€\nä½œä¸ºå¼€å‘äººå‘˜ï¼Œæ·±å…¥äº†è§£äº’è”ç½‘æ˜¯ä»€ä¹ˆåŠå…¶å·¥ä½œåŸç†éå¸¸é‡è¦ã€‚å®ƒæ˜¯æ„å»ºå¤§å¤šæ•°ç°ä»£è½¯ä»¶åº”ç”¨ç¨‹åºçš„åŸºç¡€ã€‚ä¸ºäº†æ„å»ºæœ‰æ•ˆã€å®‰å…¨ä¸”å¯æ‰©å±•çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ï¼Œæ‚¨éœ€è¦æ·±å…¥äº†è§£äº’è”ç½‘çš„å·¥ä½œåŸç†ä»¥åŠå¦‚ä½•åˆ©ç”¨å…¶åŠŸèƒ½å’Œè¿æ¥æ€§ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»äº’è”ç½‘çš„åŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬å®ƒçš„å·¥ä½œåŸç†ã€ä¸€äº›åŸºæœ¬æ¦‚å¿µã€æœ¯è¯­å’Œä¸€äº›ç”¨äºåœ¨äº’è”ç½‘ä¸Šæ„å»ºåº”ç”¨ç¨‹åºå’ŒæœåŠ¡çš„é€šç”¨åè®®ã€‚\næˆ‘ä»¬æœ‰å¾ˆå¤šå†…å®¹è¦ä»‹ç»ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å§ï¼\näº’è”ç½‘ç®€ä»‹ # åœ¨äº†è§£ä»€ä¹ˆæ˜¯äº’è”ç½‘ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä»€ä¹ˆæ˜¯ç½‘ç»œã€‚ç½‘ç»œæ˜¯ä¸€ç»„ç›¸äº’è¿æ¥çš„è®¡ç®—æœºæˆ–å…¶ä»–è®¾å¤‡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å®¶é‡Œå¯èƒ½æœ‰ä¸€ä¸ªç”±è®¡ç®—æœºå’Œè®¾å¤‡ç»„æˆçš„ç½‘ç»œã€‚æ‚¨ä½åœ¨éš”å£çš„æœ‹å‹å¯èƒ½æœ‰ç±»ä¼¼çš„è®¾å¤‡ç½‘ç»œã€‚ä»–ä»¬çš„é‚»å±…å¯èƒ½æœ‰ç±»ä¼¼çš„è®¾å¤‡ç½‘ç»œã€‚æ‰€æœ‰è¿™äº›ç½‘ç»œè¿æ¥åœ¨ä¸€èµ·å°±å½¢æˆäº†äº’è”ç½‘ã€‚\näº’è”ç½‘æ˜¯ä¸€ä¸ªç½‘ç»œçš„ç½‘ç»œã€‚\näº’è”ç½‘æ˜¯ç¾å›½å›½é˜²éƒ¨äº 20 ä¸–çºª 60 å¹´ä»£æœ«å¼€å‘çš„ï¼Œä½œä¸ºåˆ›å»ºèƒ½å¤ŸæŠµå¾¡æ ¸æ”»å‡»çš„å»ä¸­å¿ƒåŒ–é€šä¿¡ç½‘ç»œçš„ä¸€ç§æ‰‹æ®µã€‚å¤šå¹´æ¥ï¼Œå®ƒå·²å‘å±•æˆä¸ºä¸€ä¸ªéå¸ƒå…¨çƒçš„å¤æ‚è€Œç²¾å¯†çš„ç½‘ç»œã€‚\nå¦‚ä»Šï¼Œäº’è”ç½‘å·²æˆä¸ºç°ä»£ç”Ÿæ´»çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸–ç•Œå„åœ°æ•°åäº¿äººä½¿ç”¨äº’è”ç½‘æ¥è·å–ä¿¡æ¯ã€ä¸æœ‹å‹å’Œå®¶äººäº¤æµã€å¼€å±•ä¸šåŠ¡ç­‰ç­‰ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œå¿…é¡»å……åˆ†äº†è§£äº’è”ç½‘çš„å·¥ä½œåŸç†ä»¥åŠæ”¯æ’‘äº’è”ç½‘çš„å„ç§æŠ€æœ¯å’Œåè®®ã€‚\näº’è”ç½‘å¦‚ä½•è¿ä½œï¼šæ¦‚è¿° # åœ¨è¾ƒé«˜å±‚é¢ä¸Šï¼Œäº’è”ç½‘çš„å·¥ä½œåŸç†æ˜¯ä½¿ç”¨ä¸€ç»„æ ‡å‡†åŒ–åè®®å°†è®¾å¤‡å’Œè®¡ç®—æœºç³»ç»Ÿè¿æ¥åœ¨ä¸€èµ·ã€‚è¿™äº›åè®®å®šä¹‰äº†è®¾å¤‡ä¹‹é—´å¦‚ä½•äº¤æ¢ä¿¡æ¯ï¼Œå¹¶ç¡®ä¿æ•°æ®å¯é ã€å®‰å…¨åœ°ä¼ è¾“ã€‚\näº’è”ç½‘çš„æ ¸å¿ƒæ˜¯äº’è¿è·¯ç”±å™¨çš„å…¨çƒç½‘ç»œï¼Œè´Ÿè´£å¼•å¯¼ä¸åŒè®¾å¤‡å’Œç³»ç»Ÿä¹‹é—´çš„æµé‡ã€‚å½“æ‚¨é€šè¿‡äº’è”ç½‘å‘é€æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šè¢«åˆ†è§£ä¸ºå°æ•°æ®åŒ…ï¼Œç„¶åä»æ‚¨çš„è®¾å¤‡å‘é€åˆ°è·¯ç”±å™¨ã€‚è·¯ç”±å™¨æ£€æŸ¥æ•°æ®åŒ…å¹¶å°†å…¶è½¬å‘åˆ°é€šå¾€ç›®çš„åœ°çš„è·¯å¾„ä¸­çš„ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸€ç›´æŒç»­åˆ°æ•°æ®åŒ…åˆ°è¾¾æœ€ç»ˆç›®çš„åœ°ã€‚\nä¸ºäº†ç¡®ä¿æ•°æ®åŒ…çš„æ­£ç¡®å‘é€å’Œæ¥æ”¶ï¼Œäº’è”ç½‘ä½¿ç”¨äº†å¤šç§åè®®ï¼ŒåŒ…æ‹¬äº’è”ç½‘åè®®ï¼ˆIPï¼‰å’Œä¼ è¾“æ§åˆ¶åè®®ï¼ˆTCPï¼‰ã€‚ IP è´Ÿè´£å°†æ•°æ®åŒ…è·¯ç”±åˆ°æ­£ç¡®çš„ç›®çš„åœ°ï¼Œè€Œ TCP ç¡®ä¿æ•°æ®åŒ…ä»¥æ­£ç¡®çš„é¡ºåºå¯é åœ°ä¼ è¾“ã€‚\né™¤äº†è¿™äº›æ ¸å¿ƒåè®®ä¹‹å¤–ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–æŠ€æœ¯å’Œåè®®ç”¨äºé€šè¿‡äº’è”ç½‘å®ç°é€šä¿¡å’Œæ•°æ®äº¤æ¢ï¼ŒåŒ…æ‹¬åŸŸåç³»ç»Ÿ (DNS)ã€è¶…æ–‡æœ¬ä¼ è¾“â€‹â€‹åè®® (HTTP) å’Œå®‰å…¨åè®®å¥—æ¥å­—å±‚/ä¼ è¾“å±‚å®‰å…¨ (SSL/TLS) åè®®ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæ·±å…¥äº†è§£è¿™äº›ä¸åŒçš„æŠ€æœ¯å’Œåè®®å¦‚ä½•ååŒå·¥ä½œä»¥å®ç°äº’è”ç½‘ä¸Šçš„é€šä¿¡å’Œæ•°æ®äº¤æ¢éå¸¸é‡è¦ã€‚\nåŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­ # è¦äº†è§£äº’è”ç½‘ï¼Œç†Ÿæ‚‰ä¸€äº›åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­å¾ˆé‡è¦ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›éœ€è¦æ³¨æ„çš„å…³é”®æœ¯è¯­å’Œæ¦‚å¿µï¼š\næ•°æ®åŒ…ï¼šé€šè¿‡äº’è”ç½‘ä¼ è¾“çš„å°æ•°æ®å•ä½ã€‚ è·¯ç”±å™¨ï¼šåœ¨ä¸åŒç½‘ç»œä¹‹é—´å¼•å¯¼æ•°æ®åŒ…çš„è®¾å¤‡ã€‚ IP åœ°å€ï¼šåˆ†é…ç»™ç½‘ç»œä¸Šæ¯ä¸ªè®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºå°†æ•°æ®è·¯ç”±åˆ°æ­£ç¡®çš„ç›®çš„åœ°ã€‚ åŸŸåï¼šç”¨äºè¯†åˆ«ç½‘ç«™çš„äººç±»å¯è¯»åç§°ï¼Œä¾‹å¦‚ google.comã€‚ DNSï¼šåŸŸåç³»ç»Ÿè´Ÿè´£å°†åŸŸåè½¬æ¢ä¸ºIPåœ°å€ã€‚ HTTPï¼šè¶…æ–‡æœ¬ä¼ è¾“â€‹â€‹åè®®ç”¨äºåœ¨å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ç½‘ç»œæµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ï¼ˆä¾‹å¦‚ç½‘ç«™ï¼‰ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚ HTTPSï¼šHTTP çš„åŠ å¯†ç‰ˆæœ¬ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æä¾›å®‰å…¨é€šä¿¡ã€‚ SSL/TLSï¼šå®‰å…¨å¥—æ¥å­—å±‚å’Œä¼ è¾“å±‚å®‰å…¨åè®®ç”¨äºé€šè¿‡äº’è”ç½‘æä¾›å®‰å…¨é€šä¿¡ã€‚ äº†è§£è¿™äº›åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­å¯¹äºä½¿ç”¨äº’è”ç½‘å’Œå¼€å‘åŸºäºäº’è”ç½‘çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡è‡³å…³é‡è¦ã€‚\nåè®®åœ¨äº’è”ç½‘ä¸­çš„ä½œç”¨ # åè®®åœ¨é€šè¿‡äº’è”ç½‘è¿›è¡Œé€šä¿¡å’Œæ•°æ®äº¤æ¢æ–¹é¢å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚åè®®æ˜¯ä¸€ç»„è§„åˆ™å’Œæ ‡å‡†ï¼Œå®šä¹‰è®¾å¤‡å’Œç³»ç»Ÿä¹‹é—´å¦‚ä½•äº¤æ¢ä¿¡æ¯ã€‚\näº’è”ç½‘é€šä¿¡ä¸­ä½¿ç”¨è®¸å¤šä¸åŒçš„åè®®ï¼ŒåŒ…æ‹¬äº’è”ç½‘åè®® (IP)ã€ä¼ è¾“æ§åˆ¶åè®® (TCP)ã€ç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP)ã€åŸŸåç³»ç»Ÿ (DNS) ç­‰ã€‚\nIP è´Ÿè´£å°†æ•°æ®åŒ…è·¯ç”±åˆ°æ­£ç¡®çš„ç›®çš„åœ°ï¼Œè€Œ TCP å’Œ UDP åˆ™ç¡®ä¿æ•°æ®åŒ…å¯é ä¸”é«˜æ•ˆåœ°ä¼ è¾“ã€‚ DNS ç”¨äºå°†åŸŸåè½¬æ¢ä¸º IP åœ°å€ï¼ŒHTTP ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚\nä½¿ç”¨æ ‡å‡†åŒ–åè®®çš„ä¸»è¦å¥½å¤„ä¹‹ä¸€æ˜¯å®ƒä»¬å…è®¸æ¥è‡ªä¸åŒåˆ¶é€ å•†å’Œä¾›åº”å•†çš„è®¾å¤‡å’Œç³»ç»Ÿå½¼æ­¤æ— ç¼é€šä¿¡ã€‚ä¾‹å¦‚ï¼Œä¸€å®¶å…¬å¸å¼€å‘çš„ Web æµè§ˆå™¨å¯ä»¥ä¸å¦ä¸€å®¶å…¬å¸å¼€å‘çš„ Web æœåŠ¡å™¨é€šä¿¡ï¼Œåªè¦å®ƒä»¬éƒ½éµå®ˆ HTTP åè®®ã€‚\nä½œä¸ºå¼€å‘äººå‘˜ï¼Œäº†è§£äº’è”ç½‘é€šä¿¡ä¸­ä½¿ç”¨çš„å„ç§åè®®ä»¥åŠå®ƒä»¬å¦‚ä½•ååŒå·¥ä½œä»¥å®ç°é€šè¿‡äº’è”ç½‘ä¼ è¾“æ•°æ®å’Œä¿¡æ¯éå¸¸é‡è¦ã€‚\näº†è§£ IP åœ°å€å’ŒåŸŸå # IP åœ°å€å’ŒåŸŸåéƒ½æ˜¯ä½¿ç”¨äº’è”ç½‘æ—¶éœ€è¦ç†è§£çš„é‡è¦æ¦‚å¿µã€‚\nIP åœ°å€æ˜¯åˆ†é…ç»™ç½‘ç»œä¸Šæ¯ä¸ªè®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å®ƒç”¨äºå°†æ•°æ®è·¯ç”±åˆ°æ­£ç¡®çš„ç›®çš„åœ°ï¼Œç¡®ä¿ä¿¡æ¯å‘é€åˆ°é¢„æœŸçš„æ”¶ä»¶äººã€‚ IP åœ°å€é€šå¸¸è¡¨ç¤ºä¸ºç”±å¥ç‚¹åˆ†éš”çš„ä¸€ç³»åˆ—å››ä¸ªæ•°å­—ï¼Œä¾‹å¦‚â€œ192.168.1.1â€ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒåŸŸåæ˜¯äººç±»å¯è¯»çš„åç§°ï¼Œç”¨äºè¯†åˆ«ç½‘ç«™å’Œå…¶ä»–äº’è”ç½‘èµ„æºã€‚å®ƒä»¬é€šå¸¸ç”±ä¸¤ä¸ªæˆ–å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼Œå¹¶ç”¨å¥ç‚¹åˆ†éš”ã€‚ä¾‹å¦‚ï¼Œâ€œgoogle.comâ€æ˜¯ä¸€ä¸ªåŸŸåã€‚ä½¿ç”¨åŸŸåç³»ç»Ÿ (DNS) å°†åŸŸåè½¬æ¢ä¸º IP åœ°å€ã€‚\nDNS æ˜¯äº’è”ç½‘åŸºç¡€è®¾æ–½çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œè´Ÿè´£å°†åŸŸåè½¬æ¢ä¸º IP åœ°å€ã€‚å½“æ‚¨åœ¨ Web æµè§ˆå™¨ä¸­è¾“å…¥åŸŸåæ—¶ï¼Œæ‚¨çš„è®¡ç®—æœºä¼šå‘ DNS æœåŠ¡å™¨å‘é€ DNS æŸ¥è¯¢ï¼Œè¯¥æœåŠ¡å™¨ä¼šè¿”å›ç›¸åº”çš„ IP åœ°å€ã€‚ç„¶åï¼Œæ‚¨çš„è®¡ç®—æœºä½¿ç”¨è¯¥ IP åœ°å€è¿æ¥åˆ°æ‚¨è¯·æ±‚çš„ç½‘ç«™æˆ–å…¶ä»–èµ„æºã€‚\nHTTP å’Œ HTTPS ç®€ä»‹ # HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“â€‹â€‹åè®®ï¼‰å’Œ HTTPSï¼ˆHTTP å®‰å…¨ï¼‰æ˜¯åŸºäºäº’è”ç½‘çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ä¸­æœ€å¸¸ç”¨çš„ä¸¤ç§åè®®ã€‚\nHTTP æ˜¯ç”¨äºåœ¨å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ç½‘ç»œæµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ï¼ˆä¾‹å¦‚ç½‘ç«™ï¼‰ä¹‹é—´ä¼ è¾“æ•°æ®çš„åè®®ã€‚å½“æ‚¨è®¿é—®ç½‘ç«™æ—¶ï¼Œæ‚¨çš„ç½‘ç»œæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ï¼Œè¯¢é—®æ‚¨è¯·æ±‚çš„ç½‘é¡µæˆ–å…¶ä»–èµ„æºã€‚ç„¶åï¼ŒæœåŠ¡å™¨å°†åŒ…å«è¯·æ±‚æ•°æ®çš„ HTTP å“åº”å‘é€å›å®¢æˆ·ç«¯ã€‚\nHTTPS æ˜¯ HTTP çš„æ›´å®‰å…¨ç‰ˆæœ¬ï¼Œå®ƒä½¿ç”¨ SSL/TLSï¼ˆå®‰å…¨å¥—æ¥å­—å±‚/ä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰åŠ å¯†æŠ€æœ¯å¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚è¿™æä¾›äº†é¢å¤–çš„å®‰å…¨å±‚ï¼Œæœ‰åŠ©äºä¿æŠ¤æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ç™»å½•å‡­æ®ã€æ”¯ä»˜ä¿¡æ¯å’Œå…¶ä»–ä¸ªäººæ•°æ®ã€‚\nå½“æ‚¨è®¿é—®ä½¿ç”¨ HTTPS çš„ç½‘ç«™æ—¶ï¼Œæ‚¨çš„ç½‘ç»œæµè§ˆå™¨å°†åœ¨åœ°å€æ ä¸­æ˜¾ç¤ºä¸€ä¸ªæŒ‚é”å›¾æ ‡ï¼Œè¡¨æ˜è¿æ¥æ˜¯å®‰å…¨çš„ã€‚æ‚¨è¿˜å¯èƒ½ä¼šåœ¨ç½‘ç«™åœ°å€å¼€å¤´çœ‹åˆ°å­—æ¯â€œhttpsâ€ï¼Œè€Œä¸æ˜¯â€œhttpâ€ã€‚\nä½¿ç”¨ TCP/IP æ„å»ºåº”ç”¨ç¨‹åº # TCP/IPï¼ˆä¼ è¾“æ§åˆ¶åè®®/äº’è”ç½‘åè®®ï¼‰æ˜¯å¤§å¤šæ•°åŸºäºäº’è”ç½‘çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ä½¿ç”¨çš„åº•å±‚é€šä¿¡åè®®ã€‚å®ƒåœ¨ä¸åŒè®¾å¤‡ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºä¹‹é—´æä¾›å¯é ã€æœ‰åºä¸”ç»è¿‡é”™è¯¯æ£€æŸ¥çš„æ•°æ®ä¼ è¾“ã€‚\nä½¿ç”¨ TCP/IP æ„å»ºåº”ç”¨ç¨‹åºæ—¶ï¼Œéœ€è¦ç†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š\nç«¯å£ï¼šç«¯å£ç”¨äºè¯†åˆ«è®¾å¤‡ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºæˆ–æœåŠ¡éƒ½åˆ†é…æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç«¯å£å·ï¼Œå…è®¸å°†æ•°æ®å‘é€åˆ°æ­£ç¡®çš„ç›®çš„åœ°ã€‚ å¥—æ¥å­—ï¼šå¥—æ¥å­—æ˜¯ IP åœ°å€å’Œç«¯å£å·çš„ç»„åˆï¼Œä»£è¡¨é€šä¿¡çš„ç‰¹å®šç«¯ç‚¹ã€‚å¥—æ¥å­—ç”¨äºåœ¨è®¾å¤‡ä¹‹é—´å»ºç«‹è¿æ¥å¹¶åœ¨åº”ç”¨ç¨‹åºä¹‹é—´ä¼ è¾“æ•°æ®ã€‚ è¿æ¥ï¼šå½“ä¸¤ä¸ªè®¾å¤‡æƒ³è¦ç›¸äº’é€šä¿¡æ—¶ï¼Œåœ¨ä¸¤ä¸ªå¥—æ¥å­—ä¹‹é—´å»ºç«‹è¿æ¥ã€‚åœ¨è¿æ¥å»ºç«‹è¿‡ç¨‹ä¸­ï¼Œè®¾å¤‡ä¼šåå•†å„ç§å‚æ•°ï¼Œä¾‹å¦‚æœ€å¤§æ®µå¤§å°å’Œçª—å£å¤§å°ï¼Œè¿™äº›å‚æ•°å†³å®šå¦‚ä½•é€šè¿‡è¿æ¥ä¼ è¾“æ•°æ®ã€‚ æ•°æ®ä¼ è¾“ï¼šä¸€æ—¦å»ºç«‹è¿æ¥ï¼Œå°±å¯ä»¥åœ¨æ¯ä¸ªè®¾å¤‡ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºä¹‹é—´ä¼ è¾“æ•°æ®ã€‚æ•°æ®é€šå¸¸åˆ†æ®µä¼ è¾“ï¼Œæ¯ä¸ªæ®µåŒ…å«åºåˆ—å·å’Œå…¶ä»–å…ƒæ•°æ®ä»¥ç¡®ä¿å¯é ä¼ è¾“ã€‚ ä½¿ç”¨ TCP/IP æ„å»ºåº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨éœ€è¦ç¡®ä¿åº”ç”¨ç¨‹åºè®¾è®¡ä¸ºå¯ä½¿ç”¨é€‚å½“çš„ç«¯å£ã€å¥—æ¥å­—å’Œè¿æ¥ã€‚æ‚¨è¿˜éœ€è¦ç†Ÿæ‚‰ TCP/IP å¸¸ç”¨çš„å„ç§åè®®å’Œæ ‡å‡†ï¼Œä¾‹å¦‚ HTTPã€FTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰å’Œ SMTPï¼ˆç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼‰ã€‚äº†è§£è¿™äº›æ¦‚å¿µå’Œåè®®å¯¹äºæ„å»ºæœ‰æ•ˆã€å¯æ‰©å±•ä¸”å®‰å…¨çš„åŸºäºäº’è”ç½‘çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡è‡³å…³é‡è¦ã€‚\nä½¿ç”¨ SSL/TLS ä¿æŠ¤äº’è”ç½‘é€šä¿¡ # æ­£å¦‚æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„ï¼ŒSSL/TLS æ˜¯ä¸€ç§ç”¨äºåŠ å¯†é€šè¿‡äº’è”ç½‘ä¼ è¾“çš„æ•°æ®çš„åè®®ã€‚å®ƒé€šå¸¸ç”¨äºä¸º Web æµè§ˆå™¨ã€ç”µå­é‚®ä»¶å®¢æˆ·ç«¯å’Œæ–‡ä»¶ä¼ è¾“ç¨‹åºç­‰åº”ç”¨ç¨‹åºæä¾›å®‰å…¨è¿æ¥ã€‚\nä½¿ç”¨ SSL/TLS ä¿æŠ¤äº’è”ç½‘é€šä¿¡æ—¶ï¼Œéœ€è¦äº†è§£ä¸€äº›å…³é”®æ¦‚å¿µï¼š\nè¯ä¹¦ï¼šSSL/TLS è¯ä¹¦ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¿¡ä»»ã€‚å®ƒä»¬åŒ…å«æœ‰å…³æœåŠ¡å™¨èº«ä»½çš„ä¿¡æ¯ï¼Œå¹¶ç”±å—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹ï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰ç­¾åä»¥éªŒè¯å…¶çœŸå®æ€§ã€‚\næ¡æ‰‹ï¼šåœ¨ SSL/TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤æ¢ä¿¡æ¯ä»¥åå•†å®‰å…¨è¿æ¥çš„åŠ å¯†ç®—æ³•å’Œå…¶ä»–å‚æ•°ã€‚\nåŠ å¯†ï¼šå»ºç«‹å®‰å…¨è¿æ¥åï¼Œæ•°æ®å°†ä½¿ç”¨çº¦å®šçš„ç®—æ³•è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å¯ä»¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®‰å…¨ä¼ è¾“ã€‚\nåœ¨æ„å»ºåŸºäº Internet çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡æ—¶ï¼Œäº†è§£ SSL/TLS çš„å·¥ä½œåŸç†å¹¶ç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºè®¾è®¡ä¸ºåœ¨ä¼ è¾“ç™»å½•å‡­æ®ã€æ”¯ä»˜ä¿¡æ¯å’Œå…¶ä»–ä¸ªäººæ•°æ®ç­‰æ•æ„Ÿæ•°æ®æ—¶ä½¿ç”¨ SSL/TLS éå¸¸é‡è¦ã€‚æ‚¨è¿˜éœ€è¦ç¡®ä¿ä¸ºæ‚¨çš„æœåŠ¡å™¨è·å–å¹¶ç»´æŠ¤æœ‰æ•ˆçš„ SSL/TLS è¯ä¹¦ï¼Œå¹¶éµå¾ªé…ç½®å’Œä¿æŠ¤ SSL/TLS è¿æ¥çš„æœ€ä½³å®è·µã€‚é€šè¿‡è¿™æ ·åšï¼Œæ‚¨å¯ä»¥å¸®åŠ©ä¿æŠ¤ç”¨æˆ·æ•°æ®å¹¶ç¡®ä¿åº”ç”¨ç¨‹åºé€šè¿‡äº’è”ç½‘è¿›è¡Œé€šä¿¡çš„å®Œæ•´æ€§å’Œæœºå¯†æ€§ã€‚\næœªæ¥ï¼šæ–°å…´è¶‹åŠ¿å’ŒæŠ€æœ¯ # äº’è”ç½‘åœ¨ä¸æ–­å‘å±•ï¼Œæ–°æŠ€æœ¯å’Œè¶‹åŠ¿ä¸æ–­æ¶Œç°ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œä¸ºäº†æ„å»ºåˆ›æ–°ä¸”æœ‰æ•ˆçš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ï¼Œäº†è§£æœ€æ–°çš„å‘å±•éå¸¸é‡è¦ã€‚\nä»¥ä¸‹æ˜¯å¡‘é€ äº’è”ç½‘æœªæ¥çš„ä¸€äº›æ–°å…´è¶‹åŠ¿å’ŒæŠ€æœ¯ï¼š\n5Gï¼š5Gæ˜¯æœ€æ–°ä¸€ä»£ç§»åŠ¨ç½‘ç»œæŠ€æœ¯ï¼Œä¸å‰å‡ ä»£ç›¸æ¯”ï¼Œé€Ÿåº¦æ›´å¿«ã€å»¶è¿Ÿæ›´ä½ã€å®¹é‡æ›´å¤§ã€‚é¢„è®¡å®ƒå°†å®ç°æ–°çš„ç”¨ä¾‹å’Œåº”ç”¨ï¼Œä¾‹å¦‚è‡ªåŠ¨é©¾é©¶è½¦è¾†å’Œè¿œç¨‹æ‰‹æœ¯ã€‚\nç‰©è”ç½‘ï¼ˆIoTï¼‰ï¼šç‰©è”ç½‘æ˜¯æŒ‡è¿æ¥åˆ°äº’è”ç½‘å¹¶å¯ä»¥äº¤æ¢æ•°æ®çš„ç‰©ç†è®¾å¤‡ã€è½¦è¾†ã€å®¶ç”¨ç”µå™¨å’Œå…¶ä»–ç‰©ä½“çš„ç½‘ç»œã€‚éšç€ç‰©è”ç½‘çš„ä¸æ–­å‘å±•ï¼Œé¢„è®¡å®ƒå°†å½»åº•æ”¹å˜åŒ»ç–—ä¿å¥ã€è¿è¾“å’Œåˆ¶é€ ç­‰è¡Œä¸šã€‚\näººå·¥æ™ºèƒ½ (AI)ï¼šæœºå™¨å­¦ä¹ å’Œè‡ªç„¶è¯­è¨€å¤„ç†ç­‰äººå·¥æ™ºèƒ½æŠ€æœ¯å·²è¢«ç”¨äºæ”¯æŒä»è¯­éŸ³åŠ©æ‰‹åˆ°æ¬ºè¯ˆæ£€æµ‹ç­‰å¹¿æ³›çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚éšç€äººå·¥æ™ºèƒ½çš„ä¸æ–­å‘å±•ï¼Œé¢„è®¡å®ƒå°†å‚¬ç”Ÿæ–°çš„ç”¨ä¾‹å¹¶æ”¹å˜åŒ»ç–—ä¿å¥ã€é‡‘èå’Œæ•™è‚²ç­‰è¡Œä¸šã€‚\nåŒºå—é“¾ï¼šåŒºå—é“¾æ˜¯ä¸€ç§åˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯ï¼Œå¯å®ç°å®‰å…¨ã€å»ä¸­å¿ƒåŒ–çš„äº¤æ˜“ã€‚å®ƒè¢«ç”¨æ¥ä¸ºä»åŠ å¯†è´§å¸åˆ°ä¾›åº”é“¾ç®¡ç†çš„å¹¿æ³›åº”ç”¨æä¾›æ”¯æŒã€‚\nè¾¹ç¼˜è®¡ç®—ï¼šè¾¹ç¼˜è®¡ç®—æ˜¯æŒ‡åœ¨ç½‘ç»œè¾¹ç¼˜è€Œä¸æ˜¯åœ¨é›†ä¸­å¼æ•°æ®ä¸­å¿ƒå¤„ç†å’Œå­˜å‚¨æ•°æ®ã€‚é¢„è®¡å®ƒå°†æ”¯æŒæ–°çš„ç”¨ä¾‹å’Œåº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚å®æ—¶åˆ†æå’Œä½å»¶è¿Ÿåº”ç”¨ç¨‹åºã€‚\né€šè¿‡åŠæ—¶äº†è§£è¿™äº›ä»¥åŠå…¶ä»–æ–°å…´è¶‹åŠ¿å’ŒæŠ€æœ¯ï¼Œæ‚¨å¯ä»¥ç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡èƒ½å¤Ÿåˆ©ç”¨æœ€æ–°åŠŸèƒ½å¹¶ä¸ºç”¨æˆ·æä¾›æœ€ä½³ä½“éªŒã€‚\nç»“è®º # è¿™å°±æ˜¯æœ¬æ–‡çš„ç»“å°¾ã€‚æˆ‘ä»¬å·²ç»æ¶µç›–äº†å¾ˆå¤šå†…å®¹ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬èŠ±ç‚¹æ—¶é—´å›é¡¾ä¸€ä¸‹æˆ‘ä»¬æ‰€å­¦åˆ°çš„å†…å®¹ï¼š\näº’è”ç½‘æ˜¯ä¸€ä¸ªç”±äº’è¿è®¡ç®—æœºç»„æˆçš„å…¨çƒç½‘ç»œï¼Œä½¿ç”¨ä¸€ç»„æ ‡å‡†çš„é€šä¿¡åè®®æ¥äº¤æ¢æ•°æ®ã€‚ äº’è”ç½‘çš„å·¥ä½œåŸç†æ˜¯ä½¿ç”¨æ ‡å‡†åŒ–åè®®ï¼ˆä¾‹å¦‚ IP å’Œ TCPï¼‰å°†è®¾å¤‡å’Œè®¡ç®—æœºç³»ç»Ÿè¿æ¥åœ¨ä¸€èµ·ã€‚ äº’è”ç½‘çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªç”±äº’è¿è·¯ç”±å™¨ç»„æˆçš„å…¨çƒç½‘ç»œï¼Œç”¨äºå¼•å¯¼ä¸åŒè®¾å¤‡å’Œç³»ç»Ÿä¹‹é—´çš„æµé‡ã€‚ æ‚¨éœ€è¦ç†Ÿæ‚‰çš„åŸºæœ¬æ¦‚å¿µå’Œæœ¯è¯­åŒ…æ‹¬æ•°æ®åŒ…ã€è·¯ç”±å™¨ã€IP åœ°å€ã€åŸŸåã€DNSã€HTTPã€HTTPS å’Œ SSL/TLSã€‚ åè®®åœ¨é€šè¿‡äº’è”ç½‘è¿›è¡Œé€šä¿¡å’Œæ•°æ®äº¤æ¢æ–¹é¢å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œå…è®¸æ¥è‡ªä¸åŒåˆ¶é€ å•†å’Œä¾›åº”å•†çš„è®¾å¤‡å’Œç³»ç»Ÿæ— ç¼é€šä¿¡ã€‚ æˆ‘å¸Œæœ›æ‚¨è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ç”¨ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–æ„è§ï¼Œè¯·éšæ—¶åœ¨ä¸‹é¢ç•™è¨€ã€‚è°¢è°¢é˜…è¯»ï¼\nÂ» ç½‘ç»œé€šä¿¡\n"},{"id":28,"href":"/cs/networking/","title":"Networking","section":"Cs","content":" ğŸ  é¦–é¡µ / è®¡ç®—æœºç§‘å­¦ / ç½‘ç»œé€šä¿¡\nç½‘ç»œé€šä¿¡ # I/O æ¨¡å‹ # ã€ŠUNIX ç½‘ç»œç¼–ç¨‹ã€‹ä¸­æ€»ç»“äº† 5 ç§ I/O æ¨¡å‹ï¼ŒåŒ…æ‹¬åŒæ­¥å’Œå¼‚æ­¥ I/Oï¼š\né˜»å¡ I/O (Blocking I/O) éé˜»å¡ I/O (Nonblocking I/O) I/O å¤šè·¯å¤ç”¨ (I/O multiplexing) ä¿¡å·é©±åŠ¨ I/O (Signal driven I/O) å¼‚æ­¥ I/O (Asynchronous I/O) æ“ä½œç³»ç»Ÿä¸Šçš„ I/O æ˜¯ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„æ•°æ®äº¤äº’ã€‚\nÂ« äº’è”ç½‘å¦‚ä½•è¿ä½œï¼Ÿ\nÂ» è™šæ‹Ÿå†…å­˜\n"},{"id":29,"href":"/cs/virtual-memory/","title":"Virtual Memory","section":"Cs","content":" ğŸ  é¦–é¡µ / è®¡ç®—æœºç§‘å­¦ / è™šæ‹Ÿå†…å­˜\nè™šæ‹Ÿå†…å­˜ # ä¸ºäº†æ›´åŠ æœ‰æ•ˆçš„ç®¡ç†å†…å­˜å¹¶ä¸”é™ä½å†…å­˜å‡ºé”™çš„æ¦‚ç‡ã€‚\nè®¡ç®—æœºå­˜å‚¨å™¨ # é€Ÿåº¦å¿« å®¹é‡å¤§ ä»·æ ¼ä¾¿å®œ ç±»å‹ï¼Œè‡ªä¸Šå‘ä¸‹åˆ†åˆ«æ˜¯å¯„å­˜å™¨ï¼Œé«˜é€Ÿç¼“å­˜ï¼Œä¸»å­˜ï¼ˆRAMï¼‰ï¼Œç£ç›˜ã€‚æˆæœ¬ä¸è®¿é—®é€Ÿåº¦è´Ÿç›¸å…³ã€‚\nå¯„å­˜å™¨çš„å®¹é‡ï¼š32 ä½ï¼š32x32 bitå—ï¼Œ64 ä½ï¼š64x64 bit\n1 ä¸ªå­—èŠ‚ï¼ˆBytesï¼‰ç­‰äº 8 bitï¼Œå› æ­¤ 1kb æ˜¯ 8x1024 bit\nä¸»å­˜ï¼ˆRAMï¼‰ä¸ CPU ç›´æ¥äº¤æ¢æ•°æ®çš„å†…éƒ¨å­˜å‚¨å™¨ã€‚\nç‰©ç†å†…å­˜ è™šæ‹Ÿå†…å­˜ è™šæ‹Ÿå†…å­˜æ ¸å¿ƒåŸç† # ä¸ºæ¯ä¸ªç¨‹åºè®¾ç½®ä¸€æ®µ\u0026quot;è¿ç»­\u0026quot;çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ŒæŠŠè¿™ä¸ªåœ°å€ç©ºé—´åˆ†å‰²æˆå¤šä¸ªå…·æœ‰è¿ç»­åœ°å€èŒƒå›´çš„é¡µ (Page)ï¼Œå¹¶æŠŠè¿™äº›é¡µå’Œç‰©ç†å†…å­˜åšæ˜ å°„ï¼Œåœ¨ç¨‹åºè¿è¡ŒæœŸé—´åŠ¨æ€æ˜ å°„åˆ°ç‰©ç†å†…å­˜ã€‚å½“ç¨‹åºå¼•ç”¨åˆ°ä¸€æ®µåœ¨ç‰©ç†å†…å­˜çš„åœ°å€ç©ºé—´æ—¶ï¼Œç”±ç¡¬ä»¶ç«‹åˆ»æ‰§è¡Œå¿…è¦çš„æ˜ å°„ï¼›è€Œå½“ç¨‹åºå¼•ç”¨åˆ°ä¸€æ®µä¸åœ¨ç‰©ç†å†…å­˜ä¸­çš„åœ°å€ç©ºé—´æ—¶ï¼Œç”±æ“ä½œç³»ç»Ÿè´Ÿè´£å°†ç¼ºå¤±çš„éƒ¨åˆ†è£…å…¥ç‰©ç†å†…å­˜å¹¶é‡æ–°æ‰§è¡Œå¤±è´¥çš„æŒ‡ä»¤ã€‚\nå†…å­˜äº¤æ¢ï¼ˆswapï¼‰ # åœ¨è¿›ç¨‹è¿è¡ŒæœŸé—´åªåˆ†é…æ˜ å°„å½“å‰ä½¿ç”¨åˆ°çš„å†…å­˜ï¼Œæš‚æ—¶ä¸ä½¿ç”¨çš„æ•°æ®åˆ™å†™å›ç£ç›˜ä½œä¸ºå‰¯æœ¬ä¿å­˜ï¼Œéœ€è¦ç”¨çš„æ—¶å€™å†è¯»å…¥å†…å­˜ï¼ŒåŠ¨æ€åœ°åœ¨ç£ç›˜å’Œå†…å­˜ä¹‹é—´äº¤æ¢æ•°æ®ã€‚\nå‚è€ƒ # è™šæ‹Ÿå†…å­˜ç²¾ç²¹ Â« ç½‘ç»œé€šä¿¡\n"},{"id":30,"href":"/dapr/","title":"Dapr","section":"","content":" ğŸ  é¦–é¡µ / Dapr\nDapr # Dapr 0-1\n"},{"id":31,"href":"/dapr/dapr/","title":"Dapr","section":"Dapr","content":" ğŸ  é¦–é¡µ / Dapr / Dapr 0-1\nDapr 0-1 # ä»‹ç» # Daprï¼ˆDistributed Application Runtimeï¼‰,æä¾›åˆ†å¸ƒå¼åº”ç”¨è¿è¡Œæ‰€éœ€è¦çš„ç¯å¢ƒã€‚\nSidecaræ¶æ„ã€‚\nç›®çš„ï¼š\nå¿«é€Ÿè½åœ°å¾®æœåŠ¡ï¼Œå°†ä¸šåŠ¡å’ŒåŸºç¡€è®¾æ–½åˆ†ç¦»ï¼Œä¸“æ³¨äºä¸šåŠ¡å¼€å‘ï¼Œé™ä½å¾®æœåŠ¡çš„å¤æ‚æ€§ã€‚\nè¿è¡Œç¯å¢ƒï¼š\næœåŠ¡å‘ç° è´Ÿè½½å‡è¡¡ æ•…éšœè½¬ç§» ç†”æ–­é™æµ ç¼“å­˜ å¼‚æ­¥é€šä¿¡ æ—¥å¿—ç»„ä»¶ é“¾è·¯ç›‘æ§ \u0026hellip; æ ¸å¿ƒåŠŸèƒ½ï¼š\nService Invocationï¼ˆæœåŠ¡è°ƒç”¨ï¼‰ State Managementï¼ˆçŠ¶æ€ç®¡ç†ï¼‰ Publish and Subscribeï¼ˆæ¶ˆæ¯å‘å¸ƒè®¢é˜…ï¼‰ Resource bingdings and triggersï¼ˆèµ„æºç»‘å®šï¼Œäº‹ä»¶è§¦å‘ï¼‰ Actorsï¼ˆå•çº¿ç¨‹æ¨¡å‹ï¼‰åˆ†å¸ƒå¼é” Observabilityï¼ˆé¥æµ‹ï¼‰ELKï¼Œé“¾è·¯ç›‘æ§ï¼Œå‘Šè­¦ Secretsï¼ˆå®‰å…¨ï¼‰IdentityServer4 å®‰è£… # ä¾èµ– # Dockerï¼š https://docs.docker.com/install/ æ³¨æ„ï¼šwindowså¹³å°ï¼ŒDockerå¿…é¡»è¿è¡ŒLinux Containersæ¨¡å¼\nå®‰è£…cli # https://github.com/dapr/cli\nä»¥åœ¨linuxä¸­å®‰è£…daprä¸ºä¾‹ï¼š\nwget -q https://raw.githubusercontent.com/dapr/cli/master/install/install.sh -O-|/bin/bash dapr init --runtime-version Service Invocation # è§£å†³å¾®æœåŠ¡ä¹‹é—´é€šä¿¡çš„é—®é¢˜ã€‚\n"},{"id":32,"href":"/design-pattern/","title":"Design Pattern","section":"","content":" ğŸ  é¦–é¡µ / è®¾è®¡æ¨¡å¼\nè®¾è®¡æ¨¡å¼ # CI/CD\n"},{"id":33,"href":"/design-pattern/cicd/","title":"Cicd","section":"Design Pattern","content":" ğŸ  é¦–é¡µ / è®¾è®¡æ¨¡å¼ / CI/CD\nCI/CD # Concepts # Pipeline # PipelineStage # Fieldsï¼š\nName Type Desc ID string PipelineID string PrevPipelineStageID string Status uint8 Pending, Runing, Success, Failed, Abort Name string PipelineStageTask # Fieldsï¼š\nName Type Desc ID string PipelineStageID string PrevPipelineStageTaskID string Image string Container image task running on. DindRequired boolean Docker in docker? DindImage string dependency DindRequired default: docker:18-dind. Scripts string CacheDirs string EnvironmentVariables string Status string EnvironmentVariables string EnvironmentVariables string "},{"id":34,"href":"/dev/","title":"Dev","section":"","content":" ğŸ  é¦–é¡µ / å¼€å‘\nå¼€å‘ # Apifox å¯¼å…¥ Kubernetes API\n"},{"id":35,"href":"/dev/Apifox-%E5%AF%BC%E5%85%A5-Kubernetes-API/","title":"Apifox å¯¼å…¥ Kubernetes API","section":"Dev","content":" ğŸ  é¦–é¡µ / å¼€å‘ / Apifox å¯¼å…¥ Kubernetes API\nApifox å¯¼å…¥ Kubernetes API # æœ¬æ¥æœ‰ä¸€ç§å¿«æ·æ–¹å¼ï¼Œä½†æ˜¯å¯¼å…¥æŠ¥é”™ï¼Œæç¤ºæ•°æ®æ ¼å¼ä¸å…¼å®¹ï¼š\nApifox ç›´æ¥ä»¥ Url æ–¹å¼å¯¼å…¥ï¼Œå¯¼å…¥åœ°å€å¦‚ä¸‹ï¼š\nhttps://github.com/kubernetes/kubernetes/blob/master/api/openapi-spec/swagger.json\nç¬¬ä¸€æ­¥ï¼Œæœ¬åœ°ä»£ç†ï¼š\nkubectl proxy --address 0.0.0.0 --accept-hosts \u0026#39;^*$\u0026#39; ç¬¬äºŒæ­¥ï¼Œæå– API json æ–‡ä»¶è‡³æœ¬åœ°ï¼š\ncurl http://localhost:8001/openapi/v2 \u0026gt; k8s-swagger.json ç¬¬ä¸‰æ­¥ï¼ŒApifox å¯¼å…¥å³å®Œæˆã€‚\n"},{"id":36,"href":"/devops/","title":"Devops","section":"","content":" ğŸ  é¦–é¡µ / DevOps\nDevOps # Agile\nAnsible\nè“ç»¿éƒ¨ç½²ã€æ»šåŠ¨éƒ¨ç½²å’Œç°åº¦éƒ¨ç½²\næ··æ²Œå·¥ç¨‹åŸåˆ™ ï¼ˆPRINCIPLES OF CHAOS ENGINEERINGï¼‰\nå•†ä¸šç”»å¸ƒ\nä½¿ç”¨grafanaç›‘æ§5xxæœåŠ¡\nä½¿ç”¨Grafanaç›‘æ§service\nGrafana\nJaeger\nnginx\n"},{"id":37,"href":"/devops/agile/","title":"Agile","section":"Devops","content":" ğŸ  é¦–é¡µ / DevOps / Agile\nAgile # æ•æ· äº¤ä»˜äº§å“å¯ä»¥çœ‹ä½œé¥­åº—ä¸Šèœ é¡¾å®¢ç‚¹äº†åä¸ªèœ åå¨æŠŠåä¸ªèœåšå®Œï¼Œæœ€ååä¸ªèœä¸€èµ·ä¸Šæ¡Œ â€”â€”ä¸æ•æ· åå¨åšå®Œä¸€ä¸ªèœå°±ä¸Šä¸€ä¸ªèœ â€”â€”æ•æ·\næ•æ·çš„ä¼˜ç‚¹ï¼š\nåšä¸€ç›˜ä¸Šä¸€ç›˜ï¼Œé¡¾å®¢æ—©æ—©å°±èƒ½åƒä¸Šäº†ï¼Œä¼˜å…ˆæ¨ªæ‰«é¥¥é¥¿ï¼›å°½æ—©ç»™ç”¨æˆ·ä½“éªŒä¸Šäº§å“ï¼› åšä¸€ç›˜ä¸Šä¸€ç›˜ï¼Œæ¯ä¸ªèœéƒ½æ˜¯æ–°å‡ºé”…ï¼Œé¡¾å®¢èƒ½åƒä¸Šä¸€å£çƒ­çš„ï¼›å¯¹æ¯”åç›˜èœä¸€èµ·ä¸Šï¼Œå¯èƒ½å…ˆç‚’çš„èœå·²ç»å‡‰äº†ï¼Œå‡‰çš„èœæ¢åšæˆäº§å“çš„è¯ï¼Œå¯èƒ½å°±æ˜¯å·²ç»è¿‡æ—¶çš„åŠŸèƒ½äº†ï¼Œä¸ç¬¦åˆéœ€æ±‚äº† åšä¸€ç›˜ä¸Šä¸€ç›˜ï¼Œ å¦‚æœå‰é¢çš„èœå’¸äº†ï¼Œå¯ä»¥åé¦ˆç»™é¥­åº—ï¼Œåé¢çš„èœåšæ·¡ç‚¹ï¼›å¯¹æ¯”åç›˜èœä¸€èµ·ä¸Šï¼Œé¡¾å®¢å°±æ— æ³•ä»ä¸­é—´åé¦ˆæ„è§äº†ï¼Œåšä¸€ä¸ªç”¨æˆ·æ’ä¸ä¸Šæ„è§çš„äº§å“ï¼Œä¸¥é‡çš„åæœå¯èƒ½æ˜¯ç”¨æˆ·å·²ç»ä¸æ„Ÿå…´è¶£äº†ã€‚ Â» Ansible\n"},{"id":38,"href":"/devops/ansible/","title":"Ansible","section":"Devops","content":" ğŸ  é¦–é¡µ / DevOps / Ansible\nAnsible # ä»‹ç» # ä¸€æ¬¾è½»é‡çº§çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œåªéœ€è¦ä¸€å°ä¸»æœºå®‰è£…Ansibleï¼Œä¾¿å¯ä»¥ç®¡ç†å…¶ä»–å¯è¿é€šçš„LinuxæœåŠ¡å™¨ã€‚\nå¼€æº\npython\nç‰¹ç‚¹ # è‡ªåŠ¨åŒ–å¼•æ“ï¼Œå®ç°ç®¡ç†é…ç½®ï¼Œåº”ç”¨éƒ¨ç½²ï¼ŒæœåŠ¡ç¼–æ’åŠå…¶ä»–å„ç§æœåŠ¡å™¨ç®¡ç†éœ€æ±‚ï¼› ä½¿ç”¨ç®€å•ï¼Œå…·æœ‰å®¢æˆ·ç«¯çš„ç‰¹ç‚¹ï¼› åŸºäºsshå®ç°é…ç½®ç®¡ç†ï¼› ä¾èµ–pythonï¼› åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒäº‘æœåŠ¡æ“ä½œã€‚ å®‰è£… # â€‹ ç”±äºAnsibleä½¿ç”¨Pythonå¼€å‘ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨pipå®‰è£…\npip install ansible â€‹ ä¹Ÿå¯ä»¥ä½¿ç”¨yumæˆ–apt-getå®‰è£…\nyum install ansible -y apt-get install ansible -y ansible --version â€‹ åªéœ€è¦åœ¨Control Nodeä¸Šå®‰è£…å³å¯ã€‚\nä¸»è¦æ¦‚å¿µ # Control nodeï¼š\nå®‰è£…äº†Ansibleçš„ä¸»æœºéƒ½å¯ä»¥ç§°ä¹‹ä¸ºControl nodeï¼Œåè¿‡æ¥è¯´ï¼ŒAnsibleå®‰è£…åœ¨Contriol Nodeä¸Šï¼›\nä¸€èˆ¬ä¸ºlinuxæœºå™¨ï¼ˆæ³¨ï¼šç›®å‰ä¹Ÿå·²ç»å¯¹windowsåšäº†æ”¯æŒï¼‰ã€‚\nManaged nodesï¼š\nå¾…ç®¡ç†çš„ç½‘ç»œè®¾å¤‡æˆ–è€…æœåŠ¡å™¨ï¼›\nlinuxæœºå™¨ï¼ˆå®‰è£…äº†pythonï¼‰ã€‚\nInventoryï¼š\nModulesï¼š\nTasksï¼š\nAnsibleé…ç½® # â€‹ é…ç½®æ–‡ä»¶ä½ç½®ï¼š/etc/ansible/ansible.cfgï¼Œä¸ºiniæ ¼å¼æ–‡ä»¶ã€‚\né…ç½®ç¤ºä¾‹ # â€‹ inventoryï¼šä¸»æœºæ¸…å•é…ç½®æ–‡ä»¶ä½ç½®ï¼Œåœ¨ä½¿ç”¨Ansibleå‘½ä»¤æ—¶ï¼Œä¹Ÿå¼€å§‹-i \u0026lt;path\u0026gt;æŒ‡å®šï¼›\nâ€‹ host_key_checkingï¼šå½“know_hostsä¸­ä¸å­˜åœ¨çš„ä¸»æœºï¼ˆå³å°šæœªè®¿é—®è¿‡çš„ä¸»æœºï¼Œæ˜¯å¦éœ€è¦è¾“å…¥å¯†é’¥ï¼‰ï¼›\nâ€‹ become_userï¼šsudoç”¨æˆ·ï¼›\nä¸»æœºæ¸…å•(Inventory) # â€‹ åœ¨ä¸€ä¸ªiniæˆ–yamlæ–‡ä»¶ä¸­ç®¡ç†Managed nodesæ¸…å•ï¼Œé»˜è®¤å®‰è£…ansibleåï¼Œåœ¨/etc/ansible/hostsæ–‡ä»¶ä¸­ç®¡ç†ï¼ˆåæ–‡ç»Ÿä¸€ç§°ä¹‹ä¸ºä¸»æœºæ¸…å•æ–‡ä»¶ï¼‰ï¼Œä¸€èˆ¬æ˜¯å°†maneged nodesçš„ip addressæˆ–host nameç­‰ä¿¡æ¯å­˜å‚¨åˆ°ä¸»æœºæ¸…å•æ–‡ä»¶ä¸­ã€‚\nFormats # â€‹ ä¸»æœºæ¸…å•æ–‡ä»¶æ ¼å¼å…¼å®¹ä¸¤ç§ï¼š\niniï¼Œå› ä¸ºé…ç½®æ–¹ä¾¿ç®€å•ï¼Œä¸€èˆ¬å¸¸é€‰ã€‚\nmail.example.com [webservers] foo.example.com bar.example.com yaml\nall: hosts: mail.example.com: children: webservers: hosts: foo.example.com: bar.example.com: Hosts # â€‹ é…ç½®éœ€è¦ç®¡ç†çš„ä¸»æœºhost nameæˆ–ip addressã€‚\nGroup # â€‹ å¦‚æœæƒ³ç®¡ç†æŸä¸€æ‰¹ä¸»æœºï¼Œå¯ä»¥å°†è¿™å¤šä¸ªhosté…ç½®åˆ°ç»Ÿä¸€ä¸ªgroupä¸‹ã€‚æ–¹ä¾¿å¯¹è¿™ç»„ä¸»æœºçš„æ‰¹é‡ç®¡ç†ã€‚\n[webserver] webserver01.com webserver02.com [dbserver] dbserver01.com dbserver02.com Groupå˜é‡ # ä½œç”¨åœ¨groupä¸Šçš„å˜é‡ã€‚\n[webserver] webserver01.com [webserver:vars] ansible_ssh_user=ubuntu Nested group # â€‹ ä¸€ä¸ªç»„åŒ…å«å…¶ä»–ç»„ã€‚\n[allserver:children] webserver dbserver Inventoryå†…ç½®å‚æ•° # å‚æ•°å å‚æ•°è¯´æ˜ ansible_ssh_host å®šä¹‰ä¸»æœºçš„sshåœ°å€ ansible_ssh_port å®šä¹‰ä¸»æœºçš„sshç«¯å£ ansible_ssh_user å®šä¹‰ä¸»æœºçš„sshè®¤è¯ç”¨æˆ· ansible_ssh_pass å®šä¹‰ä¸»æœºçš„sshè®¤è¯å¯†ç  ansible_sudo å®šä¹‰ä¸»æœºçš„sudoç”¨æˆ· ansible_sudo_pass å®šä¹‰ä¸»æœºçš„sudoå¯†ç  ansible_sudo_exe å®šä¹‰ä¸»æœºçš„sudoè·¯å¾„ ansible_connection å®šä¹‰ä¸»æœºè¿æ¥æ–¹å¼ï¼›ä¸ä¸»æœºçš„è¿æ¥ç±»å‹.æ¯”å¦‚ï¼šlocalï¼Œsshæˆ–è€…paramikoï¼›Ansible 1.2ä»¥å‰é»˜è®¤ä½¿ç”¨paramikoã€‚1.2ä»¥åçš„ç‰ˆæœ¬é»˜è®¤ä½¿ç”¨â€˜smartâ€™ï¼Œâ€˜smartâ€™æ–¹å¼ä¼šæ ¹æ®æ˜¯å¦æ”¯æŒControlPersistï¼Œæ¥åˆ¤æ–­sshæ–¹å¼æ˜¯å¦å¯è¡Œ ansible_ssh_private_key_file å®šä¹‰ä¸»æœºç§é’¥æ–‡ä»¶ ansible_shell_type å®šä¹‰ä¸»æœºshellç±»å‹ ansible_python_interpreter å®šä¹‰ä¸»æœºpythonè§£é‡Šå™¨è·¯å¾„ [webserver] webserver01.com webserver02.com [webserver:vars] ansible_ssh_private_key_file=~/singapore.pem æ¨¡å—(Modules) # â€‹ AnsibleåŠŸèƒ½çš„å•å…ƒï¼Œä¸€ä¸ªAnsibleåŠŸèƒ½å¯¹åº”æœ‰ä¸€ä¸ªModuleã€‚\nå¸¸ç”¨æ¨¡å— # file # è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚åˆ›å»ºåˆ é™¤æ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶æƒé™ç­‰ã€‚\npathï¼šæ‰§è¡Œæ–‡ä»¶ã€ç›®å½•çš„è·¯å¾„ recurseï¼šé€’å½’è®¾ç½®æ–‡ä»¶å±æ€§ï¼Œåªå¯¹ç›®å½•æœ‰æ•ˆ groupï¼šå®šä¹‰æ–‡ä»¶ã€ç›®å½•çš„å±ç»„ modeï¼šå®šä¹‰æ–‡ä»¶ã€ç›®å½•çš„æƒé™ ownerï¼šå®šä¹‰æ–‡ä»¶ã€ç›®å½•çš„æ‰€æœ‰è€… srcï¼šè¦è¢«é“¾æ¥çš„æºæ–‡ä»¶è·¯å¾„ï¼Œåªåº”ç”¨ä¸stateä¸ºlinkçš„æƒ…å†µ destï¼šè¢«é“¾æ¥åˆ°çš„è·¯å¾„ï¼Œåªåº”ç”¨äºstateä¸ºlinkçš„æƒ…å†µ forceï¼šåœ¨ä¸¤ç§æƒ…å†µä¸‹ä¼šå¼ºåˆ¶åˆ›å»ºè½¯é“¾æ¥ï¼Œä¸€ç§æ˜¯æºæ–‡ä»¶ä¸å­˜åœ¨ä½†ä¹‹åä¼šå»ºç«‹çš„æƒ…å†µï¼›ä¸€ç§æ˜¯ç›®æ ‡è½¯é“¾æ¥å·²ç»å­˜åœ¨ï¼Œéœ€è¦å…ˆå–æ¶ˆä¹‹å‰çš„è½¯é“¾æ¥ï¼Œç„¶ååˆ›å»ºæ–°çš„è½¯é“¾æ¥ï¼Œé»˜è®¤å€¼ noã€‚ ansible servers -m file -a \u0026#39;path=~/temp state=directory\u0026#39; # åˆ›å»ºç›®å½• ansible servers -m file -a \u0026#39;path=~/temp/test1.txt state=touch\u0026#39; # åˆ›å»ºæ–‡ä»¶ copy # å°†Control Nodeä¸Šçš„ç›®å½•æˆ–æ–‡ä»¶æ‹·è´è‡³Managed Nodesã€‚\nsrcï¼šæŒ‡å®šè¦å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶æˆ–ç›®å½•ã€‚å¦‚æœè·¯å¾„ä»¥ / ç»“å°¾ï¼Œåˆ™åªå¤åˆ¶ç›®å½•é‡Œçš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰ä»¥ / ç»“å°¾ï¼Œåˆ™å¤åˆ¶åŒ…å«ç›®å½•åœ¨å†…çš„æ•´ä¸ªå†…å®¹ destï¼šæ–‡ä»¶å¤åˆ¶çš„ç›®çš„åœ°ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œå¦‚æœæºæ–‡ä»¶æ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‚£ä¹ˆdestæŒ‡å‘çš„ä¹Ÿå¿…é¡»æ˜¯ä¸€ä¸ªç›®å½• forceï¼šé»˜è®¤å–å€¼ä¸ºyesï¼Œè¡¨ç¤ºç›®æ ‡ä¸»æœºåŒ…å«æ­¤æ–‡ä»¶ï¼Œä½†å†…å®¹ä¸åŒæ—¶ï¼Œè¦†ç›–ã€‚ backupï¼šé»˜è®¤å–å€¼ä¸ºnoï¼Œå¦‚æœä¸ºyesï¼Œåœ¨è¦†ç›–å‰å°†åŸæ–‡ä»¶è¿›è¡Œå¤‡ä»½ directory_modeï¼šé€’å½’è®¾å®šç›®å½•æƒé™ï¼Œé»˜è®¤ä¸ºç³»ç»Ÿé»˜è®¤æƒé™ othersï¼šæ‰€æœ‰fileæ¨¡å—é‡Œçš„é€‰é¡¹éƒ½å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ touch test2.txt ansible servers -m copy -a \u0026#39;src=test2.txt dest=~/temp/test2.txt\u0026#39; # æ‹·è´æ–‡ä»¶åˆ°æœåŠ¡å™¨ command # â€‹ ç›´æ¥è¦æ±‚ä¸»æœºæ¸…å•æ‰§è¡Œå‘½ä»¤ã€‚\nansible servers -m command -a \u0026#34;touch ~/temp/test3.txt\u0026#34; ansible servers -m command -a \u0026#34;sudo apt update\u0026#34; ansible servers -m command -a \u0026#34;sudo apt install nginx -y\u0026#34; ansible servers -m command -a \u0026#34;sudo apt autoremove nginx -y\u0026#34; ä¸æ”¯æŒshellå˜é‡ï¼Œå¦‚$NAME, \u0026lt;,\u0026gt;,\u0026amp;,| ç­‰\nshell # â€‹ å¯ä»¥å…ˆç¼–è¾‘shellè„šæœ¬ï¼Œç„¶åè¦æ±‚ä¸»æœºæ¸…å•æ‰§è¡Œshellè„šæœ¬é‡Œçš„å‘½ä»¤ã€‚\n- name: Execute the command in remote shell; stdout goes to the specified file on the remote. shell: somescript.sh \u0026gt;\u0026gt; somelog.txt - name: Change the working directory to somedir/ before executing the command. shell: somescript.sh \u0026gt;\u0026gt; somelog.txt args: chdir: somedir/ æ³¨æ„ï¼šshellè„šæœ¬å¿…é¡»æœ‰å¯æ‰§è¡Œçš„æƒé™\n- name: \u0026#39;chmod shell\u0026#39; command: chmod 777 somedir/somescript.sh apt # â€‹ ubuntu/debian åŒ…ã€åº”ç”¨ç®¡ç†ã€‚\nupdate_cache : yes/noï¼Œé»˜è®¤noï¼Œæ“ä½œä¹‹å‰æ˜¯å¦ apt-get update\nstate ï¼š\nabsent : ç§»é™¤ latest ï¼šæœ€æ–° present: ç›®å‰ç¨³å®šçš„ï¼Œé»˜è®¤ autoremove :yes/no,é»˜è®¤noï¼Œç§»é™¤ä¾èµ–\nautoclean ï¼šyes/no,é»˜è®¤noï¼Œç§»é™¤ç¼“å­˜\nansible servers -m apt -a \u0026#34;name=nginx update_cache=yes\u0026#34; -b # append to playbook - name: Install nginx apt: name: nginx state: latest update_cache: yes ansible servers -m apt -a \u0026#34;name=nginx state=absent autoremove=yes autoclean=yes\u0026#34; -b yum # â€‹ CentOsç®¡ç†ç¨‹åºåŒ…ã€‚\nservice # â€‹ ç®¡ç†æœåŠ¡çš„æ¨¡å—ï¼Œç”¨æ¥å¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡ã€‚\nenabled :yes/noï¼Œé»˜è®¤no.æ˜¯å¦å¼€æœºå¯åŠ¨ã€‚\nname ï¼šæœåŠ¡å\nstate ï¼š\nreloaded restarted started stopped sleep ï¼šå¦‚æœæ˜¯restartedï¼Œéœ€è¦ç­‰å¾…å¤šé•¿ç§’åå†é‡å¯ å¦‚ï¼š10ï¼Œç­‰å¾…10ç§’åé‡å¯\nansible servers -m service -a \u0026#34;name=nginx state=started\u0026#34; # playbook - name: Start service nginx, if not started service: name: nginx state: started ansible servers -m service -a \u0026#34;name=nginx state=stoped\u0026#34; unarchive # â€‹ è§£å‹ç¼©ã€‚\ngit # Managedéœ€è¦å·²ç»å®‰è£…gitã€‚\næ‰§è¡Œgitç›¸å…³æ“ä½œã€‚\nä»»åŠ¡(Tasks) # â€‹ Ansibleæ‰§è¡Œçš„å•å…ƒï¼Œä¸€èˆ¬æ”¾åœ¨Playbookä¸­ï¼Œå¤šä¸ªTaskä¸€èµ·æ‰§è¡Œï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œå¯å¤ç”¨ã€‚\nâ€‹ å®šä¹‰æ–¹å¼ï¼š\n-name: names module: action --- - name: ansible-playbook demo hosts: servers tasks: - name: create temp dir file: path: ~/temp state: directory - name: create test1.txt file: path: ~/temp/test1.txt state: touch - name: copy test2.txt copy: src: test2.txt dest: ~/temp/test2.txt - name: copy test.sh copy: src: test.sh dest: ~/temp/test.sh - name: \u0026#39;chmod shell\u0026#39; command: chmod 777 ~/temp/test.sh - name: exec shell shell: ~/temp/test.sh args: executable: /bin/bash Ansibleç”¨æ³• # ansibleå‘½ä»¤ # ansible \u0026lt;hosts\u0026gt; -m \u0026lt;module_name\u0026gt; -a \u0026lt;arguments\u0026gt; -i \u0026lt;hosts_path\u0026gt; hosts:\nall æˆ– *ï¼Œæ‰€æœ‰hostsæ–‡ä»¶ä¸­é…ç½®çš„ä¸»æœº ip address host name group name å¤šä¸ªhostæˆ–groupå¯ç”¨ï¼šåˆ†éš” æ”¯æŒæ­£åˆ™åŒ¹é…ï¼šå¦‚é…ç½®äº†ä¸€ä¸ªwebserverçš„ä¸»æœºï¼Œå¯ç”¨ansible ~web* -m pingåŒ¹é…åˆ° module_nameï¼šä¾‹å¦‚pingï¼Œcommandï¼Œaptçš„ä»»åŠ¡æ¨¡å—\narguments: æ‰§è¡Œmoduleçš„å‚æ•°ï¼Œä¾‹å¦‚ ansible -m command -a \u0026quot;touch hello.txt\u0026quot;\nhosts_pathï¼šä¸»æœºæ¸…å•æ–‡ä»¶ä½ç½®ï¼Œé»˜è®¤/etc/ansible/etcï¼Œä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®š\nAnsibleå‘½ä»¤å‚æ•° # [-h] # å¸®åŠ© [--version] # Ansibleç‰ˆæœ¬ [-v] # verbost [-b] # sudoè¿è¡Œï¼Œå¯ä»¥ä»¥sudoæƒé™è¿è¡Œ [--become-method BECOME_METHOD] [--become-user BECOME_USER] [-K] # æç¤ºè¾“å…¥sudoå¯†ç ï¼Œå½“ä¸æ˜¯NOPASSWDæ¨¡å¼æ—¶ä½¿ç”¨ [-i INVENTORY] # æŒ‡å®šhostsæ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤default=/etc/ansible/hosts [--list-hosts] # æ‰“å°æœ‰ä¸»æœºåˆ—è¡¨ [-o] # å‹ç¼©è¾“å‡ºï¼Œæ‘˜è¦è¾“å‡º [-t TREE] [-k] # æç¤ºè¾“å…¥sshç™»å½•å¯†ç ã€‚å½“ä½¿ç”¨å¯†ç éªŒè¯çš„æ—¶å€™ç”¨ [--private-key PRIVATE_KEY_FILE] # sshè¿æ¥çš„ç§é’¥æ–‡ä»¶ä½ç½® [-u REMOTE_USER] # sshè¿æ¥çš„ç”¨æˆ·åï¼Œé»˜è®¤ç”¨rootï¼Œansible.cfgä¸­å¯ä»¥é…ç½® [-c CONNECTION] # è¿æ¥ç±»å‹ï¼ˆdefault=smartï¼‰ï¼Œä¾‹å¦‚è¿˜æœ‰local [-T TIMEOUT] # è¶…æ—¶é™åˆ¶ [--ask-vault-pass | --vault-password-file VAULT_PASSWORD_FILES] [-f FORKS] # forkå¤šå°‘ä¸ªè¿›ç¨‹å¹¶å‘å¤„ç†ï¼Œé»˜è®¤ä¸º5ä¸ª [-M MODULE_PATH] # æ¨¡å—çš„æ‰§è¡Œæ–‡ä»¶ä½ç½®ï¼Œä¸€èˆ¬ç”¨äºæ‰©å±•æ¨¡å— [--playbook-dir BASEDIR] [-a MODULE_ARGS] # æ¨¡å—çš„å‚æ•° [-m MODULE_NAME] # è¦æ‰§è¡Œçš„æ¨¡å—ï¼Œé»˜è®¤ä¸ºcommand Anisble playbook # â€‹ é¢„å…ˆå®šä¹‰å¥½æ‰€æœ‰éœ€è¦æ‰§è¡Œçš„æ“ä½œï¼Œå½¢æˆä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œæ‰§è¡Œè¯¥è„šæœ¬æ–‡ä»¶å³å¯ï¼Œæ–¹ä¾¿ç®¡ç†å’Œå¤ç”¨ã€‚\nansible-playbook -i \u0026lt;hosts_path\u0026gt; \u0026lt;playbook_path\u0026gt; hosts_pathï¼šä¸»æœºæ¸…å•æ–‡ä»¶ä½ç½®\nplaybook_path: playbook yamlæ–‡ä»¶ä½ç½®\n-Cï¼šåŠ åœ¨ansible-playbookå‘½ä»¤åï¼Œç”¨äºéªŒè¯palybookæ–‡ä»¶æ˜¯å¦æœ‰è¯¯\n--- - name: Install prometheus on ubuntu hosts: prometheus become: yes tasks: - name: \u0026#34;Step 1: Import prometheus public GPG Key\u0026#34; apt_key: url: https://s3-eu-west-1.amazonaws.com/deb.robustperception.io/41EFC99D.gpg state: present - name: \u0026#34;Step 2: Reload local package database\u0026#34; apt: update_cache: yes - name: \u0026#34;Step 3: Install prometheus\u0026#34; apt: name: prometheus update_cache: yes - name: \u0026#34;Step 4: Install prometheus-node-exporter\u0026#34; apt: name: prometheus-node-exporter update_cache: yes - name: \u0026#34;Step 5: Install prometheus-pushgateway\u0026#34; apt: name: prometheus-pushgateway update_cache: yes - name: \u0026#34;Step 6: Install prometheus-alertmanager\u0026#34; apt: name: prometheus-alertmanager update_cache: yes - name: \u0026#34;Step 7: Start prometheus service\u0026#34; service: name: prometheus enabled: yes state: started playbook å‚æ•° # name ï¼šæ ‡è¯†plaoybookæ–‡ä»¶æ‰§è¡Œå†…å®¹\nhosts: inventory\nbecome: yes/noï¼Œé»˜è®¤noï¼Œæ˜¯å¦ä½¿ç”¨sudoæ‰§è¡Œ\ntasks : é¢„å…ˆå®šä¹‰å¥½çš„ansibleå‘½ä»¤ï¼Œmanaged nodeå°†ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ\nhandles: ä½¿ç”¨notifyè§¦å‘\n# ä¿®æ”¹nginxé…ç½®åï¼Œè®¾ç½®é‡å¯ - name: write the nginx config file template: src=/somepath/nginx.j2 dest=/data/nginx/conf/nginx.conf notify: - restart nginx handlers: - name: enable nginx service: name=nginx state=restarted when: å½“æ»¡è¶³æ¡ä»¶æ—¶æ‰æ‰§è¡Œï¼Œå¤šæ¡ä»¶å¯ä»¥ä½¿ç”¨andã€or\ntasks: - name: \u0026#34;shut down Debian flavored systems\u0026#34; command: /sbin/shutdown -t now when: ansible_os_family == \u0026#34;Debian\u0026#34; å¸¸ç”¨ç”¨æ³•**ï¼š\n# --list-hosts(ç®€å†™ä¸º--list) ansible webserver --list-hosts AnsibleåŸç† # ansibleå‘½ä»¤\nansibleå‘½ä»¤æ‰€ä½¿ç”¨çš„æ¨¡å—ï¼Œå‚æ•°\næ¼”ç¤º # ansible.cfg host_key_checking = False remote_tmp = /tmp/.ansible-${USER}/tmp hostsä¸»æœºæ¸…å• [ubuntu:vars] ansible_ssh_private_key_file=~/singapore.pem [ubuntu] 172.30.2.252 ansible_ssh_user=ubuntu [mysql:vars] ansible_private_key_file=~/dev-mysql.pem [mysql] 172.31.22.159 ansible_ssh_user=ubuntu [servers:children] ubuntu mysql ansibleæ“ä½œ æ–‡ä»¶æ“ä½œ\n# åˆ›å»ºç›®å½• ansible servers -m file -a \u0026#39;path=~/temp state=directory mode=0755\u0026#39; # åˆ›å»ºæ–‡ä»¶ ansible servers -m file -a \u0026#39;path=~/temp/test1.txt state=touch\u0026#39; # Control Nodeåˆ†å‘æ–‡ä»¶è‡³Managed Nodes ansible servers -m copy -a \u0026#39;src=index.html dest=~/temp/test2.txt\u0026#39; è¸©å‘è®°å½• # é—®é¢˜1\nè¿æ¥awsçš„linuxå®ä¾‹æ—¶ï¼Œéœ€è¦åœ¨/etc/ansible/hostså®šä¹‰çš„å‚æ•°\n[ubuntu:vars] ansible_private_key_file=/home/ubuntu/singapore.pem [ubuntu] 192.168.0.1 ansible_ssh_user=ubuntu é—®é¢˜2\nä½¿ç”¨dockeråˆ›å»ºå¯ä»¥sshè¿æ¥çš„ubuntuå®¹å™¨ï¼Œæ— æ³•ä½¿ç”¨rootè¿æ¥ï¼Œä½†æ˜¯ä½¿ç”¨å…¶ä»–useræ—¶ï¼Œåœ¨ansible local -m pingæ—¶ä¹Ÿä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜ã€‚\nAuthentication or permission failure. In some cases, you may have been able to authenticate and did not have permissions on the remote directory. Consider changing the remote temp path in ansible.cfg to a path rooted in \u0026#34;/tmp\u0026#34;.... å…¶å®ä¸Šé¢çš„ä¿¡æ¯å·²ç»æœ‰äº†ä¸€äº›æç¤ºï¼Œä¿®æ”¹/etc/ansible/ansible.cfgçš„remote_tmpé…ç½®\nremote_tmp = /tmp/.ansible-${USER}/tmp é—®é¢˜3\nå¦‚æœåœ¨ä½¿ç”¨pemæ–‡ä»¶è¿æ¥æœåŠ¡å™¨æ—¶é‡åˆ°Permissions 0664 for '/home/ubuntu/dev-mysql.pem' are too open.\\r\\nIt is required that your private key files are NOT accessible by others.é—®é¢˜ã€‚\nä¿®æ”¹æ–‡ä»¶æƒé™å³å¯\nsudo chmod 400 /path/to/file.pem é—®é¢˜4\nFailed to lock apt for exclusive operation\næ·»åŠ \nbecome: yes å…¶ä»– # é¢„ç¼–è¯‘ # pythonçš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜ # ansible v2.7åŠæ›´é«˜ç‰ˆæœ¬é»˜è®¤ä¼˜å…ˆæ”¯æŒpython3ï¼Œå¦‚æœå¯¹ç‰¹å®šçš„hostæ”¯æŒå•ç‹¬çš„pythonç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ansible_python_interpreter inventoryå‚æ•°è®¾ç½®ã€‚\n[webservers] webserver1.com ansible_python_interpreter=/usr/bin/python2.4 å·¥å…·å¯¹æ¯” # å‚è€ƒ # Ansibleå…¥é—¨\nAnsible Docs\nÂ« Agile\nÂ» è“ç»¿éƒ¨ç½²ã€æ»šåŠ¨éƒ¨ç½²å’Œç°åº¦éƒ¨ç½²\n"},{"id":39,"href":"/devops/bule-green-rollback-gray/","title":"Bule Green Rollback Gray","section":"Devops","content":" ğŸ  é¦–é¡µ / DevOps / è“ç»¿éƒ¨ç½²ã€æ»šåŠ¨éƒ¨ç½²å’Œç°åº¦éƒ¨ç½²\nè“ç»¿éƒ¨ç½²ã€æ»šåŠ¨éƒ¨ç½²å’Œç°åº¦éƒ¨ç½² # ç›´æ¥ä¸¾ä¾‹è¯´æ˜ï¼š\nç°ç¯å¢ƒä¸­è¿è¡Œç€3ä¸ªV1ç‰ˆæœ¬çš„å®ä¾‹ï¼Œè®¡åˆ’æ›´æ–°åˆ°V2ç‰ˆæœ¬ã€‚\nè“ç»¿éƒ¨ç½² # ç›´æ¥ä½¿ç”¨æ–°çš„æœåŠ¡èµ„æºéƒ¨ç½²3ä¸ªV2ç‰ˆæœ¬å®ä¾‹ï¼ˆä»ç„¶ä¿ç•™3ä¸ªV1ç‰ˆæœ¬ï¼‰ï¼Œç„¶åå°†è¯·æ±‚æµé‡å…¨éƒ¨è½¬åˆ°V2ç‰ˆæœ¬ã€‚\nä¼˜ç‚¹ï¼š\næ— éœ€ä¸­æ–­æœåŠ¡ï¼›\næœ‰å›æ—‹çš„ä½™åœ°ï¼Œå¦‚æœV2ç‰ˆæœ¬æœ‰bugçš„è¯ï¼Œå¯ä»¥å¾ˆå¿«é€Ÿçš„é‡æ–°å›åˆ°V1ç‰ˆæœ¬ã€‚\nç¼ºç‚¹ï¼š\nèµ„æºå ç”¨è¾ƒå¤§ï¼Œåœ¨å‘å¸ƒè¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°6ä¸ªå®ä¾‹çš„æœåŠ¡èµ„æºã€‚\næ»šåŠ¨éƒ¨ç½² # ç°åœæ‰ä¸€ä¸ªV1ç‰ˆæœ¬çš„å®ä¾‹ï¼Œå¾…å…¶åœæ­¢åï¼Œéƒ¨ç½²ä¸€ä¸ªV2ç‰ˆæœ¬çš„å®ä¾‹ï¼ŒV2å®ä¾‹éƒ¨ç½²æˆåŠŸä¹‹åï¼Œå†åœæ‰ä¸€ä¸ªV1å®ä¾‹ï¼Œå¾€å¤ï¼Œç›´è‡³å…¨éƒ¨æ›¿æ¢ä¸ºV2ç‰ˆæœ¬å®ä¾‹ã€‚\nä¼˜ç‚¹ï¼š\næ— éœ€ä¸­æ–­æœåŠ¡ï¼›\néƒ¨ç½²æ–°ç‰ˆæœ¬æ—¶æ— éœ€å¢åŠ æœåŠ¡èµ„æºï¼ŒèŠ‚çœæˆæœ¬ã€‚\nç¼ºç‚¹ï¼š\nV2ç‰ˆæœ¬æœ‰bugçš„è¯ï¼Œä¸èƒ½åŠæ—¶å›æ»šã€‚\nç°åº¦éƒ¨ç½² # ä¹Ÿå«é‡‘ä¸é›€éƒ¨ç½²ï¼Œåœæ‰ä¸€ä¸ªV1ç‰ˆæœ¬çš„å®ä¾‹ï¼Œéƒ¨ç½²ä¸€ä¸ªV2ç‰ˆæœ¬çš„å®ä¾‹ï¼Œå°†éƒ¨åˆ†ç”¨æˆ·è¯·æ±‚æµé‡çš„è½¬åˆ°V2ç‰ˆæœ¬ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå†é€æ­¥æ›¿æ¢V1ç‰ˆæœ¬ã€‚A/Bæµ‹è¯•å°±æ˜¯ä¸€ç§ç°åº¦å‘å¸ƒã€‚\nä¼˜ç‚¹ï¼š\næ— éœ€ä¸­æ–­æœåŠ¡ï¼›\nåŒæ ·æ— éœ€å¢åŠ æœåŠ¡å™¨ï¼Œèƒ½è¾ƒä¸ºå¹³ç¨³çš„è¿‡æ¸¡åˆ°æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”å½“æœ‰bugæ—¶ä¹Ÿèƒ½åšåˆ°å¿«é€Ÿå›æ»šã€‚\nÂ« Ansible\nÂ» æ··æ²Œå·¥ç¨‹åŸåˆ™ ï¼ˆPRINCIPLES OF CHAOS ENGINEERINGï¼‰\n"},{"id":40,"href":"/devops/chaos-engineering/","title":"Chaos Engineering","section":"Devops","content":" ğŸ  é¦–é¡µ / DevOps / æ··æ²Œå·¥ç¨‹åŸåˆ™ ï¼ˆPRINCIPLES OF CHAOS ENGINEERINGï¼‰\næ··æ²Œå·¥ç¨‹åŸåˆ™ ï¼ˆPRINCIPLES OF CHAOS ENGINEERINGï¼‰ # http://principlesofchaos.org/ ç®€ä½“ä¸­æ–‡ç‰ˆ\næ··æ²Œå·¥ç¨‹æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸Šè¿›è¡Œå®éªŒçš„å­¦ç§‘, ç›®çš„æ˜¯å»ºç«‹å¯¹ç³»ç»ŸæŠµå¾¡ç”Ÿäº§ç¯å¢ƒä¸­å¤±æ§æ¡ä»¶çš„èƒ½åŠ›ä»¥åŠä¿¡å¿ƒã€‚ï¼š\nå¤§è§„æ¨¡åˆ†å¸ƒå¼è½¯ä»¶ç³»ç»Ÿçš„å‘å±•æ­£åœ¨æ”¹å˜è½¯ä»¶å·¥ç¨‹ã€‚ä½œä¸ºä¸€ä¸ªè¡Œä¸šï¼Œæˆ‘ä»¬å¾ˆå¿«é‡‡ç”¨äº†æé«˜å¼€å‘çµæ´»æ€§å’Œéƒ¨ç½²é€Ÿåº¦çš„å®è·µã€‚ç´§éšç€è¿™äº›ä¼˜ç‚¹çš„ä¸€ä¸ªè¿«åˆ‡é—®é¢˜æ˜¯ï¼šæˆ‘ä»¬å¯¹æŠ•å…¥ç”Ÿäº§çš„å¤æ‚ç³»ç»Ÿæœ‰å¤šå°‘ä¿¡å¿ƒï¼Ÿ\nå³ä½¿åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰å•ä¸ªæœåŠ¡éƒ½æ­£å¸¸è¿è¡Œ, è¿™äº›æœåŠ¡ä¹‹é—´çš„äº¤äº’ä¹Ÿä¼šå¯¼è‡´ä¸å¯é¢„çŸ¥çš„ç»“æœã€‚ è¿™äº›ä¸å¯é¢„çŸ¥çš„ç»“æœ, ç”±å½±å“ç”Ÿäº§ç¯å¢ƒçš„ç½•è§ä¸”ç ´åæ€§çš„äº‹ä»¶å¤åˆè€Œæˆï¼Œä»¤è¿™äº›åˆ†å¸ƒå¼ç³»ç»Ÿå­˜åœ¨å†…åœ¨çš„æ··æ²Œã€‚\næˆ‘ä»¬éœ€è¦åœ¨å¼‚å¸¸è¡Œä¸ºå‡ºç°ä¹‹å‰ï¼Œåœ¨æ•´ä¸ªç³»ç»Ÿå†…æ‰¾å‡ºè¿™äº›å¼±ç‚¹ã€‚è¿™äº›å¼±ç‚¹åŒ…æ‹¬ä»¥ä¸‹å½¢å¼:\nå½“æœåŠ¡ä¸å¯ç”¨æ—¶çš„ä¸æ­£ç¡®å›æ»šè®¾ç½®; ä¸å½“çš„è¶…æ—¶è®¾ç½®å¯¼è‡´çš„é‡è¯•é£æš´; ç”±äºä¸‹æ¸¸ä¾èµ–çš„æµé‡è¿‡è½½å¯¼è‡´çš„æœåŠ¡ä¸­æ–­; å•ç‚¹æ•…éšœæ—¶çš„çº§è”å¤±è´¥ç­‰ã€‚ æˆ‘ä»¬å¿…é¡»ä¸»åŠ¨çš„å‘ç°è¿™äº›é‡è¦çš„å¼±ç‚¹ï¼Œåœ¨è¿™äº›å¼±ç‚¹é€šè¿‡ç”Ÿäº§ç¯å¢ƒæš´éœ²ç»™æˆ‘ä»¬çš„ç”¨æˆ·ä¹‹å‰ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥ç®¡ç†è¿™äº›ç³»ç»Ÿå›ºæœ‰çš„æ··æ²Œ, é€šè¿‡å¢åŠ çš„çµæ´»æ€§å’Œé€Ÿç‡ä»¥æå‡æˆ‘ä»¬å¯¹ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„ä¿¡å¿ƒ, å°½ç®¡ç³»ç»Ÿçš„å¤æ‚æ€§æ˜¯ç”±è¿™äº›éƒ¨ç½²æ‰€å¯¼è‡´çš„ã€‚\næˆ‘ä»¬é‡‡ç”¨åŸºäºç»éªŒå’Œç³»ç»Ÿçš„æ–¹æ³•è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨è§„æ¨¡å¢é•¿æ—¶å¼•å‘çš„é—®é¢˜, å¹¶ä»¥æ­¤å»ºç«‹å¯¹ç³»ç»ŸæŠµå¾¡è¿™äº›äº‹ä»¶çš„èƒ½åŠ›å’Œä¿¡å¿ƒã€‚é€šè¿‡åœ¨å—æ§å®éªŒä¸­è§‚å¯Ÿåˆ†å¸ƒå¼ç³»ç»Ÿçš„è¡Œä¸ºæ¥äº†è§£å®ƒçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ··æ²Œå·¥ç¨‹ã€‚\næ··æ²Œå·¥ç¨‹å®è·µ # ä¸ºäº†å…·ä½“åœ°è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨è§„æ¨¡ä¸Šçš„ä¸ç¡®å®šæ€§ï¼Œå¯ä»¥æŠŠæ··æ²Œå·¥ç¨‹çœ‹ä½œæ˜¯ä¸ºäº†æ­ç¤ºç³»ç»Ÿå¼±ç‚¹è€Œè¿›è¡Œçš„å®éªŒã€‚è¿™äº›å®éªŒéµå¾ªå››ä¸ªæ­¥éª¤ï¼š\né¦–å…ˆï¼Œç”¨ç³»ç»Ÿåœ¨æ­£å¸¸è¡Œä¸ºä¸‹çš„ä¸€äº›å¯æµ‹é‡çš„è¾“å‡ºæ¥å®šä¹‰â€œç¨³å®šçŠ¶æ€â€ã€‚ å…¶æ¬¡ï¼Œå‡è®¾è¿™ä¸ªåœ¨æ§åˆ¶ç»„å’Œå®éªŒç»„éƒ½ä¼šç»§ç»­ä¿æŒç¨³å®šçŠ¶æ€ã€‚ ç„¶åï¼Œåœ¨å®éªŒç»„ä¸­å¼•å…¥åæ˜ çœŸå®ä¸–ç•Œäº‹ä»¶çš„å˜é‡ï¼Œå¦‚æœåŠ¡å™¨å´©æºƒã€ç¡¬ç›˜æ•…éšœã€ç½‘ç»œè¿æ¥æ–­å¼€ç­‰ã€‚ æœ€åï¼Œé€šè¿‡æ§åˆ¶ç»„å’Œå®éªŒç»„ä¹‹é—´çš„çŠ¶æ€å·®å¼‚æ¥åé©³ç¨³å®šçŠ¶æ€çš„å‡è¯´ã€‚ ç ´åç¨³æ€çš„éš¾åº¦è¶Šå¤§ï¼Œæˆ‘ä»¬å¯¹ç³»ç»Ÿè¡Œä¸ºçš„ä¿¡å¿ƒå°±è¶Šå¼ºã€‚å¦‚æœå‘ç°äº†ä¸€ä¸ªå¼±ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªæ”¹è¿›ç›®æ ‡ã€‚é¿å…åœ¨ç³»ç»Ÿè§„æ¨¡åŒ–ä¹‹åè¢«æ”¾å¤§ã€‚\né«˜çº§åŸåˆ™ # ä»¥ä¸‹åŸåˆ™æè¿°äº†åº”ç”¨æ··æ²Œå·¥ç¨‹çš„ç†æƒ³æ–¹å¼ï¼Œè¿™äº›åŸåˆ™åŸºäºä¸Šè¿°å®éªŒè¿‡ç¨‹ã€‚å¯¹è¿™äº›åŸåˆ™çš„åŒ¹é…ç¨‹åº¦èƒ½å¤Ÿå¢å¼ºæˆ‘ä»¬åœ¨å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¿¡å¿ƒã€‚\nå»ºç«‹ä¸€ä¸ªå›´ç»•ç¨³å®šçŠ¶æ€è¡Œä¸ºçš„å‡è¯´ # è¦å…³æ³¨ç³»ç»Ÿçš„å¯æµ‹é‡è¾“å‡º, è€Œä¸æ˜¯ç³»ç»Ÿçš„å±æ€§ã€‚å¯¹è¿™äº›è¾“å‡ºåœ¨çŸ­æ—¶é—´å†…çš„åº¦é‡æ„æˆäº†ç³»ç»Ÿç¨³å®šçŠ¶æ€çš„ä¸€ä¸ªä»£ç†ã€‚ æ•´ä¸ªç³»ç»Ÿçš„ååé‡ã€é”™è¯¯ç‡ã€å»¶è¿Ÿç™¾åˆ†ç‚¹ç­‰éƒ½å¯èƒ½æ˜¯è¡¨ç¤ºç¨³æ€è¡Œä¸ºçš„æŒ‡æ ‡ã€‚ é€šè¿‡åœ¨å®éªŒä¸­çš„ç³»ç»Ÿæ€§è¡Œä¸ºæ¨¡å¼ä¸Šçš„å…³æ³¨, æ··æ²Œå·¥ç¨‹éªŒè¯äº†ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ, è€Œä¸æ˜¯è¯•å›¾éªŒè¯å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚\nå¤šæ ·åŒ–çœŸå®ä¸–ç•Œçš„äº‹ä»¶ # æ··æ²Œå˜é‡åæ˜ äº†ç°å®ä¸–ç•Œä¸­çš„äº‹ä»¶ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡æ½œåœ¨å½±å“æˆ–ä¼°è®¡é¢‘ç‡æ’å®šè¿™äº›äº‹ä»¶çš„ä¼˜å…ˆçº§ã€‚è€ƒè™‘ä¸ç¡¬ä»¶æ•…éšœç±»ä¼¼çš„äº‹ä»¶, å¦‚æœåŠ¡å™¨å®•æœºã€è½¯ä»¶æ•…éšœ (å¦‚é”™è¯¯å“åº”) å’Œéæ•…éšœäº‹ä»¶ (å¦‚æµé‡æ¿€å¢æˆ–ä¼¸ç¼©äº‹ä»¶)ã€‚ ä»»ä½•èƒ½å¤Ÿç ´åç¨³æ€çš„äº‹ä»¶éƒ½æ˜¯æ··æ²Œå®éªŒä¸­çš„ä¸€ä¸ªæ½œåœ¨å˜é‡ã€‚\nåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œå®éªŒ # ç³»ç»Ÿçš„è¡Œä¸ºä¼šä¾æ®ç¯å¢ƒå’Œæµé‡æ¨¡å¼éƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ ç”±äºèµ„æºä½¿ç”¨ç‡å˜åŒ–çš„éšæ—¶å¯èƒ½å‘ç”Ÿ, å› æ­¤é€šè¿‡é‡‡é›†å®é™…æµé‡æ˜¯æ•è·è¯·æ±‚è·¯å¾„çš„å”¯ä¸€å¯é æ–¹æ³•ã€‚ ä¸ºäº†ä¿è¯ç³»ç»Ÿæ‰§è¡Œæ–¹å¼çš„çœŸå®æ€§ä¸å½“å‰éƒ¨ç½²ç³»ç»Ÿçš„ç›¸å…³æ€§, æ··æ²Œå·¥ç¨‹å¼ºçƒˆæ¨èç›´æ¥é‡‡ç”¨ç”Ÿäº§ç¯å¢ƒæµé‡è¿›è¡Œå®éªŒã€‚\næŒç»­è‡ªåŠ¨åŒ–è¿è¡Œå®éªŒ # æ‰‹åŠ¨è¿è¡Œå®éªŒæ˜¯åŠ³åŠ¨å¯†é›†å‹çš„, æœ€ç»ˆæ˜¯ä¸å¯æŒç»­çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æŠŠå®éªŒè‡ªåŠ¨åŒ–å¹¶æŒç»­è¿è¡Œï¼Œæ··æ²Œå·¥ç¨‹è¦åœ¨ç³»ç»Ÿä¸­æ„å»ºè‡ªåŠ¨åŒ–çš„ç¼–æ’å’Œåˆ†æã€‚\næœ€å°åŒ–çˆ†ç‚¸åŠå¾„ # åœ¨ç”Ÿäº§ä¸­è¿›è¡Œè¯•éªŒå¯èƒ½ä¼šé€ æˆä¸å¿…è¦çš„å®¢æˆ·æŠ•è¯‰ã€‚è™½ç„¶å¯¹ä¸€äº›çŸ­æœŸè´Ÿé¢å½±å“å¿…é¡»æœ‰ä¸€ä¸ªè¡¥å¿, ä½†æ··æ²Œå·¥ç¨‹å¸ˆçš„è´£ä»»å’Œä¹‰åŠ¡æ˜¯ç¡®ä¿è¿™äº›åç»­å½±å“æœ€å°åŒ–ä¸”è¢«è€ƒè™‘åˆ°ã€‚\næ··æ²Œå·¥ç¨‹æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å®è·µ, å®ƒå·²ç»åœ¨ä¸–ç•Œä¸Šä¸€äº›è§„æ¨¡æœ€å¤§çš„ä¸šåŠ¡ç³»ç»Ÿä¸Šæ”¹å˜äº†è½¯ä»¶æ˜¯å¦‚ä½•è®¾è®¡å’Œå·¥ç¨‹åŒ–çš„ã€‚ ç›¸è¾ƒäºå…¶ä»–æ–¹æ³•è§£å†³äº†é€Ÿåº¦å’Œçµæ´»æ€§, æ··æ²Œå·¥ç¨‹ä¸“é—¨å¤„ç†è¿™äº›åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ç³»ç»Ÿä¸ç¡®å®šæ€§ã€‚ æ··æ²Œå·¥ç¨‹çš„åŸåˆ™ä¸ºæˆ‘ä»¬å¤§è§„æ¨¡çš„åˆ›æ–°å’Œç»™äºˆå®¢æˆ·ä»–ä»¬åº”å¾—çš„é«˜è´¨é‡çš„ä½“éªŒæä¾›äº†ä¿¡å¿ƒã€‚\næ¬¢è¿åŠ å…¥ æ··æ²Œå·¥ç¨‹ç¤¾åŒºçš„ Google è®¨è®ºç»„å’Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºè¿™äº›åŸåˆ™çš„åº”ç”¨ã€‚\nÂ« è“ç»¿éƒ¨ç½²ã€æ»šåŠ¨éƒ¨ç½²å’Œç°åº¦éƒ¨ç½²\nÂ» å•†ä¸šç”»å¸ƒ\n"},{"id":41,"href":"/devops/commercial-canvas/","title":"Commercial Canvas","section":"Devops","content":" ğŸ  é¦–é¡µ / DevOps / å•†ä¸šç”»å¸ƒ\nå•†ä¸šç”»å¸ƒ # ç”¨æ¥æè¿°å•†ä¸šæ¨¡å¼ã€å¯è§†åŒ–å•†ä¸šæ¨¡å¼ã€è¯„ä¼°å•†ä¸šæ¨¡å¼ä»¥åŠæ”¹å˜å•†ä¸šæ¨¡å¼çš„é€šç”¨è¯­è¨€ã€‚\nå•†ä¸šæ¨¡å¼ï¼šé€šè¿‡å•†ä¸šäº§å“åˆ›é€ ä»·å€¼ï¼Œä¼ é€’ä»·å€¼ï¼Œè·å–ä»·å€¼çš„ä¸€ç§åŸç†ã€‚\nä¹ä¸ªæ¨¡å— # CSå®¢æˆ·ç»†åˆ†ï¼ˆCustomer Segmentsï¼‰ï¼šä¼ä¸šæˆ–æœºæ„æ‰€æœåŠ¡çš„ä¸€ä¸ªæˆ–å¤šä¸ªå®¢æˆ·åˆ†ç±»ç¾¤ä½“ã€‚\nVPä»·å€¼ä¸»å¼ ï¼ˆValue Propositionsï¼‰ï¼šé€šè¿‡ä»·å€¼ä¸»å¼ æ¥è§£å†³å®¢æˆ·éš¾é¢˜å’Œæ»¡è¶³å®¢æˆ·éœ€æ±‚ã€‚\nCHæ¸ é“é€šè·¯ï¼ˆChannelsï¼‰ï¼šé€šè¿‡æ²Ÿé€šã€åˆ†é”€å’Œé”€å”®æ¸ é“å‘å®¢æˆ·ä¼ é€’ä»·å€¼ä¸»å¼ ã€‚\nCRå®¢æˆ·å…³ç³»ï¼ˆCustomer Relationshipsï¼‰ï¼šåœ¨æ¯ä¸€ä¸ªå®¢æˆ·ç»†åˆ†å¸‚åœºå»ºç«‹å’Œç»´æŠ¤å®¢æˆ·å…³ç³»ã€‚\nR$æ”¶å…¥æ¥æºï¼ˆRevenue Streamsï¼‰ï¼šæ”¶å…¥æ¥æºäº§ç”ŸäºæˆåŠŸæä¾›ç»™å®¢æˆ·çš„ä»·å€¼ä¸»å¼ ã€‚\nKRæ ¸å¿ƒèµ„æºï¼ˆKey Resouresï¼‰ï¼šæ ¸å¿ƒèµ„æºæ˜¯æä¾›å’Œäº¤ä»˜å…ˆå‰æè¿°è¦ç´ æ‰€å¿…å¤‡çš„é‡è¦èµ„äº§ã€‚\nKAå…³é”®ä¸šåŠ¡ï¼ˆKey Activitiesï¼‰ï¼šé€šè¿‡æ‰§è¡Œä¸€äº›å…³é”®ä¸šåŠ¡æ´»åŠ¨ï¼Œè¿è½¬å•†ä¸šæ¨¡å¼ã€‚\nKPé‡è¦åˆä½œï¼ˆKey Partnershipï¼‰ï¼šæœ‰äº›ä¸šåŠ¡è¦å¤–åŒ…ï¼Œè€Œå¦å¤–ä¸€äº›èµ„æºéœ€è¦ä»ä¼ä¸šå¤–éƒ¨è·å¾—ã€‚\nC$æˆæœ¬ç»“æ„ï¼ˆCost Structureï¼‰ï¼šå•†ä¸šæ¨¡å¼ä¸Šè¿°è¦ç´ æ‰€å¼•å‘çš„æˆæœ¬æ„æˆã€‚\nåŸºæœ¬è®¤çŸ¥ # å®¢æˆ·ç»†åˆ† # å®¢æˆ·æ˜¯å•†ä¸šæ¨¡å¼çš„æ ¸å¿ƒã€‚å“ªäº›æ˜¯é‡è¦å®¢æˆ·\nÂ« æ··æ²Œå·¥ç¨‹åŸåˆ™ ï¼ˆPRINCIPLES OF CHAOS ENGINEERINGï¼‰\nÂ» ä½¿ç”¨grafanaç›‘æ§5xxæœåŠ¡\n"},{"id":42,"href":"/devops/grafana-monite-service-with-5xx/","title":"Grafana Monite Service With 5xx","section":"Devops","content":" ğŸ  é¦–é¡µ / DevOps / ä½¿ç”¨grafanaç›‘æ§5xxæœåŠ¡\nä½¿ç”¨grafanaç›‘æ§5xxæœåŠ¡ # 1. Grafanaä¿¡æ¯ # grafanaæœåŠ¡ï¼š https://devops.example.com/grafana\nå¦‚æœè¦æ³¨å†Œè´¦å·è¯·è”ç³»devopsç»„ã€‚\n2. Grafanaç›‘æ§é¢„è§ˆ # grafanaå·²ç»é…ç½®äº†å¯¹service.hompartners.comåŸŸåä¸‹çš„serviceè®¿é—®çŠ¶æ€è¿”å›5xxçš„ç›‘æ§ï¼Œå¯ä»¥æŸ¥çœ‹å¯¹åº”çš„grafanaé¢æ¿ https://devops.example.com/grafana/d/Q_zv-HrWz/cst-service-status?orgId=1\nè¯¥ç›‘æ§é¢æ¿ä¸­å¯ä»¥æŸ¥çœ‹å¦‚userapiã€emailapiç­‰æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œå½“é¢æ¿çš„ç½‘æ ¼è§†å›¾ä¸­å‡ºç°çº¢ç‚¹ï¼Œè¯´æ˜è®¿é—®å¯¹åº”çš„æœåŠ¡è¿”å›äº†5xxçŠ¶æ€ï¼Œå³æœåŠ¡ç«¯å¼‚å¸¸ã€‚å¼€å‘äººå‘˜ç­‰å¯ä»¥æ ¹æ®è¯¥è§†å›¾åŠæ—¶å‘ç°æœåŠ¡å¼‚å¸¸æƒ…å†µã€‚\n3. Grafanaæ·»åŠ ç›‘æ§5xxæœåŠ¡ # å¦‚æœé¡¹ç»§ç»­æ·»åŠ Grafanaé¢æ¿æ¥ç›‘æ§æ›´å¤šçš„æœåŠ¡ï¼Œè¯·å‚ç…§ä»¥ä¸‹æ•™ç¨‹ã€‚\nStep 1 å¤åˆ¶æ¨¡æ¿è§†å›¾ï¼š\né€‰ä¸­å¹¶è¿›å…¥xxx service http_status_5xx templateé¢æ¿ï¼ŒæŒ‰æ“ä½œå¦‚ä¸‹å¤åˆ¶xxx.xxx.com http_status_5xxè§†å›¾\nï¼ˆå¯é€šè¿‡è¯¥é“¾æ¥è®¿é—®ï¼š https://devops.example.com/grafana/d/XNnusprWz/xxx-service-http_status_5xx-template?orgId=1ï¼‰\nStep 2 åˆ›å»ºæ–°é¢æ¿ï¼š\næŒ‰å¦‚ä¸‹æ“ä½œåˆ›å»ºæ–°é¢æ¿å¹¶ç²˜è´´è§†å›¾ã€‚\néšåä¼šåœ¨é¡µé¢å‘ˆç°ä¸€ä¸ªè§†å›¾ï¼Œè¿™æ—¶å¯ä»¥å…ˆç¼–è¾‘é¢æ¿ä¿¡æ¯ï¼Œå¹¶æ–°å‘½åï¼Œé€‰æ‹©é¢æ¿åˆ†ç±»ï¼Œå¹¶ä¿å­˜é¢æ¿ä¿¡æ¯ã€‚\nStep 3 å®šåˆ¶xxx.xxx.com http_status_5xxè§†å›¾ï¼š\nä¿å­˜å®Œæˆä¹‹åï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„å›é€€ç®­å¤´å›¾æ ‡ï¼š\u0026lt;\u0026ndash;ï¼Œå›åˆ°è§†å›¾é¡µé¢ï¼ŒæŒ‰å¦‚ä¸‹æ“ä½œç¼–è¾‘è§†å›¾ã€‚\nä¿®æ”¹æŸ¥è¯¢sqlè¯­å¥ï¼ŒåŸŸåä¿®æ”¹ä¸ºè¦ç›‘æ§çš„åŸŸåæˆ–æœåŠ¡åï¼Œæ¯”å¦‚ä½ æƒ³ç›‘æ§www.example.comåŸŸåä¸‹æ‰€æœ‰æœåŠ¡ï¼Œé‚£ä¹ˆä½ å¯ä»¥å®šåˆ¶sqlå¦‚ä¸‹ï¼š\nSELECT \u0026#34;service_code\u0026#34; FROM \u0026#34;service_status\u0026#34; WHERE (\u0026#34;health_code\u0026#34; = 500 AND \u0026#34;domain_name\u0026#34; = \u0026#39;www.example.com\u0026#39;) AND $timeFilter GROUP BY \u0026#34;service_name\u0026#34; ï¼Œå½“ç„¶ä½ å¯èƒ½åªæƒ³ç›‘æ§æŸä¸ªåŸŸåä¸‹çš„å…¶ä¸­ä¸€ä¸ªæœåŠ¡ï¼Œå¦‚ä½ æƒ³ç›‘æ§www.example.comåŸŸåä¸‹operationplatgformæœåŠ¡ï¼Œé‚£ä¹ˆä½ å¯ä»¥å®šåˆ¶sqlå¦‚ä¸‹ï¼š\nSELECT \u0026#34;service_code\u0026#34; FROM \u0026#34;service_status\u0026#34; WHERE (\u0026#34;health_code\u0026#34; = 500 AND \u0026#34;domain_name\u0026#34; = \u0026#39;www.example.com\u0026#39; AND \u0026#34;service_name\u0026#34; = \u0026#39;operationplatgform\u0026#39;) å¦å¤–è¿™é‡Œçš„health_codeåšäº†æ ¼å¼åŒ–ï¼Œåˆ†ä¸º200å’Œ500ï¼Œæˆ‘ä»¬é»˜è®¤ç›‘æ§å¯¹æˆ‘ä»¬æœ‰ç”¨çš„500çŠ¶æ€\nä¿®æ”¹è§†å›¾åç§°ï¼Œå¦‚æœæœ‰CloudWatchæ—¥å¿—è¿æ¥çš„éœ€è¦ï¼Œå¯ä»¥å®šåˆ¶Panel linksã€‚\nè§†å›¾ä¿®æ”¹å®Œæˆåï¼Œå³ä¸Šè§’ä¿å­˜é¢æ¿ã€‚\nStep 4 å®šåˆ¶xxx service infoè§†å›¾ï¼š\næŒ‰ç…§ä¸Šè¿°æ“ä½œï¼Œå°†xxx.service.infoè§†å›¾å¤åˆ¶ï¼Œç„¶åç²˜è´´åœ¨æ–°çš„é¢æ¿ä¸­ã€‚\nå¹¶ä¸”ç¼–è¾‘ç²˜è´´çš„è§†å›¾ï¼Œä¿®æ”¹queryã€‚\n4. Grafanaæ·»åŠ æœåŠ¡ä¿¡æ¯ # Step 1 å¤åˆ¶æ¨¡æ¿è§†å›¾ï¼š\né€‰ä¸­å¹¶è¿›å…¥xxx service http_status_5xx templateé¢æ¿ï¼ŒæŒ‰æ“ä½œå¦‚ä¸‹å¤åˆ¶xxx service ingoè§†å›¾\nï¼ˆå¯é€šè¿‡è¯¥é“¾æ¥è®¿é—®ï¼š https://devops.example.com/grafana/d/XNnusprWz/xxx-service-http_status_5xx-template?orgId=1ï¼‰\nä¹‹ååœ¨è§†å›¾é¡µé¢ï¼Œå¯ä»¥é€šè¿‡ä¼¸ç¼©è§†å›¾é¡µé¢ï¼Œä½¿å±•ç¤ºæ›´åˆç†ï¼›é€šè¿‡è°ƒæ•´æ—¶é—´æ®µæŸ¥çœ‹æƒ³è¦è§‚å¯Ÿçš„æ—¶é—´æ®µå†…çš„æ•°æ®ã€‚\nå¦‚æœåœ¨å®šåˆ¶è¿‡ç¨‹ä¸­å­˜åœ¨é—®é¢˜ï¼Œä¹Ÿå¯ä»¥è”ç³»DevOpsç»„ã€‚\nÂ« å•†ä¸šç”»å¸ƒ\nÂ» ä½¿ç”¨Grafanaç›‘æ§service\n"},{"id":43,"href":"/devops/grafana-monite-service/","title":"Grafana Monite Service","section":"Devops","content":" ğŸ  é¦–é¡µ / DevOps / ä½¿ç”¨Grafanaç›‘æ§service\nä½¿ç”¨Grafanaç›‘æ§service # ç›‘æ§liveä¸Šçš„åº”ç”¨æœåŠ¡,å¦‚æœæœåŠ¡httpçŠ¶æ€ä¸º5xx,åˆ™ååº”åˆ°grafanaå›¾è¡¨ä¸­,DevOpså’Œå¼€å‘äººå‘˜éƒ½èƒ½åŠæ—¶ä»å›¾è¡¨ä¸­è·å–ä¿¡æ¯,åŠæ—¶ç¡®è®¤å’Œæ’æŸ¥é—®é¢˜.\nService HttpçŠ¶æ€æ•°æ®æ¥æº # ä½¿ç”¨ç¨‹åºå®šæ—¶è½®è¯¢è·å–aws elbçš„æ—¥å¿—æ•°æ®,å°†æ—¥å¿—æ•°æ®ä»¥æ—¶åºå½¢å¼å­˜å‚¨åœ¨influxdb,ç›®å‰æ•°æ®ç»“æ„å¦‚ä¸‹:\ntag keys:\n# TagKeyName Remark 1 domain_name 2 service_name é»˜è®¤å–pathbase,å¦‚æœpathbaseä¸ºç©º,å–domain field keys:\n# FieldKeyName Remark 1 domain_name 2 elb_status_code æ•°å­—ç±»å‹,200;500 3 health_code æ•°å­—ç±»å‹,200;500 4 request_url è¯·æ±‚è·¯å¾„ 5 service_code ä¸€ä¸ªåŸŸåä¸‹çš„å¤šä¸ªservice,æŒ‰åºä»1è‡ªå¢,ä½œä¸ºgrafanaå›¾è¡¨çš„yè½´æ•°æ® åˆ›å»ºDashboard # =\u0026gt; Add Query\nç›®å‰æ•°æ®æºå·²ç»é…ç½®å®Œæˆï¼Œé€‰æ‹©Influxdb_Elb_Logsä½œä¸ºQUuery DataSourceï¼Œå¹¶ä¸”å¼€å§‹é…ç½®query\næŸ¥è¯¢è¯­å¥å¯ä»¥å‚è€ƒï¼š\nSELECT mean(\u0026#34;service_code\u0026#34;) FROM \u0026#34;service_status\u0026#34; WHERE (\u0026#34;domain_name\u0026#34; = \u0026#39;service.example.com\u0026#39; AND \u0026#34;health_code\u0026#34; = 500) AND $timeFilter GROUP BY time($__interval), \u0026#34;service_name\u0026#34; æ ¹æ®è‡ªèº«éœ€æ±‚ä¿®æ”¹queryå³å¯ã€‚\nÂ« ä½¿ç”¨grafanaç›‘æ§5xxæœåŠ¡\nÂ» Grafana\n"},{"id":44,"href":"/devops/grafana/","title":"Grafana","section":"Devops","content":" ğŸ  é¦–é¡µ / DevOps / Grafana\nGrafana # å®˜æ–¹æ–‡æ¡£ï¼š https://grafana.com/docs/grafana/latest/\nç®€ä»‹ # ç‰¹æ€§ # å¯è§†åŒ–ï¼šé€šè¿‡å›¾è¡¨å±•ç¤ºæŒ‡æ ‡ä¿¡æ¯ï¼Œç›´è§‚ï¼Œä¾¿äºåˆ†æ\næŠ¥è­¦ï¼šæŒ‡æ ‡æ•°æ®è¶…å‡ºé˜ˆå€¼\nç»Ÿä¸€ï¼šå¤šç§æ•°æ®æºå¯ä»¥åº”ç”¨åˆ°åŒä¸€ä¸ªDashboardä¸­\nå¤šå¹³å°æ”¯æŒï¼šwindowsã€linuxã€dockerã€mac\nä¸°å¯Œçš„æ’ä»¶æ‰©å±•\nä¸°å¯Œçš„æ¨¡æ¿æ”¯æŒ\nä½¿ç”¨Grafanaç›‘æ§Jenkins # ç›‘æ§æŒ‡æ ‡åŒ…æ‹¬:jenkinså‘å¸ƒçŠ¶æ€,jenkinsçš„å‘å¸ƒæ—¶é•¿ç­‰.\nå‰ææ¡ä»¶ # å·²å®‰è£…jenkins\nå·²å®‰è£…prometheus\nå·²å®‰è£…grafana\nJenkinså®‰è£…æ’ä»¶ # ç™»å…¥Jenkins =\u0026gt; Manage Jenkins =\u0026gt; Manage Plugins =\u0026gt; Availableé¡µç­¾ æœç´¢Prometheusæ’ä»¶,å®‰è£…å³å¯.\næ­¤èŠ‚å¯ä»¥å‚è€ƒ: https://medium.com/@eng.mohamed.m.saeed/monitoring-jenkins-with-grafana-and-prometheus-a7e037cbb376\nÂ« ä½¿ç”¨Grafanaç›‘æ§service\nÂ» Jaeger\n"},{"id":45,"href":"/devops/jeager/","title":"Jeager","section":"Devops","content":" ğŸ  é¦–é¡µ / DevOps / Jaeger\nJaeger # å‰è¨€ # å¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨å…³ç³»é”™ç»¼å¤æ‚ï¼Œå½“ä½ åœ¨äº¬ä¸œä¸‹å•æ—¶ï¼Œåº”ç”¨èƒŒåçš„æœåŠ¡è°ƒç”¨é“¾å¯èƒ½è¶…ä½ æƒ³è±¡ã€‚è°ƒç”¨é“¾çš„è¿½è¸ªæ˜¯å¾®æœåŠ¡ç»•ä¸è¿‡å»çš„æŠ€æœ¯æ ˆï¼Œ\nç®€ä»‹ # å…³äº # Jaegerï¼Œå—Dapperå’ŒOpenZipkinå¯å‘ï¼Œç”±Uberå¼€æºçš„ä¸€ä¸ªåˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿï¼Œç”¨äºåŸºäºå¾®æœåŠ¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç›‘æ§å’Œæ’é”™ï¼ŒåŒ…æ‹¬ï¼š\nåˆ†å¸ƒå¼ä¸Šä¸‹æ–‡ä¼ é€’ åˆ†å¸ƒå¼äº‹åŠ¡ç›‘æ§ é—®é¢˜æ ¹ç”±åˆ†æ æœåŠ¡ä¾èµ–åˆ†æ æ€§èƒ½ã€å»¶è¿Ÿä¼˜åŒ– åŠŸèƒ½ # å…¼å®¹OpenTracingæ•°æ®æ¨¡å‹å’Œå·¥å…·åº“ å¯¹æ¯ä¸ªæœåŠ¡ã€ç«¯ç‚¹ä½¿ç”¨ä¸€è‡´çš„æŠ½æ ·æ¦‚ç‡ æ”¯æŒå¤šæ ·çš„åç«¯æ•°æ®åº“ï¼šCassandraï¼ŒElasticsearchï¼ŒMemory è¿½è¸ªæ•°æ®æ‹“æ‰‘å›¾å½¢å±•ç¤º åŸºç¡€æ¦‚å¿µ # Spanï¼š\nè·¨åº¦ï¼Œæ˜¯è·¨æœåŠ¡çš„ä¸€æ¬¡è°ƒç”¨ã€‚åŒ…å«åç§°ï¼Œå¼€å§‹æ—¶é—´å’Œæˆªæ­¢æ—¶é—´ï¼ŒSpanä¹‹é—´å¯ä»¥å¹¶åˆ—ï¼Œä¹Ÿå¯ä»¥åµŒå¥—ã€‚\nTraceï¼š\næ˜¯ä¸€æ¬¡å®Œæˆçš„åˆ†å¸ƒå¼è°ƒç”¨é“¾ï¼ŒåŒ…å«å¤šä¸ªSpan\næŠ€æœ¯è§„æ ¼ # åç«¯Goè¯­è¨€å®ç° å‰ç«¯React/Javascript æ”¯æŒçš„æ•°æ®åº“ï¼šCassandra3.4+ï¼ŒElasticsearch5.x+ï¼ŒKafka\u0026hellip; ç»„ä»¶ä»‹ç» # jaeger-clientï¼š\njaegerå®¢æˆ·ç«¯ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§ä¸»æµè¯­è¨€å®ç°OpenTracingåè®®ï¼Œå°†è°ƒç”¨é“¾æ•°æ®æ”¶é›†åˆ°agentã€‚\njaeger-agentï¼š\njaegerçš„ä»£ç†ç¨‹åºï¼Œå°†æ”¶é›†åˆ°çš„clientè°ƒç”¨é“¾æ•°æ®ä¸ŠæŠ¥åˆ°collectorã€‚\njaeger-collectorï¼š\njaegerè°ƒç”¨é“¾æ•°æ®æ”¶é›†å™¨ï¼Œå¯¹æ”¶é›†åˆ°çš„è°ƒç”¨é“¾æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œå¤„ç†ï¼Œå­˜å‚¨åˆ°åç«¯æ•°æ®åº“ã€‚\njaeger-queryï¼š\njaegerè°ƒç”¨é“¾æ•°æ®æŸ¥è¯¢æœåŠ¡ï¼Œæœ‰ç‹¬ç«‹UIã€‚\nOpenTracing # åˆ†å¸ƒå¼çš„è¿½è¸ªç³»ç»Ÿå…¶å®ä¸æ­¢Jaegerä¸€ç§ï¼Œä½†æ˜¯å®ƒä»¬çš„æ ¸å¿ƒåŸç†éƒ½å¤§ç›¸å¾„åº­ï¼Œéƒ½æ˜¯ä»å…¥ä¾µåˆ°ä»£ç ä¸­åŸ‹ç‚¹ï¼Œç„¶ååƒè¿½è¸ªç³»ç»Ÿä¸ŠæŠ¥æ•°æ®ä¿¡æ¯ï¼Œæœ€ç»ˆæˆ‘ä»¬åœ¨è¿½è¸ªç³»ç»Ÿå¾—åˆ°æ•°æ®ï¼Œä»è€Œå®ç°è¿½è¸ªåˆ†æã€‚\nä¸ºäº†å…¼å®¹ç»Ÿä¸€å„è¿½è¸ªç³»ç»ŸAPIï¼ŒOpenTracingè§„èŒƒè¯ç”Ÿäº†ï¼Œå®ƒä¸å¹³å°æ— å…³ï¼Œä¸å‚å•†æ— å…³ã€‚æœ‰äº†å®ƒçš„å­˜åœ¨ï¼Œä½ å¯ä»¥æ–¹ä¾¿çš„åˆ‡æ¢ä½ æƒ³ä½¿ç”¨çš„è¿½è¸ªç³»ç»Ÿã€‚\nå®‰è£… # Docker # docker run -d --name jaeger \\ -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 \\ -p 5775:5775/udp \\ -p 6831:6831/udp \\ -p 6832:6832/udp \\ -p 5778:5778 \\ -p 16686:16686 \\ -p 14268:14268 \\ -p 14250:14250 \\ -p 9411:9411 \\ jaegertracing/all-in-one:1.20 Kubernetes # å¼€å‘ç¯å¢ƒï¼š\nkubectl create -f https://raw.githubusercontent.com/jaegertracing/jaeger-kubernetes/master/all-in-one/jaeger-all-in-one-template.yml å¯èƒ½éœ€è¦å°†æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œä¿®æ”¹Deploymentç‰ˆæœ¬ã€‚\nç”Ÿäº§ç¯å¢ƒï¼š\nâ”œâ”€â”€ install-jaeger.sh â”œâ”€â”€ jaeger-agent.yaml â”œâ”€â”€ jaeger-cassandra.yaml â”œâ”€â”€ jaeger-collector.yaml â”œâ”€â”€ jaeger-configmap.yaml â”œâ”€â”€ jaeger-persistent.yaml â”œâ”€â”€ jaeger-query.yaml â””â”€â”€ uninstall-jaeger.sh\nç¤ºä¾‹ # DotNet Demoï¼š\ndotnet add package Jaeger --version 0.4.2 dotnet add package OpenTracing.Contrib.NetCore --version 0.6.2 public void ConfigureServices(IServiceCollection services) { services.AddControllers(); services.AddOpenTracing(); var httpOption = new HttpHandlerDiagnosticOptions(); httpOption.IgnorePatterns.Add(req =\u0026gt; req.RequestUri.AbsolutePath.Contains(\u0026#34;/api/traces\u0026#34;)); services.AddSingleton(Options.Create(httpOption)); services.AddSingleton\u0026lt;ITracer\u0026gt;(serviceProvider =\u0026gt; { string serviceName = serviceProvider.GetRequiredService\u0026lt;IWebHostEnvironment\u0026gt;().ApplicationName; ILoggerFactory loggerFactory = serviceProvider.GetRequiredService\u0026lt;ILoggerFactory\u0026gt;(); Configuration.SenderConfiguration senderConfiguration = new Configuration.SenderConfiguration(loggerFactory) .WithSender(new UdpSender(\u0026#34;jaeger-agent\u0026#34;, 6831, 0)); var tracer = new Tracer.Builder(serviceName) .WithSampler(new ConstSampler(true)) .WithReporter(new RemoteReporter.Builder().WithSender(senderConfiguration.GetSender()).Build()) .Build(); GlobalTracer.Register(tracer); return tracer; }); } Golang Demoï¼š\ngo get github.com/uber/jaeger-client-go go get github.com/opentracing/opentracing-go func main() { tracer, closer := initJaegerTracer(\u0026#34;jaeger-api-go\u0026#34;, \u0026#34;jaeger-agent.example.dev:6831\u0026#34;) defer closer.Close() opentracing.InitGlobalTracer(tracer) http.HandleFunc(\u0026#34;/api/values\u0026#34;, TraceHandler(valuesHandler)) http.ListenAndServe(\u0026#34;:8082\u0026#34;, nil) } func initJaegerTracer(serviceName, jaegerAgentAddr string) (opentracing.Tracer, io.Closer) { cfg := config.Configuration{ Sampler: \u0026amp;config.SamplerConfig{ Type: jaeger.SamplerTypeConst, Param: 1, }, Reporter: \u0026amp;config.ReporterConfig{ LogSpans: true, LocalAgentHostPort: jaegerAgentAddr, }, } tracer, closer, err := cfg.New(serviceName, config.Logger(jaeger.StdLogger)) if err != nil { log.Printf(\u0026#34;ERROR: Could not initialize jaeger tracer: %s\u0026#34;, err.Error()) } return tracer, closer } func valuesHandler(w http.ResponseWriter, r *http.Request) { time.Sleep(2 * time.Second) fmt.Fprintf(w, \u0026#34;hello from jaeger-go.\u0026#34;) } func TraceHandler(handler func(w http.ResponseWriter, r *http.Request)) func(w http.ResponseWriter, r *http.Request) { return func(w http.ResponseWriter, r *http.Request) { spanName := r.URL.Path spanCtx, _ := opentracing.GlobalTracer().Extract(opentracing.HTTPHeaders, opentracing.HTTPHeadersCarrier(r.Header)) span := opentracing.GlobalTracer().StartSpan(spanName, opentracing.ChildOf(spanCtx)) span.SetTag(string(ext.Component), spanName) defer span.Finish() handler(w, r) } } package jaeger_tracer import ( \u0026#34;github.com/opentracing/opentracing-go/ext\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;github.com/opentracing/opentracing-go\u0026#34; \u0026#34;github.com/uber/jaeger-client-go\u0026#34; \u0026#34;github.com/uber/jaeger-client-go/config\u0026#34; ) type TraceHandler struct { OriginalHandler http.Handler } func (handler TraceHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) { //spanName := runtime.FuncForPC(reflect.ValueOf(handler.OriginalHandler).Pointer()).Name() spanName := r.URL.Path spanCtx, _ := opentracing.GlobalTracer().Extract(opentracing.HTTPHeaders, opentracing.HTTPHeadersCarrier(r.Header)) span := opentracing.GlobalTracer().StartSpan(spanName,opentracing.ChildOf(spanCtx)) span.SetTag(string(ext.Component), spanName) defer span.Finish() handler.OriginalHandler.ServeHTTP(w, r) } func InitJaegerTracer(serviceName, jaegerAgentAddr string) (opentracing.Tracer, io.Closer) { cfg := config.Configuration{ ServiceName: serviceName, Sampler: \u0026amp;config.SamplerConfig{ Type: jaeger.SamplerTypeConst, Param: 1, }, Reporter: \u0026amp;config.ReporterConfig{ LogSpans: true, LocalAgentHostPort: jaegerAgentAddr, }, } tracer, closer, err := cfg.NewTracer(config.Logger(jaeger.StdLogger)) if err != nil { log.Printf(\u0026#34;ERROR: Could not initialize jaeger tracer: %s\u0026#34;, err.Error()) } return tracer, closer } func TracerHandler(handler http.Handler) http.Handler { return jaeger_tracer.TraceHandler{ OriginalHandler: handler, } } ä½¿ç”¨ # Â« Grafana\nÂ» nginx\n"},{"id":46,"href":"/devops/nginx/","title":"Nginx","section":"Devops","content":" ğŸ  é¦–é¡µ / DevOps / nginx\nnginx # nginxç®€ä»‹ # é«˜æ€§èƒ½çš„åå‘ä»£ç†å·¥å…·ï¼Œè´Ÿè½½å‡è¡¡å™¨ï¼›\nnginxé…ç½® # å…¨å±€é…ç½® # eventé…ç½® # httpé…ç½® # é…ç½®åå‘ä»£ç† # æ­£å‘ä»£ç†ï¼š\nåœ¨å›½å†…æ˜¯\né…ç½®location:\nlocaltion [ = | ~ | ~* | ^~] uri { } =ï¼šç”¨äºä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„urlå‰ï¼Œè¦æ±‚è¯·æ±‚å­—ç¬¦ä¸²ä¸uriä¸¥æ ¼åŒ¹é…ï¼› ~ï¼šç”¨äºè¡¨ç¤ºuriåŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”åŒºåˆ†å¤§å°å†™ï¼› ~*ï¼šç”¨äºè¡¨ç¤ºuriåŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”ä¸åŒºåˆ†å¤§å°å†™ï¼› ^~ï¼šç”¨äºä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„uriå‰ï¼Œè¦æ±‚nginxæœåŠ¡å™¨æ‰¾åˆ°è¡¨ç¤ºuiå’Œè¯·æ±‚å­—ç¬¦ä¸²åŒ¹é…åº¦æœ€é«˜çš„locationåï¼Œç«‹å³ä½¿ç”¨æ­¤locationå¤„ç†è¯·æ±‚ é…ç½®è´Ÿè½½å‡è¡¡ # å°†è´Ÿè½½åˆ†æ‘Šåˆ°ä¸åŒçš„æœåŠ¡å•å…ƒï¼Œä¿è¯æœåŠ¡çš„å¿«é€Ÿå“åº”ï¼Œé«˜å¯ç”¨ã€‚\nupstream myserver { server 192.168.0.1:8081; server 192.168.0.2:8082; } server { listen 80; server_name 192.168.0.1; location / { proxy_pass http://myserver; root html; index index.html index.htm; } } å‡è¡¡ç­–ç•¥ï¼š\nè½®è¯¢ç­–ç•¥ï¼š\nnginxé»˜è®¤ä½¿ç”¨çš„å‡è¡¡ç­–ç•¥ï¼ŒæŒ‰è¯·æ±‚æ—¶é—´å…ˆåé¡ºåºé€ä¸€åˆ†é…åˆ°åç«¯æœåŠ¡å™¨åˆ—è¡¨ï¼Œå¦‚æœæŸåç«¯æœåŠ¡å™¨downæ‰äº†ï¼Œåˆ™è‡ªåŠ¨å‰”é™¤æœåŠ¡å™¨åˆ—è¡¨ã€‚\næƒé‡ç­–ç•¥ï¼š\nåç«¯æœåŠ¡å™¨é…ç½®weightå€¼ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œè¯¥å€¼é…ç½®è¶Šå¤§ï¼Œåˆ™å‡è¡¡åˆ°è¯¥æœåŠ¡å™¨ä¸Šçš„è¯·æ±‚è¶Šå¤šã€‚\nupstream myserver { server 192.168.0.1:8081 weight=1; server 192.168.0.2:8082 weight=2; } IP-Hashç­–ç•¥ï¼š\næ ¹æ®è¯·æ±‚å®¢æˆ·ç«¯çš„IP çš„hashå€¼ç»™å…¶åˆ†é…å›ºå®šçš„æŸä¸ªæœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessioné—®é¢˜ã€‚\nupstream myserver { ip_hash; server 192.168.0.1:8081; server 192.168.0.2:8082; } Fairç­–ç•¥ï¼š\næ ¹æ®åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´åˆ†é…ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚\nupstream myserver { server 192.168.0.1:8081; server 192.168.0.2:8082; fair; } é…ç½®åŠ¨é™åˆ†ç¦» # é™æ€æœåŠ¡å™¨ç”¨äºå“åº”htmlã€cssã€jsã€å›¾ç‰‡ç­‰é™æ€èµ„æºçš„è®¿é—®ï¼ŒåŠ¨æ€æœåŠ¡å™¨ç”¨äºå“åº”ä¸šåŠ¡å¤„ç†ç­‰ã€‚\nlocation /www/ { root /data/; index index.html index.htm; } location /image/ { root /data/; autoindex on; # åˆ—å‡ºimageç›®å½•ä¸‹çš„é™æ€æ–‡ä»¶ } Nginxå¸¸ç”¨å‘½ä»¤ # é‡å¯ # é€‚ç”¨äºä¿®æ”¹äº†é…ç½®æ–‡ä»¶ä¹‹åï¼Œé‡æ–°åŠ è½½\nnginx -s reload æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡® # # æ£€æŸ¥é»˜è®¤é…ç½®æ–‡ä»¶ /etc/nginx/nginx.conf nginx -t # æ£€æŸ¥æŒ‡å®šé…ç½®æ–‡ä»¶ nginx -t -c /etc/nginx/conf.d/default.conf Â« Jaeger\n"},{"id":47,"href":"/docker/","title":"Docker","section":"","content":" ğŸ  é¦–é¡µ / Docker\nDocker # container-diff å·¥å…·çš„ä½¿ç”¨\nDocker in Docker\ndocker buildx\nDocker å¸¸ç”¨å‘½ä»¤\nDocker Compose å®è·µ\nDocker å®¹å™¨ä¸­å®‰è£… PFX è¯ä¹¦\nDocker ä¸»æœºå®¹å™¨äº’æ‹·è´æ–‡ä»¶\nä½¿ç”¨ docker manifest å‘½ä»¤æ„å»ºå¤šæ¶æ„é•œåƒ\nç†è§£ docker run \u0026ndash;link\nDocker å¯è§†åŒ–å·¥å…· Kitematic\nDockerfile\nLinux å®¹å™¨\né root è´¦å·è·å– docker æƒé™\nMac é‡è£… Docker Desktop\nsome-apps.md\n"},{"id":48,"href":"/docker/container-diff/","title":"Container Diff","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / container-diff å·¥å…·çš„ä½¿ç”¨\ncontainer-diff å·¥å…·çš„ä½¿ç”¨ # ç®€ä»‹ # container-diff æ˜¯ google å¼€æºçš„ä¸€æ¬¾ç”¨äºåˆ†æå’Œæ¯”è¾ƒ Docker é•œåƒçš„å·¥å…·ï¼Œå®ƒå¯ä»¥ä»å¤šä¸ªç»´åº¦åˆ†æä¸€ä¸ªæˆ–è€…æ¯”è¾ƒä¸¤ä¸ªå®¹å™¨é•œåƒï¼š\né•œåƒæ„å»ºå†å² é•œåƒæ–‡ä»¶ç³»ç»Ÿ é•œåƒå¤§å° è½¯ä»¶åŒ…ç®¡ç† é¡¹ç›®åœ°å€ï¼š https://github.com/GoogleContainerTools/container-diff\nå®‰è£… # macOS # curl -LO https://storage.googleapis.com/container-diff/latest/container-diff-darwin-amd64 \u0026amp;\u0026amp; chmod +x container-diff-darwin-amd64 \u0026amp;\u0026amp; sudo mv container-diff-darwin-amd64 /usr/local/bin/container-diff Linux # curl -LO https://storage.googleapis.com/container-diff/latest/container-diff-linux-amd64 \u0026amp;\u0026amp; chmod +x container-diff-linux-amd64 \u0026amp;\u0026amp; sudo mv container-diff-linux-amd64 /usr/local/bin/container-diff # or curl -LO https://storage.googleapis.com/container-diff/latest/container-diff-linux-amd64 \u0026amp;\u0026amp; chmod +x container-diff-linux-amd64 \u0026amp;\u0026amp; mkdir -p $HOME/bin \u0026amp;\u0026amp; export PATH=$PATH:$HOME/bin \u0026amp;\u0026amp; mv container-diff-linux-amd64 $HOME/bin/container-diff Windows # ä¸‹è½½åœ°å€ï¼š https://storage.googleapis.com/container-diff/latest/container-diff-windows-amd64.exe\nä¸‹è½½ exe æ–‡ä»¶é‡å‘½åä¸º container-diff.exeï¼Œæ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ PATH ä¸­ã€‚\nä½¿ç”¨ # åˆ†æå•ä¸ª Docker é•œåƒ\ncontainer-diff analyze \u0026lt;image-name\u0026gt; å¯¹æ¯”ä¸¤ä¸ª Docker é•œåƒ\ncontainer-diff diff \u0026lt;image1-name\u0026gt; \u0026lt;image2-name\u0026gt; å¦‚æœä¸æŒ‡å®š typeï¼Œé»˜è®¤åˆ†æ/å¯¹æ¯”çš„æ˜¯é•œåƒå¤§å°ï¼Œå³ --type=size\nå¯ä»¥é€šè¿‡æŒ‡å®š typeï¼Œåˆ†æ/å¯¹æ¯”ç‰¹å®šç»´åº¦\ncontainer-diff analyze \u0026lt;image-name\u0026gt; --type=\u0026lt;type-name\u0026gt; container-diff diff \u0026lt;image1-name\u0026gt; \u0026lt;image2-name\u0026gt; --type=\u0026lt;type-name\u0026gt; type ç±»å‹æ”¯æŒå¦‚ä¸‹ï¼š\nhistoryï¼šé•œåƒæ„å»ºå†å² fileï¼šé•œåƒæ–‡ä»¶ sizeï¼šé•œåƒå¤§å° rpmï¼šrpm åŒ…ç®¡ç†å™¨ pipï¼špip åŒ…ç®¡ç†å™¨ aptï¼šapt åŒ…ç®¡ç†å™¨ nodeï¼šnode åŒ…ç®¡ç†å™¨ é€šè¿‡è®¾ç½®å¤šç»„ typeï¼Œå¯ä»¥ä¸€æ¬¡æ€§åˆ†æ/å¯¹æ¯”å¤šä¸ªç»´åº¦ï¼Œä¾‹å¦‚ï¼š\ncontainer-diff analyze nginx --type=history --type=size é€šè¿‡è®¾ç½® --type=file å’Œ --filename=/path/fileï¼Œå¯ä»¥æ¯”è¾ƒæ¯”è¾ƒä¸¤ä¸ª docker é•œåƒä¸­æŸç›®å½•æˆ–æ–‡ä»¶çš„åŒºåˆ«ï¼Œä¾‹å¦‚ï¼š\ncontainer-diff diff nginx:v1 nginx:v2 --type=file --filename=/etc/ é€šè¿‡è®¾ç½® -jï¼Œå¯ä»¥ä½¿ç”¨ json æ ¼å¼è¾“å‡ºç»“æœã€‚\né€šè¿‡è®¾ç½® -w \u0026lt;file-path\u0026gt;ï¼Œå¯ä»¥å°†ç»“æœè¾“å…¥åˆ°æ–‡ä»¶ã€‚\næ›´å¤šå‘½ä»¤å‚æ•°å¯ä»¥é€šè¿‡ -h è§£é”ã€‚\nÂ» Docker in Docker\n"},{"id":49,"href":"/docker/dind/","title":"Dind","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / Docker in Docker\nDocker in Docker # Docker-in-Docker çš„æ„æ€æ˜¯åœ¨ Docker å®¹å™¨ä¸­ä½¿ç”¨ dockerï¼Œå°±åƒå’Œåœ¨å®¿ä¸»æœºä¸Šä½¿ç”¨ docker ä¸€æ ·ï¼Œä½ å¯ä»¥ç†è§£ä¸ºå¥—å¨ƒã€‚\nåœºæ™¯ï¼š\nå¦‚æœä½ çš„ Jenkins æ˜¯ä½¿ç”¨ Docker å®¹å™¨çš„æ–¹å¼è¿è¡Œçš„ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨ Jenkins çš„ Docker æ’ä»¶æ¥ä¸º Jenkins Job æä¾›è¿è¡Œå®¹å™¨ï¼Œè¿™æ—¶å€™ä½ å°±éœ€è¦ç”¨åˆ° Docker-in-Dockerï¼›\nä¸€èˆ¬è¿™ä¸ªæŠ€æœ¯ä½¿ç”¨åœ¨åº”ç”¨çš„ç¨‹åºé›†æˆä¸­ CI/CDã€‚\n1. æŒ‚è½½ä¸»æœº /var/run/docker.sock # Docker å®¹å™¨ï¼š\ndocker run -v /var/run/docker.sock:/var/run/docker.sock --name docker-in-docker -it docker åœ¨è¿è¡Œèµ·æ¥çš„å®¹å™¨ä¸­ä½¿ç”¨dockerï¼š\n$ docker run -v /var/run/docker.sock:/var/run/docker.sock --name docker-in-docker -it docker / # docker run hello-world Hello from Docker! This message shows that your installation appears to be working correctly. ... å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¯¥å®¹å™¨ä¸­å¯ä»¥åƒåœ¨å®¿ä¸»æœºä¸€æ ·è¿è¡Œ docker å®¹å™¨ã€‚\nä½†æ˜¯ï¼Œä½¿ç”¨ docker ps -a å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°å®¿ä¸»æœºçš„è¿è¡Œå®¹å™¨ï¼Œè¿™è¯´æ˜å®¹å™¨çš„æƒé™æ˜¯å¾ˆå¤§çš„ï¼Œå­˜åœ¨ä¸€å®šçš„å®‰å…¨éšæ‚£ï¼š\nKubernetes Podï¼š\nå‡†å¤‡ docker-in-docker.yaml æ–‡ä»¶å¦‚ä¸‹ï¼š\napiVersion: v1 kind: Pod metadata: name: docker-in-docker spec: containers: - name: docker image: docker command: [\u0026#34;/bin/sh\u0026#34;, \u0026#34;-c\u0026#34;] args: - sleep 300s; volumeMounts: - name: docker-sock mountPath: /var/run/docker.sock volumes: - name: docker-sock hostPath: path: /var/run/docker.sock kubectl apply -f docker-in-docker.yaml kubectl exec -it docker-in-docker -c docker /bin/sh åŒæ ·ï¼Œè¿™ç§æ–¹å¼ä¹Ÿèƒ½è·å–åˆ°å®¿ä¸»æœºçš„å®¹å™¨ã€‚\n2. ä½¿ç”¨ Docker-Dind # Docker å®¹å™¨ï¼š\ndocker run --privileged -d --name docker-in-docker docker:dind docker exec -it docker-in-docker /bin/sh ä¸ä¸Šé¢æ–¹å¼ä¸åŒçš„æ˜¯ï¼Œè¿™ç§æ–¹å¼è¿è¡Œèµ·æ¥çš„ docker-in-docker æ— æ³•çœ‹åˆ°å®¿ä¸»æœºä¸Šçš„å®¹å™¨ã€‚\nKubernetes Podï¼š\nå‡†å¤‡ docker-in-docker.yaml æ–‡ä»¶å¦‚ä¸‹ï¼š\napiVersion: v1 kind: Pod metadata: name: docker-in-docker spec: containers: - name: docker image: docker:18 imagePullPolicy: Always env: - name: DOCKER_HOST value: tcp://localhost:2375 command: [\u0026#34;/bin/sh\u0026#34;, \u0026#34;-c\u0026#34;] args: - sleep 300s; - name: docker-dind image: docker:18-dind securityContext: privileged: true restartPolicy: OnFailure æ³¨æ„ï¼š\néœ€è¦ä¸¤ä¸ªå®¹å™¨ï¼Œç¬¬ä¸€å®¹å™¨ç”± docker é•œåƒè¿è¡Œï¼Œç¬¬äºŒå®¹å™¨ç”± docker:dind é•œåƒè¿è¡Œï¼›\nç¬¬ä¸€å®¹å™¨éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼šDOCKER_HOST=tcp://localhost:2375ï¼›\nç¬¬äºŒå®¹å™¨ä½¿ç”¨ç‰¹æƒæ¨¡å¼è¿è¡Œã€‚\nkubectl apply -f docker-in-docker.yaml kubectl exec -it docker-in-docker -c docker /bin/sh 3. ç»“æŸè¯­ # å‰é¢æåˆ°äº†ï¼Œç”±äºç¬¬ä¸€ç§æ–¹å¼æŒ‚è½½ä¸»æœº /var/run/docker.sockï¼Œåœ¨å®¹å™¨è§†è§’ä¾ç„¶èƒ½è·å–åˆ°å®¿ä¸»æœºçš„å®¹å™¨ï¼Œä¹Ÿèƒ½è¿è¡Œæˆ–åˆ é™¤å®¹å™¨ï¼Œå­˜åœ¨ä¸€å®šçš„å®‰å…¨éšæ‚£ï¼Œæ›´æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼ŒOver!\nÂ« container-diff å·¥å…·çš„ä½¿ç”¨\nÂ» docker buildx\n"},{"id":50,"href":"/docker/docker-buildx/","title":"Docker Buildx","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / docker buildx\ndocker buildx # $ docker buildx Usage: docker buildx [OPTIONS] COMMAND Extended build capabilities with BuildKit Options: --builder string Override the configured builder instance Management Commands: imagetools Commands to work on images in registry Commands: bake Build from a file build Start a build create Create a new builder instance du Disk usage inspect Inspect current builder instance ls List builder instances prune Remove build cache rm Remove a builder instance stop Stop builder instance use Set the current builder instance version Show buildx version information Run \u0026#39;docker buildx COMMAND --help\u0026#39; for more information on a command. æœ¬ç¯‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ docker buildx å‘½ä»¤å®ç°äº¤å‰ç¼–è¯‘ä¸åŒç³»ç»Ÿæ¶æ„ä¸‹çš„ Docker é•œåƒã€‚\nå®‰è£… # å¦‚æœæ ¹æ® docker å®˜ç½‘çš„å®‰è£…æ‰‹å†Œå®‰è£… dockerï¼Œä¼šé»˜è®¤å®‰è£… docker buildxã€‚\nå‚ç…§æ–‡æ¡£ï¼š Docker Buildx | Docker Documentation\næ‰‹åŠ¨å®‰è£…ï¼š\nä¸‹è½½åœ°å€ï¼š https://github.com/docker/buildx/releases/latest\næ‰‹åŠ¨ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‡å‘½åå¹¶æ‹·è´åˆ°ç›®æ ‡ç›®å½•ï¼Œä¾‹å¦‚ï¼š\nwget https://github.com/docker/buildx/releases/download/v0.8.1/buildx-v0.8.1.linux-amd64 mv buildx-v0.8.1.linux-amd64 $HOME/.docker/cli-plugins/docker-buildx QEMUï¼š\ndocker run --privileged --rm tonistiigi/binfmt --install all å°†buildxè®¾ç½®æˆé»˜è®¤çš„é•œåƒç¼–è¯‘å™¨ # å› ä¸º docker buildx build å‘½ä»¤åç»­çš„å¤§éƒ¨åˆ†å‚æ•°ä¸ docker build å®Œå…¨ä¸€è‡´ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è®¾ç½®å‘½ä»¤åˆ«åçš„æ–¹å¼ï¼Œå°† buildx ä½œä¸ºé»˜è®¤çš„é•œåƒç¼–è¯‘å™¨ã€‚\nä½ åªéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š\ndocker buildx install å¦‚æœéœ€è¦å–æ¶ˆè¿™ä¸ªå‘½ä»¤åˆ«åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ndocker buildx uninstall ä½¿ç”¨ # å¼€å§‹ä¸€ä¸ªæ–°çš„æ„å»ºï¼Œæ‰§è¡Œå‘½ä»¤ docker buildx build .ã€‚\nåˆ›å»ºå®ä¾‹\ndocker buildx create --name demo-builder # åˆ›å»ºå¹¶ä½¿ç”¨ docker buildx create --use --name demo-builder ä½¿ç”¨å®ä¾‹\ndocker buildx use demo-builder äº¤å‰ç¼–è¯‘\ndocker buildx build . -t demo:latest åˆ é™¤å®ä¾‹\ndocker buildx rm demo-builder Â« Docker in Docker\nÂ» Docker å¸¸ç”¨å‘½ä»¤\n"},{"id":51,"href":"/docker/docker-commands/","title":"Docker Commands","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / Docker å¸¸ç”¨å‘½ä»¤\nDocker å¸¸ç”¨å‘½ä»¤ # å¯åŠ¨å®¹å™¨å‘½ä»¤ # é»˜è®¤éœ€è¦sudoæƒé™æ‰§è¡Œ\nsudo docker run -d -p 80:80 --name nginx nginx \u0026ndash;nameï¼šå®¹å™¨å‘½å\n-dï¼šåœ¨åå°å¯åŠ¨\n-pï¼š\u0026lt;hostç«¯å£\u0026gt;ï¼š\u0026lt;å®¹å™¨ç«¯å£\u0026gt;\n\u0026ndash;rmï¼šå®¹å™¨é€€å‡ºå³åˆ é™¤\n-itï¼ši-ä¸å®¹å™¨äº¤äº’ï¼Œt-ç»ˆç«¯\nä»¥rootæƒé™è¿›å…¥å®¹å™¨ # sudo docker exec -it -u root nginx bash è®©å®¹å™¨ä¸€ç›´ç¡çœ  # ä½¿ç”¨ curlimages/curl é•œåƒï¼Œå¹¶è®©å…¶ä¸€ç›´ç¡çœ ã€‚\ndocker run -d --name sleep curlimages/curl sleep infinity æ“ä½œé•œåƒå‘½ä»¤ # æŸ¥çœ‹é•œåƒ # sudo docker images åˆ é™¤é•œåƒ # sudo docker rmi \u0026lt;image\u0026gt; # or sudo docker image rm \u0026lt;image\u0026gt; åˆ é™¤æ‰€æœ‰é•œåƒ # sudo docker rmi $(docker images -q) æ¸…é™¤æœªä½¿ç”¨é•œåƒ # sudo docker image prune # or sudo docker rmi $(sudo docker images | grep \u0026#34;^\u0026lt;none\u0026gt;\u0026#34; | awk \u0026#34;{print $3}\u0026#34;) æ¨¡ç³Šæ¸…é™¤é•œåƒ # docker rmi $(docker images | grep \u0026#39;query\u0026#39; | awk \u0026#39;{print $3}\u0026#39;) æ“ä½œå®¹å™¨å‘½ä»¤ # æŸ¥çœ‹å·²ç»é€€å‡ºçš„å®¹å™¨ # sudo docker ps -a | grep Exited æ¸…ç†å·²ç»é€€å‡ºçš„å®¹å™¨ # sudo docker rm $(sudo docker ps -qf status=exited) # or sudo docker rm `sudo docker ps -a | grep Exited | awk \u0026#39;{print $1}\u0026#39;` æ¸…é™¤æ‰€æœ‰å®¹å™¨ # ä½¿ç”¨ -f å‚æ•°æ‰èƒ½æ¸…é™¤æ‰€æœ‰å®¹å™¨ï¼Œä¸ä½¿ç”¨åˆ™åªä¼šæ¸…ç†å·²ç»é€€å‡ºçš„å®¹å™¨\nsudo docker rm $(sudo docker ps -a -q) -f æ¸…é™¤å­¤ç«‹å®¹å™¨ # sudo docker container prune å¼ºåˆ¶åˆ é™¤å®¹å™¨ # å¦‚æœæŸä¸ª Pod çªç„¶ä¸å¯ç”¨ï¼Œé‚£ä¹ˆè¿è¡Œåœ¨è¯¥èŠ‚ç‚¹ä¸Šçš„ Pod å¯èƒ½ä¼šä¸€ç›´å¤„äº Terminating çš„çŠ¶æ€ï¼Œæ— æ³•ç§»é™¤ã€‚è¿™æ—¶å€™å¦‚æœæƒ³å¼ºåˆ¶å°†è¯¥ Pod ä» etcd æ•°æ®åº“ä¸­åˆ é™¤ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\nkubectl delete po \u0026lt;pod-name\u0026gt; -n \u0026lt;namespace\u0026gt; --force --grace-period=0 grace-period è¡¨ç¤ºè¿‡æ¸¡å­˜æ´»æœŸï¼Œé»˜è®¤ 30sï¼Œåœ¨åˆ é™¤ Pod ä¹‹å‰å…è®¸ Pod æ…¢æ…¢ç»ˆæ­¢å…¶ä¸Šçš„å®¹å™¨è¿›ç¨‹ï¼Œä»è€Œä¼˜é›…é€€å‡ºï¼Œ0 è¡¨ç¤ºç«‹å³ç»ˆæ­¢ Podã€‚\næ‰“åŒ…é•œåƒ # åŸºäºå·²æœ‰ Docker é•œåƒæ‰“åŒ…æˆä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼š\ndocker save -o nginx.tar nginx # è½½å…¥é•œåƒï¼Œdocker load ä¸èƒ½æŒ‡å®šè½½å…¥çš„é•œåƒå docker load -i nginx.tar å¯¼å‡ºé•œåƒ # åŸºäºè¿è¡Œçš„å®¹å™¨ï¼Œå¯¼å‡ºä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼š\n# è¿è¡Œä¸€ä¸ªå®¹å™¨ docker run --name nginx-server -d nginx docker export nginx.tar nginx-server # å¯¼å…¥å®¹å™¨ï¼Œdocker import å¯ä»¥æŒ‡å®šé•œåƒå docker import nginx.tar mynginx Â« docker buildx\nÂ» Docker Compose å®è·µ\n"},{"id":52,"href":"/docker/docker-compose-practice/","title":"Docker Compose Practice","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / Docker Compose å®è·µ\nDocker Compose å®è·µ # å®‰è£… # å¦‚æœä½ å®‰è£…äº† Docker Desktopï¼Œé‚£ä¹ˆå®ƒå·²ç»å¸®ä½ è‡ªåŠ¨å®‰è£…äº† Docker Compose æ’ä»¶ã€‚å¦åˆ™ï¼Œéœ€è¦é¢å¤–å®‰è£…æ’ä»¶ã€‚\nä½¿ç”¨ä¸€ä¸‹å‘½ä»¤å®‰è£…æˆ–å‡çº§ Docker Composeï¼ˆlinuxï¼‰ï¼š\nUbuntuï¼ŒDebianï¼š sudo apt update sudo apt install docker-compose-plugin åŸºäº RPM å‘è¡Œç‰ˆ: sudo yum update sudo yum install docker-compose-plugin éªŒè¯å®‰è£…ç‰ˆæœ¬ï¼š\ndocker-compose version å¸¸ç”¨å‘½ä»¤ # è¿è¡Œ\ndocker-compose up æŸ¥çœ‹è¿è¡Œ\ndocker-compose ps åœæ­¢\ndocker-compose stop å¯åŠ¨\u0026amp;é‡å¯\ndocker-compose start docker-compose restart é€€å‡º\ndocker-compose down ä½¿ç”¨ docker-compose -h æŸ¥çœ‹æ›´å¤šå‘½ä»¤åŠå‚æ•°ã€‚\nå®è·µ # ä½¿ç”¨ Docker Compose è¿è¡Œä¸€ä¸ªç®€å•çš„ golang web ç¨‹åºã€‚\nç¨‹åºåˆå§‹åŒ– mkdir docker-compose-go-demo cd docker-compose-go-demo go mod init docker-compose-go-demo åˆ›å»º main.go æ–‡ä»¶ï¼Œå¹¶å†™å…¥ç¨‹åºä»£ç  package main import ( \u0026#34;fmt\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;time\u0026#34; ) func greet(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, \u0026#34;Hello Docker Compose! %s\u0026#34;, time.Now()) } func main() { http.HandleFunc(\u0026#34;/\u0026#34;, greet) http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) } åˆ›å»º Dockerfile æ–‡ä»¶ï¼Œå¹¶ç¼–å†™å†…å®¹ FROM golang:alpine WORKDIR /app COPY . . EXPOSE 8080 ENTRYPOINT [ \u0026#34;go\u0026#34;,\u0026#34;run\u0026#34;,\u0026#34;main.go\u0026#34; ] åˆ›å»º docker-comppose.yml æ–‡ä»¶ï¼Œå¹¶ç¼–å†™å†…å®¹ version: \u0026#34;3.9\u0026#34; services: web: build: . # image: docker-compose-go-demo_web:v1 # image: docker-compose-go-demo_web:v2 ports: - \u0026#34;8080:8080\u0026#34; å¯åŠ¨æœåŠ¡ docker-compose up -d åœºæ™¯ï¼š\nweb æœåŠ¡ä¸šåŠ¡ä»£ç ä¿®æ”¹äº†ï¼Œå¸Œæœ›ä¸åœæœºæ›´æ–°æœåŠ¡ï¼š docker-compose up -d --build åŒ…å«å¤šä¸ªæœåŠ¡ï¼Œä¾‹å¦‚ä¸­é—´ä»¶ï¼Œä½†åªæƒ³é‡æ–°ç¼–è¯‘å…¶ä¸­ä¸šåŠ¡æœåŠ¡ï¼Œå¦‚ webï¼š docker-compose up -d --no-deps --build web å¦‚æœ docker-compose.yml ç›´æ¥ä½¿ç”¨çš„é•œåƒï¼Œé‚£ä¹ˆç›´æ¥æ›´æ–°ï¼Œå†æ¬¡ docker-compose up -d å³å¯ã€‚\nÂ« Docker å¸¸ç”¨å‘½ä»¤\nÂ» Docker å®¹å™¨ä¸­å®‰è£… PFX è¯ä¹¦\n"},{"id":53,"href":"/docker/docker-container-install-pfx-cert/","title":"Docker Container Install Pfx Cert","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / Docker å®¹å™¨ä¸­å®‰è£… PFX è¯ä¹¦\nDocker å®¹å™¨ä¸­å®‰è£… PFX è¯ä¹¦ # å¦‚æœæ­£åœ¨å¼€å‘ .NetCore é¡¹ç›®ï¼Œå¹¶ä¸”ä½ çš„é¡¹ç›®éœ€è¦ä½¿ç”¨åˆ° PFX è¯ä¹¦ã€‚æ­¤æ—¶ä½ éœ€è¦å°†ä½ çš„é¡¹ç›®å‘å¸ƒåˆ° Docker å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦åœ¨ä½ çš„ Docker å®¹å™¨ä¸­å®‰è£… PFX è¯ä¹¦äº†ã€‚\nä»£ç ä¸­ç¼–å†™ # ä½¿ç”¨ X509Store Api ç¼–å†™ä½ çš„ç¨‹åº\nusing (var certificate = new X509Certificate2(pfxFileBytes, pfxPassword, X509KeyStorageFlags.Exportable | X509KeyStorageFlags.PersistKeySet)) using (var store = new X509Store(storeName, storeLocation, OpenFlags.ReadWrite)) { store.Add(certificate); store.Close(); } Dockerfile ä¸­ç¼–å†™ # ä½¿ç”¨ dotnet-certificate-tool å·¥å…·å®‰è£… pfx è¯ä¹¦ã€‚\né¦–å…ˆè·å–åˆ° Pfx æ–‡ä»¶çš„ Thumbprintï¼Œè¿™åœ¨ dotnet-certificate-tool å‘½ä»¤ä¸­ä½œä¸ºå‚æ•°è¢«ä½¿ç”¨ã€‚\nä½¿ç”¨ Powershell Get-PfxCertificate å‡½æ•°è·å– Thumbprint Get-PfxCertificate -FilePath C:\\Pfx\\Hello-to-World.pfx æ‰§è¡Œä»¥ä¸Šå‘½ä»¤ï¼Œä¼šè¦æ±‚è¾“å…¥ pfx è¯ä¹¦å¯†ç ï¼Œè¾“å…¥å¯†ç åï¼Œä½ åº”è¯¥å¯ä»¥å¾—åˆ° Thumbprint äº†ï¼Œè¾“å‡ºæ ¼å¼å¤§è‡´å¦‚ä¸‹ï¼š\nThumbprint Subject ---------- ------- EED5DCA70697648CDFGD7FB1EFDDD683579B436E CN=Hello-to-World, OU=IT, O=Hello åœ¨ Dockerfile å†…å®¹å¤§è‡´å¦‚ä¸‹\nFROM mcr.microsoft.com/dotnet/core/sdk:3.1 WORKDIR /app COPY Hello-to-World.pfx ./ ENV PATH \u0026#34;$PATH:/root/.dotnet/tools\u0026#34; RUN dotnet tool install dotnet-certificate-tool -g \u0026amp;\u0026amp; certificate-tool add -f ./Hello-to-World.pfx -p Password123 -t EED5DCA70697648CDFGD7FB1EFDDD683579B436E ENTRYPOINT [\u0026#34;dotnet\u0026#34;, \u0026#34;PfxTest.dll\u0026#34;] Â« Docker Compose å®è·µ\nÂ» Docker ä¸»æœºå®¹å™¨äº’æ‹·è´æ–‡ä»¶\n"},{"id":54,"href":"/docker/docker-copy-between-host-container/","title":"Docker Copy Between Host Container","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / Docker ä¸»æœºå®¹å™¨äº’æ‹·è´æ–‡ä»¶\nDocker ä¸»æœºå®¹å™¨äº’æ‹·è´æ–‡ä»¶ # å‘½ä»¤ï¼šdocker cp\n1. å°† Docker å®¹å™¨å†…æ–‡ä»¶æ‹·è´åˆ° Host # è·å– docker å®¹å™¨çš„ Container ID æˆ–Name\nsudo docker ps ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä»å®¹å™¨å†…æ‹·å‡ºæ–‡ä»¶\nsudo docker cp [CONTAINER ID/NAME]:[CONTAINER_PATH] [HOST_PATH] ä¾‹å¦‚æˆ‘éœ€è¦å°†å®¹å™¨å†… /app/appsettings.json æ–‡ä»¶æ‹·è´åˆ°å®¿ä¸»æœºçš„ ~/temp/ ç›®å½• ï¼ˆè¯¥ç›®å½•å¿…é¡»å­˜åœ¨ï¼‰ ä¸‹\nsudo docker cp b3e608e28f21:/app/appsettings.json ~/temp/appsettings.json # ä¸æŒ‡å®šæ–‡ä»¶åäº¦å¯ï¼Œé»˜è®¤ä½¿ç”¨åŸæ–‡ä»¶å sudo docker cp b3e608e28f21:/app/appsettings.json ~/temp/ 2. å°† Host æ–‡ä»¶æ‹·è´è‡³ Docker å®¹å™¨ # åŒæ ·ï¼Œéœ€è¦å…ˆè·å–å®¹å™¨çš„ Container ID æˆ– Nameï¼›\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æ–‡ä»¶æ‹·è´è‡³å®¹å™¨å†…\nsudo docker cp [HOST_PATH] [CONTAINER ID/NAME]:[CONTAINER_PATH] ä¾‹å¦‚æˆ‘éœ€è¦å°†å®¿ä¸»æœºçš„ ~/temp/hello.txt æ–‡ä»¶æ‹·è´è‡³å®¹å™¨å†… /app/ ç›®å½• ï¼ˆè¯¥ç›®å½•å¿…é¡»å­˜åœ¨ï¼‰ ä¸‹\nsudo docker cp ~/temp/hello.txt b3e608e28f21:/app/hello.txt # ä¸æŒ‡å®šæ–‡ä»¶åäº¦å¯ï¼Œé»˜è®¤ä½¿ç”¨åŸæ–‡ä»¶å sudo docker cp ~/temp/hello.txt b3e608e28f21:/app/ Â« Docker å®¹å™¨ä¸­å®‰è£… PFX è¯ä¹¦\nÂ» ä½¿ç”¨ docker manifest å‘½ä»¤æ„å»ºå¤šæ¶æ„é•œåƒ\n"},{"id":55,"href":"/docker/docker-manifest-build-cross-arch-image/","title":"Docker Manifest Build Cross Arch Image","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / ä½¿ç”¨ docker manifest å‘½ä»¤æ„å»ºå¤šæ¶æ„é•œåƒ\nä½¿ç”¨ docker manifest å‘½ä»¤æ„å»ºå¤šæ¶æ„é•œåƒ # # åˆ›å»º docker manifest create poneding/myimage:v1 poneding/myimage-amd64:v1 poneding/myimage-arm64:v1 # æ³¨è§£ docker manifest annotate poneding/myimage:v1 poneding/myimage-amd64:v1 --arch amd64 docker manifest annotate poneding/myimage:v1 poneding/asmyimageh-arm64:v1 --arch arm64 # æ£€æŸ¥ docker manifest inspect poneding/myimage:v1 # æ¨é€ docker manifest push poneding/myimage:v1 åœ¨ x86 æœºå™¨ä¸Šæ„å»º arm64 é•œåƒ\ndocker run --rm --privileged multiarch/qemu-user-static --reset --persistent yes Â« Docker ä¸»æœºå®¹å™¨äº’æ‹·è´æ–‡ä»¶\nÂ» ç†è§£ docker run \u0026ndash;link\n"},{"id":56,"href":"/docker/docker-run-link/","title":"Docker Run Link","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / ç†è§£ docker run \u0026ndash;link\nç†è§£ docker run \u0026ndash;link # ä½¿ç”¨æ–¹å¼ # # å‰æå·²ç»å­˜åœ¨ä¸€ä¸ª container2 åœ¨è¿è¡Œ docker run img1 --name container1 --link container2 ä½œç”¨ # container1 è¿æ¥ container2ï¼Œè¾¾åˆ°ï¼š\nä¸ container2 ç›´æ¥é€šä¿¡ è·å– container2 çš„ç¯å¢ƒå˜é‡ Â« ä½¿ç”¨ docker manifest å‘½ä»¤æ„å»ºå¤šæ¶æ„é•œåƒ\nÂ» Docker å¯è§†åŒ–å·¥å…· Kitematic\n"},{"id":57,"href":"/docker/docker-visiable-tool-kitematic/","title":"Docker Visiable Tool Kitematic","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / Docker å¯è§†åŒ–å·¥å…· Kitematic\nDocker å¯è§†åŒ–å·¥å…· Kitematic # ä½¿ç”¨ Kitematicï¼Œä»¥å¯è§†åŒ–çš„æ–¹å¼ç®¡ç† docker é•œåƒï¼Œå®¹å™¨ç­‰ã€‚\nå®‰è£… Kitematic # åœ¨ ubuntuï¼ˆdesktopï¼‰ä¸­å®‰è£… kitematic ä½œä¸ºç¤ºä¾‹ï¼Œå…¶ä»–å¹³å°å®‰è£…ä¸‹è½½åœ°å€ï¼š https://github.com/docker/kitematic/releases\n# download wget https://github.com/docker/kitematic/releases/download/v0.17.11/Kitematic-0.17.11-Ubuntu.zip unzip Kitematic-0.17.11-Ubuntu.zip # install sudo dpkg -i Kitematic-0.17.11_amd64.deb ç”¨æˆ·ç»„ç®¡ç† # ubuntu å·²ç»å®‰è£…äº† docker äº†ï¼Œå½“æˆ‘ä»¬å®‰è£…å®Œ Kitematic ä¹‹åï¼Œç¬¬ä¸€æ¬¡æ‰“å¼€ä¼šé‡åˆ°\nå°†å½“å‰ç”¨æˆ·åŠ å…¥åˆ° docker ç»„ï¼š\nsudo usermod -aG docker $USER # é‡å¯ docker sudo systemctl restart docker sudo chmod a+rw /var/run/docker.sock å®Œæˆä¸Šé¢æ“ä½œåï¼Œé‡å¯ä¸»æœºï¼Œåº”è¯¥å°±å¯ä»¥ä½¿ç”¨ Kitamatic äº†ã€‚\nä½¿ç”¨ Kitematic # ç¬¬ä¸€æ¬¡å¯åŠ¨ Kitematicï¼Œéœ€è¦ç™»å½• docker è´¦å·ï¼Œç™»å½•å®Œæˆåï¼Œç•Œé¢å¦‚ä¸‹ã€‚\nä¸»ç•Œé¢ä¼šåˆ—å‡ºä¸€äº›çƒ­é—¨çš„é•œåƒï¼Œæ¯”å¦‚ redisï¼Œjenkinsã€‚å¯ä»¥é€šè¿‡åˆ‡æ¢å³ä¸Šè§’èœå•é€‰é¡¹ï¼ŒæŸ¥çœ‹æˆ‘çš„ Docker è´¦å·ä¸­çš„é•œåƒåˆ—è¡¨ï¼Œä»¥åŠæˆ‘å½“å‰ä¸»æœºä¸­å·²ç»æ‹‰å–çš„é•œåƒåˆ—è¡¨ã€‚\nç‚¹å‡»é•œåƒçš„ Create æŒ‰é’®ï¼Œå¯ä»¥ç›´æ¥ä»¥é»˜è®¤æ–¹å¼å¯åŠ¨å®¹å™¨ï¼Œæ¯”å¦‚æˆ‘é€‰æ‹© redis é•œåƒï¼Œç‚¹å‡» Create æŒ‰é’®ï¼Œä¹‹åä¼šåœ¨æˆ‘çš„å·¦ä¾§ Containers åˆ—è¡¨ä¸­å‡ºç°ä¸€ä¸ª redis å®¹å™¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­åŒ…å«æ‹‰å–é•œåƒï¼Œå¯åŠ¨å®¹å™¨ã€‚\nå®¹å™¨è¿è¡Œåï¼Œå¯ä»¥åœ¨å®¹å™¨ç•Œé¢å¯¹å®¹å™¨è¿›è¡Œå®¹å™¨é…ç½®ï¼Œä¾‹å¦‚ç¯å¢ƒå˜é‡é…ç½®ã€ç«¯å£æ˜ å°„é…ç½®ã€å·æ˜ å°„é…ç½®ç­‰ï¼›\nä¹Ÿå¯ä»¥åœ¨å®¹å™¨ç•Œé¢å¯¹å®¹å™¨è¿›è¡Œå®¹å™¨ç®¡ç†ï¼Œä¾‹å¦‚å®¹å™¨åœæ­¢ã€é‡å¯ã€å’Œåˆ é™¤ã€‚\nè¿™ä¸ªå·¥å…·åŠŸèƒ½è¿˜åœ¨ä¸æ–­å®Œå–„ï¼Œä½†æ˜¯ä½¿ç”¨ä½“éªŒè¿˜ç®—ä¸é”™ï¼Œæ¨èç»™å¤§å®¶ï¼Œæ›´å¤šä½¿ç”¨ç»†èŠ‚å¯ä»¥è‡ªå·±æ…¢æ…¢æŒ–æ˜ã€‚\nÂ« ç†è§£ docker run \u0026ndash;link\nÂ» Dockerfile\n"},{"id":58,"href":"/docker/dockerfile/","title":"Dockerfile","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / Dockerfile\nDockerfile # å®˜æ–¹æ–‡æ¡£å‚è€ƒï¼š https://docs.docker.com/engine/reference/builder/\nDockerfile Linterï¼š https://hadolint.github.io/hadolint/\nUsage # docker build [work-dir] -t [image-tag] -f [dockerfile-path] --build-arg [arg-key]=[arg-value] æŒ‡ä»¤ # Dockerfile reference | Docker Documentation\nFROM # ARG # ç”±docker buildå‘½ä»¤ä¼ çš„å‚æ•°ã€‚\nARGåœ¨multi-stageçš„ä½œç”¨èŒƒå›´ # å¦‚æœARGæ”¾ç½®åœ¨ç¬¬ä¸€ä¸ªFROMä¹‹å‰ï¼Œé‚£ä¹ˆä½œç”¨èŒƒå›´æ˜¯å…¨å±€çš„ï¼›å¦‚æœARGæ”¾åœ¨FROMä¹‹åï¼Œé‚£ä¹ˆåªå¯¹FROMçš„stageä½œç”¨ã€‚\nARG USERNAME FROM alpine RUN echo hello, ${USERNAME} FROM alpine RUN echo hi, ${USERNAME} CMD # CMD æŒ‡ä»¤çš„ç›®çš„æ˜¯ä¸ºä¸€ä¸ªå¯æ‰§è¡Œå®¹å™¨æä¾›åˆå§‹è¿è¡Œå‘½ä»¤æˆ–è¿è¡Œå‚æ•°ã€‚\nCMD æŒ‡ä»¤æœ‰ä¸‰ç§å½¢å¼ï¼š\nå¯æ‰§è¡Œå‘½ä»¤ + å‘½ä»¤å‚æ•°åˆ—è¡¨ï¼Œæ¨èä½¿ç”¨ CMD [\u0026#34;executable\u0026#34;,\u0026#34;param1\u0026#34;,\u0026#34;param2\u0026#34;] å‘½ä»¤å‚æ•°åˆ—è¡¨ï¼Œä½œä¸º ENTRYPOINT çš„å‚æ•° CMD [\u0026#34;param1\u0026#34;,\u0026#34;param2\u0026#34;] Shell å½¢å¼ï¼Œå­—ç¬¦ä¸²å½¢å¼çš„å‘½ä»¤ CMD command param1 param2 å•ä¸ª build stage åªå…è®¸å­˜åœ¨ä¸€ä¸ª CMD æŒ‡ä»¤ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ª CMD æŒ‡ä»¤ï¼Œåªæœ‰æœ€åä¸€ä¸ª CMD æŒ‡ä»¤ç”Ÿæ•ˆã€‚\nENTRYPOINT # ENTRYPOINT æŒ‡ä»¤ç”¨äºå®šä¹‰å®¹å™¨å¯åŠ¨æ—¶è¢«è°ƒç”¨çš„å¯æ‰§è¡Œç¨‹åºã€‚\nENTRYPOINT æŒ‡ä»¤æœ‰ä¸¤ç§å½¢å¼ï¼Œä»¥è¿è¡Œ node ç¨‹åºç¤ºä¾‹ï¼š\nexec å½¢å¼ï¼Œæ¨èä½¿ç”¨ ENTRYPOINT [\u0026#34;node\u0026#34;,\u0026#34;app.js\u0026#34;] Shell å½¢å¼ ENTRYPOINT node app.js è¿™ä¸¤ç§å½¢å¼çš„åŒºåˆ«åœ¨äº shell ä¼šåœ¨å®¹å™¨ä¸­è¿è¡Œ /bin/sh -c node app.jsï¼Œè€Œ exec æ˜¯ç›´æ¥è¿è¡Œ node app.js å‘½ä»¤ï¼Œå› æ­¤é‡‡ç”¨ exec å½¢å¼æ˜¯æ›´ä¸ºåˆé€‚çš„ã€‚\nQ\u0026amp;A # 1. Dockerfile ä¸­ ARG æ— æ³•è¢« CMD ä½¿ç”¨ï¼Ÿ # å¯èƒ½ä½ éœ€è¦ä¿®æ”¹ä½ çš„CMDï¼š\nFROM alpine ARG USERNAME ENV USERNAME ${USERNAME} RUN echo ${USERNAME} # CMD [\u0026#34;echo\u0026#34;,\u0026#34;${USERNAME}\u0026#34;] # ä¼šåŸæ ·è¾“å‡º ${USERNAME} CMD [\u0026#34;/bin/sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;echo ${USERNAME}\u0026#34;] # è¾“å‡º dp # æˆ–è€… # CMD echo ${USERNAME} # è¾“å‡º dp docker build . -t echo-user --build-arg USERNAME=dp docker run echo-user Â« Docker å¯è§†åŒ–å·¥å…· Kitematic\nÂ» Linux å®¹å™¨\n"},{"id":59,"href":"/docker/linux-container/","title":"Linux Container","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / Linux å®¹å™¨\nLinux å®¹å™¨ # å®¹å™¨æ˜¯è½»é‡çº§çš„è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚\nèµ„æºéš”ç¦»å’Œé™åˆ¶\nå®¹å™¨é•œåƒ # è”åˆæ–‡ä»¶ç³»ç»Ÿ # å…è®¸æ–‡ä»¶å­˜æ”¾åœ¨ä¸åŒçš„å±‚çº§ä¸Šï¼Œä½†æ˜¯æœ€ç»ˆå¯ä»¥é€šè¿‡ç»Ÿä¸€çš„è§†å›¾æŸ¥çœ‹åˆ°è¿™äº›å±‚çº§çš„æ‰€æœ‰æ–‡ä»¶ã€‚\ncgroup # namespace # mountï¼šæ–‡ä»¶ç³»ç»Ÿéš”ç¦» utsï¼šhostname domain pidï¼š1å·è¿›ç¨‹ network user ipcï¼šè¿›ç¨‹é—´é€šä¿¡ cgroup Â« Dockerfile\nÂ» é root è´¦å·è·å– docker æƒé™\n"},{"id":60,"href":"/docker/non-root-account-get-docker-permission/","title":"Non Root Account Get Docker Permission","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / é root è´¦å·è·å– docker æƒé™\né root è´¦å·è·å– docker æƒé™ # é»˜è®¤ docker çš„å‘½ä»¤æ˜¯éœ€è¦ sudo æƒé™çš„ï¼Œå¦‚æœä½ è§‰å¾—éº»çƒ¦ï¼Œæƒ³ç›´æ¥åœ¨å½“å‰ç”¨æˆ·ä¸‹æ‰§è¡Œ docker æƒé™ï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨ä¸‹é¢è¿™ä¸ªè§£å†³æ–¹æ¡ˆã€‚\næ‹¢å…±åˆ†ä¸¤æ­¥ï¼š\nç¬¬ä¸€æ­¥ï¼Œå°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ° docker ç»„\nsudo usermod -aG docker $USER ç¬¬äºŒæ­¥ï¼Œæˆæƒ\nsudo chmod a+rw /var/run/docker.sock å¿«å»è¯•è¯•å§ã€‚\nÂ« Linux å®¹å™¨\nÂ» Mac é‡è£… Docker Desktop\n"},{"id":61,"href":"/docker/reinstall-docker-desktop-on-mac/","title":"Reinstall Docker Desktop on MAC","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / Mac é‡è£… Docker Desktop\nMac é‡è£… Docker Desktop # åœ¨ä½¿ç”¨ Docker Desktop çš„è¿‡ç¨‹ä¸­ï¼Œçªç„¶é‡åˆ°ç¨‹åºå´©æºƒ Invalid virtual machine configuration. The storage device attachment is invalidï¼Œåœ¨é‡å¯ä»¥åŠç®€å•é‡è£…æ— æœåï¼Œæˆ‘ä»¬è¯•ç”¨ä»¥ä¸‹æ–¹å¼é‡è£…ã€‚\nç¬¬ä¸€æ­¥ï¼Œå¸è½½ Docker Desktopï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n# å¸è½½ /Applications/Docker.app/Contents/MacOS/uninstall # åˆ é™¤å‰©ä½™æ–‡ä»¶ rm -rf ~/Library/Group\\ Containers/group.com.docker rm -rf ~/Library/Containers/com.docker.docker rm -rf ~/.docker ç¬¬äºŒæ­¥ï¼Œé‡å¯ Macï¼Œé‡å¯åï¼Œæ‰“å¼€æ´»åŠ¨ç›‘è§†å™¨ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨åä¸ºcom.docker.vmnetd çš„è¿›ç¨‹ï¼Œå¦‚æœå­˜åœ¨ï¼Œç»“æŸè¯¥è¿›ç¨‹ï¼ˆå¦‚æœæ— æ³•æ­£å¸¸ç»“æŸï¼Œé‚£ä¹ˆå°è¯•å¼ºåˆ¶ç»“æŸè¿›ç¨‹ï¼‰ã€‚\nç¬¬ä¸‰æ­¥ï¼Œé‡è£… Docker Desktopã€‚\nÂ« é root è´¦å·è·å– docker æƒé™\nÂ» some-apps.md\n"},{"id":62,"href":"/docker/some-apps/","title":"Some Apps","section":"Docker","content":" ğŸ  é¦–é¡µ / Docker / some-apps.md\nDocker åº”ç”¨\nCloudreve # é¡¹ç›®åœ°å€ï¼š https://github.com/cloudreve/Cloudreve\ndocker run -d --name cloudreve \\ -p 5212:5212 \\ --mount type=bind,source=/root/apps/cloudreve/conf.ini,target=/cloudreve/conf.ini \\ --mount type=bind,source=/root/apps/cloudreve/cloudreve.db,target=/cloudreve/cloudreve.db \\ -v /root/apps/cloudreve/uploads:/cloudreve/uploads \\ -v /root/apps/cloudreve/avatar:/cloudreve/avatar \\ cloudreve/cloudreve:latest Etcd # docker run -d --name etcd \\ -p 12379:2379 \\ -p 12380:2380 \\ -e ALLOW_NONE_AUTHENTICATION=yes \\ -e ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379 \\ -e ETCD_ADVERTISE_CLIENT_URLS=http://etcd:2379,http://0.0.0.0:2379 \\ -v /root/apps/etcd/data:/var/run/etcd \\ quay.io/coreos/etcd:v3.5.6 Minio # docker run -d --name minio \\ -p 9000:9000 \\ -p 9001:9001 \\ -e MINIO_ROOT_USER=minio \\ -e MINIO_ROOT_PASSWORD=\u0026#39;pd1n9@1024\u0026#39; \\ -v /root/apps/minio/data:/data \\ quay.io/minio/minio:latest server /data --console-address \u0026#34;:9001\u0026#34; MySQL # docker run -d --name mysql \\ -v /root/apps/mysql/data:/var/lib/mysql \\ -e MYSQL_ROOT_PASSWORD=\u0026#39;pd1n9@1024\u0026#39; \\ -p 3306:3306 \\ mysql:8.0 Postgres # docker run -d --name postgres \\ -p 5432:5432 \\ -e POSTGRES_USER=root \\ -e POSTGRES_PASSWORD=pd1n9@1024 \\ -v /root/apps/postgres/data:/var/lib/postgresql/data \\ postgre RabbitMQ # docker run -d --name rabbitmq \\ -p 15672:15672 \\ -p 5672:5672 \\ --hostname rabbitmq \\ -e RABBITMQ_DEFAULT_USER=pding \\ -e RABBITMQ_DEFAULT_PASS=P0n3_D1n9 \\ registry.cn-hangzhou.aliyuncs.com/pding/rabbitmq:3-management Redis # docker run -d --name redis \\ -v /root/apps/redis/data:/data \\ -p 6379:6379 \\ redis:7.0 redis-server --requirepass \u0026#34;pd1n9@1024\u0026#34; Transfer # docker run -d --name transfer \\ -p 7080:8080 \\ dutchcoders/transfer.sh:latest --provider local --basedir /tmp/ Â« Mac é‡è£… Docker Desktop\n"},{"id":63,"href":"/ebpf/","title":"Ebpf","section":"","content":" ğŸ  é¦–é¡µ / EBPF\nEBPF # eBPF\n"},{"id":64,"href":"/ebpf/ebpf/","title":"Ebpf","section":"Ebpf","content":" ğŸ  é¦–é¡µ / EBPF / eBPF\neBPF # ç®€ä»‹ # eBPF (extended Berkeley Packet Filter) æ˜¯ä¸€é¡¹é©å‘½æ€§çš„æŠ€æœ¯ï¼Œèµ·æºäº Linux å†…æ ¸ï¼Œå®ƒå¯ä»¥åœ¨ç‰¹æƒä¸Šä¸‹æ–‡ä¸­ï¼ˆå¦‚æ“ä½œç³»ç»Ÿå†…æ ¸ï¼‰è¿è¡Œæ²™ç›’ç¨‹åºã€‚å®ƒç”¨äºå®‰å…¨æœ‰æ•ˆåœ°æ‰©å±•å†…æ ¸çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€é€šè¿‡æ›´æ”¹å†…æ ¸æºä»£ç æˆ–åŠ è½½å†…æ ¸æ¨¡å—çš„æ–¹å¼æ¥å®ç°ã€‚\nä»å†å²ä¸Šçœ‹ï¼Œç”±äºå†…æ ¸å…·æœ‰ç›‘ç£å’Œæ§åˆ¶æ•´ä¸ªç³»ç»Ÿçš„ç‰¹æƒï¼Œæ“ä½œç³»ç»Ÿä¸€ç›´æ˜¯å®ç°å¯è§‚æµ‹æ€§ã€å®‰å…¨æ€§å’Œç½‘ç»œåŠŸèƒ½çš„ç†æƒ³åœºæ‰€ã€‚åŒæ—¶ï¼Œç”±äºæ“ä½œç³»ç»Ÿå†…æ ¸çš„æ ¸å¿ƒåœ°ä½å’Œå¯¹ç¨³å®šæ€§å’Œå®‰å…¨æ€§çš„é«˜è¦æ±‚ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å¾ˆéš¾å¿«é€Ÿè¿­ä»£å‘å±•ã€‚å› æ­¤åœ¨ä¼ ç»Ÿæ„ä¹‰ä¸Šï¼Œä¸åœ¨æ“ä½œç³»ç»Ÿæœ¬èº«ä¹‹å¤–å®ç°çš„åŠŸèƒ½ç›¸æ¯”ï¼Œæ“ä½œç³»ç»Ÿçº§åˆ«çš„åˆ›æ–°é€Ÿåº¦è¦æ…¢ä¸€äº›ã€‚\neBPF ä»æ ¹æœ¬ä¸Šæ”¹å˜äº†è¿™ä¸ªæ–¹å¼ã€‚é€šè¿‡å…è®¸åœ¨æ“ä½œç³»ç»Ÿä¸­è¿è¡Œæ²™ç›’ç¨‹åºçš„æ–¹å¼ï¼Œåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¯ä»¥è¿è¡Œ eBPF ç¨‹åºï¼Œä»¥ä¾¿åœ¨è¿è¡Œæ—¶å‘æ“ä½œç³»ç»Ÿæ·»åŠ é¢å¤–çš„åŠŸèƒ½ã€‚ç„¶ååœ¨ JIT ç¼–è¯‘å™¨å’ŒéªŒè¯å¼•æ“çš„å¸®åŠ©ä¸‹ï¼Œæ“ä½œç³»ç»Ÿç¡®ä¿å®ƒåƒæœ¬åœ°ç¼–è¯‘çš„ç¨‹åºä¸€æ ·å…·å¤‡å®‰å…¨æ€§å’Œæ‰§è¡Œæ•ˆç‡ã€‚è¿™å¼•å‘äº†ä¸€è‚¡åŸºäº eBPF çš„é¡¹ç›®çƒ­æ½®ï¼Œå®ƒä»¬æ¶µç›–äº†å¹¿æ³›çš„ç”¨ä¾‹ï¼ŒåŒ…æ‹¬ä¸‹ä¸€ä»£ç½‘ç»œå®ç°ã€å¯è§‚æµ‹æ€§å’Œå®‰å…¨åŠŸèƒ½ç­‰é¢†åŸŸã€‚\nå¦‚ä»Šï¼ŒeBPF è¢«å¹¿æ³›ç”¨äºé©±åŠ¨å„ç§ç”¨ä¾‹ï¼šåœ¨ç°ä»£æ•°æ®ä¸­å¿ƒå’Œäº‘åŸç”Ÿç¯å¢ƒä¸­æä¾›é«˜æ€§èƒ½ç½‘ç»œå’Œè´Ÿè½½å‡è¡¡ï¼Œä»¥ä½å¼€é”€æå–ç»†ç²’åº¦çš„å®‰å…¨å¯è§‚æµ‹æ€§æ•°æ®ï¼Œå¸®åŠ©åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜è·Ÿè¸ªåº”ç”¨ç¨‹åºï¼Œä¸ºæ€§èƒ½æ•…éšœæ’æŸ¥ã€é¢„é˜²æ€§çš„å®‰å…¨ç­–ç•¥æ‰§è¡Œ(åŒ…æ‹¬åº”ç”¨å±‚å’Œå®¹å™¨è¿è¡Œæ—¶)æä¾›æ´å¯Ÿï¼Œç­‰ç­‰ã€‚å¯èƒ½æ€§æ˜¯æ— é™çš„ï¼ŒeBPF å¼€å¯çš„åˆ›æ–°æ‰åˆšåˆšå¼€å§‹ã€‚\né’©å­ # eBPF ç¨‹åºæ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œå½“å†…æ ¸æˆ–åº”ç”¨ç¨‹åºé€šè¿‡æŸä¸ªé’©å­ç‚¹æ—¶è¿è¡Œã€‚é¢„å®šä¹‰çš„é’©å­åŒ…æ‹¬ç³»ç»Ÿè°ƒç”¨ã€å‡½æ•°å…¥å£/é€€å‡ºã€å†…æ ¸è·Ÿè¸ªç‚¹ã€ç½‘ç»œäº‹ä»¶ç­‰ã€‚\nå¦‚æœé¢„å®šä¹‰çš„é’©å­ä¸èƒ½æ»¡è¶³ç‰¹å®šéœ€æ±‚ï¼Œåˆ™å¯ä»¥åˆ›å»ºå†…æ ¸æ¢é’ˆï¼ˆkprobeï¼‰æˆ–ç”¨æˆ·æ¢é’ˆï¼ˆuprobeï¼‰ï¼Œä»¥ä¾¿åœ¨å†…æ ¸æˆ–ç”¨æˆ·åº”ç”¨ç¨‹åºçš„å‡ ä¹ä»»ä½•ä½ç½®é™„åŠ  eBPF ç¨‹åºã€‚\nç¼–å†™ç¨‹åº # åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒeBPF ä¸æ˜¯ç›´æ¥ä½¿ç”¨ï¼Œè€Œæ˜¯é€šè¿‡åƒÂ Ciliumã€ bccÂ æˆ–Â bpftraceÂ è¿™æ ·çš„é¡¹ç›®é—´æ¥ä½¿ç”¨ï¼Œè¿™äº›é¡¹ç›®æä¾›äº† eBPF ä¹‹ä¸Šçš„æŠ½è±¡ï¼Œä¸éœ€è¦ç›´æ¥ç¼–å†™ç¨‹åºï¼Œè€Œæ˜¯æä¾›äº†æŒ‡å®šåŸºäºæ„å›¾çš„æ¥å®šä¹‰å®ç°çš„èƒ½åŠ›ï¼Œç„¶åç”¨ eBPF å®ç°ã€‚\nå¦‚æœä¸å­˜åœ¨æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œåˆ™éœ€è¦ç›´æ¥ç¼–å†™ç¨‹åºã€‚Linux å†…æ ¸æœŸæœ› eBPF ç¨‹åºä»¥å­—èŠ‚ç çš„å½¢å¼åŠ è½½ã€‚è™½ç„¶ç›´æ¥ç¼–å†™å­—èŠ‚ç å½“ç„¶æ˜¯å¯èƒ½çš„ï¼Œä½†æ›´å¸¸è§çš„å¼€å‘å®è·µæ˜¯åˆ©ç”¨åƒÂ LLVMÂ è¿™æ ·çš„ç¼–è¯‘å™¨å¥—ä»¶å°†ä¼ª c ä»£ç ç¼–è¯‘æˆ eBPF å­—èŠ‚ç ã€‚\nå®‰å…¨æ€§ # ç”±äº eBPF å…è®¸æˆ‘ä»¬åœ¨å†…æ ¸ä¸­è¿è¡Œä»»æ„ä»£ç ï¼Œéœ€è¦æœ‰ä¸€ç§æœºåˆ¶æ¥ç¡®ä¿å®ƒçš„å®‰å…¨è¿è¡Œï¼Œä¸ä¼šä½¿ç”¨æˆ·çš„æœºå™¨å´©æºƒï¼Œä¹Ÿä¸ä¼šæŸå®³ä»–ä»¬çš„æ•°æ®ã€‚è¿™ä¸ªæœºåˆ¶å°±æ˜¯ eBPF éªŒè¯å™¨ã€‚\néªŒè¯å™¨å¯¹ eBPF ç¨‹åºè¿›è¡Œåˆ†æï¼Œä»¥ç¡®ä¿æ— è®ºè¾“å…¥ä»€ä¹ˆï¼Œå®ƒéƒ½ä¼šåœ¨ä¸€å®šæ•°é‡çš„æŒ‡ä»¤å†…å®‰å…¨åœ°ç»ˆæ­¢ã€‚\näº‘åŸç”Ÿé¢†åŸŸ # å±å¼ƒ SideCar æ¨¡å¼ï¼Œå°†eBPF åŠ è½½åˆ°å†…æ ¸ï¼Œè·Ÿéšäº‹ä»¶è§¦å‘ã€‚\né¡¹ç›® # Ciliumï¼šåŸºäº eBPF çš„æ•°æ®å¹³é¢çš„ç½‘ç»œï¼Œå¯è§‚æµ‹æ€§ã€å®‰å…¨æ€§çš„è§£å†³æ–¹æ¡ˆã€‚ Pixieï¼šåŸºäº eBPF å®ç°çš„ Kubernetes å¯è§‚æµ‹æ€§è§£å†³æ–¹æ¡ˆã€‚ Hubble Calico å‚è€ƒ # https://ebpf.io/ "},{"id":65,"href":"/front-end/","title":"Front End","section":"","content":" ğŸ  é¦–é¡µ / å‰ç«¯æŠ€æœ¯\nå‰ç«¯æŠ€æœ¯ # æ­å»ºåšå®¢ç«™ç‚¹\nPinia å…¥é—¨\nVitePress\nè®¤è¯†Vue3\n"},{"id":66,"href":"/front-end/build-blog-site/","title":"Build Blog Site","section":"Front End","content":" ğŸ  é¦–é¡µ / å‰ç«¯æŠ€æœ¯ / æ­å»ºåšå®¢ç«™ç‚¹\næ­å»ºåšå®¢ç«™ç‚¹ # 1. Hugo æ­å»ºåšå®¢ # Hugo æ˜¯ä¸€ä¸ªç”¨ Go è¯­è¨€ç¼–å†™çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ã€‚Hugo çš„é€Ÿåº¦éå¸¸å¿«ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸éœ€è¦ä»»ä½•è¿è¡Œæ—¶ä¾èµ–ã€‚Hugo çš„ä¸»è¦ç‰¹ç‚¹æ˜¯é€Ÿåº¦å¿«ã€æ˜“äºå®‰è£…ã€æ˜“äºä½¿ç”¨ã€æ˜“äºå®šåˆ¶ã€‚\n1.1 å®‰è£… Hugo # å‚è€ƒï¼š https://gohugo.io/installation\n1.2 åˆ›å»ºåšå®¢ # hugo new site blog --format yaml cd blog git init 1.3 é€‰æ‹©ä¸»é¢˜ # ä½¿ç”¨ hugo-book ä¸»é¢˜ã€‚\ngit submodule add https://github.com/alex-shpak/hugo-book themes/hugo-book 2. å®šåˆ¶ # 2.1 é…ç½® hugo.yaml # # hugo server --minify --themesDir ../.. --baseURL=http://0.0.0.0:1313/theme/hugo-book/ baseURL: https://blog.poneding.com/ title: ç§‹æ²³è½å¶ theme: hugo-book pluralizeListTitles: false defaultContentLanguage: cn # Book configuration disablePathToLower: true enableGitInfo: true # Needed for mermaid/katex shortcodes markup: tableOfContents: startLevel: 2 endLevel: 3 # ordered: true highlight: noClasses: false # style: monokai menu: after: - name: \u0026#34;ğŸ”— GitHub\u0026#34; url: \u0026#34;https://github.com/poneding\u0026#34; weight: 10 params: BookTheme: \u0026#34;auto\u0026#34; BookToC: true BookFavicon: logo.png BookLogo: logo.png BookMenuBundle: /menu BookSection: \u0026#34;none\u0026#34; BookRepo: https://github.com/poneding/blog BookCommitPath: commit BookEditPath: edit/master BookDateFormat: \u0026#34;2006/01/02\u0026#34; BookSearch: true BookComments: true BookPortableLinks: true BookServiceWorker: true BookTranslatedOnly: false è¦æ³¨æ„çš„å‡ ä¸ªé…ç½®ç‚¹ï¼š\nparams.BookSection: æœ¬èº«æŒ‡å®šä¸€ä¸ª content ä¸‹çš„æ–‡æ¡£ç›®å½•ï¼Œæˆ‘ä»¬è¿™é‡Œè®¾ç½®ä¸€ä¸ªä¸å­˜åœ¨çš„ç›®å½•ï¼Œæ˜¯ä¸ºäº†ä¸åœ¨å·¦ä¾§èœå•æ å±•ç¤ºæˆ‘ä»¬çš„ N å¤šçš„ç›®å½•æ ‘ï¼› markup.highlight.noClasses: æœ¬èº«ç”¨æ¥ç¡®è®¤æ˜¯å¦ä¸ä½¿ç”¨è‡ªå®šä¹‰çš„ CSS æ ·å¼ï¼Œæˆ‘ä»¬è¿™é‡Œè®¾ç½®ä¸º falseï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çš„ chorma çš„ä»£ç é«˜äº®æ ·å¼ï¼Œè·Ÿéšæµè§ˆå™¨æˆ–ç³»ç»Ÿè‡ªåŠ¨åˆ‡æ¢ä»£ç é«˜äº®ä¸»é¢˜ï¼› 2.2 å®šåˆ¶å·¦ä¾§èœå•æ  # åˆ›å»º content/menu/index.md æ–‡ä»¶ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\nmkdir -p content/menu vim content/menu/index.md èœå•é…ç½®å†…å®¹å¦‚ä¸‹ï¼š\n--- headless: true --- - [**ğŸ  é¦–é¡µ**](/) --- - **ğŸ“Œ ç½®é¡¶** - [Golang ç¼–ç¨‹](/go) - [Kubernetes](/kubernetes) - [Rust ç¼–ç¨‹](/rust) - [Git](/git) --- - **ğŸ”— å¤–é“¾** 2.3 é…ç½® giscus è¯„è®º # æ‹·è´ hugo-book çš„ layouts/_default/baseof.html æ–‡ä»¶åˆ° layouts/_default/baseof.htmlï¼Œå‘½ä»¤æ“ä½œå¦‚ä¸‹ï¼š\nmkdir -p layouts/_default cp themes/hugo-book/layouts/_default/baseof.html layouts/_default/baseof.html é€šè¿‡é…ç½® giscus è·å– js è„šæœ¬ä»£ç ï¼Œå‚è€ƒï¼š https://giscus.app\nè·å–åˆ°çš„ js è„šæœ¬ä»£ç ï¼Œåœ¨ layouts/_default/baseof.html æ–‡ä»¶æ‰¾åˆ° {{- partial \u0026quot;docs/comments\u0026quot; . -}} æ‰€åœ¨è¡Œï¼Œåœ¨å…¶ä¸‹ä¸€è¡Œæ·»åŠ  js è„šæœ¬ä»£ç ï¼Œæœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š\n... \u0026lt;div class=\u0026#34;book-comments\u0026#34;\u0026gt; {{- partial \u0026#34;docs/comments\u0026#34; . -}} \u0026lt;!-- start giscus --\u0026gt; \u0026lt;script src=\u0026#34;https://giscus.app/client.js\u0026#34; data-repo=\u0026#34;poneding/blog\u0026#34; data-repo-id=\u0026#34;R_kgDOMITIHg\u0026#34; data-category=\u0026#34;General\u0026#34; data-category-id=\u0026#34;DIC_kwDOMITIHs4CgB4x\u0026#34; data-mapping=\u0026#34;url\u0026#34; data-strict=\u0026#34;0\u0026#34; data-reactions-enabled=\u0026#34;1\u0026#34; data-emit-metadata=\u0026#34;0\u0026#34; data-input-position=\u0026#34;top\u0026#34; data-theme=\u0026#34;preferred_color_scheme\u0026#34; data-lang=\u0026#34;zh-CN\u0026#34; data-loading=\u0026#34;lazy\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; async\u0026gt; \u0026lt;/script\u0026gt; \u0026lt;!-- end giscus --\u0026gt; \u0026lt;/div\u0026gt; ... 2.4 ä»£ç ä¸»é¢˜è‡ªåŠ¨åˆ‡æ¢ # ç”Ÿæˆä»£ç é«˜äº®æ ·å¼æ–‡ä»¶ï¼Œå‘½ä»¤æ“ä½œå¦‚ä¸‹ï¼š\nmkdir -p static/css # light echo \u0026#34;@media (prefers-color-scheme: light) {\u0026#34; \u0026gt; static/css/syntax.css hugo gen chromastyles --style=monokailight \u0026gt;\u0026gt; static/css/syntax.css echo \u0026#34;}\u0026#34; \u0026gt;\u0026gt; static/css/syntax.css # dark echo \u0026#34;@media (prefers-color-scheme: dark) {\u0026#34; \u0026gt;\u0026gt; static/css/syntax.css hugo gen chromastyles --style=monokai \u0026gt;\u0026gt; static/css/syntax.css echo \u0026#34;}\u0026#34; \u0026gt;\u0026gt; static/css/syntax.css æ‹·è´ hugo-book çš„ layouts/partials/docs/html-head.html æ–‡ä»¶åˆ° layouts/partials/docs/html-head.htmlï¼Œå‘½ä»¤æ“ä½œå¦‚ä¸‹ï¼š\nmkdir -p layouts/partials/docs cp themes/hugo-book/layouts/partials/docs/html-head.html layouts/partials/docs/html-head.html # å¼•å…¥æ ·å¼æ–‡ä»¶ echo \u0026#39;\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;/css/syntax.css\u0026#34;\u0026gt;\u0026#39; \u0026gt;\u0026gt; layouts/partials/docs/html-head.html 2.5 Logo # å°† logo.png å›¾ç‰‡æ”¾åˆ° static ç›®å½•ä¸‹ã€‚\n3. éƒ¨ç½² # 3.1 è‡ªå®šä¹‰åŸŸå # æˆ‘ä»¬å·²ç»åœ¨ hugo.yaml ä¸­é…ç½®äº† baseURL: https://blog.poneding.com/ï¼Œæˆ‘ä»¬è¿˜è¦åˆ›å»ºä¸€ä¸ª CNAME æ–‡ä»¶ï¼Œå†…å®¹ä¸º blog.poneding.comï¼Œç„¶åå°†è¯¥æ–‡ä»¶æ”¾åˆ° static ç›®å½•ä¸‹ã€‚\necho \u0026#34;blog.poneding.com\u0026#34; \u0026gt; static/CNAME 3.2 ä½¿ç”¨ GitHub Actions è‡ªåŠ¨éƒ¨ç½² # å‰æï¼š\nåœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ï¼Œä¾‹å¦‚ï¼šponeding/blogï¼› é…ç½® GitHub ä»“åº“çš„ Settings -\u0026gt; Secretsï¼šGH_TOKENï¼Œå€¼ä¸º GitHub ä¸ªäººè®¿é—®ä»¤ç‰Œï¼› mkdir -p .github/workflows vim .github/workflows/deploy.yml deploy.yml æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nname: Deploy on: push: branches: - master # Set a branch to deploy workflow_dispatch: schedule: # Runs everyday at 8:00 AM - cron: \u0026#34;0 0 * * *\u0026#34; pull_request: jobs: deploy: runs-on: ubuntu-22.04 concurrency: group: ${{ github.workflow }}-${{ github.ref }} steps: - uses: actions/checkout@v4 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v3 with: hugo-version: \u0026#39;0.127.0\u0026#39; # extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 if: github.ref == \u0026#39;refs/heads/master\u0026#39; with: github_token: ${{ secrets.GH_TOKEN }} publish_dir: ./public 3.3 ä»£ç æäº¤è§¦å‘éƒ¨ç½² # git add . git commit -m \u0026#34;init repo\u0026#34; git remote add origin git@github.com:poneding/blog.git git push -u origin master 3.4 GitHub Pages é…ç½® # åœ¨ GitHub ä»“åº“çš„ Settings -\u0026gt; Pages ä¸­é…ç½® Source ä¸º Deploy from a branch, Branch ä¸º gh-pages åˆ†æ”¯ï¼Œroot ä¸º /ã€‚\n4. SEO é…ç½® # å‚è€ƒï¼š\nGoogle ç™¾åº¦ Bing Â» Pinia å…¥é—¨\n"},{"id":67,"href":"/front-end/pinia/","title":"Pinia","section":"Front End","content":" ğŸ  é¦–é¡µ / å‰ç«¯æŠ€æœ¯ / Pinia å…¥é—¨\nPinia å…¥é—¨ # ä»€ä¹ˆæ˜¯pinia # Pinia æ˜¯ Vue çš„ä¸“å±çŠ¶æ€ç®¡ç†åº“ï¼Œå¯ä»¥å®ç°è·¨ç»„ä»¶æˆ–é¡µé¢å…±äº«çŠ¶æ€ï¼Œæ˜¯ vuex çŠ¶æ€ç®¡ç†å·¥å…·çš„æ›¿ä»£å“ï¼Œå’Œ Vuexç›¸æ¯”ï¼Œå…·å¤‡ä»¥ä¸‹ä¼˜åŠ¿\næä¾›æ›´åŠ ç®€å•çš„API ï¼ˆå»æ‰äº† mutation ï¼‰ æä¾›ç¬¦åˆç»„åˆå¼APIé£æ ¼çš„API ï¼ˆå’Œ Vue3 æ–°è¯­æ³•ç»Ÿä¸€ï¼‰ å»æ‰äº†modulesçš„æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªstoreéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å— æ­é… TypeScript ä¸€èµ·ä½¿ç”¨æä¾›å¯é çš„ç±»å‹æ¨æ–­ åˆ›å»ºç©ºVueé¡¹ç›®å¹¶å®‰è£…Pinia # 1. åˆ›å»ºç©ºVueé¡¹ç›® # npm init vue@latest 2. å®‰è£…Piniaå¹¶æ³¨å†Œ # npm i pinia import { createPinia } from \u0026#39;pinia\u0026#39; const app = createApp(App) // ä»¥æ’ä»¶çš„å½¢å¼æ³¨å†Œ app.use(createPinia()) app.use(router) app.mount(\u0026#39;#app\u0026#39;) å®ç°counter # æ ¸å¿ƒæ­¥éª¤ï¼š\nå®šä¹‰store ç»„ä»¶ä½¿ç”¨store 1- å®šä¹‰store\nimport { defineStore } from \u0026#39;pinia\u0026#39; import { ref } from \u0026#39;vue\u0026#39; export const useCounterStore = defineStore(\u0026#39;counter\u0026#39;, ()=\u0026gt;{ // æ•°æ® ï¼ˆstateï¼‰ const count = ref(0) // ä¿®æ”¹æ•°æ®çš„æ–¹æ³• ï¼ˆactionï¼‰ const increment = ()=\u0026gt;{ count.value++ } // ä»¥å¯¹è±¡å½¢å¼è¿”å› return { count, increment } }) 2- ç»„ä»¶ä½¿ç”¨store\n\u0026lt;script setup\u0026gt; // 1. å¯¼å…¥useæ–¹æ³• import { useCounterStore } from \u0026#39;@/stores/counter\u0026#39; // 2. æ‰§è¡Œæ–¹æ³•å¾—åˆ°store storeé‡Œæœ‰æ•°æ®å’Œæ–¹æ³• const counterStore = useCounterStore() \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;button @click=\u0026#34;counterStore.increment\u0026#34;\u0026gt; {{ counterStore.count }} \u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; å®ç°getters # gettersç›´æ¥ä½¿ç”¨è®¡ç®—å±æ€§å³å¯å®ç°\n// æ•°æ®ï¼ˆstateï¼‰ const count = ref(0) // getter (computed) const doubleCount = computed(() =\u0026gt; count.value * 2) å¼‚æ­¥action # æ€æƒ³ï¼šactionå‡½æ•°æ—¢æ”¯æŒåŒæ­¥ä¹Ÿæ”¯æŒå¼‚æ­¥ï¼Œå’Œåœ¨ç»„ä»¶ä¸­å‘é€ç½‘ç»œè¯·æ±‚å†™æ³•ä¿æŒä¸€è‡´ æ­¥éª¤ï¼š\nstoreä¸­å®šä¹‰action ç»„ä»¶ä¸­è§¦å‘action 1- storeä¸­å®šä¹‰action\nconst API_URL = \u0026#39;http://geek.itheima.net/v1_0/channels\u0026#39; export const useCounterStore = defineStore(\u0026#39;counter\u0026#39;, ()=\u0026gt;{ // æ•°æ® const list = ref([]) // å¼‚æ­¥action const loadList = async ()=\u0026gt;{ const res = await axios.get(API_URL) list.value = res.data.data.channels } return { list, loadList } }) 2- ç»„ä»¶ä¸­è°ƒç”¨action\n\u0026lt;script setup\u0026gt; import { useCounterStore } from \u0026#39;@/stores/counter\u0026#39; const counterStore = useCounterStore() // è°ƒç”¨å¼‚æ­¥action counterStore.loadList() \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li v-for=\u0026#34;item in counterStore.list\u0026#34; :key=\u0026#34;item.id\u0026#34;\u0026gt;{{ item.name }}\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/template\u0026gt; storeToRefsä¿æŒå“åº”å¼è§£æ„ # ç›´æ¥åŸºäºstoreè¿›è¡Œè§£æ„èµ‹å€¼ï¼Œå“åº”å¼æ•°æ®ï¼ˆstateå’Œgetterï¼‰ä¼šä¸¢å¤±å“åº”å¼ç‰¹æ€§ï¼Œä½¿ç”¨storeToRefsè¾…åŠ©ä¿æŒå“åº”å¼\n\u0026lt;script setup\u0026gt; import { storeToRefs } from \u0026#39;pinia\u0026#39; import { useCounterStore } from \u0026#39;@/stores/counter\u0026#39; const counterStore = useCounterStore() // ä½¿ç”¨å®ƒstoreToRefsåŒ…è£¹ä¹‹åè§£æ„ä¿æŒå“åº”å¼ const { count } = storeToRefs(counterStore) const { increment } = counterStore \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;button @click=\u0026#34;increment\u0026#34;\u0026gt; {{ count }} \u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; Â« æ­å»ºåšå®¢ç«™ç‚¹\nÂ» VitePress\n"},{"id":68,"href":"/front-end/vitepress/","title":"Vitepress","section":"Front End","content":" ğŸ  é¦–é¡µ / å‰ç«¯æŠ€æœ¯ / VitePress\nVitePress # æ­å»ºé¡¹ç›® # mkdir vitepress-demo npm add -D vitepress npx vitepress init è¿è¡Œ # npm run docs:dev # æˆ–è€…ç›´æ¥è°ƒç”¨ VitePress npx vitepress dev docs æ‰“åŒ… # npm run docs:build GitHub Action # .github/workflows/deploy.yaml\n# æ„å»º VitePress ç«™ç‚¹å¹¶å°†å…¶éƒ¨ç½²åˆ° GitHub Pages çš„ç¤ºä¾‹å·¥ä½œæµç¨‹ # name: Deploy VitePress site to Pages on: # åœ¨é’ˆå¯¹ `main` åˆ†æ”¯çš„æ¨é€ä¸Šè¿è¡Œã€‚å¦‚æœä½  # ä½¿ç”¨ `master` åˆ†æ”¯ä½œä¸ºé»˜è®¤åˆ†æ”¯ï¼Œè¯·å°†å…¶æ›´æ”¹ä¸º `master` push: branches: [master] # å…è®¸ä½ ä» Actions é€‰é¡¹å¡æ‰‹åŠ¨è¿è¡Œæ­¤å·¥ä½œæµç¨‹ workflow_dispatch: # è®¾ç½® GITHUB_TOKEN çš„æƒé™ï¼Œä»¥å…è®¸éƒ¨ç½²åˆ° GitHub Pages permissions: contents: read pages: write id-token: write # åªå…è®¸åŒæ—¶è¿›è¡Œä¸€æ¬¡éƒ¨ç½²ï¼Œè·³è¿‡æ­£åœ¨è¿è¡Œå’Œæœ€æ–°é˜Ÿåˆ—ä¹‹é—´çš„è¿è¡Œé˜Ÿåˆ— # ä½†æ˜¯ï¼Œä¸è¦å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è¿è¡Œï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›å…è®¸è¿™äº›ç”Ÿäº§éƒ¨ç½²å®Œæˆ concurrency: group: pages cancel-in-progress: false jobs: # æ„å»ºå·¥ä½œ build: runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@v4 with: fetch-depth: 0 # å¦‚æœæœªå¯ç”¨ lastUpdatedï¼Œåˆ™ä¸éœ€è¦ # - uses: pnpm/action-setup@v3 # å¦‚æœä½¿ç”¨ pnpmï¼Œè¯·å–æ¶ˆæ³¨é‡Š # - uses: oven-sh/setup-bun@v1 # å¦‚æœä½¿ç”¨ Bunï¼Œè¯·å–æ¶ˆæ³¨é‡Š - name: Setup Node uses: actions/setup-node@v4 with: node-version: 20 cache: npm # æˆ– pnpm / yarn - name: Setup Pages uses: actions/configure-pages@v4 - name: Install dependencies run: npm ci # æˆ– pnpm install / yarn install / bun install - name: Build with VitePress run: npm run docs:build # æˆ– pnpm docs:build / yarn docs:build / bun run docs:build - name: Upload artifact uses: actions/upload-pages-artifact@v3 with: path: .vitepress/dist # éƒ¨ç½²å·¥ä½œ deploy: environment: name: github-pages url: ${{ steps.deployment.outputs.page_url }} needs: build runs-on: ubuntu-latest name: Deploy steps: - name: Deploy to GitHub Pages id: deployment uses: actions/deploy-pages@v4 éœ€è¦è¯¥ GitHub ä»“åº“å¼€å¯ Action å¹¶ä¸”é…ç½® GITHUB_TOKENã€‚\nÂ« Pinia å…¥é—¨\nÂ» è®¤è¯†Vue3\n"},{"id":69,"href":"/front-end/vue3/","title":"Vue3","section":"Front End","content":" ğŸ  é¦–é¡µ / å‰ç«¯æŠ€æœ¯ / è®¤è¯†Vue3\nè®¤è¯†Vue3 # 1. Vue3ç»„åˆå¼APIä½“éªŒ # é€šè¿‡ Counter æ¡ˆä¾‹ ä½“éªŒVue3æ–°å¼•å…¥çš„ç»„åˆå¼API\n\u0026lt;script\u0026gt; export default { data(){ return { count:0 } }, methods:{ addCount(){ this.count++ } } } \u0026lt;/script\u0026gt; \u0026lt;script setup\u0026gt; import { ref } from \u0026#39;vue\u0026#39; const count = ref(0) const addCount = ()=\u0026gt; count.value++ \u0026lt;/script\u0026gt; ç‰¹ç‚¹ï¼š\nä»£ç é‡å˜å°‘ åˆ†æ•£å¼ç»´æŠ¤å˜æˆé›†ä¸­å¼ç»´æŠ¤ 2. Vue3æ›´å¤šçš„ä¼˜åŠ¿ # ä½¿ç”¨create-vueæ­å»ºVue3é¡¹ç›® # 1. è®¤è¯†create-vue # create-vueæ˜¯Vueå®˜æ–¹æ–°çš„è„šæ‰‹æ¶å·¥å…·ï¼Œåº•å±‚åˆ‡æ¢åˆ°äº† vite ï¼ˆä¸‹ä¸€ä»£å‰ç«¯å·¥å…·é“¾ï¼‰ï¼Œä¸ºå¼€å‘æä¾›æé€Ÿå“åº”\n2. ä½¿ç”¨create-vueåˆ›å»ºé¡¹ç›® # å‰ç½®æ¡ä»¶ - å·²å®‰è£…16.0æˆ–æ›´é«˜ç‰ˆæœ¬çš„Node.js\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè¿™ä¸€æŒ‡ä»¤å°†ä¼šå®‰è£…å¹¶æ‰§è¡Œ create-vue\nnpm init vue@latest ç†Ÿæ‚‰é¡¹ç›®å’Œå…³é”®æ–‡ä»¶ # ç»„åˆå¼API - setupé€‰é¡¹ # 1. setupé€‰é¡¹çš„å†™æ³•å’Œæ‰§è¡Œæ—¶æœº # å†™æ³•\n\u0026lt;script\u0026gt; export default { setup(){ }, beforeCreate(){ } } \u0026lt;/script\u0026gt; æ‰§è¡Œæ—¶æœº\nåœ¨beforeCreateé’©å­ä¹‹å‰æ‰§è¡Œ\n2. setupä¸­å†™ä»£ç çš„ç‰¹ç‚¹ # åœ¨setupå‡½æ•°ä¸­å†™çš„æ•°æ®å’Œæ–¹æ³•éœ€è¦åœ¨æœ«å°¾ä»¥å¯¹è±¡çš„æ–¹å¼returnï¼Œæ‰èƒ½ç»™æ¨¡ç‰ˆä½¿ç”¨\n\u0026lt;script\u0026gt; export default { setup(){ const message = \u0026#39;this is message\u0026#39; const logMessage = ()=\u0026gt;{ console.log(message) } // å¿…é¡»returnæ‰å¯ä»¥ return { message, logMessage } } } \u0026lt;/script\u0026gt; 3. \u0026lt;script setup\u0026gt; è¯­æ³•ç³– # scriptæ ‡ç­¾æ·»åŠ  setupæ ‡è®°ï¼Œä¸éœ€è¦å†å†™å¯¼å‡ºè¯­å¥ï¼Œé»˜è®¤ä¼šæ·»åŠ å¯¼å‡ºè¯­å¥\n\u0026lt;script setup\u0026gt; const message = \u0026#39;this is message\u0026#39; const logMessage = ()=\u0026gt;{ console.log(message) } \u0026lt;/script\u0026gt; ç»„åˆå¼API - reactiveå’Œrefå‡½æ•° # 1. reactive # æ¥å—å¯¹è±¡ç±»å‹æ•°æ®çš„å‚æ•°ä¼ å…¥å¹¶è¿”å›ä¸€ä¸ªå“åº”å¼çš„å¯¹è±¡\n\u0026lt;script setup\u0026gt; // å¯¼å…¥ import { reactive } from \u0026#39;vue\u0026#39; // æ‰§è¡Œå‡½æ•° ä¼ å…¥å‚æ•° å˜é‡æ¥æ”¶ const state = reactive({ msg:\u0026#39;this is msg\u0026#39; }) const setSate = ()=\u0026gt;{ // ä¿®æ”¹æ•°æ®æ›´æ–°è§†å›¾ state.msg = \u0026#39;this is new msg\u0026#39; } \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; {{ state.msg }} \u0026lt;button @click=\u0026#34;setState\u0026#34;\u0026gt;change msg\u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; 2. ref # æ¥æ”¶ç®€å•ç±»å‹æˆ–è€…å¯¹è±¡ç±»å‹çš„æ•°æ®ä¼ å…¥å¹¶è¿”å›ä¸€ä¸ªå“åº”å¼çš„å¯¹è±¡\n\u0026lt;script setup\u0026gt; // å¯¼å…¥ import { ref } from \u0026#39;vue\u0026#39; // æ‰§è¡Œå‡½æ•° ä¼ å…¥å‚æ•° å˜é‡æ¥æ”¶ const count = ref(0) const setCount = ()=\u0026gt;{ // ä¿®æ”¹æ•°æ®æ›´æ–°è§†å›¾å¿…é¡»åŠ ä¸Š.value count.value++ } \u0026lt;/script\u0026gt; \u0026lt;template\u0026gt; \u0026lt;button @click=\u0026#34;setCount\u0026#34;\u0026gt;{{count}}\u0026lt;/button\u0026gt; \u0026lt;/template\u0026gt; 3. reactive å¯¹æ¯” ref # éƒ½æ˜¯ç”¨æ¥ç”Ÿæˆå“åº”å¼æ•°æ® ä¸åŒç‚¹ reactiveä¸èƒ½å¤„ç†ç®€å•ç±»å‹çš„æ•°æ® refå‚æ•°ç±»å‹æ”¯æŒæ›´å¥½ï¼Œä½†æ˜¯å¿…é¡»é€šè¿‡.valueåšè®¿é—®ä¿®æ”¹ refå‡½æ•°å†…éƒ¨çš„å®ç°ä¾èµ–äºreactiveå‡½æ•° åœ¨å®é™…å·¥ä½œä¸­çš„æ¨è æ¨èä½¿ç”¨refå‡½æ•°ï¼Œå‡å°‘è®°å¿†è´Ÿæ‹…ï¼Œå°å…”é²œé¡¹ç›®éƒ½ä½¿ç”¨ref ç»„åˆå¼API - computed # è®¡ç®—å±æ€§åŸºæœ¬æ€æƒ³å’ŒVue2ä¿æŒä¸€è‡´ï¼Œç»„åˆå¼APIä¸‹çš„è®¡ç®—å±æ€§åªæ˜¯ä¿®æ”¹äº†APIå†™æ³•\n\u0026lt;script setup\u0026gt; // å¯¼å…¥ import {ref, computed } from \u0026#39;vue\u0026#39; // åŸå§‹æ•°æ® const count = ref(0) // è®¡ç®—å±æ€§ const doubleCount = computed(()=\u0026gt;count.value * 2) // åŸå§‹æ•°æ® const list = ref([1,2,3,4,5,6,7,8]) // è®¡ç®—å±æ€§list const filterList = computed(item=\u0026gt;item \u0026gt; 2) \u0026lt;/script\u0026gt; ç»„åˆå¼API - watch # ä¾¦å¬ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ•°æ®çš„å˜åŒ–ï¼Œæ•°æ®å˜åŒ–æ—¶æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œä¿©ä¸ªé¢å¤–å‚æ•° immediateæ§åˆ¶ç«‹åˆ»æ‰§è¡Œï¼Œdeepå¼€å¯æ·±åº¦ä¾¦å¬\n1. ä¾¦å¬å•ä¸ªæ•°æ® # \u0026lt;script setup\u0026gt; // 1. å¯¼å…¥watch import { ref, watch } from \u0026#39;vue\u0026#39; const count = ref(0) // 2. è°ƒç”¨watch ä¾¦å¬å˜åŒ– watch(count, (newValue, oldValue)=\u0026gt;{ console.log(`countå‘ç”Ÿäº†å˜åŒ–ï¼Œè€å€¼ä¸º${oldValue},æ–°å€¼ä¸º${newValue}`) }) \u0026lt;/script\u0026gt; 2. ä¾¦å¬å¤šä¸ªæ•°æ® # ä¾¦å¬å¤šä¸ªæ•°æ®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ”¹å†™æˆæ•°ç»„çš„å†™æ³•\n\u0026lt;script setup\u0026gt; // 1. å¯¼å…¥watch import { ref, watch } from \u0026#39;vue\u0026#39; const count = ref(0) const name = ref(\u0026#39;cp\u0026#39;) // 2. è°ƒç”¨watch ä¾¦å¬å˜åŒ– watch([count, name], ([newCount, newName],[oldCount,oldName])=\u0026gt;{ console.log(`countæˆ–è€…nameå˜åŒ–äº†ï¼Œ[newCount, newName],[oldCount,oldName]) }) \u0026lt;/script\u0026gt; 3. immediate # åœ¨ä¾¦å¬å™¨åˆ›å»ºæ—¶ç«‹å³å‡ºå‘å›è°ƒï¼Œå“åº”å¼æ•°æ®å˜åŒ–ä¹‹åç»§ç»­æ‰§è¡Œå›è°ƒ\n\u0026lt;script setup\u0026gt; // 1. å¯¼å…¥watch import { ref, watch } from \u0026#39;vue\u0026#39; const count = ref(0) // 2. è°ƒç”¨watch ä¾¦å¬å˜åŒ– watch(count, (newValue, oldValue)=\u0026gt;{ console.log(`countå‘ç”Ÿäº†å˜åŒ–ï¼Œè€å€¼ä¸º${oldValue},æ–°å€¼ä¸º${newValue}`) },{ immediate: true }) \u0026lt;/script\u0026gt; 4. deep # é€šè¿‡watchç›‘å¬çš„refå¯¹è±¡é»˜è®¤æ˜¯æµ…å±‚ä¾¦å¬çš„ï¼Œç›´æ¥ä¿®æ”¹åµŒå¥—çš„å¯¹è±¡å±æ€§ä¸ä¼šè§¦å‘å›è°ƒæ‰§è¡Œï¼Œéœ€è¦å¼€å¯deep\n\u0026lt;script setup\u0026gt; // 1. å¯¼å…¥watch import { ref, watch } from \u0026#39;vue\u0026#39; const state = ref({ count: 0 }) // 2. ç›‘å¬å¯¹è±¡state watch(state, ()=\u0026gt;{ console.log(\u0026#39;æ•°æ®å˜åŒ–äº†\u0026#39;) }) const changeStateByCount = ()=\u0026gt;{ // ç›´æ¥ä¿®æ”¹ä¸ä¼šå¼•å‘å›è°ƒæ‰§è¡Œ state.value.count++ } \u0026lt;/script\u0026gt; \u0026lt;script setup\u0026gt; // 1. å¯¼å…¥watch import { ref, watch } from \u0026#39;vue\u0026#39; const state = ref({ count: 0 }) // 2. ç›‘å¬å¯¹è±¡state å¹¶å¼€å¯deep watch(state, ()=\u0026gt;{ console.log(\u0026#39;æ•°æ®å˜åŒ–äº†\u0026#39;) },{deep:true}) const changeStateByCount = ()=\u0026gt;{ // æ­¤æ—¶ä¿®æ”¹å¯ä»¥è§¦å‘å›è°ƒ state.value.count++ } \u0026lt;/script\u0026gt; ç»„åˆå¼API - ç”Ÿå‘½å‘¨æœŸå‡½æ•° # 1. é€‰é¡¹å¼å¯¹æ¯”ç»„åˆå¼ # 2. ç”Ÿå‘½å‘¨æœŸå‡½æ•°åŸºæœ¬ä½¿ç”¨ # å¯¼å…¥ç”Ÿå‘½å‘¨æœŸå‡½æ•° æ‰§è¡Œç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä¼ å…¥å›è°ƒ \u0026lt;scirpt setup\u0026gt; import { onMounted } from \u0026#39;vue\u0026#39; onMounted(()=\u0026gt;{ // è‡ªå®šä¹‰é€»è¾‘ }) \u0026lt;/script\u0026gt; 3. æ‰§è¡Œå¤šæ¬¡ # ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ‰§è¡Œå¤šæ¬¡çš„æ—¶å€™ï¼Œä¼šæŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œ\n\u0026lt;scirpt setup\u0026gt; import { onMounted } from \u0026#39;vue\u0026#39; onMounted(()=\u0026gt;{ // è‡ªå®šä¹‰é€»è¾‘ }) onMounted(()=\u0026gt;{ // è‡ªå®šä¹‰é€»è¾‘ }) \u0026lt;/script\u0026gt; ç»„åˆå¼API - çˆ¶å­é€šä¿¡ # 1. çˆ¶ä¼ å­ # åŸºæœ¬æ€æƒ³\nçˆ¶ç»„ä»¶ä¸­ç»™å­ç»„ä»¶ç»‘å®šå±æ€§ å­ç»„ä»¶å†…éƒ¨é€šè¿‡propsé€‰é¡¹æ¥æ”¶æ•°æ® 2. å­ä¼ çˆ¶ # åŸºæœ¬æ€æƒ³\nçˆ¶ç»„ä»¶ä¸­ç»™å­ç»„ä»¶æ ‡ç­¾é€šè¿‡@ç»‘å®šäº‹ä»¶ å­ç»„ä»¶å†…éƒ¨é€šè¿‡ emit æ–¹æ³•è§¦å‘äº‹ä»¶ ç»„åˆå¼API - æ¨¡ç‰ˆå¼•ç”¨ # æ¦‚å¿µï¼šé€šè¿‡ refæ ‡è¯† è·å–çœŸå®çš„ domå¯¹è±¡æˆ–è€…ç»„ä»¶å®ä¾‹å¯¹è±¡\n1. åŸºæœ¬ä½¿ç”¨ # å®ç°æ­¥éª¤ï¼š\nè°ƒç”¨refå‡½æ•°ç”Ÿæˆä¸€ä¸ªrefå¯¹è±¡ é€šè¿‡refæ ‡è¯†ç»‘å®šrefå¯¹è±¡åˆ°æ ‡ç­¾ 2. defineExpose # é»˜è®¤æƒ…å†µä¸‹åœ¨ \u0026lt;script setup\u0026gt; è¯­æ³•ç³–ä¸‹ç»„ä»¶å†…éƒ¨çš„å±æ€§å’Œæ–¹æ³•æ˜¯ä¸å¼€æ”¾ç»™çˆ¶ç»„ä»¶è®¿é—®çš„ï¼Œå¯ä»¥é€šè¿‡defineExposeç¼–è¯‘å®æŒ‡å®šå“ªäº›å±æ€§å’Œæ–¹æ³•å®¹è®¸è®¿é—® è¯´æ˜ï¼šæŒ‡å®štestMessageå±æ€§å¯ä»¥è¢«è®¿é—®åˆ°\nç»„åˆå¼API - provideå’Œinject # 1. ä½œç”¨å’Œåœºæ™¯ # é¡¶å±‚ç»„ä»¶å‘ä»»æ„çš„åº•å±‚ç»„ä»¶ä¼ é€’æ•°æ®å’Œæ–¹æ³•ï¼Œå®ç°è·¨å±‚ç»„ä»¶é€šä¿¡\n2. è·¨å±‚ä¼ é€’æ™®é€šæ•°æ® # å®ç°æ­¥éª¤\né¡¶å±‚ç»„ä»¶é€šè¿‡ provide å‡½æ•°æä¾›æ•°æ® åº•å±‚ç»„ä»¶é€šè¿‡ inject å‡½æ•°æä¾›æ•°æ® 3. è·¨å±‚ä¼ é€’å“åº”å¼æ•°æ® # åœ¨è°ƒç”¨provideå‡½æ•°æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸ºrefå¯¹è±¡\n4. è·¨å±‚ä¼ é€’æ–¹æ³• # é¡¶å±‚ç»„ä»¶å¯ä»¥å‘åº•å±‚ç»„ä»¶ä¼ é€’æ–¹æ³•ï¼Œåº•å±‚ç»„ä»¶è°ƒç”¨æ–¹æ³•ä¿®æ”¹é¡¶å±‚ç»„ä»¶çš„æ•°æ®\nç»¼åˆæ¡ˆä¾‹ # 1. é¡¹ç›®åœ°å€ # git clone http://git.itcast.cn/heimaqianduan/vue3-basic-project.git 2. é¡¹ç›®è¯´æ˜ # æ¨¡ç‰ˆå·²ç»é…ç½®å¥½äº†æ¡ˆä¾‹å¿…é¡»çš„å®‰è£…åŒ… æ¡ˆä¾‹ç”¨åˆ°çš„æ¥å£åœ¨ README.MDæ–‡ä»¶ ä¸­ æ¡ˆä¾‹é¡¹ç›®æœ‰ä¿©ä¸ªåˆ†æ”¯ï¼Œmainä¸»åˆ†æ”¯ä¸ºå¼€å‘åˆ†æ”¯ï¼Œcompleteåˆ†æ”¯ä¸ºå®Œæˆç‰ˆåˆ†æ”¯ä¾›å¼€å‘å®Œå‚è€ƒ Â« VitePress\n"},{"id":70,"href":"/git/","title":"Git","section":"","content":" ğŸ  é¦–é¡µ / Git\nGit # Git å¸¸ç”¨\nä½¿ç”¨ git-secret ä¿æŠ¤ä»“åº“æ•æ„Ÿæ•°æ®\nGithub Action ä½¿ç”¨æœ€ä½³å®è·µ\nä½¿ç”¨ GitHub æ‰˜ç®¡ helm-chart ä»“åº“\nGitHub æ‰˜ç®¡ helm-chart ä»“åº“\nGitHub\nGitlab æ·»åŠ  K8s é›†ç¾¤\nGitlab è·¨ç‰ˆæœ¬å‡çº§\nå¤š GitHub è´¦å·ç®¡ç†\næ­å»ºæœ€ç®€å•çš„ git ä»“åº“æœåŠ¡\n"},{"id":71,"href":"/git/common-usage/","title":"Common Usage","section":"Git","content":" ğŸ  é¦–é¡µ / Git / Git å¸¸ç”¨\nGit å¸¸ç”¨ # æœ¬ç¯‡ä¸»è¦ä»‹ç» Git çš„å¸¸ç”¨å‘½ä»¤ï¼ŒåŒ…æ‹¬ Git çš„åŸºæœ¬é…ç½®ã€åˆ›å»ºä»“åº“ã€æ·»åŠ æ–‡ä»¶ã€æäº¤æ–‡ä»¶ã€æŸ¥çœ‹çŠ¶æ€ã€æŸ¥çœ‹æäº¤å†å²ã€æ’¤é”€ä¿®æ”¹ã€åˆ é™¤æ–‡ä»¶ã€åˆ†æ”¯ç®¡ç†ã€è¿œç¨‹ä»“åº“ç­‰ã€‚\nGit åŸºæœ¬é…ç½® # é…ç½® SSH å¯†é’¥ # æäº¤ä»£ç åˆ°è¿œç¨‹ä»“åº“æ—¶ï¼Œéœ€è¦ä½¿ç”¨ SSH å¯†é’¥è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå› æ­¤éœ€è¦å…ˆé…ç½® SSH å¯†é’¥ã€‚\n# ç”Ÿæˆ SSH å¯†é’¥ ssh-keygen -t rsa -C poneding@gmail.com # æŸ¥çœ‹ SSH å¯†é’¥ï¼Œå¤åˆ¶åˆ° GitHub/GitLab ç­‰ SSH Keys ä¸­ cat ~/.ssh/id_rsa.pub æ·»åŠ  .ssh/config æ–‡ä»¶ï¼Œé…ç½® SSH å¯†é’¥çš„åˆ«åï¼Œæ–¹ä¾¿ç®¡ç†å¤šä¸ª SSH å¯†é’¥ã€‚\nvim ~/.ssh/config ä»¥ GitHub ä¸ºä¾‹ï¼Œé…ç½®å¦‚ä¸‹ï¼š\n# GitHub Host github.com HostName github.com IdentityFile ~/.ssh/id_rsa é…ç½®ç”¨æˆ·åå’Œé‚®ç®± # æäº¤ä»£ç æ—¶ï¼Œéœ€è¦é…ç½®ç”¨æˆ·åå’Œé‚®ç®±ã€‚\ngit config --global user.name \u0026#34;poneding\u0026#34; git config --global user.email poneding@gmail.com # åªé…ç½®å½“å‰ä»“åº“çš„ç”¨æˆ·åå’Œé‚®ç®± git config user.name \u0026#34;poneding\u0026#34; git config user.email poneding@gmail.com é…ç½®åˆ«å # é€šè¿‡é…ç½®åˆ«åï¼Œå¯ä»¥ç®€åŒ– Git å‘½ä»¤çš„è¾“å…¥ï¼Œä¾‹å¦‚ï¼Œå°† git status ç®€åŒ–ä¸º git st è·å– Git ä»“åº“çš„çŠ¶æ€ã€‚\ngit config --global alias.st status git config --global alias.ci commit git config --global alias.co checkout git config --global alias.br branch git config --global alias.ck checkout é…ç½®é»˜è®¤åˆ†æ”¯ # æœ€æ–°ç‰ˆæœ¬çš„ Git é»˜è®¤åˆ†æ”¯ä¸º mainï¼Œå¦‚æœéœ€è¦ä¿®æ”¹ä¸º masterï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œä¿®æ”¹ã€‚\ngit config --global init.defaultBranch master é…ç½® rabase # å½“ä½ è¿è¡Œ git pull æ—¶ï¼ŒGit ä¼šä»è¿œç¨‹ä»“åº“æ‹‰å–æœ€æ–°çš„æ›´æ”¹å¹¶å°†å®ƒä»¬åˆå¹¶åˆ°ä½ çš„æœ¬åœ°åˆ†æ”¯ã€‚å¦‚æœè®¾ç½®äº† pull.rebase ä¸º trueï¼ŒGit ä¼šåœ¨æ‹‰å–è¿œç¨‹æ›´æ”¹åï¼Œä¸ä½¿ç”¨æ™®é€šçš„ merge æ“ä½œï¼Œè€Œæ˜¯ä½¿ç”¨ rebase å°†ä½ æœ¬åœ°çš„æäº¤æ”¾åœ¨è¿œç¨‹æ›´æ”¹çš„åé¢ã€‚è¿™æ ·å¯ä»¥æœ‰æ•ˆé¿å…åˆ†æ”¯åˆå¹¶æ—¶äº§ç”Ÿå¤§é‡çš„æ— ç”¨çš„ merge commitï¼Œæœ‰åŠ©äºä¿æŒä¸€ä¸ªæ›´çº¿æ€§ã€æ•´æ´çš„æäº¤å†å²ã€‚\ngit config --global pull.rebase true Git ä»“åº“ # åˆå§‹åŒ–ä»“åº“ # # åœ¨å½“å‰ç›®å½•åˆå§‹åŒ–ä»“åº“ git init # åˆå§‹åŒ–å¹¶æŒ‡å®šåˆå§‹åŒ–åˆ†æ”¯ git init -b dev # åœ¨æŒ‡å®šç›®å½•åˆ›å»ºä»“åº“ git init mydir å…‹éš†è¿œç¨‹ä»“åº“ # # SSH æ–¹å¼ git clone git@github.com/poneding/archives.git # HTTPS æ–¹å¼ git clone https://github.com/kubernetes/kubernetes.git æäº¤æœ¬åœ°æ›´æ”¹åˆ°è¿œç¨‹ä»“åº“ # # æ‹‰å–è¿œç¨‹ä»“åº“çš„æœ€æ–°æ›´æ”¹ git pull # æ·»åŠ æ‰€æœ‰æ›´æ”¹åˆ°æš‚å­˜åŒº git add . # æäº¤æ›´æ”¹ git commit -m \u0026#34;this commit\u0026#34; # æ¨é€åˆ°è¿œç¨‹ä»“åº“ git push # é¦–æ¬¡æ¨é€åˆ°è¿œç¨‹ä»“åº“ git push -u origin master # æ¨é€æ‰€æœ‰æœ¬åœ°åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“ git push --all # æ¨é€æ‰€æœ‰æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“ git push --tags æ·»åŠ è¿œç¨‹ä»“åº“ # # æŸ¥çœ‹è¿œç¨‹ä»“åº“ git remote -v # æ·»åŠ è¿œç¨‹ä»“åº“ git remote add origin git@github.com/poneding/archives.git # ä¿®æ”¹è¿œç¨‹ä»“åº“åœ°å€ git remote set-url origin git@github.com/poneding/archives-new.git # åˆ é™¤è¿œç¨‹ä»“åº“ git remote rm origin æš‚å­˜æ›´æ”¹ # æ·»åŠ æ–‡ä»¶ # # å°†æ›´æ”¹æ·»åŠ åˆ°æš‚å­˜åŒº git stash # æŸ¥çœ‹æš‚å­˜åŒºçš„æ›´æ”¹ git stash list # å–å‡ºæš‚å­˜åŒºçš„æ›´æ”¹ git stash pop æäº¤ä¿®æ­£ # å¤šæ¬¡æäº¤çš„å†…å®¹å…¶å®å¯ä»¥åˆå¹¶æˆä¸€æ¬¡æäº¤ï¼Œè¿™æ ·å¯ä»¥ä¿æŒæäº¤å†å²çš„æ•´æ´ã€‚ æƒ³è¦ä¿®æ”¹æäº¤çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æäº¤ä¿¡æ¯æè¿°ä¸å‡†ç¡®ã€æ‹¼å†™é”™è¯¯ç­‰ã€‚ # ä¿®æ”¹æœ€è¿‘ä¸€æ¬¡æäº¤çš„ä¿¡æ¯ git commit --amend -m \u0026#34;new commit message\u0026#34; æäº¤è§„èŒƒ # è§„èŒƒåŒ–çš„ commit æäº¤æœ‰ä¸€äº›çº¦å®šä¿—ç§°çš„æ ¼å¼ï¼Œä¸‹é¢å¿«é€Ÿæšä¸¾ä¸€äº›å¸¸è§æ ¼å¼ï¼š\n# åŠŸèƒ½ç±» git commit -m \u0026#34;feat: xxx\u0026#34; # ä¿®å¤ç±» git commit -m \u0026#34;fix: xxx\u0026#34; # æ‚äº‹ git commit -m \u0026#34;chore: xxx\u0026#34; æ’¤é”€æ›´æ”¹ # è¿˜æœª git add # è¿™é‡Œå…¶å®æ¶‰åŠåˆ°äº†ä¸¤ç§æ›´æ”¹ï¼š\næ–‡ä»¶æ–°å¢ï¼šä½¿ç”¨ git clean -f æ’¤é”€æ›´æ”¹ æ–‡ä»¶ä¿®æ”¹/åˆ é™¤ï¼šä½¿ç”¨ git restore .ï¼ˆæ–°ç‰ˆï¼Œæ¨èï¼‰æˆ– git checkout .ï¼ˆæ—§ç‰ˆï¼‰ æ’¤é”€æ›´æ”¹ git clean -f \u0026amp;\u0026amp; git restore . å·²ç» git addï¼Œè¿˜æœª git commit # # å–æ¶ˆæ‰€æœ‰æš‚å­˜çš„æ›´æ”¹ git reset git reset . git reset HEAD . # æ’¤é”€å•ä¸ªæ–‡ä»¶çš„æš‚å­˜æ›´æ”¹ git reset HEAD README.md å·²ç» git commit # # è·å–æœ€è¿‘ä¸€æ¬¡æäº¤çš„ commit_id git log # æ’¤é”€æœ€è¿‘ä¸€æ¬¡æäº¤ git reset [commit_id] Git åˆ†æ”¯ # æŸ¥çœ‹åˆ†æ”¯ # # æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯ git branch # æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ git branch -r # æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ git branch -a åˆ›å»ºåˆ†æ”¯ # # åˆ›å»ºæ–°åˆ†æ”¯ git branch dev # åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ git checkout -b dev # åˆ›å»ºå­¤ç«‹åˆ†æ”¯ï¼Œæ–°åˆ†æ”¯æ²¡æœ‰ä»»ä½•æäº¤å†å²ï¼Œä½†ä¼šä¿ç•™ä¹‹å‰åˆ†æ”¯çš„æ‰€æœ‰æ–‡ä»¶ git checkout --orphan dev åŒæ­¥è¿œç¨‹åˆ†æ”¯ # è¿œç¨‹åˆ†æ”¯åˆ†ä¸¤ç§ï¼š\næœ¬åœ°è¿œç¨‹åˆ†æ”¯ï¼Œå¯ä»¥é€šè¿‡ git branch -r æŸ¥çœ‹åˆ°ï¼› è¿œç¨‹ä»“åº“åˆ†æ”¯ï¼Œå¯èƒ½æ˜¯å…¶ä»–äººåˆ›å»ºçš„ï¼Œå¯ä»¥é€šè¿‡ git fetch åŒæ­¥åˆ°æœ¬åœ°è¿œç¨‹åˆ†æ”¯ã€‚ # è¿œç¨‹ä»“åº“æœ‰äº†æ–°çš„åˆ†æ”¯ï¼Œå°†è¿œç¨‹åˆ†æ”¯åŒæ­¥åˆ°æœ¬åœ° git fetch # å°†è¿œç¨‹åˆ†æ”¯åŒæ­¥åˆ°æœ¬åœ° git checkout -b dev origin/dev åˆå¹¶åˆ†æ”¯ # # å°†å½“å‰åˆ†æ”¯ dev çš„æ›´æ”¹åˆå¹¶åˆ° master åˆ†æ”¯ git checkout master git merge dev git push åˆ é™¤åˆ†æ”¯ # # åˆ é™¤æœ¬åœ°åˆ†æ”¯ git branch -d dev # åˆ é™¤è¿œç¨‹åˆ†æ”¯ git push origin -d dev åœºæ™¯ï¼šè¿œç¨‹ä»“åº“å·²ç»åˆ é™¤äº†åˆ†æ”¯ï¼Œæœ¬åœ°ä»“åº“è¿˜å­˜åœ¨è¯¥åˆ†æ”¯ï¼Œéœ€è¦åˆ é™¤æœ¬åœ°åˆ†æ”¯ã€‚\n# 1. æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯çš„å¯¹åº”å…³ç³»: git remote show origin # 2. åˆ é™¤è¿œç¨‹å·²ç»åˆ é™¤è¿‡çš„åˆ†æ”¯: git remote prune origin Git æ ‡ç­¾ # æŸ¥çœ‹æ ‡ç­¾ # git tag åˆ›å»ºæ ‡ç­¾ # # åˆ›å»ºæ ‡ç­¾ï¼ˆè½»é‡æ ‡ç­¾ï¼Œåªæ˜¯æŸä¸ªæäº¤çš„å¼•ç”¨ï¼‰ git tag v1.0.0 # åˆ›å»ºæ ‡ç­¾ï¼ˆé™„æ³¨æ ‡ç­¾ï¼‰ git tag -a v1.0.0 -m \u0026#34;release v1.0.0\u0026#34; # æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“ git push origin v1.0.0 åˆ é™¤æ ‡ç­¾ # # åˆ é™¤æœ¬åœ°æ ‡ç­¾ git tag -d v1.0.0 # åˆ é™¤è¿œç¨‹æ ‡ç­¾ git push origin :refs/tags/v1.0.0 # æœ¬åœ°æ‰¹é‡åˆ é™¤æ ‡ç­¾ git tag | xargs git tag -d # æœ¬åœ°åˆ é™¤ v1.1.0 å¼€å¤´çš„æ ‡ç­¾ git tag | grep \u0026#34;v1.1.0.\\d$\u0026#34; | xargs git tag -d # æ‰¹é‡åˆ é™¤è¿œç¨‹æ ‡ç­¾ git show-ref --tag | awk \u0026#39;/(.*)(\\s+)(.*)$/ {print \u0026#34;:\u0026#34; $2}\u0026#39; | xargs git push origin Git Remote # æŸ¥çœ‹è¿œç¨‹ä¿¡æ¯ # git remote -v git remote show æ–°å¢è¿œç¨‹ # git remote add origin git@github.com:poneding/demo.git æ›´æ–°è¿œç¨‹åœ°å€ # git remote set-url origin git@github.com:poneding/demo.git åˆ é™¤è¿œç¨‹ # git remote remove origin å¤šè¿œç¨‹ # git remote add origin git@github.com:poneding/demo.git git remote add origin2 git@gitlab.com:poneding/demo.git git push origin master git push origin2 master # æ‰€æœ‰åˆ†æ”¯ã€tag ç­‰ # git push --all origin # æ‰€æœ‰åˆ†æ”¯ git push --mirror origin # git push --all origin2 # æ‰€æœ‰åˆ†æ”¯ git push --mirror origin2 æ³¨æ„ï¼Œåç»­æäº¤åˆ°è¿œç¨‹æ—¶ï¼š\n# é»˜è®¤æäº¤åˆ° origin è¿œç¨‹ git push # æäº¤åˆ° origin2 è¿œç¨‹ git pull origin2 master git push origin2 master Git ä¿¡æ¯ # æäº¤å“ˆå¸Œå€¼ # # å®Œæ•´çš„æäº¤å“ˆå¸Œå€¼ git rev-parse HEAD # ç®€çŸ­çš„æäº¤å“ˆå¸Œå€¼ (7 ä½) git rev-parse --short HEAD åˆ é™¤è¿œç¨‹ä»“åº“æäº¤å†å² # rm -rf .git git init git add . git commit -m \u0026#34;first commit\u0026#34; git remote add origin git@github.com/poneding/archives.git # å¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œè¦†ç›–è¿œç¨‹ä»“åº“çš„æäº¤å†å² git push -u --force origin master æ’é”™ # Q1ï¼šPermissions 0664 for \u0026lsquo;~/.ssh/id_rsa\u0026rsquo; are too open # ssh ç§é’¥æ–‡ä»¶æƒé™è¿‡é«˜ï¼Œéœ€è¦ä¿®æ”¹ä¸º 600ã€‚\nchmod 600 ~/.ssh/id_rsa Q1ï¼šè¯ä¹¦é¢å‘è€…æœªè¢«è¯†åˆ« # é—®é¢˜æè¿°ï¼šPeerâ€™s Certificate issuer is not recognized.\nè§£å†³æ–¹æ³•ï¼š\n# ä»“åº“çº§åˆ«ï¼Œåœ¨ä»“åº“ç›®å½•ä¸‹æ‰§è¡Œ git config http.\u0026#34;sslVerify\u0026#34; false # å…¨å±€çº§åˆ« git config --global http.\u0026#34;sslVerify\u0026#34; false Â» ä½¿ç”¨ git-secret ä¿æŠ¤ä»“åº“æ•æ„Ÿæ•°æ®\n"},{"id":72,"href":"/git/git-secret/","title":"Git Secret","section":"Git","content":" ğŸ  é¦–é¡µ / Git / ä½¿ç”¨ git-secret ä¿æŠ¤ä»“åº“æ•æ„Ÿæ•°æ®\nä½¿ç”¨ git-secret ä¿æŠ¤ä»“åº“æ•æ„Ÿæ•°æ® # å¦‚ä½•ä¿æŠ¤ git ä»“åº“ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œè´¦å·å¯†ç ç­‰ï¼Ÿ\né¦–å…ˆï¼Œæœ€å¥½å…ˆå°†ä»“åº“è®¾ç½®æˆç§æœ‰ä»“åº“ï¼ç„¶åï¼Œ\nç¬¬ä¸€ç§æ–¹å¼ï¼šå¸¦æœ‰æ•æ„Ÿæ•°æ®çš„æ–‡ä»¶åŠ å…¥åˆ°. gitignoreï¼Œä¸æäº¤åˆ°ä»“åº“ä¸­ï¼› ç¬¬äºŒç§æ–¹å¼ï¼šæ•æ„Ÿæ•°æ®åº“æ–‡ä»¶åŠ å¯†åå†æäº¤åˆ°ä»“åº“ä¸­ï¼Œè¿™ä¸ªå°±æ˜¯ä»Šå¤©è¦è¯´çš„ git-secretã€‚ è¿™ä¸¤ç§æ–¹å¼éƒ½æœ‰ä¼˜ç¼ºç‚¹ï¼š\nç¬¬ä¸€ç§æ–¹å¼ï¼Œè¾ƒä¸ºé è°±ï¼Œæ•æ„Ÿæ–‡ä»¶åœ¨ git ä»“åº“ä¹‹å¤–ï¼Œæ ¹æœ¬ä¸Šé¿å…ä»“åº“æ•æ„Ÿæ•°æ®çš„æ³„éœ²ï¼Œä½†æ˜¯æ•æ„Ÿæ–‡ä»¶ä¸å—ç‰ˆæœ¬æ§åˆ¶äº†ï¼Œå¼€å‘äººå‘˜éœ€è¦åœ¨å…¶ä»–é¢‘é“åŒæ­¥æ•æ„Ÿæ–‡ä»¶çš„æ›´æ–°ï¼Œè€Œä¸”ä½¿ç”¨åˆ°è‡ªåŠ¨éƒ¨ç½²æ—¶éœ€è¦å¦å¤–å»æ‹‰å–æ•æ„Ÿæ•°æ®ï¼Œæœ€å¥½æ˜¯æœ‰è‡ªå·±çš„æ•æ„Ÿæ•°æ®é…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ç†ï¼›\nç¬¬äºŒç§æ–¹å¼ï¼Œä½¿ç”¨ git-secret åŠ å¯†æ•æ„Ÿæ–‡ä»¶ï¼Œè¿™æ ·æ•æ„Ÿæ–‡ä»¶è¢«ä»“åº“ ignore æ‰ï¼Œè½¬è€Œæäº¤åŠ å¯†åçš„æ–‡ä»¶ï¼Œä½†æ˜¯æ•æ„Ÿæ–‡ä»¶å¦‚æœæ›´æ–°äº†å¼€å‘äººå‘˜è¦è®°å¾—å†æ¬¡åŠ å¯†ã€‚\ngit-secret ç®€ä»‹ # git-secret æ˜¯ä¸€ä¸ªåœ¨ git ä»“åº“ä¸­åŠ å¯†æ–‡ä»¶çš„å·¥å…·ï¼Œå°†æ•æ„Ÿæ–‡ä»¶åŠ å¯†ï¼Œå¾—åˆ°åŠ å¯†æ–‡ä»¶ï¼Œå°†æ–‡ä»¶ä¿å­˜åˆ°ä»“åº“ä¸­ï¼Œè¿™æ ·æ•æ„Ÿæ–‡ä»¶ä¹Ÿæ˜¯ç‰ˆæœ¬æ§åˆ¶ï¼Œä½ å¯ä»¥è·å–åˆ°è¯¥æ–‡ä»¶çš„æ‰€æœ‰æäº¤è®°å½•ã€‚\nä½¿ç”¨ gpg å’Œæ‰€æœ‰ä¿¡ä»»ç”¨æˆ·çš„å…¬é’¥åŠ å¯†æ–‡ä»¶ï¼Œæ¯ä¸ªä¿¡ä»»ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸ªäººå¯†é’¥è§£å¯†æ–‡ä»¶ï¼Œå¦‚æœç”¨æˆ·ç¦»å¼€å›¢é˜Ÿï¼Œå°†åˆ é™¤ç”¨æˆ·çš„å…¬é’¥å³å¯ï¼Œä»–ä¹Ÿå°±ä¸èƒ½å†è§£å¯†æ–‡ä»¶äº†ã€‚\ngit-secret ä½¿ç”¨ # å‡è®¾æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªä»“åº“ git-secret-demoï¼Œä»“åº“ä¸‹æœ‰ä¸€ä¸ªåŒ…å«æ•æ„Ÿä¿¡æ¯çš„æ–‡ä»¶ secret.jsonï¼š\næˆ‘ç°åœ¨æƒ³åšçš„æ˜¯ä½¿ç”¨ git-secret å°† secret.json æ–‡ä»¶åŠ å¯†ã€‚\né¦–å…ˆå¾—å®‰è£… gpg å·¥å…· # Debian \u0026amp; Ubuntu sudo apt install gnupg -y â€‹ # Macos brew install gnupg æœ¬åœ°åˆ›å»º gpg RSA å¯†é’¥å¯¹ gpg --gen-key åœ¨åˆ›å»ºæ—¶éœ€è¦è¾“å…¥è‡ªå·±çš„ç”¨æˆ·åå’Œé‚®ç®±ï¼Œå¹¶ä¸”éœ€è¦è¾“å…¥ä½ çš„åŠ å¯†å¯†ç ã€‚\nå¯¼å‡ºä½ çš„å…¬é’¥æ–‡ä»¶ï¼Œä½ å¯ä»¥æ‹¿åˆ°è¿™ä¸ªå…¬é’¥æ–‡ä»¶äº¤ç»™ git ä»“åº“ç®¡ç†å‘˜ï¼Œè®©ä»–æŠŠä½ åŠ å…¥åˆ°ä»“åº“çš„ä¿¡ä»»ç”¨æˆ·åˆ—è¡¨ï¼š\ngpg --armor --export ding.peng@email.cn \u0026gt; dp-public-key.gpg å¯¼å…¥å…¬é’¥æ–‡ä»¶ï¼Œgit ä»“åº“ç®¡ç†å‘˜å°†å…¬é’¥æ–‡ä»¶å¯¼å…¥æœ¬åœ°ç¯å¢ƒï¼Œä¹‹åå¯ä»¥å°†æœ¬åœ°ç¯å¢ƒä¸­çš„å…¬é’¥åŠ å…¥åˆ° git-secret ä¿¡ä»»ç”¨æˆ·åˆ—è¡¨ï¼š\ngpg --import other-pulic-key.gpg æŸ¥çœ‹æœ¬åœ°å¯†é’¥å¯¹åˆ—è¡¨\ngpg --list-key å®‰è£… git-secret # Debian \u0026amp; Ubuntu sudo apt install git-secret -y â€‹ # Macos brew install git-secret ä½¿ç”¨ git secret init åˆå§‹åŒ–ï¼Œåœ¨ä»“åº“æ ¹ç›®å½•ä¸‹æ‰§è¡Œ git secret init é»˜è®¤ä¼šåœ¨ä»“åº“ä¸‹ç”Ÿæˆ .gitsecret ç›®å½•å’Œ .gitignore æ–‡ä»¶ã€‚\nå°†ç”¨æˆ·åŠ å…¥åˆ° git-secret ä¿¡ä»»ç”¨æˆ·åˆ—è¡¨ git secret tell ding.peng@email.cn æ·»åŠ åŠ å¯†æ–‡ä»¶åˆ° git-secret git secret add -i secret.json è¿™é‡Œ -i è‡ªåŠ¨å°†è¦åŠ å¯†çš„æ–‡ä»¶æ·»åŠ åˆ° .gitignore\næ­¤æ—¶ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥åœ¨ç›®å½•ä¸‹çœ‹åˆ°ç”Ÿæˆçš„ secret.json.secret çš„åŠ å¯†åæ–‡ä»¶\ngit secret hide åˆ°è¿™æ—¶ï¼Œä½ çš„åŠ å¯†æ–‡ä»¶ä¸ä¼šæäº¤åˆ°ä»“åº“ä¸­ï¼Œä» git ä»“åº“æ–°å…‹éš†ä¸‹æ¥çš„æ—¶å€™æ˜¯æ²¡æœ‰åŠ å¯†æ–‡ä»¶çš„ï¼Œä½ éœ€è¦è§£å¯†æ–‡ä»¶æ‰èƒ½å¾—åˆ°æ–‡ä»¶ï¼Œä¾‹å¦‚æˆ‘ç°åœ¨åˆ é™¤åŠ å¯†æ–‡ä»¶ï¼Œç„¶åå†é€šè¿‡è§£å¯†åŠ å¯†è¿‡çš„æ–‡ä»¶é‡æ–°å¾—åˆ°æ•æ„Ÿæ–‡ä»¶ï¼Œä½¿ç”¨å‘½ä»¤:\ngit secret reveal # ç¬¬ä¸€æ¬¡ä½¿ç”¨è¯¥å‘½ä»¤éœ€è¦è¾“å…¥ä¿¡ä»»ç”¨æˆ·çš„å¯†ç  ä»ä»¥ä¸Šæˆªå›¾ï¼Œä½ å¯ä»¥çœ‹åˆ°æ•æ„Ÿæ–‡ä»¶ secret.json å¤±è€Œå¤å¾—çš„æ•´ä¸ªè¿‡ç¨‹ã€‚\ngit-secret å¸¸ç”¨å‘½ä»¤ # é™¤äº†ä¸Šé¢ä½¿ç”¨è¿‡çš„å‘½ä»¤ï¼Œä½ å¯èƒ½è¿˜ä¼šç”¨åˆ°ä»¥ä¸‹å‘½ä»¤ï¼š\n**git secret usageï¼š**åˆ—å‡º git secret å¯ç”¨å‘½ä»¤ã€‚ **git secret whoknowsï¼š**æŸ¥çœ‹å½“å‰ git ä»“åº“å…è®¸è®¿é—®ç§å¯†æ–‡ä»¶çš„ç”¨æˆ·é‚®ç®±åˆ—è¡¨ã€‚ git secret addï¼šæ·»åŠ åŠ å¯†æ–‡ä»¶ã€‚ **git secret removeï¼š**ç§»é™¤åŠ å¯†æ–‡ä»¶ã€‚ **git secret listï¼š**åˆ—å‡ºåŠ å¯†æ–‡ä»¶ã€‚ **git secret changesï¼š**æŸ¥çœ‹åŠ å¯†æ–‡ä»¶çš„æ›´æ”¹è®°å½•ã€‚ **git secret cleanï¼š**æ¸…é™¤æ‰€æœ‰åŠ å¯†æ–‡ä»¶ã€‚ **git secret removepersonï¼š**ç§»é™¤ä¿¡ä»»ç”¨æˆ·ã€‚ Â« Git å¸¸ç”¨\nÂ» Github Action ä½¿ç”¨æœ€ä½³å®è·µ\n"},{"id":73,"href":"/git/github-action-best-practice/","title":"Github Action Best Practice","section":"Git","content":" ğŸ  é¦–é¡µ / Git / Github Action ä½¿ç”¨æœ€ä½³å®è·µ\nGithub Action ä½¿ç”¨æœ€ä½³å®è·µ # Commit æ„å»º beta ç‰ˆæœ¬é•œåƒ # ä»“åº“æ ¹ç›®å½•ä¸‹åˆ›å»º .github/workflows/commit-cicd.yml æ–‡ä»¶ï¼Œç”¨äºæäº¤ä»£ç è§¦å‘ github actionã€‚\nbeta ç‰ˆæœ¬çš„é•œåƒ tag å‘½åè§„åˆ™ï¼š{vx.x.x}-beta-{COMMIT_ID}ï¼Œä¾‹å¦‚ï¼šv1.0.0-beta-f37cfa2\nname: commit-cicd â€‹ env: BASE_VERSION: v1.0.0 â€‹ on: push: branches: [main] workflow_dispatch: â€‹ jobs: build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 â€‹ - name: Set ENV run: | echo \u0026#34;VERSION=${BASE_VERSION}-beta-${GITHUB_SHA::7}\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV â€‹ - name: Set up QEMU uses: docker/setup-qemu-action@v2 - name: Set up Docker Buildx uses: docker/setup-buildx-action@v2 â€‹ - name: Login to docker hub uses: docker/login-action@v2 with: username: poneding password: ${{ secrets.DOCKER_PASSWORD }} â€‹ - name: Build and push id: docker_build uses: docker/build-push-action@v3 with: platforms: linux/amd64,linux/arm64 file: Dockerfile.multiarch push: true tags: poneding/demo:${VERSION} - name: Image digest run: echo ${{ steps.docker_build.outputs.digest }} â€‹ - name: Deploy demo id: deploy uses: actions-hub/kubectl@master env: KUBE_CONFIG: ${{ secrets.KUBE_CONFIG }} with: args: set image deployment/demo demo=poneding/demo:${VERSION} Release æ„å»º stable ç‰ˆæœ¬é•œåƒ # ä»“åº“æ ¹ç›®å½•ä¸‹åˆ›å»º .github/workflows/release-cicd.ymlæ–‡ä»¶ï¼Œç”¨äº Release å‘å¸ƒè§¦å‘ github actionã€‚\nstable ç‰ˆæœ¬é•œåƒ tag å‘½åè§„åˆ™ï¼švx.x.x-stableï¼Œä¾‹å¦‚ï¼šv1.0.0-stable\nname: release-cicd â€‹ on: release: types: [created] â€‹ jobs: build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 â€‹ - name: Set ENV run: | echo \u0026#34;VERSION=${GITHUB_REF#refs/*/}\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV â€‹ - name: Set up QEMU uses: docker/setup-qemu-action@v2 - name: Set up Docker Buildx uses: docker/setup-buildx-action@v2 - name: Login to docker hub uses: docker/login-action@v2 with: username: poneding password: ${{ secrets.DOCKER_PASSWORD }} â€‹ - name: Build and push id: docker_build uses: docker/build-push-action@v3 env: VERSION: ${GITHUB_REF#refs/*/} with: platforms: linux/amd64,linux/arm64 file: Dockerfile.multiarch push: true tags: poneding/demo:latest,poneding/demo:${VERSION} - name: Image digest run: echo ${{ steps.docker_build.outputs.digest }} â€‹ - name: Deploy demo id: deploy uses: actions-hub/kubectl@master env: KUBE_CONFIG: ${{ secrets.KUBE_CONFIG }} with: args: set image deployment/demo demo=poneding/demo:${VERSION} é•œåƒ tag ç‰ˆæœ¬å·æ¥è‡ªäº git ä¸­åˆ›å»ºçš„ tagï¼Œæ‰€ä»¥å¦‚æœè¦å‘å¸ƒç¨³å®šç‰ˆæœ¬ï¼Œéœ€è¦æ‰“ä¸€ä¸ªå‘½åä¸º vx.x.x-stable çš„ tagï¼Œç„¶å Release æ—¶ï¼Œé€‰æ‹©è¯¥ tag å³å¯ã€‚\nÂ« ä½¿ç”¨ git-secret ä¿æŠ¤ä»“åº“æ•æ„Ÿæ•°æ®\nÂ» ä½¿ç”¨ GitHub æ‰˜ç®¡ helm-chart ä»“åº“\n"},{"id":74,"href":"/git/github-host-helm-chart/","title":"Github Host Helm Chart","section":"Git","content":" ğŸ  é¦–é¡µ / Git / ä½¿ç”¨ GitHub æ‰˜ç®¡ helm-chart ä»“åº“\nä½¿ç”¨ GitHub æ‰˜ç®¡ helm-chart ä»“åº“ # helm å®˜æ–¹æ–‡æ¡£ï¼š\nHelm | Chart Releaser Action to Automate GitHub Page Charts åˆ›å»º GitHub ä»“åº“ï¼Œä¾‹å¦‚ï¼šhelm-chartsï¼Œå…‹éš†åˆ°æœ¬åœ°ã€‚ git clone git@github.com:[gh_id]/helm-charts.git cd helm-charts åˆ›å»ºå¹²å‡€çš„ gh-pages åˆ†æ”¯ã€‚ git checkout --orphan gh-pages git rm -rf . vim README.md # helm-charts ## Usage [Helm](https://helm.sh) must be installed to use the charts. Please refer to Helm\u0026#39;s [documentation](https://helm.sh/docs) to get started. Once Helm has been set up correctly, add the repo as follows: ```bash helm repo add mycharts https://[gh_id].github.io/helm-charts ``` If you had already added this repo earlier, run `helm repo update` to retrieve the latest versions of the packages. You can then run`helm search repo mycharts` to see the charts. To install the mycharts chart: ```bash helm install myapp mycharts/myapp ``` To uninstall the chart: ```bash helm uninstall myapp ``` git add . git commit -am \u0026#34;add README.md\u0026#34; git push -u origin gh-pages ä»“åº“å¯ç”¨ GitHub Pages åŠŸèƒ½ï¼Œé€‰æ‹© gh-pages åˆ†æ”¯ã€‚\ncharts å¼€å‘ã€‚\ngit checkout master mkdir charts cd charts helm create myapp cd .. ä½¿ç”¨ GitHub Action æ­é… chart-releaser åŠŸèƒ½ï¼Œä¸ºæˆ‘ä»¬è‡ªåŠ¨å‘å¸ƒ charts ç‰ˆæœ¬ã€‚ mkdir -p .github/workflows vim .github/workflows/release-chart.yaml name: Release Charts on: push: branches: - main jobs: release: # depending on default permission settings for your org (contents being read-only or read-write for workloads), you will have to add permissions # see: https://docs.github.com/en/actions/security-guides/automatic-token-authentication#modifying-the-permissions-for-the-github_token permissions: contents: write runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@v3 with: fetch-depth: 0 - name: Configure Git run: | git config user.name \u0026#34;$GITHUB_ACTOR\u0026#34; git config user.email \u0026#34;$GITHUB_ACTOR@users.noreply.github.com\u0026#34; - name: Install Helm uses: azure/setup-helm@v3 - name: Run chart-releaser uses: helm/chart-releaser-action@v1.5.0 env: CR_TOKEN: \u0026#34;${{ secrets.GITHUB_TOKEN }}\u0026#34; éœ€è¦æå‰å°† GitHub Token ç”Ÿæˆå‡ºæ¥ï¼Œå¹¶é…ç½®åˆ°ä»“åº“çš„ Secrets ä¸­ã€‚\næäº¤ä»£ç å³å¯ç¬¬ä¸€æ¬¡å‘ç‰ˆã€‚\nä¹‹åå¯¹ charts æ”¹åŠ¨åï¼Œä¿®æ”¹ Chart.yaml ä¸­çš„ version å­—æ®µï¼Œhelm-releaser ä¼šæ£€æµ‹ç‰ˆæœ¬æ”¹åŠ¨ï¼Œå¹¶è‡ªåŠ¨å‘ç‰ˆã€‚\nå‚è€ƒ # chart-releaser-action Â« Github Action ä½¿ç”¨æœ€ä½³å®è·µ\nÂ» GitHub æ‰˜ç®¡ helm-chart ä»“åº“\n"},{"id":75,"href":"/git/github-hosting-helm-reop/","title":"Github Hosting Helm Reop","section":"Git","content":" ğŸ  é¦–é¡µ / Git / GitHub æ‰˜ç®¡ helm-chart ä»“åº“\nGitHub æ‰˜ç®¡ helm-chart ä»“åº“ # åˆ›å»º GitHub ä»“åº“ # åˆ›å»º GitHub helm charts ä»“åº“ï¼Œä¾‹å¦‚ï¼šhelm-chartsï¼Œå…‹éš†åˆ°æœ¬åœ°ã€‚\ngit clone git@github.com:poneding/helm-charts.git cd helm-charts åˆ›å»º gh-pages å­¤ç«‹åˆ†æ”¯ # git checkout --orphan gh-pages git rm -rf . vim README.md ç¼–å†™ README.md æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š\n# helm-charts ## Usage [Helm](https://helm.sh) must be installed to use the charts. Please refer to Helm\u0026#39;s [documentation](https://helm.sh/docs) to get started. Once Helm has been set up correctly, add the repo as follows: ```bash helm repo add poneding https://poneding.github.io/helm-charts ``` If you had already added this repo earlier, run `helm repo update` to retrieve the latest versions of the packages. You can then run`helm search repo mycharts` to see the charts. To install the mycharts chart: ```bash helm install myapp poneding/myapp ``` To uninstall the chart: ```bash helm uninstall myapp ``` æäº¤ä»£ç ï¼š\ngit add . git commit -am \u0026#34;Add README.md\u0026#34; git push -u origin gh-pages å¯ç”¨ GitHub Pages # ä»“åº“å¯ç”¨ GitHub Pages åŠŸèƒ½ï¼Œé€‰æ‹© gh-pages åˆ†æ”¯ã€‚\nCharts å¼€å‘ # git checkout master mkdir charts cd charts helm create myapp cd .. é…ç½® GitHub Action # ä½¿ç”¨ GitHub Action æ­é… chart-releaser åŠŸèƒ½ï¼Œä¸ºæˆ‘ä»¬è‡ªåŠ¨å‘å¸ƒ charts ç‰ˆæœ¬ã€‚\nmkdir -p .github/workflows vim .github/workflows/release-chart.yaml name: Release Charts on: push: branches: - master jobs: release: # depending on default permission settings for your org (contents being read-only or read-write for workloads), you will have to add permissions # see: https://docs.github.com/en/actions/security-guides/automatic-token-authentication#modifying-the-permissions-for-the-github_token permissions: contents: write runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@v3 with: fetch-depth: 0 - name: Configure Git run: | git config user.name \u0026#34;$GITHUB_ACTOR\u0026#34; git config user.email \u0026#34;$GITHUB_ACTOR@users.noreply.github.com\u0026#34; - name: Install Helm uses: azure/setup-helm@v3 - name: Run chart-releaser uses: helm/chart-releaser-action@v1.5.0 env: CR_TOKEN: \u0026#34;${{ secrets.GITHUB_TOKEN }}\u0026#34; éœ€è¦æå‰å°† GitHub Token ç”Ÿæˆå‡ºæ¥ï¼Œå¹¶é…ç½®åˆ°ä»“åº“çš„ Secrets ä¸­ã€‚\næäº¤ä»£ç å³å¯ç¬¬ä¸€æ¬¡å‘ç‰ˆã€‚\nä¹‹åå¯¹ charts æ”¹åŠ¨åï¼Œä¿®æ”¹ Chart.yaml ä¸­çš„ version å­—æ®µï¼Œhelm-releaser ä¼šæ£€æµ‹ç‰ˆæœ¬æ”¹åŠ¨ï¼Œå¹¶è‡ªåŠ¨å‘ç‰ˆã€‚\nå‚è€ƒ # Helm | Chart Releaser Action to Automate GitHub Page Charts helm/chart-releaser-action Â« ä½¿ç”¨ GitHub æ‰˜ç®¡ helm-chart ä»“åº“\nÂ» GitHub\n"},{"id":76,"href":"/git/github/","title":"Github","section":"Git","content":" ğŸ  é¦–é¡µ / Git / GitHub\nGitHub # GitHub æ‰˜ç®¡ helm chart ä»“åº“ # GitHub æ‰˜ç®¡ helm chart ä»“åº“\nè·å–ä»“åº“æœ€æ–° Release çš„ç‰ˆæœ¬ # æ–¹æ³•ä¸€ï¼š\ncurl -s https://api.github.com/repos/ketches/registry-proxy/releases/latest | jq -r .tag_name æ–¹æ³•äºŒï¼š\nbasename $(curl -s -w %{redirect_url} https://github.com/ketches/registry-proxy/releases/latest) README ç¾åŒ– # å¾½æ ‡ # [![Go Report Card](https://goreportcard.com/badge/github.com/ketches/registry-proxy)](https://goreportcard.com/report/github.com/ketches/registry-proxy) [![Go Doc](https://pkg.go.dev/badge/github.com/ketches/registry-proxy)](https://pkg.go.dev/github.com/ketches/registry-proxy) [![GitHub release](https://img.shields.io/github/v/release/ketches/registry-proxy)](https://img.shields.io/github/v/release/ketches/registry-proxy) [![GitHub license](https://img.shields.io/github/license/ketches/registry-proxy)](https://img.shields.io/github/license/ketches/registry-proxy) [![GitHub stars](https://img.shields.io/github/stars/ketches/registry-proxy)](https://img.shields.io/github/stars/ketches/registry-proxy) [![GitHub forks](https://img.shields.io/github/forks/ketches/registry-proxy)](https://img.shields.io/github/forks/ketches/registry-proxy) Stars èµ°åŠ¿ # [![Stargazers over time](https://starchart.cc/ketches/registry-proxy.svg?variant=adaptive)](https://starchart.cc/ketches/registry-proxy) è´¡çŒ®è€…åˆ—è¡¨ # ![Contributors](https://contrib.rocks/image?repo=ketches/registry-proxy) Â« GitHub æ‰˜ç®¡ helm-chart ä»“åº“\nÂ» Gitlab æ·»åŠ  K8s é›†ç¾¤\n"},{"id":77,"href":"/git/gitlab-intergrate-k8s/","title":"Gitlab Intergrate K8s","section":"Git","content":" ğŸ  é¦–é¡µ / Git / Gitlab æ·»åŠ  K8s é›†ç¾¤\nGitlab æ·»åŠ  K8s é›†ç¾¤ # æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ Gitlab é¡¹ç›®ä¸­æ·»åŠ  K8s é›†ç¾¤ï¼Œä»¥ä¾¿ä½¿ç”¨ K8s é›†ç¾¤éƒ¨ç½² gitlab-runner å¸®æˆ‘ä»¬è¿è¡Œ gitlab çš„ CI/CDã€‚\nå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š https://docs.gitlab.com/ee/user/project/clusters/add_remove_clusters.html#add-existing-cluster\næ“ä½œæ­¥éª¤ # æ‰¾åˆ°æ·»åŠ ä½ç½®ï¼š\nç™»å…¥ gitlab åï¼Œè¿›å…¥è‡ªå·±çš„é¡¹ç›®ä¸»é¡µï¼Œèœå•æ  Operations =\u0026gt; Kubernetes =\u0026gt; Add Kubernetes clusterï¼Œé€‰æ‹©é¡µç­¾ Add existing clusterã€‚\næˆ‘ä»¬åªéœ€è¦è·å–å“åº”çš„å€¼å¡«å½•åˆ°è¯¥è¡¨å•å³å¯ã€‚Kubernetes cluster name é›†ç¾¤åç§°éšæ„å¡«ï¼ŒProject namespace å¯ä¸å¡«ã€‚\nè·å– API URLï¼š\nè¿è¡Œä»¥ä¸‹å‘½ä»¤å¾—åˆ°è¾“å‡ºå€¼ï¼š\nkubectl cluster-info | grep \u0026#39;Kubernetes master\u0026#39; | awk \u0026#39;/http/ {print $NF}\u0026#39; è·å– CA Certificateï¼š\nè¿è¡Œä»¥ä¸‹å‘½ä»¤å¾—åˆ°è¾“å‡ºå€¼ï¼š\nkubectl get secret $(kubectl get secret | grep default-token | awk \u0026#39;{print $1}\u0026#39;) -o jsonpath=\u0026#34;{[\u0026#39;data\u0026#39;][\u0026#39;ca\\.crt\u0026#39;]}\u0026#34; | base64 --decode è·å– Tokenï¼š\nåˆ›å»ºæ–‡ä»¶ gitlab-sa.yamlï¼š\nvim gitlab-sa.yaml æ–‡ä»¶å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š\napiVersion: v1 kind: ServiceAccount metadata: name: gitlab-sa namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: gitlab-sa roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - kind: ServiceAccount name: gitlab-sa namespace: kube-system è¿è¡Œä»¥ä¸‹å‘½ä»¤å¾—åˆ°è¾“å‡ºå€¼ï¼š\nkubectl apply -f gitlab-sa.yaml kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep gitlab-sa | awk \u0026#39;{print $1}\u0026#39;) æ·»åŠ å®Œæˆä¹‹åï¼Œå¯ä»¥åœ¨é›†ç¾¤ä¸­å®‰è£…ä½ æƒ³ç”¨çš„æ’ä»¶äº†ï¼Œä¾‹å¦‚ gitlab-runnerã€‚\nè¸©å‘è®°å½• # Gitlab ä¸ Kubernetes ç‰ˆæœ¬å…¼å®¹é—®é¢˜\nåœ¨ Gitlab ä¸­æ·»åŠ  Kubernetes é›†ç¾¤ï¼Œå¯èƒ½å­˜åœ¨ä¸¤è€…ç‰ˆæœ¬ä¸å…¼å®¹çš„é—®é¢˜ï¼Œè¿™ä¼šå¯¼è‡´ gitlab è°ƒç”¨ K8s é›†ç¾¤çš„ API å¤±è´¥ï¼Œå¯èƒ½æ˜¯å› ä¸º K8s ä¸åŒç‰ˆæœ¬çš„ api æ›´æ–°çš„ç¼˜æ•…ã€‚å°½é‡ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Gitlabï¼Œä»–ä¼šæ”¯æŒæ›´å¤šç‰ˆæœ¬çš„ K8s APIã€‚\nå¯ä»¥é€šè¿‡æ–‡æ¡£æŸ¥çœ‹ Gitlab æ”¯æŒçš„ K8s ç‰ˆæœ¬ï¼š https://docs.gitlab.com/ee/user/project/clusters/index.html\nå¦‚æœåœ¨æ·»åŠ é›†ç¾¤é‡åˆ° is blocked: Requests to the local network are not allowed é—®é¢˜ï¼Œéœ€è¦è®¾ç½®\nSettings =\u0026gt; Network =\u0026gt; Outbound requestsï¼Œå°†é€‰é¡¹ Allow requests to the local network from web hooks and services å‹¾é€‰å³å¯ã€‚\nÂ« GitHub\nÂ» Gitlab è·¨ç‰ˆæœ¬å‡çº§\n"},{"id":78,"href":"/git/gitlab-upgrade-cross-version/","title":"Gitlab Upgrade Cross Version","section":"Git","content":" ğŸ  é¦–é¡µ / Git / Gitlab è·¨ç‰ˆæœ¬å‡çº§\nGitlab è·¨ç‰ˆæœ¬å‡çº§ # æœ¬æ–‡è®°å½• Gitlab è·¨ç‰ˆæœ¬å‡çº§çš„å…·ä½“æ“ä½œè¿‡ç¨‹ã€‚\næŒ‰ç…§å®˜æ–¹çš„è¯´æ³•ï¼Œgitlab å…è®¸å°ç‰ˆæœ¬ç›´æ¥å‡çº§ï¼Œå¤§ç‰ˆæœ¬éœ€è¦é˜¶æ®µå‡çº§ã€‚\nè·¨ç‰ˆæœ¬å‡çº§ç¤ºä¾‹ï¼š11.0.x -\u0026gt; 11.11.x -\u0026gt; 12.0.x -\u0026gt; 12.10.x -\u0026gt; 13.0.xã€‚\nå®˜æ–¹æ¨èçš„å‡çº§è·¯çº¿æ–‡æ¡£ï¼š https://docs.gitlab.com/ee/policy/maintenance.html#upgrade-recommendations\nç›®çš„ # å®ç° gitlab ç‰ˆæœ¬ï¼š11.2.3 åˆ° 13.0.0 ç‰ˆæœ¬çš„å‡çº§ï¼Œæˆ‘é€‰æ‹©çš„å‡çº§è·¯çº¿æ˜¯ï¼š11.2.3 =\u0026gt; 11.11.8 =\u0026gt; 12.0.12 =\u0026gt; 12.10.6 =\u0026gt; 13.0.0 =\u0026gt; 13.1.2\næˆ‘å½“å‰åˆ›å»º gitlab å®¹å™¨çš„è„šæœ¬å¦‚ä¸‹ï¼š\nsudo docker run --detach \\ --hostname gitlab.example.com \\ --publish 8443:443 --publish 8080:80 --publish 8022:22 \\ --name gitlab \\ --restart always \\ --volume /home/ubuntu/Apps/gitlab/etc/gitlab:/etc/gitlab \\ --volume /home/ubuntu/Apps/gitlab/var/log/gitlab/logs:/var/log/gitlab \\ --volume /home/ubuntu/Apps/gitlab/var/opt/gitlab:/var/opt/gitlab \\ gitlab/gitlab-ce:11.2.3-ce.0 æˆ‘å½“å‰çš„ gitlab å®¹å™¨å·²ç»å°† /etc/gitlabï¼Œ/var/log/gitlabï¼Œ/var/opt/gitlab æŒ‚è½½åˆ°äº†å®¿ä¸»æœºä¸Šã€‚\næ“ä½œæ­¥éª¤ # è¿›å…¥ gitlab å®¹å™¨ï¼Œåœæ­¢ gitlab æœåŠ¡ï¼Œç„¶åé€€å‡ºå®¹å™¨ï¼š\nsudo docker exec -it gitlab /bin/bash # è¿›å…¥å®¹å™¨åæ‰§è¡Œ gitlab-ctl stop é€€å‡ºå®¹å™¨åï¼Œåˆ é™¤ gitlab å®¹å™¨ï¼š\nsudo docker rm gitlab -f ä½¿ç”¨æ–°ç‰ˆæœ¬çš„è„šæœ¬è¿è¡Œ gitlab å®¹å™¨ï¼Œè¿™é‡Œåªä¿®æ”¹ gitlab çš„é•œåƒç‰ˆæœ¬å°±å¯ä»¥äº†ï¼š\nsudo docker run --detach \\ --hostname gitlab.example.com \\ --publish 8443:443 --publish 8080:80 --publish 8022:22 \\ --name gitlab \\ --restart always \\ --volume /home/ubuntu/Apps/gitlab/etc/gitlab:/etc/gitlab \\ --volume /home/ubuntu/Apps/gitlab/var/log/gitlab/logs:/var/log/gitlab \\ --volume /home/ubuntu/Apps/gitlab/var/opt/gitlab:/var/opt/gitlab \\ gitlab/gitlab-ce:11.2.3-ce.0 å¯åŠ¨å®¹å™¨åï¼ŒæŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€ï¼š\nsudo docker ps | grep gitlab ç­‰åˆ°å®¹å™¨çŠ¶æ€ä¸º Up xxx (healthy) åï¼Œè¿›å…¥å®¹å™¨ï¼Œåœæ‰ gitlab æœåŠ¡ã€‚ã€‚ã€‚\nåé¢å°±æ˜¯é‡å¤å·¥ä½œäº†ï¼Œç›´åˆ°è¿è¡Œæœ€æ–°ç‰ˆæœ¬çš„gitlabå®¹å™¨ã€‚\nGitlab å¤‡ä»½ # åœ¨å‡çº§ä¹‹å‰ï¼Œæœ€å¥½å…ˆå¯¹ gitlab æ•°æ®åšä¸€ä¸ªå…¨é‡å¤‡ä»½ï¼Œé¿å…å‡çº§å¤±è´¥é€ æˆçš„ä¸å¯é€†å½±å“ã€‚\nå…·ä½“çš„è¿˜åŸæ“ä½œå¦‚ä¸‹ï¼š\nå¦‚æœä½ å’Œæˆ‘ä¸€æ ·ä½¿ç”¨ gitlab å®¹å™¨ï¼Œé¦–å…ˆè¿›å…¥å®¹å™¨ï¼Œç„¶åæ‰§è¡Œå¤‡ä»½å‘½ä»¤ï¼š\ngitlab-rake gitlab:backup:create ä»¥ä¸Šå‘½ä»¤æ‰§è¡Œå®Œåï¼Œä¼šåœ¨å®¹å™¨çš„ /var/opt/gitlab/backups ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶åç±»ä¼¼ 1592276197_2020_06_16_11.2.3_gitlab_backup.tar çš„å¤‡ä»½æ–‡ä»¶ã€‚\nGitlab è¿˜åŸ # å¦‚æœä½ æƒ³åˆ©ç”¨ gitlab çš„å¤‡ä»½æ–‡ä»¶è¿˜åŸï¼Œé‚£ä¹ˆä½ è¿è¡Œè¿˜åŸæ“ä½œçš„ gitlab å¿…é¡»å’Œå¤‡ä»½æ—¶ä½¿ç”¨çš„ gitlab ç‰ˆæœ¬ä¸€è‡´ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°è¿˜åŸå¤±è´¥çš„é—®é¢˜ã€‚\nå…·ä½“çš„è¿˜åŸæ“ä½œå¦‚ä¸‹ï¼š\nå¦‚æœä½ å’Œæˆ‘ä¸€æ ·ä½¿ç”¨ gitlab å®¹å™¨ï¼Œé¦–å…ˆå°† gitlab çš„å¤‡ä»½æ–‡ä»¶æ‹·è´åˆ° /var/opt/gitlab/backups/ ç›®å½•ä¸‹ï¼Œç„¶åè¿›å…¥ gitlab å®¹å™¨ï¼Œæ‰§è¡Œè¿˜åŸå‘½ä»¤ï¼š\ngitlab-rake gitlab:backup:restore BACKUP=1592276197_2020_06_16_11.2.3 BACKUP å‘½ä»¤å‚æ•°æŒ‡å®šå€¼ä¸º /var/opt/gitlab/backups/ ç›®å½•ä¸‹çš„å¤‡ä»½æ–‡ä»¶ï¼Œä½†æ˜¯æ— éœ€æºå¸¦ _gitlab_backup.tar åç¼€ã€‚\nÂ« Gitlab æ·»åŠ  K8s é›†ç¾¤\nÂ» å¤š GitHub è´¦å·ç®¡ç†\n"},{"id":79,"href":"/git/multi-github-account-management/","title":"Multi Github Account Management","section":"Git","content":" ğŸ  é¦–é¡µ / Git / å¤š GitHub è´¦å·ç®¡ç†\nå¤š GitHub è´¦å·ç®¡ç† # å®é™…å¼€å‘å·¥ä½œä¸­ï¼Œä½ æœ‰å¯èƒ½å¤šä¸ª GitHub è´¦å·ï¼šä¸ªäººå¼€å‘è´¦å·ï¼Œå·¥ä½œå¼€å‘è´¦å·ã€‚\nåœ¨ä»“åº“ä»£ç ç®¡ç†çš„è¿‡ç¨‹ä¸­ä½ éœ€è¦é‡å¤çš„ä½¿ç”¨ git config user.* æ¥åˆ‡æ¢ä»£ç æäº¤è´¦å·ï¼Œå¾ˆæ˜¯éº»çƒ¦ã€‚ä»¥ä¸‹æ–¹æ¡ˆå¯ä»¥å¸®ä½ è§£å†³ä½ çš„çƒ¦æ¼ã€‚\nè¯·ç¡®ä¿ä½ çš„ git ç‰ˆæœ¬æœ€ä½ä¸º 2.13\n~/.gitconfig\n[user] name = poneding email = poneding@gmail.com [includeIf \u0026#34;gitdir:~/src/workspace/\u0026#34;] path = ~/src/workspace/.gitconfig [url \u0026#34;git@github-workspace\u0026#34;] insteadOf = git@github.com [pull] rebase = false [init] defaultBranch = master [core] excludesfile = ~/.gitignore_global ~/src/workspace/.gitconfig\n[user] name = dingpeng24001 email = dingpeng24001@talkweb.com.cn [url \u0026#34;git@github-workspace\u0026#34;] insteadOf = git@github.com [pull] rebase = false [init] defaultBranch = master [core] excludesfile = ~/.gitignore_global ~/.ssh/config\nHost github.com HostName github.com IdentityFile ~/.ssh/id_rsa â€‹ Host github-workspace HostName github.com IdentityFile ~/.ssh/id_rsa_dingpeng24001 ~/.ssh/id_rsa æ˜¯ä¸ªäººè´¦å· github ssh key\n~/.ssh/id_rsa_dingpeng24001 æ˜¯å·¥ä½œè´¦å· github ssh key\nÂ« Gitlab è·¨ç‰ˆæœ¬å‡çº§\nÂ» æ­å»ºæœ€ç®€å•çš„ git ä»“åº“æœåŠ¡\n"},{"id":80,"href":"/git/simplest-git-server/","title":"Simplest Git Server","section":"Git","content":" ğŸ  é¦–é¡µ / Git / æ­å»ºæœ€ç®€å•çš„ git ä»“åº“æœåŠ¡\næ­å»ºæœ€ç®€å•çš„ git ä»“åº“æœåŠ¡ # è¿œç«¯ # åˆ›å»ºä»“åº“æœåŠ¡ç›®å½•ï¼š\ngit init --bare git-server-demo.git å…¶å®ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯åˆ›å»ºï¼Œä½†æ˜¯ä½ é¦–å…ˆè¦å¯ä»¥èƒ½å¤Ÿé€šè¿‡ ssh çš„æ–¹å¼è¿æ¥è¿œç«¯ï¼Œä¾‹å¦‚è¿œç«¯ IP æ˜¯ 192.168.10.24\nssh root@192.168.10.24 git init --bare git-server-demo.git æ‰§è¡Œå®Œå‘½ä»¤ä¹‹åï¼Œå°†åœ¨è¿œç«¯ç›®æ ‡ç›®å½•ä¸‹ç”Ÿæˆ git-server-demo ç›®å½•ï¼Œå­ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\ntree git-server-demo.git git-server-demo.git â”œâ”€â”€ branches â”œâ”€â”€ config â”œâ”€â”€ description â”œâ”€â”€ HEAD â”œâ”€â”€ hooks â”‚Â â”œâ”€â”€ applypatch-msg.sample â”‚Â â”œâ”€â”€ commit-msg.sample â”‚Â â”œâ”€â”€ fsmonitor-watchman.sample â”‚Â â”œâ”€â”€ post-update.sample â”‚Â â”œâ”€â”€ pre-applypatch.sample â”‚Â â”œâ”€â”€ pre-commit.sample â”‚Â â”œâ”€â”€ pre-merge-commit.sample â”‚Â â”œâ”€â”€ prepare-commit-msg.sample â”‚Â â”œâ”€â”€ pre-push.sample â”‚Â â”œâ”€â”€ pre-rebase.sample â”‚Â â”œâ”€â”€ pre-receive.sample â”‚Â â”œâ”€â”€ push-to-checkout.sample â”‚Â â””â”€â”€ update.sample â”œâ”€â”€ info â”‚Â â””â”€â”€ exclude â”œâ”€â”€ objects â”‚Â â”œâ”€â”€ info â”‚Â â””â”€â”€ pack â””â”€â”€ refs â”œâ”€â”€ heads â””â”€â”€ tags ç»ˆç«¯ # å¿…è¦æ¡ä»¶ï¼šå¯ä»¥ ssh çš„æ–¹å¼ç™»å½•è¿œç«¯æœåŠ¡å™¨è´¦å·ã€‚\nå°è¯•å…‹éš†ä»£ç ï¼š\ngit clone root@192.168.10.24:git-server-demo.git å‰©ä½™å°±æ˜¯å¸¸è§„ git æ­¥éª¤äº†ã€‚ # Â« å¤š GitHub è´¦å·ç®¡ç†\n"},{"id":81,"href":"/go/","title":"Go","section":"","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹\nGolang ç¼–ç¨‹ # Go å¼€å‘ç¯å¢ƒé…ç½®\nGolang å‡½æ•°å¯é€‰å‚æ•°æ¨¡å¼\nGolang å¯†é’¥å¯¹ã€æ•°å­—ç­¾åå’Œè¯ä¹¦ç®¡ç†\nGolang ä¸åŒå¹³å°æ¶æ„ç¼–è¯‘\nGolang å®ˆæŠ¤è¿›ç¨‹\nGolang ç”Ÿæˆè¯ä¹¦\ngo:linkname æŒ‡ä»¤\nGolang åˆ—è¡¨è½¬æ ‘\nGolang å®ç°åŒå‘è®¤è¯\nGolang å‘å¸ƒç±»åº“ - 1\nGolang å‘å¸ƒç±»åº“ - 2\nGo ç¨‹åº SOLID è®¾è®¡åŸåˆ™\nGolang æ ‡å‡†åº“\ntesting\nGolang\ngopkg-errors.md\nGoreleaser\nMac M1 äº¤å‰ç¼–è¯‘ CGO\npprof\nä½¿ç”¨ Go ç”Ÿæˆ OpenSSH å…¼å®¹çš„ RSA å¯†é’¥å¯¹\n"},{"id":82,"href":"/go/dev-env-config/","title":"Dev Env Config","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Go å¼€å‘ç¯å¢ƒé…ç½®\nGo å¼€å‘ç¯å¢ƒé…ç½® # cobra-cli # å®‰è£…ï¼š\ngo install github.com/spf13/cobra-cli@latest è‡ªåŠ¨è¡¥å…¨ï¼š\ncobra-cli completion zsh \u0026gt; .zfunc/_cobra-cli åœ¨ .zshrc æ–‡ä»¶ä¸­æ·»åŠ å†…å®¹ï¼ˆå¦‚æœå·²æ·»åŠ ï¼Œåˆ™å¿½ç•¥ï¼‰ï¼š\nfpath+=~/.zfunc autoload -Uz compinit \u0026amp;\u0026amp; compinit Â» Golang å‡½æ•°å¯é€‰å‚æ•°æ¨¡å¼\n"},{"id":83,"href":"/go/function-optional-pattern/","title":"Function Optional Pattern","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Golang å‡½æ•°å¯é€‰å‚æ•°æ¨¡å¼\nGolang å‡½æ•°å¯é€‰å‚æ•°æ¨¡å¼ # å‡½æ•°å¯é€‰å‚æ•°æ¨¡å¼ # type Server struct { Addr string Timeout time.Duration } type Option func(*Server) func newServer(addr string, options ...Option) (*Server, error) { s := \u0026amp;Server{ Addr: addr, } for _, opt := range options { opt(s) } // ... return s, nil } func WithTimeout(timeout time.Duration) Option { return func(s *Server) { s.Timeout = timeout } } é€šç”¨å‡½æ•°å¯é€‰å‚æ•°æ¨¡å¼ # type BasicService struct { redisClient string } type ServiceOption func(*BasicService) func WithRedisClient(redisClient string) ServiceOption { return func(s *BasicService) { s.redisClient = redisClient } } type UserService struct { *BasicService } type OrderService struct { *BasicService } func newUserService(opts ...ServiceOption) *UserService { us := \u0026amp;UserService{BasicService: new(BasicService)} for _, opt := range opts { opt(us.BasicService) } return us } func newOrderService(opts ...ServiceOption) *OrderService { os := \u0026amp;OrderService{BasicService: new(BasicService)} for _, opt := range opts { opt(os.BasicService) } return os } func TestNewService(t *testing.T) { us := newUserService(WithRedisClient(\u0026#34;redis\u0026#34;)) t.Log(us.redisClient) os := newOrderService(WithRedisClient(\u0026#34;redis\u0026#34;)) t.Log(os.redisClient) } Â« Go å¼€å‘ç¯å¢ƒé…ç½®\nÂ» Golang å¯†é’¥å¯¹ã€æ•°å­—ç­¾åå’Œè¯ä¹¦ç®¡ç†\n"},{"id":84,"href":"/go/go-cert-management/","title":"Go Cert Management","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Golang å¯†é’¥å¯¹ã€æ•°å­—ç­¾åå’Œè¯ä¹¦ç®¡ç†\nGolang å¯†é’¥å¯¹ã€æ•°å­—ç­¾åå’Œè¯ä¹¦ç®¡ç† # Golang å®ç°å¯†é’¥å¯¹ç”Ÿæˆ ç›¸å½“äºä½¿ç”¨ openssl ç”Ÿæˆç§é’¥å’Œå…¬é’¥ï¼š\nopenssl genrsa -out pri.key 2048 openssl rsa -in pri.key -pubout -out pub.key package main import ( \u0026#34;crypto/rand\u0026#34; \u0026#34;crypto/rsa\u0026#34; ) func GenerateKeyPair() (*rsa.PrivateKey, *rsa.PublicKey, error) { prikey, err := rsa.GenerateKey(rand.Reader, 2048) if err != nil { return nil, nil, err } return prikey, \u0026amp;prikey.PublicKey, nil } å®ç°åŠ å¯†å’Œè§£å¯† åŠ å¯†è§£å¯†ï¼šå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†\npackage main import ( \u0026#34;crypto/rand\u0026#34; \u0026#34;crypto/rsa\u0026#34; ) func Encrypt(data []byte, publicKey *rsa.PublicKey) ([]byte, error) { return rsa.EncryptPKCS1v15(rand.Reader, publicKey, data) } func Decrypt(data []byte, privateKey *rsa.PrivateKey) ([]byte, error) { return rsa.DecryptPKCS1v15(rand.Reader, privateKey, data) } å®ç°æ•°å­—ç­¾å æ•°å­—ç­¾åï¼šç§é’¥ç­¾åï¼Œå…¬é’¥éªŒè¯\npackage main import ( \u0026#34;crypto\u0026#34; \u0026#34;crypto/rand\u0026#34; \u0026#34;crypto/rsa\u0026#34; \u0026#34;crypto/sha256\u0026#34; ) func Sign(data []byte, privateKey *rsa.PrivateKey) ([]byte, error) { hash := sha256.New() hash.Write(data) return rsa.SignPKCS1v15(rand.Reader, privateKey, crypto.SHA256, hash.Sum(nil)) } func Verify(data []byte, sig []byte, publicKey *rsa.PublicKey) error { hash := sha256.New() hash.Write(data) return rsa.VerifyPKCS1v15(publicKey, crypto.SHA256, hash.Sum(nil), sig) } Â« Golang å‡½æ•°å¯é€‰å‚æ•°æ¨¡å¼\nÂ» Golang ä¸åŒå¹³å°æ¶æ„ç¼–è¯‘\n"},{"id":85,"href":"/go/go-cross-complie/","title":"Go Cross Complie","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Golang ä¸åŒå¹³å°æ¶æ„ç¼–è¯‘\nGolang ä¸åŒå¹³å°æ¶æ„ç¼–è¯‘ # åœ¨ MacOS å¹³å°ç¼–è¯‘æˆ Windowsã€Linux å¯æ‰§è¡Œæ–‡ä»¶ï¼š\nCGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build main.go CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build main.go CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build main.go CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build main.go åœ¨ Windows å¹³å°ç¼–è¯‘æˆ Linuxã€MacOS å¯æ‰§è¡Œæ–‡ä»¶ï¼š\n$env:GOOS = \u0026#34;linux\u0026#34;;$env:CGO_ENABLED = \u0026#34;0\u0026#34;;$env:GOARCH = \u0026#34;amd64\u0026#34;;go build carbon/carbon.go $env:GOOS = \u0026#34;linux\u0026#34;;$env:CGO_ENABLED = \u0026#34;0\u0026#34;;$env:GOARCH = \u0026#34;arm64\u0026#34;;go build carbon/carbon.go $env:GOOS = \u0026#34;darwin\u0026#34;;$env:CGO_ENABLED = \u0026#34;0\u0026#34;;$env:GOARCH = \u0026#34;amd64\u0026#34;;go build carbon/carbon.go $env:GOOS = \u0026#34;darwin\u0026#34;;$env:CGO_ENABLED = \u0026#34;0\u0026#34;;$env:GOARCH = \u0026#34;arm64\u0026#34;;go build carbon/carbon.go åœ¨ Linux å¹³å°ç¼–è¯‘æˆ Windowsã€MacOS å¯æ‰§è¡Œæ–‡ä»¶ï¼š\nCGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build main.go CGO_ENABLED=0 GOOS=darwin GOARCH=arm64 go build main.go CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build main.go CGO_ENABLED=0 GOOS=windows GOARCH=arm64 go build main.go Â« Golang å¯†é’¥å¯¹ã€æ•°å­—ç­¾åå’Œè¯ä¹¦ç®¡ç†\nÂ» Golang å®ˆæŠ¤è¿›ç¨‹\n"},{"id":86,"href":"/go/go-daemon/","title":"Go Daemon","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Golang å®ˆæŠ¤è¿›ç¨‹\nGolang å®ˆæŠ¤è¿›ç¨‹ # åœ¨ Go ä¸­ç¼–å†™åå°è¿è¡Œçš„ç¨‹åºï¼ˆDaemonï¼‰çš„å¸¸è§æ­¥éª¤æ¶‰åŠåˆ°ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\nåˆ›å»ºå®ˆæŠ¤è¿›ç¨‹ # å®ˆæŠ¤è¿›ç¨‹æ˜¯ä¸€ä¸ªåœ¨åå°è¿è¡Œã€ä¸å—ç”¨æˆ·äº¤äº’å½±å“çš„ç¨‹åºã€‚ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ syscall åŒ…ä¸­çš„ä¸€äº›ç³»ç»Ÿè°ƒç”¨è®© Go ç¨‹åºå˜ä¸ºåå°è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ã€‚\nç¤ºä¾‹ä»£ç ï¼š\nfork.go\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; \u0026#34;slices\u0026#34; \u0026#34;syscall\u0026#34; ) func init() { if slices.Contains(os.Args, \u0026#34;-d\u0026#34;) { // Fork å‡ºå­è¿›ç¨‹å¹¶è·å–å…¶ PID newArgs := make([]string, 0) for _, arg := range os.Args { if arg == \u0026#34;-d\u0026#34; { continue } newArgs = append(newArgs, arg) } pid, err := syscall.ForkExec(os.Args[0], newArgs, \u0026amp;syscall.ProcAttr{ Files: []uintptr{uintptr(syscall.Stdin), uintptr(syscall.Stdout), uintptr(syscall.Stderr)}, }) if err != nil { fmt.Println(\u0026#34;fork failed:\u0026#34;, err) return } // å°†å­è¿›ç¨‹ PID ä¿å­˜åˆ°æ–‡ä»¶ file, err := os.Create(\u0026#34;child_pid.txt\u0026#34;) if err != nil { fmt.Println(\u0026#34;create file failed:\u0026#34;, err) return } defer file.Close() file.WriteString(fmt.Sprintf(\u0026#34;pid: %d\u0026#34;, pid)) os.Exit(0) // çˆ¶è¿›ç¨‹é€€å‡º } } main.go\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;io/fs\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;time\u0026#34; ) func main() { // ä¸šåŠ¡é€»è¾‘ï¼šæ¯éš”ä¸€ç§’å‘æ–‡ä»¶å†™å…¥æ–°å†…å®¹ for { time.Sleep(1 * time.Second) file, err := os.OpenFile(\u0026#34;./hello\u0026#34;, os.O_CREATE|os.O_WRONLY|os.O_APPEND, fs.FileMode(0644)) if err != nil { log.Println(\u0026#34;open file failed:\u0026#34;, err) return } _, err = file.WriteString(fmt.Sprintf(\u0026#34;[%s] Hello.\\n\u0026#34;, time.Now().Format(time.RFC3339))) if err != nil { log.Println(\u0026#34;write file failed:\u0026#34;, err) } file.Close() } } ä½¿ç”¨ nohup å‘½ä»¤è¿è¡Œ # å¦‚æœä¸æƒ³ä¿®æ”¹ä»£ç ï¼Œå¯ä»¥ç›´æ¥åœ¨å¯åŠ¨æ—¶ä½¿ç”¨ Linux æä¾›çš„ nohup å‘½ä»¤è¿è¡Œ Go ç¨‹åºï¼Œä½¿å…¶ä¸ä¾èµ–ç»ˆç«¯ï¼Œå¹¶è‡ªåŠ¨é‡å®šå‘è¾“å‡ºï¼š\nä»£ç ç¤ºä¾‹ï¼š\nmain.go\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;io/fs\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;time\u0026#34; ) func main() { // ä¸šåŠ¡é€»è¾‘ï¼šæ¯éš”ä¸€ç§’å‘æ–‡ä»¶å†™å…¥æ–°å†…å®¹ for { time.Sleep(1 * time.Second) file, err := os.OpenFile(\u0026#34;./hello\u0026#34;, os.O_CREATE|os.O_WRONLY|os.O_APPEND, fs.FileMode(0644)) if err != nil { log.Println(\u0026#34;open file failed:\u0026#34;, err) return } _, err = file.WriteString(fmt.Sprintf(\u0026#34;[%s] Hello.\\n\u0026#34;, time.Now().Format(time.RFC3339))) if err != nil { log.Println(\u0026#34;write file failed:\u0026#34;, err) } file.Close() } } è¿è¡Œï¼š\ngo build -o main main.go nohup ./main \u0026gt; output.log 2\u0026gt;\u0026amp;1 \u0026amp; ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ go-daemon åŒ…ï¼‰ # å¦‚æœè§‰å¾—è‡ªå·±ç®¡ç†åå°è¿è¡Œé€»è¾‘æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›åº“ï¼Œå¦‚ github.com/sevlyar/go-daemonï¼Œç®€åŒ–å®ˆæŠ¤è¿›ç¨‹çš„å®ç°ã€‚\nä»£ç ç¤ºä¾‹ï¼š\nmain.go\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;io/fs\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/sevlyar/go-daemon\u0026#34; ) func main() { cntxt := \u0026amp;daemon.Context{ PidFileName: \u0026#34;sample.pid\u0026#34;, PidFilePerm: 0644, LogFileName: \u0026#34;sample.log\u0026#34;, LogFilePerm: 0640, WorkDir: \u0026#34;./\u0026#34;, Umask: 027, } d, err := cntxt.Reborn() if err != nil { fmt.Println(\u0026#34;æ— æ³•å¯åŠ¨åå°è¿›ç¨‹:\u0026#34;, err) return } if d != nil { return } defer cntxt.Release() // ä¸šåŠ¡é€»è¾‘ï¼šæ¯éš”ä¸€ç§’å‘æ–‡ä»¶å†™å…¥æ–°å†…å®¹ for { time.Sleep(1 * time.Second) file, err := os.OpenFile(\u0026#34;./hello\u0026#34;, os.O_CREATE|os.O_WRONLY|os.O_APPEND, fs.FileMode(0644)) if err != nil { log.Println(\u0026#34;open file failed:\u0026#34;, err) return } _, err = file.WriteString(fmt.Sprintf(\u0026#34;[%s] Hello.\\n\u0026#34;, time.Now().Format(time.RFC3339))) if err != nil { log.Println(\u0026#34;write file failed:\u0026#34;, err) } file.Close() } } ä½ å¯ä»¥æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ³•è®© Go ç¨‹åºåå°è¿è¡Œã€‚å¦‚æœä½ æœ‰æ›´å…·ä½“çš„éœ€æ±‚ï¼Œæ¬¢è¿æä¾›æ›´å¤šç»†èŠ‚ã€‚\nÂ« Golang ä¸åŒå¹³å°æ¶æ„ç¼–è¯‘\nÂ» Golang ç”Ÿæˆè¯ä¹¦\n"},{"id":87,"href":"/go/go-gen-cert/","title":"Go Gen Cert","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Golang ç”Ÿæˆè¯ä¹¦\nGolang ç”Ÿæˆè¯ä¹¦ # ä»£ç å®ç° # package certutil import ( \u0026#34;bytes\u0026#34; \u0026#34;crypto/rand\u0026#34; \u0026#34;crypto/rsa\u0026#34; \u0026#34;crypto/x509\u0026#34; \u0026#34;crypto/x509/pkix\u0026#34; \u0026#34;encoding/pem\u0026#34; \u0026#34;math/big\u0026#34; \u0026#34;net\u0026#34; \u0026#34;time\u0026#34; ) // CA ca type CA struct { caInfo *x509.Certificate caPrivKey *rsa.PrivateKey caPem, caKeyPem []byte } // GetCAPem get ca pem bytes func (c *CA) GetCAPem() ([]byte, error) { if c.caPem == nil { // create the CA caBytes, err := x509.CreateCertificate(rand.Reader, c.caInfo, c.caInfo, \u0026amp;c.caPrivKey.PublicKey, c.caPrivKey) if err != nil { return nil, err } // pem encode caPEM := new(bytes.Buffer) _ = pem.Encode(caPEM, \u0026amp;pem.Block{ Type: \u0026#34;CERTIFICATE\u0026#34;, Bytes: caBytes, }) c.caPem = caPEM.Bytes() } return c.caPem, nil } // GetCAKeyPem get ca key pem func (c *CA) GetCAKeyPem() ([]byte, error) { if c.caKeyPem == nil { caPrivKeyPEM := new(bytes.Buffer) _ = pem.Encode(caPrivKeyPEM, \u0026amp;pem.Block{ Type: \u0026#34;RSA PRIVATE KEY\u0026#34;, Bytes: x509.MarshalPKCS1PrivateKey(c.caPrivKey), }) c.caKeyPem = caPrivKeyPEM.Bytes() } return c.caKeyPem, nil } // CreateCert make Certificate func (c *CA) CreateCert(ips []string, domains ...string) (certPem, certKey []byte, err error) { var ipAddresses []net.IP for _, ip := range ips { if i := net.ParseIP(ip); i != nil { ipAddresses = append(ipAddresses, i) } } // set up our server certificate cert := \u0026amp;x509.Certificate{ SerialNumber: big.NewInt(2019), Subject: pkix.Name{ Organization: []string{\u0026#34;poneding.com\u0026#34;}, Country: []string{\u0026#34;CN\u0026#34;}, Province: []string{\u0026#34;Beijing\u0026#34;}, Locality: []string{\u0026#34;Beijing\u0026#34;}, StreetAddress: []string{\u0026#34;Beijing\u0026#34;}, PostalCode: []string{\u0026#34;000000\u0026#34;}, }, DNSNames: domains, IPAddresses: ipAddresses, NotBefore: time.Now(), NotAfter: time.Now().AddDate(99, 0, 0), SubjectKeyId: []byte{1, 2, 3, 4, 6}, ExtKeyUsage: []x509.ExtKeyUsage{x509.ExtKeyUsageClientAuth, x509.ExtKeyUsageServerAuth}, KeyUsage: x509.KeyUsageDigitalSignature, } certPrivKey, err := rsa.GenerateKey(rand.Reader, 4096) if err != nil { return nil, nil, err } certBytes, err := x509.CreateCertificate(rand.Reader, cert, c.caInfo, \u0026amp;certPrivKey.PublicKey, c.caPrivKey) if err != nil { return nil, nil, err } certPEM := new(bytes.Buffer) _ = pem.Encode(certPEM, \u0026amp;pem.Block{ Type: \u0026#34;CERTIFICATE\u0026#34;, Bytes: certBytes, }) certPrivKeyPEM := new(bytes.Buffer) _ = pem.Encode(certPrivKeyPEM, \u0026amp;pem.Block{ Type: \u0026#34;RSA PRIVATE KEY\u0026#34;, Bytes: x509.MarshalPKCS1PrivateKey(certPrivKey), }) return certPEM.Bytes(), certPrivKeyPEM.Bytes(), nil } // CreateCA create ca info func CreateCA() (*CA, error) { // set up our CA certificate ca := \u0026amp;x509.Certificate{ SerialNumber: big.NewInt(2019), Subject: pkix.Name{ Organization: []string{\u0026#34;poneding.com\u0026#34;}, Country: []string{\u0026#34;CN\u0026#34;}, Province: []string{\u0026#34;Beijing\u0026#34;}, Locality: []string{\u0026#34;Beijing\u0026#34;}, StreetAddress: []string{\u0026#34;Beijing\u0026#34;}, PostalCode: []string{\u0026#34;000000\u0026#34;}, }, NotBefore: time.Now(), NotAfter: time.Now().AddDate(99, 0, 0), IsCA: true, ExtKeyUsage: []x509.ExtKeyUsage{x509.ExtKeyUsageClientAuth, x509.ExtKeyUsageServerAuth}, KeyUsage: x509.KeyUsageDigitalSignature | x509.KeyUsageCertSign, BasicConstraintsValid: true, } // create our private and public key caPrivKey, err := rsa.GenerateKey(rand.Reader, 4096) if err != nil { return nil, err } return \u0026amp;CA{ caInfo: ca, caPrivKey: caPrivKey, }, nil } // ParseCA parse caPem func ParseCA(caPem, caKeyPem []byte) (*CA, error) { p := \u0026amp;pem.Block{} p, caPem = pem.Decode(caPem) ca, err := x509.ParseCertificate(p.Bytes) if err != nil { return nil, err } p2 := \u0026amp;pem.Block{} p2, caKeyPem = pem.Decode(caKeyPem) caKey, err := x509.ParsePKCS1PrivateKey(p2.Bytes) if err != nil { return nil, err } return \u0026amp;CA{ caInfo: ca, caPrivKey: caKey, caPem: caPem, caKeyPem: caKeyPem, }, nil } // DomainSign create cert func DomainSign(ips []string, domains ...string) ([]byte, []byte, []byte, error) { ca, err := CreateCA() if err != nil { return nil, nil, nil, err } caPem, err := ca.GetCAPem() if err != nil { return nil, nil, nil, err } certPem, certKey, err := ca.CreateCert(ips, domains...) if err != nil { return nil, nil, nil, err } return caPem, certPem, certKey, nil } Â« Golang å®ˆæŠ¤è¿›ç¨‹\nÂ» go:linkname æŒ‡ä»¤\n"},{"id":88,"href":"/go/go-linkname/","title":"Go Linkname","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / go:linkname æŒ‡ä»¤\ngo:linkname æŒ‡ä»¤ # èƒŒæ™¯ # é˜…è¯» Golang æºç æ—¶ï¼Œå‘ç°åœ¨æ ‡å‡†åº“ time.Sleep æ–¹æ³•æ²¡æœ‰æ²¡æœ‰æ–¹æ³•ä½“ã€‚å¦‚ä¸‹ï¼š\n// Sleep pauses the current goroutine for at least the duration d. // A negative or zero duration causes Sleep to return immediately. func Sleep(d Duration) å½“æˆ‘ä»¬ç›´æ¥åœ¨ä»£ç ä¸­å†™ä¸€ä¸ªç©ºæ–¹æ³• func Foo()ï¼Œç¼–è¯‘æ—¶ä¼šæŠ¥é”™ï¼šmissing function bodyã€‚æ‰€ä»¥æ ‡å‡†åº“ä½¿ç”¨äº†ä»€ä¹ˆé­”æ³•æ¥å®ç°ç©ºæ–¹æ³•çš„å‘¢ï¼Ÿ è¿›ä¸€æ­¥ç ”ç©¶ï¼Œå¾—çŸ¥ time.Sleep è¿è¡Œæ—¶å®é™…è°ƒç”¨äº† runtime.timeSleepæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š\n// timeSleep puts the current goroutine to sleep for at least ns nanoseconds. // //go:linkname timeSleep time.Sleep func timeSleep(ns int64) { if ns \u0026lt;= 0 { return } gp := getg() t := gp.timer if t == nil { t = new(timer) gp.timer = t } t.f = goroutineReady t.arg = gp t.nextwhen = nanotime() + ns if t.nextwhen \u0026lt; 0 { // check for overflow. t.nextwhen = maxWhen } gopark(resetForSleep, unsafe.Pointer(t), waitReasonSleep, traceBlockSleep, 1) } é‚£ä¹ˆè¿™æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿç»†å¿ƒä¸€ç‚¹çš„è¯ä½ å°±ä¼šå‘ç°åœ¨ runtime.timeSleep çš„æ³¨é‡Šä¸Šå‘ç° //go:linkname æŒ‡ä»¤ï¼ŒæŒ‰æˆ‘ä»¬å°±éœ€è¦èŠ±ç‚¹æ—¶é—´ç ”ç©¶ä¸€ä¸‹è¿™ä¸ªç©æ„å„¿äº†ã€‚\nä»‹ç» # go:linknameæŒ‡ä»¤çš„è§„èŒƒå¦‚ä¸‹ï¼š\n//go:linkname localname importpath.name è¿™ä¸ªæŒ‡ä»¤å®é™…æ˜¯åœ¨å‘Šè¯‰ Golang ç¼–è¯‘å™¨ï¼Œå°†æœ¬åœ°çš„å˜é‡æˆ–æ–¹æ³•ï¼ˆlocalnameï¼‰é“¾æ¥åˆ°å¯¼å…¥çš„å˜é‡æˆ–æ–¹æ³•ï¼ˆimportpath.nameï¼‰ã€‚ ç”±äºè¯¥æŒ‡ä»¤ç ´åäº†ç±»å‹ç³»ç»Ÿå’ŒåŒ…çš„æ¨¡å—åŒ–åŸåˆ™ï¼Œåªæœ‰åœ¨å¼•å…¥ unsafe åŒ…çš„å‰æä¸‹æ‰èƒ½ä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤ã€‚ å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥å…¶æ‰€ä»¥ç„¶äº†ï¼Œæˆ‘ä»¬å°è¯•æ¥å®ç°ä¸€ä¸ªâ€œç©ºæ–¹æ³•â€å§ï¼\nç¤ºä¾‹ # åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼š\nmake golinkname-demo cd golinkname-demo go mod init golinkname-demo touch main.go ç¼–å†™ main.go ä»£ç ï¼š\npackage main import ( \u0026#34;fmt\u0026#34; _ \u0026#34;unsafe\u0026#34; ) func main() { Foo() } //go:linkname Foo main.myFoo func Foo() func myFoo() { fmt.Println(\u0026#34;myFoo called\u0026#34;) } è¿è¡Œï¼š\n$ go run main.go myFoo called å®Œæˆï¼\næ‹“å±• # ä½¿ç”¨ go:linkname æ¥å¼•ç”¨ç¬¬ä¸‰æ–¹åŒ…ä¸­ç§æœ‰çš„å˜é‡å’Œæ–¹æ³•ï¼š\npackage mypkg import ( _ \u0026#34;unsafe\u0026#34; _ \u0026#34;github.com/xxx/xxx/internal\u0026#34; ) //go:linkname a github.com/xxx/xxx/internal.a var a int //go:linkname Foo github.com/xxx/xxx/internal.foo func Foo() Â« Golang ç”Ÿæˆè¯ä¹¦\nÂ» Golang åˆ—è¡¨è½¬æ ‘\n"},{"id":89,"href":"/go/go-list-to-tree/","title":"Go List to Tree","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Golang åˆ—è¡¨è½¬æ ‘\nGolang åˆ—è¡¨è½¬æ ‘ # åœºæ™¯ä»‹ç» # ä»æ•°æ®åº“è·å–åˆ°äº†èœå•åˆ—è¡¨æ•°æ®ï¼Œè¿™äº›èœå•æ•°æ®é€šè¿‡å­—æ®µ ParentID è¡¨ç¤ºçˆ¶å­å±‚çº§å…³ç³»ï¼Œç°åœ¨éœ€è¦å°†èœå•åˆ—è¡¨æ•°æ®è½¬æˆæ ‘çŠ¶çš„å®ä¾‹å¯¹è±¡ã€‚\næ•°æ®åº“å–å‡ºçš„åˆå§‹æ•°æ®ï¼š\nraw := []Menu{ {Name: \u0026#34;ä¸€çº§èœå• 1\u0026#34;, ID: 1, PID: 0}, {Name: \u0026#34;ä¸€çº§èœå• 2\u0026#34;, ID: 2, PID: 0}, {Name: \u0026#34;ä¸€çº§èœå• 3\u0026#34;, ID: 3, PID: 0}, {Name: \u0026#34;äºŒçº§èœå• 1-1\u0026#34;, ID: 11, PID: 1}, {Name: \u0026#34;äºŒçº§èœå• 1-2\u0026#34;, ID: 12, PID: 1}, {Name: \u0026#34;äºŒçº§èœå• 1-3\u0026#34;, ID: 13, PID: 1}, {Name: \u0026#34;äºŒçº§èœå• 2-1\u0026#34;, ID: 21, PID: 2}, {Name: \u0026#34;äºŒçº§èœå• 2-2\u0026#34;, ID: 22, PID: 2}, {Name: \u0026#34;äºŒçº§èœå• 2-3\u0026#34;, ID: 23, PID: 2}, } éœ€è¦å¾—åˆ°çš„ç›®æ ‡æ•°æ®ï¼š\n{ \u0026#34;name\u0026#34;:\u0026#34;æ ¹èœå•\u0026#34;, \u0026#34;id\u0026#34;:0, \u0026#34;pid\u0026#34;:0, \u0026#34;SubMenus\u0026#34;:[ { \u0026#34;name\u0026#34;:\u0026#34;ä¸€çº§èœå• 1\u0026#34;, \u0026#34;id\u0026#34;:1, \u0026#34;pid\u0026#34;:0, \u0026#34;SubMenus\u0026#34;:[ { \u0026#34;name\u0026#34;:\u0026#34;äºŒçº§èœå• 1-1\u0026#34;, \u0026#34;id\u0026#34;:11, \u0026#34;pid\u0026#34;:1 }, { \u0026#34;name\u0026#34;:\u0026#34;äºŒçº§èœå• 1-2\u0026#34;, \u0026#34;id\u0026#34;:12, \u0026#34;pid\u0026#34;:1 }, { \u0026#34;name\u0026#34;:\u0026#34;äºŒçº§èœå• 1-3\u0026#34;, \u0026#34;id\u0026#34;:13, \u0026#34;pid\u0026#34;:1 } ] }, { \u0026#34;name\u0026#34;:\u0026#34;ä¸€çº§èœå• 2\u0026#34;, \u0026#34;id\u0026#34;:2, \u0026#34;pid\u0026#34;:0, \u0026#34;SubMenus\u0026#34;:[ { \u0026#34;name\u0026#34;:\u0026#34;äºŒçº§èœå• 2-1\u0026#34;, \u0026#34;id\u0026#34;:21, \u0026#34;pid\u0026#34;:2 }, { \u0026#34;name\u0026#34;:\u0026#34;äºŒçº§èœå• 2-2\u0026#34;, \u0026#34;id\u0026#34;:22, \u0026#34;pid\u0026#34;:2 }, { \u0026#34;name\u0026#34;:\u0026#34;äºŒçº§èœå• 2-3\u0026#34;, \u0026#34;id\u0026#34;:23, \u0026#34;pid\u0026#34;:2 } ] }, { \u0026#34;name\u0026#34;:\u0026#34;ä¸€çº§èœå• 3\u0026#34;, \u0026#34;id\u0026#34;:3, \u0026#34;pid\u0026#34;:0 } ] } ä»£ç å®ç° # package main import ( \u0026#34;encoding/json\u0026#34; \u0026#34;fmt\u0026#34; ) func main() { // æ•°æ®åº“é‡Œå­˜å‚¨çš„èœå• rawMenus := []Menu{ {Name: \u0026#34;ä¸€çº§èœå• 1\u0026#34;, ID: 1, PID: 0}, {Name: \u0026#34;ä¸€çº§èœå• 2\u0026#34;, ID: 2, PID: 0}, {Name: \u0026#34;ä¸€çº§èœå• 3\u0026#34;, ID: 3, PID: 0}, {Name: \u0026#34;äºŒçº§èœå• 1-1\u0026#34;, ID: 11, PID: 1}, {Name: \u0026#34;äºŒçº§èœå• 1-2\u0026#34;, ID: 12, PID: 1}, {Name: \u0026#34;äºŒçº§èœå• 1-3\u0026#34;, ID: 13, PID: 1}, {Name: \u0026#34;äºŒçº§èœå• 2-1\u0026#34;, ID: 21, PID: 2}, {Name: \u0026#34;äºŒçº§èœå• 2-2\u0026#34;, ID: 22, PID: 2}, {Name: \u0026#34;äºŒçº§èœå• 2-3\u0026#34;, ID: 23, PID: 2}, } menu := \u0026amp;Menu{ Name: \u0026#34;æ ¹èœå•\u0026#34;, PID: 0, } for _, rm := range rawMenus { menu.setSubMenus(rm) } // æ‰“å°ç»“æœ b, _ := json.Marshal(menu) fmt.Println(string(b)) } type Menu struct { Name string `json:\u0026#34;name\u0026#34;` ID int `json:\u0026#34;id\u0026#34;` PID int `json:\u0026#34;pid\u0026#34;` SubMenus []Menu `json:\u0026#34;,omitempty\u0026#34;` } func (m *Menu) setSubMenus(menu Menu) bool { if menu.PID == m.ID { m.SubMenus = append(m.SubMenus, menu) return true } for i := range m.SubMenus { if m.SubMenus[i].setSubMenus(menu) { return true } } return false } æ³¨æ„äº‹é¡¹ # Golang for éå†ä½¿ç”¨ for _, item := range slice æ—¶ï¼Œitem æ˜¯ä¸€ä»½éå†å…ƒç´ çš„å¤åˆ¶ï¼Œè€Œä½¿ç”¨ for i := range slice æ—¶ï¼Œslice[i] åˆ™æ˜¯éå†å…ƒç´ æœ¬èº«ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„åˆ‡ç‰‡æ‰©å®¹å¸¦æ¥çš„åœ°å€å˜åŒ–é—®é¢˜ã€‚\nÂ« go:linkname æŒ‡ä»¤\nÂ» Golang å®ç°åŒå‘è®¤è¯\n"},{"id":90,"href":"/go/go-mtls/","title":"Go Mtls","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Golang å®ç°åŒå‘è®¤è¯\nGolang å®ç°åŒå‘è®¤è¯ # TLS # ä¼ è¾“å±‚å®‰å…¨åè®®ï¼ˆTLSï¼‰ï¼Œåœ¨äº’è”ç½‘ä¸Šï¼Œé€šå¸¸æ˜¯ç”±æœåŠ¡å™¨å•å‘çš„å‘å®¢æˆ·ç«¯æä¾›è¯ä¹¦ï¼Œä»¥è¯æ˜å…¶èº«ä»½ã€‚\nmTLS # åŒå‘ TLS è®¤è¯ï¼Œæ˜¯æŒ‡åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨åŒè¡ŒåŠ å¯†é€šé“ï¼ŒmTLS æ˜¯äº‘åŸç”Ÿåº”ç”¨ä¸­å¸¸ç”¨çš„é€šä¿¡å®‰å…¨åè®®ã€‚\nä½¿ç”¨åŒå‘TLSè¿æ¥çš„ä¸»è¦ç›®çš„æ˜¯å½“æœåŠ¡å™¨åº”è¯¥åªæ¥å—æ¥è‡ªæœ‰é™çš„å…è®¸çš„å®¢æˆ·ç«¯çš„ TLS è¿æ¥æ—¶ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç»„ç»‡å¸Œæœ›å°†æœåŠ¡å™¨çš„ TLS è¿æ¥é™åˆ¶ä¸ºåªæ¥è‡ªè¯¥ç»„ç»‡çš„åˆæ³•åˆä½œä¼™ä¼´æˆ–å®¢æˆ·ã€‚æ˜¾ç„¶ï¼Œä¸ºå®¢æˆ·ç«¯æ·»åŠ IPç™½åå•ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®‰å…¨å®è·µï¼Œå› ä¸ºIPå¯èƒ½è¢«æ¬ºéª—ã€‚\nä¸ºäº†ç®€åŒ– mTLS æ¡æ‰‹çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬è¿™æ ·ç®€å•æ¢³ç†ï¼š\nå®¢æˆ·ç«¯å‘é€è®¿é—®æœåŠ¡å™¨ä¸Šå—ä¿æŠ¤ä¿¡æ¯çš„è¯·æ±‚ï¼› æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æä¾›å…¬é’¥è¯ä¹¦ï¼› å®¢æˆ·ç«¯é€šè¿‡ä½¿ç”¨ CA çš„å…¬é’¥æ¥éªŒè¯æœåŠ¡å™¨å…¬é’¥è¯ä¹¦çš„æ•°å­—ç­¾åï¼Œä»¥éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ï¼› å¦‚æœæ­¥éª¤ 3 æˆåŠŸï¼Œå®¢æˆ·æœºå°†å…¶å®¢æˆ·ç«¯å…¬é’¥è¯ä¹¦å‘é€åˆ°æœåŠ¡å™¨ï¼› æœåŠ¡å™¨ä½¿ç”¨æ­¥éª¤ 3 ä¸­ç›¸åŒçš„æ–¹æ³•éªŒè¯å®¢æˆ·æœºçš„è¯ä¹¦ï¼› å¦‚æœæˆåŠŸï¼ŒæœåŠ¡å™¨å°†å¯¹å—ä¿æŠ¤ä¿¡æ¯çš„è®¿é—®æƒæˆäºˆå®¢æˆ·æœºã€‚ ä»£ç å®ç° # éœ€è¦å®ç°å®¢æˆ·ç«¯éªŒè¯æœåŠ¡ç«¯çš„å…¬é’¥è¯ä¹¦ï¼ŒæœåŠ¡ç«¯éªŒè¯å®¢æˆ·ç«¯çš„å…¬é’¥è¯ä¹¦ã€‚\nç”Ÿæˆè¯ä¹¦ # echo \u0026#39;æ¸…ç†å¹¶ç”Ÿæˆç›®å½•\u0026#39; OUT=./certs DAYS=365 RSALEN=2048 CN=poneding rm -rf ${OUT}/* mkdir ${OUT} \u0026gt;\u0026gt; /dev/null 2\u0026gt;\u0026amp;1 cd ${OUT} echo \u0026#39;ç”ŸæˆCAçš„ç§é’¥\u0026#39; openssl genrsa -out ca.key ${RSALEN} \u0026gt;\u0026gt; /dev/null 2\u0026gt;\u0026amp;1 echo \u0026#39;ç”ŸæˆCAçš„ç­¾åè¯ä¹¦\u0026#39; openssl req -new \\ -x509 \\ -key ca.key \\ -subj \u0026#34;/CN=${CN}\u0026#34; \\ -out ca.crt echo \u0026#39;\u0026#39; echo \u0026#39;ç”Ÿæˆserverç«¯ç§é’¥\u0026#39; openssl genrsa -out server.key ${RSALEN} \u0026gt;\u0026gt; /dev/null 2\u0026gt;\u0026amp;1 echo \u0026#39;ç”Ÿæˆserverç«¯è‡ªç­¾å\u0026#39; openssl req -new \\ -key server.key \\ -subj \u0026#34;/CN=${CN}\u0026#34; \\ -out server.csr echo \u0026#39;ç­¾å‘serverç«¯è¯ä¹¦\u0026#39; openssl x509 -req -sha256 \\ -in server.csr \\ -CA ca.crt -CAkey ca.key -CAcreateserial \\ -out server.crt -text \u0026gt;\u0026gt; /dev/null 2\u0026gt;\u0026amp;1 echo \u0026#39;åˆ é™¤serverç«¯è‡ªç­¾åè¯ä¹¦\u0026#39; rm server.csr echo \u0026#39;\u0026#39; echo \u0026#39;ç”Ÿæˆclientç§é’¥\u0026#39; openssl genrsa -out client.key ${RSALEN} \u0026gt;\u0026gt; /dev/null 2\u0026gt;\u0026amp;1 echo \u0026#39;ç”Ÿæˆclientè‡ªç­¾å\u0026#39; openssl req -new \\ -subj \u0026#34;/CN=${CN}\u0026#34; \\ -key client.key \\ -out client.csr echo \u0026#39;ç­¾å‘clientè¯ä¹¦\u0026#39; openssl x509 -req -sha256\\ -CA ca.crt -CAkey ca.key -CAcreateserial\\ -days ${DAYS}\\ -in client.csr\\ -out client.crt\\ -text \u0026gt;\u0026gt; /dev/null 2\u0026gt;\u0026amp;1 echo \u0026#39;åˆ é™¤clientç«¯è‡ªç­¾å\u0026#39; rm client.csr echo \u0026#39;\u0026#39; echo \u0026#39;åˆ é™¤ä¸´æ—¶æ–‡ä»¶\u0026#39; rm ca.srl echo \u0026#39;\u0026#39; echo \u0026#39;å®Œæˆ\u0026#39; æœåŠ¡ç«¯ # package main import ( \u0026#34;crypto/tls\u0026#34; \u0026#34;crypto/x509\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; \u0026#34;time\u0026#34; ) var ( caCert = \u0026#34;../../certs/ca.crt\u0026#34; serverCert = \u0026#34;../../certs/server.crt\u0026#34; serverKey = \u0026#34;../../certs/server.key\u0026#34; ) type mtlsHandler struct { } func (m *mtlsHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) { fmt.Fprintln(w, \u0026#34;Hello World! \u0026#34;, time.Now()) } func main() { pool := x509.NewCertPool() caCertBytes, err := os.ReadFile(caCert) if err != nil { panic(err) } pool.AppendCertsFromPEM(caCertBytes) server := \u0026amp;http.Server{ Addr: \u0026#34;:8443\u0026#34;, Handler: \u0026amp;mtlsHandler{}, TLSConfig: \u0026amp;tls.Config{ ClientCAs: pool, ClientAuth: tls.RequireAndVerifyClientCert, // éœ€è¦å®¢æˆ·ç«¯è¯ä¹¦ }, } log.Println(\u0026#34;server started...\u0026#34;) log.Fatalln(server.ListenAndServeTLS(serverCert, serverKey)) } å®¢æˆ·ç«¯ # package main import ( \u0026#34;crypto/tls\u0026#34; \u0026#34;crypto/x509\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; ) var ( caCert = \u0026#34;../../certs/ca.crt\u0026#34; clientCert = \u0026#34;../../certs/client.crt\u0026#34; clientKey = \u0026#34;../../certs/client.key\u0026#34; ) func main() { pool := x509.NewCertPool() caCertBytes, err := os.ReadFile(caCert) if err != nil { panic(err) } pool.AppendCertsFromPEM(caCertBytes) clientCertBytes, err := tls.LoadX509KeyPair(clientCert, clientKey) if err != nil { panic(err) } tr := \u0026amp;http.Transport{ TLSClientConfig: \u0026amp;tls.Config{ RootCAs: pool, Certificates: []tls.Certificate{clientCertBytes}, InsecureSkipVerify: true, }, } client := http.Client{ Transport: tr, } r, err := client.Get(\u0026#34;https://127.0.0.1:8443\u0026#34;) // server if err != nil { panic(err) } defer r.Body.Close() b, err := io.ReadAll(r.Body) if err != nil { panic(err) } fmt.Println(string(b)) } Â« Golang åˆ—è¡¨è½¬æ ‘\nÂ» Golang å‘å¸ƒç±»åº“ - 1\n"},{"id":91,"href":"/go/go-publish-package-01/","title":"Go Publish Package 01","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Golang å‘å¸ƒç±»åº“ - 1\nGolang å‘å¸ƒç±»åº“ - 1 # æœ¬é¡µä»‹ç»å¦‚ä½•åœ¨ Github ä¸Šå‘å¸ƒæˆ‘ä»¬è‡ªå·±çš„ Golang ç±»åº“ã€‚\n1ã€åˆ›å»º github ä»“åº“æ‰˜ç®¡ go ç±»åº“ä»£ç ï¼Œä¾‹å¦‚ common-goï¼šï¼š\n2ã€å°†ä»“åº“å…‹éš†è‡³æœ¬åœ°ï¼šï¼š\ngit clone https://github.com/poneding/common-go.git 3ã€åˆå§‹åŒ–goç±»åº“çš„moduleï¼šï¼š\ncd common-go go mod init github.com/poneding/common-go mkdir hello æ³¨æ„ï¼š\nä½¿ç”¨ go env å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å¼€å¯ go-module åŠŸèƒ½ï¼Œå¦‚æœæ²¡å¼€å¯éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼šgo env -w GO111MODULE=onï¼›\nmodule åç§°éœ€è¦ä¸ github ä»“åº“ä¸€è‡´ï¼Œè¿™æ ·å…¶ä»–äººæ‰èƒ½é€šè¿‡ go get github.com/poneding/commmon-go ä¸‹è½½åˆ°ä½ çš„ç±»åº“ã€‚\n4ã€ç¼–å†™ go ç±»åº“ä»£ç ï¼Œä¾‹å¦‚ï¼šï¼š\nhell/hello.goï¼š\npackage hello import \u0026#34;fmt\u0026#34; func Say(name string) { fmt.Printf(\u0026#34;Hello, %s\\n\u0026#34;, name) } 5ã€æäº¤ go ä»£ç åˆ° githubï¼šï¼š\ngit add . git commit -m \u0026#34;add hello\u0026#34; git push -u origin main 6ã€å‘è¡Œç‰ˆæœ¬ï¼š\næœ€ä½³å®è·µæ˜¯åˆ›å»ºå¯¹åº”çš„ç‰ˆæœ¬å‘å¸ƒåˆ†æ”¯ï¼Œç„¶åä½¿ç”¨å‘å¸ƒåˆ†æ”¯åˆ›å»º tagï¼Œå‘å¸ƒï¼š\ngit checkout -b v1 git push -u origin v1 git tag v1.0.0 git push --tags æ­¤æ—¶ï¼Œåœ¨ github ä»“åº“ release ä¸­å¯ä»¥çœ‹åˆ°å‘å¸ƒçš„ç‰ˆæœ¬ã€‚\n7ã€åˆ›å»º demo-go é¡¹ç›®ï¼Œæµ‹è¯•ä½¿ç”¨ go ç±»åº“ï¼šï¼š\ngo mod init demo-go åœ¨ go.mod å¼•å…¥ github.com/poneding/common-go@v1.0.0ï¼š\ngo.modï¼š\nmodule demo-go go 1.16 require github.com/poneding/common-go v1.0.0 è°ƒç”¨ github.com/poneding/common-go åº“çš„ hello.Say æ–¹æ³•ï¼š\nmain.goï¼š\npackage main import ( \u0026#34;github.com/poneding/common-go/hello\u0026#34; ) func main() { hello.Say(\u0026#34;Jay\u0026#34;) } 8ã€è¿è¡Œï¼šï¼š\n$ go run main.go Hello, Jay Â« Golang å®ç°åŒå‘è®¤è¯\nÂ» Golang å‘å¸ƒç±»åº“ - 2\n"},{"id":92,"href":"/go/go-publish-package-02/","title":"Go Publish Package 02","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Golang å‘å¸ƒç±»åº“ - 2\nGolang å‘å¸ƒç±»åº“ - 2 # æœ¬é¡µä»‹ç»å¦‚ä½•åœ¨ Github ä¸Šå‡çº§æˆ‘ä»¬å·²å‘å¸ƒçš„ Golang ç±»åº“ã€‚\nGo ç±»åº“ç‰ˆæœ¬è§„åˆ™ # go ç±»åº“ç‰ˆæœ¬çš„è§„åˆ™ï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·ï¼Œå…¶ä¸­ï¼š\nä¸»ç‰ˆæœ¬å·ï¼šç±»åº“è¿›è¡Œäº†ä¸å¯å‘ä¸‹å…¼å®¹çš„ä¿®æ”¹ï¼Œä¾‹å¦‚åŠŸèƒ½é‡æ„ï¼Œè¿™æ—¶å€™ä¸»ç‰ˆæœ¬å·å¾€ä¸Šè¿½åŠ ï¼› æ¬¡ç‰ˆæœ¬å·ï¼šç±»åº“è¿›è¡Œäº†å¯å‘ä¸‹å…¼å®¹çš„ä¿®æ”¹ï¼Œä¾‹å¦‚æ–°å¢åŠŸèƒ½ï¼Œè¿™æ—¶å€™æ¬¡ç‰ˆæœ¬å·å¾€ä¸Šè¿½åŠ ï¼› ä¿®è®¢å·ï¼šç±»åº“è¿›è¡Œäº†å¯å‘ä¸‹å…¼å®¹çš„ä¿®æ”¹ï¼ˆä¿®æ”¹çš„è§„æ¨¡æ›´å°ï¼‰ï¼Œä¾‹å¦‚ä¿®å¤æˆ–ä¼˜åŒ–åŠŸèƒ½ï¼Œè¿™æ—¶å€™ä¿®è®¢å¥½å¾€ä¸Šè¿½åŠ ã€‚ Go ç±»åº“å‘ç‰ˆç¤ºä¾‹ # åŒæ ·ä»¥ github.com/poneding/common-go ç±»åº“ä¸ºç¤ºä¾‹ã€‚\nå°ç‰ˆæœ¬å‡çº§ # ä¸»ç‰ˆæœ¬ä¸å‡çº§ï¼Œæ¬¡ç‰ˆæœ¬æˆ–ä¿®è®¢ç‰ˆæœ¬å‡çº§ã€‚\nv0.x.x ç‰ˆæœ¬å‡çº§è‡³ v1.x.x ä¹Ÿæ˜¯å¯ä»¥ç›´æ¥å‡çº§çš„ã€‚\nå½“å‰ç‰ˆæœ¬æ˜¯ v1.0.0ï¼Œç°å¯¹è¯¥ç±»åº“è¿›è¡Œäº†åŠŸèƒ½ä¿®æ”¹ï¼Œå‘å¸ƒ v1.0.1 ç‰ˆæœ¬ï¼š\n1ã€åˆ‡æ¢è‡³ v1 åˆ†æ”¯ï¼š\ngit checkout v1 2ã€ä¿®æ”¹ç±»åº“ä»£ç ï¼š\nhello/hello.goï¼š\npackage hello import \u0026#34;fmt\u0026#34; func Say(name string) { fmt.Printf(\u0026#34;Hello, %s\\n\u0026#34;, name) fmt.Println(\u0026#34;common-go version: v1.0.1\u0026#34;) } 3ã€æäº¤ä»£ç å¹¶å‘å¸ƒï¼š\ngit add . git commit -m \u0026#34;update hello\u0026#34; git push git tag v1.0.1 git push --tags 4ã€ä½¿ç”¨ demo-go æµ‹è¯•ï¼Œå‡çº§ç‰ˆæœ¬ï¼š\nå‡çº§ç±»åº“æ–¹å¼ï¼š\nä½¿ç”¨ go get -u github.com/poneding/common-go æˆ– go get github.com/poneding/common-go@latest å‡çº§è‡³è¯¥ä¸»ç‰ˆæœ¬å·ä¸‹æœ€æ–°ç‰ˆæœ¬ï¼› ä½¿ç”¨ go get github.com/poneding/common-go@v1.0.0 å‡çº§è‡³æŒ‡å®šç‰ˆæœ¬ã€‚ $ go get - u github.com/poneding/common-go go: downloading github.com/poneding/common-go v1.0.1 go: found github.com/poneding/common-go/hello in github.com/poneding/common-go v1.0.1 go: github.com/poneding/common-go upgrade =\u0026gt; v1.0.1 æŸ¥çœ‹ demo-go ä¸‹çš„ go.mod æ–‡ä»¶ï¼Œç¡®å®å‡çº§åˆ°äº†æ–°ç‰ˆæœ¬ï¼š\ngo.modï¼š\nmodule demo-go go 1.16 require github.com/poneding/common-go v1.0.1 5ã€è¿è¡Œæµ‹è¯•ï¼š\n$ go run main.go Hello, Jay common-go version: v1.0.1 å¤§ç‰ˆæœ¬å‡çº§ # ä¸»ç‰ˆæœ¬å‡çº§ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ go get -u github.com/poneding/common-go å‡çº§ç±»åº“ç‰ˆæœ¬æ—¶ï¼Œæ— æ³•è·¨ä¸»ç‰ˆæœ¬å‡çº§ï¼Œåªèƒ½å‡çº§è‡³å½“å‰ä¸»ç‰ˆæœ¬ä¸‹æœ€æ–°ç‰ˆæœ¬ï¼›\nv0.x.x å‡çº§è‡³ v1.x.x æ˜¯ä¸ªä¾‹å¤–ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ go get -u github.com/poneding/common-go å‘½ä»¤å‡çº§ã€‚\nå½“å‰ç‰ˆæœ¬æ˜¯ v1.0.1ï¼Œç°å¯¹è¯¥ç±»åº“è¿›è¡Œäº†åŠŸèƒ½é‡æ„ï¼Œå‘å¸ƒ v2.0.0 ç‰ˆæœ¬ï¼š\n1ã€ç»§ç»­æŒ‰ç…§æœ€ä½³å®è·µï¼Œåˆ›å»º v2 ç‰ˆæœ¬çš„åˆ†æ”¯ï¼š\ngit checkout -b v2 2ã€ä¿®æ”¹ module åç§°è‡³æ–°ç‰ˆï¼š\ngo mod edit -module github.com/poneding/common-go/v2 3ã€v2 ç‰ˆæœ¬é‡æ„åŠŸèƒ½ï¼š\nhello/hello.goï¼š\npackage hello import \u0026#34;fmt\u0026#34; func Say(firstname, lastname string) { fmt.Printf(\u0026#34;Hello, %s %s\\n\u0026#34;, firstname, lastname) fmt.Println(\u0026#34;common-go version: v2.0.0\u0026#34;) } 4ã€æäº¤ä»£ç å¹¶å‘å¸ƒï¼š\ngit add . git commit -m \u0026#34;refacte hello\u0026#34; git push -u origin v2 git tag v2.0.0 git push --tags 5ã€ä½¿ç”¨ demo-go æµ‹è¯•ï¼Œå‡çº§ç‰ˆæœ¬ï¼š\næ³¨æ„ï¼Œæ­¤æ—¶æ— æ³•é€šè¿‡ go get -u github.com/poneding/common-go å‡çº§è‡³ä¸åŒäºå½“å‰ä¸»ç‰ˆæœ¬çš„æœ€æ–°ç‰ˆæœ¬ï¼Œéœ€è¦ä½¿ç”¨ go get github.com/poneding/common-go/v2 å‡çº§ï¼š\ngo get github.com/poneding/common-go/v2 æŸ¥çœ‹ go.mod æ–‡ä»¶ï¼Œå·²ç»æ·»åŠ äº† v2 ç‰ˆæœ¬ä¾èµ–åŒ…\ngo.modï¼š\nmodule demo-go go 1.16 require github.com/poneding/common-go v1.0.1 require github.com/poneding/common-go/v2 v2.0.0 6ã€ä¿®æ”¹æµ‹è¯•ä»£ç ï¼š\nåŒæ—¶ä½¿ç”¨ v1 ç‰ˆæœ¬å’Œ v2 ç‰ˆæœ¬çš„åŒ…å‡½æ•°ï¼š\nmain.goï¼š\npackage main import ( \u0026#34;github.com/poneding/common-go/hello\u0026#34; hellov2 \u0026#34;github.com/poneding/common-go/v2/hello\u0026#34; ) func main() { hello.Say(\u0026#34;Jay\u0026#34;) hellov2.Say(\u0026#34;Jay Chou\u0026#34;) } 8ã€è¿è¡Œæµ‹è¯•ï¼š\n$ go run main.go test hello: Hello, Jay common-go version: v1.0.1 Hello, Jay Chou common-go version: v2.0.0 ä½¿ç”¨æœ¬åœ° go ç±»åº“ # å¦‚æœæœ¬åœ°çš„ go ç±»åº“æš‚æœªç»´æŠ¤åˆ°è¿œç«¯ï¼Œå¦‚ä½•å¼•ç”¨æœ¬åœ°ç±»åº“çš„åŒ…å‘¢ï¼Ÿ\nåœ¨ go.mod æ–‡ä»¶ä¸­ä½¿ç”¨ replace å¼•ç”¨æœ¬åœ° go ç±»åº“ï¼Œè¿™ä¸ªæ–¹å¼æœ‰æ—¶å€™æ›´æ–¹ä¾¿äºå¼€å‘ã€‚\ncommon-go çš„ module åç§°ä¸º github.com/poneding/common-go\nreplace ä½¿ç”¨ go ç±»åº“ç›¸å¯¹è·¯å¾„æ›¿æ¢ module çš„å¼•ç”¨\nä»¥ä¸‹ç¤ºä¾‹å°† go ç±»åº“çš„å¼•ç”¨åˆ‡æ¢ä¸ºæœ¬åœ°å¼•ç”¨ã€‚\ngo.modï¼š\nmodule demo-go go 1.16 require ( github.com/poneding/common-go v1.0.1 github.com/poneding/common-go/v2 v2.0.0 ) replace ( github.com/poneding/common-go/v2 =\u0026gt; ../common-go ) ç”±äºæ˜¯æœ¬åœ°å¼•ç”¨ï¼Œç‰ˆæœ¬å·åªéœ€åœ¨ä¸»ç‰ˆæœ¬å·çš„èŒƒå›´å†…å³å¯ã€‚\nç»“æŸè¯­ # ä¸»ç‰ˆæœ¬å‡çº§ä¼šç»™ä»£ç çš„ç»´æŠ¤å’Œç‰ˆæœ¬çš„ç»´æŠ¤å¢åŠ éš¾åº¦ï¼Œå¹¶ä¸”éœ€è¦ä¸‹æ¸¸ç”¨æˆ·è¿ç§»ç‰ˆæœ¬ã€‚æœ€å¥½æ˜¯å½“å­˜åœ¨ä»¤äººä¿¡æœçš„åŸå› æ—¶æ‰å¯¹ç±»åº“ä¸»ç‰ˆæœ¬è¿›è¡Œå‡çº§ï¼Œä¾‹å¦‚ä¸ºäº†ä¼˜åŒ–ä»£ç å¤§è§„æ¨¡é‡æ„ã€‚\nÂ« Golang å‘å¸ƒç±»åº“ - 1\nÂ» Go ç¨‹åº SOLID è®¾è®¡åŸåˆ™\n"},{"id":93,"href":"/go/go-solid/","title":"Go Solid","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Go ç¨‹åº SOLID è®¾è®¡åŸåˆ™\nGo ç¨‹åº SOLID è®¾è®¡åŸåˆ™ # å¯é‡ç”¨è½¯ä»¶è®¾è®¡çš„äº”ä¸ªåŸåˆ™ï¼ŒSOLID åŸåˆ™ï¼š\nå•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼‰ å¼€æ”¾ / å°é—­åŸåˆ™ï¼ˆOpen / Closed Principleï¼‰ é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰ æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰ ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principleï¼‰ å•ä¸€èŒè´£åŸåˆ™ # SOLID çš„ç¬¬ä¸€ä¸ªåŸåˆ™ï¼ŒSï¼Œæ˜¯å•ä¸€è´£ä»»åŸåˆ™ã€‚\nA class should have one, and only one, reason to change. â€“ Robert C Martin\nç°åœ¨ Go æ˜¾ç„¶æ²¡æœ‰ classses - ç›¸åï¼Œæˆ‘ä»¬æœ‰æ›´å¼ºå¤§çš„ç»„åˆæ¦‚å¿µ - ä½†æ˜¯å¦‚æœä½ èƒ½å›é¡¾ä¸€ä¸‹ class è¿™ä¸ªè¯çš„ç”¨æ³•ï¼Œæˆ‘è®¤ä¸ºæ­¤æ—¶ä¼šæœ‰ä¸€å®šä»·å€¼ã€‚\nä¸ºä»€ä¹ˆä¸€æ®µä»£ç åªæœ‰ä¸€ä¸ªæ”¹å˜çš„åŸå› å¾ˆé‡è¦ï¼Ÿå—¯ï¼Œå°±åƒä½ è‡ªå·±çš„ä»£ç å¯èƒ½ä¼šæ”¹å˜ä¸€æ ·ä»¤äººæ²®ä¸§ï¼Œå‘ç°æ‚¨çš„ä»£ç æ‰€ä¾èµ–çš„ä»£ç åœ¨æ‚¨è„šä¸‹å‘ç”Ÿå˜åŒ–æ›´ç—›è‹¦ã€‚å½“ä½ çš„ä»£ç å¿…é¡»æ”¹å˜æ—¶ï¼Œå®ƒåº”è¯¥å“åº”ç›´æ¥åˆºæ¿€ä½œå‡ºæ”¹å˜ï¼Œè€Œä¸åº”è¯¥æˆä¸ºé™„å¸¦æŸå®³çš„å—å®³è€…ã€‚\nå› æ­¤ï¼Œå…·æœ‰å•ä¸€è´£ä»»çš„ä»£ç ä¿®æ”¹çš„åŸå› æœ€å°‘ã€‚\nè€¦åˆå’Œå†…èš # æè¿°æ”¹å˜ä¸€ä¸ªè½¯ä»¶æ˜¯å¤šä¹ˆå®¹æ˜“æˆ–å›°éš¾çš„ä¸¤ä¸ªè¯æ˜¯ï¼šè€¦åˆå’Œå†…èšã€‚\nè€¦åˆåªæ˜¯ä¸€ä¸ªè¯ï¼Œæè¿°äº†ä¸¤ä¸ªä¸€èµ·å˜åŒ–çš„ä¸œè¥¿ â€”â€” ä¸€ä¸ªè¿åŠ¨è¯±å¯¼å¦ä¸€ä¸ªè¿åŠ¨ã€‚ ä¸€ä¸ªç›¸å…³ä½†ç‹¬ç«‹çš„æ¦‚å¿µæ˜¯å†…èšï¼Œä¸€ç§ç›¸äº’å¸å¼•çš„åŠ›é‡ã€‚ åœ¨è½¯ä»¶ä¸Šä¸‹æ–‡ä¸­ï¼Œå†…èšæ˜¯æè¿°ä»£ç ç‰‡æ®µä¹‹é—´è‡ªç„¶ç›¸äº’å¸å¼•çš„ç‰¹æ€§ã€‚\nä¸ºäº†æè¿° Go ç¨‹åºä¸­è€¦åˆå’Œå†…èšçš„å•å…ƒï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå°†è°ˆè°ˆå‡½æ•°å’Œæ–¹æ³•ï¼Œè¿™åœ¨è®¨è®º SRP æ—¶å¾ˆå¸¸è§ï¼Œä½†æ˜¯æˆ‘ç›¸ä¿¡å®ƒå§‹äº Go çš„ package æ¨¡å‹ã€‚\nåº“åç§°çš„è®¾è®¡ # åœ¨ Go ä¸­ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½åœ¨æŸä¸ª package ä¸­ï¼Œä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ package ä»å…¶åç§°å¼€å§‹ã€‚åŒ…çš„åç§°æ—¢æ˜¯å…¶ç”¨é€”çš„æè¿°ï¼Œä¹Ÿæ˜¯åç§°ç©ºé—´å‰ç¼€ã€‚Go æ ‡å‡†åº“ä¸­çš„ä¸€äº›ä¼˜ç§€ package ç¤ºä¾‹ï¼š\nnet/http - æä¾› http å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ os/exec - æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ encoding/json - å®ç° JSON æ–‡æ¡£çš„ç¼–ç å’Œè§£ç  å½“ä½ åœ¨è‡ªå·±çš„å†…éƒ¨ä½¿ç”¨å¦ä¸€ä¸ª pakcage çš„ symbols æ—¶ï¼Œè¦ä½¿ç”¨ import å£°æ˜ï¼Œå®ƒåœ¨ä¸¤ä¸ª package ä¹‹é—´å»ºç«‹ä¸€ä¸ªæºä»£ç çº§çš„è€¦åˆã€‚ ä»–ä»¬ç°åœ¨å½¼æ­¤çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ã€‚ ç³Ÿç³•çš„åº“åç§° # è¿™ç§å¯¹åå­—çš„å…³æ³¨å¯ä¸æ˜¯è¿‚è…ã€‚å‘½åä¸ä½³çš„ package å¦‚æœçœŸçš„æœ‰ç”¨é€”ï¼Œä¼šå¤±å»ç½—åˆ—å…¶ç”¨é€”çš„æœºä¼šã€‚\nserver package æä¾›ä»€ä¹ˆï¼Ÿ â€¦, å—¯ï¼Œå¸Œæœ›æ˜¯æœåŠ¡ç«¯ï¼Œä½†æ˜¯å®ƒä½¿ç”¨å“ªç§åè®®ï¼Ÿ private package æä¾›ä»€ä¹ˆï¼Ÿæˆ‘ä¸åº”è¯¥çœ‹åˆ°çš„ä¸œè¥¿ï¼Ÿå®ƒåº”è¯¥æœ‰å…¬å…±ç¬¦å·å—ï¼Ÿ common packageï¼Œå’Œå®ƒçš„ä¼´å„¿ utils package ä¸€æ ·ï¼Œç»å¸¸è¢«å‘ç°å’Œå…¶ä»–â€™ä¼™ä¼´â€™ä¸€èµ·å‘ç° æˆ‘ä»¬çœ‹åˆ°æ‰€æœ‰åƒè¿™æ ·çš„åŒ…è£¹ï¼Œå°±æˆäº†å„ç§å„æ ·çš„åƒåœ¾åœºï¼Œå› ä¸ºå®ƒä»¬æœ‰è®¸å¤šè´£ä»»ï¼Œæ‰€ä»¥ç»å¸¸æ¯«æ— ç†ç”±åœ°æ”¹å˜ã€‚ Unix è®¾è®¡ç†å¿µ # åœ¨æˆ‘çœ‹æ¥ï¼Œå¦‚æœä¸æåŠ Doug McIlroy çš„ Unix å“²å­¦ï¼Œä»»ä½•å…³äºè§£è€¦è®¾è®¡çš„è®¨è®ºéƒ½å°†æ˜¯ä¸å®Œæ•´çš„ï¼›å°è€Œé”‹åˆ©çš„å·¥å…·ç»“åˆèµ·æ¥ï¼Œè§£å†³æ›´å¤§çš„ä»»åŠ¡ï¼Œé€šå¸¸æ˜¯åŸå§‹ä½œè€…æ— æ³•æƒ³è±¡çš„ä»»åŠ¡ã€‚\næˆ‘è®¤ä¸º Go package ä½“ç°äº† Unix å“²å­¦çš„ç²¾ç¥ã€‚å®é™…ä¸Šï¼Œæ¯ä¸ª Go package æœ¬èº«å°±æ˜¯ä¸€ä¸ªå°çš„ Go ç¨‹åºï¼Œä¸€ä¸ªå•ä¸€çš„å˜æ›´å•å…ƒï¼Œå…·æœ‰å•ä¸€çš„è´£ä»»ã€‚\nå¼€æ”¾ / å°é—­åŸåˆ™ # ç¬¬äºŒä¸ªåŸåˆ™ï¼Œå³ Oï¼Œæ˜¯ Bertrand Meyer çš„å¼€æ”¾ / å°é—­åŸåˆ™ï¼Œä»–åœ¨ 1988 å¹´å†™é“ï¼š\nSoftware entities should be open for extension, but closed for modification. â€“ Bertrand Meyer, Object-Oriented Software Construction\nè¯¥å»ºè®®å¦‚ä½•é€‚ç”¨äº 21 å¹´åå†™çš„è¯­è¨€ï¼Ÿ\npackage main type A struct { year int } func (a A) Greet() { fmt.Println(\u0026#34;Hello GolangUK\u0026#34;, a.year) } type B struct { A } func (b B) Greet() { fmt.Println(\u0026#34;Welcome to GolangUK\u0026#34;, b.year) } func main() { var a A a.year = 2016 var b B b.year = 2016 a.Greet() // Hello GolangUK 2016 b.Greet() // Welcome to GolangUK 2016 } æˆ‘ä»¬æœ‰ä¸€ä¸ªç±»å‹ A ï¼Œæœ‰ä¸€ä¸ªå­—æ®µ year å’Œä¸€ä¸ªæ–¹æ³• Greetã€‚æˆ‘ä»¬æœ‰ç¬¬äºŒç§ç±»å‹ï¼ŒB å®ƒåµŒå…¥äº†ä¸€ä¸ª Aï¼Œå› ä¸º A åµŒå…¥ï¼Œå› æ­¤è°ƒç”¨è€…çœ‹åˆ° B çš„æ–¹æ³•è¦†ç›–äº† A çš„æ–¹æ³•ã€‚å› ä¸º A ä½œä¸ºå­—æ®µåµŒå…¥ B ï¼ŒB å¯ä»¥æä¾›è‡ªå·±çš„ Greet æ–¹æ³•ï¼Œæ©ç›–äº† A çš„ Greet æ–¹æ³•ã€‚\nä½†åµŒå…¥ä¸ä»…é€‚ç”¨äºæ–¹æ³•ï¼Œè¿˜å¯ä»¥è®¿é—®åµŒå…¥ç±»å‹çš„å­—æ®µã€‚å¦‚æ‚¨æ‰€è§ï¼Œå› ä¸º A å’Œ B éƒ½åœ¨åŒä¸€ä¸ªåŒ…ä¸­å®šä¹‰ï¼Œæ‰€ä»¥ B å¯ä»¥è®¿é—® A çš„ç§æœ‰ year å­—æ®µï¼Œå°±åƒåœ¨ B ä¸­å£°æ˜ä¸€æ ·ã€‚\nå› æ­¤åµŒå…¥æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå…è®¸ Go çš„ç±»å‹å¯¹æ‰©å±•å¼€æ”¾ã€‚\npackage main type Cat struct { Name string } func (c Cat) Legs() int { return 4 } func (c Cat) PrintLegs() { fmt.Printf(\u0026#34;I have %d legs.\u0026#34;, c.Legs()) } type OctoCat struct { Cat } func (o OctoCat) Legs() int { return 5 } func main() { var octo OctoCat fmt.Println(octo.Legs()) // 5 octo.PrintLegs() // I have 4 legs } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª Cat ç±»å‹ï¼Œå¯ä»¥ç”¨å®ƒçš„ Legs æ–¹æ³•è®¡ç®—å®ƒçš„è…¿æ•°ã€‚æˆ‘ä»¬å°† Cat ç±»å‹åµŒå…¥åˆ°ä¸€ä¸ªæ–°ç±»å‹ OctoCat ä¸­ï¼Œå¹¶å£°æ˜ Octocats æœ‰äº”æ¡è…¿ã€‚ä½†æ˜¯ï¼Œè™½ç„¶ OctoCat å®šä¹‰äº†è‡ªå·±çš„ Legs æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å› 5ï¼Œä½†æ˜¯å½“è°ƒç”¨ PrintLegs æ–¹æ³•æ—¶ï¼Œå®ƒè¿”å› 4ã€‚\nè¿™æ˜¯å› ä¸º PrintLegs æ˜¯åœ¨ Cat ç±»å‹ä¸Šå®šä¹‰çš„ã€‚ å®ƒéœ€è¦ Cat ä½œä¸ºå®ƒçš„æ¥æ”¶å™¨ï¼Œå› æ­¤å®ƒä¼šå‘é€åˆ° Cat çš„ Legs æ–¹æ³•ã€‚Cat ä¸çŸ¥é“å®ƒåµŒå…¥çš„ç±»å‹ï¼Œå› æ­¤åµŒå…¥æ—¶ä¸èƒ½æ”¹å˜å…¶æ–¹æ³•é›†ã€‚\nå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¯´ Go çš„ç±»å‹è™½ç„¶å¯¹æ‰©å±•å¼€æ”¾ï¼Œä½†å¯¹ä¿®æ”¹æ˜¯å°é—­çš„ã€‚\näº‹å®ä¸Šï¼ŒGo ä¸­çš„æ–¹æ³•åªä¸è¿‡æ˜¯å›´ç»•åœ¨å…·æœ‰é¢„å…ˆå£°æ˜å½¢å¼å‚æ•°ï¼ˆå³æ¥æ”¶å™¨ï¼‰çš„å‡½æ•°çš„è¯­æ³•ç³–ã€‚\nfunc (c Cat) PrintLegs() { fmt.Printf(\u0026#34;I have %d legs.\u0026#34;, c.Legs()) } func PrintLegs(c Cat) { fmt.Printf(\u0026#34;I have %d legs.\u0026#34;, c.Legs()) } æ¥æ”¶å™¨æ­£æ˜¯ä½ ä¼ å…¥å®ƒçš„å‡½æ•°ï¼Œå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¹¶ä¸”å› ä¸º Go ä¸æ”¯æŒå‡½æ•°é‡è½½ï¼ŒOctoCat ä¸èƒ½æ›¿ä»£æ™®é€šçš„ Cat ã€‚ è¿™è®©æˆ‘æƒ³åˆ°äº†ä¸‹ä¸€ä¸ªåŸåˆ™ã€‚\né‡Œæ°æ›¿æ¢åŸåˆ™ # ç”± Barbara Liskov æå‡ºçš„é‡Œæ°æ›¿æ¢åŸåˆ™ç²—ç•¥åœ°æŒ‡å‡ºï¼Œå¦‚æœä¸¤ç§ç±»å‹è¡¨ç°å‡ºçš„è¡Œä¸ºä½¿å¾—è°ƒç”¨è€…æ— æ³•åŒºåˆ†ï¼Œåˆ™è¿™ä¸¤ç§ç±»å‹æ˜¯å¯æ›¿ä»£çš„ã€‚\nåœ¨åŸºäºç±»çš„è¯­è¨€ä¸­ï¼Œé‡Œæ°æ›¿æ¢åŸåˆ™é€šå¸¸è¢«è§£é‡Šä¸ºï¼Œå…·æœ‰å„ç§å…·ä½“å­ç±»å‹çš„æŠ½è±¡åŸºç±»çš„è§„èŒƒã€‚ ä½†æ˜¯ Go æ²¡æœ‰ç±»æˆ–ç»§æ‰¿ï¼Œå› æ­¤æ— æ³•æ ¹æ®æŠ½è±¡ç±»å±‚æ¬¡ç»“æ„å®ç°æ›¿æ¢ã€‚\nInterfaces # ç›¸åï¼Œæ›¿æ¢æ˜¯ Go æ¥å£çš„èŒƒå›´ã€‚åœ¨ Go ä¸­ï¼Œç±»å‹ä¸éœ€è¦æŒ‡å®šå®ƒä»¬å®ç°ç‰¹å®šæ¥å£ï¼Œè€Œæ˜¯ä»»ä½•ç±»å‹å®ç°æ¥å£ï¼Œåªè¦å®ƒå…·æœ‰ç­¾åä¸æ¥å£å£°æ˜åŒ¹é…çš„æ–¹æ³•ã€‚\næˆ‘ä»¬è¯´åœ¨ Go ä¸­ï¼Œæ¥å£æ˜¯éšå¼åœ°è€Œä¸æ˜¯æ˜¾å¼åœ°æ»¡è¶³çš„ï¼Œè¿™å¯¹å®ƒä»¬åœ¨è¯­è¨€ä¸­çš„ä½¿ç”¨æ–¹å¼äº§ç”Ÿäº†æ·±è¿œçš„å½±å“ã€‚\nè®¾è®¡è‰¯å¥½çš„æ¥å£æ›´å¯èƒ½æ˜¯å°å‹æ¥å£ï¼›æµè¡Œçš„åšæ³•æ˜¯ä¸€ä¸ªæ¥å£åªåŒ…å«ä¸€ä¸ªæ–¹æ³•ã€‚ä»é€»è¾‘ä¸Šè®²ï¼Œå°æ¥å£ä½¿å®ç°å˜å¾—ç®€å•ï¼Œåä¹‹åˆ™å¾ˆéš¾ã€‚å› æ­¤å½¢æˆäº†ç”±æ™®é€šè¡Œä¸ºçš„ç®€å•å®ç°ç»„æˆçš„ packageã€‚\nio.Reader # type Reader interface { // Read reads up to len(buf) bytes into buf. Read(buf []byte) (n int, err error) } è¿™ä»¤æˆ‘å¾ˆå®¹æ˜“æƒ³åˆ°äº†æˆ‘æœ€å–œæ¬¢çš„ Go æ¥å£ io.Readerã€‚\nio.Reader æ¥å£éå¸¸ç®€å•ï¼› Read å°†æ•°æ®è¯»å…¥æä¾›çš„ç¼“å†²åŒºï¼Œå¹¶å°†è¯»å–çš„å­—èŠ‚æ•°å’Œè¯»å–æœŸé—´é‡åˆ°çš„ä»»ä½•é”™è¯¯è¿”å›ç»™è°ƒç”¨è€…ã€‚çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†éå¸¸å¼ºå¤§ã€‚\nå› ä¸º io.Reader å¯ä»¥å¤„ç†ä»»ä½•è¡¨ç¤ºä¸ºå­—èŠ‚æµçš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å‡ ä¹å¯ä»¥åœ¨ä»»ä½•ä¸œè¥¿ä¸Šåˆ›å»º Reader; å¸¸é‡å­—ç¬¦ä¸²ï¼Œå­—èŠ‚æ•°ç»„ï¼Œæ ‡å‡†è¾“å…¥ï¼Œç½‘ç»œæµï¼Œgzip çš„ tar æ–‡ä»¶ï¼Œé€šè¿‡ ssh è¿œç¨‹æ‰§è¡Œçš„å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºã€‚\nå¹¶ä¸”æ‰€æœ‰è¿™äº›å®ç°éƒ½å¯ä»¥äº’ç›¸æ›¿ä»£ï¼Œå› ä¸ºå®ƒä»¬å®ç°äº†ç›¸åŒçš„ç®€å•å¥‘çº¦ã€‚\nå› æ­¤ï¼Œé€‚ç”¨äº Go çš„é‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œå¯ä»¥é€šè¿‡å·²æ•… Jim Weirich çš„æ ¼è¨€æ¥æ¦‚æ‹¬ã€‚\nRequire no more, promise no less. â€“ Jim Weirich\næ¥å£éš”ç¦»åŸåˆ™ # ç¬¬å››ä¸ªåŸåˆ™æ˜¯æ¥å£éš”ç¦»åŸåˆ™ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š\nClients should not be forced to depend on methods they do not use. â€“Robert C. Martin\nåœ¨ Go ä¸­ï¼Œæ¥å£éš”ç¦»åŸåˆ™çš„åº”ç”¨å¯ä»¥æŒ‡çš„æ˜¯ï¼Œéš”ç¦»åŠŸèƒ½å®Œæˆå…¶å·¥ä½œæ‰€éœ€çš„è¡Œä¸ºçš„è¿‡ç¨‹ã€‚ä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘å·²ç»å®Œæˆäº†â€˜ç¼–å†™ä¸€ä¸ªå°† Document ç»“æ„ä¿å­˜åˆ°ç£ç›˜çš„å‡½æ•°â€™çš„ä»»åŠ¡ã€‚\n// Save writes the contents of doc to the file f. func Save(f *os.File, doc *Document) error æˆ‘å¯ä»¥å®šä¹‰æ­¤å‡½æ•°ï¼Œè®©æˆ‘ä»¬ç§°ä¹‹ä¸º Saveï¼Œå®ƒå°†ç»™å®šçš„ Document å†™å…¥åˆ° *os.Fileã€‚ ä½†æ˜¯è¿™æ ·åšä¼šæœ‰ä¸€äº›é—®é¢˜ã€‚\nSave çš„ç­¾åæ’é™¤äº†å°†æ•°æ®å†™å…¥ç½‘ç»œä½ç½®çš„é€‰é¡¹ã€‚å‡è®¾ç½‘ç»œå­˜å‚¨å¯èƒ½ä»¥åæˆä¸ºéœ€æ±‚ï¼Œæ­¤åŠŸèƒ½çš„ç­¾åå¿…é¡»æ”¹å˜ï¼Œå¹¶å½±å“å…¶æ‰€æœ‰è°ƒç”¨è€…ã€‚\nç”±äº Save ç›´æ¥æ“ä½œç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œå› æ­¤æµ‹è¯•èµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚è¦éªŒè¯å…¶æ“ä½œï¼Œæµ‹è¯•å¿…é¡»åœ¨å†™å…¥åè¯»å–æ–‡ä»¶çš„å†…å®¹ã€‚ æ­¤å¤–ï¼Œæµ‹è¯•å¿…é¡»ç¡®ä¿å°† f å†™å…¥ä¸´æ—¶ä½ç½®å¹¶éšåå°†å…¶åˆ é™¤ã€‚\n*os.File è¿˜å®šä¹‰äº†è®¸å¤šä¸ Save æ— å…³çš„æ–¹æ³•ï¼Œæ¯”å¦‚è¯»å–ç›®å½•å¹¶æ£€æŸ¥è·¯å¾„æ˜¯å¦æ˜¯æ–‡ä»¶é“¾æ¥ã€‚ å¦‚æœ Save å‡½æ•°çš„ç­¾åèƒ½åªæè¿° *os.File ç›¸å…³çš„éƒ¨åˆ†ï¼Œå°†ä¼šå¾ˆå®ç”¨ã€‚\næˆ‘ä»¬å¦‚ä½•å¤„ç†è¿™äº›é—®é¢˜å‘¢ï¼Ÿ\n// Save writes the contents of doc to the supplied ReadWriterCloser. func Save(rwc io.ReadWriteCloser, doc *Document) error ä½¿ç”¨ io.ReadWriteCloser æˆ‘ä»¬å¯ä»¥åº”ç”¨æ¥å£éš”ç¦»åŸåˆ™ï¼Œä½¿ç”¨æ›´é€šç”¨çš„æ–‡ä»¶ç±»å‹çš„æ¥å£æ¥é‡æ–°å®šä¹‰ Saveã€‚\né€šè¿‡æ­¤æ›´æ”¹ï¼Œä»»ä½•å®ç°äº† io.ReadWriteCloser æ¥å£çš„ç±»å‹éƒ½å¯ä»¥ä»£æ›¿ä¹‹å‰çš„ *os.Fileã€‚ä½¿å¾— Save åº”ç”¨ç¨‹åºæ›´å¹¿æ³›ï¼Œå¹¶å‘ Save è°ƒç”¨è€…é˜æ˜ï¼Œ*os.File ç±»å‹çš„å“ªäº›æ–¹æ³•ä¸æ“ä½œç›¸å…³ã€‚\nåšä¸º Save çš„ç¼–å†™è€…ï¼Œæˆ‘ä¸å†å¯ä»¥é€‰æ‹©è°ƒç”¨ *os.File çš„é‚£äº›ä¸ç›¸å…³çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒéšè—åœ¨ io.ReadWriteCloser æ¥å£èƒŒåã€‚æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥é‡‡ç”¨æ¥å£éš”ç¦»åŸç†ã€‚\né¦–å…ˆï¼Œå¦‚æœ Save éµå¾ªå•ä¸€è´£ä»»åŸåˆ™ï¼Œå®ƒå°†ä¸å¯èƒ½è¯»å–å®ƒåˆšåˆšç¼–å†™çš„æ–‡ä»¶æ¥éªŒè¯å…¶å†…å®¹ - è¿™åº”è¯¥æ˜¯å¦ä¸€æ®µä»£ç çš„è´£ä»»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬ä¼ é€’ç»™ Save çš„æ¥å£çš„è§„èŒƒç¼©å°ï¼Œä»…å†™å…¥å’Œå…³é—­ã€‚\n// Save writes the contents of doc to the supplied WriteCloser. func Save(wc io.WriteCloser, doc *Document) error å…¶æ¬¡ï¼Œé€šè¿‡å‘ Save æä¾›ä¸€ä¸ªå…³é—­å…¶æµçš„æœºåˆ¶ï¼Œæˆ‘ä»¬ç»§ç»­è¿™ç§æœºåˆ¶ä»¥ä½¿å…¶çœ‹èµ·æ¥åƒæ–‡ä»¶ç±»å‹çš„ä¸œè¥¿ï¼Œè¿™å°±äº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œwc ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å…³é—­ã€‚Save å¯èƒ½ä¼šæ— æ¡ä»¶åœ°è°ƒç”¨ Closeï¼ŒæŠ‘æˆ–åœ¨æˆåŠŸçš„æƒ…å†µä¸‹è°ƒç”¨ Closeã€‚\nè¿™ç»™ Save çš„è°ƒç”¨è€…å¸¦æ¥äº†é—®é¢˜ï¼Œå› ä¸ºå®ƒå¯èƒ½å¸Œæœ›åœ¨å†™å…¥æ–‡æ¡£ä¹‹åå°†å…¶ä»–æ•°æ®å†™å…¥æµã€‚\ntype NopCloser struct { io.Writer } // Close has no effect on the underlying writer. func (c *NopCloser) Close() error { return nil } ä¸€ä¸ªç²—ç•¥çš„è§£å†³æ–¹æ¡ˆæ˜¯å®šä¹‰ä¸€ä¸ªæ–°ç±»å‹ï¼Œå®ƒåµŒå…¥ä¸€ä¸ª io.Writer å¹¶è¦†ç›– Close æ–¹æ³•ï¼Œä»¥é˜»æ­¢ Save æ–¹æ³•å…³é—­åº•å±‚æ•°æ®æµã€‚\nä½†è¿™æ ·å¯èƒ½ä¼šè¿åé‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œå› ä¸º NopCloser å®é™…ä¸Šå¹¶æ²¡æœ‰å…³é—­ä»»ä½•ä¸œè¥¿ã€‚\n// Save writes the contents of doc to the supplied Writer. func Save(w io.Writer, doc *Document) error ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯é‡æ–°å®šä¹‰ Save åªæ¥æ”¶ io.Writerï¼Œå®Œå…¨å‰¥ç¦»å®ƒé™¤äº†å°†æ•°æ®å†™å…¥æµä¹‹å¤–åšä»»ä½•äº‹æƒ…çš„è´£ä»»ã€‚\né€šè¿‡åº”ç”¨æ¥å£éš”ç¦»åŸåˆ™ï¼Œæˆ‘ä»¬çš„ Save åŠŸèƒ½ï¼ŒåŒæ—¶å¾—åˆ°äº†ä¸€ä¸ªåœ¨éœ€æ±‚æ–¹é¢æœ€å…·ä½“çš„å‡½æ•° - å®ƒåªéœ€è¦ä¸€ä¸ªå¯å†™çš„å‚æ•° - å¹¶ä¸”å…·æœ‰æœ€é€šç”¨çš„åŠŸèƒ½ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Save ä¿å­˜æˆ‘ä»¬çš„æ•°æ®åˆ°ä»»ä½•ä¸€ä¸ªå®ç° io.Writer çš„åœ°æ–¹ã€‚\nA great rule of thumb for Go is accept interfaces, return structs. â€“ Jack Lindamood\né€€ä¸€æ­¥è¯´ï¼Œè¿™å¥è¯æ˜¯ä¸€ä¸ªæœ‰è¶£çš„æ¨¡å› ï¼Œåœ¨è¿‡å»çš„å‡ å¹´é‡Œï¼Œå®ƒæ¸—é€å…¥ Go æ€æ½®ã€‚\nè¿™ä¸ªæ¨ç‰¹å¤§å°çš„ç‰ˆæœ¬ç¼ºä¹ç»†èŠ‚ï¼Œè¿™ä¸æ˜¯ Jack çš„é”™ï¼Œä½†æˆ‘è®¤ä¸ºå®ƒä»£è¡¨äº†ç¬¬ä¸€ä¸ªæ­£å½“æœ‰ç†çš„ Go è®¾è®¡ä¼ ç»Ÿ\nä¾èµ–å€’ç½®åŸåˆ™ # æœ€åä¸€ä¸ª SOLID åŸåˆ™æ˜¯ä¾èµ–å€’ç½®åŸåˆ™ï¼Œè¯¥åŸåˆ™æŒ‡å‡ºï¼š\nHigh-level modules should not depend on low-level modules. Both should depend on abstractions. Abstractions should not depend on details. Details should depend on abstractions. â€“ Robert C. Martin\nä½†æ˜¯ï¼Œå¯¹äº Go ç¨‹åºå‘˜æ¥è¯´ï¼Œä¾èµ–å€’ç½®åœ¨å®è·µä¸­æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ\nå¦‚æœæ‚¨å·²ç»åº”ç”¨äº†æˆ‘ä»¬ä¹‹å‰è°ˆåˆ°çš„æ‰€æœ‰åŸåˆ™ï¼Œé‚£ä¹ˆæ‚¨çš„ä»£ç åº”è¯¥å·²ç»è¢«åˆ†è§£ä¸ºç¦»æ•£åŒ…ï¼Œæ¯ä¸ªåŒ…éƒ½æœ‰ä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„è´£ä»»æˆ–ç›®çš„ã€‚æ‚¨çš„ä»£ç åº”è¯¥æ ¹æ®æ¥å£æè¿°å…¶ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”åº”è¯¥è€ƒè™‘è¿™äº›æ¥å£ä»¥ä»…æè¿°è¿™äº›å‡½æ•°æ‰€éœ€çš„è¡Œä¸ºã€‚ æ¢å¥è¯è¯´ï¼Œé™¤æ­¤ä¹‹å¤–æ²¡ä»€ä¹ˆåº”è¯¥è¦åšçš„ã€‚\næ‰€ä»¥æˆ‘è®¤ä¸ºï¼Œåœ¨ Go çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒMartin æ‰€æŒ‡çš„æ˜¯ import graph çš„ç»“æ„ã€‚\nåœ¨ Go ä¸­ï¼Œimport graph å¿…é¡»æ˜¯éå¾ªç¯çš„ã€‚ ä¸éµå®ˆè¿™ç§éå¾ªç¯è¦æ±‚å°†å¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼Œä½†æ›´ä¸ºä¸¥é‡åœ°æ˜¯å®ƒä»£è¡¨è®¾è®¡ä¸­å­˜åœ¨ä¸¥é‡é”™è¯¯ã€‚\nåœ¨æ‰€æœ‰æ¡ä»¶ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œç²¾å¿ƒè®¾è®¡çš„ Go ç¨‹åºçš„ import graph åº”è¯¥æ˜¯å®½çš„ï¼Œç›¸å¯¹å¹³å¦çš„ï¼Œè€Œä¸æ˜¯é«˜è€Œçª„çš„ã€‚ å¦‚æœä½ æœ‰ä¸€ä¸ª packageï¼Œå…¶å‡½æ•°æ— æ³•åœ¨ä¸å€ŸåŠ©å¦ä¸€ä¸ª package çš„æƒ…å†µä¸‹è¿è¡Œï¼Œé‚£ä¹ˆè¿™æˆ–è®¸è¡¨æ˜ä»£ç æ²¡æœ‰å¾ˆå¥½åœ°æ²¿ pakcage è¾¹ç•Œåˆ†è§£ã€‚\nä¾èµ–å€’ç½®åŸåˆ™é¼“åŠ±æ‚¨å°†ç‰¹å®šçš„è´£ä»»ï¼Œæ²¿ç€ import graph å°½å¯èƒ½çš„æ¨å‘æ›´é«˜å±‚çº§ï¼Œæ¨ç»™ main package æˆ–é¡¶çº§å¤„ç†ç¨‹åºï¼Œç•™ä¸‹è¾ƒä½çº§åˆ«çš„ä»£ç æ¥å¤„ç†æŠ½è±¡æ¥å£ã€‚\næ€»ç»“ # å›é¡¾ä¸€ä¸‹ï¼Œå½“åº”ç”¨äº Go æ—¶ï¼Œæ¯ä¸ª SOLID åŸåˆ™éƒ½æ˜¯å…³äºè®¾è®¡çš„å¼ºæœ‰åŠ›é™ˆè¿°ï¼Œä½†ç»¼åˆèµ·æ¥å®ƒä»¬å…·æœ‰ä¸­å¿ƒä¸»é¢˜ã€‚\nå•ä¸€èŒè´£åŸåˆ™ï¼Œé¼“åŠ±æ‚¨å°†åŠŸèƒ½ï¼Œç±»å‹ã€æ–¹æ³•ç»“æ„åŒ–ä¸ºå…·æœ‰è‡ªç„¶å†…èšçš„åŒ…ï¼›ç±»å‹å±äºå½¼æ­¤ï¼Œå‡½æ•°æœåŠ¡äºå•ä¸€ç›®çš„ã€‚ å¼€æ”¾ / å°é—­åŸåˆ™ï¼Œé¼“åŠ±æ‚¨ä½¿ç”¨åµŒå…¥å°†ç®€å•ç±»å‹ç»„åˆæˆæ›´å¤æ‚çš„ç±»å‹ã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œé¼“åŠ±æ‚¨æ ¹æ®æ¥å£è€Œä¸æ˜¯å…·ä½“ç±»å‹æ¥è¡¨è¾¾åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚é€šè¿‡å®šä¹‰å°å‹æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥æ›´åŠ ç¡®ä¿¡ï¼Œå®ç°å°†å¿ å®åœ°æ»¡è¶³ä»–ä»¬çš„å¥‘çº¦ã€‚ æ¥å£éš”ç¦»åŸåˆ™ï¼Œè¿›ä¸€æ­¥é‡‡ç”¨äº†è¿™ä¸ªæƒ³æ³•ï¼Œå¹¶é¼“åŠ±æ‚¨å®šä¹‰ä»…ä¾èµ–äºä»–ä»¬æ‰€éœ€è¡Œä¸ºçš„å‡½æ•°å’Œæ–¹æ³•ã€‚å¦‚æœæ‚¨çš„å‡½æ•°ä»…éœ€è¦å…·æœ‰å•ä¸ªæ¥å£ç±»å‹çš„å‚æ•°çš„æ–¹æ³•ï¼Œåˆ™è¯¥å‡½æ•°æ›´å¯èƒ½åªæœ‰ä¸€ä¸ªè´£ä»»ã€‚ ä¾èµ–å€’ç½®åŸåˆ™ï¼Œé¼“åŠ±æ‚¨æŒ‰ç…§ä»ç¼–è¯‘æ—¶é—´åˆ°è¿è¡Œæ—¶é—´çš„æ—¶åºï¼Œè½¬ç§» package æ‰€ä¾èµ–çš„çŸ¥è¯†ã€‚åœ¨ Go ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç‰¹å®š package ä½¿ç”¨çš„ import è¯­å¥çš„æ•°é‡å‡å°‘çœ‹åˆ°äº†è¿™ä¸€ç‚¹ã€‚ å¦‚æœè¦æ€»ç»“ä¸€ä¸‹æœ¬æ¬¡æ¼”è®²ï¼Œé‚£å¯èƒ½å°±æ˜¯è¿™æ ·ï¼šinterfaces let you apply the SOLID principles to Go programsã€‚\nå› ä¸ºæ¥å£è®© Go ç¨‹åºå‘˜æè¿°ä»–ä»¬çš„ package æä¾›äº†ä»€ä¹ˆ - è€Œä¸æ˜¯å®ƒæ€ä¹ˆåšçš„ã€‚æ¢ä¸ªè¯´æ³•å°±æ˜¯ â€œè§£è€¦â€ï¼Œè¿™ç¡®å®æ˜¯ç›®æ ‡ï¼Œå› ä¸ºè¶Šæ¾æ•£è€¦åˆçš„è½¯ä»¶è¶Šå®¹æ˜“ä¿®æ”¹ã€‚\næ­£å¦‚ Sandi Metz æ‰€è¯´ï¼š\nDesign is the art of arranging code that needs to work today, and to be easy to change forever. â€“ Sandi Metz\nå› ä¸ºå¦‚æœ Go æƒ³è¦æˆä¸ºå…¬å¸é•¿æœŸæŠ•èµ„çš„è¯­è¨€ï¼ŒGo ç¨‹åºçš„å¯ç»´æŠ¤æ€§ï¼Œæ›´å®¹æ˜“å˜æ›´ï¼Œå°†æ˜¯ä»–ä»¬å†³ç­–çš„å…³é”®å› ç´ ã€‚\nÂ« Golang å‘å¸ƒç±»åº“ - 2\nÂ» Golang æ ‡å‡†åº“\n"},{"id":94,"href":"/go/go-stdlib/","title":"Go Stdlib","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Golang æ ‡å‡†åº“\nGolang æ ‡å‡†åº“ # fmt # æ ¼å¼åŒ–æ‰“å°\n%v åŸæ ·è¾“å‡º %T æ‰“å°ç±»å‹ %t bool %s string %f float %d 10è¿›åˆ¶æ•´æ•° %b 2è¿›åˆ¶æ•´æ•° %o 8è¿›åˆ¶æ•´æ•° %x 16è¿›åˆ¶æ•´æ•° 0-9ï¼Œa-f %X 16è¿›åˆ¶æ•´æ•° 0-9ï¼ŒA-F %c char %p pointer %.2f float ä¿ç•™ä¸¤ä½ path # file := \u0026#34;./logs/2021-01-25/error.log\u0026#34; fileName := path.Base(file) # è¿”å›æ–‡ä»¶åï¼šerror.log fileExt := path.Ext(file) # è¿”å›æ–‡ä»¶åç¼€ï¼š.log fileDir := path.Dir(file) # è¿”å›æ–‡ä»¶è·¯å¾„ï¼š ./logs/2021-01-25 os/exec # Golangè¯­è¨€æœ‰ä¸€ä¸ªåŒ…å«åš os/execï¼Œä½¿ç”¨è¯¥åŒ…å¯ä»¥ç›´æ¥åœ¨ç¨‹åºä¸­è°ƒç”¨ä¸»æœºçš„å‘½ä»¤ï¼Œä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š\nfunc OsExecUsage() error { fmt.Println(\u0026#34;docker build...\u0026#34;) cmd := exec.Command(\u0026#34;docker\u0026#34;, \u0026#34;build\u0026#34;, \u0026#34;.\u0026#34; ,\u0026#34;-t\u0026#34; ,\u0026#34;demo\u0026#34;) // å®æ—¶æ‰“å°è¾“å‡º cmd.Stdout = os.Stdout cmd.Stderr = os.Stderr err := cmd.Run() if err != nil { fmt.Println(\u0026#34;cmd.Output: \u0026#34;, err) return err } return nil } Â« Go ç¨‹åº SOLID è®¾è®¡åŸåˆ™\nÂ» testing\n"},{"id":95,"href":"/go/go-testing/","title":"Go Testing","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / testing\ntesting # å‘½ä»¤ # æµ‹è¯•\ngo test -run=TestCompare -v . è¿è¡Œæµ‹è¯•ï¼Œæµ‹è¯•å‡½æ•°åç§°ä¸­ä»…åŒ…å« TestCompare å‰ç¼€ã€‚\nåˆ—å‡ºåŒ…å†…æµ‹è¯•æ–‡ä»¶\ngo list -f={{.GoTestFiles}} . åˆ—å‡ºåŒ…å¤–æµ‹è¯•æ–‡ä»¶\ngo list -f={{.XTestGoFiles}} . åŒ…å†…æµ‹è¯•ï¼šæµ‹è¯•æ–‡ä»¶çš„åŒ…åç§°ä¸è¢«æµ‹åŒ…ä¸€è‡´ï¼Œå¯ä»¥è®¿é—®è¢«æµ‹åŒ…å†…æ‰€æœ‰æˆå‘˜ï¼Œç›¸å½“äºç™½ç›’æµ‹è¯•ï¼›\nåŒ…å¤–æµ‹è¯•ï¼šæµ‹è¯•æ–‡ä»¶çš„åŒ…åç§°ä¸è¢«æµ‹åŒ…ä¸ä¸€è‡´ï¼Œä¸€èˆ¬åœ¨è¢«æµ‹åŒ…åç§°åé¢æ·»åŠ  _test åç¼€ï¼Œåªèƒ½è®¿é—®è¢«æµ‹åŒ…å†…å…¬å¼€æˆå‘˜ï¼Œç›¸å½“äºé»‘ç›’æµ‹è¯•ã€‚\nÂ« Golang æ ‡å‡†åº“\nÂ» Golang\n"},{"id":96,"href":"/go/go/","title":"Go","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Golang\nGolang # èµ„æ–™ # Go å®‰å…¨æŒ‡å— Go è¯­è¨€ç¼–ç¨‹è§„èŒƒ Golang channel # golang å®ç°å¹¶å‘æ˜¯é€šè¿‡é€šä¿¡å…±äº«å†…å­˜ï¼Œchannel æ˜¯ go è¯­è¨€ä¸­goroutine çš„é€šä¿¡ç®¡é“ï¼Œé€šè¿‡ channel å°†å€¼ä»ä¸€ä¸ª goroutine å‘é€åˆ°å¦ä¸€ä¸ª goroutineã€‚\nè¯­æ³• # åˆ›å»º channelï¼š\nä½¿ç”¨ make() å‡½æ•°åˆ›å»ºï¼š\nch := make(chan int) é»˜è®¤åˆ›å»ºä¸€ä¸ªæ— ç¼“å­˜ channelã€‚\nå‘é€æ•°æ®åˆ° channelï¼š\nch \u0026lt;- x ä» channel è¯»å–æ•°æ®ï¼š\nx := \u0026lt;-ch å…³é—­ channelï¼š\nä½¿ç”¨ close() å‡½æ•°å…³é—­ï¼š\nclose(ch) å½“ä½ çš„ç¨‹åºä¸å†éœ€è¦å¾€ channel ä¸­å‘é€æ•°æ®æ—¶ï¼Œå¯ä»¥å…³é—­ channelã€‚\nå¦‚æœå¾€å·²ç»å…³é—­çš„ channal å‘é€æ•°æ®ï¼Œç¨‹åºå‘ç”Ÿå¼‚å¸¸ã€‚\næ— ç¼“å†² channel # å¦‚æœå½“å‰æ²¡æœ‰ä¸€ä¸ª goroutine å¯¹æ— ç¼“å†² channel æ¥æ”¶æ•°æ®ï¼Œé‚£ä¹ˆæ— ç¼“å†² channel ä¼šé˜»æ­¢å‘é€æ•°æ®ã€‚\næœ‰ç¼“å†² channel # ç±»ä¼¼é˜Ÿåˆ—æœºåˆ¶ï¼Œåˆ›å»ºæ—¶éœ€è¦è®¾å®šç¼“å†²å¤§å°ã€‚\nåˆ›å»ºä¸€ä¸ªæœ‰ç¼“å†² channelï¼š\nch := make(chan int ch, 10) åœ¨æœ‰ goroutine æ¥æ”¶ channel æ•°æ®ä¹‹å‰ï¼Œå¯ä»¥å…ˆå‘ channel ä¸­å‘é€10ä¸ªæ•°æ®ã€‚\næ— ç¼“å†² channel ä¸æœ‰ç¼“å†² channelçš„åŒºåˆ« # ç°åœ¨ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“ä½•æ—¶ä½¿ç”¨è¿™ä¸¤ç§ç±»å‹ã€‚ è¿™å®Œå…¨å–å†³äºä½ å¸Œæœ› goroutine ä¹‹é—´çš„é€šä¿¡å¦‚ä½•è¿›è¡Œã€‚ æ— ç¼“å†² channel åŒæ­¥é€šä¿¡ã€‚ å®ƒä»¬ä¿è¯æ¯æ¬¡å‘é€æ•°æ®æ—¶ï¼Œç¨‹åºéƒ½ä¼šè¢«é˜»æ­¢ï¼Œç›´åˆ°æœ‰äººä» channel ä¸­è¯»å–æ•°æ®ã€‚\nç›¸åï¼Œæœ‰ç¼“å†² channel å°†å‘é€å’Œæ¥æ”¶æ“ä½œè§£è€¦ã€‚ å®ƒä»¬ä¸ä¼šé˜»æ­¢ç¨‹åºï¼Œä½†ä½ å¿…é¡»å°å¿ƒä½¿ç”¨ï¼Œå› ä¸ºå¯èƒ½æœ€ç»ˆä¼šå¯¼è‡´æ­»é”ï¼ˆå¦‚å‰æ–‡æ‰€è¿°ï¼‰ã€‚ ä½¿ç”¨æ— ç¼“å†² channel æ—¶ï¼Œå¯ä»¥æ§åˆ¶å¯å¹¶å‘è¿è¡Œçš„ goroutine çš„æ•°é‡ã€‚ ä¾‹å¦‚ï¼Œä½ å¯èƒ½è¦å¯¹ API è¿›è¡Œè°ƒç”¨ï¼Œå¹¶ä¸”æƒ³è¦æ§åˆ¶æ¯ç§’æ‰§è¡Œçš„è°ƒç”¨æ¬¡æ•°ã€‚ å¦åˆ™ï¼Œä½ å¯èƒ½ä¼šè¢«é˜»æ­¢ã€‚\nè¯»å–æ–‡ä»¶ # ä¸€æ¬¡æ€§å…¨è¯» # package main import ( \u0026#34;fmt\u0026#34; \u0026#34;io/ioutil\u0026#34; ) func main() { bytes, e := ioutil.ReadFile(\u0026#34;/Users/dp/tmp/0811/03/file.txt\u0026#34;) if e != nil { panic(\u0026#34;read file error.\u0026#34;) } fmt.Println(string(bytes)) } æŒ‰è¡Œè¯»å– # package main import ( \u0026#34;bufio\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; ) func main() { f, e := os.Open(\u0026#34;C:/Users/dp/go/src/0811/03/file.txt\u0026#34;) if e != nil { panic(\u0026#34;read file error.\u0026#34;) } defer f.Close() r := bufio.NewReader(f) for { line, _, eof := r.ReadLine() if eof == io.EOF { break // read last line. } fmt.Println(string(line)) } } ä¼˜é›…é€€å‡º # ä¸å¤„ç†ä¼˜é›…é€€å‡º # package main import ( \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; \u0026#34;os/signal\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/gin-gonic/gin\u0026#34; ) func main() { router := gin.Default() router.GET(\u0026#34;/\u0026#34;, func(c *gin.Context) { time.Sleep(5 * time.Second) c.String(http.StatusOK, \u0026#34;Welcome Gin Server\u0026#34;) }) server := \u0026amp;http.Server{ Addr: \u0026#34;:8080\u0026#34;, Handler: router, } quit := make(chan os.Signal) signal.Notify(quit, os.Interrupt) go func() { \u0026lt;-quit log.Println(\u0026#34;receive interrupt signal\u0026#34;) if err := server.Close(); err != nil { log.Fatal(\u0026#34;Server Close:\u0026#34;, err) } }() if err := server.ListenAndServe(); err != nil { if err == http.ErrServerClosed { log.Println(\u0026#34;Server closed under request\u0026#34;) } else { log.Fatal(\u0026#34;Server closed unexpect\u0026#34;) } } log.Println(\u0026#34;Server exiting\u0026#34;) } ä¼˜é›…é€€å‡º 1ï¼ˆwith contextï¼‰ # package main import ( \u0026#34;context\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os/signal\u0026#34; \u0026#34;syscall\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/gin-gonic/gin\u0026#34; ) func main() { // Create context that listens for the interrupt signal from the OS. ctx, stop := signal.NotifyContext(context.Background(), syscall.SIGINT, syscall.SIGTERM) defer stop() router := gin.Default() router.GET(\u0026#34;/\u0026#34;, func(c *gin.Context) { time.Sleep(10 * time.Second) c.String(http.StatusOK, \u0026#34;Welcome Gin Server\u0026#34;) }) srv := \u0026amp;http.Server{ Addr: \u0026#34;:8080\u0026#34;, Handler: router, } // Initializing the server in a goroutine so that // it won\u0026#39;t block the graceful shutdown handling below go func() { if err := srv.ListenAndServe(); err != nil \u0026amp;\u0026amp; err != http.ErrServerClosed { log.Fatalf(\u0026#34;listen: %s\\n\u0026#34;, err) } }() // Listen for the interrupt signal. \u0026lt;-ctx.Done() // Restore default behavior on the interrupt signal and notify user of shutdown. stop() log.Println(\u0026#34;shutting down gracefully, press Ctrl+C again to force\u0026#34;) // The context is used to inform the server it has 5 seconds to finish // the request it is currently handling ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second) defer cancel() if err := srv.Shutdown(ctx); err != nil { log.Fatal(\u0026#34;Server forced to shutdown: \u0026#34;, err) } log.Println(\u0026#34;Server exiting\u0026#34;) } ä¼˜é›…é€€å‡º 2ï¼ˆwithout contextï¼‰ # package main import ( \u0026#34;context\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; \u0026#34;os/signal\u0026#34; \u0026#34;syscall\u0026#34; \u0026#34;time\u0026#34; \u0026#34;github.com/gin-gonic/gin\u0026#34; ) func main() { router := gin.Default() router.GET(\u0026#34;/\u0026#34;, func(c *gin.Context) { time.Sleep(5 * time.Second) c.String(http.StatusOK, \u0026#34;Welcome Gin Server\u0026#34;) }) srv := \u0026amp;http.Server{ Addr: \u0026#34;:8080\u0026#34;, Handler: router, } // Initializing the server in a goroutine so that // it won\u0026#39;t block the graceful shutdown handling below go func() { if err := srv.ListenAndServe(); err != nil \u0026amp;\u0026amp; err != http.ErrServerClosed { log.Fatalf(\u0026#34;listen: %s\\n\u0026#34;, err) } }() // Wait for interrupt signal to gracefully shutdown the server with // a timeout of 5 seconds. quit := make(chan os.Signal, 1) // kill (no param) default send syscall.SIGTERM // kill -2 is syscall.SIGINT // kill -9 is syscall.SIGKILL but can\u0026#39;t be catch, so don\u0026#39;t need add it signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM) \u0026lt;-quit log.Println(\u0026#34;Shutting down server...\u0026#34;) // The context is used to inform the server it has 5 seconds to finish // the request it is currently handling ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second) defer cancel() if err := srv.Shutdown(ctx); err != nil { log.Fatal(\u0026#34;Server forced to shutdown: \u0026#34;, err) } log.Println(\u0026#34;Server exiting\u0026#34;) } å‡½æ•°å¼é€‰é¡¹æ¨¡å¼ # å‡½æ•°å¼é€‰é¡¹æ¨¡å¼ï¼šFunctional Options Patternï¼Œæ˜¯ Golang ä¸­ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œç”¨äºè§£å†³æ„é€ å‡½æ•°å‚æ•°è¿‡å¤šçš„é—®é¢˜ã€‚\nç¤ºä¾‹ï¼š\npackage main func main() { NewServer(\u0026#34;test\u0026#34;, SetHost(\u0026#34;localhost\u0026#34;), SetPort(8081)) } type Server struct { Label string Host string Port int32 } func NewServer(label string, opts ...func(s *Server)) *Server { s := \u0026amp;Server{ Label: label, } for _, opt := range opts { opt(s) } return s } type Option func(s *Server) func SetHost(host string) Option { return func(s *Server) { s.Host = host } } func SetPort(port int32) Option { return func(s *Server) { s.Port = port } } è°ƒç”¨ API # ä½¿ç”¨ Golang è°ƒç”¨ API ä»£ç ç¤ºä¾‹ï¼š\nGet # func GetApi() { resp, err := http.Get(\u0026#34;https://baidu.com\u0026#34;) if err != nil { fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } defer resp.Body.Close() fmt.Printf(\u0026#34;Status: %s\\n\u0026#34;, resp.Status) fmt.Printf(\u0026#34;StatusCode: %d\\n\u0026#34;, resp.StatusCode) body, err := ioutil.ReadAll(resp.Body) if err != nil { fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } fmt.Printf(\u0026#34;StatusCode: %s\\n\u0026#34;, string(body)) } Post # 1 ç®€å• Postï¼š\nfunc PostApi1() { json := `{\u0026#34;id\u0026#34;:\u0026#34;u-001\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;Jay\u0026#34;,\u0026#34;age\u0026#34;:18}` resp, err := http.Post(\u0026#34;https://example.com/user\u0026#34;, \u0026#34;application/json\u0026#34;, bytes.NewBuffer([]byte(json))) defer resp.Body.Close() fmt.Printf(\u0026#34;Status: %s\\n\u0026#34;, resp.Status) fmt.Printf(\u0026#34;StatusCode: %d\\n\u0026#34;, resp.StatusCode) body, err := ioutil.ReadAll(resp.Body) if err != nil { fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } fmt.Printf(\u0026#34;StatusCode: %s\\n\u0026#34;, string(body)) } 2 é™„å¸¦ Headerï¼š\nfunc PostApi2() { // 1. json //json := `{\u0026#34;id\u0026#34;:\u0026#34;u-001\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;Jay\u0026#34;,\u0026#34;age\u0026#34;:18}` //req, _ := http.NewRequest(http.MethodPost, \u0026#34;https://example.com/user\u0026#34;, bytes.NewBuffer([]byte(json))) // 2. map reqBody, _ := json.Marshal(map[string]string{ \u0026#34;id\u0026#34;: \u0026#34;u-001\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Jay\u0026#34;, \u0026#34;age\u0026#34;: \u0026#34;18\u0026#34;, }) req, _ := http.NewRequest(http.MethodPost, \u0026#34;https://example.com/user\u0026#34;, bytes.NewBuffer(reqBody)) req.Header.Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) req.Header.Set(\u0026#34;My_Custom_Header\u0026#34;, \u0026#34;Value\u0026#34;) client := http.Client{} resp, err := client.Do(req) if err != nil { fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } defer resp.Body.Close() fmt.Printf(\u0026#34;Status: %s\\n\u0026#34;, resp.Status) fmt.Printf(\u0026#34;StatusCode: %d\\n\u0026#34;, resp.StatusCode) body, err := ioutil.ReadAll(resp.Body) if err != nil { fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } fmt.Printf(\u0026#34;StatusCode: %s\\n\u0026#34;, string(body)) } 3 æ„é€ è¯·æ±‚å¯¹è±¡ï¼š\ntype User struct { Id string `json:\u0026#34;id\u0026#34;` Name string `json:\u0026#34;name\u0026#34;` Age int `json:\u0026#34;age\u0026#34;` } func PostApi3() { user := User{ Id: \u0026#34;u-001\u0026#34;, Name: \u0026#34;Jay\u0026#34;, Age: 18, } buf := new(bytes.Buffer) json.NewEncoder(buf).Encode(user) resp, err := http.Post(\u0026#34;https://example.com/user\u0026#34;, \u0026#34;application/json\u0026#34;, buf) defer resp.Body.Close() fmt.Printf(\u0026#34;Status: %s\\n\u0026#34;, resp.Status) fmt.Printf(\u0026#34;StatusCode: %d\\n\u0026#34;, resp.StatusCode) body, err := ioutil.ReadAll(resp.Body) if err != nil { fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } fmt.Printf(\u0026#34;StatusCode: %s\\n\u0026#34;, string(body)) } 4 OAuth2ï¼š\n// go get golang.org/x/oauth2 func getAccessToken()string{ var authCfg = \u0026amp;clientcredentials.Config{ ClientID: \u0026#34;xxx\u0026#34;, ClientSecret: \u0026#34;xxx\u0026#34;, TokenURL: \u0026#34;https://example.com/connect/token\u0026#34;, EndpointParams: url.Values{ \u0026#34;grant_type\u0026#34;: {\u0026#34;client_credentials\u0026#34;}, }, } token, err := authCfg.TokenSource(context.Background()).Token() if err != nil { fmt.Errorf(\u0026#34;get access token failed. ERROR: %s\\n\u0026#34;, err.Error()) } return token.AccessToken } func OAuth2Api(){ json := `{\u0026#34;id\u0026#34;:\u0026#34;u-001\u0026#34;,\u0026#34;name\u0026#34;:\u0026#34;Jay\u0026#34;,\u0026#34;age\u0026#34;:18}` req, _ := http.NewRequest(http.MethodPost, \u0026#34;https://example.com/user\u0026#34;, bytes.NewBuffer([]byte(json))) req.Header.Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) req.Header.Set(\u0026#34;Bearer\u0026#34;, getAccessToken()) client := http.Client{} resp, err := client.Do(req) if err != nil { fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } defer resp.Body.Close() fmt.Printf(\u0026#34;Status: %s\\n\u0026#34;, resp.Status) fmt.Printf(\u0026#34;StatusCode: %d\\n\u0026#34;, resp.StatusCode) body, err := ioutil.ReadAll(resp.Body) if err != nil { fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } fmt.Printf(\u0026#34;StatusCode: %s\\n\u0026#34;, string(body)) } 5 ä¸Šä¼ æ–‡ä»¶ï¼š\nfunc FileApi(){ file,err:=os.Open(\u0026#34;hello.txt\u0026#34;) if err!=nil{ fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } defer file.Close() var reqBody bytes.Buffer multiPartWriter:=multipart.NewWriter(\u0026amp;reqBody) fileWriter,err:=multiPartWriter.CreateFormFile(\u0026#34;file_field\u0026#34;,\u0026#34;hello.txt\u0026#34;) if err!=nil{ fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } _,err=io.Copy(fileWriter,file) if err!=nil{ fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } fieldWriter,err:=multiPartWriter.CreateFormField(\u0026#34;normal_field\u0026#34;) if err!=nil{ fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } _,err=fieldWriter.Write([]byte(\u0026#34;value\u0026#34;)) if err!=nil{ fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } multiPartWriter.Close() req,err:=http.NewRequest(http.MethodPost,\u0026#34;http://example.com/file\u0026#34;,\u0026amp;reqBody) if err!=nil{ fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } req.Header.Set(\u0026#34;Content-Type\u0026#34;,multiPartWriter.FormDataContentType()) client:=http.Client{} resp,err:=client.Do(req) if err!=nil{ fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } defer resp.Body.Close() fmt.Printf(\u0026#34;Status: %s\\n\u0026#34;, resp.Status) fmt.Printf(\u0026#34;StatusCode: %d\\n\u0026#34;, resp.StatusCode) body, err := ioutil.ReadAll(resp.Body) if err != nil { fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } fmt.Printf(\u0026#34;StatusCode: %s\\n\u0026#34;, string(body)) } è°ƒç”¨ Jenkins API # package main import ( \u0026#34;fmt\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;strings\u0026#34; ) type JenkinsConfig struct { User string `json:\u0026#34;user\u0026#34;` Token string `json:\u0026#34;token\u0026#34;` } var jenkinsConf *JenkinsConfig func main() { jenkinsConf := \u0026amp;JenkinsConfig{ User: \u0026#34;xxx\u0026#34;, Token: \u0026#34;xxxxxx\u0026#34; } job := \u0026#34;jenkins-job-1\u0026#34; disableJenkins(job) } func disableJenkins(job string) { // disabled jenkins job r, err := http.NewRequest(http.MethodPost, fmt.Sprintf(\u0026#34;https://jenkins.example.com/job/%s/disable\u0026#34;, job), nil) if err != nil { log.Errorf(\u0026#34;new jenkins request failed: %s\u0026#34;, err) } r.SetBasicAuth(jenkinsConf.User, jenkinsConf.Token) client := \u0026amp;http.Client{} resp, err := client.Do(r) if err != nil { log.Errorf(\u0026#34;request failed: %s\u0026#34;, err) } if resp.StatusCode == http.StatusOK { log.Healthf(\u0026#34;disable jenkins job [%s] successfully\u0026#34;, job) } else { log.Warnf(\u0026#34;disable jenkins job [%s] status [%d]\u0026#34;, job, resp.StatusCode) } } ä½è¿ç®— # package main import \u0026#34;fmt\u0026#34; func main() { /* ä½è¿ç®—ç¬¦ï¼š å°†æ•°å€¼ï¼Œè½¬ä¸ºäºŒè¿›åˆ¶åï¼ŒæŒ‰ä½æ“ä½œ æŒ‰ä½\u0026amp;ï¼š å¯¹åº”ä½çš„å€¼å¦‚æœéƒ½ä¸º 1 æ‰ä¸º 1ï¼Œæœ‰ä¸€ä¸ªä¸º 0 å°±ä¸º 0 æŒ‰ä½|ï¼š å¯¹åº”ä½çš„å€¼å¦‚æœéƒ½æ˜¯ 0 æ‰ä¸º 0ï¼Œæœ‰ä¸€ä¸ªä¸º 1 å°±ä¸º 1 å¼‚æˆ–^ï¼š äºŒå…ƒï¼ša^b å¯¹åº”ä½çš„å€¼ä¸åŒä¸º 1ï¼Œç›¸åŒä¸º 0 ä¸€å…ƒï¼š^a æŒ‰ä½å–åï¼š 1---\u0026gt;0 0---\u0026gt;1 ä½æ¸…ç©ºï¼š\u0026amp;^ å¯¹äº a \u0026amp;^ b å¯¹äº b ä¸Šçš„æ¯ä¸ªæ•°å€¼ å¦‚æœä¸º 0ï¼Œåˆ™å– a å¯¹åº”ä½ä¸Šçš„æ•°å€¼ å¦‚æœä¸º 1ï¼Œåˆ™ç»“æœä½å°±å– 0 ä½ç§»è¿ç®—ç¬¦ï¼š \u0026lt;\u0026lt;ï¼šæŒ‰ä½å·¦ç§»ï¼Œå°† a è½¬ä¸ºäºŒè¿›åˆ¶ï¼Œå‘å·¦ç§»åŠ¨ b ä½ a \u0026lt;\u0026lt; b \u0026gt;\u0026gt;: æŒ‰ä½å³ç§»ï¼Œå°† a è½¬ä¸ºäºŒè¿›åˆ¶ï¼Œå‘å³ç§»åŠ¨ b ä½ a \u0026gt;\u0026gt; b */ a := 60 b := 13 /* a: 60 0011 1100 b: 13 0000 1101 \u0026amp; 0000 1100 | 0011 1101 ^ 0011 0001 \u0026amp;^ 0011 0000 a : 0000 0000 ... 0011 1100 ^ 1111 1111 ... 1100 0011 */ fmt.Printf(\u0026#34;a:%d, %b\\n\u0026#34;,a,a) fmt.Printf(\u0026#34;b:%d, %b\\n\u0026#34;,b,b) res1 := a \u0026amp; b fmt.Println(res1) // 12 res2 := a | b fmt.Println(res2) // 61 res3 := a ^ b fmt.Println(res3) // 49 res4 := a \u0026amp;^ b fmt.Println(res4) // 48 res5 := ^a fmt.Println(res5) c:=8 /* c : ... 0000 1000 0000 100000 \u0026gt;\u0026gt; 0000 10 */ res6 := c \u0026lt;\u0026lt; 2 fmt.Println(res6) res7 := c \u0026gt;\u0026gt; 2 fmt.Println(res7) } å®ç°ç®€æ˜“ç½‘ç»œè¿æ¥å®¢æˆ·ç«¯ # å®ç°ç±»ä¼¼ nc çš„å®¢æˆ·ç«¯å‘½ä»¤å·¥å…·ï¼š\n$ nc www.baidu.com 80 GET / HTTP/1.1 æ³¨æ„ï¼šéœ€è¦è¿ç»­ä¸¤æ¬¡å›è½¦ï¼Œæ‰ä¼šè¿æ¥\nåºŸè¯å°‘è¯´ï¼Œä¸Šä»£ç ï¼š\nmain.go\npackage main import ( \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; \u0026#34;os\u0026#34; ) func main() { if len(os.Args) != 3 { log.Fatalln(\u0026#34;Usage: nc [host] [port]\u0026#34;) } host, port := os.Args[1], os.Args[2] c, err := net.Dial(\u0026#34;tcp\u0026#34;, host+\u0026#34;:\u0026#34;+port) if err != nil { log.Fatalln(err) } go func() { io.Copy(c, os.Stdin) }() io.Copy(os.Stdout, c) } æµ‹è¯•ï¼š\n$ go build -o nc main.go $ ./nc www.baidu.com 80 GET / HTTP/1.1 git # package gitutil import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/go-git/go-git/v5\u0026#34; \u0026#34;github.com/go-git/go-git/v5/plumbing\u0026#34; \u0026#34;github.com/go-git/go-git/v5/plumbing/transport/http\u0026#34; \u0026#34;os\u0026#34; ) func Clone() { _, err := git.PlainClone(\u0026#34;/var/app/ash\u0026#34;, false, \u0026amp;git.CloneOptions{ URL: \u0026#34;https://github.com/poneding/ash.git\u0026#34;, ReferenceName: plumbing.NewBranchReferenceName(\u0026#34;master\u0026#34;), Auth: \u0026amp;http.BasicAuth{ Username: \u0026#34;poneding\u0026#34;, Password: \u0026#34;xxxxxx\u0026#34;, }, Progress: os.Stdout, }) if err != nil { fmt.Errorf(\u0026#34;ERROR: %s\\n\u0026#34;, err.Error()) } } elasticsearch # package esutil import ( \u0026#34;bytes\u0026#34; \u0026#34;encoding/json\u0026#34; \u0026#34;errors\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/elastic/go-elasticsearch/v7\u0026#34; \u0026#34;strings\u0026#34; ) func NewESClient2(esAddress []string) (*elasticsearch.Client, error) { if len(esAddress) == 0 { panic(\u0026#34;Invalid parameters: esAddress.\u0026#34;) } esConfig := elasticsearch.Config{Addresses: esAddress} esClient, err := elasticsearch.NewClient(esConfig) if err != nil { fmt.Errorf(\u0026#34;GetESClient ERROR: %s\\n\u0026#34;, err) panic(err) } return esClient, nil } func QueryLogs2(esClient *elasticsearch.Client, query QueryLogModel) ([]LogModel, error) { var ( buf bytes.Buffer r map[string]interface{} ) index := query.App + \u0026#34;-*\u0026#34; q := map[string]interface{}{ \u0026#34;query\u0026#34;: map[string]interface{}{ \u0026#34;match_phrase\u0026#34;: map[string]interface{}{ \u0026#34;kubernetes.labels.app\u0026#34;: query.App, }, }, } if err := json.NewEncoder(\u0026amp;buf).Encode(q); err != nil { fmt.Errorf(\u0026#34;QueryLogs ERROR: %s\\n\u0026#34;, err) return nil, err } searchRes, err := esClient.Search( esClient.Search.WithIndex(index), esClient.Search.WithBody(\u0026amp;buf), esClient.Search.WithQuery(query.Filter), esClient.Search.WithFilterPath(\u0026#34;hits.hits\u0026#34;), esClient.Search.WithSize(query.Size), esClient.Search.WithSort(\u0026#34;@timestamp:desc\u0026#34;), esClient.Search.WithSource(\u0026#34;@timestamp\u0026#34;,\u0026#34;level\u0026#34;,\u0026#34;log\u0026#34;,\u0026#34;msg\u0026#34;), ) defer searchRes.Body.Close() if err != nil || searchRes.IsError() { fmt.Errorf(\u0026#34;QueryLogs ERROR: %s\\n\u0026#34;, err.Error()) return nil, errors.New(strings.Join([]string{\u0026#34;es.Search ERROR:\u0026#34;, searchRes.Status(), err.Error()}, \u0026#34; \u0026#34;)) } if err := json.NewDecoder(searchRes.Body).Decode(\u0026amp;r); err != nil { fmt.Errorf(\u0026#34;QueryLogs ERROR: %s\\n\u0026#34;, err.Error()) return nil, err } res := make([]LogModel, 0) for _, hit := range r[\u0026#34;hits\u0026#34;].(map[string]interface{})[\u0026#34;hits\u0026#34;].([]interface{}) { source := hit.(map[string]interface{})[\u0026#34;_source\u0026#34;].(map[string]interface{}) logModel := LogModel{ Timestamp: source[\u0026#34;@timestamp\u0026#34;].(string), Log: source[\u0026#34;log\u0026#34;].(string), } level, ok := source[\u0026#34;level\u0026#34;] if ok { logModel.Level = level.(string) } log, ok := source[\u0026#34;msg\u0026#34;] if ok { logModel.Log = log.(string) } res = append(res, logModel) } return res, nil } package es import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/olivere/elastic/v7\u0026#34; \u0026#34;reflect\u0026#34; \u0026#34;time\u0026#34; ) func NewESClient(esAddresses []string) (*elastic.Client, error) { client, err := elastic.NewClient(elastic.SetSniff(false), elastic.SetURL(esAddresses...)) if err != nil { fmt.Errorf(\u0026#34;NewESClient ERROR: %s\\n\u0026#34;, err) panic(err) } return client, nil } func QueryLogs(esClient *elastic.Client, queryModel QueryLogModel) ([]LogModel, error) { res := make([]LogModel, 0) boolQuery := elastic.NewBoolQuery() index := queryModel.App + \u0026#34;-*\u0026#34; query := esClient.Search(index).FilterPath(\u0026#34;hits.hits\u0026#34;).Sort(\u0026#34;@timestamp\u0026#34;, false) if len(queryModel.Filter) \u0026gt; 0 { boolQuery.Filter(elastic.NewQueryStringQuery(queryModel.Filter)) } if len(queryModel.Level) \u0026gt; 0 { boolQuery.Filter(elastic.NewMatchPhraseQuery(\u0026#34;level\u0026#34;, queryModel.Level)) } if queryModel.Page \u0026lt;= 0 { queryModel.Page = 1 } if queryModel.Size \u0026lt;= 0 { queryModel.Size = 50 } query = query.From((queryModel.Page-1)*queryModel.Size + 1).Size(queryModel.Size) if queryModel.StartAt == (time.Time{}) { queryModel.StartAt = time.Now().Add(-15 * time.Minute).UTC() } if queryModel.EndAt == (time.Time{}) { queryModel.EndAt = time.Now().UTC() } boolQuery.Filter(elastic.NewRangeQuery(\u0026#34;@timestamp\u0026#34;).Gte(queryModel.StartAt).Lte(queryModel.EndAt)) query = query.Query(boolQuery) queryRes, err := query.Do(context.Background()) if err != nil { fmt.Errorf(\u0026#34;QueryLogs ERROR: %s\\n\u0026#34;, err.Error()) return res, err } for _, item := range queryRes.Each(reflect.TypeOf(LogModel{})) { if t, ok := item.(LogModel); ok { res = append(res, LogModel{ Timestamp: t.Timestamp, Level: t.Level, // Msg storing source log here. Log: t.Msg, Msg: t.Log, App: t.Kubernetes.Labels.App, }) } } return res, nil } func QueryErrorLogs(esClient *elastic.Client) error { query := esClient.Search(\u0026#34;dev-core-*\u0026#34;).FilterPath(\u0026#34;hits.hits\u0026#34;).Sort(\u0026#34;@timestamp\u0026#34;, false).Size(100).Query(elastic.NewMatchPhraseQuery(\u0026#34;level\u0026#34;, \u0026#34;error\u0026#34;)) queryRes, err := query.Do(context.Background()) if err != nil { fmt.Errorf(\u0026#34;QueryLogs ERROR: %s\\n\u0026#34;, err.Error()) } for _, item := range queryRes.Each(reflect.TypeOf(LogModel{})) { if t, ok := item.(LogModel); ok { fmt.Println(t.Log) } } return nil } Â« testing\nÂ» gopkg-errors.md\n"},{"id":97,"href":"/go/gopkg-errors/","title":"Gopkg Errors","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / gopkg-errors.md\ntitle: Go åŒ… - errors date: 2022-10-19T14:44:06+08:00 lastmod: 2022-11-03T03:32:31.646Z tags:\nGolang gopkg keywords: Golang gopkg errors weight: 1 errors åŒ…ä¸ºä½ çš„ Go ç¨‹åºæä¾›ä¸€ç§å¯¹ç¨‹åºå‘˜è°ƒè¯•ã€æŸ¥çœ‹æ—¥å¿—æ›´å‹å¥½çš„é”™è¯¯å¤„ç†æ–¹å¼ã€‚\nGo ç¨‹åºä¸­ä¼ ç»Ÿçš„é”™è¯¯å¤„ç†æ–¹æ³•ï¼š\nif err != nil { return err } é€’å½’çš„å‘ä¸Šä¼ é€’é”™è¯¯ï¼Œè¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªç¼ºé™·ï¼šæœ€ç»ˆå¤„ç†é”™è¯¯çš„ä½ç½®æ— æ³•è·å–é”™è¯¯çš„è°ƒç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚\nerrors åŒ…ä»¥ä¸ç ´åé”™è¯¯çš„åŸå§‹å€¼çš„æ–¹å¼å‘é”™è¯¯ä¸­çš„æ·»åŠ è°ƒç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚\nè·å–åŒ… # go get github.com/pkg/errors é”™è¯¯æ·»åŠ ä¸Šä¸‹æ–‡ # The errors.Wrap function returns a new error that adds context to the original error. For example\n_, err := ioutil.ReadAll(r) if err != nil { return errors.Wrap(err, \u0026#34;read failed\u0026#34;) } Retrieving the cause of an error # Using errors.Wrap constructs a stack of errors, adding context to the preceding error. Depending on the nature of the error it may be necessary to reverse the operation of errors.Wrap to retrieve the original error for inspection. Any error value which implements this interface can be inspected by errors.Cause.\ntype causer interface { Cause() error } errors.Cause will recursively retrieve the topmost error which does not implement causer, which is assumed to be the original cause. For example:\nswitch err := errors.Cause(err).(type) { case *MyError: // handle specifically default: // unknown error } Read the package documentation for more information.\nRoadmap # With the upcoming Go2 error proposals this package is moving into maintenance mode. The roadmap for a 1.0 release is as follows:\n0.9. Remove pre Go 1.9 and Go 1.10 support, address outstanding pull requests (if possible) 1.0. Final release. Contributing # Because of the Go2 errors changes, this package is not accepting proposals for new functionality. With that said, we welcome pull requests, bug fixes and issue reports.\nBefore sending a PR, please discuss your change by raising an issue.\nLicense # BSD-2-Clause\nÂ« Golang\nÂ» Goreleaser\n"},{"id":98,"href":"/go/goreleaser/","title":"Goreleaser","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Goreleaser\nGoreleaser # Go ç¨‹åºé¡¹ç›®çš„è‡ªåŠ¨åŒ–å‘å¸ƒå·¥å…·ï¼Œç®€å•çš„å‘å¸ƒå‘½ä»¤å¸®åŠ©æˆ‘ä»¬çœå»å¤§é‡çš„é‡å¤å·¥ä½œã€‚\nå®‰è£… # MacOsï¼š\nbrew install goreleaser/tap/goreleaser æºç ç¼–è¯‘ï¼š\ngit clone https://github.com/goreleaser/goreleaser cd goreleaser go get ./... go build -o goreleaser . ./goreleaser --version åˆå§‹åŒ– # åœ¨goé¡¹ç›®ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆ.goreleaser.ymlæ–‡ä»¶ï¼š\ngoreleaser init ç”Ÿæˆæ–‡ä»¶åï¼Œè‡ªè¡Œé…ç½®ï¼Œç›¸ä¿¡ä½ èƒ½çœ‹çš„æ‡‚ã€‚\néªŒè¯ .goreleaser.yml # goreleaser check ä½¿ç”¨æœ¬åœ°ç¯å¢ƒæ„å»º\ngoreleaser build --single-target é…ç½® github token # token å¿…é¡»è‡³å°‘åŒ…å« write:package æƒé™ï¼Œæ‰èƒ½ä¸Šä¼ åˆ°å‘å¸ƒèµ„æºä¸­ã€‚\nä»githubç”Ÿæˆtokenï¼Œå†™å…¥æ–‡ä»¶ï¼š\nmkdir ~/.config/goreleaser vim ~/.config/goreleaser/github_token æˆ–è€…ç›´æ¥åœ¨ç»ˆç«¯å¯¼å…¥ç¯å¢ƒé…ç½®ï¼š\nexport GITHUB_TOKEN=\u0026#34;YOUR_GITHUB_TOKEN\u0026#34; ä¸ºé¡¹ç›®æ‰“ä¸Š tag # git tag v0.1.0 -m \u0026#34;release v0.1.0\u0026#34; git push origin v0.1.0 æ‰§è¡Œ goreleaser # goreleaser --clean # è·³è¿‡ git ä¿®æ”¹éªŒè¯ goreleaser build --skip-validate --clean å¦‚æœç›®å‰è¿˜ä¸æƒ³æ‰“ tagï¼Œå¯ä»¥åŸºäºæœ€è¿‘çš„ä¸€æ¬¡æäº¤ ç›´æ¥ä½¿ç”¨ä¸€ä¸‹ gorelease å‘½ä»¤ï¼š\ngoreleaser build --snapshot Dry run # å¦‚æœä½ æƒ³åœ¨çœŸå®çš„å‘å¸ƒä¹‹å‰åšå‘å¸ƒæµ‹è¯•ï¼Œä½ å¯ä»¥å°è¯• dry run ã€‚\nBuild only æ¨¡å¼ # ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œåªä¼šç¼–è¯‘å½“å‰é¡¹ç›®ï¼Œå¯ä»¥éªŒè¯é¡¹ç›®æ˜¯å¦å­˜å‚¨ç¼–è¯‘é”™è¯¯ã€‚\ngoreleaser build Release æ ‡è¯† # ä½¿ç”¨ --skip-publish å‘½ä»¤æ ‡è¯†æ¥è·³è¿‡å‘å¸ƒåˆ°è¿œç«¯ã€‚\ngoreleaser release --skip-publish goreleaser release --snapshot --skip-publish --clean å·¥ä½œåŸç† # æ¡ä»¶ï¼š\né¡¹ç›®ä¸‹æœ‰ä¸€ä¸ªè§„èŒƒçš„ Â·goreleaser.yml æ–‡ä»¶ å¹²å‡€çš„ git ç›®å½• ç¬¦åˆ SemVer-compatible çš„ç‰ˆæœ¬å‘½å æ­¥éª¤ï¼š\ndefaultingï¼šä¸ºæ¯ä¸ªæ­¥éª¤é…ç½®åˆç†çš„é»˜è®¤å€¼ buildingï¼šæ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆbinariesï¼‰ï¼Œå½’æ¡£æ–‡ä»¶ï¼ˆarchivesï¼‰ï¼ŒåŒ…æ–‡ä»¶ï¼ˆpackagesï¼‰ï¼ŒDockeré•œåƒç­‰ publishingï¼šå°†æ„å»ºçš„æ–‡ä»¶å‘å¸ƒåˆ°é…ç½®çš„ GitHub Release èµ„æºï¼ŒDocker Hub ç­‰ annoucingï¼šå‘å¸ƒå®Œæˆåï¼Œé…ç½®é€šçŸ¥ æ­¥éª¤å¯ä»¥é€šè¿‡å‘½ä»¤æ ‡è¯† --skip-{step_name} æ¥è·³è¿‡ï¼Œå¦‚æœå½“ä¸­æŸæ­¥éª¤å¤±è´¥ï¼Œä¹‹åçš„æ­¥éª¤å°†ä¸ä¼šè¿è¡Œã€‚\nCGO # å¾ˆé—æ†¾ï¼Œå¦‚æœä½ çš„ Go ç¨‹åºé¡¹ç›®éœ€è¦ä½¿ç”¨åˆ° CGO çš„è·¨å¹³å°ç¼–è¯‘ï¼ŒDocker é•œåƒæ˜¯ä¸æ”¯æŒçš„ï¼Œå¹¶ä¸”ä½ çš„é…ç½®å°†ä¸ä¼šçœ‹åˆ° clean ã€‚\nä¹Ÿè®¸è¿™é‡Œå¯ä»¥å¸®åŠ©åˆ°ä½ ï¼š Cross-compiling Go with CGO - GoReleaser\nÂ« gopkg-errors.md\nÂ» Mac M1 äº¤å‰ç¼–è¯‘ CGO\n"},{"id":99,"href":"/go/mac-appl-silicon-cross-compile-cgo/","title":"MAC Appl Silicon Cross Compile Cgo","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / Mac M1 äº¤å‰ç¼–è¯‘ CGO\nMac M1 äº¤å‰ç¼–è¯‘ CGO # æ–¹æ³•ä¸€ # 1ã€å®‰è£…ä¾èµ–\nbrew tap messense/macos-cross-toolchains brew install x86_64-unknown-linux-gnu brew install aarch64-unknown-linux-gnu 2ã€æ·»åŠ åˆ° PATH\nexport PATH=$PATH:/opt/homebrew/Cellar/x86_64-unknown-linux-gnu/11.2.0_1/bin::/opt/homebrew/Cellar/aarch64-unknown-linux-gnu/11.2.0_1/bin 3ã€ç¼–è¯‘ CGO ç¨‹åº\nCGO_ENABLED=1 GOOS=linux GOARCH=amd64 CC=x86_64-unknown-linux-gnu-gcc CXX=x86_64-unknown-linux-gnu-g++ go build CGO_ENABLED=1 GOOS=linux GOARCH=arm64 CC=aarch64-unknown-linux-gnu-gcc CXX=aarch64-unknown-linux-gnu-g++ go build æ–¹æ³•äºŒ # 1ã€å®‰è£…ä¾èµ–\nbrew install FiloSottile/musl-cross/musl-cross 2ã€æ·»åŠ åˆ° PATH\nexport PATH=$PATH:/opt/homebrew/Cellar/musl-cross/0.9.9_1/bin 3ã€ç¼–è¯‘ CGO ç¨‹åº\n# -tags=musl ä¸èƒ½çœç•¥ä¸ç„¶ä¼šå‡ºç°å…¶ä»–é”™è¯¯ CGO_ENABLED=1 GOOS=linux GOARCH=amd64 CC=x86_64-linux-musl-gcc CXX=x86_64-linux-musl-g++ go build -tags=musl # å¦‚æœlinuxä¸æƒ³å®‰è£…muslæ”¯æŒ CGO_ENABLED=1 GOOS=linux GOARCH=amd64 CC=x86_64-linux-musl-gcc CXX=x86_64-linux-musl-g++ CGO_LDFLAGS=\u0026#34;-static\u0026#34; go build -tags=musl CGO_ENABLED=1 GOOS=linux GOARCH=amd64 CC=x86_64-linux-musl-gcc CGO_LDFLAGS=\u0026#34;-static\u0026#34; go build CGO_ENABLED=1 GOOS=linux GOARCH=arm64 CC=x86_64-linux-musl-gcc CGO_LDFLAGS=\u0026#34;-static\u0026#34; go build å‚è€ƒ # https://blog.csdn.net/qq_41416964/article/details/129571304 https://zhuanlan.zhihu.com/p/338891206 Â« Goreleaser\nÂ» pprof\n"},{"id":100,"href":"/go/pprof/","title":"Pprof","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / pprof\npprof # pprof æ˜¯æ€§èƒ½è°ƒè¯•å·¥å…·ï¼Œå¯ä»¥ç”Ÿæˆç±»ä¼¼ç«ç„°å›¾ã€å †æ ˆå›¾ï¼Œå†…å­˜åˆ†æå›¾ç­‰ã€‚\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;math/rand\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;time\u0026#34; _ \u0026#34;net/http/pprof\u0026#34; ) // åƒå†…å­˜ type Eater struct { Name string Buffer [][]int } var e Eater func main() { e = Eater{Name: \u0026#34;eater\u0026#34;} http.HandleFunc(\u0026#34;/go\u0026#34;, goHandler) http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) // å¦‚æœä¸ä½¿ç”¨é»˜è®¤çš„ muxï¼ˆhttp.DefaultServeMuxï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼é›†æˆ pprof // mux := http.NewServeMux() // mux.HandleFunc(\u0026#34;/go\u0026#34;, goHandler) // mux.HandleFunc(\u0026#34;/debug/pprof/\u0026#34;, pprof.Index) // mux.HandleFunc(\u0026#34;/debug/pprof/cmdline\u0026#34;, pprof.Cmdline) // mux.HandleFunc(\u0026#34;/debug/pprof/profile\u0026#34;, pprof.Profile) // mux.HandleFunc(\u0026#34;/debug/pprof/symbol\u0026#34;, pprof.Symbol) // mux.HandleFunc(\u0026#34;/debug/pprof/trace\u0026#34;, pprof.Trace) // http.ListenAndServe(\u0026#34;:8080\u0026#34;, mux) fmt.Println(e.Name) } // æ¨¡æ‹Ÿåˆ›å»º goroutineï¼Œå†…å­˜æ²¡æœ‰åŠæ—¶å›æ”¶ func goHandler(w http.ResponseWriter, r *http.Request) { for i := 0; i \u0026lt; 10; i++ { go func() { time.Sleep(time.Hour) }() e.EatMem() } w.Write([]byte(\u0026#34;ok\u0026#34;)) } func (e *Eater) EatMem() { e.Buffer = append(e.Buffer, generateWithCap(1024*1024)) } func generateWithCap(n int) []int { rand.Seed(time.Now().UnixNano()) nums := make([]int, 0, n) for i := 0; i \u0026lt; n; i++ { nums = append(nums, rand.Int()) } return nums } è¿è¡Œï¼š\ngo run main.go è®¿é—® http://localhost:8080/go æ¨¡æ‹Ÿä¸šåŠ¡ã€‚\nè®¿é—® http://localhost:8080/debug/pprof/ åˆ†æç¨‹åºæ€§èƒ½ã€‚\nå›¾å½¢æ–¹å¼åˆ†æï¼š\n# æŸ¥çœ‹cpu go tool pprof -http=:6060 http://127.0.0.1:8080/debug/pprof/profile # æŸ¥çœ‹heap go tool pprof -http=:6060 http://127.0.0.1:8080/debug/pprof/heap # æŸ¥çœ‹goroutine go tool pprof -http=:6060 http://127.0.0.1:8080/debug/pprof/goroutine éœ€è¦æå‰å®‰è£…å·¥å…· Graphviz\nå†…å­˜ä½¿ç”¨ï¼š\ngoroutine ä½¿ç”¨ï¼š\nÂ« Mac M1 äº¤å‰ç¼–è¯‘ CGO\nÂ» ä½¿ç”¨ Go ç”Ÿæˆ OpenSSH å…¼å®¹çš„ RSA å¯†é’¥å¯¹\n"},{"id":101,"href":"/go/ssh-keygen-with-go/","title":"SSH Keygen With Go","section":"Go","content":" ğŸ  é¦–é¡µ / Golang ç¼–ç¨‹ / ä½¿ç”¨ Go ç”Ÿæˆ OpenSSH å…¼å®¹çš„ RSA å¯†é’¥å¯¹\nä½¿ç”¨ Go ç”Ÿæˆ OpenSSH å…¼å®¹çš„ RSA å¯†é’¥å¯¹ # æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ssh-keygen å‘½ä»¤ç”Ÿæˆä¸€å¯¹ç”¨äº SSH è®¿é—®çš„ç§é’¥å’Œå…¬é’¥ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Go ç”Ÿæˆä¸€å¯¹ OpenSSH å…¼å®¹çš„ RSA å¯†é’¥å¯¹ã€‚\nä»¥ä¸‹ä»£ç ä¸­ GenOpenSSHKeyPair æ–¹æ³•ç”¨äºç”Ÿæˆä¸€å¯¹ç”¨äº SSH è®¿é—®çš„ç§é’¥å’Œå…¬é’¥ã€‚ç”Ÿæˆçš„ç§é’¥ä»¥ PEM ç¼–ç ï¼Œå…¬é’¥ä»¥ OpenSSH authorized_keys æ–‡ä»¶ä¸­åŒ…å«çš„æ ¼å¼è¿›è¡Œç¼–ç ã€‚\npackage util import ( \u0026#34;crypto/rand\u0026#34; \u0026#34;crypto/rsa\u0026#34; \u0026#34;crypto/x509\u0026#34; \u0026#34;encoding/pem\u0026#34; \u0026#34;golang.org/x/crypto/ssh\u0026#34; ) // GenOpenSSHKeyPair make a pair of private and public keys for SSH access. // Private Key generated is PEM encoded // Public key is encoded in the format for inclusion in an OpenSSH authorized_keys file. func GenOpenSSHKeyPair() ([]byte, []byte, error) { privateKey, err := rsa.GenerateKey(rand.Reader, 2048) if err != nil { return nil, nil, err } privateKeyPEM := \u0026amp;pem.Block{ Type: \u0026#34;RSA PRIVATE KEY\u0026#34;, Bytes: x509.MarshalPKCS1PrivateKey(privateKey), } rsaSSHPriKeyBytes := pem.EncodeToMemory(privateKeyPEM) pub, err := ssh.NewPublicKey(\u0026amp;privateKey.PublicKey) if err != nil { return nil, nil, err } rsaSSHPubKeyBytes := ssh.MarshalAuthorizedKey(pub) return rsaSSHPriKeyBytes, rsaSSHPubKeyBytes, nil } Â« pprof\n"},{"id":102,"href":"/graphql/","title":"Graphql","section":"","content":" ğŸ  é¦–é¡µ / Graphql\nGraphql # Graphql\n"},{"id":103,"href":"/graphql/graphql/","title":"Graphql","section":"Graphql","content":" ğŸ  é¦–é¡µ / Graphql / Graphql\nGraphql # https://graphql.cn/learn/\nä»‹ç» # ä¸€ç§ API æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§æ»¡è¶³ä½¿ç”¨ç°æœ‰æ•°æ®å®Œæˆå‡ ä¹æ‰€æœ‰æ•°æ®æŸ¥è¯¢çš„è¿è¡Œæ—¶ã€‚\nå¯¹ API æ•°æ®æä¾›å¯ç†è§£çš„å®Œæ•´æè¿°ï¼Œèµ‹äºˆå®¢æˆ·ç«¯å‡†ç¡®è·å–æ‰€éœ€æ•°æ®ï¼Œä½¿å¾— API çš„æ¼”è¿›æ›´åŠ è½»æ¾ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒæ¥æ„å»ºå¼ºå¤§çš„å¼€å‘è€…å·¥å…·ï¼ˆLowCode?ï¼‰ã€‚\nç‰¹æ€§ # æ‰€å¾—å³æ‰€å–ï¼š\nè¯·æ±‚ä»€ä¹ˆï¼Œè¿”å›ä»€ä¹ˆï¼Œå› ä¸ºæ€»æ˜¯æ ¹æ®ä½ è¯·æ±‚çš„ç»“æ„è¿”å›å¯é¢„è§çš„ç»“æœã€‚\nå•å–å¤šå¾—ï¼š\nå•æ¬¡è¯·æ±‚ï¼Œè¿”å›å¤šç§ç»“æ„çš„æ•°æ®ï¼Œä¸ä»…å¯¹èµ„æºå±æ€§æŸ¥è¯¢ï¼Œè€Œä¸”è¿˜ä¼šæ²¿ç€èµ„æºçš„å¼•ç”¨å…³ç³»è¿›ä¸€æ­¥æŸ¥è¯¢ã€‚\nè¿™ä¹Ÿæ˜¯å¯¹æ¯” Restful API çš„ä¸€ç§ä¼˜åŠ¿ï¼ŒRestful API å¯¹å¤šèµ„æºçš„æŸ¥è¯¢æ—¶ï¼Œå¾€å¾€éœ€è¦å¤šæ¬¡è®¿é—®ä¸åŒçš„APIï¼Œè¿™æ— ç–‘å¢åŠ äº†ç½‘ç»œè¿æ¥çš„å‹åŠ›ã€‚\nç±»å‹ç³»ç»Ÿæè¿°æ‰€æœ‰ï¼š\nGraphQL API åŸºäºç±»å‹å’Œå­—æ®µçš„æ–¹å¼è¿›è¡Œç»„ç»‡ï¼Œè€Œéå…¥å£ç«¯ç‚¹ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªå•ä¸€å…¥å£ç«¯ç‚¹å¾—åˆ°ä½ çš„è®¿é—®æ•°æ®çš„æ‰€æœ‰èƒ½åŠ›ã€‚GraphQL ä½¿ç”¨ç±»å‹æ¥ä¿è¯åº”ç”¨åªè¯·æ±‚å¯èƒ½çš„æ•°æ®ï¼Œå¦åˆ™ä¼šæä¾›äº†æ˜ç¡®çš„æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯ã€‚åº”ç”¨ä¹Ÿå¯ä»¥ä½¿ç”¨ç±»å‹ï¼Œè€Œé¿å…ç¼–å†™æ‰‹åŠ¨è§£æä»£ç ã€‚\nAPIæ— ç‰ˆæœ¬ï¼š\nAPI æ¼”è¿›åªéœ€è¦å¾€ Graphql ç±»å‹ç³»ç»Ÿä¸­æ·»åŠ å­—æ®µå’Œç±»å‹ï¼Œè€Œä¸å½±å“ç°æœ‰æŸ¥è¯¢ã€‚\nç»Ÿä¸€å…±äº«ï¼š\nGraphQL è®©ä½ çš„æ•´ä¸ªåº”ç”¨å…±äº«ä¸€å¥— APIï¼Œè€Œä¸ç”¨è¢«é™åˆ¶äºç‰¹å®šå­˜å‚¨å¼•æ“ã€‚GraphQL å¼•æ“å·²ç»æœ‰å¤šç§è¯­è¨€å®ç°ï¼Œé€šè¿‡ GraphQL API èƒ½å¤Ÿæ›´å¥½åˆ©ç”¨ä½ çš„ç°æœ‰æ•°æ®å’Œä»£ç ã€‚ä½ åªéœ€è¦ä¸ºç±»å‹ç³»ç»Ÿçš„å­—æ®µç¼–å†™å‡½æ•°ï¼ŒGraphQL å°±èƒ½é€šè¿‡ä¼˜åŒ–å¹¶å‘çš„æ–¹å¼æ¥è°ƒç”¨å®ƒä»¬ã€‚\nèµ„æºå®šä¹‰ï¼Œè¯·æ±‚å’Œå“åº” # æ•°æ®æè¿°ï¼š\ntype User { name: String phone: String Friends: [User] } æ•°æ®è¯·æ±‚ï¼š\n{ user(name: \u0026#34;dp\u0026#34;) { phone } } è¯·æ±‚ç»“æœï¼š\n{ \u0026#34;user\u0026#34;: { \u0026#34;phone\u0026#34;: \u0026#34;18800001111\u0026#34; } } å˜é‡ # å˜é‡å‰ç¼€å¿…é¡»ä¸º $ï¼Œåè·Ÿå…¶ç±»å‹ï¼Œä¾‹å¦‚ï¼š$user User\nå˜é‡å¿…é¡»æ˜¯æ ‡é‡ï¼Œæšä¸¾å‹æˆ–è¾“å…¥å¯¹è±¡ç±»å‹ã€‚\nå¦‚æœç±»å‹åæ²¡æœ‰è·Ÿ !ï¼Œè¯´æ˜å˜é‡æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥ä¸ä¼ å…¥å‚æ•°ï¼Œå¦åˆ™å¿…é¡»å‡ºä¼ å…¥ã€‚\né»˜è®¤å˜é‡ï¼š\nquery HeroNameAndFriends($episode: Episode = \u0026#34;JEDI\u0026#34;) { hero(episode: $episode) { name friends { name } } } GraphQLite # æ˜¯ä¸€ä¸ªä¸º GraphQL schema å®šä¹‰æä¾›åŸºäºæ³¨é‡Šçš„è¯­æ³•çš„åº“ã€‚ å®ƒä¸æ¡†æ¶æ— å…³ï¼Œå¯ç”¨äº Symfony å’Œ Laravelã€‚\nSchema # æ–‡æ¡£ # learnï¼š https://graphql.cn/learn/\ncodeï¼š https://graphql.org/code/\nawesome-graphqlï¼š https://github.com/chentsulin/awesome-graphql\n"},{"id":104,"href":"/grpc/","title":"Grpc","section":"","content":" ğŸ  é¦–é¡µ / Grpc\nGrpc # gRPC å®æˆ˜\n"},{"id":105,"href":"/grpc/gRPC/","title":"G Rpc","section":"Grpc","content":" ğŸ  é¦–é¡µ / Grpc / gRPC å®æˆ˜\ngRPC å®æˆ˜ # å‡†å¤‡ # golang 1.13+ Protoc "},{"id":106,"href":"/istio/","title":"Istio","section":"","content":" ğŸ  é¦–é¡µ / Istio\nIstio # Istio\nä½¿ç”¨ aws-acm ç®¡ç† tls å¯†é’¥å’Œè¯ä¹¦\nå®‰è£… Istio\næˆæƒç­–ç•¥ Authorization Policy\nåº”ç”¨å¹³å°å®ç°åº”ç”¨é‡‘ä¸é›€å‘å¸ƒ\nIstio 0-1 ä½¿ç”¨Istioå®ç°Cors\nä½¿ç”¨ Istio å®ç°æœåŠ¡è¶…æ—¶\nåº”ç”¨å±‚çº§è®¾ç½®è®¿é—®ç™½åå•\nå®ç° Https åè®®çš„è½¬å‘\nIstio 0-1 æµé‡ç®¡ç†æ–¹æ¡ˆ\n"},{"id":107,"href":"/istio/aws-acm-tls-management/","title":"Aws Acm Tls Management","section":"Istio","content":" ğŸ  é¦–é¡µ / Istio / ä½¿ç”¨ aws-acm ç®¡ç† tls å¯†é’¥å’Œè¯ä¹¦\nä½¿ç”¨ aws-acm ç®¡ç† tls å¯†é’¥å’Œè¯ä¹¦ # å‚è€ƒï¼š https://medium.com/faun/managing-tls-keys-and-certs-in-istio-using-amazons-acm-8ff9a0b99033\nåœ¨Ingressgateway serviceçš„annotationä¸­æ·»åŠ :\nkind: Service apiVersion: v1 metadata: name: my-ingressgateway namespace: istio-system labels: app: my-ingressgateway annotations: # external-dns.alpha.kubernetes.io/hostname: example.com service.beta.kubernetes.io/aws-load-balancer-backend-protocol: http service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout: \u0026#39;3600\u0026#39; service.beta.kubernetes.io/aws-load-balancer-ssl-cert: \u0026gt;- arn:aws:acm:ap-southeast-1:xxxxxxxxxxxx:certificate/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx service.beta.kubernetes.io/aws-load-balancer-ssl-ports: https .... service.yaml:\napiVersion: v1 kind: Service metadata: name: demo-api labels: app: demop-api spec: ports: - name: http port: 80 targetPort: 80 selector: app: demo-api pod æ‰€åœ¨çš„ namespace éœ€è¦å¼€å¯ istio-injectionï¼Œä¾‹å¦‚ï¼škubectl label namespace default istio-injection=enabled\ngateway.yaml\napiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: demo-api-gateway annotations: ingress.kubernetes.io/force-ssl-redirect: \u0026#34;true\u0026#34; kubernetes.io/ingress.class: \u0026#34;istio-gateway\u0026#34; spec: selector: istio: hpa-ingressgateway # use istio default controller servers: - port: number: 80 name: http protocol: HTTP hosts: - \u0026#34;example.com\u0026#34; tls: httpsRedirect: true # sends 301 redirect for http requests - port: number: 443 name: https protocol: HTTP hosts: - \u0026#34;example.com\u0026#34; example.com æ›¿æ¢æˆä½ è®¿é—®æœåŠ¡çš„åŸŸåï¼›\ntls è®¾ç½®è‡ªåŠ¨è·³è½¬ httpsï¼›\nå°† 443 ç«¯å£è®¾ç½®æˆ HTTP åè®®ï¼Œä½œä¸ºè´Ÿè½½å‡è¡¡å™¨çš„ HTTPS æµé‡çš„ç›®æ ‡ç«¯ã€‚\nvirtual-service.yaml:\napiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: demo-api spec: hosts: # - \u0026#34;demo-api-01.example.dev\u0026#34; - \u0026#34;example.com\u0026#34; gateways: - demo-api-gateway http: - match: - uri: prefix: /api/demo route: - destination: port: number: 80 host: demo-api example.com æ›¿æ¢æˆä½ è®¿é—®æœåŠ¡çš„åŸŸåã€‚\nÂ« Istio\nÂ» å®‰è£… Istio\n"},{"id":108,"href":"/istio/installation/","title":"Installation","section":"Istio","content":" ğŸ  é¦–é¡µ / Istio / å®‰è£… Istio\nå®‰è£… Istio # å®‰è£…istioctl # Step 1 ä¸‹è½½ï¼š\nä»¥ä¸‹æ“ä½œæ­¥éª¤é»˜è®¤ä¼šå®‰è£…æœ€æ–°ç‰ˆ istioctlã€‚\ncurl -L https://istio.io/downloadIstio | sh - ä»¥ä¸Šå‘½ä»¤é»˜è®¤ä¼šå®‰è£…æœ€æ–°ç‰ˆ istioctlï¼Œå¦‚æœéœ€è¦å®‰è£…æŒ‡å®šç‰ˆæœ¬ä¾‹å¦‚ 1.6.8ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ã€‚\ncurl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.6.8 TARGET_ARCH=x86_64 sh - Step 2 é…ç½®ï¼š\nstep 1ä¼šä¸‹è½½istioåŒ…ï¼Œç›®å½•istio-{ISTIO_VERSION}ï¼Œè¿›å…¥ç›®å½•\ncd istio-{ISTIO_VERSION} æ‹·è´binç›®å½•ä¸‹çš„istioctläºŒè¿›åˆ¶æ–‡ä»¶åˆ°PATHç›®å½•ä¸‹ï¼š\ncp bin/istio /usr/local/bin Â« ä½¿ç”¨ aws-acm ç®¡ç† tls å¯†é’¥å’Œè¯ä¹¦\nÂ» æˆæƒç­–ç•¥ Authorization Policy\n"},{"id":109,"href":"/istio/istio-auth-policy/","title":"Istio Auth Policy","section":"Istio","content":" ğŸ  é¦–é¡µ / Istio / æˆæƒç­–ç•¥ Authorization Policy\næˆæƒç­–ç•¥ Authorization Policy # æˆæƒæ¶æ„ # ç”±äºæœåŠ¡ç½‘æ ¼çš„ Sidecar è®¾è®¡æ¨¡å¼ï¼Œæ¯ä¸ªå·¥ä½œè´Ÿè½½éƒ½ä¼šæœ‰ä¸€ä¸ª Envoy ä»£ç†ï¼Œè€Œæ¯ä¸ªä»£ç†éƒ½è¿è¡Œç€æˆæƒå¼•æ“ï¼Œä»¥æ­¤ç»™è¯·æ±‚æˆæƒã€‚æˆæƒå¼•æ“ä¾é æˆæƒç­–ç•¥æ¥é‰´å®šè¯·æ±‚æƒé™ï¼Œè¿”å› ALLOW æˆ– DENY é‰´æƒç»“æœã€‚\næˆæƒå¯ç”¨ # å°†æˆæƒç­–ç•¥åº”ç”¨åˆ°å·¥ä½œè´Ÿè½½å³ç”Ÿæ•ˆè®¿é—®æ§åˆ¶ã€‚å¯¹äºæ²¡æœ‰åº”ç”¨æˆæƒç­–ç•¥çš„å·¥ä½œè´Ÿè½½ï¼Œåˆ™ä¸ä¼šå¯¹è¯·æ±‚åšè®¿é—®æ§åˆ¶ã€‚\næˆæƒç­–ç•¥ # èµ„æºå®šä¹‰ # selectorï¼š\næ ‡ç­¾é€‰æ‹©å™¨ï¼Œé€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨é€‰æ‹©åŒå‘½åç©ºé—´ä¸‹çš„ç›®æ ‡å·¥ä½œè´Ÿè½½ï¼Œå¯¹ç›®æ ‡å·¥ä½œè´Ÿè½½å¯ç”¨è®¿é—®æ§åˆ¶ã€‚\nactionï¼š\nå½“æ»¡è¶³rulesæ¡ä»¶æ—¶ï¼Œæ§åˆ¶ALLOWæˆ–DENYè¯·æ±‚ã€‚\nrulesï¼š\nè®¿é—®æ§åˆ¶çš„è¯·æ±‚æ¡ä»¶ï¼š\nfromï¼šè¯·æ±‚æ¥æº toï¼šè¯·æ±‚ç›®æ ‡ whenï¼šåº”ç”¨è§„åˆ™æ‰€éœ€çš„æäº¤ ç¤ºä¾‹ # ä»¥ä¸‹æˆæƒç­–ç•¥å…è®¸ä¸¤ä¸ªæºï¼ˆæœåŠ¡å¸å· cluster.local/ns/default/sa/sleep å’Œå‘½åç©ºé—´ devï¼‰ï¼Œåœ¨ä½¿ç”¨æœ‰æ•ˆçš„ JWT ä»¤ç‰Œå‘é€è¯·æ±‚æ—¶ï¼Œå¯ä»¥è®¿é—®å‘½åç©ºé—´ foo ä¸­çš„å¸¦æœ‰æ ‡ç­¾ app: httpbin å’Œ version: v1 çš„å·¥ä½œè´Ÿè½½ã€‚\napiVersion: security.istio.io/v1beta1 kind: AuthorizationPolicy metadata: name: httpbin namespace: foo spec: selector: matchLabels: app: httpbin version: v1 action: ALLOW rules: - from: - source: principals: [\u0026#34;cluster.local/ns/default/sa/sleep\u0026#34;] - source: namespaces: [\u0026#34;dev\u0026#34;] to: - operation: methods: [\u0026#34;GET\u0026#34;] when: - key: request.auth.claims[iss] values: [\u0026#34;https://accounts.google.com\u0026#34;] ä¸‹ä¾‹æˆæƒç­–ç•¥ï¼Œå¦‚æœè¯·æ±‚æ¥æºä¸æ˜¯å‘½åç©ºé—´ fooï¼Œè¯·æ±‚å°†è¢«æ‹’ç»ã€‚\napiVersion: security.istio.io/v1beta1 kind: AuthorizationPolicy metadata: name: httpbin-deny namespace: foo spec: selector: matchLabels: app: httpbin version: v1 action: DENY rules: - from: - source: notNamespaces: [\u0026#34;foo\u0026#34;] Â« å®‰è£… Istio\nÂ» åº”ç”¨å¹³å°å®ç°åº”ç”¨é‡‘ä¸é›€å‘å¸ƒ\n"},{"id":110,"href":"/istio/istio-canary-deploy/","title":"Istio Canary Deploy","section":"Istio","content":" ğŸ  é¦–é¡µ / Istio / åº”ç”¨å¹³å°å®ç°åº”ç”¨é‡‘ä¸é›€å‘å¸ƒ\nåº”ç”¨å¹³å°å®ç°åº”ç”¨é‡‘ä¸é›€å‘å¸ƒ # å®ç°æ€è·¯ # åº”ç”¨æ­£å¸¸çš„ CI æµç¨‹æ·»åŠ è¯·æ±‚å‚æ•°ï¼š\nCanaryModeã€boolï¼Œtrue | falseï¼Œç¼ºçœå€¼ falseã€‘ CanaryWeight ã€intï¼Œç¼ºçœå€¼ 10ã€‘ ä½¿ç”¨ Istio çš„ DetinationRule + VirtualService å®ç°æµé‡æŒ‰æƒé‡åˆ†é…åˆ°ä¸åŒç‰ˆæœ¬åº”ç”¨ã€‚\næ¦‚å¿µ # Iterationï¼šå‘å¸ƒè¿­ä»£å·ï¼Œã€‚æ˜¯ä¸€ä¸ªå­—æ®µå€¼ï¼Œä½¿ç”¨é‡‘ä¸é›€å‘å¸ƒæ—¶ç´¯åŠ è¯¥å€¼ï¼Œä» 0 ç´¯åŠ ã€‚\nRetractï¼šåŠ¨ä½œï¼Œå¼ƒç”¨é‡‘ä¸é›€ç‰ˆæœ¬ã€‚å½“é‡‘ä¸é›€ç‰ˆæœ¬å­˜åœ¨ä¸å¯å¿½è§†çš„é—®é¢˜æ—¶æ’¤å›é‡‘ä¸é›€æ‰§è¡Œè¯¥åŠ¨ä½œã€‚\nRatifyï¼šåŠ¨ä½œï¼Œç¡®è®¤ä½¿ç”¨é‡‘ä¸é›€ç‰ˆæœ¬ã€‚å½“é‡‘ä¸é›€ç‰ˆæœ¬ç¡®è®¤å¯ä»¥å…¨é¢æŠ•å…¥ä½¿ç”¨æ‰§è¡Œè¯¥åŠ¨ä½œã€‚\nå‰æ # ä½¿ç”¨é‡‘ä¸é›€å‘å¸ƒçš„å‰ææ¡ä»¶ï¼š\nåº”ç”¨å¤„äºå‘å¸ƒçŠ¶æ€ï¼Œå·²ç»è‡³å°‘å‘å¸ƒä¸€æ¬¡ï¼Œå½“å‰å­˜åœ¨ç¨³å®šçš„è¿è¡Œç‰ˆæœ¬ï¼› åº”ç”¨å·²ç»å¼€å¯ Istio Gatewayï¼Œæ¶‰åŠåˆ° VirtualService çš„æµé‡è½¬å‘ï¼› åº”ç”¨å½“å‰ä¸æ˜¯é‡‘ä¸é›€çŠ¶æ€ï¼Œè¦ä¸ç„¶ä¹±å¥—äº†ã€‚ å‘å¸ƒç»†èŠ‚ # CI å‘å¸ƒé™¤äº†åˆ›å»ºæˆ–æ›´æ–° Deploymentï¼ŒService ä¹‹å¤–ï¼Œé»˜è®¤åˆ›å»ºæˆ–æ›´æ–° istio çš„ DestinationRule èµ„æºï¼›\ndeploymentï¼š\napiVersion: apps/v1 kind: Deployment metadata: name: myapp-pbd3n69-v{iteration} # å‡ºäºå…¼å®¹å†å²å‘å¸ƒï¼Œå½“iterationä¸º0æ—¶ï¼Œnameä¸é™„å¸¦iterationï¼Œiterationå¤§äº0æ—¶ï¼Œnameå°†é™„å¸¦iteration labels: app: myapp-pbd3n69 version: v{iteration} spec: selector: matchLabels: app: myapp-pbd3n69 version: v{iteration} template: metadata: labels: app: myapp-pbd3n69 version: v{iteration} ... serviceï¼š\napiVersion: v1 kind: Service metadata: name: myapp-pbd3n69 spec: selector: app: myapp-pbd3n69 ... destination ruleï¼š\napiVersion: networking.istio.io/v1beta1 kind: DestinationRule metadata: name: myapp-pbd3n69 spec: host: myapp-pbd3n69 # æ³¨æ„ï¼šè¿™é‡Œæ˜¯ Service çš„ name subsets: - labels: version: v{iteration} name: subset-v{iteration} virtual serviceï¼š\napiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: virtual-service-example-com spec: hosts: - example.com http: - match: - uri: prefix: /xxx name: myapp-pbd3n69 route: - destination: host: myapp-pbd3n69 # æ³¨æ„ï¼šè¿™é‡Œæ˜¯ Service çš„ name port: number: 80 subset: subset-v{iteration} weight: 100 ä½¿ç”¨é‡‘ä¸é›€å‘å¸ƒï¼Œæ¶‰åŠåˆ°é‡‘ä¸é›€ç‰ˆæœ¬ Deployment çš„åˆ›å»ºï¼ŒDestinationRule å’Œ VirtualService çš„æ›´æ–°ï¼š\ndeploymentï¼š\napiVersion: apps/v1 kind: Deployment metadata: name: myapp-pbd3n69-v{iteration+1} labels: app: myapp-pbd3n69 version: v{iteration+1} spec: selector: matchLabels: app: myapp-pbd3n69 version: v{iteration+1} template: metadata: labels: app: myapp-pbd3n69 version: v{iteration+1} destination ruleï¼š\napiVersion: networking.istio.io/v1beta1 kind: DestinationRule metadata: name: ash-pbd3n69 namespace: test spec: host: ash-pbd3n69 # æ³¨æ„ï¼šè¿™é‡Œæ˜¯ Service çš„ name subsets: - labels: version: v{iteration} name: subset-v{iteration} - labels: version: v{iteration+1} name: subset-v{iteration+1} virtual serviceï¼š\napiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: virtual-service-example-com spec: hosts: - example.com http: - match: - uri: prefix: /xxx name: myapp-pbd3n69 route: - destination: host: myapp-pbd3n69 # æ³¨æ„ï¼šè¿™é‡Œæ˜¯ Service çš„ name port: number: 80 subset: subset-v{iteration} weight: {canaryWeight} - destination: host: myapp-pbd3n69 # æ³¨æ„ï¼šè¿™é‡Œæ˜¯ Service çš„ name port: number: 80 subset: subset-v{iteration+1} weight: {100-canaryWeight} å‘å¸ƒå®Œæˆåï¼ŒIteration+1ï¼Œåº”ç”¨çŠ¶æ€æ›´æ–°ä¸º Canaryã€‚åœ¨ Canary çŠ¶æ€ä¸‹ï¼Œç”±äºå­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬çš„ Deploymentï¼Œå°†æ— æ³•æ‰‹åŠ¨åº”ç”¨å‚ç›´æˆ–æ°´å¹³æ‰©å®¹ã€‚\næ’¤å›ï¼ˆRetractï¼‰ # åˆ é™¤é‡‘ä¸é›€ç‰ˆæœ¬çš„ Deploymentï¼Œ\nDestinationRule æ›´æ–°\napiVersion: networking.istio.io/v1beta1 kind: DestinationRule metadata: name: ash-pbd3n69 namespace: test spec: host: ash-pbd3n69 # æ³¨æ„ï¼šè¿™é‡Œæ˜¯ Service çš„ name subsets: - labels: version: v{iteration-1} name: subset-v{iteration-1} VirtualService æ›´æ–°\napiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: virtual-service-example-com spec: hosts: - example.com http: - match: - uri: prefix: /xxx name: myapp-pbd3n69 route: - destination: host: myapp-pbd3n69 # æ³¨æ„ï¼šè¿™é‡Œæ˜¯ Service çš„ name port: number: 80 subset: subset-v{iteration-1} weight: 100 Iteration-1\næ‰¹å‡†ï¼ˆRatifyï¼‰ # åˆ é™¤ä¹‹å‰ç¨³å®šç‰ˆæœ¬çš„ Deploymentï¼Œ\nDestinationRule æ›´æ–°\napiVersion: networking.istio.io/v1beta1 kind: DestinationRule metadata: name: ash-pbd3n69 namespace: test spec: host: ash-pbd3n69 # æ³¨æ„ï¼šè¿™é‡Œæ˜¯ Service çš„ name subsets: - labels: version: v{iteration} name: subset-v{iteration} VirtualService æ›´æ–°\napiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: virtual-service-example-com spec: hosts: - example.com http: - match: - uri: prefix: /xxx name: myapp-pbd3n69 route: - destination: host: myapp-pbd3n69 # æ³¨æ„ï¼šè¿™é‡Œæ˜¯ Service çš„ name port: number: 80 subset: subset-v{iteration} weight: 100 Â« æˆæƒç­–ç•¥ Authorization Policy\nÂ» Istio 0-1 ä½¿ç”¨Istioå®ç°Cors\n"},{"id":111,"href":"/istio/istio-cors/","title":"Istio Cors","section":"Istio","content":" ğŸ  é¦–é¡µ / Istio / Istio 0-1 ä½¿ç”¨Istioå®ç°Cors\nIstio 0-1 ä½¿ç”¨Istioå®ç°Cors # Cors # Corsï¼ˆCross-Origin Resource Sharingï¼‰ï¼šè·¨åŸŸèµ„æºå…±äº«ï¼Œæ˜¯ä¸€ç§åŸºäº HTTP Header çš„æœºåˆ¶ï¼Œè¯¥æœºåˆ¶é€šè¿‡å…è®¸æœåŠ¡å™¨æ ‡ç¤ºé™¤äº†å®ƒè‡ªå·±ä»¥å¤–çš„å…¶å®ƒ originï¼ˆåŸŸï¼Œåè®®å’Œç«¯å£ï¼‰ï¼Œè¿™æ ·æµè§ˆå™¨å¯ä»¥è®¿é—®åŠ è½½è¿™äº›èµ„æºã€‚è·¨æºèµ„æºå…±äº«è¿˜é€šè¿‡ä¸€ç§æœºåˆ¶æ¥æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦ä¼šå…è®¸è¦å‘é€çš„çœŸå®è¯·æ±‚ï¼Œè¯¥æœºåˆ¶é€šè¿‡æµè§ˆå™¨å‘èµ·ä¸€ä¸ªåˆ°æœåŠ¡å™¨æ‰˜ç®¡çš„è·¨æºèµ„æºçš„\u0026quot;é¢„æ£€\u0026quot;è¯·æ±‚ã€‚åœ¨é¢„æ£€ä¸­ï¼Œæµè§ˆå™¨å‘é€çš„å¤´ä¸­æ ‡ç¤ºæœ‰ HTTP æ–¹æ³•å’ŒçœŸå®è¯·æ±‚ä¸­ä¼šç”¨åˆ°çš„å¤´ã€‚\nè·¨æºHTTPè¯·æ±‚çš„ä¸€ä¸ªä¾‹å­ï¼šè¿è¡Œåœ¨ https://a.com çš„JavaScriptä»£ç ä½¿ç”¨ XMLHttpRequestæ¥å‘èµ·ä¸€ä¸ªåˆ° https://b.com/data.js çš„è¯·æ±‚ã€‚\nå‡ºäºå®‰å…¨æ€§ï¼Œæµè§ˆå™¨é™åˆ¶è„šæœ¬å†…å‘èµ·çš„è·¨åŸŸ HTTP è¯·æ±‚ã€‚ ä¾‹å¦‚ï¼ŒXMLHttpRequest å’Œ Fetch API éµå¾ªåŒæºç­–ç•¥ã€‚ è¿™æ„å‘³ç€ä½¿ç”¨è¿™äº› API çš„ Web åº”ç”¨ç¨‹åºåªèƒ½ä»åŠ è½½åº”ç”¨ç¨‹åºçš„åŒä¸€ä¸ªåŸŸè¯·æ±‚ HTTP èµ„æºï¼Œé™¤éå“åº”æŠ¥æ–‡åŒ…å«äº†æ­£ç¡® CORS å“åº”å¤´ã€‚\næ›´å¤š Cors çŸ¥è¯†ï¼š è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰\nIstio å®ç° # åŸºäº Istio VirtualService çš„é…ç½®å®ç°ã€‚\nå®˜æ–¹æ–‡æ¡£ï¼š Istio / Virtual Service#CorsPolicy\nåœ¨ç›®æ ‡æœåŠ¡ä¸Šè®¾ç½®å…è®¸çš„è¯·æ±‚åŸŸ Helloï¼š\napiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: b spec: http: - route: - destination: host: b.default.svc.cluster.local corsPolicy: allowOrigins: - exact: https://a.com - exact: https://b.com allowMethods: - GET é…ç½® allowOrigins ä»¥åŠ allowMethodsã€‚\nÂ« åº”ç”¨å¹³å°å®ç°åº”ç”¨é‡‘ä¸é›€å‘å¸ƒ\nÂ» ä½¿ç”¨ Istio å®ç°æœåŠ¡è¶…æ—¶\n"},{"id":112,"href":"/istio/istio-timeout/","title":"Istio Timeout","section":"Istio","content":" ğŸ  é¦–é¡µ / Istio / ä½¿ç”¨ Istio å®ç°æœåŠ¡è¶…æ—¶\nä½¿ç”¨ Istio å®ç°æœåŠ¡è¶…æ—¶ # å‚è€ƒ # https://www.servicemesher.com/blog/circuit-breaking-and-outlier-detection-in-istio/ è¶…æ—¶ # ä¸ºäº†é˜²æ­¢æ— é™æœŸçš„ç­‰å¾…æœåŠ¡ï¼Œä¸€èˆ¬éƒ½ä¼šç»™æœåŠ¡è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ŒAWS çš„ LoadBalancer é»˜è®¤çš„è¶…æ—¶æ—¶é—´æ˜¯ 60sã€‚ä½†æ˜¯ä¸åŒçš„æœåŠ¡ï¼Œå¯èƒ½éœ€è¦ä¸åŒçš„è¶…æ—¶è®¾ç½®ï¼Œä¾‹å¦‚ DocumentApi è¶…æ—¶æ—¶é—´å¯èƒ½éœ€è¦è®¾ç½®çš„é•¿ä¸€ç‚¹ã€‚\nLoadBalancer çš„è¶…æ—¶æ˜¯å…¨å±€çš„ï¼Œæˆ‘ä»¬åŸºäº Istio æœåŠ¡ç½‘æ ¼é›†æˆäº†é’ˆå¯¹å•ä¸ªæœåŠ¡çš„è¶…æ—¶åŠŸèƒ½ã€‚\né‡è¯• # é‡è¯•ä¹Ÿæ˜¯ä¸€ä¸ªæœåŠ¡å¾ˆå¸¸ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æŸæ¬¡è¯·æ±‚åˆ†é…åˆ°äº†ä¸€ä¸ªé—®é¢˜èŠ‚ç‚¹ï¼Œè¯·æ±‚å¤±è´¥ï¼Œåˆ™è‡ªåŠ¨é‡è¯•ç‰¹å®šæ¬¡æ•°ã€‚\nç†”æ–­/é™æµ # ä¸ºäº†é˜²æ­¢å¤§é‡æ¶Œå…¥è¯·æ±‚ä½¿å¾—æœåŠ¡å´©æºƒï¼Œå¼•å…¥ç†”æ–­åŠŸèƒ½ã€‚ç†”æ–­ï¼Œå¯ä»¥é™åˆ¶å½“å‰è¯·æ±‚è¿æ¥æ•°åœ¨ä¸€ä¸ªç‰¹å®šèŒƒå›´å†…ã€‚\né…ç½®æœåŠ¡ VirtualService æ—¢å¯å®ç°ï¼š\napiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: myapp spec: hosts: - myapp http: - route: - destination: host: myapp subset: v1 timeout: 1s timeoutï¼šè¯·æ±‚è¶…è¿‡è®¾å®šçš„è¶…æ—¶æ—¶é—´ï¼Œå“åº”è¿”å› 504 è¯·æ±‚è¶…æ—¶ã€‚\nÂ« Istio 0-1 ä½¿ç”¨Istioå®ç°Cors\nÂ» åº”ç”¨å±‚çº§è®¾ç½®è®¿é—®ç™½åå•\n"},{"id":113,"href":"/istio/istio-white-manifest/","title":"Istio White Manifest","section":"Istio","content":" ğŸ  é¦–é¡µ / Istio / åº”ç”¨å±‚çº§è®¾ç½®è®¿é—®ç™½åå•\nåº”ç”¨å±‚çº§è®¾ç½®è®¿é—®ç™½åå• # éœ€æ±‚ # ä¸¤ä¸ªåº”ç”¨ï¼Œfoo å’Œ barï¼Œåº”ç”¨ foo åªå…è®¸ IP åœ°å€ä¸º 1.2.3.4 è®¿é—®ï¼Œåº”ç”¨ bar åªå…è®¸ IP åœ°å€ä¸º 5.6.7.8 è®¿é—®ã€‚\nå®ç° # åŸºäº istio çš„ AuthorizationPolicy å®ç°ã€‚\nå‡è®¾ï¼Œç°åœ¨ K8s é›†ç¾¤ä¸­å·²ç»å®‰è£… istioï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œç€çš„ istio-ingressgateway è½¬å‘åº”ç”¨ foo å’Œ barï¼š\né€šè¿‡ï¼š https://www.example.com/foo è®¿é—® foo;\né€šè¿‡ï¼š https://www.example.com/bar è®¿é—® bar;\næ’æ›² # æŒ‰ç…§ istio å®˜æ–¹æ–‡æ¡£ï¼Œä½¿ç”¨ AuthorizationPolicy å³å¯å®ç°åŸºäºåº”ç”¨å±‚çº§çš„è®¿é—®ç™½åå•è®¾ç½®ï¼š\napiVersion: security.istio.io/v1beta1 kind: AuthorizationPolicy metadata: name: foo spec: selector: matchLabels: app: foo action: ALLOW rules: - from: - source: ipBlocks: [\u0026#34;1.2.3.4\u0026#34;] æƒ³è®©ä»¥ä¸ŠAuthorizationPolicyç”Ÿæ•ˆï¼Œéœ€è¦åœ¨ foo å·¥ä½œè´Ÿè½½æ‰€åœ¨çš„å‘½åç©ºé—´æ³¨å…¥ istio-proxyï¼Œé€šè¿‡ç»™å‘½åç©ºé—´æ·»åŠ  labelï¼Œæ·»åŠ  lable åï¼Œå·¥ä½œè´Ÿè½½å¯åŠ¨æ–°çš„ Pod ä¼šè‡ªåŠ¨æ³¨å…¥ istio-proxy å®¹å™¨ï¼š\nkubectl label namespace default istio-injection=enabled ä½†æ˜¯ï¼Œä½ ä¼šå‘ç°ä½ ä½¿ç”¨ https://www.example.com/foo ä¸€ç›´è¿”å›çš„ä¿¡æ¯éƒ½æ˜¯ RBAC: access deniedã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ\nå¦‚æœä½ åœ¨ ipBlocks ä¸­åŠ å…¥ istio-ingressgatewayï¼ˆæ˜¯ä¸€ä¸ª Deploymentï¼‰Pod çš„ IPï¼Œä½ ä¼šå‘ç°è¿™æ—¶å€™æ˜¯å¯ä»¥æˆåŠŸè®¿é—®çš„ã€‚\nåˆ†ææµé‡çš„è½¬å‘è·¯å¾„åº”è¯¥å°±èƒ½çŸ¥é“ï¼Œå®é™…ä¸Šåˆ°è¾¾ç›®æ ‡åº”ç”¨ foo çš„è¯·æ±‚ï¼Œéƒ½ç”±istio-ingressgatewayè½¬å‘äº†ï¼Œæ‰€ä»¥æº IP éƒ½ä¼šæ˜¯ istio-ingressgateway Pod çš„ IPï¼Œä»è€Œå¯¼è‡´å¤–éƒ¨è®¿é—® IP çš„ç™½åå•è®¾ç½®æ— æ³•ç”Ÿæ•ˆã€‚\né‚£ä¹ˆå¦‚æœè·å–å¤–éƒ¨IPå‘¢ã€‚\næœ€ç»ˆæ–¹æ¡ˆ # Step 0: è·å–å®¢æˆ·ç«¯æºIPï¼š\nå¦‚æœä½¿ç”¨ AWS-EKS åˆ›å»º istio-ingressgateway æœåŠ¡æ—¶é»˜è®¤åˆ›å»ºçš„ classic ç±»å‹çš„ LoadBalancerï¼Œéœ€è¦ä¿®æ”¹æˆ networkç±»å‹ï¼š\né€šè¿‡å‘ istio-ingressgateway Service æ·»åŠ  annotationï¼šservice.beta.kubernetes.io/aws-load-balancer-type: nlb\næ›´æ–° istio-gateway Serviceï¼šspec.externalTrafficPolicy: Localï¼Œç°åœ¨è®¿é—®å·¥ä½œè´Ÿè½½å¯ä»¥è·å–åˆ°æº IPï¼Œè¿™å°±ä¸ºæˆ‘ä»¬è®¾ç½® IP ç™½åå•é€ å°±äº†æ¡ä»¶ã€‚\nç°åœ¨åªéœ€è¦ä¸ºè¿™ä¸ª istio-ingressgateway åº”ç”¨ä¸Š AuthorizationPolicy å³å¯ï¼š\nStep 1: é»˜è®¤å…è®¸æ‰€æœ‰ IP è®¿é—® istio-ingressgatewayï¼š\napiVersion: security.istio.io/v1beta1 kind: AuthorizationPolicy metadata: name: allow-all-for-istio-ingressgateway namespace: istio-system spec: selector: matchLabels: istio: ingressgateway action: ALLOW rules: - from: - source: ipBlocks: [\u0026#34;0.0.0.0/0\u0026#34;] é»˜è®¤æ˜¯å…è®¸æ‰€æœ‰ IP éƒ½å¯ä»¥è®¿é—® istio-ingressgateway ä¸‹è½¬å‘çš„æœåŠ¡çš„ï¼Œå¦‚æœæœ‰æœåŠ¡ä¾‹å¦‚ foo å’Œ bar éœ€è¦å•ç‹¬æ·»åŠ  IP è®¿é—®ç™¾åå•åˆ™ç»§ç»­å‚è€ƒä¸‹é¢çš„æ­¥éª¤ã€‚\nStep 2: åªå…è®¸ IP 1.2.3.4 è®¿é—® fooï¼š\napiVersion: security.istio.io/v1beta1 kind: AuthorizationPolicy metadata: name: foo namespace: istio-system spec: selector: matchLabels: istio: ingressgateway action: DENY rules: - from: - source: notIpBlocks: [\u0026#34;1.2.3.4\u0026#34;] to: - operation: hosts: - www.example.com paths: - /foo - /foo/* ç”±äºé»˜è®¤æ˜¯å…è®¸æ‰€æœ‰ IP éƒ½å¯ä»¥è®¿é—® istio-ingressgateway ä¸‹è½¬å‘çš„æœåŠ¡ï¼Œæ‰€ä»¥ä¸ºå•ç‹¬åº”ç”¨è®¾ç½®è®¿é—®ç™¾åçš„æ—¶å€™ä½¿ç”¨ DENY + notIpBlocks æ¥å®Œæˆã€‚\nipBlocks å’Œ notIpBlocks å…è®¸é…ç½®IPå’ŒIPçš„CIDRï¼Œä¾‹å¦‚ï¼š1.2.3.4 æˆ– 1.2.3.4/24ã€‚\nStep 3: åªå…è®¸ IP 5.6.7.8 è®¿é—® barï¼š\napiVersion: security.istio.io/v1beta1 kind: AuthorizationPolicy metadata: name: bar namespace: istio-system spec: selector: matchLabels: istio: ingressgateway action: DENY rules: - from: - source: notIpBlocks: [\u0026#34;5.6.7.8\u0026#34;] to: - operation: hosts: - www.example.com paths: - /bar - /bar/* é™„å½• # å¦‚æœç›¸åŒçš„ LoadBalancer ä¸‹çš„æœåŠ¡éƒ½æ˜¯ç”¨åŒä¸€ç™½åå•è®¾ç½®çš„è¯ï¼Œåˆ™æ²¡å¿…è¦è¿™ä¹ˆéº»çƒ¦çš„è®¾ç½® AuthorizationPolicy äº†ï¼Œåªéœ€è¦ä¸º Service è®¾ç½®å‚æ•°å³å¯ï¼š\napiVersion: v1 kind: Service metadata: name: istio-gateway ... spec: type: LoadBalancer loadBalancerSourceRanges: - \u0026#34;1.2.3.4/24\u0026#34; ... Â« ä½¿ç”¨ Istio å®ç°æœåŠ¡è¶…æ—¶\nÂ» å®ç° Https åè®®çš„è½¬å‘\n"},{"id":114,"href":"/istio/Istio/","title":"Istio","section":"Istio","content":" ğŸ  é¦–é¡µ / Istio / Istio\nIstio # ç®€ä»‹ # Istioï¼Œæ˜¯ä¸€ç§æœåŠ¡ç½‘æ ¼çš„å¹³å°ã€‚åœ¨å¾®æœåŠ¡ç³»ç»Ÿä¸­èµ·ç€è¿æ¥ï¼Œä¿æŠ¤ï¼Œæ§åˆ¶å’Œè§‚å¯ŸæœåŠ¡çš„ä½œç”¨ã€‚å®ƒå¯ä»¥é™ä½å¾®æœåŠ¡éƒ¨ç½²çš„å¤æ‚ç¨‹åº¦ï¼Œå‡è½»å¼€å‘å›¢é˜Ÿå‹åŠ›ï¼Œæ— ç¼æ¥å…¥ç°æœ‰åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºï¼Œå¯ä»¥é›†æˆæ—¥å¿—ï¼Œé¥æµ‹ï¼Œå’Œç­–ç•¥ç³»ç»Ÿçš„ API æ¥å£ã€‚\næœåŠ¡ç½‘æ ¼ï¼š\nService Mesh æ˜¯ä¸€ä¸ªåŸºç¡€è®¾æ–½å±‚ï¼Œç”¨äºå¤„ç†æœåŠ¡é—´é€šä¿¡ã€‚äº‘åŸç”Ÿåº”ç”¨æœ‰ç€å¤æ‚çš„æœåŠ¡æ‹“æ‰‘ï¼ŒService Mesh ä¿è¯è¯·æ±‚å¯ä»¥åœ¨è¿™äº›æ‹“æ‰‘ä¸­å¯é åœ°ç©¿æ¢­ã€‚åœ¨å®é™…åº”ç”¨å½“ä¸­ï¼ŒService Mesh é€šå¸¸æ˜¯ç”±ä¸€ç³»åˆ—è½»é‡çº§çš„ç½‘ç»œä»£ç†ç»„æˆçš„ï¼Œå®ƒä»¬ä¸åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä½†åº”ç”¨ç¨‹åºä¸éœ€è¦çŸ¥é“å®ƒä»¬çš„å­˜åœ¨ã€‚\nç”¨æ¥æè¿°ç»„æˆåº”ç”¨ç¨‹åºçš„å¾®æœåŠ¡ç½‘ç»œä»¥åŠå®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚\nå®ç°éœ€æ±‚åŒ…æ‹¬ï¼š\næœåŠ¡å‘ç° è´Ÿè½½å‡è¡¡ æ•…éšœæ¢å¤ æŒ‡æ ‡å’Œç›‘æ§ A/B æµ‹è¯• é‡‘ä¸é›€å‘å¸ƒ é€Ÿç‡æ§åˆ¶ è®¿é—®æ§åˆ¶ ç«¯åˆ°ç«¯è®¤è¯ istioctl # ç®¡ç† istio çš„å‘½ä»¤è¡Œå·¥å…·ã€‚\nå®‰è£… # curl -L https://istio.io/downloadIstio | sh - cp istio-x.x.x /usr/local cd istio-x.x.x export PATH=$PWD/bin:$PATH Istio çš„ç»å¤§å¤šæ•°æ²»ç†èƒ½åŠ›éƒ½æ˜¯åœ¨ Sidecar è€Œéåº”ç”¨ç¨‹åºä¸­å®ç°ï¼Œå› æ­¤æ˜¯éä¾µå…¥çš„ï¼› Istio çš„è°ƒç”¨é“¾åŸ‹ç‚¹é€»è¾‘ä¹Ÿæ˜¯åœ¨ Sidecar ä»£ç†ä¸­å®Œæˆï¼Œå¯¹åº”ç”¨ç¨‹åºéä¾µå…¥ï¼Œä½†åº”ç”¨ç¨‹åºéœ€åšé€‚å½“çš„ä¿®æ”¹ï¼Œå³é…åˆåœ¨è¯·æ±‚å¤´ä¸Šä¼ é€’ç”Ÿæˆçš„ Trace ç›¸å…³ä¿¡æ¯ã€‚ å…³é”®åŠŸèƒ½ï¼š\næµé‡ç®¡ç† å¯è§‚å¯Ÿæ€§ ç­–ç•¥æ‰§è¡Œ æœåŠ¡èº«ä»½å’Œå®‰å…¨ å¹³å°æ”¯æŒ é›†æˆå’Œå®šåˆ¶ æ¶æ„ # æ•°æ®é¢æ¿ # Envoy # Envoy æ˜¯ç”¨ C++ å¼€å‘çš„é«˜æ€§èƒ½ä»£ç†ï¼Œç”¨äºåè°ƒæœåŠ¡ç½‘æ ¼ä¸­æ‰€æœ‰æœåŠ¡çš„å…¥ç«™å’Œå‡ºç«™æµé‡ã€‚Envoy ä»£ç†æ˜¯å”¯ä¸€ä¸æ•°æ®å¹³é¢æµé‡äº¤äº’çš„ Istio ç»„ä»¶ã€‚\næ§åˆ¶é¢æ¿ # Pilot # ä¸º Envoy sidecar æä¾›æœåŠ¡å‘ç°ã€ç”¨äºæ™ºèƒ½è·¯ç”±çš„æµé‡ç®¡ç†åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼ŒA/B æµ‹è¯•ã€é‡‘ä¸é›€å‘å¸ƒç­‰ï¼‰ä»¥åŠå¼¹æ€§åŠŸèƒ½ï¼ˆè¶…æ—¶ã€é‡è¯•ã€ç†”æ–­å™¨ç­‰ï¼‰ã€‚\nç»“æ„ï¼š\nAbstract Model Platform Adapter åŠŸèƒ½ï¼š\nè¯·æ±‚è·¯ç”± æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ æ•…éšœå¤„ç† æ•…éšœæ³¨å…¥ è§„åˆ™é…ç½® Citadel # é€šè¿‡å†…ç½®çš„èº«ä»½å’Œè¯ä¹¦ç®¡ç†ï¼Œå¯ä»¥æ”¯æŒå¼ºå¤§çš„æœåŠ¡åˆ°æœåŠ¡ä»¥åŠæœ€ç»ˆç”¨æˆ·çš„èº«ä»½éªŒè¯ã€‚\nGalley # æ˜¯ Istio çš„é…ç½®éªŒè¯ã€æå–ã€å¤„ç†å’Œåˆ†å‘ç»„ä»¶ã€‚å®ƒè´Ÿè´£å°†å…¶ä½™çš„ Istio ç»„ä»¶ä¸ä»åº•å±‚å¹³å°ï¼ˆä¾‹å¦‚ Kubernetesï¼‰è·å–ç”¨æˆ·é…ç½®çš„ç»†èŠ‚éš”ç¦»å¼€æ¥ã€‚\nMixer # æµé‡ç®¡ç† # æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ŒæœåŠ¡å‘ç°ç³»ç»Ÿï¼Œé»˜è®¤è½®è¯¢ç­–ç•¥ è´Ÿè½½å‡è¡¡æ± \nè™šæ‹ŸæœåŠ¡ï¼ˆVirtual Serviceï¼‰ # è™šæ‹ŸæœåŠ¡è®©æ‚¨é…ç½®å¦‚ä½•åœ¨æœåŠ¡ç½‘æ ¼å†…å°†è¯·æ±‚è·¯ç”±åˆ°æœåŠ¡ï¼Œè¿™åŸºäº Istio å’Œå¹³å°æä¾›çš„åŸºæœ¬çš„è¿é€šæ€§å’ŒæœåŠ¡å‘ç°èƒ½åŠ›ã€‚\nç¤ºä¾‹ï¼š\napiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: reviews spec: hosts: - reviews gateway: http: - match: - headers: end-user: exact: jason route: - destination: host: reviews subset: v2 - route: - destination: host: reviews subset: v3 è·¯ç”±è§„åˆ™ # - match: - headers: end-user: exact: jason - match: - uri: prefix: /reviews è·¯ç”±è§„åˆ™çš„ä¼˜å…ˆçº§ï¼šä»ä¸Šå¾€ä¸‹ï¼Œæ»¡è¶³è§„åˆ™å³æµå‘è·¯ç”±ç›®æ ‡\nDestination # route: - destination: host: reviews subset: v1 weight: 90 - destination: host: reviews subset: v2 weight: 10 ç›®æ ‡è§„åˆ™ï¼ˆDestination Ruleï¼‰ # Deployment =\u0026gt; Pod =\u0026gt; Service =\u0026gt; DestinationRule =\u0026gt; VirtualService=\u0026gt; Gateway\nè´Ÿè½½å‡è¡¡çš„å­é›†\napiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: my-destination-rule spec: host: my-svc trafficPolicy: loadBalancer: simple: RANDOM subsets: - name: v1 labels: version: v1 - name: v2 labels: version: v2 trafficPolicy: loadBalancer: simple: ROUND_ROBIN - name: v3 labels: version: v3 å­é›†åŸºäºä¸€ä¸ªæˆ–å¤šä¸ª labels\nsubsets.trafficPolicy.loadBalancer.simple æŒ‡å®šè®¿é—® Service åç«¯çš„ endpoint çš„æµé‡ç­–ç•¥ã€‚RANDOMï¼šéšæœºï¼ŒROUND_ROBINï¼šè½®è¯¢ã€‚\nç½‘å…³ï¼ˆGatewayï¼‰ # ä¸ºç½‘æ ¼æ¥ç®¡ç†å…¥ç«™å’Œå‡ºç«™æµé‡ï¼Œå¯ä»¥è®©æ‚¨æŒ‡å®šè¦è¿›å…¥æˆ–ç¦»å¼€ç½‘æ ¼çš„æµé‡ã€‚\napiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: ext-host-gwy spec: selector: app: my-gateway-controller servers: - port: number: 443 name: https protocol: HTTPS hosts: - ext-host.example.com tls: mode: SIMPLE serverCertificate: /tmp/tls.crt privateKey: /tmp/tls.key å°†æŒ‡å®š host çš„æµé‡æµå…¥ç½‘æ ¼ï¼Œç„¶åå°†ç½‘å…³ç»‘å®šåˆ° VirtualService ä¸Šè¿›è¡Œè·¯ç”±è§„åˆ™çš„æŒ‡å®šã€‚\næœåŠ¡å…¥å£ï¼ˆService Entryï¼‰ # apiVersion: networking.istio.io/v1alpha3 kind: ServiceEntry metadata: name: svc-entry spec: hosts: - ext-svc.example.com ports: - number: 443 name: https protocol: HTTPS location: MESH_EXTERNAL resolution: DNS Sidecar # ç½‘ç»œå¼¹æ€§å’Œæµ‹è¯• # è¶…æ—¶ # apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: ratings spec: hosts: - ratings http: - route: - destination: host: ratings subset: v1 timeout: 10s ä¸‹é¢çš„ç¤ºä¾‹æ˜¯ä¸€ä¸ªè™šæ‹ŸæœåŠ¡ï¼Œå®ƒå¯¹ ratings æœåŠ¡çš„ v1 å­é›†çš„è°ƒç”¨æŒ‡å®š 10 ç§’è¶…æ—¶ã€‚\né‡è¯• # apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: ratings spec: hosts: - ratings http: - route: - destination: host: ratings subset: v1 retries: attempts: 3 perTryTimeout: 2s ä¸‹é¢çš„ç¤ºä¾‹é…ç½®äº†åœ¨åˆå§‹è°ƒç”¨å¤±è´¥åæœ€å¤šé‡è¯• 3 æ¬¡æ¥è¿æ¥åˆ°æœåŠ¡å­é›†ï¼Œæ¯ä¸ªé‡è¯•éƒ½æœ‰ 2 ç§’çš„è¶…æ—¶ã€‚\nç†”æ–­ # apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: reviews spec: host: reviews subsets: - name: v1 labels: version: v1 trafficPolicy: connectionPool: tcp: maxConnections: 100 åˆ°è¾¾ç›®æ ‡ä¸»æœºçš„è¯·æ±‚è¶…è¿‡é¢„è®¾å€¼ï¼Œåˆ™è§¦å‘ç†”æ–­ï¼Œåœæ­¢è¯·æ±‚è¿æ¥åˆ°è¯¥ä¸»æœºã€‚\næ•…éšœæ³¨å…¥ï¼ˆæ··æ²Œå·¥ç¨‹ï¼‰ # apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: ratings spec: hosts: - ratings http: - fault: delay: percentage: value: 50 fixedDelay: 5s route: - destination: host: ratings subset: v1 ä¸‹é¢çš„è™šæ‹ŸæœåŠ¡ä¸ºç™¾åˆ†ä¹‹äº”åçš„è®¿é—® ratings æœåŠ¡çš„è¯·æ±‚é…ç½®äº†ä¸€ä¸ª 5 ç§’çš„å»¶è¿Ÿã€‚\napiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: ratings spec: hosts: - ratings http: - fault: abort: httpStatus: 500 percentage: value: 100 route: - destination: host: ratings subset: v1 ä¸‹é¢çš„è™šæ‹ŸæœåŠ¡ä¸ºæ‰€æœ‰è®¿é—® ratings æœåŠ¡çš„è¯·æ±‚é…ç½®äº†ä¸€ä¸ªä¸­æ­¢å“åº”ã€‚\næµé‡è½¬ç§» # é€æ­¥è°ƒæ•´ç™¾åˆ†æ¯”çš„æµé‡ï¼Œå®Œæˆç”±éƒ¨åˆ†è·¯ç”±åˆ°å®Œå…¨è·¯ç”±çš„è¿ç§»å‡çº§ã€‚\nå¦‚ï¼šv1 80% + v2 20% =\u0026gt; v2 100%\nè®°å½• # ç®¡ç† ingressgateway https è¿æ¥ä½¿ç”¨AWSçš„ TLS å¯†é’¥å’Œè¯ä¹¦ã€‚\nkind: Service apiVersion: v1 metadata: name: istio-ingressgateway namespace: istio-system ... annotations: ... service.beta.kubernetes.io/aws-load-balancer-backend-protocol: tcp service.beta.kubernetes.io/aws-load-balancer-ssl-cert: \u0026gt;- arn:aws:acm:ap-southeast-1:314566904004:certificate/379dd055-44a7-42b6-a303-84938146b304 service.beta.kubernetes.io/aws-load-balancer-ssl-ports: https Gatewayï¼š\napiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: demo-gateway spec: selector: istio: ingressgateway servers: - port: number: 80 name: http protocol: HTTP hosts: - \u0026#34;*\u0026#34; tls: httpsRedirect: true # sends 301 redirect for http requests - port: number: 443 name: https-443 protocol: HTTP hosts: - \u0026#34;*\u0026#34; Â» ä½¿ç”¨ aws-acm ç®¡ç† tls å¯†é’¥å’Œè¯ä¹¦\n"},{"id":115,"href":"/istio/tls-transform/","title":"Tls Transform","section":"Istio","content":" ğŸ  é¦–é¡µ / Istio / å®ç° Https åè®®çš„è½¬å‘\nå®ç° Https åè®®çš„è½¬å‘ # apiVersion: networking.istio.io/v1beta1 kind: VirtualService metadata: name: demo spec: http: - headers: request: set: X-Forwarded-Proto: https match: - uri: prefix: / name: demo.default Â« åº”ç”¨å±‚çº§è®¾ç½®è®¿é—®ç™½åå•\nÂ» Istio 0-1 æµé‡ç®¡ç†æ–¹æ¡ˆ\n"},{"id":116,"href":"/istio/traffic-management/","title":"Traffic Management","section":"Istio","content":" ğŸ  é¦–é¡µ / Istio / Istio 0-1 æµé‡ç®¡ç†æ–¹æ¡ˆ\nIstio 0-1 æµé‡ç®¡ç†æ–¹æ¡ˆ # è®¾ç½® istio-system å‘½åç©ºé—´ä¸‹ istiod Deployment çš„ç¯å¢ƒå˜é‡ï¼š\nPILOT_ENABLE_VIRTUAL_SERVICE_DELEGATE =trueï¼š\nÂ« å®ç° Https åè®®çš„è½¬å‘\n"},{"id":117,"href":"/kubernetes/","title":"Kubernetes","section":"","content":" ğŸ  é¦–é¡µ / Kubernetes\nKubernetes # åäº²å’Œæ€§æé«˜æœåŠ¡å¯ç”¨æ€§\napiserver-builder\napiserver\näºŒè¿›åˆ¶æ­å»º K8s - 1 æœºå™¨å‡†å¤‡\näºŒè¿›åˆ¶æ­å»º K8s - 2 éƒ¨ç½² etcd é›†ç¾¤\näºŒè¿›åˆ¶æ­å»º K8s - 3 éƒ¨ç½² Master\näºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node\nKubernetes 0-1 å°è¯•ç†è§£äº‘åŸç”Ÿ\né›†ç¾¤è”é‚¦\näº†è§£ ConfigMap\nå®šæœŸåˆ é™¤ ElasticSearch æ—¥å¿—ç´¢å¼•\nå¼ºåˆ¶åˆ é™¤ K8s èµ„æº\nGateway API å®è·µ\nKubernetes 0-1 Helm Kubernetes çš„åŒ…ç®¡ç†å·¥å…·\nKubernetes 0-1 å®ç°Podè‡ªåŠ¨æ‰©ç¼©HPA\nHTTP å®¢æˆ·ç«¯è°ƒç”¨ Kubernetes APIServer\nInformer\né€šè¿‡ Ingress è¿›è¡Œç°åº¦å‘å¸ƒ\nå®‰è£… Kubernetes\nK3s\nKubernetes 0-1 K8séƒ¨ç½²coredns\nKubernetes 0-1 K8séƒ¨ç½²Dashboard\nKubernetes 0-1 K8séƒ¨ç½²EFK\nå¯èƒ½éœ€è¦è¿è¡Œå¤šæ¬¡ä»¥ä¸‹å‘½ä»¤ï¼Œç¡®ä¿k8sèµ„æºéƒ½åˆ›å»º\nKubernetes 0-1 K8séƒ¨ç½²Zookeeperå’ŒKafka\nKubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ\nKubernetes å®šåˆ¶å¼€å‘ 02ï¼šCRD\nKubernetes å®šåˆ¶å¼€å‘ 50ï¼šæ‰©å±•è°ƒåº¦å™¨\nç®€å•ä»‹ç» K8s\nkubeadm å®‰è£… Kubernetes (Docker)\nkubeadm å®‰è£… k8s (containerd)\nKubeadm å‡çº§ K8s\nkubebuilder å®æˆ˜\nkubectl\nKubernetes 0-1 Kubernetesæœ€ä½³å®è·µ\nKubernetes Dashboard\nKubernetes ä¸­èµ„æºåç§°è§„èŒƒ\nKuberentes\nKubeVirt åˆ›å»º Windows è™šæ‹Ÿæœº\nKubevirt å®è·µ\nKustomize\nKubernetes 0-1 Podä¸­çš„livenessProbeå’ŒreadinessProbeè§£è¯»\nlocal å­˜å‚¨å·å®è·µ\nKubernetes 0-1 K8sè‡ªå»ºLoadBalancer\nä½¿ç”¨ nfs æŒä¹…åŒ–å­˜å‚¨\nKubernetes 0-1 äº†è§£ Pod\nKubernetes ç¼–ç¨‹\nPrometheus-ç›‘æ§Kongå®Œæ•´æ“ä½œ\nPrometheus\nPVC æ‰©å®¹\näº†è§£ Secret\näº†è§£ Service\nTelepresence\nKubernetes 0-1 ä½¿ç”¨preStopä¼˜é›…ç»ˆæ­¢Pod\nTerraform\nVelero + Minio å¤‡ä»½ä¸æ¢å¤\näº†è§£ Volume\nVPA\n"},{"id":118,"href":"/kubernetes/anti-affinity-improves-service-availability/","title":"Anti Affinity Improves Service Availability","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / åäº²å’Œæ€§æé«˜æœåŠ¡å¯ç”¨æ€§\nåäº²å’Œæ€§æé«˜æœåŠ¡å¯ç”¨æ€§ # åœ¨ Kubernetes ä¸­éƒ¨ç½²æœåŠ¡æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šéƒ¨ç½²å¤šå‰¯æœ¬æ¥æé«˜æœåŠ¡çš„å¯ç”¨æ€§ã€‚ä½†æ˜¯å½“è¿™äº›å‰¯æœ¬é›†ä¸­éƒ¨ç½²åœ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸”å¾ˆä¸å¹¸ï¼Œè¯¥èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œé‚£ä¹ˆæœåŠ¡å¾ˆå®¹æ˜“é™·å…¥ä¸å¯ç”¨çŠ¶æ€ã€‚\nä¸‹é¢ä»‹ç»ä¸€ç§æ–¹æ³•ï¼Œå°†æœåŠ¡å‰¯æœ¬åˆ†æ•£éƒ¨ç½²åœ¨ä¸åŒçš„èŠ‚ç‚¹ï¼ˆæŠŠé¸¡è›‹æ”¾åœ¨ä¸åŒçš„ç¯®å­é‡Œï¼‰ï¼Œé¿å…å•ä¸ªèŠ‚ç‚¹æ•…éšœå¯¼è‡´æœåŠ¡å¤šå‰¯æœ¬æ¯åï¼Œæé«˜æœåŠ¡å¯ç”¨æ€§ã€‚\nåäº²å’Œ # apiVersion: apps/v1 kind: Deployment metadata: name: nginx labels: app: nginx spec: selector: matchLabels: app: nginx replicas: 5 template: metadata: labels: app: nginx spec: affinity: podAntiAffinity: requiredDuringSchedulingIgnoredDuringExecution: podAffinityTerm: labelSelector: matchExpressions: - key: app operator: In values: - nginx topologyKey: kubernetes.io/hostname containers: - name: nginx image: nginx ports: - name: tcp containerPort: 80 ä½¿ç”¨ kubernetes.io/hostname ä½œä¸ºæ‹“æ‰‘åŸŸ,æŸ¥çœ‹åŒ¹é…è§„åˆ™ï¼Œå³åŒä¸€æ‰“æœ‰åŒæ ·æ ‡ç­¾ app=nginx çš„ pod ä¼šè°ƒåº¦åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚\npodAntiAffinity ä½¿ç”¨åœºæ™¯ï¼š\nå°†ä¸€ä¸ªæœåŠ¡çš„ Pod åˆ†æ•£åœ¨ä¸åŒçš„ä¸»æœºæˆ–è€…æ‹“æ‰‘åŸŸä¸­ï¼Œæé«˜æœåŠ¡æœ¬èº«çš„ç¨³å®šæ€§ã€‚ ç»™ Pod å¯¹äºä¸€ä¸ªèŠ‚ç‚¹çš„ç‹¬å è®¿é—®æƒé™æ¥ä¿è¯èµ„æºéš”ç¦»ï¼Œä¿è¯ä¸ä¼šæœ‰å…¶å®ƒ Pod æ¥åˆ†äº«èŠ‚ç‚¹èµ„æºã€‚ æŠŠå¯èƒ½ä¼šç›¸äº’å½±å“çš„æœåŠ¡çš„ Pod åˆ†æ•£åœ¨ä¸åŒçš„ä¸»æœºä¸Š å¯¹äºäº²å’Œæ€§å’Œåäº²å’Œæ€§ï¼Œæ¯ç§éƒ½æœ‰ä¸‰ç§è§„åˆ™å¯ä»¥è®¾ç½®ï¼š\nRequiredDuringSchedulingRequiredDuringExecutionï¼šåœ¨è°ƒåº¦æœŸé—´è¦æ±‚æ»¡è¶³äº²å’Œæ€§æˆ–è€…åäº²å’Œæ€§è§„åˆ™ï¼Œå¦‚æœä¸èƒ½æ»¡è¶³è§„åˆ™ï¼Œåˆ™ Pod ä¸èƒ½è¢«è°ƒåº¦åˆ°å¯¹åº”çš„ä¸»æœºä¸Šã€‚åœ¨ä¹‹åçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå› ä¸ºæŸäº›åŸå› ï¼ˆæ¯”å¦‚ä¿®æ”¹ labelï¼‰å¯¼è‡´è§„åˆ™ä¸èƒ½æ»¡è¶³ï¼Œç³»ç»Ÿä¼šå°è¯•æŠŠ Pod ä»ä¸»æœºä¸Šåˆ é™¤ï¼ˆç°åœ¨ç‰ˆæœ¬è¿˜ä¸æ”¯æŒï¼‰ã€‚ RequiredDuringSchedulingIgnoredDuringExecutionï¼šåœ¨è°ƒåº¦æœŸé—´è¦æ±‚æ»¡è¶³äº²å’Œæ€§æˆ–è€…åäº²å’Œæ€§è§„åˆ™ï¼Œå¦‚æœä¸èƒ½æ»¡è¶³è§„åˆ™ï¼Œåˆ™ Pod ä¸èƒ½è¢«è°ƒåº¦åˆ°å¯¹åº”çš„ä¸»æœºä¸Šã€‚åœ¨ä¹‹åçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¸ä¼šå†æ£€æŸ¥è¿™äº›è§„åˆ™æ˜¯å¦æ»¡è¶³ã€‚ PreferredDuringSchedulingIgnoredDuringExecutionï¼šåœ¨è°ƒåº¦æœŸé—´å°½é‡æ»¡è¶³äº²å’Œæ€§æˆ–è€…åäº²å’Œæ€§è§„åˆ™ï¼Œå¦‚æœä¸èƒ½æ»¡è¶³è§„åˆ™ï¼ŒPod ä¹Ÿæœ‰å¯èƒ½è¢«è°ƒåº¦åˆ°å¯¹åº”çš„ä¸»æœºä¸Šã€‚åœ¨ä¹‹åçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¸ä¼šå†æ£€æŸ¥è¿™äº›è§„åˆ™æ˜¯å¦æ»¡è¶³ã€‚ äº²å’Œæ€§/åäº²å’Œæ€§è°ƒåº¦ç­–ç•¥æ¯”è¾ƒ # è°ƒåº¦ç­–ç•¥ åŒ¹é…æ ‡ç­¾ æ“ä½œç¬¦ æ‹“æ‰‘åŸŸæ”¯æŒ è°ƒåº¦ç›®æ ‡ nodeAffinity ä¸»æœº In, NotIn, Exists, DoesNotExist, Gt, Lt å¦ pod åˆ°æŒ‡å®šä¸»æœº podAffinity Pod In, NotIn, Exists, DoesNotExist æ˜¯ pod ä¸æŒ‡å®š pod åŒä¸€æ‹“æ‰‘åŸŸ PodAntiAffinity Pod In, NotIn, Exists, DoesNotExist æ˜¯ pod ä¸æŒ‡å®š pod éåŒä¸€æ‹“æ‰‘åŸŸ Â» apiserver-builder\n"},{"id":119,"href":"/kubernetes/apiserver-builder/","title":"Apiserver Builder","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / apiserver-builder\napiserver-builder # å®‰è£… # go install sigs.k8s.io/apiserver-builder-alpha/cmd/apiserver-boot@v1.23.0 æ­å»º # åˆå§‹åŒ–é¡¹ç›®ï¼š\nâš ï¸ æ³¨æ„ï¼šç”±äºå†å²åŸå› éœ€è¦è¿›å…¥ $(go env GOPATH)/src/\u0026lt;package\u0026gt; åŒ…ç›®å½•ä¸‹æ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤ã€‚\nmkdir -p $(go env GOPATH)/src/github.com/poneding/apiserver-demo \u0026amp;\u0026amp; cd $(go env GOPATH)/src/github.com/poneding/apiserver-demo apiserver-boot init repo --domain k8sdev.poneding.com åˆ›å»º APIï¼š\n# apiserver-boot create \u0026lt;group\u0026gt; \u0026lt;version\u0026gt; \u0026lt;resource\u0026gt; apiserver-boot create demo v1alpha1 User apiserver-boot create group version resource --group demo --version v1alpha1 --kind User å‚è€ƒ # https://github.com/kubernetes-sigs/apiserver-builder-alpha/blob/master/docs/tools_user_guide.md https://github.com/kubernetes-sigs/apiserver-builder-alpha/blob/master/README.md Â« åäº²å’Œæ€§æé«˜æœåŠ¡å¯ç”¨æ€§\nÂ» apiserver\n"},{"id":120,"href":"/kubernetes/apiserver/","title":"Apiserver","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / apiserver\napiserver # æ¯ä¸€ä¸ª api ç‰ˆæœ¬å‡æœ‰ä¸€ä¸ª apiservice ä¸ä¹‹å¯¹åº”\nk api-versions | wc -l 30 k get apiservices.apiregistration.k8s.io| wc -l 30 Â« apiserver-builder\nÂ» äºŒè¿›åˆ¶æ­å»º K8s - 1 æœºå™¨å‡†å¤‡\n"},{"id":121,"href":"/kubernetes/binary-build-k8s-01-prepare-nodes/","title":"Binary Build K8s 01 Prepare Nodes","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / äºŒè¿›åˆ¶æ­å»º K8s - 1 æœºå™¨å‡†å¤‡\näºŒè¿›åˆ¶æ­å»º K8s - 1 æœºå™¨å‡†å¤‡ # å†™åœ¨å‰é¢ # è®°å½•å’Œåˆ†äº«ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ï¼Œç”±äºæ“ä½œæ¯”è¾ƒå†—é•¿ï¼Œå¤§æ¦‚ä¼šåˆ†å››ç¯‡å†™å®Œï¼š\næœºå™¨å‡†å¤‡ï¼š éƒ¨ç½² etcd é›†ç¾¤ï¼š éƒ¨ç½² Masterï¼š éƒ¨ç½² Nodeï¼š æ•´ä¸ªç›®æ ‡æ˜¯ä½¿ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼æ­å»ºä¸€ä¸ªå°å‹ K8s é›†ç¾¤ï¼ˆ1 ä¸ª Masterï¼Œ2 ä¸ª Nodeï¼‰ï¼Œä¾›è‡ªå·±å­¦ä¹ æµ‹è¯•ã€‚\nè‡³äºä¸ºä»€ä¹ˆè¦è‡ªå·±å»ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼å»æ­å»º K8sï¼Œè€Œä¸æ˜¯é€‰ç”¨ minikube æˆ–è€… kubeadm å»æ­å»ºï¼Ÿ\nå› ä¸ºä½¿ç”¨äºŒè¿›åˆ¶æ­å»ºï¼ŒK8s çš„æ¯ä¸ªç»„ä»¶ï¼Œæ¯ä¸ªå·¥å…·éƒ½éœ€è¦ä½ æ‰‹åŠ¨çš„å®‰è£…å’Œé…ç½®ï¼Œå¸®åŠ©ä½ åŠ æ·±å¯¹ K8s ç»„ç»‡æ¶æ„å’Œå·¥ä½œåŸç†çš„äº†è§£ã€‚\nå‡†å¤‡å·¥ä½œ # ä¸‰å° centos7 è™šæ‹Ÿæœºï¼Œè‡ªå·±å­¦ä¹ ä½¿ç”¨çš„è¯ 1 æ ¸ 1G åº”è¯¥å°±å¤Ÿäº†ã€‚\nè™šæ‹Ÿæœºèƒ½å¤Ÿè¿ç½‘ï¼Œç›¸å…³çš„å®‰è£…åŒ…æ–‡ä»¶ä¸‹è½½å’Œ Docker ä¸‹è½½é•œåƒéœ€è¦ä½¿ç”¨åˆ°å¤–ç½‘ã€‚\nå½“å‰è™šæ‹Ÿæœºï¼š\nk8s-master01: 192.168.115.131 k8s-node01: 192.168.115.132 k8s-node02: 192.168.115.133 è™šæ‹Ÿæœºåˆå§‹åŒ– # ä¸åšç‰¹æ®Šè¯´æ˜çš„è¯ï¼š\nä»¥ä¸‹æ“ä½œéœ€è¦åœ¨ Master å’Œ Node çš„æ‰€æœ‰æœºå™¨ä¸Šæ‰§è¡Œ\nä½¿ç”¨ sudo æƒé™æ‰§è¡Œå‘½ä»¤\né…ç½®ç½‘ç»œæ¥å£ # # ä½¿ç”¨ ip addr è·å–ä¸åˆ°æœºå™¨çš„ IP æ—¶æ‰§è¡Œ dhclient å‘½ä»¤ dhclient å®‰è£…åŸºç¡€è½¯ä»¶ # yum install vim ntp wget -y ä¿®æ”¹ä¸»æœºåå¹¶æ·»åŠ  hosts # åœ¨k8s-master01ä¸Šæ‰§è¡Œ\nhostnamectl set-hostname \u0026#34;k8s-master01\u0026#34; åœ¨k8s-node01ä¸Šæ‰§è¡Œ\nhostnamectl set-hostname \u0026#34;k8s-node01\u0026#34; åœ¨k8s-node02ä¸Šæ‰§è¡Œ\nhostnamectl set-hostname \u0026#34;k8s-node02\u0026#34; æ·»åŠ  hosts # vim /etc/hosts æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œåœ¨æ–‡ä»¶ä¸­è¿½åŠ ä»¥ä¸‹å†…å®¹ï¼š\n192.168.115.131 k8s-master01 192.168.115.132 k8s-node01 192.168.115.133 k8s-node02 å…³é—­é˜²ç«å¢™ã€selinuxã€swap # systemctl stop firewalld systemctl disable firewalld setenforce 0 sed -i \u0026#39;s/enforcing/disabled/\u0026#39; /etc/selinux/config swapoff -a vim /etc/fstab # ç¼–è¾‘ etc/fstab æ–‡ä»¶ï¼Œæ³¨é‡Š swap æ‰€åœ¨çš„è¡Œ åŒæ­¥æ—¶é—´ # ntpdate time.windows.com Master å‡†å¤‡æ–‡ä»¶ # åœ¨ Master æœºå™¨æ‰§è¡Œï¼š\nmkdir /root/kubernetes/resources -p cd /root/kubernetes/resources wget https://dl.k8s.io/v1.18.3/kubernetes-server-linux-amd64.tar.gz wget https://github.com/etcd-io/etcd/releases/download/v3.4.9/etcd-v3.4.9-linux-amd64.tar.gz wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml Node å‡†å¤‡æ–‡ä»¶ # åœ¨ Node æœºå™¨æ‰§è¡Œï¼š\nmkdir /root/kubernetes/resources -p cd /root/kubernetes/resources wget https://dl.k8s.io/v1.18.3/kubernetes-node-linux-amd64.tar.gz wget https://github.com/etcd-io/etcd/releases/download/v3.4.9/etcd-v3.4.9-linux-amd64.tar.gz wget https://github.com/containernetworking/plugins/releases/download/v0.8.6/cni-plugins-linux-amd64-v0.8.6.tgz wget https://download.docker.com/linux/static/stable/x86_64/docker-19.03.9.tgz æœ‰äº›æ–‡ä»¶çš„è¾ƒå¤§ï¼Œä¸‹è½½èŠ±è´¹æ—¶é—´å¯èƒ½è¾ƒé•¿ã€‚å¯ä»¥æå‰ä¸‹è½½å¥½ä¹‹åï¼Œæ‹·è´åˆ°è™šæ‹Ÿæœºã€‚\nç¬¬ä¸€æ®µè½æœºå™¨å‡†å¤‡æ„‰å¿«ç»“æŸã€‚\nÂ« apiserver\nÂ» äºŒè¿›åˆ¶æ­å»º K8s - 2 éƒ¨ç½² etcd é›†ç¾¤\n"},{"id":122,"href":"/kubernetes/binary-build-k8s-02-deploy-etcd/","title":"Binary Build K8s 02 Deploy Etcd","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / äºŒè¿›åˆ¶æ­å»º K8s - 2 éƒ¨ç½² etcd é›†ç¾¤\näºŒè¿›åˆ¶æ­å»º K8s - 2 éƒ¨ç½² etcd é›†ç¾¤ # å†™åœ¨å‰é¢ # è®°å½•å’Œåˆ†äº«ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ï¼Œç”±äºæ“ä½œæ¯”è¾ƒå†—é•¿ï¼Œå¤§æ¦‚ä¼šåˆ†å››ç¯‡å†™å®Œï¼š\næœºå™¨å‡†å¤‡ï¼š éƒ¨ç½² etcd é›†ç¾¤ï¼š éƒ¨ç½² Masterï¼š éƒ¨ç½² Nodeï¼š etcd ä½œä¸º K8s çš„æ•°æ®åº“ï¼Œéœ€è¦é¦–å…ˆå®‰è£…ï¼Œä¸ºå…¶ä»–ç»„ä»¶åšæœåŠ¡åŸºç¡€ã€‚\netcd æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ•°æ®åº“ç³»ç»Ÿï¼Œä¸ºäº†æ¨¡æ‹Ÿ etcd çš„é«˜å¯ç”¨ï¼Œæˆ‘ä»¬å°† etcd éƒ¨ç½²åœ¨ä¸‰å°è™šæ‹Ÿæœºä¸Šï¼Œæ­£å¥½å°±éƒ¨ç½²åœ¨ K8s é›†ç¾¤æ‰€ä½¿ç”¨çš„ä¸‰å°æœºå™¨ä¸Šå§ã€‚\netcd é›†ç¾¤ï¼ŒK8s ç»„ä»¶ä¹‹é—´é€šä¿¡ï¼Œä¸ºäº†å®‰å…¨å¯é ï¼Œæˆ‘ä»¬æœ€å¥½å¯ç”¨ HTTPS å®‰å…¨æœºåˆ¶ã€‚K8s æä¾›äº†åŸºäº CA ç­¾åçš„åŒå‘æ•°å­—è¯ä¹¦è®¤è¯æ–¹å¼å’Œç®€å•çš„åŸºäº HTTP Base æˆ– Token çš„è®¤è¯æ–¹å¼ï¼Œå…¶ä¸­ CA è¯ä¹¦æ–¹å¼çš„å®‰å…¨æ€§æœ€é«˜ã€‚æˆ‘ä»¬ä½¿ç”¨ cfssl ä¸ºæˆ‘ä»¬çš„ K8s é›†ç¾¤é…ç½® CA è¯ä¹¦ï¼Œæ­¤å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨ opensslã€‚\nå®‰è£… cfssl # åœ¨ Master æœºå™¨æ‰§è¡Œï¼š\ncd /root/kubernetes/resources cp cfssl_linux-amd64 /usr/bin/cfssl cp cfssljson_linux-amd64 /usr/bin/cfssljson cp cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo chmod +x /usr/bin/cfssl /usr/bin/cfssljson /usr/bin/cfssl-certinfo åœ¨æ‰€æœ‰æœºå™¨æ‰§è¡Œï¼š\nmkdir /etc/etcd/ssl -p åˆ¶ä½œ etcd è¯ä¹¦ # åœ¨ Master æœºå™¨æ‰§è¡Œï¼š\nmkdir /root/kubernetes/resources/cert/etcd -p cd /root/kubernetes/resources/cert/etcd ç¼–è¾‘ ca-config.json\nvim ca-config.json å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;signing\u0026#34;: { \u0026#34;default\u0026#34;: { \u0026#34;expiry\u0026#34;: \u0026#34;87600h\u0026#34; }, \u0026#34;profiles\u0026#34;: { \u0026#34;etcd\u0026#34;: { \u0026#34;expiry\u0026#34;: \u0026#34;87600h\u0026#34;, \u0026#34;usages\u0026#34;: [ \u0026#34;signing\u0026#34;, \u0026#34;key encipherment\u0026#34;, \u0026#34;server auth\u0026#34;, \u0026#34;client auth\u0026#34; ] } } } } ç¼–è¾‘ ca-csr.jsonï¼š\nvim ca-csr.json å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;CN\u0026#34;: \u0026#34;etcd ca\u0026#34;, \u0026#34;key\u0026#34;: { \u0026#34;algo\u0026#34;: \u0026#34;rsa\u0026#34;, \u0026#34;size\u0026#34;: 2048 }, \u0026#34;names\u0026#34;: [ { \u0026#34;C\u0026#34;: \u0026#34;CN\u0026#34;, \u0026#34;L\u0026#34;: \u0026#34;Hunan\u0026#34;, \u0026#34;ST\u0026#34;: \u0026#34;Changsha\u0026#34; } ] } ç”Ÿæˆ ca è¯ä¹¦å’Œå¯†é’¥ï¼š\ncfssl gencert -initca ca-csr.json | cfssljson -bare ca ç¼–è¾‘ server-csr.jsonï¼š\nvim server-csr.json å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;CN\u0026#34;: \u0026#34;etcd\u0026#34;, \u0026#34;hosts\u0026#34;: [ \u0026#34;192.168.115.131\u0026#34;, \u0026#34;192.168.115.132\u0026#34;, \u0026#34;192.168.115.133\u0026#34; ], \u0026#34;key\u0026#34;: { \u0026#34;algo\u0026#34;: \u0026#34;rsa\u0026#34;, \u0026#34;size\u0026#34;: 2048 }, \u0026#34;names\u0026#34;: [ { \u0026#34;C\u0026#34;: \u0026#34;CN\u0026#34;, \u0026#34;L\u0026#34;: \u0026#34;Hunan\u0026#34;, \u0026#34;ST\u0026#34;: \u0026#34;Changsha\u0026#34; } ] } hosts ä¸­é…ç½®æ‰€æœ‰ Master å’Œ Node çš„ IP åˆ—è¡¨ã€‚\nç”Ÿæˆ etcd è¯ä¹¦å’Œå¯†é’¥\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=etcd server-csr.json | cfssljson -bare server # æ­¤æ—¶ç›®å½•ä¸‹ä¼šç”Ÿæˆ 7 ä¸ªæ–‡ä»¶ ls ca-config.json ca.csr ca-csr.json ca-key.pem ca.pem server.csr server-csr.json server-key.pem server.pem æ‹·è´è¯ä¹¦\ncp ca.pem server-key.pem server.pem /etc/etcd/ssl scp ca.pem server-key.pem server.pem 192.168.115.132:/etc/etcd/ssl scp ca.pem server-key.pem server.pem 192.168.115.133:/etc/etcd/ssl å®‰è£… etcd é›†ç¾¤ # åœ¨æ‰€æœ‰æœºå™¨æ‰§è¡Œï¼š\ncd /root/kubernetes/resources tar -zxvf /root/kubernetes/resources/etcd-v3.4.9-linux-amd64.tar.gz cp ./etcd-v3.4.9-linux-amd64/etcd ./etcd-v3.4.9-linux-amd64/etcdctl /usr/bin é…ç½® etcd # è¿™é‡Œå¼€å§‹å‘½ä»¤éœ€è¦åˆ†åˆ«åœ¨ Master å’Œ Node æœºå™¨æ‰§è¡Œï¼Œé…ç½® etcd.conf\nvim /etc/etcd/etcd.conf k8s-master01 å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n[Member] ETCD_NAME=\u0026#34;etcd01\u0026#34; ETCD_DATA_DIR=\u0026#34;/var/lib/etcd/default.etcd\u0026#34; ETCD_LISTEN_PEER_URLS=\u0026#34;https://192.168.115.131:2380\u0026#34; ETCD_LISTEN_CLIENT_URLS=\u0026#34;https://192.168.115.131:2379,https://127.0.0.1:2379\u0026#34; [Clustering] ETCD_INITIAL_ADVERTISE_PEER_URLS=\u0026#34;https://192.168.115.131:2380\u0026#34; ETCD_ADVERTISE_CLIENT_URLS=\u0026#34;https://192.168.115.131:2379\u0026#34; ETCD_INITIAL_CLUSTER=\u0026#34;etcd01=https://192.168.115.131:2380,etcd02=https://192.168.115.132:2380,etcd03=https://192.168.115.133:2380\u0026#34; ETCD_INITIAL_CLUSTER_TOKEN=\u0026#34;etcd-cluster\u0026#34; ETCD_INITIAL_CLUSTER_STATE=\u0026#34;new\u0026#34; k8s-node01 å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n[Member] ETCD_NAME=\u0026#34;etcd02\u0026#34; ETCD_DATA_DIR=\u0026#34;/var/lib/etcd/default.etcd\u0026#34; ETCD_LISTEN_PEER_URLS=\u0026#34;https://192.168.115.132:2380\u0026#34; ETCD_LISTEN_CLIENT_URLS=\u0026#34;https://192.168.115.132:2379,https://127.0.0.1:2379\u0026#34; [Clustering] ETCD_INITIAL_ADVERTISE_PEER_URLS=\u0026#34;https://192.168.115.132:2380\u0026#34; ETCD_ADVERTISE_CLIENT_URLS=\u0026#34;https://192.168.115.132:2379\u0026#34; ETCD_INITIAL_CLUSTER=\u0026#34;etcd01=https://192.168.115.131:2380,etcd02=https://192.168.115.132:2380,etcd03=https://192.168.115.133:2380\u0026#34; ETCD_INITIAL_CLUSTER_TOKEN=\u0026#34;etcd-cluster\u0026#34; ETCD_INITIAL_CLUSTER_STATE=\u0026#34;new\u0026#34; k8s-node02 å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n[Member] ETCD_NAME=\u0026#34;etcd03\u0026#34; ETCD_DATA_DIR=\u0026#34;/var/lib/etcd/default.etcd\u0026#34; ETCD_LISTEN_PEER_URLS=\u0026#34;https://192.168.115.133:2380\u0026#34; ETCD_LISTEN_CLIENT_URLS=\u0026#34;https://192.168.115.133:2379,https://127.0.0.1:2379\u0026#34; [Clustering] ETCD_INITIAL_ADVERTISE_PEER_URLS=\u0026#34;https://192.168.115.133:2380\u0026#34; ETCD_ADVERTISE_CLIENT_URLS=\u0026#34;https://192.168.115.133:2379\u0026#34; ETCD_INITIAL_CLUSTER=\u0026#34;etcd01=https://192.168.115.131:2380,etcd02=https://192.168.115.132:2380,etcd03=https://192.168.115.133:2380\u0026#34; ETCD_INITIAL_CLUSTER_TOKEN=\u0026#34;etcd-cluster\u0026#34; ETCD_INITIAL_CLUSTER_STATE=\u0026#34;new\u0026#34; è¿™é‡Œå¼€å§‹åœ¨æ‰€æœ‰æœºå™¨æ‰§è¡Œï¼Œè®¾ç½® etcd æœåŠ¡é…ç½®æ–‡ä»¶\nmkdir -p /var/lib/etcd vim /usr/lib/systemd/system/etcd.service æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n[Unit] Description=Etcd Server After=network.target After=network-online.target Wants=network-online.target [Service] Type=notify EnvironmentFile=/etc/etcd/etcd.conf ExecStart=/usr/bin/etcd \\ --cert-file=/etc/etcd/ssl/server.pem \\ --key-file=/etc/etcd/ssl/server-key.pem \\ --peer-cert-file=/etc/etcd/ssl/server.pem \\ --peer-key-file=/etc/etcd/ssl/server-key.pem \\ --trusted-ca-file=/etc/etcd/ssl/ca.pem \\ --peer-trusted-ca-file=/etc/etcd/ssl/ca.pem Restart=on-failure LimitNOFILE=65536 [Install] WantedBy=multi-user.target etcd3.4 ç‰ˆæœ¬ä¼šè‡ªåŠ¨ EnvironmentFile æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡ï¼Œä¸éœ€è¦å† ExecStart çš„å‘½ä»¤å‚æ•°é‡å¤è®¾ç½®ï¼Œå¦åˆ™ä¼šæŠ¥ï¼š\u0026quot;xxx\u0026quot; is shadowed by corresponding command-line flag çš„é”™è¯¯ä¿¡æ¯ã€‚\nå¯åŠ¨ etcdï¼Œå¹¶ä¸”è®¾ç½®å¼€æœºè‡ªåŠ¨è¿è¡Œ etcd\nsystemctl daemon-reload systemctl start etcd.service systemctl enable etcd.service æ£€æŸ¥ etcd é›†ç¾¤çš„å¥åº·çŠ¶æ€\netcdctl endpoint health --cacert=/etc/etcd/ssl/ca.pem --cert=/etc/etcd/ssl/server.pem --key=/etc/etcd/ssl/server-key.pem --endpoints=\u0026#34;https://192.168.115.131:2379,https://192.168.115.132:2379,https://192.168.115.133:2379\u0026#34; è¾“å‡ºå¦‚ä¸‹ï¼Œè¯´æ˜ etcd é›†ç¾¤å·²ç»éƒ¨ç½²æˆåŠŸã€‚\nhttps://192.168.115.133:2379 is healthy: successfully committed proposal: took = 15.805605ms https://192.168.115.132:2379 is healthy: successfully committed proposal: took = 22.127986ms https://192.168.115.131:2379 is healthy: successfully committed proposal: took = 24.829669ms ç¬¬äºŒæ®µè½éƒ¨ç½² etcd é›†ç¾¤æ„‰å¿«ç»“æŸã€‚\nÂ« äºŒè¿›åˆ¶æ­å»º K8s - 1 æœºå™¨å‡†å¤‡\nÂ» äºŒè¿›åˆ¶æ­å»º K8s - 3 éƒ¨ç½² Master\n"},{"id":123,"href":"/kubernetes/binary-build-k8s-03-deploy-master/","title":"Binary Build K8s 03 Deploy Master","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / äºŒè¿›åˆ¶æ­å»º K8s - 3 éƒ¨ç½² Master\näºŒè¿›åˆ¶æ­å»º K8s - 3 éƒ¨ç½² Master # å†™åœ¨å‰é¢ # è®°å½•å’Œåˆ†äº«ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ï¼Œç”±äºæ“ä½œæ¯”è¾ƒå†—é•¿ï¼Œå¤§æ¦‚ä¼šåˆ†å››ç¯‡å†™å®Œï¼š\næœºå™¨å‡†å¤‡ï¼š éƒ¨ç½² etcd é›†ç¾¤ï¼š éƒ¨ç½² Masterï¼š éƒ¨ç½² Nodeï¼š æˆ‘ä»¬å·²ç»çŸ¥é“åœ¨ K8s çš„ Master ä¸Šå­˜åœ¨ç€ kube-apiserverã€kube-controller-managerã€kube-scheduler ä¸‰å¤§ç»„ä»¶ã€‚æœ¬ç¯‡ä»‹ç»åœ¨ Master æœºå™¨å®‰è£…è¿™äº›ç»„ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœæƒ³åœ¨ Master æœºå™¨ä¸Šæ“ä½œé›†ç¾¤ï¼Œè¿˜éœ€è¦å®‰è£… kubectl å·¥å…·ã€‚\nå®‰è£… kubectl # kubernetes çš„å®‰è£…åŒ…é‡Œå·²ç»å°† kubectl åŒ…å«è¿›å»äº†ï¼Œéƒ¨ç½²å¾ˆç®€å•ï¼š\ncd /root/kubernetes/resources/ tar -zxvf ./kubernetes-server-linux-amd64.tar.gz cp kubernetes/server/bin/kubectl /usr/bin kubectl api-versions åˆ¶ä½œ kubernetes è¯ä¹¦ # mkdir /root/kubernetes/resources/cert/kubernetes /etc/kubernetes/{ssl,bin} -p cp kubernetes/server/bin/kube-apiserver kubernetes/server/bin/kube-controller-manager kubernetes/server/bin/kube-scheduler /etc/kubernetes/bin cd /root/kubernetes/resources/cert/kubernetes æ¥ä¸‹æ¥éƒ½åœ¨ Master æœºå™¨ä¸Šæ‰§è¡Œï¼Œç¼–è¾‘ ca-config.json\nvim ca-config.json å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;signing\u0026#34;: { \u0026#34;default\u0026#34;: { \u0026#34;expiry\u0026#34;: \u0026#34;87600h\u0026#34; }, \u0026#34;profiles\u0026#34;: { \u0026#34;kubernetes\u0026#34;: { \u0026#34;expiry\u0026#34;: \u0026#34;87600h\u0026#34;, \u0026#34;usages\u0026#34;: [ \u0026#34;signing\u0026#34;, \u0026#34;key encipherment\u0026#34;, \u0026#34;server auth\u0026#34;, \u0026#34;client auth\u0026#34; ] } } } } ç¼–è¾‘ ca-csr.jsonï¼š\nvim ca-csr.json å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;CN\u0026#34;: \u0026#34;kubernetes\u0026#34;, \u0026#34;key\u0026#34;: { \u0026#34;algo\u0026#34;: \u0026#34;rsa\u0026#34;, \u0026#34;size\u0026#34;: 2048 }, \u0026#34;names\u0026#34;: [ { \u0026#34;C\u0026#34;: \u0026#34;CN\u0026#34;, \u0026#34;L\u0026#34;: \u0026#34;Hunan\u0026#34;, \u0026#34;ST\u0026#34;: \u0026#34;Changsha\u0026#34;, \u0026#34;O\u0026#34;: \u0026#34;kubernetes\u0026#34;, \u0026#34;OU\u0026#34;: \u0026#34;System\u0026#34; } ] } ç”Ÿæˆ ca è¯ä¹¦å’Œå¯†é’¥ï¼š\ncfssl gencert -initca ca-csr.json | cfssljson -bare ca åˆ¶ä½œ kube-apiserverã€kube-proxyã€admin è¯ä¹¦ï¼Œç¼–è¾‘ kube-apiserver-csr.jsonï¼š\nvim kube-apiserver-csr.json å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;CN\u0026#34;: \u0026#34;kubernetes\u0026#34;, \u0026#34;hosts\u0026#34;: [ \u0026#34;10.0.0.1\u0026#34;, \u0026#34;127.0.0.1\u0026#34;, \u0026#34;kubernetes\u0026#34;, \u0026#34;kubernetes.default\u0026#34;, \u0026#34;kubernetes.default.svc\u0026#34;, \u0026#34;kubernetes.default.svc.cluster\u0026#34;, \u0026#34;kubernetes.default.svc.cluster.local\u0026#34;, \u0026#34;192.168.115.131\u0026#34;, \u0026#34;192.168.115.132\u0026#34;, \u0026#34;192.168.115.133\u0026#34; ], \u0026#34;key\u0026#34;: { \u0026#34;algo\u0026#34;: \u0026#34;rsa\u0026#34;, \u0026#34;size\u0026#34;: 2048 }, \u0026#34;names\u0026#34;: [ { \u0026#34;C\u0026#34;: \u0026#34;CN\u0026#34;, \u0026#34;L\u0026#34;: \u0026#34;Hunan\u0026#34;, \u0026#34;ST\u0026#34;: \u0026#34;Changsha\u0026#34;, \u0026#34;O\u0026#34;: \u0026#34;kubernetes\u0026#34;, \u0026#34;OU\u0026#34;: \u0026#34;System\u0026#34; } ] } ç¼–è¾‘ kube-proxy-csr.jsonï¼š\nvim kube-proxy-csr.json å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;CN\u0026#34;: \u0026#34;system:kube-proxy\u0026#34;, \u0026#34;hosts\u0026#34;: [], \u0026#34;key\u0026#34;: { \u0026#34;algo\u0026#34;: \u0026#34;rsa\u0026#34;, \u0026#34;size\u0026#34;: 2048 }, \u0026#34;names\u0026#34;: [ { \u0026#34;C\u0026#34;: \u0026#34;CN\u0026#34;, \u0026#34;L\u0026#34;: \u0026#34;Hunan\u0026#34;, \u0026#34;ST\u0026#34;: \u0026#34;Changsha\u0026#34;, \u0026#34;O\u0026#34;: \u0026#34;kubernetes\u0026#34;, \u0026#34;OU\u0026#34;: \u0026#34;System\u0026#34; } ] } ç¼–è¾‘ admin-csr.jsonï¼š\nvim admin-csr.json å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;CN\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;hosts\u0026#34;: [], \u0026#34;key\u0026#34;: { \u0026#34;algo\u0026#34;: \u0026#34;rsa\u0026#34;, \u0026#34;size\u0026#34;: 2048 }, \u0026#34;names\u0026#34;: [ { \u0026#34;C\u0026#34;: \u0026#34;CN\u0026#34;, \u0026#34;L\u0026#34;: \u0026#34;Hunan\u0026#34;, \u0026#34;ST\u0026#34;: \u0026#34;Changsha\u0026#34;, \u0026#34;O\u0026#34;: \u0026#34;system:masters\u0026#34;, \u0026#34;OU\u0026#34;: \u0026#34;System\u0026#34; } ] } ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-apiserver-csr.json | cfssljson -bare kube-apiserver cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes admin-csr.json | cfssljson -bare admin # æ­¤æ—¶ç›®å½•ä¸‹ç”Ÿæˆçš„æ–‡ä»¶ ll -rw-r--r--. 1 root root 1001 May 28 00:32 admin.csr -rw-r--r--. 1 root root 282 May 28 00:32 admin-csr.json -rw-------. 1 root root 1679 May 28 00:32 admin-key.pem -rw-r--r--. 1 root root 1407 May 28 00:32 admin.pem -rw-r--r--. 1 root root 294 May 28 00:30 ca-config.json -rw-r--r--. 1 root root 1013 May 28 00:31 ca.csr -rw-r--r--. 1 root root 284 May 28 00:30 ca-csr.json -rw-------. 1 root root 1675 May 28 00:31 ca-key.pem -rw-r--r--. 1 root root 1383 May 28 00:31 ca.pem -rw-r--r--. 1 root root 1273 May 28 00:32 kube-apiserver.csr -rw-r--r--. 1 root root 597 May 28 00:31 kube-apiserver-csr.json -rw-------. 1 root root 1679 May 28 00:32 kube-apiserver-key.pem -rw-r--r--. 1 root root 1655 May 28 00:32 kube-apiserver.pem -rw-r--r--. 1 root root 1009 May 28 00:32 kube-proxy.csr -rw-r--r--. 1 root root 287 May 28 00:31 kube-proxy-csr.json -rw-------. 1 root root 1679 May 28 00:32 kube-proxy-key.pem -rw-r--r--. 1 root root 1411 May 28 00:32 kube-proxy.pem å°† kube-proxy è¯ä¹¦æ‹·è´åˆ° Nodeï¼š\nå‰æï¼Œéœ€è¦åœ¨ Node æœºå™¨åˆ›å»ºç›®å½•ï¼Œä»¥ä¸‹å‘½ä»¤åœ¨ Node æœºå™¨ä¸Šæ‰§è¡Œï¼š\nmkdir /etc/kubernetes/ -p ç„¶åå†åœ¨Masteræœºå™¨æ‰§è¡Œæ‹·è´æ“ä½œã€‚\ncp ca.pem ca-key.pem kube-apiserver.pem kube-apiserver-key.pem kube-proxy.pem kube-proxy-key.pem /etc/kubernetes/ssl scp -r /etc/kubernetes/ssl 192.168.115.132:/etc/kubernetes scp -r /etc/kubernetes/ssl 192.168.115.133:/etc/kubernetes åˆ›å»º TLSBootstrapping Token # cd /etc/kubernetes head -c 16 /dev/urandom | od -An -t x | tr -d \u0026#39; \u0026#39; # æ‰§è¡Œä¸Šä¸€æ­¥ä¼šå¾—åˆ°ä¸€ä¸ª tokenï¼Œä¾‹å¦‚ d5c5d767b64db39db132b433e9c45fbcï¼Œç¼–è¾‘æ–‡ä»¶ token.csv æ—¶éœ€è¦ vim token.csv å†™å…¥æ–‡ä»¶å†…å®¹ï¼Œæ›¿æ¢ç”Ÿæˆçš„ token\nd5c5d767b64db39db132b433e9c45fbc,kubelet-bootstrap,10001,\u0026#34;system:node-bootstrapper\u0026#34; å®‰è£… kube-apiserver # å‡†å¤‡ kube-apiserver é…ç½®æ–‡ä»¶\nvim apiserver æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nKUBE_API_ARGS=\u0026#34;--logtostderr=false \\ --v=2 \\ --log-dir=/var/log/kubernetes \\ --etcd-servers=https://192.168.115.131:2379,https://192.168.115.132:2379,https://192.168.115.133:2379 \\ --bind-address=192.168.115.131 \\ --secure-port=6443 \\ --advertise-address=192.168.115.131 \\ --allow-privileged=true \\ --service-cluster-ip-range=10.0.0.0/24 \\ --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \\ --authorization-mode=RBAC,Node \\ --enable-bootstrap-token-auth=true \\ --token-auth-file=/etc/kubernetes/token.csv \\ --service-node-port-range=30000-32767 \\ --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem \\ --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem \\ --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem \\ --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem \\ --client-ca-file=/etc/kubernetes/ssl/ca.pem \\ --service-account-key-file=/etc/kubernetes/ssl/ca-key.pem \\ --etcd-cafile=/etc/etcd/ssl/ca.pem \\ --etcd-certfile=/etc/etcd/ssl/server.pem \\ --etcd-keyfile=/etc/etcd/ssl/server-key.pem \\ --audit-log-maxage=30 \\ --audit-log-maxbackup=3 \\ --audit-log-maxsize=100 \\ --audit-log-path=/var/logs/kubernetes/k8s-audit.log\u0026#34; å‡†å¤‡ kube-apiserver æœåŠ¡é…ç½®æ–‡ä»¶\nvim /usr/lib/systemd/system/kube-apiserver.service æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n[Unit] Description=Kubernetes API Server Documentation=https://github.com/GoogleCloudPlatform/kubernetes After=etcd.service Wants=etcd.service [Service] Type=notify EnvironmentFile=/etc/kubernetes/apiserver ExecStart=/etc/kubernetes/bin/kube-apiserver $KUBE_API_ARGS Restart=on-failure LimitNOFILE=65536 [Install] WantedBy=multi-user.target å¯åŠ¨ kube-apiserver:\nsystemctl daemon-reload systemctl start kube-apiserver systemctl enable kube-apiserver systemctl status kube-apiserver å®‰è£… kube-controller-manager # å‡†å¤‡ kube-controller-manger é…ç½®æ–‡ä»¶\nvim controller-manager æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nKUBE_CONTROLLER_MANAGER_ARGS=\u0026#34;--logtostderr=false \\ --v=2 \\ --log-dir=/var/log/kubernetes \\ --leader-elect=true \\ --master=127.0.0.1:8080 \\ --bind-address=127.0.0.1 \\ --allocate-node-cidrs=true \\ --cluster-cidr=10.244.0.0/16 \\ --service-cluster-ip-range=10.0.0.0/24 \\ --cluster-signing-cert-file=/etc/kubernetes/ssl/ca.pem \\ --cluster-signing-key-file=/etc/kubernetes/ssl/ca-key.pem \\ --root-ca-file=/etc/kubernetes/ssl/ca.pem \\ --service-account-private-key-file=/etc/kubernetes/ssl/ca-key.pem \\ --experimental-cluster-signing-duration=87600h0m0s\u0026#34; å‡†å¤‡ kube-controller-manger æœåŠ¡é…ç½®æ–‡ä»¶\nvim /usr/lib/systemd/system/kube-controller-manager.service æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n[Unit] Description=Kubernetes Controller Manager Documentation=https://github.com/GoogleCloudPlatform/kubernetes After=kube-apiserver.service Requires=kube-apiserver.service [Service] EnvironmentFile=/etc/kubernetes/controller-manager ExecStart=/etc/kubernetes/bin/kube-controller-manager $KUBE_CONTROLLER_MANAGER_ARGS Restart=on-failure LimitNOFILE=65536 [Install] WantedBy=multi-user.target å¯åŠ¨kube-controller-manager:\nsystemctl daemon-reload systemctl start kube-controller-manager systemctl enable kube-controller-manager systemctl status kube-controller-manager å®‰è£… kube-scheduler # å‡†å¤‡ kube-scheduler é…ç½®æ–‡ä»¶\nvim scheduler æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nKUBE_SCHEDULER_ARGS=\u0026#34;--logtostderr=false \\ --v=2 \\ --log-dir=/var/log/kubernetes \\ --master=127.0.0.1:8080 \\ --leader-elect \\ --bind-address=127.0.0.1\u0026#34; å‡†å¤‡ kube-scheduler æœåŠ¡é…ç½®æ–‡ä»¶\nvim /usr/lib/systemd/system/kube-scheduler.service æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n[Unit] Description=Kubernetes Scheduler Documentation=https://github.com/GoogleCloudPlatform/kubernetes After=kube-apiserver.service Requires=kube-apiserver.service [Service] EnvironmentFile=/etc/kubernetes/scheduler ExecStart=/etc/kubernetes/bin/kube-scheduler $KUBE_SCHEDULER_ARGS Restart=on-failure LimitNOFILE=65536 [Install] WantedBy=multi-user.target å¯åŠ¨ kube-scheduler:\nsystemctl daemon-reload systemctl start kube-scheduler systemctl enable kube-scheduler systemctl status kube-scheduler kubelet-bootstrap æˆæƒ # kubectl create clusterrolebinding kubelet-bootstrap \\ --clusterrole=system:node-bootstrapper \\ --user=kubelet-bootstrap æŸ¥çœ‹ Master çŠ¶æ€\nkubectl get cs å¦‚æœ Master éƒ¨ç½²æˆåŠŸï¼Œåº”è¯¥è¾“å‡ºï¼š\nNAME STATUS MESSAGE ERROR scheduler Healthy ok controller-manager Healthy ok etcd-2 Healthy {\u0026#34;health\u0026#34;:\u0026#34;true\u0026#34;} etcd-1 Healthy {\u0026#34;health\u0026#34;:\u0026#34;true\u0026#34;} etcd-0 Healthy {\u0026#34;health\u0026#34;:\u0026#34;true\u0026#34;} apiserver æˆæƒ kubelet # å‡†å¤‡ apiserver-to-kubelet-rbac.yaml æ–‡ä»¶\ncd /root/kubernetes/resources vim apiserver-to-kubelet-rbac.yaml æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\napiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: annotations: rbac.authorization.kubernetes.io/autoupdate: \u0026#34;true\u0026#34; labels: kubernetes.io/bootstrapping: rbac-defaults name: system:kube-apiserver-to-kubelet rules: - apiGroups: - \u0026#34;\u0026#34; resources: - nodes/proxy - nodes/stats - nodes/log - nodes/spec - nodes/metrics - pods/log verbs: - \u0026#34;*\u0026#34; --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: system:kube-apiserver namespace: \u0026#34;\u0026#34; roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:kube-apiserver-to-kubelet subjects: - apiGroup: rbac.authorization.k8s.io kind: User name: kubernetes # This role allows full access to the kubelet API apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: kubelet-api-admin labels: addonmanager.kubernetes.io/mode: Reconcile rules: - apiGroups: - \u0026#34;\u0026#34; resources: - nodes/proxy - nodes/log - nodes/stats - nodes/metrics - nodes/spec verbs: - \u0026#34;*\u0026#34; # This binding gives the kube-apiserver user full access to the kubelet API --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: kube-apiserver-kubelet-api-admin labels: addonmanager.kubernetes.io/mode: Reconcile roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: kubelet-api-admin subjects: - apiGroup: rbac.authorization.k8s.io kind: User name: kube-apiserver æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\nkubectl apply -f apiserver-to-kubelet-rbac.yaml ç¬¬ä¸‰æ®µè½éƒ¨ç½² Masteré¡ºåˆ©ç»“æŸã€‚\nÂ« äºŒè¿›åˆ¶æ­å»º K8s - 2 éƒ¨ç½² etcd é›†ç¾¤\nÂ» äºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node\n"},{"id":124,"href":"/kubernetes/binary-build-k8s-04-deploy-worker/","title":"Binary Build K8s 04 Deploy Worker","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / äºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node\näºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node # å†™åœ¨å‰é¢ # è®°å½•å’Œåˆ†äº«ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ï¼Œç”±äºæ“ä½œæ¯”è¾ƒå†—é•¿ï¼Œå¤§æ¦‚ä¼šåˆ†å››ç¯‡å†™å®Œï¼š\næœºå™¨å‡†å¤‡ï¼š éƒ¨ç½² etcd é›†ç¾¤ï¼š éƒ¨ç½² Masterï¼š éƒ¨ç½² Nodeï¼š K8s çš„ Node ä¸Šéœ€è¦è¿è¡Œ kubelet å’Œ kube-proxyã€‚æœ¬ç¯‡ä»‹ç»åœ¨ Node æœºå™¨å®‰è£…è¿™ä¸¤ä¸ªç»„ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®‰è£…é€šä¿¡éœ€è¦çš„ cni æ’ä»¶ã€‚\næœ¬ç¯‡çš„æ‰§è¡Œå‘½ä»¤éœ€è¦åœ¨å‡†å¤‡çš„ä¸¤å°Nodeæœºå™¨ä¸Šæ‰§è¡Œã€‚\nå®‰è£… docker # å¯ä»¥å‚ç…§å®˜ç½‘ï¼š https://docs.docker.com/engine/install/\n# å¸è½½è€ç‰ˆæœ¬æˆ–é‡è£… docker æ—¶æ‰§è¡Œç¬¬ä¸€è¡Œ yum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-engine -y # å®‰è£… docker yum install -y yum-utils yum-config-manager \\ --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo yum install docker-ce docker-ce-cli containerd.io -y # æŸ¥çœ‹ Docker ç‰ˆæœ¬ docker version å¯åŠ¨ Docker\nsystemctl enable docker systemctl start docker å®‰è£… kubelet # cd /root/kubernetes/resources tar -zxvf ./kubernetes-node-linux-amd64.tar.gz mkdir /etc/kubernetes/{ssl,bin} -p cp kubernetes/node/bin/kubelet ./kubernetes/node/bin/kube-proxy /etc/kubernetes/bin cd /etc/kubernetes å‡†å¤‡ kubelet é…ç½®æ–‡ä»¶\nvim kubelet æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œåœ¨ k8s-node01 å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nKUBELET_ARGS=\u0026#34;--logtostderr=false \\ --v=2 \\ --log-dir=/var/log/kubernetes \\ --enable-server=true \\ --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \\ --hostname-override=k8s-node01 \\ --network-plugin=cni \\ --bootstrap-kubeconfig=/etc/kubernetes/bootstrap.kubeconfig \\ --config=/etc/kubernetes/kubelet-config.yml \\ --cert-dir=/etc/kubernetes/ssl\u0026#34; åœ¨ k8s-node02 å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nKUBELET_ARGS=\u0026#34;--logtostderr=false \\ --v=2 \\ --log-dir=/var/log/kubernetes \\ --enable-server=true \\ --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \\ --hostname-override=k8s-node02 \\ --network-plugin=cni \\ --bootstrap-kubeconfig=/etc/kubernetes/bootstrap.kubeconfig \\ --config=/etc/kubernetes/kubelet-config.yml \\ --cert-dir=/etc/kubernetes/ssl\u0026#34; å‡†å¤‡ bootstrap.kubeconfig æ–‡ä»¶\nvim /etc/kubernetes/bootstrap.kubeconfig æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1 clusters: - cluster: certificate-authority: /etc/kubernetes/ssl/ca.pem server: https://192.168.115.131:6443 name: kubernetes contexts: - context: cluster: kubernetes user: kubelet-bootstrap name: default current-context: default kind: Config preferences: {} users: - name: kubelet-bootstrap user: token: d5c5d767b64db39db132b433e9c45fbc æ³¨æ„ï¼štoken çš„å€¼éœ€è¦æ›¿æ¢ä¸º master ç”Ÿæˆçš„ token.csv ä¸­æ‰€ç”¨çš„ tokenã€‚\nå‡†å¤‡ kubelet-config.yml æ–‡ä»¶\nvim kubelet-config.yml æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nkind: KubeletConfiguration apiVersion: kubelet.config.k8s.io/v1beta1 address: 0.0.0.0 port: 10250 readOnlyPort: 10255 cgroupDriver: cgroupfs clusterDNS: - 10.0.0.2 clusterDomain: cluster.local failSwapOn: false authentication: anonymous: enabled: false webhook: cacheTTL: 2m0s enabled: true x509: clientCAFile: /etc/kubernetes/ssl/ca.pem authorization: mode: Webhook webhook: cacheAuthorizedTTL: 5m0s cacheUnauthorizedTTL: 30s evictionHard: imagefs.available: 15% memory.available: 100Mi nodefs.available: 10% nodefs.inodesFree: 5% maxOpenFiles: 1000000 maxPods: 110 å‡†å¤‡ kubelet.kubeconfig æ–‡ä»¶\nvim kubelet.kubeconfig æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nkubelet.kubeconfig apiVersion: v1 clusters: - cluster: certificate-authority: /etc/kubernetes/ssl/ca.pem server: https://192.168.115.131:6443 name: kubernetes contexts: - context: cluster: kubernetes namespace: default user: default-auth name: default-context current-context: default-context kind: Config preferences: {} users: - name: default-auth user: client-certificate: /etc/kubernetes/ssl/kubelet-client-current.pem client-key: /etc/kubernetes/ssl/kubelet-client-current.pem å‡†å¤‡kubeletæœåŠ¡é…ç½®æ–‡ä»¶\nvim /usr/lib/systemd/system/kubelet.service æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n[Unit] Description=Kubelet Documentation=https://github.com/GoogleCloudPlatform/kubernetes After=docker.service Requires=docker.service [Service] EnvironmentFile=/etc/kubernetes/kubelet ExecStart=/etc/kubernetes/bin/kubelet $KUBELET_ARGS Restart=on-failure [Install] WantedBy=multi-user.target å¯åŠ¨ kubeletï¼š\nsystemctl daemon-reload systemctl start kubelet systemctl enable kubelet systemctl status kubelet ç»™ Node é¢å‘è¯ä¹¦ï¼Œåœ¨ Master ä¸Šæ‰§è¡Œï¼š\nkubectl get csr # è¾“å‡ºå¦‚ä¸‹ NAME AGE SIGNERNAME REQUESTOR CONDITION node-csr-a-BmW9xMglOXlUdwBjD2QQphXLdu4iwtamEIIbhJKcY 10m kubernetes.io/kube-apiserver-client-kubelet kubelet-bootstrap Pending node-csr-zDDrVyKH7ug8fTUcDjdvDgh-f9rVCyoHuLMGaWbykAQ 10m kubernetes.io/kube-apiserver-client-kubelet kubelet-bootstrap Pending å¾—åˆ°è¯ä¹¦çš„ NAMEï¼Œç»™å…¶ Approveï¼š\nkubectl certificate approve node-csr-a-BmW9xMglOXlUdwBjD2QQphXLdu4iwtamEIIbhJKcY kubectl certificate approve node-csr-zDDrVyKH7ug8fTUcDjdvDgh-f9rVCyoHuLMGaWbykAQ å†æ¬¡æŸ¥çœ‹è¯ä¹¦ï¼Œè¯ä¹¦çš„ CONDITION å°±ä¼šæ›´æ–°äº†\nkubectl get csr # è¾“å‡ºå¦‚ä¸‹ NAME AGE SIGNERNAME REQUESTOR CONDITION node-csr-a-BmW9xMglOXlUdwBjD2QQphXLdu4iwtamEIIbhJKcY 10m kubernetes.io/kube-apiserver-client-kubelet kubelet-bootstrap Approved,Issued node-csr-zDDrVyKH7ug8fTUcDjdvDgh-f9rVCyoHuLMGaWbykAQ 10m kubernetes.io/kube-apiserver-client-kubelet kubelet-bootstrap Approved,Issued æ¥ä¸‹æ¥ä½¿ç”¨æŸ¥çœ‹ Node çš„å‘½ä»¤ï¼Œåº”è¯¥å¯ä»¥è·å–åˆ° Node ä¿¡æ¯ï¼š\nkubectl get node # è¾“å‡ºå¦‚ä¸‹ NAME STATUS ROLES AGE VERSION k8s-node01 NotReady \u0026lt;none\u0026gt; 50s v1.18.3 k8s-node02 NotReady \u0026lt;none\u0026gt; 56s v1.18.3 å®‰è£… kube-proxy # å‡†å¤‡ kube-proxy é…ç½®æ–‡ä»¶\nvim kube-proxy æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nKUBE_PROXY_ARGS=\u0026#34;--logtostderr=false \\ --v=2 \\ --log-dir=/var/log/kubernetes \\ --config=/etc/kubernetes/kube-proxy-config.yml\u0026#34; å‡†å¤‡ kube-proxy-config.yml æ–‡ä»¶\nvim /etc/kubernetes/kube-proxy-config.yml æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œåœ¨ k8s-node01 å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nkind: KubeProxyConfiguration apiVersion: kubeproxy.config.k8s.io/v1alpha1 address: 0.0.0.0 metricsBindAddress: 0.0.0.0:10249 iclientConnection: kubeconfig: /etc/kubernetes/kube-proxy.kubeconfig hostnameOverride: k8s-node01 clusterCIDR: 10.0.0.0/24 mode: ipvs ipvs: scheduler: \u0026#34;rr\u0026#34; iptables: masqueradeAll: true åœ¨ k8s-node02 å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nkind: KubeProxyConfiguration apiVersion: kubeproxy.config.k8s.io/v1alpha1 address: 0.0.0.0 metricsBindAddress: 0.0.0.0:10249 clientConnection: kubeconfig: /etc/kubernetes/kube-proxy.kubeconfig hostnameOverride: k8s-node02 clusterCIDR: 10.0.0.0/24 mode: ipvs ipvs: scheduler: \u0026#34;rr\u0026#34; iptables: masqueradeAll: true å‡†å¤‡ kube-proxy.kubeconfig æ–‡ä»¶\nvim /etc/kubernetes/kube-proxy.kubeconfig æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\napiVersion: v1 clusters: - cluster: certificate-authority: /etc/kubernetes/ssl/ca.pem server: https://192.168.115.131:6443 name: kubernetes contexts: - context: cluster: kubernetes user: kube-proxy name: default current-context: default kind: Config preferences: {} users: - name: kube-proxy user: client-certificate: /etc/kubernetes/ssl/kube-proxy.pem client-key: /etc/kubernetes/ssl/kube-proxy-key.pem å‡†å¤‡ kube-proxy æœåŠ¡é…ç½®æ–‡ä»¶\nvim /usr/lib/systemd/system/kube-proxy.service æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n[Unit] Description=Kube-Proxy Documentation=https://github.com/GoogleCloudPlatform/kubernetes After=network.target Requires=network.target [Service] EnvironmentFile=/etc/kubernetes/kube-proxy ExecStart=/etc/kubernetes/bin/kube-proxy $KUBE_PROXY_ARGS Restart=on-failure [Install] WantedBy=multi-user.target å¯åŠ¨ kubeletï¼š\nsystemctl daemon-reload systemctl start kube-proxy systemctl enable kube-proxy systemctl status kube-proxy éƒ¨ç½² cni ç½‘ç»œæ’ä»¶ # cd /root/kubernetes/resources mkdir -p /opt/cni/bin /etc/cni/net.d tar -zxvf cni-plugins-linux-amd64-v0.8.6.tgz -C /opt/cni/bin éƒ¨ç½² Flannel é›†ç¾¤ç½‘ç»œ # éœ€è¦åœ¨ Master æœºå™¨ä¸Šæ‰§è¡Œ\ncd /root/kubernetes/resources kubectl apply -f kube-flannel.yml åˆ›å»ºè§’è‰²ç»‘å®š\nkubectl create clusterrolebinding kube-apiserver:kubelet-apis --clusterrole=system:kubelet-api-admin --user kubernetes K8s é›†ç¾¤æµ‹è¯• # éƒ¨ç½²ä¸€ä¸ª nginx çš„ deploymentï¼š\nkubectl create deployment nginx --image=nginx # åœ¨ç­‰å¾…å‡ ç§’åï¼Œè·å– deployment kubectl get deployment ifconfig cni0 kubectl expose deployment nginx --port=80 --type=NodePort kubectl get svc å¯ä»¥çœ‹åˆ° nginx å·²ç»å¯åŠ¨æˆåŠŸã€‚\nNAME READY UP-TO-DATE AVAILABLE AGE nginx 1/1 1 1 7m7s æ³¨æ„ï¼šå¦‚æœå¯åŠ¨å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç”±äºç½‘ç»œåŸå› æ‹‰å–é•œåƒå¤±è´¥å¯¼è‡´ã€‚å¯ä»¥é€šè¿‡ kubectl describe pod \u0026lt;pod-name\u0026gt; æŸ¥çœ‹ã€‚\nä½¿ç”¨ service æš´éœ² K8s é›†ç¾¤å†…éƒ¨ Pod æœåŠ¡ï¼š\nkubectl expose deployment nginx --port=80 --type=NodePort # è·å– service kubectl get svc å¯ä»¥çœ‹åˆ°ï¼Œservice å°† nginx çš„æœåŠ¡è½¬å‘åˆ°äº† 31839 ç«¯å£\nNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.0.0.1 \u0026lt;none\u0026gt; 443/TCP 10h nginx NodePort 10.0.0.101 \u0026lt;none\u0026gt; 80:31839/TCP 10s æ­¤æ—¶ï¼Œæˆ‘ä»¬åœ¨ Node æœºå™¨ä¸Šä½¿ç”¨è¯¥ç«¯å£è®¿é—® nginxï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸè®¿é—®ã€‚\n[root@k8s-node01]# curl 192.168.115.132:31839 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Welcome to nginx!\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; body { width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Welcome to nginx!\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;If you see this page, the nginx web server is successfully installed and working. Further configuration is required.\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;For online documentation and support please refer to \u0026lt;a href=\u0026#34;http://nginx.org/\u0026#34;\u0026gt;nginx.org\u0026lt;/a\u0026gt;.\u0026lt;br/\u0026gt; Commercial support is available at \u0026lt;a href=\u0026#34;http://nginx.com/\u0026#34;\u0026gt;nginx.com\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Thank you for using nginx.\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å¥½äº†ï¼Œè‡³æ­¤ç¬¬å››æ®µè½éƒ¨ç½² Nodeä¹Ÿé¡ºåˆ©ç»“æŸã€‚\nç»“æŸè¯­ # åœ¨ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¿‡ç¨‹ä¸­ï¼Œæ­å»ºçš„è¿‡ç¨‹å‚è€ƒäº†å¾ˆå¤šå›­å‹çš„åšå®¢ã€‚ç”±äºæˆ‘æ˜¯ä½¿ç”¨æœ€æ–°çš„ K8sã€etcd ç‰ˆæœ¬æ­å»ºçš„ï¼Œé‡åˆ°äº†å¾ˆå¤šçš„é—®é¢˜ï¼Œä½†æ²¡æœ‰å…³ç³»ï¼Œå¥½äº‹å¤šç£¨ã€‚\nåœ¨é‡åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œå‡ ä¹éƒ½æ˜¯é€šè¿‡æŸ¥çœ‹ K8s ä¸­ç»„ä»¶çš„è¿è¡ŒçŠ¶æ€å’Œæ—¥å¿—æ¥å¯»æ‰¾é—®é¢˜æ ¹æºå’Œè§£å†³æ–¹æ¡ˆçš„ã€‚\nå¤§éƒ¨åˆ†é—®é¢˜éƒ½æ˜¯å‡ºåœ¨é…ç½®æ–¹é¢ï¼Œæˆ–æ˜¯æ–‡ä»¶è·¯å¾„é…ç½®é—®é¢˜ï¼Œæˆ–æ˜¯æ–°ç‰ˆæœ¬çš„é…ç½®ä¸å…¼å®¹é—®é¢˜ã€‚\nÂ« äºŒè¿›åˆ¶æ­å»º K8s - 3 éƒ¨ç½² Master\nÂ» Kubernetes 0-1 å°è¯•ç†è§£äº‘åŸç”Ÿ\n"},{"id":125,"href":"/kubernetes/cloud-native-understood/","title":"Cloud Native Understood","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 å°è¯•ç†è§£äº‘åŸç”Ÿ\nKubernetes 0-1 å°è¯•ç†è§£äº‘åŸç”Ÿ # æœ€åˆçš„äº‘åŸç”Ÿå®šä¹‰ï¼š\nåº”ç”¨å®¹å™¨åŒ– é¢å‘å¾®æœåŠ¡æ¶æ„ åº”ç”¨æ”¯æŒå®¹å™¨ç¼–æ’è°ƒåº¦ é‡æ–°å®šä¹‰äº‘åŸç”Ÿï¼š\näº‘åŸç”ŸæŠ€æœ¯æœ‰åˆ©äºå„ç»„ç»‡åœ¨å…¬æœ‰äº‘ã€ç§æœ‰äº‘å’Œæ··åˆäº‘ç­‰æ–°å‹åŠ¨æ€ç¯å¢ƒä¸­ï¼Œæ„å»ºå’Œè¿è¡Œå¯å¼¹æ€§æ‰©å±•çš„åº”ç”¨ã€‚äº‘åŸç”Ÿçš„ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬å®¹å™¨ã€æœåŠ¡ç½‘æ ¼ã€å¾®æœåŠ¡ã€ä¸å¯å˜åŸºç¡€è®¾æ–½å’Œå£°æ˜å¼APIã€‚\nè¿™äº›æŠ€æœ¯èƒ½å¤Ÿæ„å»ºå®¹é”™æ€§å¥½ã€æ˜“äºç®¡ç†å’Œä¾¿äºè§‚å¯Ÿçš„æ¾è€¦åˆç³»ç»Ÿã€‚ç»“åˆå¯é çš„è‡ªåŠ¨åŒ–æ‰‹æ®µï¼Œäº‘åŸç”ŸæŠ€æœ¯ä½¿å·¥ç¨‹å¸ˆèƒ½å¤Ÿè½»æ¾åœ°å¯¹ç³»ç»Ÿä½œå‡ºé¢‘ç¹å’Œå¯é¢„æµ‹çš„é‡å¤§å˜æ›´ã€‚\näº‘åŸç”Ÿæœ¬èº«ä¸èƒ½ç§°ä¸ºæ˜¯ä¸€ç§æ¶æ„ï¼Œå®ƒé¦–å…ˆæ˜¯ä¸€ç§åŸºç¡€è®¾æ–½ï¼Œè¿è¡Œåœ¨å…¶ä¸Šçš„åº”ç”¨ç§°ä½œäº‘åŸç”Ÿåº”ç”¨ï¼Œåªæœ‰ç¬¦åˆäº‘åŸç”Ÿè®¾è®¡å“²å­¦çš„åº”ç”¨æ¶æ„æ‰å«äº‘åŸç”Ÿåº”ç”¨æ¶æ„ã€‚\nÂ« äºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node\nÂ» é›†ç¾¤è”é‚¦\n"},{"id":126,"href":"/kubernetes/cluster-federation/","title":"Cluster Federation","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / é›†ç¾¤è”é‚¦\né›†ç¾¤è”é‚¦ # äº‘æœåŠ¡æä¾›å•†çš„é›†ç¾¤è”é‚¦æ˜¯ä¸€ç§å°†å¤šä¸ªç‹¬ç«‹çš„ Kubernetes é›†ç¾¤ç»„åˆåœ¨ä¸€èµ·çš„æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•å…è®¸ç”¨æˆ·åœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´å…±äº«èµ„æºï¼Œä¾‹å¦‚ Podsã€Servicesã€Deployments ç­‰ã€‚é›†ç¾¤è”é‚¦çš„ç›®æ ‡æ˜¯åœ¨å¤šä¸ªé›†ç¾¤ä¸Šå¼•å…¥æ–°çš„æ§åˆ¶é¢æ¿ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„è§†å›¾ï¼Œä½¿ç”¨æˆ·å¯ä»¥åœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´æ— ç¼åœ°éƒ¨ç½²å’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚\næ¦‚å¿µ # æ•°æ®ä¸­å¿ƒï¼šRegionï¼Œæ˜¯ä¸€ä¸ªç‰©ç†ä½ç½®ï¼ŒåŒ…å«å¤šä¸ªå¯ç”¨æ€§åŒºåŸŸã€‚ å¯ç”¨æ€§åŒºåŸŸï¼šAvailability Zoneï¼ˆAZï¼‰ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®ä¸­å¿ƒï¼ŒåŒ…å« N å¤šæœåŠ¡å™¨èŠ‚ç‚¹ã€‚ ç®¡ç†é›†ç¾¤ï¼šæˆ–è€…å®¿ä¸»é›†ç¾¤ï¼Œæ˜¯ä¸€ä¸ªé›†ç¾¤è”é‚¦çš„æ ¸å¿ƒï¼Œç”¨äºç®¡ç†å¤šä¸ªå·¥ä½œé›†ç¾¤ã€‚ è”é‚¦é›†ç¾¤ï¼šæˆ–è€…å·¥ä½œé›†ç¾¤ï¼Œæ˜¯ä¸€ä¸ªæ™®é€šçš„ Kubernetes é›†ç¾¤ï¼Œç”¨äºéƒ¨ç½²å·¥ä½œè´Ÿè½½ã€‚ é›†ç¾¤è”é‚¦éœ€è¦è§£å†³çš„é—®é¢˜ # è·¨é›†ç¾¤æœåŠ¡å‘ç°ï¼šè¿é€šå¤šä¸ªé›†ç¾¤ï¼Œä½¿å¾—æœåŠ¡å¯ä»¥åœ¨å¤šä¸ªé›†ç¾¤ä¹‹é—´å‘ç°ï¼Œè®©è¯·æ±‚è·¨è¶Šé›†ç¾¤è¾¹ç•Œã€‚ è·¨é›†ç¾¤è°ƒåº¦ï¼šå°†è´Ÿè½½è°ƒåº¦åˆ°å¤šä¸ªé›†ç¾¤ï¼Œä¿è¯æœåŠ¡çš„ç¨³å®šæ€§ä»¥åŠå¯ç”¨æ€§ã€‚ é›†ç¾¤è”é‚¦å¼€æºé¡¹ç›® # Kubefed # é¡¹ç›®åœ°å€\nä¹‹å‰ç”± Kubernetes å®˜æ–¹å¤šé›†ç¾¤å…´è¶£å°ç»„å¼€å‘ï¼Œç›®å‰å·²ç»åœæ­¢ç»´æŠ¤ã€‚\næ¶æ„åŸç†ï¼š\nå°†è”é‚¦èµ„æºï¼ˆFederationResourceï¼‰ä»ç®¡ç†é›†ç¾¤åŒæ­¥åˆ°å·¥ä½œé›†ç¾¤ã€‚\nè¿™å…¶ä¸­é€šè¿‡ä¸‰ä¸ªæ¦‚å¿µæ¥å®ç°ï¼š\nTemplateï¼šå®šä¹‰äº†è”é‚¦èµ„æºçš„æ¨¡æ¿ï¼Œç”¨äºæŒ‡å®šè”é‚¦èµ„æºçš„å±æ€§ Placementï¼šå®šä¹‰äº†è”é‚¦é›†ç¾¤èµ„æºçš„éƒ¨ç½²ä½ç½®ï¼Œç”¨äºæŒ‡å®šè”é‚¦èµ„æºçš„éƒ¨ç½²ä½ç½®ã€‚ Overridesï¼šå®šä¹‰äº†è”é‚¦é›†ç¾¤èµ„æºçš„è¦†ç›–è§„åˆ™ï¼Œç”¨äºè¦†ç›–è”é‚¦èµ„æºçš„å±æ€§ã€‚ kubefed ä¸ºæ‰€æœ‰çš„ Kubernetes åŸç”Ÿèµ„æºæä¾›äº†å¯¹åº”çš„è”é‚¦èµ„æºï¼Œä¾‹å¦‚ FederatedServiceã€FederatedDeployment ç­‰ã€‚\nè”é‚¦èµ„æºä¸­å®šä¹‰äº†åŸç”Ÿèµ„æºçš„ Templateã€åˆé€šè¿‡ Overrides å®šä¹‰äº†èµ„æºåŒæ­¥åˆ°ä¸åŒçš„å·¥ä½œé›†ç¾¤æ—¶éœ€è¦åšçš„å˜æ›´ï¼Œä¾‹å¦‚ï¼š\nkind: FederatedDeployment ... spec: ... overrides: # Apply overrides to cluster1 - clusterName: cluster1 clusterOverrides: # Set the replicas field to 5 - path: \u0026#34;/spec/replicas\u0026#34; value: 5 # Set the image of the first container - path: \u0026#34;/spec/template/spec/containers/0/image\u0026#34; value: \u0026#34;nginx:1.17.0-alpine\u0026#34; # Ensure the annotation \u0026#34;foo: bar\u0026#34; exists - path: \u0026#34;/metadata/annotations\u0026#34; op: \u0026#34;add\u0026#34; value: foo: bar # Ensure an annotation with key \u0026#34;foo\u0026#34; does not exist - path: \u0026#34;/metadata/annotations/foo\u0026#34; op: \u0026#34;remove\u0026#34; # Adds an argument `-q` at index 0 of the args list # this will obviously shift the existing arguments, if any - path: \u0026#34;/spec/template/spec/containers/0/args/0\u0026#34; op: \u0026#34;add\u0026#34; value: \u0026#34;-q\u0026#34; Karmada # é¡¹ç›®åœ°å€ ç®¡ç†é›†ç¾¤åŒ…å«ä¸‰ä¸ªä¸»è¦ç»„ä»¶ï¼š\nAPIServer ControllerManagerï¼šå°†è”é‚¦èµ„æºåŒæ­¥åˆ°å·¥ä½œé›†ç¾¤å¹¶ç®¡ç†è”é‚¦èµ„æºçš„ç”Ÿå‘½å‘¨æœŸã€‚ Scheduler Karmada å°†èµ„æºæ¨¡æ¿è½¬æ¢æˆæˆå‘˜é›†ç¾¤çš„èµ„æºéœ€è¦ç»è¿‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\nDeploymentã€Serviceã€ConfigMap ç­‰èµ„æºæ¨¡æ¿ç»è¿‡ PropagationPolicy ç”Ÿæˆä¸€ç»„ ResourceBindingï¼Œæ¯ä¸ª ResourceBinding éƒ½å¯¹åº”ç‰¹å®šçš„æˆå‘˜é›†ç¾¤ï¼› ResourceBinding æ ¹æ® OverridePolicy æ”¹å˜ä¸€äº›èµ„æºä»¥é€‚åº”çš„ä¸åŒæˆå‘˜é›†ç¾¤ï¼Œä¾‹å¦‚ï¼šé›†ç¾¤åç­‰å‚æ•°ï¼Œè¿™äº›èµ„æºå®šä¹‰ä¼šå­˜å‚¨åœ¨ Work å¯¹è±¡ä¸­ï¼› Work å¯¹è±¡ä¸­å­˜å‚¨çš„èµ„æºå®šä¹‰ä¼šè¢«æäº¤åˆ°æˆå‘˜é›†ç¾¤ä¸­ï¼Œæˆå‘˜é›†ç¾¤ä¸­çš„ Controller Manager ç­‰æ§åˆ¶é¢æ¿ç»„ä»¶ä¼šè´Ÿè´£è¿™äº›èµ„æºçš„å¤„ç†ï¼Œä¾‹å¦‚ï¼šæ ¹æ® Deployment åˆ›å»º Pod ç­‰ã€‚ å¦‚ä¸‹ç¤ºä¾‹ï¼š\n# propagationpolicy.yaml apiVersion: policy.karmada.io/v1alpha1 kind: PropagationPolicy metadata: name: example-policy spec: resourceSelectors: - apiVersion: apps/v1 kind: Deployment name: nginx placement: clusterAffinity: clusterNames: - member1 # overridepolicy.yaml apiVersion: policy.karmada.io/v1alpha1 kind: OverridePolicy metadata: name: example-override namespace: default spec: resourceSelectors: - apiVersion: apps/v1 kind: Deployment name: nginx overrideRules: - targetCluster: clusterNames: - member1 overriders: plaintext: - path: \u0026#34;/metadata/annotations\u0026#34; operator: add value: foo: bar Â« Kubernetes 0-1 å°è¯•ç†è§£äº‘åŸç”Ÿ\nÂ» äº†è§£ ConfigMap\n"},{"id":127,"href":"/kubernetes/configmap-understood/","title":"Configmap Understood","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / äº†è§£ ConfigMap\näº†è§£ ConfigMap # å‡ ä¹æ‰€æœ‰çš„åº”ç”¨éƒ½éœ€è¦é…ç½®ä¿¡æ¯ï¼Œåœ¨ K8s éƒ¨ç½²åº”ç”¨ï¼Œæœ€ä½³å®è·µæ˜¯å°†åº”ç”¨çš„é…ç½®ä¿¡æ¯ï¼ˆç¯å¢ƒå˜é‡æˆ–è€…é…ç½®æ–‡ä»¶ï¼‰å’Œç¨‹åºæœ¬èº«åˆ†ç¦»ï¼Œè¿™æ ·é…ç½®ä¿¡æ¯çš„æ›´æ–°å’Œå¤ç”¨éƒ½å¯ä»¥æ›´ç®€å•ï¼Œä¹Ÿä½¿å¾—ç¨‹åºæ›´åŠ çµæ´»ã€‚\nKubernetes å…è®¸å°†é…ç½®é€‰é¡¹åˆ†ç¦»åˆ°å•ç‹¬çš„èµ„æºå¯¹è±¡ ConfigMap ä¸­ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé”®å€¼å¯¹æ˜ å°„ï¼Œå€¼å¯ä»¥æ˜¯ä¸€ä¸ªçŸ­ string ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„é…ç½®æ–‡ä»¶ã€‚\næœ¬ç¯‡ä¸»è¦ä»‹ç» ConfigMap èµ„æºçš„åˆ›å»ºå’Œä½¿ç”¨ã€‚\nConfigMap çš„åˆ›å»º # å¯ä»¥ç›´æ¥é€šè¿‡ kubectl create configmap å‘½ä»¤åˆ›å»ºï¼Œä¹Ÿå¯ä»¥å…ˆç¼–å†™ configmap çš„ yaml æ–‡ä»¶å†ä½¿ç”¨kubectl apply -f \u0026lt;filename\u0026gt;åˆ›å»ºï¼Œæ¨èä½¿ç”¨åè€…ã€‚\nå•è¡Œå‘½ä»¤åˆ›å»º ConfigMap # åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹çš„ ConfigMapï¼š kubectl create configmap first-config --from-literal=user=admin åˆ›å»ºå®Œæˆä¹‹åï¼Œä½¿ç”¨ kubectl describe configmap first-config æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ª configmap çš„é”®å€¼å†…å®¹ã€‚\nå¯ä»¥ä½¿ç”¨å¤šç»„ --from-literal=\u0026lt;key\u0026gt;=\u0026lt;value\u0026gt; å‚æ•°ï¼Œåœ¨ configmap ä¸­å®šä¹‰å¤šç»„é”®å€¼å¯¹ã€‚\nåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å†…å®¹çš„ ConfigMap å‡å¦‚æˆ‘å½“å‰æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ app.jsonï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;App\u0026#34;: \u0026#34;MyApp\u0026#34;, \u0026#34;Version\u0026#34;: \u0026#34;v1.0\u0026#34; } ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»º ConfigMapï¼š\nkubectl create configmap second-config --from-file=app.json åˆ›å»ºå®Œæˆä¹‹åï¼Œä½¿ç”¨ kubectl describe configmap second-config æŸ¥çœ‹ configmap çš„é”®å€¼å†…å®¹ï¼š\né»˜è®¤ä½¿ç”¨æ–‡ä»¶åç§° app.json ä½œä¸ºé”®å€¼å¯¹çš„ keyï¼Œä¹Ÿå¯ä»¥é€šè¿‡ --from-file=app_config=app.json æŒ‡å®škeyä¸º app_configï¼›\nå¯ä»¥ä½¿ç”¨å¤šç»„ --from-file=\u0026lt;key\u0026gt;=\u0026lt;filename\u0026gt; å‚æ•°ï¼Œåœ¨ configmap ä¸­å®šä¹‰å¤šç»„æ–‡ä»¶ï¼›\n--from-file= åé¢å¯ä»¥ç›´æ¥è·ŸæŸä¸ªæ–‡ä»¶è·¯å¾„ï¼Œè¿™æ ·ä¼šå°†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¼•å…¥åˆ° ConfigMap;\n--from-literal å’Œ --from-file å¯ä»¥å…±åŒä½¿ç”¨ï¼Œé”®å€¼åˆå¹¶ã€‚\nåˆ é™¤åˆ›å»ºçš„ first-config å’Œ second-configï¼š\nkubectl delete configmap first-config kubectl delete configmap second-config åŸºäºèµ„æºæ¸…å•æ–‡ä»¶åˆ›å»º ConfigMap # åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹çš„ ConfigMapï¼š é¦–å…ˆå®šä¹‰ ConfigMap çš„èµ„æºæ–‡ä»¶ first-config.yamlï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\nvim first-config.yaml apiVersion: v1 kind: ConfigMap metadata: name: first-config data: user: \u0026#34;admin\u0026#34; ä½¿ç”¨ kubectl apply å‘½ä»¤åˆ›å»º ConfigMap èµ„æºï¼š\nkubectl apply -f first-config.yaml åˆ›å»ºå®Œæˆä¹‹åï¼Œä½¿ç”¨ kubectl describe configmap first-config æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ª configmap çš„é”®å€¼å†…å®¹ï¼Œç»“æœä¸ä¸Šæ–‡ç¬¬ä¸€æ¬¡åˆ›å»ºçš„ first-configmap æ˜¯ä¸€è‡´çš„ã€‚\nå¯ä»¥åœ¨ data ä¸‹å®šä¹‰å¤šç»„é”®å€¼å¯¹ã€‚\nåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å†…å®¹çš„ ConfigMap é¦–å…ˆå®šä¹‰ ConfigMap çš„èµ„æºæ–‡ä»¶ second-config.yamlï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\nvim second-config.yaml apiVersion: v1 kind: ConfigMap metadata: name: second-config data: app.json: | { \u0026#34;App\u0026#34;: \u0026#34;MyApp\u0026#34;, \u0026#34;Version\u0026#34;: \u0026#34;v1.0\u0026#34; } ä½¿ç”¨ kubectl apply å‘½ä»¤åˆ›å»º ConfigMap èµ„æºï¼š\nkubectl apply -f second-config.yaml åˆ›å»ºå®Œæˆä¹‹åï¼Œä½¿ç”¨ kubectl describe configmap second-config æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ª configmap çš„é”®å€¼å†…å®¹ï¼Œç»“æœä¸ä¸Šæ–‡ç¬¬ä¸€æ¬¡åˆ›å»ºçš„ second-configmap æ˜¯ä¸€è‡´çš„ã€‚\nå¯ä»¥åœ¨ data ä¸‹å®šä¹‰å¤šç»„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å’Œé”®å€¼å¯¹ä¸€èµ·å®šä¹‰ï¼›\nå…¶æœ¬è´¨ä¹Ÿæ˜¯é”®å€¼å¯¹ï¼Œåªæ˜¯ value ä¸ºå¤šè¡Œæ ¼å¼çš„æ–‡æœ¬å†…å®¹ï¼›\nå¯¹ value æœ‰æ ¼å¼è¦æ±‚ï¼Œâ€|â€œæ¥æ¢è¡Œå¹¶ä¸”æ–‡ä»¶å†…å®¹çš„æ¯è¡ŒæŒ‰ç…§ key éƒ½å¾€åé€€æ ¼ã€‚\nåˆ é™¤åˆ›å»ºçš„ first-config å’Œ second-configï¼š\nkubectl delete configmap first-config kubectl delete configmap second-config ConfigMap çš„ä½¿ç”¨ # æˆ‘ä»¬åˆ›å»ºäº† ConfigMap åï¼Œæˆ‘ä»¬çš„ Pod èµ„æºå°±å¯ä»¥åˆ©ç”¨äº†ã€‚ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ä½¿ç”¨ ConfigMapï¼š\nä½¿ç”¨ ConfigMap ä½œä¸ºå®¹å™¨çš„ç¯å¢ƒå˜é‡ ä½¿ç”¨ ConfigMap ä½œä¸º Volume å‘å®¹å™¨æä¾›æ–‡ä»¶ ä½¿ç”¨ ConfigMap ä½œä¸ºå®¹å™¨çš„ç¯å¢ƒå˜é‡ # å‡å¦‚æœ‰ä¸€ä¸ªåä¸º first-configçš„ ConfigMapï¼Œé‡Œé¢åŒ…å«äº†ä¸€ä¸ªé”®ä¸º userï¼Œæˆ‘æƒ³å°†è¿™ä¸ª ConfigMap ä¸­ user é”®ç”¨åˆ°æˆ‘çš„ç¯å¢ƒå˜é‡ USER_NAME ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š\n... env: - name: USER_NAME valueFrom: configMapKeyRef: name: first-config key: user ... å¦‚æœæœ‰ä¸€ä¸ªåä¸º second-config ConfigMap ä¸­åŒ…å«å¤šä¸ªé”®å¦‚ HOSTï¼ŒPORTï¼ŒUSER_NAMEï¼ŒPASSWORDï¼Œæˆ‘æƒ³å°†è¿™ä¸ª ConfigMap ä¸­æ‰€æœ‰çš„é”®éƒ½ç”¨åˆ°æˆ‘çš„ç¯å¢ƒå˜é‡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š\n... spec: container: - image: \u0026lt;some-image\u0026gt; envFrom: - prefix: DB_ configMapRef: name: second-config ... å®¹å™¨å°†ä¼šç”Ÿæˆ DB_HOSTï¼ŒDB_PORTï¼ŒDB_USER_NAMEï¼ŒDB_PASSWORD å››ä¸ªç¯å¢ƒå˜é‡ï¼Œprefix ä¹Ÿå¯ä»¥ä¸é…ç½®ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ ConfigMap çš„é”®ã€‚\næ³¨æ„ï¼š\nconfigMapRef ä¸ä¸Šé¢ configMapKeyRef çš„åŒºåˆ«ï¼› å¦‚æœConfigMapä¸­æœ‰ä¸€ä¸ªä¸º USER-NAME é”®ï¼Œé‚£ä¹ˆå°†ä¸ä¼šç”Ÿæˆ DB_USER-NAME çš„ç¯å¢ƒå˜é‡ï¼Œå› ä¸º DB_USER-NAME ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„ç¯å¢ƒå˜é‡åç§°ã€‚ ä½¿ç”¨ ConfigMap ä½œä¸º Volume å‘å®¹å™¨æä¾›æ–‡ä»¶ # ä»è¿™é‡Œå¼€å§‹ï¼Œç»“åˆå®é™…æ¼”ç»ƒå¯èƒ½æ•ˆæœä¼šå¥½ä¸€ç‚¹ã€‚\næˆ‘ä»ç„¶ä½¿ç”¨ poneding/mockapi:v1 é•œåƒè¿è¡Œæ¨¡æ‹Ÿåº”ç”¨ç¨‹åºï¼Œç¨‹åºçš„ä»£ç åœ¨è¿™ï¼š https://github.com/poneding/for-docker\nè¿™ä¸ªåº”ç”¨ç¨‹åºæ ¹ç›®å½•ä¸‹å­˜åœ¨ mysettings/app.json å’Œ mysettings/secret.json ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œéœ€è¦æå‰è¯´æ˜çš„æ˜¯è¿™ä¸ªé•œåƒä¸­å·²ç»å­˜åœ¨äº†è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nmysettings/app.jsonï¼š\n{ \u0026#34;App\u0026#34;: \u0026#34;Hello Web\u0026#34;, \u0026#34;Version\u0026#34;: \u0026#34;v1\u0026#34; } mysettings/secret.jsonï¼š\n{ \u0026#34;UserName\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;Password\u0026#34;: \u0026#34;123456\u0026#34; } æˆ‘ç°åœ¨å°†è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶æ”¾åœ¨æˆ‘çš„ ConfigMap ä¸­ï¼Œå¹¶ä¸”å†…å®¹ä¸é•œåƒä¸­ç•¥å¾®åŒºåˆ«ï¼Œç”¨äºåŒºåˆ†ç¨‹åºè¯»å–é…ç½®æºè‡ª ConfigMapï¼Œç„¶åä½¿ç”¨ Volume çš„å½¢å¼å°†æ–‡ä»¶æŒ‚è½½åˆ°åº”ç”¨ä¸­å»ã€‚\né¦–å…ˆï¼Œå®šä¹‰ ConfigMap æ–‡ä»¶å¦‚ä¸‹ï¼š\nvim mockapi-mysettings.yaml apiVersion: v1 kind: ConfigMap metadata: name: mockapi-mysettings data: app.json: | { \u0026#34;App\u0026#34;:\u0026#34;Hello Web [From ConfigMap]\u0026#34;, \u0026#34;Version\u0026#34;:\u0026#34;v1 [From ConfigMap]\u0026#34; } secret.json: | { \u0026#34;UserName\u0026#34;:\u0026#34;admin [From ConfigMap]\u0026#34;, \u0026#34;Password\u0026#34;:\u0026#34;123456 [From ConfigMap]\u0026#34; } å®šä¹‰ Pod æ–‡ä»¶å¦‚ä¸‹ï¼š\nvim mockapi-pod.yaml apiVersion: v1 kind: Pod metadata: name: mockapi spec: containers: - name: mockapi image: poneding/mockapi:v1 ports: - containerPort: 80 volumeMounts: - mountPath: /app/mysettings name: mockapi-mysettings volumes: - name: mockapi-mysettings configMap: name: mockapi-mysettings Apply èµ„æºï¼š\nkubectl apply -f mockapi-mysettings.yaml kubectl apply -f mockapi-pod.yaml ç­‰å¾… mockapi çš„ Pod èµ·æ¥ä¹‹åï¼Œæˆ‘ä»¬è°ƒç”¨ http://\u0026lt;pod-ip\u0026gt;/configuration/mysettings æŸ¥çœ‹æŒ‚è½½çš„é…ç½®æ–‡ä»¶æ˜¯å¦ç”Ÿæ•ˆï¼š\nmockapi åº”ç”¨è®¿é—® /configuration/mysettings ä¼šè·å– app.json å’Œ secret.json é‡Œé¢çš„æ€»å…±å››ä¸ªé…ç½®é¡¹ï¼Œç„¶åè¾“å‡ºåˆ°å®¢æˆ·ç«¯ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œå·²ç»è·å–åˆ°äº† ConfigMap é‡Œé¢çš„é…ç½®ï¼Œè¿›å…¥å®¹å™¨ä¹Ÿå¯ä»¥çœ‹åˆ°é‡Œé¢çš„é—®é¢˜ä»¶å†…å®¹ï¼š\nä¿®æ”¹ ConfigMap è‡ªåŠ¨æ›´æ–°æŒ‚è½½æ–‡ä»¶ï¼š\nç°åœ¨ï¼Œå¦‚æœæˆ‘æƒ³è¦ä¿®æ”¹æˆ‘çš„é…ç½®ï¼Œæ¯”å¦‚æˆ‘çš„å¯†ç ä¿®æ”¹æˆäº† abcdefgï¼Œæˆ‘ä¸ç”¨é‡æ–°å¯åŠ¨ Podï¼Œæˆ‘åªéœ€è¦ä¿®æ”¹ ConfigMap æ–‡ä»¶ï¼š\napiVersion: v1 kind: ConfigMap metadata: name: mockapi-mysettings data: app.json: | { \u0026#34;App\u0026#34;:\u0026#34;Hello Web [From ConfigMap]\u0026#34;, \u0026#34;Version\u0026#34;:\u0026#34;v1 [From ConfigMap]\u0026#34; } secret.json: | { \u0026#34;UserName\u0026#34;:\u0026#34;admin [From ConfigMap]\u0026#34;, \u0026#34;Password\u0026#34;:\u0026#34;abcdefg [From ConfigMap]\u0026#34; } ç„¶åé‡æ–° Apply èµ„æºï¼š\nkubectl apply -f mockapi-mysettings.yaml é…ç½®æ–‡ä»¶çš„æ›´æ–°éœ€è¦ 1-2 åˆ†é’Ÿçš„æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥è¿ç»­è§‚å¯Ÿæ–‡ä»¶çš„æ›´æ–°æƒ…å†µï¼š\nå¯ä»¥çœ‹åˆ°ï¼Œè¿‡æ®µæ—¶é—´åé…ç½®æ–‡ä»¶æ›´æ–°äº†ã€‚\nè¿™é‡Œé‡åˆ°äº†ä¸€ä¸ªå°é—®é¢˜ï¼Œç»§ç»­è®¿é—® /configuration/mysettingsï¼Œåº”ç”¨ç¨‹åºå¹¶æ²¡æœ‰çƒ­æ›´æ–°ï¼Œä½†æ˜¯æˆ‘ä½¿ç”¨ hostPath çš„ Volume å½¢å¼æŒ‚è½½æ—¶ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶æ˜¯å¯ä»¥çƒ­æ›´æ–°çš„ï¼Œå¸Œæœ›æœ‰ç¼˜äººèƒ½ç»™æˆ‘è§£ç­”å§ã€‚\nå¤šæ–‡ä»¶ç›®å½•ä¸‹æŒ‚è½½å•ä¸ªæ–‡ä»¶ï¼š\nåœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œå¯èƒ½ secret.json çš„å˜åŠ¨æ›´ä¸ºé¢‘ç¹ï¼Œè€Œ app.json æ–‡ä»¶å‡ ä¹ä¸ä¼šå˜åŠ¨ï¼Œæˆ‘ç°åœ¨åªæƒ³ä½¿ç”¨ ConfigMap ä¼ é€’ secret.json æ–‡ä»¶ï¼Œè€Œä¸å†ä¼ é€’ app.jsonï¼Œè¿™æ—¶ï¼Œä¿®æ”¹ ConfigMap æ–‡ä»¶å¦‚ä¸‹ï¼š\napiVersion: v1 kind: ConfigMap metadata: name: mockapi-mysettings data: secret.json: | { \u0026#34;UserName\u0026#34;:\u0026#34;admin [From ConfigMap]\u0026#34;, \u0026#34;Password\u0026#34;:\u0026#34;123456 [From ConfigMap]\u0026#34; } ç„¶åï¼Œé‡æ–° Apply èµ„æº:\nkubectl apply -f mockapi-mysettings.yaml è¿™æ—¶å€™ï¼Œæˆ‘ä»¬ç»§ç»­è®¿é—® /configuration/mysettingsï¼š\nå¾ˆé—æ†¾çš„å‘ç°ï¼Œæˆ‘ä»¬çš„ app.json çš„é…ç½®é¡¹éƒ½å¤±æ•ˆäº†ï¼Œæˆ‘ä»¬æ¥ç€å»å®¹å™¨ä¸­ä¸€æ¢ç©¶ç«Ÿï¼š\nåŸæ¥ï¼Œapp.json æ–‡ä»¶å·²ç»ä¸å­˜åœ¨äº†ã€‚\nå¤§æ¦‚æ¨æµ‹ä¸€ä¸‹å¯ä»¥çŸ¥é“ï¼Œ**å¦‚æœä½¿ç”¨ ConfigMap æŒ‚è½½åˆ°å®¹å™¨çš„ä¸€ä¸ªç›®å½•ï¼Œé‚£ä¹ˆè¯¥ç›®å½•ä¼šè¢« ConfigMap æ‰€è¦†ç›–ã€‚**é‚£ä¹ˆå¦‚æœåªæŒ‚è½½å•ä¸ªç›®å½•å‘¢ï¼Ÿä½¿ç”¨ subPathï¼\nä¿®æ”¹ Pod æ–‡ä»¶å¦‚ä¸‹ï¼š\napiVersion: v1 kind: Pod metadata: name: mockapi spec: containers: - name: mockapi image: poneding/mockapi:v1 ports: - containerPort: 80 volumeMounts: - mountPath: /app/mysettings/secret.json name: mockapi-mysettings subPath: secret.json volumes: - name: mockapi-mysettings configMap: name: mockapi-mysettings mountPath æ˜¯å®¹å™¨ä¸­ç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼›\nsubPath æ˜¯ConfgMapæ–‡ä»¶çš„ Key å€¼ã€‚\nç„¶åï¼Œé‡æ–° Apply èµ„æº:\nkubectl delete -f mockapi-pod.yaml kubectl apply -f mockapi-pod.yaml ç­‰å¾…Podè¿è¡Œåï¼Œæˆ‘ä»¬è®¿é—® /configuration/mysettingsï¼Œå¹¶æŸ¥çœ‹ mysettings ç›®å½•ä¸‹æ–‡ä»¶ï¼š\nå¯ä»¥çœ‹åˆ°æˆåŠŸçš„æŒ‚è½½ secret.json æ–‡ä»¶è€Œæ²¡æœ‰æŒ‚è½½ app.json æ–‡ä»¶ï¼Œ[From ConfigMap] å°±æ˜¯è¯æ˜ã€‚\néœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°ï¼Œä½¿ç”¨ subPath æŒ‚è½½å•æ–‡ä»¶çš„è¯ï¼ŒConfigMap çš„æ›´æ–°ä¸ä¼šåŒæ­¥æ›´æ–°åˆ°å®¹å™¨å¯¹åº”æ–‡ä»¶ä¸­ã€‚è¿™æ—¶å€™çš„è§£å†³åŠæ³•æ˜¯ä¸€ä¸ªç›®å½•åªå­˜æ”¾ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶å ConfigMap æŒ‚è½½åˆ°ç›®å½•ã€‚\nå¦‚æœä¸€ä¸ª ConfigMapï¼ˆapp-configï¼‰ä¸­å®šä¹‰äº†å¤šä¸ªæ–‡ä»¶ï¼ˆapp1.jsonã€app2.jsonï¼‰ï¼Œä½†æ˜¯ app1-pod ä¸­åªä¼šä½¿ç”¨åˆ° app1.jsonï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š\n... volumeMounts: - mountPath: /config/path name: mockapi-mysettings volumes: - name: app-config configMap: name: app-config items: - key: app1.json path: app.json items çš„ key ç”¨äºæŒ‡å®š ConfigMap çš„ keyï¼Œpath åˆ™å¯ä»¥å®šä¹‰ä¸ºç¨‹åºä¸­çš„æ–‡ä»¶åã€‚\nÂ« é›†ç¾¤è”é‚¦\nÂ» å®šæœŸåˆ é™¤ ElasticSearch æ—¥å¿—ç´¢å¼•\n"},{"id":128,"href":"/kubernetes/delete-es-log-index-scheduler/","title":"Delete Es Log Index Scheduler","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / å®šæœŸåˆ é™¤ ElasticSearch æ—¥å¿—ç´¢å¼•\nå®šæœŸåˆ é™¤ ElasticSearch æ—¥å¿—ç´¢å¼• # èƒŒæ™¯ # å½“å‰åœ¨ K8s é›†ç¾¤ä¸­éƒ¨ç½²äº†ä¸€å¥— EFK æ—¥å¿—ç›‘æ§ç³»ç»Ÿï¼Œæ—¥å¤ä¸€æ—¥ï¼ŒElasticSearchæ”¶é›†çš„æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œå†…å­˜ä»¥åŠå­˜å‚¨å ç”¨è¶Šæ¥è¶Šé«˜ï¼Œéœ€è¦å®šæœŸæ¥åˆ é™¤è€æ—§çš„æ—¥å¿—æ•°æ®ï¼Œæ¥è§£æ”¾å†…å­˜å’Œå­˜å‚¨ç©ºé—´ï¼Œè€ƒè™‘åˆ° K8s ä¸­ cronjob çš„åŠŸèƒ½ç‰¹æ€§ï¼Œæ‰“ç®—ä½¿ç”¨å®ƒåˆ¶å®šä¸€ä¸ªesæ—¥å¿—ç´¢å¼•æ¸…é™¤è„šæœ¬ï¼Œå®šæ—¶æ¸…é™¤æ—¥å¿—æ•°æ®ã€‚\nConfigMap # è¿™ä¸ªconfigMapç”¨æ¥å­˜å‚¨ä¸€ä¸ªshellè„šæœ¬ï¼Œè¯¥shellè„šæœ¬æ‰§è¡Œæ—¥å¿—ç´¢å¼•æ¸…é™¤æ“ä½œï¼š\napiVersion: v1 kind: ConfigMap metadata: name: es-log-indices-clear-configmap namespace: efk data: clean-indices.sh: | #/bin/bash LAST_MONTH_DATE=`date -d \u0026#34;1 month ago\u0026#34; +\u0026#34;%Y.%m.%d\u0026#34;` echo Start clear es indices *-${LAST_MONTH_DATE} curl -XDELETE http://elasticsearch:9200/*-${LAST_MONTH_DATE} --- è¯´æ˜ï¼šè¿™é‡Œæˆ‘é…ç½®çš„configmapæ‰€åœ¨å‘½åç©ºé—´å’Œefkéƒ¨ç½²çš„å‘½åç©ºé—´ä¸€è‡´ï¼Œå¹¶ä¸”esçš„Serviceçš„åç§°æ˜¯elasticsearchï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ http://elasticsearch:9200è®¿é—®åˆ°esæœåŠ¡ï¼Œå¦åˆ™çš„è¯éœ€è¦æ˜¯æ— æ³•è®¿é—®åˆ°çš„ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µé…ç½®esçš„æœåŠ¡åœ°å€ï¼›\nCronJob # CronJobä½¿ç”¨äº† poneding/sparrow\napiVersion: batch/v1beta1 kind: CronJob metadata: name: clean-indices namespace: efk spec: schedule: \u0026#34;0 0 1/1 * *\u0026#34; jobTemplate: spec: template: spec: containers: - name: auto-recycle-job image: poneding/sparrow args: [\u0026#34;/bin/sh\u0026#34;, \u0026#34;/job/clean-indices.sh\u0026#34;] volumeMounts: - name: vol mountPath: /job volumes: - name: vol configMap: name: es-log-indices-clear-configmap restartPolicy: OnFailure è¯´æ˜ï¼š\né…ç½® cronjob é•œåƒä¸º poneding/sparrowï¼Œæ˜¯è‡ªåˆ¶çš„é•œåƒï¼Œå› ä¸º busybox é•œåƒé‡Œé¢æ²¡æœ‰é›†æˆ curl å‘½ä»¤å¹¶ä¸” date çš„å‘½ä»¤ä¹Ÿä¸å®Œå…¨; å°† configmap æŒ‚è½½åˆ° job ç›®å½•ä¸‹ï¼› é…ç½® cronjob è°ƒåº¦æ—¶é—´ä¸º 0 0 1/1 * *ï¼Œæ¯å¤©çš„é›¶ç‚¹æ‰§è¡Œjobç›®å½•ä¸‹çš„ clean-indices.sh è„šæœ¬æ–‡ä»¶ï¼› é‡åˆ°çš„é—®é¢˜ # åœ¨å®é™…æµ‹è¯•è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„è„šæœ¬æ˜¯é€šè¿‡ curl DElETE æ–¹æ³•æ¥è°ƒç”¨ es çš„åˆ é™¤ç´¢å¼• apiï¼Œæˆ‘ä»¬ä½¿ç”¨ *-yyyy.MM.dd é€šé…ç¬¦åŒ¹é…å¹¶åˆ é™¤ç¬¦åˆçš„ es ç´¢å¼•ï¼Œä½†æ˜¯ ES é»˜è®¤æ˜¯æœ‰è‡ªå·±çš„ä¿æŠ¤æœºåˆ¶çš„ï¼Œé»˜è®¤ç¦æ­¢ä½¿ç”¨é€šé…ç¬¦æˆ– _all åˆ é™¤ç´¢å¼•ï¼Œè¿™ä¸ªåšæ³•æˆ‘ä»¬ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œæ¯•ç«Ÿä¸èƒ½å…è®¸å¦‚æ­¤è½»æ˜“çš„å¤§é‡åˆ é™¤ã€‚\n/var/www/app # curl -XDELETE http://elasticsearch:9200/*-2020.10.09 {\u0026#34;error\u0026#34;:{\u0026#34;root_cause\u0026#34;:[{\u0026#34;type\u0026#34;:\u0026#34;illegal_argument_exception\u0026#34;,\u0026#34;reason\u0026#34;:\u0026#34;Wildcard expressions or all indices are not allowed\u0026#34;}],\u0026#34;type\u0026#34;:\u0026#34;illegal_argument_exception\u0026#34;,\u0026#34;reason\u0026#34;:\u0026#34;Wildcard expressions or all indices are not allowed\u0026#34;},\u0026#34;status\u0026#34;:400} è§£å†³æ–¹æ¡ˆæ˜¯è®¾ç½® elasticsearch é…ç½®é¡¹ï¼šaction.destructive_requires_name ä¸º false.\né—æ†¾çš„æ˜¯æ— è®ºæˆ‘é€šè¿‡ä¿®æ”¹esçš„é…ç½®æ–‡ä»¶ elasticsearch.ymlï¼ˆä½äº /usr/share/elasticsearch/config è·¯å¾„ä¸‹ï¼‰è¿˜æ˜¯å¢åŠ ç¯å¢ƒå˜é‡éƒ½æ²¡èµ·åˆ°æ•ˆæœï¼š\n... # es-configmap data: elasticsearch.yml: | cluster.name: \u0026#34;es-cluster\u0026#34; network.host: 0.0.0.0 action.destructive_requires_name: false ... ... # es-statefulset env: - name: cluster.name value: es-cluster - name: action.destructive_requires_name value: \u0026#34;false\u0026#34; ... æœ€åï¼Œåˆæ‰¾åˆ°äº†ä¸€ä¸ªæ–¹æ³•ï¼šä½¿ç”¨ ES è¯­æ³•ä¿®æ”¹é…ç½®ã€‚\nPUT /_cluster/settings { \u0026#34;persistent\u0026#34; : { \u0026#34;action.destructive_requires_name\u0026#34; : \u0026#34;false\u0026#34; } } è¿™æ—¶å€™å†æ¬¡ä½¿ç”¨é€šé…ç¬¦æ‰§è¡Œåˆ é™¤ï¼š\n/var/www/app# curl -XDELETE http://elasticsearch:9200/*-2020.10.09 {\u0026#34;acknowledged\u0026#34;:true} è™½ç„¶é—®é¢˜æ˜¯è§£å†³äº†ï¼Œä½†æ˜¯ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸ç”Ÿæ•ˆï¼Œè¿˜æ˜¯ä»¤äººå›°æ‰°ï¼Œå¯èƒ½æ˜¯ç”±äº es é›†ç¾¤çš„å…³ç³»ï¼Œå•èŠ‚ç‚¹çš„é…ç½®å¹¶æœªå¯¹é›†ç¾¤ç”Ÿæ•ˆã€‚\nè¿½åŠ ï¼Œè²Œä¼¼å¯ä»¥ä»è¿™å¾—åˆ°ç­”æ¡ˆ =\u0026gt; å®˜æ–¹æ–‡æ¡£ï¼š https://www.elastic.co/guide/en/elasticsearch/reference/current/settings.html\nÂ« äº†è§£ ConfigMap\nÂ» å¼ºåˆ¶åˆ é™¤ K8s èµ„æº\n"},{"id":129,"href":"/kubernetes/delete-k8s-resource-force/","title":"Delete K8s Resource Force","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / å¼ºåˆ¶åˆ é™¤ K8s èµ„æº\nå¼ºåˆ¶åˆ é™¤ K8s èµ„æº # å¼ºåˆ¶åˆ é™¤ Pod # kubectl delete po \u0026lt;pod\u0026gt; -n \u0026lt;namespace\u0026gt; --force --grace-period=0 å¼ºåˆ¶åˆ é™¤ PVC # kubectl patch pv \u0026lt;pv\u0026gt; -n \u0026lt;namespace\u0026gt; -p \u0026#39;{\u0026#34;metadata\u0026#34;:{\u0026#34;finalizers\u0026#34;:null}}\u0026#39; å¼ºåˆ¶åˆ é™¤ PV # kubectl patch pvc \u0026lt;pvc\u0026gt; -n \u0026lt;namespace\u0026gt; -p \u0026#39;{\u0026#34;metadata\u0026#34;:{\u0026#34;finalizers\u0026#34;:null}}\u0026#39; å¼ºåˆ¶åˆ é™¤å‘½åç©ºé—´ # åœ¨åˆ é™¤ kubesphere çš„å‘½åç©ºé—´æ—¶é‡åˆ°æ— æ³•åˆ é™¤æˆåŠŸçš„ç°è±¡ï¼Œå‘½åç©ºé—´ä¸€ç›´å¤„äº Terminating çŠ¶æ€ã€‚\n$ kubectl get ns |grep kubesphere NAME STATUS AGE kubesphere-controls-system Terminating 22d kubesphere-monitoring-system Terminating 21d åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚\né¦–å…ˆè·å–å‘½åç©ºé—´çš„ json æ–‡ä»¶ï¼Œ\nkubectl get ns kubesphere-controls-system -o json \u0026gt; temp.json ä¿®æ”¹ temp.json å¦‚ä¸‹ï¼š\n{ \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;kind\u0026#34;: \u0026#34;Namespace\u0026#34;, \u0026#34;metadata\u0026#34;: { ... \u0026#34;finalizers\u0026#34;: [ \u0026#34;finalizers.kubesphere.io/namespaces\u0026#34; //åˆ é™¤æ­¤è¡Œ ], ... } è¿˜æœ‰ä¸€ç§æƒ…å†µä¸åŒï¼Œå¯èƒ½éœ€è¦åˆ é™¤çš„åœ°æ–¹å¦‚ä¸‹ï¼š\n{ \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;kind\u0026#34;: \u0026#34;Namespace\u0026#34;, ... \u0026#34;spec\u0026#34;: { \u0026#34;finalizers\u0026#34;: [ // åˆ é™¤ \u0026#34;kubernetes\u0026#34; // åˆ é™¤ ] // åˆ é™¤ }, ... } å®Œæˆæ–‡ä»¶ä¿®æ”¹åï¼Œæœ¬åœ°ä»£ç† kubernetes serviceï¼š\nkubectl proxy --port 8081 ä»¥ä¸Šæ“ä½œä¼šå ç”¨å½“å‰ç»ˆç«¯çª—å£ï¼Œå¦å¤–å¼€å¯ç»ˆç«¯ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š\ncurl -k -H \u0026#34;Content-Type:application/json\u0026#34; -X PUT --data-binary @temp.json http://127.0.0.1:8081/api/v1/namespaces/kubesphere-controls-system/finalize æ‰§è¡Œä»¥ä¸Šå‘½ä»¤å¤§è‡´è¾“å‡ºå¦‚ä¸‹ï¼š\n$ curl -k -H \u0026#34;Content-Type:application/json\u0026#34; -X PUT --data-binary @kcs.json http://127.0.0.1:8081/api/v1/namespaces/kubesphere-controls-system/finalize { \u0026#34;kind\u0026#34;: \u0026#34;Namespace\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;metadata\u0026#34;: { ... \u0026#34;deletionGracePeriodSeconds\u0026#34;: 0, \u0026#34;labels\u0026#34;: { \u0026#34;kubesphere.io/namespace\u0026#34;: \u0026#34;kubesphere-controls-system\u0026#34;, \u0026#34;kubesphere.io/workspace\u0026#34;: \u0026#34;system-workspace\u0026#34; }, ... \u0026#34;finalizers\u0026#34;: [ \u0026#34;finalizers.kubesphere.io/namespaces\u0026#34; ] }, \u0026#34;spec\u0026#34;: { }, \u0026#34;status\u0026#34;: { \u0026#34;phase\u0026#34;: \u0026#34;Terminating\u0026#34;, \u0026#34;conditions\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;NamespaceDeletionDiscoveryFailure\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;False\u0026#34;, \u0026#34;lastTransitionTime\u0026#34;: \u0026#34;2021-01-26T07:22:06Z\u0026#34;, \u0026#34;reason\u0026#34;: \u0026#34;ResourcesDiscovered\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;All resources successfully discovered\u0026#34; }, { \u0026#34;type\u0026#34;: \u0026#34;NamespaceDeletionGroupVersionParsingFailure\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;False\u0026#34;, \u0026#34;lastTransitionTime\u0026#34;: \u0026#34;2021-01-26T07:22:06Z\u0026#34;, \u0026#34;reason\u0026#34;: \u0026#34;ParsedGroupVersions\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;All legacy kube types successfully parsed\u0026#34; }, { \u0026#34;type\u0026#34;: \u0026#34;NamespaceDeletionContentFailure\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;False\u0026#34;, \u0026#34;lastTransitionTime\u0026#34;: \u0026#34;2021-01-26T07:23:13Z\u0026#34;, \u0026#34;reason\u0026#34;: \u0026#34;ContentDeleted\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;All content successfully deleted\u0026#34; } ] } } è¿™æ—¶å€™é¡½å›ºçš„çš„å‘½åç©ºé—´å·²ç»æ¸…é™¤æ‰äº†ã€‚\nÂ« å®šæœŸåˆ é™¤ ElasticSearch æ—¥å¿—ç´¢å¼•\nÂ» Gateway API å®è·µ\n"},{"id":130,"href":"/kubernetes/gateway-api-practice/","title":"Gateway API Practice","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Gateway API å®è·µ\nGateway API å®è·µ # Gateway API è¿˜åœ¨ç§¯æå¼€å‘ä¸­ï¼Œç›®å‰å·²ç»å‘å¸ƒäº† v1.0.0 ç‰ˆæœ¬ã€‚å¯ä»¥é€šè¿‡ gateway-api æ–‡æ¡£ è·å–æœ€æ–°è¿›å±•ã€‚\nGateway API æ¦‚è¿° # Gateway API æ˜¯ä¸€ä¸ª Kubernetes çš„æ‰©å±• APIï¼Œå®ƒå®šä¹‰äº†ä¸€å¥— API æ¥ç®¡ç†ç½‘å…³ã€è·¯ç”±ã€TLS ç­‰èµ„æºå¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£ä¼ ç»Ÿçš„ Ingressã€‚\nå’Œ Ingress ä¸€æ ·ï¼ŒGateway API ä¹Ÿæ˜¯ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå®ƒå®šä¹‰äº†ä¸€å¥— API æ¥å£ï¼Œè¿™äº›æ¥å£ç”±ç¤¾åŒºä¸­çš„ä¸åŒå‚å•†æ¥å®ç°ï¼Œæ¯”å¦‚ nginxã€envoyã€traefik ç­‰ã€‚\nAPI æ¸…å• # GatewayClass Gateway HTTPRoute GRPCRoute BackendTLSPolicy ReferenceGrant å®‰è£… Gateway API # # å®‰è£…æœ€æ–°ç‰ˆ gateway-api CRDs export LATEST=$(curl -s https://api.github.com/repos/kubernetes-sigs/gateway-api/releases/latest | jq -r .tag_name) kubectl apply -f https://github.com/nginxinc/nginx-gateway-fabric/releases/download/$LATEST/crds.yaml å®‰è£… Gateway Controller # gateway-api åªæ˜¯å®šä¹‰äº†ä¸€å¥— APIï¼Œéœ€è¦ gateway-controller æ¥å®ç°è¿™äº› APIã€‚ç›®å‰å·²ç»æœ‰è®¸å¤šå‚å•†å®ç°äº† gateway-controllerï¼Œæ¯”å¦‚ nginxã€envoyã€traefik ç­‰ã€‚\nä¸‹é¢ä»‹ç»å¦‚ä½•å®‰è£… nginx-gateway-fabricï¼š\n# å®‰è£…æœ€æ–°ç‰ˆ gateway-controller export LATEST=$(curl -s https://api.github.com/repos/nginxinc/nginx-gateway-fabric/releases/latest | jq -r .tag_name) kubectl apply -f https://github.com/nginxinc/nginx-gateway-fabric/releases/download/$LATEST/nginx-gateway.yaml é…ç½® nginx-gateway ä½¿ç”¨ä¸»æœºç½‘ç»œï¼š\nkubectl patch deployment nginx-gateway -n nginx-gateway --type=\u0026#39;json\u0026#39; -p=\u0026#39;[{\u0026#34;op\u0026#34;: \u0026#34;add\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/spec/template/spec/hostNetwork\u0026#34;, \u0026#34;value\u0026#34;: true}]\u0026#39; æ³¨æ„ï¼šé…ç½®ä½¿ç”¨ä¸»æœºç½‘ç»œä¹‹åï¼Œå®¿ä¸»æœºçš„ 80 ç«¯å£å°†è¢«å ç”¨ï¼Œå› æ­¤ä¸€ä¸ªèŠ‚ç‚¹åªå…è®¸è°ƒåº¦ä¸€ä¸ª nginx-gateway Podï¼Œå½“æ›´æ–° nginx-gateway æ—¶ï¼Œæ‚¨å¯èƒ½éœ€è¦å…ˆåœæ­¢æ—§çš„ Podï¼Œå†å¯åŠ¨æ–°çš„ Podã€‚\nåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç°æœ‰å¯èƒ½ç”±äºå®¿ä¸»æœºçš„å·®å¼‚å¯¼è‡´ nginx-gateway å¥åº·æ£€æŸ¥æ— æ³•é€šè¿‡ï¼ŒPod ä¸èƒ½æ­£å¸¸å¯åŠ¨ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½® allowPrivilegeEscalation å­—æ®µæ¥è§£å†³ï¼š\n# ä½¿ç”¨ä¸»æœºç½‘ç»œï¼Œç«¯å£è¢«å ç”¨ï¼Œéœ€è¦å…ˆåœæ­¢ nginx-gateway kubectl scale deployment nginx-gateway -n nginx-gateway --replicas=0 kubectl patch deployment nginx-gateway -n nginx-gateway --type=\u0026#39;json\u0026#39; -p=\u0026#39;[{\u0026#34;op\u0026#34;: \u0026#34;replace\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/spec/template/spec/containers/0/securityContext/allowPrivilegeEscalation\u0026#34;, \u0026#34;value\u0026#34;: true}]\u0026#39; kubectl scale deployment nginx-gateway -n nginx-gateway --replicas=1 å®è·µ # ç®€å•ç½‘å…³è·¯ç”± # éƒ¨ç½² nginx deploymentï¼Œå¹¶ä¸”æš´éœ²æœåŠ¡ï¼š\nkubectl create deployment nginx --image=nginx kubectl expose deployment nginx --name=nginx --port=80 --target-port=80 éƒ¨ç½² nginx gateway \u0026amp; httpRouteï¼š\n```bash kubectl apply -f - \u0026lt;\u0026lt;EOF apiVersion: gateway.networking.k8s.io/v1 kind: Gateway metadata: name: gateway spec: gatewayClassName: nginx listeners: - name: http port: 80 protocol: HTTP hostname: \u0026#34;*.mydomain.com\u0026#34; --- apiVersion: gateway.networking.k8s.io/v1 kind: HTTPRoute metadata: name: nginx spec: parentRefs: - name: gateway sectionName: http hostnames: - \u0026#34;nginx.mydomain.com\u0026#34; rules: - matches: - path: type: PathPrefix value: / backendRefs: - name: nginx port: 80 EOF TLS ç½‘å…³è·¯ç”±ï¼šCertManager + Let\u0026rsquo;s Encrypt # ç‰¹å®šåŸŸåç½‘å…³ï¼š\napiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: mydomain-cert-issuer spec: acme: email: poneding@gmail.com server: https://acme-v02.api.letsencrypt.org/directory privateKeySecretRef: name: mydomain-cert-issuer-account-key solvers: - http01: gatewayHTTPRoute: parentRefs: - name: nginx-gateway namespace: nginx-gateway kind: Gateway selector: dnsNames: - \u0026#34;nginx.mydomain.com\u0026#34; --- apiVersion: gateway.networking.k8s.io/v1 kind: Gateway metadata: name: nginx-gateway namespace: nginx-gateway annotations: cert-manager.io/cluster-issuer: mydomain-cert-issuer spec: gatewayClassName: nginx listeners: - name: nginx-mydomain-https hostname: \u0026#39;nginx.mydomain.com\u0026#39; protocol: HTTPS port: 443 allowedRoutes: namespaces: from: All tls: certificateRefs: - group: \u0026#34;\u0026#34; kind: Secret name: nginx-mydomain-https-cert mode: Terminate --- apiVersion: gateway.networking.k8s.io/v1 kind: HTTPRoute metadata: name: nginx spec: parentRefs: - name: nginx-gateway namespace: nginx-gateway sectionName: nginx-mydomain-https hostnames: - \u0026#34;nginx.mydomain.com\u0026#34; rules: - matches: backendRefs: - name: nginx port: 80 é€šé…ç¬¦åŸŸåï¼ˆæ³›åŸŸåï¼‰ç½‘å…³ï¼š\napiVersion: v1 kind: Secret metadata: name: cloudflare-api-token namespace: cert-manager type: Opaque stringData: api-token: [your_cloudflare_api_token] --- apiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: mydomain-cert-issuer spec: acme: email: poneding@gmail.com server: https://acme-v02.api.letsencrypt.org/directory privateKeySecretRef: name: mydomain-cert-issuer-account-key solvers: - dns01: cloudflare: apiTokenSecretRef: name: cloudflare-api-token key: api-token selector: dnsNames: - \u0026#34;*.gateway.mydomain.com\u0026#34; --- apiVersion: gateway.networking.k8s.io/v1 kind: Gateway metadata: name: nginx-gateway namespace: nginx-gateway annotations: cert-manager.io/cluster-issuer: mydomain-cert-issuer spec: gatewayClassName: nginx listeners: # encrypted by cloudflare - name: wildcard-mydomain-http hostname: \u0026#39;*.mydomain.com\u0026#39; protocol: HTTP port: 80 allowedRoutes: namespaces: from: All - name: wildcard-gateway-mydomain-http hostname: \u0026#39;*.gateway.mydomain.com\u0026#39; protocol: HTTP port: 80 allowedRoutes: namespaces: from: All - name: wildcard-gateway-mydomain-https hostname: \u0026#39;*.gateway.mydomain.com\u0026#39; protocol: HTTPS port: 443 allowedRoutes: namespaces: from: All tls: certificateRefs: - group: \u0026#34;\u0026#34; kind: Secret name: wildcard-gateway-mydomain-cert mode: Terminate --- apiVersion: gateway.networking.k8s.io/v1 kind: HTTPRoute metadata: name: nginx spec: parentRefs: - name: nginx-gateway namespace: nginx-gateway sectionName: wildcard-gateway-mydomain-https hostnames: - \u0026#34;nginx.gateway.mydomain.com\u0026#34; rules: - matches: backendRefs: - name: nginx port: 80 Â« å¼ºåˆ¶åˆ é™¤ K8s èµ„æº\nÂ» Kubernetes 0-1 Helm Kubernetes çš„åŒ…ç®¡ç†å·¥å…·\n"},{"id":131,"href":"/kubernetes/helm-k8s-package-management-tool/","title":"Helm K8s Package Management Tool","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 Helm Kubernetes çš„åŒ…ç®¡ç†å·¥å…·\nKubernetes 0-1 Helm Kubernetes çš„åŒ…ç®¡ç†å·¥å…· # Helm is the best way to find, share, and use software built for Kubernetes.\nHelmæ˜¯ä¸ºKuberneteså¯»æ‰¾ï¼Œå…±äº«å’Œä½¿ç”¨è½¯ä»¶æ„å»ºçš„æœ€ä½³æ–¹å¼ã€‚\nç®€ä»‹ # Helmå¸®åŠ©ç®¡ç†Kubernetesåº”ç”¨ç¨‹åºï¼Œå³ä½¿æ˜¯é¢å¯¹å¤æ‚çš„K8så¼•ç”¨ï¼ŒHelm Chartsä¹Ÿå¯ä»¥è½»æ¾å®ç°å®šä¹‰ï¼Œå®‰è£…å’Œå‡çº§ã€‚\nHelmæ˜¯CNCFçš„æ¯•ä¸šé¡¹ç›®ï¼Œç”±Helmç¤¾åŒºç»´æŠ¤ã€‚\nChartsï¼š\nChartså¯ä»¥çœ‹ä½œæ˜¯Helmçš„ç¨‹åºåŒ…ï¼Œä¸€ä¸ªChartæ˜¯æè¿°Kubernetesèµ„æºé›†çš„æ–‡ä»¶é›†åˆã€‚\nRepositoryï¼š\nå­˜å‚¨å’Œå…±äº«Chartsï¼Œå¯ä»¥çœ‹ä½œæ˜¯Kubernetesç¨‹åºåŒ…çš„å­˜å‚¨ä¸­å¿ƒã€‚\nReleaseï¼š\nç”±ä¸€ä¸ªChartè¿è¡Œèµ·æ¥çš„å®ä¾‹ï¼Œè¿™å°†åœ¨kubernetesé›†ç¾¤ä¸­ç”Ÿæˆæˆ–æ›´æ–°ä¸€ç»„èµ„æºï¼Œå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªchartè¿è¡Œæˆå¤šä¸ªreleaseã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¿è¡Œå¤šä¸ªredisæœåŠ¡ï¼Œä½ å¯ä»¥é€šè¿‡å¤šæ¬¡å®‰è£…redisçš„chartå¾—åˆ°ã€‚\nçœ‹åˆ°ä»¥ä¸Šä¸‰ä¸ªæ¦‚å¿µï¼Œä½ å¯èƒ½ä¼šè§‰å¾—ä¼¼æ›¾ç›¸è¯†ï¼Œæ²¡é”™ï¼Œä¸dockerä¸‰ä¸ªæ¦‚å¿µâ€”â€”imageï¼Œregistryï¼Œcontainerå¦‚å‡ºä¸€è¾™ï¼Œä¹Ÿè®¸ç°åœ¨ä½ ä¼šåŠ æ·±ç‚¹ç†è§£äº†ã€‚\nå®‰è£… # å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨è„šæœ¬å®‰è£…\ncurl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 chmod 700 ./get-helm.sh ./get-helm.sh ä¹Ÿå¯ä»¥ä¸‹è½½æŒ‡å®šç‰ˆæœ¬æ‰‹åŠ¨å®‰è£…\nä¸‹è½½åœ°å€ï¼š https://github.com/helm/helm/releases\nwget https://get.helm.sh/helm-v3.5.2-linux-amd64.tar.gz tar -zxvf ./helm-v3.5.2-linux-amd64.tar.gz sudo mv linux-amd64/helm /usr/local/bin/helm ç¬¬ä¸€ä¸ªhelmå‘½ä»¤\nhelm help æ›´å¤šå®‰è£…æ–¹å¼å¯æŸ¥çœ‹ï¼š https://helm.sh/docs/intro/install/\nä½¿ç”¨ # åˆå§‹åŒ–Helm Chartä»“åº“ï¼š\né¦–å…ˆæ·»åŠ helmå®˜æ–¹çš„helm stable chartsä»“åº“\nhelm repo add stable https://charts.helm.sh/stable æŸ¥è¯¢chartsä»“åº“ï¼š\nä¾‹å¦‚ä½ æƒ³æŸ¥æ‰¾prometheusåº”ç”¨ä»“åº“ï¼Œæ‰“å¼€ https://artifacthub.io/ç«™ç‚¹ï¼Œåœ¨æŸ¥è¯¢è¾“å…¥æ¡†ä¸­è¾“å…¥prometheusä¹‹åï¼Œæœç´¢å¯ä»¥å¾—åˆ°å®˜æ–¹æˆ–æ°‘é—´çš„ä»“åº“ã€‚\nä¸€èˆ¬é€‰æ‹©å…·æœ‰å®˜æ–¹æ ‡å¿—çš„ä»“åº“ï¼Œè¿›å…¥è¯¥ä»“åº“çš„ä¸»é¡µï¼Œé‡Œé¢ä¼šæœ‰chartsçš„åŸºæœ¬ä¿¡æ¯ï¼Œä»¥åŠå®‰è£…å‘½ä»¤çš„å¸®åŠ©ã€‚\næ·»åŠ Prometheusçš„å®˜æ–¹Chartsä»“åº“\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts æ·»åŠ ä»“åº“åï¼Œå°±å¯ä»¥åœ¨å½“å‰å·²ç»æ·»åŠ çš„ä»“åº“ä¸­æœç´¢ä½ éœ€è¦çš„kubernetesåº”ç”¨äº†\n$ helm search repo prometheus NAME CHART VERSION APP VERSION DESCRIPTION prometheus-community/kube-prometheus-stack 13.5.0 0.45.0 kube-prometheus-stack collects Kubernetes manif... prometheus-community/prometheus 13.2.1 2.24.0 Prometheus is a monitoring system and time seri... prometheus-community/prometheus-adapter 2.11.1 v0.8.3 A Helm chart for k8s prometheus adapter ... åˆ›å»ºreleaseï¼š\nä½¿ç”¨ç‰¹å®šçš„chartå®‰è£…kubernetesåº”ç”¨\n$ helm install prometheus prometheus-community/prometheus NAME: prometheus LAST DEPLOYED: Sun Feb 7 02:04:59 2021 NAMESPACE: default STATUS: deployed REVISION: 1 ... æŸ¥çœ‹releaseï¼š\n$ helm ls NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION prometheus default 1 2021-02-07 02:04:59 deployed prometheus-13.2.1 2.24.0 $ helm status prometheus NAME: prometheus LAST DEPLOYED: Sun Feb 7 02:04:59 2021 NAMESPACE: default STATUS: deployed REVISION: 1 å¹¶ä¸”å¯ä»¥æŸ¥çœ‹K8sé›†ç¾¤æ˜¯å¦æ­£åœ¨åˆ›å»ºä½ éœ€è¦çš„åº”ç”¨\n$ kubectl get pod NAME READY STATUS RESTARTS AGE prometheus-alertmanager-5dbfffbbc4-jppgj 0/2 Pending 0 36s prometheus-kube-state-metrics-66c4db67ff-r65tg 0/1 ContainerCreating 0 36s prometheus-node-exporter-tvjnx 1/1 Running 0 36s prometheus-pushgateway-798b886754-x4fvq 0/1 ContainerCreating 0 36s prometheus-server-74656c5bbc-k4m6x 0/2 Pending 0 36s åˆ é™¤ releaseï¼š\nä»¥ä¸‹å‘½ä»¤ä¼šåˆ é™¤æ‰€æœ‰installåˆ›å»ºçš„æ‰€æœ‰Kubernetesèµ„æº\n$ helm uninstall prometheus release \u0026#34;prometheus\u0026#34; uninstalled å¦‚æœä½ æƒ³ä¿å­˜å®‰è£…çš„å†å²ä¿¡æ¯ï¼Œæ–¹ä¾¿ä»¥åæŸ¥çœ‹å‘å¸ƒå®¡è®¡æˆ–è€…å›æ»šå‘å¸ƒï¼Œå¯ä»¥ä½¿ç”¨--keep-historyå‘½ä»¤æ ‡è¯†ã€‚\n$ helm uninstall prometheus --keep-history release \u0026#34;prometheus\u0026#34; uninstalled # æ­¤æ—¶æŸ¥çœ‹å®‰è£…çŠ¶æ€å°†å˜æˆuninstalled $ helm ls NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION $ helm ls -a NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION prometheus default 1 2021-02-07 02:12:46 uninstalled prometheus-13.2.1 2.24.0 $ helm status prometheus NAME: prometheus LAST DEPLOYED: Sat Feb 6 02:49:41 2021 NAMESPACE: default STATUS: uninstalled REVISION: 1 ... å°†åˆ é™¤releaseé‡æ–°å®‰è£…/å›æ»šå›æ¥ï¼š\næ¯æ¬¡æˆåŠŸçš„installæˆ–upgrade releaseåï¼Œæˆ‘ä»¬éƒ½ä¼šå¾—åˆ°releaseçš„REVISIONï¼Œåœ¨å›æ»šreleaseæ—¶éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªç‰ˆæœ¬å·\n$ helm rollback prometheus 1 Rollback was a success! Happy Helming! å®šåˆ¶ # Chartsæ˜¯å…è®¸ç”¨æˆ·å®šåˆ¶çš„ï¼Œä¾‹å¦‚ä½ æƒ³ä¿®æ”¹åº”ç”¨ç«¯å£ï¼Œæˆ–è€…åº”ç”¨çš„å‰¯æœ¬æ•°é‡ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹chartsçš„èµ„æºæ–‡ä»¶ï¼Œç„¶åä¾æ®èµ„æºæ–‡ä»¶åˆ›å»ºreleaseã€‚\né¦–å…ˆï¼Œä¸‹è½½åº”ç”¨çš„chartsæ–‡ä»¶é›†åˆåˆ°æœ¬åœ°\n$ helm repo add bitnami https://charts.bitnami.com/bitnami \u0026#34;bitnami\u0026#34; has been added to your repositories $ mkdir nginx $ helm show values bitnami/nginx \u0026gt; ./nginx/values.yaml ä¿®æ”¹values.yamlæ–‡ä»¶ï¼Œå¦‚æœä½ å¯¹K8sèµ„æºçš„å®šä¹‰æœ‰æ‰€äº†è§£ï¼Œé‚£ä¹ˆä½ èƒ½è½»æ¾çš„ä¿®æ”¹è¯¥æ–‡ä»¶ã€‚\n$ vim ./nginx/values.yaml ... # ä¿®æ”¹nginx deploymentå‰¯æœ¬æ•°ä¸º2 replicaCount: 2 ... æ–‡ä»¶ä¿®æ”¹å®Œæˆåï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…\n$ helm install nginx -f ./nginx/values.yaml bitnami/nginx NAME: nginx LAST DEPLOYED: Sun Feb 7 02:59:48 2021 NAMESPACE: default STATUS: deployed REVISION: 1 ... ä»¥ä¸Šæ“ä½œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä»£æ›¿ï¼š\nhelm install nginx --set replicaCount=2 bitnami/nginx ä½¿ç”¨\u0026ndash;setè®¾ç½®é…ç½®è¯´æ˜ï¼š\nå¦‚æœåŒæ—¶æŒ‡å®šäº†values.yamlæ–‡ä»¶å’Œä½¿ç”¨\u0026ndash;setè®¾ç½®é…ç½®ï¼Œé‚£ä¹ˆ\u0026ndash;setè®¾ç½®çš„é…ç½®ä¼˜å…ˆçº§æ›´é«˜\nå¤šç»„é…ç½®ï¼š\u0026ndash;set a=1,b=2\nå±‚çº§ï¼š\u0026ndash;set user.name=jaychou\næ•°ç»„ï¼š\u0026ndash;set users={jay,jack,john} \u0026ndash;set users[0].name=jaychou\nç”±äºæ–‡ä»¶æ›´æ˜“ç®¡ç†å’Œè¿ç§»ï¼Œæ›´æ¨èä¿®æ”¹values.yamlçš„æ–¹å¼å®šåˆ¶Chartï¼š\næŸ¥çœ‹releaseçš„èµ„æºåˆ›å»ºæƒ…å†µ\n$ kubectl get pod NAME READY STATUS RESTARTS AGE nginx-78956d9896-5qvdl 1/1 Running 0 32s nginx-78956d9896-fhw5w 1/1 Running 0 32s ç¡®å®ï¼Œå¦‚æˆ‘ä»¬æ‰€æ„¿ï¼Œåˆ›å»ºäº†2ä¸ªå‰¯æœ¬å®ä¾‹ã€‚\næ›´æ–°Releaseï¼š\nå·²ç»å®‰è£…äº†çš„releaseï¼Œä¿®æ”¹å®šåˆ¶æ–‡ä»¶åå‡çº§å‘å¸ƒ\n$ helm upgrade nginx -f ./values.yaml bitnami/nginx Release \u0026#34;nginx\u0026#34; has been upgraded. Happy Helming! NAME: nginx LAST DEPLOYED: Sun Feb 7 03:05:26 2021 NAMESPACE: default STATUS: deployed REVISION: 2 TEST SUITE: None ... å¸¸ç”¨å‘½ä»¤ # å¸®åŠ©å‘½ä»¤\nhelm help helm get -h æ›´æ–°chartsä»“åº“\nhelm repo update æ›´å¤šhelm installçš„æ–¹å¼\nä»chartä»“åº“å®‰è£…ï¼Œæˆ‘ä»¬ä¸Šé¢ä½¿ç”¨çš„æ–¹å¼\næœ¬åœ°ç¼–å†™chartæ¨¡æ¿å’Œvalues.yamlç­‰æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…\nhelm install nginx /path/to/nginx-chart å¾—åˆ°chartå‹ç¼©æ–‡ä»¶ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…\nhelm install nginx nginx-chart.tgz chartå‹ç¼©æ–‡ä»¶çš„http urlï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…\nhelm install nginx https://xxx.com/charts/ngin-chart.tgz å¦‚æœä½ æœ‰å…´è¶£ï¼Œä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„chartsï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¼šåœ¨ç›®å½•ä¸‹ç”Ÿæˆchartsæ–‡ä»¶\n$ helm create my-nginx Creating my-nginx # å®šåˆ¶å $ helm package my-nginx Successfully packaged chart and saved it to: /path/to/my-nginx-0.1.0.tgz $ helm install my-nginx ./my-nginx-0.1.0.tgz NAME: nginx2 LAST DEPLOYED: Sun Feb 28 14:20:53 2021 NAMESPACE: default STATUS: deployed REVISION: 1 ... æ›´å¤šäº†è§£è¯·å‰å¾€ å®˜æ–¹æ–‡æ¡£\nÂ« Gateway API å®è·µ\nÂ» Kubernetes 0-1 å®ç°Podè‡ªåŠ¨æ‰©ç¼©HPA\n"},{"id":132,"href":"/kubernetes/hpa-usage/","title":"Hpa Usage","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 å®ç°Podè‡ªåŠ¨æ‰©ç¼©HPA\nKubernetes 0-1 å®ç°Podè‡ªåŠ¨æ‰©ç¼©HPA # https://blog.51cto.com/14143894/2458468?source=dra\nå‰è¨€ # åœ¨K8sé›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡éƒ¨ç½²Metrics Serveræ¥æŒç»­æ”¶é›†Podçš„èµ„æºåˆ©ç”¨æŒ‡æ ‡æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ”¶é›†åˆ°çš„æŒ‡æ ‡æ•°æ®æ¥è¯„ä¼°æ˜¯å¦éœ€è¦è°ƒæ•´Podçš„æ•°é‡ä»¥è´´åˆå®ƒçš„ä½¿ç”¨éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è§‚å¯Ÿåˆ°Podçš„CPUåˆ©ç”¨ç‡è¿‡é«˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‚å½“ä¸Šè°ƒDeploymentçš„Replicaså­—æ®µå€¼ï¼Œæ¥æ‰‹åŠ¨å®ç°Podçš„æ¨ªå‘æ‰©å®¹ã€‚\nMetrics Serverçš„æŒ‡æ ‡æ•°æ®å¯ä»¥é€šè¿‡DashboardæŸ¥çœ‹åˆ°ï¼› å®‰è£…Metrics Server # HPAä»‹ç» # HPAï¼ˆHorizontal Pod Autoscalerï¼ŒPodæ°´å¹³è‡ªåŠ¨æ‰©ç¼©ï¼‰ï¼Œæ ¹æ®Podçš„èµ„æºåˆ©ç”¨ç‡è‡ªåŠ¨è°ƒæ•´Podç®¡ç†å™¨ä¸­å‰¯æœ¬æ•°ï¼šPodèµ„æºåˆ©ç”¨ç‡ä½ï¼Œé™ä½Podå‰¯æœ¬æ•°ï¼Œé™ä½èµ„æºçš„ä½¿ç”¨ï¼ŒèŠ‚çº¦æˆæœ¬ï¼›Podèµ„æºåˆ©ç”¨ç‡é«˜ï¼Œå¢åŠ Podå‰¯æœ¬æ•°ï¼Œæé«˜åº”ç”¨çš„è´Ÿè½½èƒ½åŠ›ã€‚\nç¤ºä¾‹ # ä»¥éƒ¨ç½²redisä¸ºä¾‹ï¼Œç°ä½¿ç”¨redis\nÂ« Kubernetes 0-1 Helm Kubernetes çš„åŒ…ç®¡ç†å·¥å…·\nÂ» HTTP å®¢æˆ·ç«¯è°ƒç”¨ Kubernetes APIServer\n"},{"id":133,"href":"/kubernetes/http-call-k8s-apiserver/","title":"HTTP Call K8s Apiserver","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / HTTP å®¢æˆ·ç«¯è°ƒç”¨ Kubernetes APIServer\nHTTP å®¢æˆ·ç«¯è°ƒç”¨ Kubernetes APIServer # æœ¬ç¯‡ä»‹ç»å‡ ç§å¦‚ä½•é€šè¿‡ HTTP å®¢æˆ·ç«¯è°ƒç”¨ Kubernetes APIServer çš„å§¿åŠ¿ã€‚\nå¦‚ä½•è·å– Kubernetes api-server åœ°å€ # æŸ¥çœ‹ api-server çš„å‡ ç§æ–¹å¼ï¼š\n# 1. ç›´æ¥æŸ¥çœ‹ kubeconfig æ–‡ä»¶ $ cat ~/.kube/config apiVersion: v1 clusters: - cluster: server: https://192.168.58.2:8443 ... # 2. kubectl æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ $ kubectl cluster-info Kubernetes control plane is running at https://192.168.58.2:8443 ... # 3. kubectl æŸ¥çœ‹é›†ç¾¤é…ç½® $ kubectl config view clusters: - cluster: ... server: https://192.168.58.2:8443 ... é…ç½®ç¯å¢ƒå˜é‡\nKUBE_API=$(kubectl config view -o jsonpath=\u0026#39;{.clusters[0].cluster.server}\u0026#39;) echo $KUBE_API api-server å¦‚ä½•ç»™å®¢æˆ·ç«¯æˆæƒ # ä½¿ç”¨è¯ä¹¦æˆæƒ # ç›´æ¥è°ƒç”¨ï¼š\n$ curl $KUBE_API/version curl: (60) SSL certificate problem: unable to get local issuer certificate More details here: https://curl.haxx.se/docs/sslcerts.html curl failed to verify the legitimacy of the server and therefore could not establish a secure connection to it. To learn more about this situation and how to fix it, please visit the web page mentioned above. # å¿½ç•¥è¯ä¹¦éªŒè¯ $ curl $KUBE_API/version --insecure { \u0026#34;kind\u0026#34;: \u0026#34;Status\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;metadata\u0026#34;: { }, \u0026#34;status\u0026#34;: \u0026#34;Failure\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Unauthorized\u0026#34;, \u0026#34;reason\u0026#34;: \u0026#34;Unauthorized\u0026#34;, \u0026#34;code\u0026#34;: 401 } ç»“æœæ˜¯æˆ‘ä»¬æ— æ³•é¡ºåˆ©è°ƒç”¨æ¥å£ã€‚\nè·å–è¯ä¹¦ï¼š\n# æœåŠ¡ç«¯è¯ä¹¦ $ kubectl config view --raw \\ -o jsonpath=\u0026#39;{.clusters[0].cluster.certificate-authority-data}\u0026#39; \\ | base64 --decode \u0026gt; ./server-ca.crt # æœåŠ¡ç«¯è¯ä¹¦ $ kubectl config view --raw \\ -o jsonpath=\u0026#39;{.users[0].user.client-certificate-data}\u0026#39; \\ | base64 --decode \u0026gt; ./client-ca.crt # æœåŠ¡ç«¯è¯ä¹¦å¯†é’¥ $ kubectl config view --raw \\ -o jsonpath=\u0026#39;{.users[0].user.client-key-data}\u0026#39; \\ | base64 --decode \u0026gt; ./client-ca.key æˆ‘ä»¬è¿™æ¬¡å°è¯•ä½¿ç”¨è¯ä¹¦è°ƒç”¨ APIï¼š\n$ curl $KUBE_API/version --cacert ./server-ca.crt \\ --cert ./client-ca.crt \\ --key ./client-ca.key { \u0026#34;major\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;minor\u0026#34;: \u0026#34;22\u0026#34;, \u0026#34;gitVersion\u0026#34;: \u0026#34;v1.22.6+k3s1\u0026#34;, \u0026#34;gitCommit\u0026#34;: \u0026#34;3228d9cb9a4727d48f60de4f1ab472f7c50df904\u0026#34;, \u0026#34;gitTreeState\u0026#34;: \u0026#34;clean\u0026#34;, \u0026#34;buildDate\u0026#34;: \u0026#34;2022-01-25T01:27:44Z\u0026#34;, \u0026#34;goVersion\u0026#34;: \u0026#34;go1.16.10\u0026#34;, \u0026#34;compiler\u0026#34;: \u0026#34;gc\u0026#34;, \u0026#34;platform\u0026#34;: \u0026#34;linux/amd64\u0026#34; } æ­¤æ—¶ï¼Œå¯ä»¥æ­£å¸¸è°ƒç”¨ API äº†ï¼Œæˆ‘ä»¬ç»§ç»­è°ƒç”¨å…¶ä»–æ¥å£ï¼š\n$ curl $KUBE_API/apis/apps/v1/deployments --cacert ./server-ca.crt \\ --cert ./client-ca.crt \\ --key ./client-ca.key { \u0026#34;kind\u0026#34;: \u0026#34;DeploymentList\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;apps/v1\u0026#34;, \u0026#34;metadata\u0026#34;: { \u0026#34;resourceVersion\u0026#34;: \u0026#34;654514\u0026#34; }, \u0026#34;items\u0026#34;: [...] } ä¹Ÿ OK äº†ã€‚\nä½¿ç”¨ token æˆæƒ # token æŒ‡çš„æ˜¯ ServiceAccount çš„ Tokenï¼Œæ¯ä¸ªå‘½åç©ºé—´å†…éƒ½ä¼šå­˜åœ¨ä¸€ä¸ªé»˜è®¤çš„ saï¼šdefaultã€‚\næˆ‘ä»¬å°è¯•æ¥ç”Ÿæˆ sa tokenï¼Œæˆ‘ä»¬é¦–å…ˆç”Ÿæˆä¸€ä¸ª default å‘½åç©ºé—´ä¸‹ default sa çš„ tokenï¼š\n# è·å– sa é‡‡ç”¨çš„ secret $ kubectl get sa default -o jsonpath=\u0026#39;{.secrets[0].name}\u0026#39; # è·å– token DEFAULT_DEFAULT_TOKEN=$(kubectl get secrets \\ $(kubectl get sa default -o jsonpath=\u0026#39;{.secrets[0].name}\u0026#39;) \\ -o jsonpath=\u0026#39;{.data.token}\u0026#39; | base64 --decode) $ echo $DEFAULT_DEFAULT_TOKEN eyJhbGciOiJSUzI1NiIsImtpZCI6IjFJdzhRZlV3TkpRRm5aSzU4b2hWTWI3YmdPUTlyLTBWSU9OQmNlN3cwdGsifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRlZmF1bHQtdG9rZW4tcW50bGsiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVmYXVsdCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjE0OGJmM2U0LTkzY2EtNGJiMS04MDczLWMzZmIzM2NiYmJmNiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.ivtk9eRH-35wIaPk4CtPSBoBkuiMxQyta17qMxNjhgedyV5i1QGYty36k0ufbOpBMXr2DsdRy8yQTx2qnH-AcduyxaoCxX-SQ4yGUsKSHCTipktcWqFi-CFzNo6EMCZiX8zAmeXjYOMmF8kh2T6wkHmjERDYsqWPaftasTUrKEYpcawFCMnv0QTpDe-okr6vQx6t7pJ5fx_PCw-GEEZUKQZn1tHIStd77eZd546--rrS6nPczKc3GnVFsDTcPM5HI7T_hXnId1TEnOYM8H5ornJ6uDP2oN_niwV41qOXMM52Bep0cvnikG-kUklLpmZxkwAtQCHDDh36A5JX_oaK5w ğŸ’¡Â å¦‚æœä½ çš„ kubectl ç‰ˆæœ¬å¤§äº 1.24ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å– tokenï¼š\n$ DEFAULT_DEFAULT_TOKEN=$(kubectl create token default -n default) $ echo $DEFAULT_DEFAULT_TOKEN eyJhbGciOiJSUzI1NiIsImtpZCI6IjFJdzhRZlV3TkpRRm5aSzU4b2hWTWI3YmdPUTlyLTBWSU9OQmNlN3cwdGsifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiLCJrM3MiXSwiZXhwIjoxNjc2NDUwODg2LCJpYXQiOjE2NzY0NDcyODYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImRlZmF1bHQiLCJ1aWQiOiIxNDhiZjNlNC05M2NhLTRiYjEtODA3My1jM2ZiMzNjYmJiZjYifX0sIm5iZiI6MTY3NjQ0NzI4Niwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6ZGVmYXVsdCJ9.FC6SZ3fKhKML76AYnfaq4Y74mlRMBUxgfsEocrczzoN_NvDbqzZ_0sCAvA_ZdcVXv74hXTTeO1_DLoXZE_aLmGIxH1ImfbCDbxZH1xvNbE-7oozKmWBjYM7VRnNVvNC8EiRmcSEMttnQxgnBqUDZCyU8VA_pujld_RsB4SiD8tpXN5PaSaEx6vz6AWYWtW8wqwcAlIWTGk4hae090a0sLplyB4xx-7SiYjmkM9tVXFz5WWdUYSfyQeM-EfDpH4fNsvefWtW_KeJ5Wg28RuhiLbUv9_UV1RGt11Wh7lf0nNmxobqB8j-PEnphiECMKDv29x5KtQDU1wSgbSMI-_eTlQ ä½¿ç”¨ token è°ƒç”¨ APIï¼š\n$ curl $KUBE_API/apis/apps/v1/namespaces/default/deployments --cacert ./server-ca.crt \\ -H \u0026#34;Authorization: Bearer $DEFAULT_DEFAULT_TOKEN\u0026#34; { \u0026#34;kind\u0026#34;: \u0026#34;Status\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;metadata\u0026#34;: { } \u0026#34;status\u0026#34;: \u0026#34;Failure\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;deployments.apps is forbidden: User \\\u0026#34;system:serviceaccount:default:default\\\u0026#34; cannot list resource \\\u0026#34;deployments\\\u0026#34; in API group \\\u0026#34;apps\\\u0026#34; at the cluster scope\u0026#34;, \u0026#34;reason\u0026#34;: \u0026#34;Forbidden\u0026#34;, \u0026#34;details\u0026#34;: { \u0026#34;group\u0026#34;: \u0026#34;apps\u0026#34;, \u0026#34;kind\u0026#34;: \u0026#34;deployments\u0026#34; }, \u0026#34;code\u0026#34;: 403 } å¯ä»¥çœ‹åˆ°ç”¨æˆ· system:serviceaccount:default:default å¹¶æ²¡æœ‰æƒé™è·å–è‡ªèº«å‘½åç©ºé—´å†…çš„ Kubernetes å¯¹è±¡åˆ—è¡¨ã€‚\næ¥ä¸‹æ¥è®©æˆ‘ä»¬å°è¯•ç»™è¿™ä¸ª sa ç»‘å®šä¸€ä¸ª cluster-admin çš„ ClusterRoleï¼Œç„¶åæˆ‘ä»¬å†æ¬¡ç”Ÿæˆ tokenï¼Œå¹¶è°ƒç”¨æ¥å£ï¼š\n$ kubectl create clusterrolebinding default-sa-with-cluster-admin-role \\ --clusterrole cluster-admin --serviceaccount default:default $ DEFAULT_DEFAULT_TOKEN=$(kubectl create token default -n default) $ curl $KUBE_API/apis/apps/v1/namespaces/default/deployments --cacert ./server-ca.crt \\ -H \u0026#34;Authorization: Bearer $DEFAULT_DEFAULT_TOKEN\u0026#34; { \u0026#34;kind\u0026#34;: \u0026#34;DeploymentList\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;apps/v1\u0026#34;, \u0026#34;metadata\u0026#34;: { \u0026#34;resourceVersion\u0026#34;: \u0026#34;2824281\u0026#34; }, \u0026#34;items\u0026#34;: [] } è¿™å®Œç¾ç”Ÿæ•ˆï¼Œå› ä¸º defualt sa æœ‰äº†ä¸€ä¸ªè¶…çº§å¤§çš„ admin è§’è‰²ã€‚ï¼ˆå¦å¤–ï¼Œä½ å¯ä»¥å•ç‹¬åˆ›å»ºä¸€ä¸ªç‰¹å®šèµ„æºæƒé™çš„ roleï¼Œåœ¨ç»‘å®šåˆ°ä¸€ä¸ª saï¼Œæ¥æ»¡è¶³æœ€å°æƒé™åŸåˆ™ï¼‰\nåœ¨ Pod å†…è®¿é—® api-server # åœ¨ pod å†…éƒ¨ï¼Œé»˜è®¤ä¼šç”Ÿæˆ Kubernetes æœåŠ¡åœ°å€ç›¸å…³çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”ä¼šåœ¨ç‰¹æ®Šç›®å½•ä¸‹ä¿å­˜è¯ä¹¦ä»¥åŠ tokenï¼Œå½“ç„¶è¿™ä¸ªtoken æ˜¯æ ¹æ® pod æ‰€ä½¿ç”¨çš„ sa ç”Ÿæˆçš„ã€‚\nè¯ä¹¦æ–‡ä»¶åœ°å€ï¼š/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\ntoken æ–‡ä»¶åœ°å€ï¼š/var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n$ kubectl run -it --image curlimages/curl --restart=Never mypod -- sh $ env | grep KUBERNETES KUBERNETES_SERVICE_PORT=443 KUBERNETES_PORT=tcp://10.43.0.1:443 KUBERNETES_PORT_443_TCP_ADDR=10.43.0.1 KUBERNETES_PORT_443_TCP_PORT=443 KUBERNETES_PORT_443_TCP_PROTO=tcp KUBERNETES_SERVICE_PORT_HTTPS=443 KUBERNETES_PORT_443_TCP=tcp://10.43.0.1:443 KUBERNETES_SERVICE_HOST=10.43.0.1 $ TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token) $ curl https://${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT}/apis/apps/v1 \\ --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt \\ --header \u0026#34;Authorization: Bearer $TOKEN\u0026#34; ä½¿ç”¨ curl æ‰§è¡ŒåŸºæœ¬çš„ CRUD æ“ä½œ # åˆ›å»ºèµ„æºï¼š\n$ curl $KUBE_API/apis/apps/v1/namespaces/default/deployments \\ --cacert ./server-ca.crt \\ --cert ./client-ca.crt \\ --key ./client-ca.key \\ -X POST \\ -H \u0026#39;Content-Type: application/yaml\u0026#39; \\ -d \u0026#39;--- apiVersion: apps/v1 kind: Deployment metadata: name: sleep spec: replicas: 1 selector: matchLabels: app: sleep template: metadata: labels: app: sleep spec: containers: - name: sleep image: curlimages/curl command: [\u0026#34;/bin/sleep\u0026#34;, \u0026#34;365d\u0026#34;] \u0026#39; $ kubectl get deploy NAME READY UP-TO-DATE AVAILABLE AGE sleep 1/1 1 1 8s è·å–èµ„æºï¼š\n$ curl $KUBE_API/apis/apps/v1/namespaces/default/deployments \\ --cacert ./server-ca.crt \\ --cert ./client-ca.crt \\ --key ./client-ca.key # ç»™å®šç‰¹å®šçš„èµ„æºå $ curl $KUBE_API/apis/apps/v1/namespaces/default/deployments/sleep \\ --cacert ./server-ca.crt \\ --cert ./client-ca.crt \\ --key ./client-ca.key # watch $ curl $KUBE_API\u0026#39;/apis/apps/v1/namespaces/default/deployments?watch=true\u0026#39; \\ --cacert ./server-ca.crt \\ --cert ./client-ca.crt \\ --key ./client-ca.key æ›´æ–°èµ„æºï¼š\ncurl $KUBE_API/apis/apps/v1/namespaces/default/deployments/sleep \\ --cacert ./server-ca.crt \\ --cert ./client-ca.crt \\ --key ./client-ca.key \\ -X PUT \\ -H \u0026#39;Content-Type: application/yaml\u0026#39; \\ -d \u0026#39;--- apiVersion: apps/v1 kind: Deployment metadata: name: sleep spec: replicas: 1 selector: matchLabels: app: sleep template: metadata: labels: app: sleep spec: containers: - name: sleep image: curlimages/curl command: [\u0026#34;/bin/sleep\u0026#34;, \u0026#34;730d\u0026#34;] # \u0026lt;-- Making it sleep twice longer \u0026#39; # patch æ›´æ–° curl $KUBE_API/apis/apps/v1/namespaces/default/deployments/sleep \\ --cacert ./server-ca.crt \\ --cert ./client-ca.crt \\ --key ./client-ca.key \\ -X PATCH \\ -H \u0026#39;Content-Type: application/merge-patch+json\u0026#39; \\ -d \u0026#39;{ \u0026#34;spec\u0026#34;: { \u0026#34;template\u0026#34;: { \u0026#34;spec\u0026#34;: { \u0026#34;containers\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;sleep\u0026#34;, \u0026#34;image\u0026#34;: \u0026#34;curlimages/curl\u0026#34;, \u0026#34;command\u0026#34;: [\u0026#34;/bin/sleep\u0026#34;, \u0026#34;1d\u0026#34;] } ] } } } }\u0026#39; åˆ é™¤èµ„æºï¼š\n$ curl $KUBE_API/apis/apps/v1/namespaces/default/deployments \\ --cacert ./server-ca.crt \\ --cert ./client-ca.crt \\ --key ./client-ca.key \\ -X DELETE # åˆ é™¤å•ä¸ªèµ„æº $ curl $KUBE_API/apis/apps/v1/namespaces/default/deployments/sleep \\ --cacert ./server-ca.crt \\ --cert ./client-ca.crt \\ --key ./client-ca.key \\ -X DELETE å¦‚ä½•ä½¿ç”¨ kubectl è°ƒç”¨ API # ä½¿ç”¨ kubectl ä»£ç† Kubernetes api-server # $ kubectl proxy --port 8080 # å¯åŠ¨äº†ä»£ç†æœåŠ¡åï¼Œè°ƒç”¨ Kubernetes api-server å˜å¾—æ›´ç®€å• $ curl localhost:8080/apis/apps/v1/deployments { \u0026#34;kind\u0026#34;: \u0026#34;DeploymentList\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;apps/v1\u0026#34;, \u0026#34;metadata\u0026#34;: { \u0026#34;resourceVersion\u0026#34;: \u0026#34;660883\u0026#34; }, \u0026#34;items\u0026#34;: [...] } kubectl ä½¿ç”¨åŸå§‹æ¨¡å¼è°ƒç”¨ API # # è·å– $ kubectl get --raw /api/v1/namespaces/default/pods # åˆ›å»º $ kubectl create --raw /api/v1/namespaces/default/pods -f file.yaml # æ›´æ–° $ kubectl replace --raw /api/v1/namespaces/default/pods/mypod -f file.json # åˆ é™¤ $ kubectl delete --raw /api/v1/namespaces/default/pods å¦‚ä½•æŸ¥çœ‹ kubectl å‘½ä»¤ï¼ˆå¦‚ applyï¼‰å‘é€çš„ API è¯·æ±‚ # $ kubectl create deployment nginx --image nginx -v 6 I0215 17:07:35.188480 43870 loader.go:372] Config loaded from file: /Users/dp/.kube/config I0215 17:07:35.362580 43870 round_trippers.go:553] POST https://192.168.58.2:8443/apis/apps/v1/namespaces/default/deployments?fieldManager=kubectl-create\u0026amp;fieldValidation=Strict 201 Created in 167 milliseconds deployment.apps/nginx created å‚è€ƒ # How To Call Kubernetes API using Simple HTTP Client ä½¿ç”¨ Kubernetes API è®¿é—®é›†ç¾¤ | Kubernetes ä» Pod ä¸­è®¿é—® Kubernetes API | Kuberentes Â« Kubernetes 0-1 å®ç°Podè‡ªåŠ¨æ‰©ç¼©HPA\nÂ» Informer\n"},{"id":134,"href":"/kubernetes/informer/","title":"Informer","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Informer\nInformer # Informeræ˜¯client-goä¸­å®ç°çš„ä¸€ä¸ªå·¥å…·åŒ…ï¼Œç›®å‰å·²ç»è¢«kubernetesä¸­å„ä¸ªç»„ä»¶æ‰€ä½¿ç”¨ï¼Œä¾‹å¦‚controller-managerã€‚Informeræœ¬è´¨æ˜¯ä¸€ä¸ªapièµ„æºçš„ç¼“å­˜ã€‚\nä¸»è¦åŠŸèƒ½ï¼š\nå°†etcdæ•°æ®åŒæ­¥è‡³æœ¬åœ°ç¼“å­˜ï¼Œå®¢æˆ·ç«¯é€šè¿‡æœ¬åœ°ç¼“å­˜è¯»å–å’Œç›‘å¬èµ„æº\næ³¨å†Œèµ„æºAddï¼ŒUpdateï¼ŒDeleteçš„è§¦å‘äº‹ä»¶\nç›®çš„ï¼š\næœ¬åœ°ç¼“å­˜ï¼Œé¿å…ç»„ä»¶ç›´æ¥ä¸api-serveräº¤äº’ï¼Œå‡ç¼“å¯¹api-serveråŠetcdçš„è®¿é—®å‹åŠ›ã€‚\nç»„ä»¶ # Reflector\nDelta FIFO Queue\nIndexerï¼ˆlocal strorageï¼‰\nä¸‹é¢ç»“åˆæµç¨‹ç¤ºæ„å›¾ç®€å•ä»‹ç»è¿™äº›ç»„ä»¶çš„è§’è‰²ã€‚\næµç¨‹ç¤ºæ„å›¾ # è¿™å¼ ç¤ºæ„å›¾å±•ç¤ºäº†client-goç±»åº“ä¸­å„ä¸ªç»„ä»¶çš„å·¥ä½œæœºåˆ¶ï¼Œä»¥åŠå®ƒä»¬ä¸å’±ä»¬å°†è¦ç¼–å†™çš„è‡ªå®šä¹‰æ§åˆ¶å™¨çš„äº¤äº’ç‚¹ï¼ˆé»„é¢œè‰²æ ‡æ³¨çš„å—æ˜¯éœ€è¦è‡ªè¡Œå¼€å‘çš„éƒ¨åˆ†ï¼‰ã€‚\nReflectorï¼š\nè´Ÿè´£ç›‘å¬ï¼ˆWatchï¼‰ç‰¹å®šKubernetesèµ„æºå¯¹è±¡ï¼Œç›‘å¬çš„èµ„æºå¯¹è±¡å¯ä»¥æ˜¯å†…ç½®çš„èµ„æºä¾‹å¦‚Podï¼ŒIngressç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å®šåˆ¶çš„CRå¯¹è±¡ã€‚\nReflettorä¸ApiServerå»ºç«‹è¿æ¥ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨List\u0026amp;Watchæœºåˆ¶ä»ApiServerä¸­Listç‰¹å®šèµ„æºçš„æ‰€æœ‰å®ä¾‹ï¼Œè¿™äº›å®ä¾‹é™„å¸¦çš„ResourceVersionå­—æ®µå¯ä»¥ç”¨æ¥åŒºåˆ†å®ä¾‹æ˜¯å¦æ›´æ–°ã€‚åç»­åœ¨ä½¿ç”¨List\u0026amp;Watchæœºåˆ¶ä»ApiServerä¸­Watchç‰¹å®šèµ„æºçš„æ–°å¢ï¼Œæ›´æ–°ï¼Œåˆ é™¤ç­‰å˜åŒ–ï¼ˆå¢é‡Deltaï¼‰ã€‚\nå°†ç›‘å¬åˆ°çš„èµ„æºçš„æ–°å¢ï¼Œæ›´æ–°ï¼Œåˆ é™¤é¡ºåºå†™å…¥åˆ°DeltaFIFOé˜Ÿåˆ—ä¸­ã€‚\nDeltaFIFOï¼š\nä¸€ä¸ªå¢é‡çš„å…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œå­˜å‚¨ç›‘å¬åˆ°çš„èµ„æºï¼Œä»¥åŠèµ„æºäº‹ä»¶ç±»å‹ï¼Œä¾‹å¦‚Addedï¼ŒUpdatedï¼ŒDeletedï¼ŒReplacedï¼ŒSyncã€‚\nInformerï¼š\nIndexerï¼š\nä¸€ä¸ªè‡ªå¸¦ç´¢å¼•åŠŸèƒ½çš„æœ¬åœ°å­˜å‚¨ï¼Œç”¨äºå­˜å‚¨èµ„æºå¯¹è±¡ã€‚Informerä»DeltaFIFOä¸­Popå‡ºèµ„æºï¼Œå­˜å‚¨åˆ°Indexerã€‚Indexerä¸­èµ„æºä¸k8s etcdæ•°æ®ä¿æŒä¸€è‡´ã€‚æœ¬åœ°è¯»å–æ—¶ç›´æ¥æŸ¥è¯¢æœ¬åœ°å­˜å‚¨ï¼Œä»è€Œå‡å°‘k8s apiserverå’Œetcdçš„å‹åŠ›ã€‚\nä½¿ç”¨ç¤ºä¾‹ # è‡ªå®šä¹‰æ§åˆ¶å™¨\nclientset, err := kubernetes.NewForConfig(config) stopCh := make(chan struct{}) defer close(stopch) sharedInformers := informers.NewSharedInformerFactory(clientset, time.Minute) informer := sharedInformer.Core().V1().Pods().Informer() informer.AddEventHandler(cache.ResourceEventHandlerFuncs{ AddFunc: func(obj interface{} { // ... }, UpdateFunc: func(obj interface{} { // ... }, DeleteFunc : func(obj interface{} { // ... }) informer.Run(stopCh) }) Informer éœ€è¦é€šè¿‡ ClientSet ä¸ Kubernetes API Server äº¤äº’ï¼› åˆ›å»º stopCh æ˜¯ç”¨äºåœ¨ç¨‹åºè¿›ç¨‹é€€å‡ºå‰é€šçŸ¥ Informer æå‰é€€å‡ºï¼ŒInformer æ˜¯ä¸€ä¸ªæŒä¹…è¿è¡Œçš„ goroutineï¼› NewSharedInformerFactory å®ä¾‹åŒ–äº†ä¸€ä¸ª SharedInformer å¯¹è±¡ï¼Œç”¨äºè¿›è¡Œæœ¬åœ°èµ„æºå­˜å‚¨ï¼› sharedInformer.Core().V1().Pods().Informer() å¾—åˆ°äº†å…·ä½“ Pod èµ„æºçš„ informer å¯¹è±¡ï¼› AddEventHandler å³å›¾ä¸­çš„ç¬¬6æ­¥ï¼Œè¿™æ˜¯ä¸€ä¸ªèµ„æºäº‹ä»¶å›è°ƒæ–¹æ³•ï¼Œä¸Šä¾‹ä¸­å³ä¸ºå½“åˆ›å»º/æ›´æ–°/åˆ é™¤ Pod æ—¶è§¦å‘äº‹ä»¶å›è°ƒæ–¹æ³•ï¼› ä¸€èˆ¬è€Œè¨€ï¼Œå…¶ä»–ç»„ä»¶ä½¿ç”¨ Informer æœºåˆ¶è§¦å‘èµ„æºå›è°ƒæ–¹æ³•ä¼šå°†èµ„æºå¯¹è±¡æ¨é€åˆ° WorkQueue æˆ–å…¶ä»–é˜Ÿåˆ—ä¸­ï¼Œå…·ä½“æ¨é€çš„ä½ç½®è¦å»å›è°ƒæ–¹æ³•é‡Œè‡ªè¡Œå®ç°ã€‚ ä¸Šé¢è¿™ä¸ªç¤ºä¾‹ï¼Œå½“è§¦å‘äº† Addï¼ŒUpdate æˆ–è€… Delete äº‹ä»¶ï¼Œå°±é€šçŸ¥ Client-goï¼Œå‘ŠçŸ¥ Kubernetes èµ„æºäº‹ä»¶å‘ç”Ÿå˜æ›´å¹¶ä¸”éœ€è¦è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚\nInfromeræœºåˆ¶ # èµ„æºInformer # æ¯ä¸ªå†…ç½®çš„k8sèµ„æºå¯¹å®ç°äº†å¯¹åº”çš„Informeræœºåˆ¶ï¼Œå‡åŒ…å«Listerå’ŒInformeræ–¹æ³•ï¼Œä¾‹å¦‚ï¼š\ntype PodInformer interface { Lister() cache.SharedIndexInformer Informer() v1.PodLister } SharedInformerå…±äº«æœºåˆ¶ # æ¯å®ä¾‹åŒ–ä¸€ä¸ªInformerå¯¹è±¡ï¼Œéƒ½éœ€è¦ç»´æŠ¤ä¸€ä¸ªå¯¹åº”çš„Reflectorã€‚å½“åŒä¸€å¯¹è±¡Informerå®ä¾‹è¢«å®ä¾‹åŒ–å¤šæ¬¡æ—¶ï¼Œè¿è¡Œè¿‡å¤šçš„ListAndWatchï¼Œè¿™å…¶ä¸­åŒ…æ‹¬çš„\nÂ« HTTP å®¢æˆ·ç«¯è°ƒç”¨ Kubernetes APIServer\nÂ» é€šè¿‡ Ingress è¿›è¡Œç°åº¦å‘å¸ƒ\n"},{"id":135,"href":"/kubernetes/ingress-gray-deploy/","title":"Ingress Gray Deploy","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / é€šè¿‡ Ingress è¿›è¡Œç°åº¦å‘å¸ƒ\né€šè¿‡ Ingress è¿›è¡Œç°åº¦å‘å¸ƒ # https://start.aliyun.com/handson/Tn0HcdCZ/grap_publish_by_ingress\nStep 1 ï¼šå®éªŒä»‹ç» # æœ¬å®éªŒï¼Œä½ å°†è¿è¡Œè¿è¡Œä¸€ä¸ªç®€å•çš„åº”ç”¨ï¼Œéƒ¨ç½²ä¸€ä¸ªæ–°çš„åº”ç”¨ç”¨äºæ–°çš„å‘å¸ƒï¼Œå¹¶é€šè¿‡ Ingress èƒ½åŠ›å®ç°ç°åº¦å‘å¸ƒã€‚\nç°åº¦åŠè“ç»¿å‘å¸ƒæ˜¯ä¸ºæ–°ç‰ˆæœ¬åˆ›å»ºä¸€ä¸ªä¸è€ç‰ˆæœ¬å®Œå…¨ä¸€è‡´çš„ç”Ÿäº§ç¯å¢ƒï¼Œåœ¨ä¸å½±å“è€ç‰ˆæœ¬çš„å‰æä¸‹ï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™æŠŠéƒ¨åˆ†æµé‡åˆ‡æ¢åˆ°æ–°ç‰ˆæœ¬ï¼Œå½“æ–°ç‰ˆæœ¬è¯•è¿è¡Œä¸€æ®µæ—¶é—´æ²¡æœ‰é—®é¢˜åï¼Œå°†ç”¨æˆ·çš„å…¨é‡æµé‡ä»è€ç‰ˆæœ¬è¿ç§»è‡³æ–°ç‰ˆæœ¬ã€‚\né€šè¿‡æœ¬å®éªŒï¼Œä½ å°†å­¦ä¹ ï¼š\né€šè¿‡ Ingress æŒ‰æƒé‡è¿›è¡Œç°åº¦å‘å¸ƒ é€šè¿‡ Ingress æŒ‰ Header è¿›è¡Œç°åº¦å‘å¸ƒ å®¹å™¨æœåŠ¡ Kubernetes ç‰ˆï¼ˆç®€ç§° ACKï¼‰ æœ¬èŠ‚è¯¾ä½¿ç”¨çš„ Kubernetes(k8s) é›†ç¾¤å°±æ˜¯ç”± ACK æä¾›çš„ï¼Œæœ¬å®éªŒæ¶µç›–çš„éƒ½æ˜¯ä¸€äº›åŸºæœ¬æ“ä½œã€‚æ›´å¤šé«˜çº§ç”¨æ³•ï¼Œå¯ä»¥å» ACK çš„äº§å“é¡µé¢äº†è§£å“¦ã€‚\nStep 2 ï¼šéƒ¨ç½² Deployment V1 åº”ç”¨ # åˆ›å»ºå¦‚ä¸‹ YAML æ–‡ä»¶(app-v1.yaml)\napiVersion: v1 kind: Service metadata: name: my-app-v1 labels: app: my-app spec: ports: - name: http port: 80 targetPort: http selector: app: my-app version: v1.0.0 --- apiVersion: apps/v1 kind: Deployment metadata: name: my-app-v1 labels: app: my-app spec: replicas: 1 selector: matchLabels: app: my-app version: v1.0.0 template: metadata: labels: app: my-app version: v1.0.0 annotations: prometheus.io/scrape: \u0026#34;true\u0026#34; prometheus.io/port: \u0026#34;9101\u0026#34; spec: containers: - name: my-app image: registry.cn-hangzhou.aliyuncs.com/containerdemo/containersol-k8s-deployment-strategies ports: - name: http containerPort: 8080 - name: probe containerPort: 8086 env: - name: VERSION value: v1.0.0 livenessProbe: httpGet: path: /live port: probe initialDelaySeconds: 5 periodSeconds: 5 readinessProbe: httpGet: path: /ready port: probe periodSeconds: 5 æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤éƒ¨ç½² Deployement V1 åº”ç”¨ï¼š\nkubectl apply -f app-v1.yaml åˆ›å»ºå¦‚ä¸‹ Ingress YAMLæ–‡ä»¶(ingress-v1.yaml)\napiVersion: extensions/v1beta1 kind: Ingress metadata: name: my-app labels: app: my-app spec: rules: - host: my-app-898e6352eda2ac9c5cfc5d51c155455b.ca2ef983cc3a64042a32c1a423d32021e.cn-shanghai.alicontainer.com http: paths: - backend: serviceName: my-app-v1 servicePort: 80 path: / æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤éƒ¨ç½² Ingress èµ„æº\nkubectl apply -f ingress-v1.yaml éƒ¨ç½²å®Œæˆåé€šè¿‡ curl å‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼š\ncurl my-app-898e6352eda2ac9c5cfc5d51c155455b.ca2ef983cc3a64042a32c1a423d32021e.cn-shanghai.alicontainer.com ä¼šçœ‹åˆ°å¦‚ä¸‹è¿”å›ï¼š\nHost: my-app-v1-68bfcbb7cf-w4rpg, Version: v1.0.0 Step 3 ï¼šéƒ¨ç½² Deployment V2 åº”ç”¨ # åˆ›å»ºå¦‚ä¸‹ YAML æ–‡ä»¶(app-v2.yaml)\napiVersion: v1 kind: Service metadata: name: my-app-v2 labels: app: my-app spec: ports: - name: http port: 80 targetPort: http selector: app: my-app version: v2.0.0 --- apiVersion: apps/v1 kind: Deployment metadata: name: my-app-v2 labels: app: my-app spec: replicas: 1 selector: matchLabels: app: my-app version: v2.0.0 template: metadata: labels: app: my-app version: v2.0.0 annotations: prometheus.io/scrape: \u0026#34;true\u0026#34; prometheus.io/port: \u0026#34;9101\u0026#34; spec: containers: - name: my-app image: registry.cn-hangzhou.aliyuncs.com/containerdemo/containersol-k8s-deployment-strategies ports: - name: http containerPort: 8080 - name: probe containerPort: 8086 env: - name: VERSION value: v2.0.0 livenessProbe: httpGet: path: /live port: probe initialDelaySeconds: 5 periodSeconds: 5 readinessProbe: httpGet: path: /ready port: probe periodSeconds: 5 æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤éƒ¨ç½² Deployement V2 åº”ç”¨ï¼š\nkubectl apply -f app-v2.yaml Step 4 ï¼šæŒ‰ç…§æƒé‡ç­–ç•¥ç°åº¦åˆ° Deployment V2 åº”ç”¨ # åˆ›å»ºå¦‚ä¸‹ Ingress YAMLæ–‡ä»¶(ingress-v2-canary-weigth.yaml)\napiVersion: extensions/v1beta1 kind: Ingress metadata: name: my-app-canary labels: app: my-app annotations: # Enable canary and send 10% of traffic to version 2 nginx.ingress.kubernetes.io/canary: \u0026#34;true\u0026#34; nginx.ingress.kubernetes.io/canary-weight: \u0026#34;10\u0026#34; spec: rules: - host: my-app-898e6352eda2ac9c5cfc5d51c155455b.ca2ef983cc3a64042a32c1a423d32021e.cn-shanghai.alicontainer.com http: paths: - backend: serviceName: my-app-v2 servicePort: 80 path: / æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤éƒ¨ç½² Ingress èµ„æº\nkubectl apply -f ingress-v2-canary-weigth.yaml æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼š\nwhile sleep 0.1;do curl my-app-898e6352eda2ac9c5cfc5d51c155455b.ca2ef983cc3a64042a32c1a423d32021e.cn-shanghai.alicontainer.com; done æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š\nHost: my-app-v1-68bfcbb7cf-w4rpg, Version: v1.0.0 Host: my-app-v1-68bfcbb7cf-w4rpg, Version: v1.0.0 Host: my-app-v1-68bfcbb7cf-w4rpg, Version: v1.0.0 Host: my-app-v1-68bfcbb7cf-w4rpg, Version: v1.0.0 Host: my-app-v1-68bfcbb7cf-w4rpg, Version: v1.0.0 Host: my-app-v1-68bfcbb7cf-w4rpg, Version: v1.0.0 Host: my-app-v1-68bfcbb7cf-w4rpg, Version: v1.0.0 Host: my-app-v1-68bfcbb7cf-w4rpg, Version: v1.0.0 Host: my-app-v1-68bfcbb7cf-w4rpg, Version: v1.0.0 Host: my-app-v2-67c69b8857-g82gr, Version: v2.0.0 Host: my-app-v1-68bfcbb7cf-w4rpg, Version: v1.0.0 Step 5 ï¼šæŒ‰ç…§ Header ç­–ç•¥ç°åº¦åˆ° Deployment V2 åº”ç”¨ # åˆ›å»ºå¦‚ä¸‹ Ingress YAMLæ–‡ä»¶(ingress-v2-canary-header.yaml)\napiVersion: extensions/v1beta1 kind: Ingress metadata: name: my-app-canary labels: app: my-app annotations: # Enable canary and send traffic with headder x-app-canary to version 2 nginx.ingress.kubernetes.io/canary: \u0026#34;true\u0026#34; nginx.ingress.kubernetes.io/canary-by-header: \u0026#34;x-app-canary\u0026#34; nginx.ingress.kubernetes.io/canary-by-header-value: \u0026#34;true\u0026#34; spec: rules: - host: my-app-898e6352eda2ac9c5cfc5d51c155455b.ca2ef983cc3a64042a32c1a423d32021e.cn-shanghai.alicontainer.com http: paths: - backend: serviceName: my-app-v2 servicePort: 80 æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤éƒ¨ç½² Ingress èµ„æº\nkubectl apply -f ingress-v2-canary-header.yaml é€šè¿‡ curl å‘½ä»¤å¯¹åº”ç”¨è¿›è¡Œæµ‹è¯•ï¼š\ncurl my-app-898e6352eda2ac9c5cfc5d51c155455b.ca2ef983cc3a64042a32c1a423d32021e.cn-shanghai.alicontainer.com ç»“æœå¦‚ä¸‹ï¼š\nHost: my-app-v1-68bfcbb7cf-w4rpg, Version: v1.0.0 curl my-app-898e6352eda2ac9c5cfc5d51c155455b.ca2ef983cc3a64042a32c1a423d32021e.cn-shanghai.alicontainer.com -H \u0026#34;x-app-canary: true\u0026#34; ç»“æœå¦‚ä¸‹\nHost: my-app-v2-67c69b8857-g82gr, Version: v2.0.0 Â« Informer\nÂ» å®‰è£… Kubernetes\n"},{"id":136,"href":"/kubernetes/installation/","title":"Installation","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / å®‰è£… Kubernetes\nå®‰è£… Kubernetes # Â« é€šè¿‡ Ingress è¿›è¡Œç°åº¦å‘å¸ƒ\nÂ» K3s\n"},{"id":137,"href":"/kubernetes/k3s/","title":"K3s","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / K3s\nK3s # k3s æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ Kubernetes å‘è¡Œç‰ˆï¼Œä¸“ä¸ºç‰©è”ç½‘åŠè¾¹ç¼˜è®¡ç®—è®¾è®¡ã€‚\nè¦æ±‚ # K3s æœ‰æœ›åœ¨å¤§å¤šæ•°ç°ä»£ Linux ç³»ç»Ÿä¸Šè¿è¡Œã€‚\nè§„æ ¼è¦æ±‚ï¼š\nCPU: 1 æ ¸ Memoryï¼š512M ç«¯å£è¦æ±‚ï¼š\nK3s Server èŠ‚ç‚¹çš„å…¥ç«™è§„åˆ™å¦‚ä¸‹ï¼š\nåè®® ç«¯å£ æº æè¿° TCP 6443 K3s agent èŠ‚ç‚¹ Kubernetes API Server UDP 8472 K3s server å’Œ agent èŠ‚ç‚¹ ä»…å¯¹ Flannel VXLAN éœ€è¦ UDP 51820 K3s server å’Œ agent èŠ‚ç‚¹ åªæœ‰ Flannel Wireguard åç«¯éœ€è¦ UDP 51821 K3s server å’Œ agent èŠ‚ç‚¹ åªæœ‰ä½¿ç”¨ IPv6 çš„ Flannel Wireguard åç«¯æ‰éœ€è¦ TCP 10250 K3s server å’Œ agent èŠ‚ç‚¹ Kubelet metrics TCP 2379-2380 K3s server èŠ‚ç‚¹ åªæœ‰åµŒå…¥å¼ etcd é«˜å¯ç”¨æ‰éœ€è¦ å¯åŠ¨ # curl -sfL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh - # Check for Ready node, takes maybe 30 seconds k3s kubectl get node æ¢§æ¡ Region å®‰è£… k3s # å®‰è£…å‰æï¼š\ndocker\nhelm 3.0+\n80ï¼Œ443ï¼Œ6060ï¼Œ6443ï¼Œ7070ï¼Œ8443 ç«¯å£å¯è®¿é—®\nnfs sudo apt install nfs-common -y\ncurl -sfL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_VERSION=\u0026#34;v1.22.6+k3s1\u0026#34; INSTALL_K3S_MIRROR=cn sh -s - server --docker --disable traefik ä½¿ç”¨ \u0026ndash;docker å‚æ•°æŒ‡å®š docker ä½œä¸ºå®¹å™¨å¼•æ“ï¼šk3s é»˜è®¤ä½¿ç”¨ docker ä½œä¸ºå®¹å™¨å¼•æ“ï¼Œä½†æ˜¯ç›®å‰æ¢§æ¡ PaaS è¿˜ä¸æ”¯æŒï¼›\nä½¿ç”¨ \u0026ndash;disable traefik å…³é—­ k3s é»˜è®¤çš„ ingress controllerï¼Œæ¢§æ¡ PaaS é»˜è®¤ä½¿ç”¨ wt-gatewayï¼Œé¿å…ç«¯å£å†²çªã€‚\né»˜è®¤ç”Ÿæˆçš„k3s é…ç½®æ–‡ä»¶ä½ç½®ï¼š/etc/rancher/k3s/k3s.yamlï¼Œå¯ä»¥å°†å…¶æ‹·è´è‡³ ~/.kube/configï¼Œä»¥ä¾¿ helm ç­‰å·¥å…·å¯ä»¥é»˜è®¤è¿æ¥åˆ° k3sã€‚\nè‡ªåŠ¨éƒ¨ç½²æ¸…å•ï¼š/var/lib/rancher/k3s/server/manifests/\nå¸è½½ # /usr/local/bin/k3s-uninstall.sh æ±‡æ€» # k3s é»˜è®¤ä½¿ç”¨çš„ local-path å­˜å‚¨ä¸æ”¯æŒ RWX æ¨¡å¼ï¼Œæ‰€ä»¥è¿˜æ˜¯å¾—æ­å»ºå­˜å‚¨æœåŠ¡ nfs æˆ–è€… longhornï¼› Â« å®‰è£… Kubernetes\nÂ» Kubernetes 0-1 K8séƒ¨ç½²coredns\n"},{"id":138,"href":"/kubernetes/k8s-deploy-coredns/","title":"K8s Deploy Coredns","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 K8séƒ¨ç½²coredns\nKubernetes 0-1 K8séƒ¨ç½²coredns # åœ¨K8sé›†ç¾¤æœªéƒ¨ç½²DNSä¹‹å‰ï¼ŒK8sä¸­è¿è¡Œçš„Podæ˜¯æ— æ³•è®¿é—®å¤–éƒ¨ç½‘ç»œçš„ï¼Œå› ä¸ºæ— æ³•å®ŒæˆåŸŸåè§£æã€‚\næ¯”å¦‚æˆ‘ä»¬è¿è¡Œä¸€ä¸ªbusyboxçš„Podï¼Œç„¶ååœ¨Podé‡Œé¢æ˜¯æ— æ³•pingé€šå¤–éƒ¨ç½‘ç»œçš„ï¼š\n[root@k8s-master01 ~]# kubectl run -it --rm busybox --image=busybox sh If you don\u0026#39;t see a command prompt, try pressing enter. / # ping www.baidu.com ping: bad address \u0026#39;www.baidu.com\u0026#39; æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨K8sä¸­éƒ¨ç½²corednsè§£å†³è¿™ä¸€é—®é¢˜ã€‚\nå‡†å¤‡coredns.yamlæ–‡ä»¶ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹ï¼š\napiVersion: v1 kind: ServiceAccount metadata: name: coredns namespace: kube-system labels: kubernetes.io/cluster-service: \u0026#34;true\u0026#34; addonmanager.kubernetes.io/mode: Reconcile --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: labels: kubernetes.io/bootstrapping: rbac-defaults addonmanager.kubernetes.io/mode: Reconcile name: system:coredns rules: - apiGroups: - \u0026#34;\u0026#34; resources: - endpoints - services - pods - namespaces verbs: - list - watch - apiGroups: - \u0026#34;\u0026#34; resources: - nodes verbs: - get --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: annotations: rbac.authorization.kubernetes.io/autoupdate: \u0026#34;true\u0026#34; labels: kubernetes.io/bootstrapping: rbac-defaults addonmanager.kubernetes.io/mode: EnsureExists name: system:coredns roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: system:coredns subjects: - kind: ServiceAccount name: coredns namespace: kube-system --- apiVersion: v1 kind: ConfigMap metadata: name: coredns namespace: kube-system labels: addonmanager.kubernetes.io/mode: EnsureExists data: Corefile: | .:53 { errors health { lameduck 5s } ready kubernetes cluster.local in-addr.arpa ip6.arpa { pods insecure fallthrough in-addr.arpa ip6.arpa ttl 30 } prometheus :9153 forward . /etc/resolv.conf cache 30 loop reload loadbalance } --- apiVersion: apps/v1 kind: Deployment metadata: name: coredns namespace: kube-system labels: k8s-app: kube-dns kubernetes.io/cluster-service: \u0026#34;true\u0026#34; addonmanager.kubernetes.io/mode: Reconcile kubernetes.io/name: \u0026#34;CoreDNS\u0026#34; spec: # replicas: not specified here: # 1. In order to make Addon Manager do not reconcile this replicas parameter. # 2. Default is 1. # 3. Will be tuned in real time if DNS horizontal auto-scaling is turned on. strategy: type: RollingUpdate rollingUpdate: maxUnavailable: 1 selector: matchLabels: k8s-app: kube-dns template: metadata: labels: k8s-app: kube-dns annotations: seccomp.security.alpha.kubernetes.io/pod: \u0026#39;runtime/default\u0026#39; spec: priorityClassName: system-cluster-critical serviceAccountName: coredns tolerations: - key: \u0026#34;CriticalAddonsOnly\u0026#34; operator: \u0026#34;Exists\u0026#34; nodeSelector: kubernetes.io/os: linux containers: - name: coredns image: k8s.gcr.io/coredns:1.6.7 imagePullPolicy: IfNotPresent resources: limits: memory: 160Mi requests: cpu: 100m memory: 70Mi args: [ \u0026#34;-conf\u0026#34;, \u0026#34;/etc/coredns/Corefile\u0026#34; ] volumeMounts: - name: config-volume mountPath: /etc/coredns readOnly: true ports: - containerPort: 53 name: dns protocol: UDP - containerPort: 53 name: dns-tcp protocol: TCP - containerPort: 9153 name: metrics protocol: TCP livenessProbe: httpGet: path: /health port: 8080 scheme: HTTP initialDelaySeconds: 60 timeoutSeconds: 5 successThreshold: 1 failureThreshold: 5 readinessProbe: httpGet: path: /ready port: 8181 scheme: HTTP securityContext: allowPrivilegeEscalation: false capabilities: add: - NET_BIND_SERVICE drop: - all readOnlyRootFilesystem: true dnsPolicy: Default volumes: - name: config-volume configMap: name: coredns items: - key: Corefile path: Corefile --- apiVersion: v1 kind: Service metadata: name: kube-dns namespace: kube-system annotations: prometheus.io/port: \u0026#34;9153\u0026#34; prometheus.io/scrape: \u0026#34;true\u0026#34; labels: k8s-app: kube-dns kubernetes.io/cluster-service: \u0026#34;true\u0026#34; addonmanager.kubernetes.io/mode: Reconcile kubernetes.io/name: \u0026#34;CoreDNS\u0026#34; spec: selector: k8s-app: kube-dns clusterIP: 10.0.0.2 ports: - name: dns port: 53 protocol: UDP - name: dns-tcp port: 53 protocol: TCP - name: metrics port: 9153 protocol: TCP è¿è¡Œå‘½ä»¤ï¼š\nkubectl apply -f coredns.yaml æŸ¥çœ‹corednséƒ¨ç½²æƒ…å†µï¼š\n[root@k8s-master01 ~]# kubectl get pod -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-6879cc89dc-ngsld 1/1 Running 0 3m kube-system kube-flannel-ds-amd64-bgjt4 1/1 Running 1 6d14h kube-system kube-flannel-ds-amd64-dqlkc 1/1 Running 1 6d14h å¯ä»¥çœ‹åˆ°corednsçš„Podå·²ç»å¯åŠ¨ï¼Œè¿™æ˜¯æˆ‘ä»¬å†æ¬¡æµ‹è¯•Podå†…éƒ¨çš„ç½‘ç»œè®¿é—®æƒ…å†µï¼š\n[root@k8s-master01 ~]# kubectl run -it --rm busybox --image=busybox sh If you don\u0026#39;t see a command prompt, try pressing enter. / # ping www.baidu.com PING www.baidu.com (14.215.177.39): 56 data bytes 64 bytes from 14.215.177.39: seq=0 ttl=127 time=14.441 ms 64 bytes from 14.215.177.39: seq=1 ttl=127 time=26.355 ms ... å¯ä»¥æ­£å¸¸è§£æã€‚\nÂ« K3s\nÂ» Kubernetes 0-1 K8séƒ¨ç½²Dashboard\n"},{"id":139,"href":"/kubernetes/k8s-deploy-dashboard/","title":"K8s Deploy Dashboard","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 K8séƒ¨ç½²Dashboard\nKubernetes 0-1 K8séƒ¨ç½²Dashboard # é¦–å…ˆä¸‹è½½éƒ¨ç½²çš„å¿…è¦æ–‡ä»¶ï¼š\nwget https://raw.githubusercontent.com/kubernetes/dashboard/master/aio/deploy/recommended.yaml -O kube-dash.yaml --no-check-certificate é»˜è®¤Dashboardçš„Serviceç±»å‹æ˜¯ClusterIPï¼Œæˆ‘ä»¬é›†ç¾¤å¤–é¢ä¸æ–¹ä¾¿è®¿é—®ï¼Œæˆ‘ä»¬æœ€å¥½æ˜¯å°†Serviceç±»å‹ä¿®æ”¹ä¸ºNodePoartæˆ–LoadBalancerï¼ˆå‰ææ˜¯ä½ çš„é›†ç¾¤æ”¯æŒLoadBalancerï¼‰ï¼Œä»¥LoadBalancerä¸ºä¾‹ã€‚\nä¿®æ”¹æ–‡ä»¶kube-dash.yamlæ–‡ä»¶ï¼Œå°†kubernetes-dashboard Serviceéƒ¨åˆ†ä¿®æ”¹æˆå¦‚ä¸‹ï¼š\nkind: Service apiVersion: v1 metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard namespace: kubernetes-dashboard spec: type: LoadBalancer ports: - port: 443 targetPort: 8443 selector: k8s-app: kubernetes-dashboard åˆ›å»ºkube-dash-admin-user.yamlæ–‡ä»¶:\nvim kube-dash-admin-user.yaml å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š\napiVersion: v1 kind: ServiceAccount metadata: name: admin-user namespace: kubernetes-dashboard --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: admin-user roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - kind: ServiceAccount name: admin-user namespace: kubernetes-dashboard æ‰§è¡Œå‘½ä»¤ï¼š\nkubectl apply -f kube-dash.yaml # åˆ›å»ºdashboardæœåŠ¡ kubectl apply -f kube-dash-admin-user.yaml # åˆ›å»ºkubernetesé›†ç¾¤çš„ç®¡ç†å‘˜è§’è‰²å’Œè´¦å· æ‰§è¡Œå®Œä¹‹åï¼Œæˆ‘ä»¬æŸ¥çœ‹Dashboardçš„Serviceï¼š\nkubectl get svc -n kubernetes-dashboard è¾“å‡ºä»¥ä¸‹å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œkubernetes-dashboardçš„svcçš„EXTERNAL-IPä¸º192.168.115.141ï¼Œè¿™å°±æ˜¯LoadBalancerä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ†é…çš„ä¸€ä¸ªIPã€‚\nNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE dashboard-metrics-scraper ClusterIP 10.0.0.210 \u0026lt;none\u0026gt; 8000/TCP 52s kubernetes-dashboard LoadBalancer 10.0.0.51 192.168.115.141 443:31385/TCP 52s è¿™æ—¶æˆ‘ä»¬ä»¥https://192.168.115.141è®¿é—®éƒ¨ç½²çš„dashboardï¼Œç¬¬ä¸€æ¬¡è®¿é—®å¯èƒ½éœ€è¦ç‚¹å‡» Advanced =\u0026gt; **Proceed to 192.168.115.141 (unsafe)**è¿›å…¥ã€‚\næ³¨æ„ï¼šå¿…é¡»ä»¥httpsæ–¹å¼è®¿é—®ï¼Œå› ä¸ºdashboardæ˜¯é»˜è®¤å¼€å¯æ›´ä¸ºå®‰å…¨çš„httpsé€šä¿¡ã€‚\néœ€è¦ä½¿ç”¨Tokenç™»å½•ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–tokenï¼š\nkubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk \u0026#39;{print $1}\u0026#39;) è¾“å‡ºå†…å®¹ï¼Œè·å–åˆ°tokenã€‚\nName: admin-user-token-l56hp Namespace: kubernetes-dashboard Labels: \u0026lt;none\u0026gt; Annotations: kubernetes.io/service-account.name: admin-user kubernetes.io/service-account.uid: 95db28c5-4951-4aae-bf59-b0c26c8b35c7 Type: kubernetes.io/service-account-token Data ==== ca.crt: 1375 bytes namespace: 20 bytes token: eyJhbGciOiJSUzI1NiIsImtpZCI6IjYtQW51Z2xPMi1WTmpEZEtIX3BBYXd1YWpGLVU2Y0J0S1dmZE9lR3hoYU0ifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLWw1NmhwIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI5NWRiMjhjNS00OTUxLTRhYWUtYmY1OS1iMGMyNmM4YjM1YzciLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.Dqnk21CcBWU7SHgKRUu8uebL1djF1BJChNT5qTvk1uGLTF3AN9RMmacXlzO2xC5fP3zasmBFjcmS_JY76k7CS6DHdHKgxgB8vlEfIbh-i4YTA7cKK3_Ko5hAy7e6GhoPsfcYnV5QVec2mlvfMoozJT62UT62YkNrfUZXwFz02V4EfNgCgWVPKgiKzciMVOMNJ6-FKiiXyfhl4zprb8hSPzpc0F2Jd62Ykoltuir74UoByOazAnr7bA9ZTXSf1k8fjUaOUsBh37ap_eHg3Yh2gIcYMBxsp1tV0VVNKJDnVCN-lRBhfUciK93kvxU3I8xjWRv6JUHifCvHUiiWXjGZ8A æ³¨æ„ï¼šé»˜è®¤tokençš„è¿‡æœŸæ—¶é—´ä¸º900ç§’(15åˆ†é’Ÿ)ï¼Œä¸ºäº†é¿å…é¢‘ç¹çš„å› ä¸ºtokenè¿‡æœŸç™»å½•é—®é¢˜ï¼Œå¯ä»¥ä¿®æ”¹kubernetes-dashboardçš„Deploymentçš„é…ç½®ï¼Œæ·»åŠ token-ttlå‚æ•°ï¼š\n... args: - --auto-generate-certificates - --token-ttl=43200 ... æ‹¿åˆ°tokenï¼Œæ‹·è´åˆ°dashboardè¿›è¡Œç™»å½•ã€‚ç™»å…¥åï¼Œå¯ä»¥çœ‹åˆ°K8sçš„èµ„æºä¿¡æ¯ã€‚\nKubernetes-Dashboardéƒ¨ç½²å®Œæˆã€‚\nÂ« Kubernetes 0-1 K8séƒ¨ç½²coredns\nÂ» Kubernetes 0-1 K8séƒ¨ç½²EFK\n"},{"id":140,"href":"/kubernetes/k8s-deploy-efk/","title":"K8s Deploy Efk","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 K8séƒ¨ç½²EFK\nKubernetes 0-1 K8séƒ¨ç½²EFK # å†™åœ¨å‰é¢ # æœ¬ç¯‡ç›®æ ‡æ˜¯åœ¨K8sé›†ç¾¤ä¸­æ­å»ºEFKã€‚\nEFKæ˜¯ç”±ElasticSearchï¼ŒFluentdï¼ŒKibaneç»„æˆçš„ä¸€å¥—ç›®å‰æ¯”è¾ƒä¸»æµçš„æ—¥å¿—ç›‘æ§ç³»ç»Ÿï¼Œä½¿ç”¨EFKç›‘æ§åº”ç”¨æ—¥å¿—ï¼Œå¯ä»¥è®©å¼€å‘äººå‘˜åœ¨ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£æŸ¥çœ‹æ—¥å¿—ç„¶ååˆ†æåº”ç”¨è¿è¡Œæƒ…å†µã€‚\nEFKç®€å•çš„å·¥ä½œåŸç†å¯ä»¥å‚è€ƒä¸‹å›¾ã€‚é€šè¿‡fluentdçš„agentæ”¶é›†æ—¥å¿—æ•°æ®ï¼Œå†™å…¥esï¼Œkibanaä»esä¸­è¯»å–æ—¥å¿—æ•°æ®å±•ç¤ºåˆ°uiã€‚\néƒ¨ç½²ElasticSearch # æœ€å¥½é€‰æ‹©éƒ¨ç½²ä¸€ä¸ªESé›†ç¾¤ï¼Œè¿™æ ·ä½ çš„ESå¯ç”¨æ€§æ›´é«˜ä¸€ç‚¹ã€‚\né‡‡ç”¨StatefulSetéƒ¨ç½²ESã€‚\nç¼–å†™es-statefulSet.yamlæ–‡ä»¶å¦‚ä¸‹ï¼š\napiVersion: apps/v1 kind: StatefulSet metadata: name: es-cluster namespace: dev spec: serviceName: elasticsearch replicas: 3 selector: matchLabels: app: elasticsearch template: metadata: labels: app: elasticsearch spec: containers: - name: elasticsearch image: docker.elastic.co/elasticsearch/elasticsearch:7.7.0 resources: limits: cpu: 1000m requests: cpu: 100m ports: - containerPort: 9200 name: rest protocol: TCP - containerPort: 9300 name: inter-node protocol: TCP volumeMounts: - name: data mountPath: /usr/share/elasticsearch/data env: - name: cluster.name value: k8s-logs - name: node.name valueFrom: fieldRef: fieldPath: metadata.name - name: discovery.seed_hosts value: \u0026#34;es-cluster-0.elasticsearch,es-cluster-1.elasticsearch,es-cluster-2.elasticsearch\u0026#34; - name: cluster.initial_master_nodes value: \u0026#34;es-cluster-0,es-cluster-1,es-cluster-2\u0026#34; - name: ES_JAVA_OPTS value: \u0026#34;-Xms512m -Xmx512m\u0026#34; initContainers: - name: fix-permissions image: busybox command: [\u0026#34;sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;chown -R 1000:1000 /usr/share/elasticsearch/data\u0026#34;] securityContext: privileged: true volumeMounts: - name: data mountPath: /usr/share/elasticsearch/data - name: increase-vm-max-map image: busybox command: [\u0026#34;sysctl\u0026#34;, \u0026#34;-w\u0026#34;, \u0026#34;vm.max_map_count=262144\u0026#34;] securityContext: privileged: true - name: increase-fd-ulimit image: busybox command: [\u0026#34;sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;ulimit -n 65536\u0026#34;] securityContext: privileged: true volumeClaimTemplates: - metadata: name: data labels: app: elasticsearch spec: accessModes: [\u0026#34;ReadWriteOnce\u0026#34;] storageClassName: gp2 resources: requests: storage: 40Gi ç¼–å†™es.service.yamlæ–‡ä»¶å¦‚ä¸‹ï¼š\nkind: Service apiVersion: v1 metadata: name: elasticsearch namespace: dev spec: selector: app: elasticsearch type: NodePort ports: - name: elasticsearch-http port: 9200 targetPort: 9200 éƒ¨ç½²Kibana # ç¼–å†™kibana-deployment.yamlæ–‡ä»¶å¦‚ä¸‹ï¼š\napiVersion: extensions/v1beta1 kind: Deployment metadata: name: kibana namespace: dev labels: name: kibana spec: strategy: rollingUpdate: maxSurge: 1 maxUnavailable: 1 type: RollingUpdate template: metadata: labels: name: kibana spec: containers: - image: docker.elastic.co/kibana/kibana:7.7.0 imagePullPolicy: Always name: kibana resources: requests: cpu: \u0026#34;1000m\u0026#34; memory: \u0026#34;256M\u0026#34; limits: cpu: \u0026#34;1000m\u0026#34; memory: \u0026#34;1024M\u0026#34; # livenessProbe: # httpGet: # path: /_status/healthz # port: 5000 # initialDelaySeconds: 90 # timeoutSeconds: 10 # readinessProbe: # httpGet: # path: /_status/healthz # port: 5000 # initialDelaySeconds: 30 # timeoutSeconds: 10 env: - name: ELASTICSEARCH_URL value: http://elasticsearch:9200 - name: SERVER_BASEPATH value: /kibana - name: SERVER_REWRITEBASEPATH value: \u0026#34;true\u0026#34; # args: # - server.rewriteBasePath=true # - server.basePath=/kibana ports: - containerPort: 5601 name: kibana-port # volumeMounts: # - mountPath: /etc/kibana/config # name: grafana-data # volumes: # - name: grafana-data # configMap: # name: grafana-config restartPolicy: Always ç¼–å†™kibana-service.yamlæ–‡ä»¶å¦‚ä¸‹ï¼š\nkind: Service apiVersion: v1 metadata: name: kibana namespace: dev spec: selector: name: kibana type: NodePort ports: - name: kibana-http port: 5601 targetPort: 5601 éƒ¨ç½²Fluentd # Fluentdæ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®æ”¶é›†å™¨ï¼Œå¯ä»¥åšæ•°æ®çš„é›†ä¸­æ”¶é›†ï¼Œä¾¿äºåšæ•°æ®ä½¿ç”¨å’Œåˆ†æï¼Œå¸¸ç”¨äºæ—¥å¿—æ”¶é›†ã€‚\næˆ‘ä»¬éƒ¨ç½²Fluentdæ¥æ”¶é›†éƒ¨ç½²åœ¨k8s Podä¸­çš„ç¨‹åºçš„è¯ï¼Œé¦–å…ˆéœ€è¦é›†ç¾¤èµ‹äºˆå®ƒè®¿é—®Podçš„æƒé™ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä¸ºfluentdåˆ†é…ä¸€ä¸ªå¸¦æœ‰Podç›¸å…³æƒé™çš„serviceAccountã€‚\nç¼–å†™fluentd-serviceAccount.yamlæ–‡ä»¶å¦‚ä¸‹ï¼š\napiVersion: v1 kind: ServiceAccount metadata: name: fluentd namespace: dev labels: app: fluentd --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: fluentd namespace: dev labels: app: fluentd rules: - apiGroups: - \u0026#34;\u0026#34; resources: - pods - namespaces verbs: - get - list - watch --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: fluentd namespace: dev roleRef: kind: ClusterRole name: fluentd apiGroup: rbac.authorization.k8s.io subjects: - kind: ServiceAccount name: fluentd namespace: dev æˆ‘ä»¬éœ€è¦åœ¨æ¯å°èŠ‚ç‚¹ä¸Šéƒ½éƒ¨ç½²Fluentï¼Œè¿™ç›¸å½“äºæ˜¯ä¸€ä¸ªæ—¥å¿—æ”¶é›†çš„Agentï¼Œå› æ­¤æˆ‘ä»¬é‡‡ç”¨DaemonSetçš„æ–¹å¼éƒ¨ç½²Fluentdã€‚\nç¼–å†™fluentd-daemonSet.yamlæ–‡ä»¶å¦‚ä¸‹ï¼š\napiVersion: apps/v1 kind: DaemonSet metadata: name: fluentd namespace: dev labels: app: fluentd spec: selector: matchLabels: app: fluentd template: metadata: labels: app: fluentd spec: serviceAccount: fluentd serviceAccountName: fluentd tolerations: - key: node-role.kubernetes.io/master effect: NoSchedule containers: - name: fluentd image: fluent/fluentd-kubernetes-daemonset:v1.10.4-debian-elasticsearch7-1.0 env: - name: FLUENT_ELASTICSEARCH_HOST value: \u0026#34;elasticsearch.dev.svc.cluster.local\u0026#34; - name: FLUENT_ELASTICSEARCH_PORT value: \u0026#34;9200\u0026#34; - name: FLUENT_ELASTICSEARCH_SCHEME value: \u0026#34;http\u0026#34; - name: FLUENTD_SYSTEMD_CONF value: disable resources: limits: memory: 512Mi requests: cpu: 100m memory: 256Mi volumeMounts: - name: varlog mountPath: /var/log - name: varlibdockercontainers mountPath: /var/lib/docker/containers readOnly: true terminationGracePeriodSeconds: 30 volumes: - name: varlog hostPath: path: /var/log - name: varlibdockercontainers hostPath: path: /var/lib/docker/containers æ–‡ä»¶å‡†å¤‡å¥½ä¹‹åï¼Œæ‰§è¡Œ\nkubectl apply -f ./fluentd-serviceAccount.yaml kubectl apply -f ./fluentd-daemonSet.yaml éƒ¨ç½²ä¹‹åï¼ŒæŸ¥çœ‹fluentd daemonsetçš„éƒ¨ç½²æƒ…å†µ\nkubectl get ds -n kube-system è¾“å‡ºä¿¡æ¯å¤§è‡´å¦‚ä¸‹ï¼š\nNAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE fluentd 3 3 3 3 3 \u0026lt;none\u0026gt; 33s å¦‚æœDESIREDå’ŒREADYåˆ—å€¼ä¸ä¸€è‡´çš„è¯ï¼Œè¯´æ˜æ˜¯æŸä¸ªNodeä¸Šçš„Podå¯ç”¨å¤±è´¥äº†ã€‚é‚£ä¹ˆå¯ä»¥æŸ¥çœ‹Podçš„å¯ç”¨æƒ…å†µï¼š\nkubectl get pod -n kube-system # å‡è®¾Pod fluentd-8hmbdä¸€ç›´æœªæˆåŠŸå¯ç”¨ï¼Œä½¿ç”¨kubectl describe æˆ–kubectl logså‘½ä»¤æ£€æŸ¥ kubectl describe pod fluentd-8hmbd -n kube-system kubectl logs fluentd-8hmbd -n kube-system å‚è€ƒèµ„æ–™ # https://www.digitalocean.com/community/tutorials/how-to-set-up-an-elasticsearch-fluentd-and-kibana-efk-logging-stack-on-kubernetes Â« Kubernetes 0-1 K8séƒ¨ç½²Dashboard\nÂ» å¯èƒ½éœ€è¦è¿è¡Œå¤šæ¬¡ä»¥ä¸‹å‘½ä»¤ï¼Œç¡®ä¿k8sèµ„æºéƒ½åˆ›å»º\n"},{"id":141,"href":"/kubernetes/k8s-deploy-prometheus-grafana/","title":"K8s Deploy Prometheus Grafana","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / å¯èƒ½éœ€è¦è¿è¡Œå¤šæ¬¡ä»¥ä¸‹å‘½ä»¤ï¼Œç¡®ä¿k8sèµ„æºéƒ½åˆ›å»º\nStep # ä¸‹è½½ç›¸å…³k8sèµ„æºæ–‡ä»¶ git clone https://github.com/coreos/kube-prometheus.git ä¿®æ”¹æ–‡ä»¶kube-prometheus/manifests/prometheus-prometheus.yamlï¼Œåšè¿™ä¸€æ­¥çš„ç›®çš„æ˜¯ä¸ºprometheusçš„è®¿é—®åˆ†é…å­è·¯å¾„ï¼Œè®¿é—®æ–¹å¼ä¸ºhttp(s)://xxx/prometheus\nåœ¨prometheus.specä¸‹æ·»åŠ \nexternalUrl: prometheus routePrefix: prometheus ä¿®æ”¹æ–‡ä»¶kube-prometheus/manifests/grafana-deployment.yamlï¼Œåšè¿™ä¸€æ­¥çš„ç›®çš„æ˜¯ä¸ºgrafanaçš„è®¿é—®åˆ†é…å­è·¯å¾„ï¼Œè®¿é—®æ–¹å¼ä¸ºï¼šhttp(s)://xxx/grafana\nåœ¨deployment.spec.template.spec.container[0]ä¸‹æ·»åŠ \nenv: - name: GF_SERVER_ROOT_URL value: \u0026#34;http://localhost:3000/grafana\u0026#34; - name: GF_SERVER_SERVE_FROM_SUB_PATH value: \u0026#34;true\u0026#34; Apply k8sèµ„æº # å¯èƒ½éœ€è¦è¿è¡Œå¤šæ¬¡ä»¥ä¸‹å‘½ä»¤ï¼Œç¡®ä¿k8sèµ„æºéƒ½åˆ›å»º kubectl create -f manifests/setup -f manifests # !å¦‚æœè¦åˆ é™¤ä»¥ä¸Šåˆ›å»ºçš„k8sèµ„æºï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ kubectl delete --ignore-not-found=true -f manifests/ -f manifests/setup Ingressè½¬å‘ apiVersion: extensions/v1beta1 kind: Ingress metadata: name: prometheus namespace: monitoring spec: rules: - host: dp.example.tech http: paths: - path: /prometheus backend: serviceName: prometheus-k8s servicePort: 9090 - path: /grafana backend: serviceName: grafana servicePort: 3000 - path: /alertmanager backend: serviceName: alertmanager-main servicePort: 9093 Â« Kubernetes 0-1 K8séƒ¨ç½²EFK\nÂ» Kubernetes 0-1 K8séƒ¨ç½²Zookeeperå’ŒKafka\n"},{"id":142,"href":"/kubernetes/k8s-deploy-zookeeper-kafka/","title":"K8s Deploy Zookeeper Kafka","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 K8séƒ¨ç½²Zookeeperå’ŒKafka\nKubernetes 0-1 K8séƒ¨ç½²Zookeeperå’ŒKafka # æŒ‰ç…§å®˜æ–¹å®šä¹‰ï¼ŒKafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¤„ç†å¹³å°ã€‚æ›´å¤šäº†è§£å®˜æ–¹æ–‡æ¡£ï¼š http://kafka.apachecn.org/intro.html\né‚£ä¹ˆç›´æ¥å¼€å§‹åœ¨K8sä¸­éƒ¨ç½²kafkaå§ã€‚\néƒ¨ç½²kafkaï¼Œé¦–å…ˆè¦æœ‰ä¸€ä¸ªå¯ç”¨çš„Zookeeperé›†ç¾¤ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å…ˆéƒ¨ç½²ä¸€ä¸ªZookeeperé›†ç¾¤ã€‚\né¦–å…ˆè¯´æ˜ï¼Œæˆ‘çš„K8sé›†ç¾¤æ˜¯ä½¿ç”¨çš„AWSçš„EKSæœåŠ¡ï¼Œä¸è‡ªå»ºçš„K8sé›†ç¾¤çš„é…ç½®æ–¹é¢å¯èƒ½ä¼šæœ‰æ‰€å·®åˆ«ã€‚\néƒ¨ç½²Zookeeper # ç¼–å†™zookeeper-statefulSet.yamlæ–‡ä»¶ï¼š\nvim zookeeper-statefulSet.yaml å†™å…¥å†…å®¹:\nkind: StatefulSet apiVersion: apps/v1beta1 metadata: name: zookeeper-1 namespace: dev spec: serviceName: zookeeper-1 replicas: 1 selector: matchLabels: app: zookeeper-1 template: metadata: labels: app: zookeeper-1 spec: containers: - name: zookeeper image: digitalwonderland/zookeeper ports: - containerPort: 2181 env: - name: ZOOKEEPER_ID value: \u0026#34;1\u0026#34; - name: ZOOKEEPER_SERVER_1 value: zookeeper-1 - name: ZOOKEEPER_SERVER_2 value: zookeeper-2 - name: ZOOKEEPER_SERVER_3 value: zookeeper-3 volumeMounts: - name: zookeeper-data mountPath: \u0026#34;/var/lib/zookeeper/data\u0026#34; subPath: zookeeper volumeClaimTemplates: - metadata: name: zookeeper-data labels: app: zookeeper-1 spec: accessModes: [\u0026#34;ReadWriteOnce\u0026#34;] storageClassName: gp2 resources: requests: storage: 30Gi --- kind: StatefulSet apiVersion: apps/v1beta1 metadata: name: zookeeper-2 namespace: dev spec: serviceName: zookeeper-2 replicas: 1 selector: matchLabels: app: zookeeper-2 template: metadata: labels: app: zookeeper-2 spec: containers: - name: zookeeper image: digitalwonderland/zookeeper ports: - containerPort: 2181 env: - name: ZOOKEEPER_ID value: \u0026#34;2\u0026#34; - name: ZOOKEEPER_SERVER_1 value: zookeeper-1 - name: ZOOKEEPER_SERVER_2 value: zookeeper-2 - name: ZOOKEEPER_SERVER_3 value: zookeeper-3 volumeMounts: - name: zookeeper-data mountPath: \u0026#34;/var/lib/zookeeper/data\u0026#34; subPath: zookeeper-data volumeClaimTemplates: - metadata: name: zookeeper-data labels: app: zookeeper-2 spec: accessModes: [\u0026#34;ReadWriteOnce\u0026#34;] storageClassName: gp2 resources: requests: storage: 30Gi --- kind: StatefulSet apiVersion: apps/v1beta1 metadata: name: zookeeper-3 namespace: dev spec: serviceName: zookeeper-3 replicas: 1 selector: matchLabels: app: zookeeper-3 template: metadata: labels: app: zookeeper-3 spec: containers: - name: zookeeper image: digitalwonderland/zookeeper ports: - containerPort: 2181 env: - name: ZOOKEEPER_ID value: \u0026#34;3\u0026#34; - name: ZOOKEEPER_SERVER_1 value: zookeeper-1 - name: ZOOKEEPER_SERVER_2 value: zookeeper-2 - name: ZOOKEEPER_SERVER_3 value: zookeeper-3 volumeMounts: - name: zookeeper-data mountPath: \u0026#34;/var/lib/zookeeper/data\u0026#34; subPath: zookeeper volumeClaimTemplates: - metadata: name: zookeeper-data labels: app: zookeeper-3 spec: accessModes: [\u0026#34;ReadWriteOnce\u0026#34;] storageClassName: gp2 resources: requests: storage: 30Gi ç¼–å†™zookeeper-service.yamlæ–‡ä»¶ï¼š\nvim zookeeper-service.yaml å†™å…¥å†…å®¹ï¼š\napiVersion: v1 kind: Service metadata: name: zookeeper-1 namespace: dev labels: app: zookeeper-1 spec: ports: - name: client port: 2181 protocol: TCP - name: follower port: 2888 protocol: TCP - name: leader port: 3888 protocol: TCP selector: app: zookeeper-1 --- apiVersion: v1 kind: Service metadata: name: zookeeper-2 namespace: dev labels: app: zookeeper-2 spec: ports: - name: client port: 2181 protocol: TCP - name: follower port: 2888 protocol: TCP - name: leader port: 3888 protocol: TCP selector: app: zookeeper-2 --- apiVersion: v1 kind: Service metadata: name: zookeeper-3 namespace: dev labels: app: zookeeper-3 spec: ports: - name: client port: 2181 protocol: TCP - name: follower port: 2888 protocol: TCP - name: leader port: 3888 protocol: TCP selector: app: zookeeper-3 å®Œæˆä»¥ä¸Šä¸¤ä¸ªæ–‡ä»¶åï¼Œæ‰§è¡Œkubectlå‘½ä»¤å³å¯ï¼š\nkubectl apply -f zookeeper-statefulSet.yaml kubectl apply -f zookeeper-service.yaml éƒ¨ç½²Kafka # éƒ¨ç½²Kafka Connect # wget https://raw.githubusercontent.com/strimzi/strimzi-kafka-operator/0.16.1/examples/kafka/kafka-persistent-single.yaml å®‰è£…é›†ç¾¤\nwget https://github.com/strimzi/strimzi-kafka-operator/releases/download/0.18.0/strimzi-cluster-operator-0.18.0.yaml å¯èƒ½è¯¥æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ä½ éœ€è¦ä¿®æ”¹å…¶ä¸­çš„namespaceã€‚\nÂ« å¯èƒ½éœ€è¦è¿è¡Œå¤šæ¬¡ä»¥ä¸‹å‘½ä»¤ï¼Œç¡®ä¿k8sèµ„æºéƒ½åˆ›å»º\nÂ» Kubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ\n"},{"id":143,"href":"/kubernetes/k8s-dev-01-api-concept/","title":"K8s Dev 01 API Concept","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ\nKubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ # åœ¨ K8s é›†ç¾¤ä¸­ï¼ŒAPI æ˜¯ä¸€åˆ‡çš„åŸºç¡€ï¼ŒK8s çš„æ‰€æœ‰èµ„æºå¯¹è±¡éƒ½æ˜¯é€šè¿‡ API æ¥ç®¡ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®šåˆ¶å¼€å‘çš„æ—¶å€™ï¼Œé¦–å…ˆè¦äº†è§£ K8s çš„ API æ¦‚å¿µã€‚\nåŸºæœ¬æ¦‚å¿µ # Groupï¼ˆGï¼‰ï¼š\nAPI ç»„ï¼Œä¾‹å¦‚ï¼šappsã€networking.k8s.io ç­‰\nVersionï¼ˆVï¼‰ï¼š\nAPI ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼šv1alpha1ã€v1ã€v2 ç­‰\nResourceï¼ˆRï¼‰ï¼š\nAPI èµ„æºï¼Œä¾‹å¦‚ï¼špodsï¼Œconfigmaps ç­‰\nKindï¼ˆKï¼‰ï¼š\nAPI ç±»å‹ï¼Œä¾‹å¦‚ï¼šDeploymentï¼ŒService ç­‰ é€šè¿‡ kubectl api-versions è·å–é›†ç¾¤ä¸­æ‰€æœ‰ API çš„ç‰ˆæœ¬åˆ—è¡¨ï¼š\n$ kubectl api-versions acme.cert-manager.io/v1 admissionregistration.k8s.io/v1 apiextensions.k8s.io/v1 apiregistration.k8s.io/v1 apps/v1 authentication.k8s.io/v1 é€šè¿‡ kubectl api-resources å‘½ä»¤è·å–é›†ç¾¤æ‰€æœ‰ API çš„èµ„æºåˆ—è¡¨ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°èµ„æºçš„ç®€å†™åç§°ï¼Œç‰ˆæœ¬ä»¥åŠç±»å‹ï¼š\n$ kubectl api-resources NAME SHORTNAMES APIVERSION NAMESPACED KIND bindings v1 true Binding componentstatuses cs v1 false ComponentStatus configmaps cm v1 true ConfigMap endpoints ep v1 true Endpoints events ev v1 true Event limitranges limits v1 true LimitRange namespaces ns v1 false Namespace nodes no v1 false Node API èµ„æºç«¯ç‚¹ # GVR ç«¯ç‚¹ï¼š\n/apiï¼Œåªä¼šè·å–åˆ° v1 çš„ APIVersionï¼ˆç»„åä¸ºç©ºï¼‰ /apisï¼Œè·å–åˆ°æ‰€æœ‰éæ ¸å¿ƒ API çš„ APIGroupList /api/v1ï¼Œè·å–åˆ° APIResourceList /apis/{g}/ï¼Œè·å–åˆ° APIGroup /apis/{g}/v1ï¼Œè·å–åˆ° APIResourceList å‘½åç©ºé—´èµ„æºç«¯ç‚¹ï¼š\næ ¸å¿ƒ apiï¼š/api/{v}/namespaces/{ns}/{r}ï¼Œä¾‹å¦‚ï¼š/api/v1/namespaces/default/configmaps å…¶ä»– apiï¼š/apis/{g}/{v}/namespaces/{ns}/{r}ï¼Œä¾‹å¦‚ï¼šapis/apps/v1/namespaces/default/deployments é›†ç¾¤èµ„æºç«¯ç‚¹ï¼š\næ ¸å¿ƒ apiï¼š/api/{v}/{r}ï¼Œä¾‹å¦‚ï¼š/api/v1/nodes å…¶ä»–èµ„æºï¼š/apis/{g}/{v}/{r}ï¼Œä¾‹å¦‚ï¼š/apis/rbac.authorization.k8s.io/v1/clusterroles åœ¨ä½¿ç”¨ kubectl get å‘½ä»¤è·å–é›†ç¾¤èµ„æºå®ä¾‹æ—¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  -v 6 æŸ¥çœ‹æ‰§è¡Œå‘½ä»¤çš„è¯·æ±‚ç«¯ç‚¹ï¼š\n$ k get nodes -v 6 I0915 11:32:43.715795 18197 loader.go:373] Config loaded from file: /Users/dp/.kube/config I0915 11:32:43.855325 18197 round_trippers.go:553] GET https://127.0.01:6443/api/v1/nodes?limit=500 200 OK in 135 milliseconds NAME STATUS ROLES AGE VERSION local Ready control-plane 115d v1.27.2 APIService # æ¯ä¸ª API ç‰ˆæœ¬éƒ½å¯¹åº”ä¸€ä¸ª APIServiceï¼š\n$ k api-versions | wc -l 30 $ k get apiservices.apiregistration.k8s.io| wc -l 30 åˆ›å»ºä¸€ä¸ª CRD # foo-crd.yamlï¼š\napiVersion: apiextensions.k8s.io/v1 kind: CustomResourceDefinition metadata: # å›ºå®šæ ¼å¼ {kind_plural}.{group}ï¼Œå…¶ä¸­ foos å¯¹åº” spec.names.pluralï¼Œplay.ketches.io å¯¹åº” spec.group name: foos.play.ketches.io spec: group: play.ketches.io # èµ„æºç»„ï¼Œç”¨åœ¨ URL æ ‡è¯†èµ„æºæ‰€å± Groupï¼Œå¦‚ /apis/play.ketches.io/v1/foos ä¹‹ foos.play.ketches.io names: kind: Foo listKind: FooList plural: foos # èµ„æºåå¤æ•°ï¼Œç”¨åœ¨ URL æ ‡è¯†èµ„æºç±»å‹ï¼Œå¦‚ /apis/play.ketches.io/v1/foos ä¹‹ foos singular: foo # èµ„æºåå•æ•°ï¼Œå¯ç”¨äº kubectl åŒ¹é…èµ„æº shortNames: # èµ„æºç®€ç§°ï¼Œå¯ç”¨äº kubectl åŒ¹é…èµ„æº - fo scope: Namespaced # Namespaced/Cluster versions: - name: v1 served: true # æ˜¯å¦å¯ç”¨è¯¥ç‰ˆæœ¬ï¼Œå¯ä½¿ç”¨è¯¥æ ‡è¯†å¯åŠ¨/ç¦ç”¨è¯¥ç‰ˆæœ¬ API storage: true # å”¯ä¸€è½å­˜å‚¨ç‰ˆæœ¬ï¼Œå¦‚æœ CRD å«æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œåªèƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬è¢«æ ‡è¯†ä¸º true schema: openAPIV3Schema: type: object properties: spec: type: object required: [\u0026#34;msg\u0026#34;] # å¿…é¡»èµ‹å€¼ properties: msg: type: string maxLength: 6 additionalPrinterColumns: # å£°æ˜ kubectl get è¾“å‡ºåˆ—ï¼Œé»˜è®¤åœ¨ name åˆ—ä¹‹å¤–é¢å¤–è¾“å‡º age åˆ—ï¼Œæ”¹ä¸ºé¢å¤–è¾“å‡º age åˆ—ï¼Œmessage åˆ— - name: age jsonPath: .metadata.creationTimestamp type: date - name: message jsonPath: .spec.msg type: string è·å– CRD å¯¹åº”çš„ APIServiceï¼š\n~ k get apiservices.apiregistration.k8s.io v1.play.ketches.io NAME SERVICE AVAILABLE AGE v1.play.ketches.io Local True 3h26m ä¸€èˆ¬è¿™æ—¶å€™ SERVICE ä¸º Localï¼Œè¡¨ç¤º å¯¹è¯¥èµ„æºçš„ APIService è¯·æ±‚ä¼šåœ¨æœ¬åœ°å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ kube-apiserver å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ”¹ä¸ºä¸€ä¸ªåœ¨é›†ç¾¤ä¸­è¿è¡Œçš„ Service åï¼Œä¾‹å¦‚ï¼šdefault/play-v1-svcã€‚ä½ éœ€è¦ä¿®æ”¹ APIService çš„å£°æ˜ï¼š\napiVersion: apiregistration.k8s.io/v1 kind: APIService metadata: labels: kube-aggregator.kubernetes.io/automanaged: \u0026#34;true\u0026#34; name: v1.play.ketches.io spec: group: play.ketches.io groupPriorityMinimum: 1000 version: v1 versionPriority: 100 service: name: play-v1-svc namespace: default insecureSkipTLSVerify: true è¿™æ—¶å€™å¯¹ play.ketches.io/v1 ç»„ä¸‹çš„èµ„æºçš„è¯·æ±‚å¤„ç†ä¼šäº¤ç»™è¯¥æœåŠ¡ã€‚ å³ï¼š/apis/play.ketches.io/v1/namespaces/{ns}/foos/* =\u0026gt; default/play-v1-svcï¼Œå…¶å®è¿™å°±æ˜¯ä¸€ä¸ª è‡ªå®šä¹‰çš„ apiserver äº†ã€‚ ä½†æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ apiserver éœ€è¦å®ç°ä»¥ä¸‹è¿™äº›å¤„ç†ï¼ˆHandlerï¼‰ï¼š\nfor API Discovery /apis /apis/play.ketches.io /apis/play.ketches.io/v1 for OpenAPI Schema /openapi/v2 /openapi/v3 for Foo CRUD /apis/play.ketches.io/v1/foos /apis/play.ketches.io/v1/namespaces/{namespace}/foos /apis/play.ketches.io/v1/namespaces/{namespace}/foos/{name} OpenAPI # API çš„ Schema ä¼š kubectl explain å‘½ä»¤è¾“å‡ºå†…å®¹æ¥æºäº OpenAPI Specã€‚\nå‚è€ƒ # K8s CustomResourceDefinitions (CRD) åŸç† å®ç°ä¸€ä¸ªæç®€ K8s apiserver Â« Kubernetes 0-1 K8séƒ¨ç½²Zookeeperå’ŒKafka\nÂ» Kubernetes å®šåˆ¶å¼€å‘ 02ï¼šCRD\n"},{"id":144,"href":"/kubernetes/k8s-dev-02-crd/","title":"K8s Dev 02 Crd","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes å®šåˆ¶å¼€å‘ 02ï¼šCRD\nKubernetes å®šåˆ¶å¼€å‘ 02ï¼šCRD # Â« Kubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ\nÂ» Kubernetes å®šåˆ¶å¼€å‘ 50ï¼šæ‰©å±•è°ƒåº¦å™¨\n"},{"id":145,"href":"/kubernetes/k8s-dev-50-extend-kube-scheduler/","title":"K8s Dev 50 Extend Kube Scheduler","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes å®šåˆ¶å¼€å‘ 50ï¼šæ‰©å±•è°ƒåº¦å™¨\nKubernetes å®šåˆ¶å¼€å‘ 50ï¼šæ‰©å±•è°ƒåº¦å™¨ # ç®€ä»‹ # Kubernetes Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰æ˜¯ä¸€ä¸ªæ§åˆ¶é¢è¿›ç¨‹ï¼Œè´Ÿè´£å°† Pods æŒ‡æ´¾åˆ°èŠ‚ç‚¹ä¸Šã€‚è°ƒåº¦å™¨åŸºäºçº¦æŸå’Œå¯ç”¨èµ„æºä¸ºè°ƒåº¦é˜Ÿåˆ—ä¸­æ¯ä¸ª Pod ç¡®å®šå…¶å¯åˆæ³•æ”¾ç½®çš„èŠ‚ç‚¹ã€‚è°ƒåº¦å™¨ä¹‹åå¯¹æ‰€æœ‰åˆæ³•çš„èŠ‚ç‚¹è¿›è¡Œæ’åºï¼Œå°† Pod ç»‘å®šåˆ°ä¸€ä¸ªåˆé€‚çš„èŠ‚ç‚¹ã€‚\nkube-scheduler æ˜¯ Kubernetes è‡ªå¸¦çš„ä¸€ä¸ªé»˜è®¤è°ƒåº¦å™¨ï¼Œå®ƒä¼šæ ¹æ® Pod çš„èµ„æºéœ€æ±‚å’ŒèŠ‚ç‚¹çš„èµ„æºå®¹é‡ï¼Œå°† Pod è°ƒåº¦åˆ°åˆé€‚çš„èŠ‚ç‚¹ä¸Šã€‚\nå¦‚æœé»˜è®¤è°ƒåº¦å™¨ä¸ç¬¦åˆä½ çš„éœ€æ±‚ï¼Œä½ å¯ä»¥å®ç°è‡ªå·±çš„è°ƒåº¦å™¨ï¼Œå¹¶ä¸”ä½ çš„è°ƒåº¦å™¨å¯ä»¥å’Œé»˜è®¤è°ƒåº¦å™¨æˆ–å…¶ä»–è°ƒåº¦å™¨ä¸€èµ·è¿è¡Œåœ¨é›†ç¾¤ä¸­ã€‚ä½ å¯ä»¥é€šè¿‡å£°æ˜ Pod çš„ spec.schedulerName å­—æ®µæ¥æŒ‡å®šè¦ä½¿ç”¨çš„è°ƒåº¦å™¨ã€‚\næ‰©å±•è°ƒåº¦å™¨ # æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥å®ç°è‡ªå®šä¹‰è°ƒåº¦å™¨ï¼š\nä¿®æ”¹ kube-scheduler æºç è°ƒåº¦é€»è¾‘ï¼Œç„¶åç¼–è¯‘æˆå®šåˆ¶çš„è°ƒåº¦å™¨é•œåƒï¼Œç„¶åä½¿ç”¨è¿™ä¸ªé•œåƒéƒ¨ç½²è°ƒåº¦è¿›ç¨‹ è‡ªå®šä¹‰ Pod æ§åˆ¶å™¨ï¼Œç›‘å¬ Pod çš„ spec.schedulerName å­—æ®µï¼Œåœ¨ Pod è¢«åˆ›å»ºæ—¶ï¼Œä¸ºå…¶ç»‘å®šèŠ‚ç‚¹ ä½¿ç”¨ Scheduler Extender çš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä¸éœ€è¦ä¿®æ”¹é»˜è®¤è°ƒåº¦å™¨çš„é…ç½®æ–‡ä»¶ ç¼–è¯‘å®šåˆ¶è°ƒåº¦å™¨é•œåƒ # å…‹éš† kubernetes æºç ï¼Œç„¶åä¿®æ”¹ kube-scheduler æºç ï¼Œç„¶åç¼–è¯‘æˆå®šåˆ¶çš„è°ƒåº¦å™¨é•œåƒã€‚\ngit clone https://github.com/kubernetes/kubernetes.git cd kubernetes # ä¿®æ”¹æºç  make ç¼–å†™ Dockerfileï¼š\nFROM alpine ADD ./_output/local/bin/linux/amd64/kube-scheduler /usr/local/bin/kube-scheduler ç¼–è¯‘å¹¶æ¨é€é•œåƒï¼š\ndocker build -t poneding/my-kube-scheduler:v1.0 . docker push poneding/my-kube-scheduler:v1.0 ç¼–å†™éƒ¨ç½²æ¸…å•æ–‡ä»¶ï¼š\ndeploy-maniest.yamlï¼š\napiVersion: v1 kind: ServiceAccount metadata: name: my-scheduler namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: my-scheduler-as-kube-scheduler subjects: - kind: ServiceAccount name: my-scheduler namespace: kube-system roleRef: kind: ClusterRole name: system:kube-scheduler apiGroup: rbac.authorization.k8s.io --- apiVersion: v1 kind: ConfigMap metadata: name: my-scheduler-config namespace: kube-system data: my-scheduler-config.yaml: | apiVersion: kubescheduler.config.k8s.io/v1 kind: KubeSchedulerConfiguration profiles: - schedulerName: my-scheduler leaderElection: leaderElect: false --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: my-scheduler-as-volume-scheduler subjects: - kind: ServiceAccount name: my-scheduler namespace: kube-system roleRef: kind: ClusterRole name: system:volume-scheduler apiGroup: rbac.authorization.k8s.io --- apiVersion: apps/v1 kind: Deployment metadata: labels: component: scheduler tier: control-plane name: my-scheduler namespace: kube-system spec: selector: matchLabels: component: scheduler tier: control-plane replicas: 1 template: metadata: labels: component: scheduler tier: control-plane spec: serviceAccountName: my-scheduler containers: - command: - /usr/local/bin/kube-scheduler - --config=/etc/kubernetes/my-scheduler/my-scheduler-config.yaml image: poneding/my-kube-scheduler:v1.0 livenessProbe: httpGet: path: /healthz port: 10259 scheme: HTTPS initialDelaySeconds: 15 name: my-scheduler readinessProbe: httpGet: path: /healthz port: 10259 scheme: HTTPS resources: requests: cpu: \u0026#39;0.1\u0026#39; securityContext: privileged: false volumeMounts: - name: config-volume mountPath: /etc/kubernetes/my-scheduler hostNetwork: false hostPID: false volumes: - name: config-volume configMap: name: my-scheduler-config éƒ¨ç½²ï¼š\nkubectl apply -f deploy-maniest.yaml æµ‹è¯•ï¼š\nkubectl run nginx-by-my-scheduler --image=nginx --overrides=\u0026#39;{\u0026#34;spec\u0026#34;:{\u0026#34;schedulerName\u0026#34;:\u0026#34;my-scheduler\u0026#34;}}\u0026#39; kubectl get pod -o wide -w å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå°†è§‚å¯Ÿåˆ° Pod å°†ä¼šè¢«æ­£å¸¸è°ƒåº¦åˆ°èŠ‚ç‚¹ä¸Šã€‚\nä½¿ç”¨è¿™ç§æ–¹å¼æ¥æ‰©å±•è°ƒåº¦å™¨ï¼Œå¯¹å¼€å‘è€…æ¥è¯´ï¼Œéœ€è¦äº†è§£è°ƒåº¦å™¨çš„æºç ç„¶åä¿®æ”¹é€»è¾‘ï¼Œæœ‰ä¸€å®šçš„éš¾åº¦ã€‚\nè‡ªå®šä¹‰è°ƒåº¦æ§åˆ¶å™¨ # åŸºäº controller-runtime åŒ…ç¼–å†™ä¸€ä¸ªè°ƒåº¦æ§åˆ¶å™¨ï¼ŒåŸç†æ˜¯é€šè¿‡åè°ƒ Pod ï¼Œé€‰æ‹©ä¸€ä¸ªé€‚åˆçš„èŠ‚ç‚¹ï¼Œåˆ›å»º Binding å¯¹è±¡ï¼Œå°† Pod ç»‘å®šåˆ°æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šã€‚\nåˆ›å»ºé¡¹ç›®ï¼š\nmkdir my-scheduler \u0026amp;\u0026amp; cd my-scheduler go mod init my-scheduler touch main.go ç¼–å†™ main.go è°ƒåº¦å™¨é€»è¾‘ï¼ˆæœ¬è´¨æ˜¯ä¸€ä¸ª Pod çš„åè°ƒæ§åˆ¶å™¨ï¼‰ï¼š\npackage main import ( \u0026#34;context\u0026#34; \u0026#34;log\u0026#34; \u0026#34;math/rand\u0026#34; corev1 \u0026#34;k8s.io/api/core/v1\u0026#34; \u0026#34;k8s.io/apimachinery/pkg/runtime\u0026#34; ctrl \u0026#34;sigs.k8s.io/controller-runtime\u0026#34; \u0026#34;sigs.k8s.io/controller-runtime/pkg/client\u0026#34; \u0026#34;sigs.k8s.io/controller-runtime/pkg/event\u0026#34; \u0026#34;sigs.k8s.io/controller-runtime/pkg/manager\u0026#34; \u0026#34;sigs.k8s.io/controller-runtime/pkg/predicate\u0026#34; ) func main() { mgr, err := ctrl.NewManager(ctrl.GetConfigOrDie(), manager.Options{}) if err != nil { log.Fatalf(\u0026#34;new manager err: %s\u0026#34;, err.Error()) } err = (\u0026amp;MyScheduler{ Client: mgr.GetClient(), Scheme: mgr.GetScheme(), }).SetupWithManager(mgr) if err != nil { log.Fatalf(\u0026#34;setup scheduler err: %s\u0026#34;, err.Error()) } err = mgr.Start(context.Background()) if err != nil { log.Fatalf(\u0026#34;start manager err: %s\u0026#34;, err.Error()) } } const mySchedulerName = \u0026#34;my-scheduler\u0026#34; type MyScheduler struct { Client client.Client Scheme *runtime.Scheme } func (s *MyScheduler) Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error) { nodes := new(corev1.NodeList) err := s.Client.List(ctx, nodes) if err != nil { return ctrl.Result{Requeue: true}, err } // éšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ targetNode := nodes.Items[rand.Intn(len(nodes.Items))].Name // åˆ›å»ºç»‘å®šå…³ç³» binding := new(corev1.Binding) binding.Name = req.Name binding.Namespace = req.Namespace binding.Target = corev1.ObjectReference{ Kind: \u0026#34;Node\u0026#34;, APIVersion: \u0026#34;v1\u0026#34;, Name: targetNode, } err = s.Client.Create(ctx, binding) if err != nil { return ctrl.Result{Requeue: true}, err } return ctrl.Result{}, nil } // SetupWithManager sets up the controller with the Manager. func (s *MyScheduler) SetupWithManager(mgr ctrl.Manager) error { // è¿‡æ»¤ç›®æ ‡ Pod filter := predicate.Funcs{ CreateFunc: func(e event.CreateEvent) bool { pod, ok := e.Object.(*corev1.Pod) if ok { return pod.Spec.SchedulerName == mySchedulerName \u0026amp;\u0026amp; pod.Spec.NodeName == \u0026#34;\u0026#34; } return false }, UpdateFunc: func(e event.UpdateEvent) bool { return false }, DeleteFunc: func(e event.DeleteEvent) bool { return false }, } return ctrl.NewControllerManagedBy(mgr). For(\u0026amp;corev1.Pod{}). WithEventFilter(filter). Complete(s) } è¿è¡Œè‡ªå®šä¹‰è°ƒåº¦å™¨ï¼š\ngo run main.go ä¹Ÿå¯ä»¥å‚è€ƒå‰é¢çš„éƒ¨ç½²æ–¹å¼ï¼Œå…ˆåˆ¶ä½œä¸€ä¸ªé•œåƒï¼Œç„¶åéƒ¨ç½²åˆ°é›†ç¾¤ä¸­ã€‚\nè¿è¡Œä¸€ä¸ª Podï¼ŒæŒ‡å®šè°ƒåº¦å™¨ä¸º my-schedulerï¼š\nkubectl run nginx-by-my-scheduler --image=nginx --overrides=\u0026#39;{\u0026#34;spec\u0026#34;:{\u0026#34;schedulerName\u0026#34;:\u0026#34;my-scheduler\u0026#34;}}\u0026#39; ä¸€åˆ‡æ­£å¸¸çš„è¯ï¼Œå°†ä¼šè§‚å¯Ÿåˆ° Pod è¢«æ­£å¸¸è°ƒåº¦åˆ°èŠ‚ç‚¹ä¸Šã€‚\nScheduler Extender # é€šè¿‡ Scheduler Extender æ¥æ‰©å±• Kubernetes è°ƒåº¦å™¨ï¼Œå®ƒå°†ä»¥ Webhook çš„å½¢å¼è¿è¡Œï¼Œå¹¶ä¸”åœ¨è°ƒåº¦å™¨æ¡†æ¶é˜¶æ®µä¸­è¿›è¡Œå¹²æ‰°ã€‚\né˜¶æ®µ æè¿° Filter è°ƒåº¦æ¡†æ¶å°†è°ƒç”¨è¿‡æ»¤å‡½æ•°ï¼Œè¿‡æ»¤æ‰ä¸é€‚åˆè¢«è°ƒåº¦çš„èŠ‚ç‚¹ã€‚ Priority è°ƒåº¦æ¡†æ¶å°†è°ƒç”¨ä¼˜å…ˆçº§å‡½æ•°ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹è®¡ç®—ä¸€ä¸ªä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼ŒèŠ‚ç‚¹è¶Šé€‚åˆè¢«è°ƒåº¦ã€‚ Bind è°ƒåº¦æ¡†æ¶å°†è°ƒç”¨ç»‘å®šå‡½æ•°ï¼Œå°† Pod ç»‘å®šåˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ Scheduler Extender é€šè¿‡ HTTP è¯·æ±‚çš„æ–¹å¼ï¼Œå°†è°ƒåº¦æ¡†æ¶é˜¶æ®µä¸­çš„è°ƒåº¦å†³ç­–å§”æ‰˜ç»™å¤–éƒ¨çš„è°ƒåº¦å™¨ï¼Œç„¶åå°†è°ƒåº¦ç»“æœè¿”å›ç»™è°ƒåº¦æ¡†æ¶ã€‚æˆ‘ä»¬åªéœ€è¦å®ç°ä¸€ä¸ª HTTP æœåŠ¡ï¼Œç„¶åå°†å…¶æ³¨å†Œåˆ°è°ƒåº¦å™¨ä¸­ï¼Œå°±å¯ä»¥å®ç°è‡ªå®šä¹‰è°ƒåº¦å™¨ã€‚åœ¨è¿™ä¸ª HTTP æœåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸Šè¿°é˜¶æ®µä¸­çš„ä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªé˜¶æ®µçš„æ¥å£ï¼Œæ¥å®šåˆ¶æˆ‘ä»¬çš„è°ƒåº¦éœ€æ±‚ã€‚\næ¥å£åˆ—è¡¨ï¼š\nFilter æ¥å£ # æ¥å£æ–¹æ³•ï¼šPOST\næ¥å£è¯·æ±‚å‚æ•°ï¼š\ntype ExtenderArgs struct { Pod *v1.Pod Nodes *v1.NodeList NodeNames *[]string } æ¥å£è¯·æ±‚ç»“æœï¼š\ntype ExtenderFilterResult struct { Nodes *v1.NodeList NodeNames *[]string FailedNodes FailedNodesMap FailedAndUnresolvableNodes FailedNodesMap Error string } Priority æ¥å£ # æ¥å£æ–¹æ³•ï¼šPOST\næ¥å£è¯·æ±‚å‚æ•°ï¼šå’Œ Filter æ¥å£è¯·æ±‚å‚æ•°ä¸€è‡´ã€‚\næ¥å£è¯·æ±‚ç»“æœï¼š\ntype HostPriorityList []HostPriority type HostPriority struct { Host string Score int64 } Bind æ¥å£ # æ¥å£æ–¹æ³•ï¼šPOST\næ¥å£è¯·æ±‚å‚æ•°ï¼š\ntype ExtenderBindingArgs struct { PodName string PodNamespace string PodUID types.UID Node string } æ¥å£è¯·æ±‚ç»“æœï¼š\ntype ExtenderBindingResult struct { Error string } å®ç° # æˆ‘ä»¬ä½¿ç”¨ Scheduler Extender çš„æ–¹å¼æ¥å®ç°è‡ªå®šä¹‰è°ƒåº¦å™¨ï¼Œä¾›å‚è€ƒã€‚\nmain.goï¼š\npackage main import ( \u0026#34;encoding/json\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; extenderv1 \u0026#34;k8s.io/kube-scheduler/extender/v1\u0026#34; ) func Filter(w http.ResponseWriter, r *http.Request) { if r.Method != http.MethodPost { w.WriteHeader(http.StatusMethodNotAllowed) return } var args extenderv1.ExtenderArgs var result *extenderv1.ExtenderFilterResult err := json.NewDecoder(r.Body).Decode(\u0026amp;args) if err != nil { result = \u0026amp;extenderv1.ExtenderFilterResult{ Error: err.Error(), } } else { result = filter(args) } w.Header().Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) w.WriteHeader(http.StatusOK) if err := json.NewEncoder(w).Encode(result); err != nil { log.Printf(\u0026#34;failed to encode result: %v\u0026#34;, err) } } func Prioritize(w http.ResponseWriter, r *http.Request) { if r.Method != http.MethodPost { w.WriteHeader(http.StatusMethodNotAllowed) return } var args extenderv1.ExtenderArgs var result *extenderv1.HostPriorityList err := json.NewDecoder(r.Body).Decode(\u0026amp;args) if err != nil { result = \u0026amp;extenderv1.HostPriorityList{} } else { result = prioritize(args) } w.Header().Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) w.WriteHeader(http.StatusOK) if err := json.NewEncoder(w).Encode(result); err != nil { log.Printf(\u0026#34;failed to encode result: %v\u0026#34;, err) } } func Bind(w http.ResponseWriter, r *http.Request) { if r.Method != http.MethodPost { w.WriteHeader(http.StatusMethodNotAllowed) return } var args extenderv1.ExtenderBindingArgs var result *extenderv1.ExtenderBindingResult err := json.NewDecoder(r.Body).Decode(\u0026amp;args) if err != nil { result = \u0026amp;extenderv1.ExtenderBindingResult{ Error: err.Error(), } } else { result = bind(args) } w.Header().Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) w.WriteHeader(http.StatusOK) if err := json.NewEncoder(w).Encode(result); err != nil { log.Printf(\u0026#34;failed to encode result: %v\u0026#34;, err) } } func main() { http.HandleFunc(\u0026#34;/filter\u0026#34;, Filter) http.HandleFunc(\u0026#34;/priority\u0026#34;, Prioritize) http.HandleFunc(\u0026#34;/bind\u0026#34;, Bind) http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil) } filter.goï¼šæ²¡æœ‰å…·ä½“å®ç°èŠ‚ç‚¹è¿‡æ»¤é€»è¾‘ï¼Œç›´æ¥è¿”å›æ‰€æœ‰èŠ‚ç‚¹ã€‚\npackage main import ( \u0026#34;log\u0026#34; extenderv1 \u0026#34;k8s.io/kube-scheduler/extender/v1\u0026#34; ) func filter(args extenderv1.ExtenderArgs) *extenderv1.ExtenderFilterResult { log.Println(\u0026#34;my-scheduler-extender filter called.\u0026#34;) return \u0026amp;extenderv1.ExtenderFilterResult{ Nodes: args.Nodes, NodeNames: args.NodeNames, } } prioritize.goï¼šæ¨¡æ‹Ÿæ‰“åˆ†ï¼ŒæŒ‰ç…§èŠ‚ç‚¹é¡ºåºç»™èŠ‚ç‚¹ç´¯åŠ ä¸€ä¸ªåˆ†æ•°ã€‚\npackage main import ( \u0026#34;log\u0026#34; extenderv1 \u0026#34;k8s.io/kube-scheduler/extender/v1\u0026#34; ) func prioritize(args extenderv1.ExtenderArgs) *extenderv1.HostPriorityList { log.Println(\u0026#34;my-scheduler-extender prioritize called.\u0026#34;) var result extenderv1.HostPriorityList for i, node := range args.Nodes.Items { result = append(result, extenderv1.HostPriority{ Host: node.Name, Score: int64(i), }) } return \u0026amp;result } bind.goï¼šæ²¡æœ‰å…·ä½“å®ç°ç»‘å®šé€»è¾‘ï¼Œç›´æ¥è¿”å›æˆåŠŸã€‚\npackage main import ( \u0026#34;context\u0026#34; \u0026#34;log\u0026#34; corev1 \u0026#34;k8s.io/api/core/v1\u0026#34; \u0026#34;k8s.io/client-go/kubernetes/scheme\u0026#34; \u0026#34;k8s.io/client-go/rest\u0026#34; extenderv1 \u0026#34;k8s.io/kube-scheduler/extender/v1\u0026#34; ctrl \u0026#34;sigs.k8s.io/controller-runtime\u0026#34; \u0026#34;sigs.k8s.io/controller-runtime/pkg/client\u0026#34; ) var kconfig *rest.Config var kruntimeclient client.Client func init() { kconfig = ctrl.GetConfigOrDie() var err error kruntimeclient, err = client.New(kconfig, client.Options{ Scheme: scheme.Scheme, }) if err != nil { log.Fatalf(\u0026#34;failed to create k8s runtime client: %v\u0026#34;, err) } } func bind(args extenderv1.ExtenderBindingArgs) *extenderv1.ExtenderBindingResult { log.Println(\u0026#34;my-scheduler-extender bind called.\u0026#34;) log.Printf(\u0026#34;pod %s/%s is bind to %s\u0026#34;, args.PodNamespace, args.PodName, args.Node) // åˆ›å»ºç»‘å®šå…³ç³» binding := new(corev1.Binding) binding.Name = args.PodName binding.Namespace = args.PodNamespace binding.Target = corev1.ObjectReference{ Kind: \u0026#34;Node\u0026#34;, APIVersion: \u0026#34;v1\u0026#34;, Name: args.Node, } result := new(extenderv1.ExtenderBindingResult) err := kruntimeclient.Create(context.Background(), binding) if err != nil { result.Error = err.Error() } return result } ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼š\nGOOS=linux GOARCH=amd64 go build -o my-scheduler-extender ç¼–å†™ Dockerfileï¼š\nFROM alpine ARG TARGETOS TARGETARCH ADD ./bin/$TARGETOS/$TARGETARCH/my-scheduler-extender /my-scheduler-extender ENTRYPOINT [\u0026#34;/my-scheduler-extender\u0026#34;] ç¼–è¯‘å¹¶æ¨é€é•œåƒï¼š\nGOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -o bin/linux/amd64/my-scheduler-extender GOOS=linux GOARCH=arm64 CGO_ENABLED=0 go build -o bin/linux/arm64/my-scheduler-extender docker buildx build --push --platform linux/amd64,linux/arm64 -t poneding/my-kube-scheduler-extender:v1.0 . ç¼–å†™éƒ¨ç½²æ¸…å•æ–‡ä»¶ï¼Œéƒ¨ç½²æ¸…å•ä¸­åŒ…æ‹¬é¢å¤–çš„è°ƒåº¦å™¨ï¼ˆå‚è€ƒä¸Šè¿°ç¼–è¯‘å®šåˆ¶è°ƒåº¦å™¨é•œåƒçš„æ–¹å¼ï¼‰å’Œæˆ‘ä»¬å¼€å‘çš„ Scheduler Extenderï¼š\næ³¨æ„ï¼šä¸ºäº†ç®€åŒ–éƒ¨ç½²æ¸…å•ï¼Œç»™äº† my-scheduler-extender å’Œ my-scheduler-with-extender å®¹å™¨ cluster-admin æƒé™ï¼Œå®é™…ä¸Šä¸éœ€è¦è¿™ä¹ˆé«˜çš„æƒé™ã€‚\ndeploy-manifests.yamlï¼š\napiVersion: v1 kind: ServiceAccount metadata: name: my-scheduler-with-extender namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: my-scheduler-with-extender subjects: - kind: ServiceAccount name: my-scheduler-with-extender namespace: kube-system roleRef: kind: ClusterRole name: cluster-admin apiGroup: rbac.authorization.k8s.io --- apiVersion: v1 kind: ConfigMap metadata: name: my-scheduler-with-extender-config namespace: kube-system data: my-scheduler-with-extender-config.yaml: | apiVersion: kubescheduler.config.k8s.io/v1 kind: KubeSchedulerConfiguration profiles: - schedulerName: my-scheduler-with-extender leaderElection: leaderElect: false extenders: - urlPrefix: \u0026#34;http://my-scheduler-extender.kube-system.svc:8080\u0026#34; enableHTTPS: false filterVerb: \u0026#34;filter\u0026#34; prioritizeVerb: \u0026#34;prioritize\u0026#34; bindVerb: \u0026#34;bind\u0026#34; weight: 1 nodeCacheCapable: false --- apiVersion: apps/v1 kind: Deployment metadata: labels: component: my-scheduler-with-extender tier: control-plane name: my-scheduler-with-extender namespace: kube-system spec: selector: matchLabels: component: my-scheduler-with-extender tier: control-plane replicas: 1 template: metadata: labels: component: my-scheduler-with-extender tier: control-plane spec: serviceAccountName: my-scheduler-with-extender containers: - command: - kube-scheduler - --config=/etc/kubernetes/my-scheduler-with-extender/my-scheduler-with-extender-config.yaml image: registry.k8s.io/kube-scheduler:v1.29.0 livenessProbe: httpGet: path: /healthz port: 10259 scheme: HTTPS initialDelaySeconds: 15 name: my-scheduler-with-extender readinessProbe: httpGet: path: /healthz port: 10259 scheme: HTTPS resources: requests: cpu: \u0026#39;0.1\u0026#39; securityContext: privileged: false volumeMounts: - name: config-volume mountPath: /etc/kubernetes/my-scheduler-with-extender hostNetwork: false hostPID: false volumes: - name: config-volume configMap: name: my-scheduler-with-extender-config --- apiVersion: apps/v1 kind: Deployment metadata: labels: component: my-scheduler-extender tier: control-plane name: my-scheduler-extender namespace: kube-system spec: selector: matchLabels: component: my-scheduler-extender tier: control-plane replicas: 1 template: metadata: labels: component: my-scheduler-extender tier: control-plane spec: serviceAccountName: my-scheduler-with-extender containers: - image: poneding/my-kube-scheduler-extender:v1.0 name: my-scheduler-extender imagePullPolicy: Always --- apiVersion: v1 kind: Service metadata: name: my-scheduler-extender namespace: kube-system spec: selector: component: my-scheduler-extender tier: control-plane ports: - port: 8080 targetPort: 8080 éƒ¨ç½²ï¼š\nkubectl apply -f deploy-manifests.yaml è¿è¡Œä¸€ä¸ªæµ‹è¯• Podï¼ŒæŸ¥çœ‹ my-scheduler-extender å®¹å™¨çš„æ—¥å¿—ï¼š\nkubectl run nginx-by-my-scheduler-extender --image=nginx --overrides=\u0026#39;{\u0026#34;spec\u0026#34;:{\u0026#34;schedulerName\u0026#34;:\u0026#34;my-scheduler-with-extender\u0026#34;}}\u0026#39; # æŸ¥çœ‹ my-scheduler-extender æ—¥å¿— kubectl logs deploy/my-scheduler-extender -n kube-system -f ä»£ç ä¼ é€é—¨ï¼š my-scheduler-extender\nå‚è€ƒ # è°ƒåº¦å™¨é…ç½® Kubernetes Extender Create a custom Kubernetes scheduler Â« Kubernetes å®šåˆ¶å¼€å‘ 02ï¼šCRD\nÂ» ç®€å•ä»‹ç» K8s\n"},{"id":146,"href":"/kubernetes/k8s-get-started/","title":"K8s Get Started","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / ç®€å•ä»‹ç» K8s\nç®€å•ä»‹ç» K8s # ç®€ä»‹ # æˆ‘ä»¬çš„åº”ç”¨éƒ¨ç½²è¶‹åŠ¿ç”±å¤§å‹å•ä½“åº”ç”¨å‘å¾®æœåŠ¡æ¼”å˜ï¼Œå¾®æœåŠ¡åº”ç”¨ä¹‹é—´è§£è€¦ï¼Œå½¢æˆå¯è¢«ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²ã€å‡çº§ã€ä¼¸ç¼©çš„è½¯ä»¶å•å…ƒã€‚\nå¦ä¸€æ–¹é¢å®¹å™¨æŠ€æœ¯ç”±äºå®ƒçš„è½»é‡çº§ï¼Œèµ„æºéš”ç¦»ï¼Œå¯ç§»æ¤ã€éƒ¨ç½²é«˜æ•ˆç­‰ç‰¹æ€§å¾—åˆ°äº†è¿…é€Ÿçš„å‘å±•å’Œæ™®åŠã€‚è¶Šæ¥è¶Šå¤šçš„åº”ç”¨é€‰æ‹©ä½¿ç”¨å®¹å™¨æ¥éƒ¨ç½²ï¼Œå¾®æœåŠ¡æ›´ä¸ä¾‹å¤–ã€‚\nè¿™æ—¶ï¼Œä¾¿æœ‰äº†ç®¡ç†å¾®æœåŠ¡+å®¹å™¨çš„éœ€æ±‚ï¼ŒKubernetes å¼€å§‹å¤§æ”¾å¼‚å½©ã€‚\nKubernetes æ˜¯åŸºäºå®¹å™¨æŠ€æœ¯çš„æœåŠ¡å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼Œé€šè¿‡å®ƒï¼Œå¯ä»¥æ‰˜ç®¡æ•°é‡åºå¤§çš„åº”ç”¨é›†ï¼Œå¹¶ä¸”å†…ç½®å®Œå¤‡çš„é›†ç¾¤ç®¡ç†èƒ½åŠ›ï¼Œå®ƒæœ‰èƒ½åŠ›å¸®ä½ åšåˆ°è¿™äº›ï¼š\nåº”ç”¨çš„å®¹å™¨åŒ–éƒ¨ç½²ã€å¥åº·æ£€æŸ¥ã€è‡ªæˆ‘ä¿®å¤ã€è‡ªåŠ¨ä¼¸ç¼©ã€æ»šåŠ¨æ›´æ–°ã€èµ„æºåˆ†é…ç­‰ æœåŠ¡çš„æ³¨å†Œã€å‘ç°ã€å‡è¡¡è´Ÿè½½ç­‰ Kubernetes å¯¹äºè¿ç»´å›¢é˜Ÿæ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¸®æ‰‹ï¼Œæ›´è‡ªåŠ¨åŒ–çš„éƒ¨ç½²å’Œç®¡ç†åº”ç”¨ï¼Œæ›´é«˜æ•ˆçš„åˆ©ç”¨ç¡¬ä»¶èµ„æºã€‚\nåŸºæœ¬æ¦‚å¿µ # Kubernetes é›†ç¾¤ï¼Œåé¢ç®€ç§°ä¸ºK8sï¼Œä¸»è¦æ˜¯ç”±æ§åˆ¶èŠ‚ç‚¹ï¼ˆMasterï¼‰å’Œå·¥ä½œèŠ‚ç‚¹ï¼ˆNodeï¼‰ç»„æˆã€‚\nåœ¨ Master èŠ‚ç‚¹ä¸­è¿è¡Œç€ä¸‰å¤§ç»„ä»¶ï¼škube-api-serverã€kube-controller-managerã€kube-schedulerï¼Œé€šå¸¸ä¹Ÿä¼šå°† etcd æ•°æ®åº“éƒ¨ç½²åœ¨ Master èŠ‚ç‚¹ã€‚\nåœ¨ Node èŠ‚ç‚¹ä¸­ï¼Œä¹Ÿæ˜¯éœ€è¦éƒ¨ç½²ä¸‰ä¸ªä¸»è¦ç»„ä»¶ï¼Œå®¹å™¨å¼•æ“ï¼ˆåŸºæœ¬é»˜è®¤ docker äº†ï¼‰ã€kubeletã€kube-proxyã€‚\nK8s çš„ç»„æˆç»“æ„å¤§è‡´å¦‚ä¸‹å›¾ï¼š\nMaster èŠ‚ç‚¹ # è´Ÿè´£ K8s èµ„æºçš„è°ƒåº¦ç®¡ç†ï¼Œç”± Master å‘ Node ä¸‹è¾¾æ§åˆ¶å‘½ä»¤ï¼Œå¹¶ä¸”ä¸€èˆ¬è¿ç»´äººå‘˜ä½¿ç”¨ Master æ“ä½œå’Œæ‰§è¡Œå‘½ä»¤ã€‚\nMaster èŠ‚ç‚¹æ‰®æ¼”çš„è§’è‰²ç›¸å½“äº K8s çš„å¤§è„‘ï¼Œå…¶é‡è¦æ€§å¯æƒ³è€ŒçŸ¥ï¼Œå› æ­¤å»ºè®®éƒ¨ç½² 3 å° Master èŠ‚ç‚¹ä¿è¯ K8s çš„é«˜å¯ç”¨æ€§ã€‚\nkube-api-serverï¼šhttp rest æ¥å£æœåŠ¡ï¼Œä¸ K8s å…¶ä»–ç»„ä»¶é€šä¿¡ï¼Œè´Ÿè´£ K8s èµ„æºçš„ CURD çš„æ“ä½œå…¥å£ï¼›\nkube-controller-managerï¼šK8s èµ„æºçš„è‡ªåŠ¨åŒ–æ§åˆ¶ç®¡ç†ä¸­å¿ƒï¼Œå¦‚è·Ÿè¸ªèµ„æºçŠ¶æ€ï¼Œèµ„æºä¿®å¤ç­‰ï¼›\nkube-schedulerï¼šåº”ç”¨è°ƒåº¦ï¼Œä¸ºåº”ç”¨è‡ªåŠ¨åˆ†é…èŠ‚ç‚¹ç­‰ï¼›\netcdï¼šåˆ†å¸ƒå¼çš„æ•°æ®åº“ç³»ç»Ÿï¼Œå­˜å‚¨ K8s ä¸­çš„å„ç§èµ„æºä¿¡æ¯ã€‚\nNode èŠ‚ç‚¹ # è´Ÿè´£ K8s åº”ç”¨èµ„æºçš„å®¹å™¨åŒ–éƒ¨ç½²å’Œè¿è¡Œï¼ŒNode èŠ‚ç‚¹é…ç½®è¦æ±‚ä¸€èˆ¬é«˜äº Masterï¼Œå½“å…¶ä¸­ä¸€ä¸ª Node ä¸å¯ç”¨æ—¶ï¼Œéƒ¨ç½²åœ¨å…¶ä¸Šçš„ K8s èµ„æºä¼šè‡ªåŠ¨è¢«è¿ç§»åˆ°å¯ç”¨çš„ Nodeã€‚\ndockerï¼šéƒ¨ç½²åº”ç”¨çš„å®¹å™¨å¼•æ“ï¼› kubeletï¼šä¸ kube-api-server é€šä¿¡ï¼Œå‘ Master æ³¨å†Œè‡ªå·±ï¼Œå®šæ—¶æ±‡æŠ¥è‡ªèº« Node ä¿¡æ¯ï¼ŒMaster ä¸‹è¾¾è°ƒåº¦å‘½ä»¤ï¼ŒåŒæ—¶è´Ÿè´£å®¹å™¨ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼› kube-proxyï¼šå®ç° service ä»£ç† endpoint å’Œè´Ÿè½½å‡è¡¡ï¼Œåˆ†é… Node ç«¯å£ç­‰ã€‚ å…¶å®äº†è§£äº† K8s çš„æ•´ä¸ªç»„æˆå’Œç›¸å…³ç»„ä»¶æœåŠ¡çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å°±èƒ½çŸ¥é“å¦‚ä½•æ¥ç®¡ç†æˆ‘ä»¬çš„ K8s èŠ‚ç‚¹äº†ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ–°å¢ Node èŠ‚ç‚¹ï¼Œè¯¥å¦‚ä½•æ“ä½œï¼Ÿ\nåŸç†ä¸Šæ–°æ‰© Node åªéœ€è¦åœ¨ä¸€å°æ–°çš„æœºå™¨ä¸Šå®‰è£…ä»¥ä¸Šä¸‰ä¸ªæœåŠ¡ï¼Œç„¶åé…ç½® kubectl å’Œ kube-proxy çš„å¯åŠ¨å‚æ•°ï¼Œé€šè¿‡ kubelet å‘ Masterçš„kube-api-server æäº¤ Node æ³¨å†Œä¿¡æ¯ï¼Œå°±å¯ä»¥å°† Node çº³å…¥ Master çš„è°ƒåº¦ä¸­å¿ƒäº†ã€‚\nå·¥å…· # kubeadmï¼š\nä½¿ç”¨ kubeadm å¿«é€Ÿåˆ›å»º K8s é›†ç¾¤ï¼Œä¸€èˆ¬ä»…ç”¨äºå­¦ä¹ æµ‹è¯•ä½¿ç”¨ã€‚\nkubectlï¼š\nä½¿ç”¨ kubectl å‘½ä»¤å·¥å…·å¯¹ K8s ä¸‹è¾¾æ“ä½œæŒ‡ä»¤ï¼Œä¸€èˆ¬å°†è¿™ä¸ªå·¥å…·å®‰è£…åœ¨ Master èŠ‚ç‚¹ã€‚\nÂ« Kubernetes å®šåˆ¶å¼€å‘ 50ï¼šæ‰©å±•è°ƒåº¦å™¨\nÂ» kubeadm å®‰è£… Kubernetes (Docker)\n"},{"id":147,"href":"/kubernetes/kubeadm-install-k8s-docker/","title":"Kubeadm Install K8s Docker","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / kubeadm å®‰è£… Kubernetes (Docker)\nkubeadm å®‰è£… Kubernetes (Docker) # ä½¿ç”¨ kubeadm å®‰è£… k8s é›†ç¾¤ï¼Œæ˜¯ç¤¾åŒºæ¨èçš„å®‰è£…æ–¹å¼ï¼Œæœ¬æ–‡æ¡£å°†ä»‹ç»ä½¿ç”¨ kubeadm å®‰è£… k8s é›†ç¾¤ï¼ˆä½¿ç”¨ Docker ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼‰çš„è¯¦ç»†è¿‡ç¨‹ã€‚\nNotes:\néšç€ kubeadm \u0026amp; k8s ç‰ˆæœ¬çš„æ›´æ–°ï¼Œå®‰è£…è¿‡ç¨‹å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œæˆªè‡³ç›®å‰ï¼Œæœ¬æ–‡æ¡£ä½¿ç”¨çš„æ˜¯ kubeadm v1.28.3 \u0026amp; k8s v1.28.3 ç‰ˆæœ¬ï¼› æœ¬æ–‡æ¡£ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿæ˜¯ Ubuntu 22.04ï¼Œå…¶ä»–æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ è¦æ±‚ # è‡³å°‘ä¸€å°ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼ˆä¾‹å¦‚ï¼šUbuntu 22.04ï¼‰ä½œä¸ºé›†ç¾¤èŠ‚ç‚¹ï¼Œæœ€å°‘ 2 æ ¸ 2G å†…å­˜ï¼› å¤šèŠ‚ç‚¹ä¹‹å‰ç½‘ç»œäº’é€šï¼Œä¸”èŠ‚ç‚¹ä¸»æœºåä¸å†²çªï¼› Master èŠ‚ç‚¹éœ€è¦å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š6443ã€2379-2380ã€10250ã€10251ã€10252ï¼› å‡†å¤‡å·¥ä½œ # ç¦ç”¨äº¤æ¢åˆ†åŒºï¼š\n# ä¸´æ—¶ç¦ç”¨äº¤æ¢åˆ†åŒº sudo swapoff -a vim /etc/fstab # æ³¨é‡Šæ‰ swap åˆ†åŒºçš„é…ç½® é…ç½®ç³»ç»Ÿï¼š\ncat \u0026lt;\u0026lt;EOF | sudo tee /etc/modules-load.d/k8s.conf overlay br_netfilter EOF sudo modprobe overlay sudo modprobe br_netfilter # sysctl params required by setup, params persist across reboots cat \u0026lt;\u0026lt;EOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-iptables = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.ipv4.ip_forward = 1 EOF # Apply sysctl params without reboot sudo sysctl --system å®‰è£… Docker # è®¾ç½® Docker çš„ APT æºï¼š\n# Add Docker\u0026#39;s official GPG key: sudo apt-get update sudo apt-get install ca-certificates curl gnupg sudo install -m 0755 -d /etc/apt/keyrings curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg sudo chmod a+r /etc/apt/keyrings/docker.gpg # Add the repository to Apt sources: echo \\ \u0026#34;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\ $(. /etc/os-release \u0026amp;\u0026amp; echo \u0026#34;$VERSION_CODENAME\u0026#34;) stable\u0026#34; | \\ sudo tee /etc/apt/sources.list.d/docker.list \u0026gt; /dev/null sudo apt-get update å®‰è£… Dockerï¼š\nsudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin å®˜æ–¹æ–‡æ¡£ï¼š Docker å®‰è£…ã€‚\nå®‰è£… cri-dockerd # wget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.8/cri-dockerd-0.3.8.amd64.tgz tar -xzvf cri-dockerd-0.3.8.amd64.tgz sudo install -m 0755 -o root -g root -t /usr/local/bin cri-dockerd/cri-dockerd wget https://raw.githubusercontent.com/Mirantis/cri-dockerd/master/packaging/systemd/cri-docker.service wget https://raw.githubusercontent.com/Mirantis/cri-dockerd/master/packaging/systemd/cri-docker.socket sudo install cri-docker.service /etc/systemd/system sudo install cri-docker.socket /etc/systemd/system sudo sed -i -e \u0026#39;s,/usr/bin/cri-dockerd,/usr/local/bin/cri-dockerd,\u0026#39; /etc/systemd/system/cri-docker.service sudo systemctl daemon-reload sudo systemctl enable --now cri-docker.socket sudo systemctl start cri-docker.service ç¤¾åŒºæ–‡æ¡£ï¼š cri-dockerd å®‰è£…\nå®‰è£… kubeadmã€kubelet å’Œ kubectl # sudo apt-get update sudo apt-get install -y apt-transport-https ca-certificates curl curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg # å›½å†…ç½‘ç»œä½¿ç”¨ä¸‹é¢å‘½ä»¤æ›¿æ¢ # curl -fsSL https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - echo \u0026#39;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /\u0026#39; | sudo tee /etc/apt/sources.list.d/kubernetes.list # å›½å†…ç½‘ç»œä½¿ç”¨ä¸‹é¢å‘½ä»¤æ›¿æ¢ # cat \u0026lt;\u0026lt; EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list # deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main # EOF sudo apt-get update sudo apt-get install -y kubelet kubeadm kubectl sudo apt-mark hold kubelet kubeadm kubectl æ—©äº Debian 12 å’Œ Ubuntu 22.04 çš„ç‰ˆæœ¬ï¼Œ/etc/apt/keyrings ç›®å½•é»˜è®¤ä¸å­˜åœ¨ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼šsudo mkdir -m 755 /etc/apt/keyrings\né…ç½® cgroup-driver # # æŸ¥çœ‹ cgroup-driver docker info | grep \u0026#34;Cgroup Driver\u0026#34; é…ç½®ä½¿ç”¨ systemd ä½œä¸º cgroup-driverï¼š\nvim /etc/docker/daemon.json æ·»åŠ æˆ–ä¿®æ”¹é…ç½®é¡¹ï¼š\n{ ... \u0026#34;exec-opts\u0026#34;: [ \u0026#34;native.cgroupdriver=systemd\u0026#34; ] } é…ç½® kubelet ä½¿ç”¨ systemd ä½œä¸º cgroup-driverï¼ˆé¦–æ¬¡åˆ›å»ºé›†ç¾¤æ—¶ï¼Œè¯¥æ–‡ä»¶å¹¶æœªç”Ÿæˆï¼Œå¦‚æœé¦–æ¬¡é›†ç¾¤åˆ›å»ºå¤±è´¥ï¼Œé‚£ä¹ˆå¯èƒ½å·²ç»ç”Ÿæˆè¯¥æ–‡ä»¶äº†ï¼Œæ­¤æ—¶å¯ä»¥ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶çš„é…ç½®ï¼‰ï¼š\nvim /etc/systemd/system/kubelet.service.d/10-kubeadm.conf æ·»åŠ æˆ–ä¿®æ”¹é…ç½®é¡¹ï¼š\n... Environment=\u0026#34;KUBELET_EXTRA_ARGS=--cgroup-driver=systemd\u0026#34; ... å®‰è£…é›†ç¾¤ # å›½å†…ç½‘ç»œæå‰æ‹‰å– registry.k8s.io/pause:3.9 é•œåƒï¼š\ndocker pull registry.aliyuncs.com/google_containers/pause:3.9 docker tag registry.aliyuncs.com/google_containers/pause:3.9 registry.k8s.io/pause:3.9 ä½¿ç”¨ kubeadm init åˆå§‹åŒ–é›†ç¾¤ï¼š\nsudo kubeadm init \\ --pod-network-cidr 10.244.0.0/16 \\ --kubernetes-version 1.28.3 \\ --control-plane-endpoint=\u0026lt;EXTERNAL_IP\u0026gt;:6443 \\ --ignore-preflight-errors=Swap \\ --cri-socket=unix:///var/run/cri-dockerd.sock Notes:\néœ€è¦ç¡®ä¿ --control-plane-endpoint ç«¯ç‚¹åœ¨æ‰§è¡Œç¯å¢ƒæ˜¯å¯ä»¥è®¿é—®çš„ï¼Œå¦‚æœå‚æ•°å€¼ä¸ºæœåŠ¡å™¨çš„å…¬ç½‘ IPï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦å¯¹å®‰å…¨ç»„å¼€é€š 6443 ç«¯å£; å›½å†…ç½‘ç»œæ‹‰å–é•œåƒä½¿ç”¨ä»£ç†æ·»åŠ å‘½ä»¤å‚æ•°ï¼š--image-repository registry.aliyuncs.com/google_containersã€‚ åˆå§‹åŒ–å®Œæˆåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œé…ç½®é›†ç¾¤è®¿é—®ç¯å¢ƒï¼š\nmkdir -p ~/.kube sudo cp -i /etc/kubernetes/admin.conf ~/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€ï¼š\nkubectl get nodes å¦‚æœå…è®¸ Pod è°ƒåº¦åˆ° Master èŠ‚ç‚¹ï¼Œé‚£ä¹ˆéœ€è¦å»é™¤ Master èŠ‚ç‚¹çš„æ±¡ç‚¹ï¼š\nkubectl taint nodes --all node-role.kubernetes.io/control-plane- å®‰è£…ç½‘ç»œæ’ä»¶ # å®‰è£… flanenel ç½‘ç»œæ’ä»¶ï¼š\nkubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml flannel é»˜è®¤ä½¿ç”¨ CIDR ä¸º 10.244.0.0/16ï¼Œéœ€è¦ä¸ kubeadm init æ—¶æŒ‡å®šçš„ --pod-network-cidr å‚æ•°ä¸€è‡´ã€‚\nå®‰è£… metrics-server # kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œmetrics-server ç”±äºè¯ä¹¦é—®é¢˜æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œéœ€è¦ä¿®æ”¹ metrics-server çš„ Deployment é…ç½®ï¼Œæ·»åŠ  --kubelet-insecure-tls å‚æ•°ï¼š\nkubectl edit deployment metrics-server -n kube-system ... spec: ... template: ... spec: containers: - args: - --cert-dir=/tmp - --secure-port=4443 - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname - --kubelet-use-node-status-port - --metric-resolution=15s - --kubelet-insecure-tls éƒ¨ç½²åº”ç”¨ # kubectl create deployment nginx --image=nginx kubectl expose deployment nginx --name=nginx --port=80 --target-port=80 --type=NodePort å‚è€ƒ # Bootstrapping clusters with kubeadm Container Runtimes Â« ç®€å•ä»‹ç» K8s\nÂ» kubeadm å®‰è£… k8s (containerd)\n"},{"id":148,"href":"/kubernetes/kubeadm-install-k8s/","title":"Kubeadm Install K8s","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / kubeadm å®‰è£… k8s (containerd)\nkubeadm å®‰è£… k8s (containerd) # ä½¿ç”¨ kubeadm å®‰è£… k8s é›†ç¾¤ï¼Œæ˜¯ç¤¾åŒºæ¨èçš„å®‰è£…æ–¹å¼ï¼Œæœ¬æ–‡æ¡£å°†ä»‹ç»ä½¿ç”¨ kubeadm å®‰è£… k8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ã€‚\nNotes:\néšç€ kubeadm \u0026amp; k8s ç‰ˆæœ¬çš„æ›´æ–°ï¼Œå®‰è£…è¿‡ç¨‹å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œæˆªè‡³ç›®å‰ï¼Œæœ¬æ–‡æ¡£ä½¿ç”¨çš„æ˜¯ kubeadm v1.28.3 \u0026amp; k8s v1.28.3 ç‰ˆæœ¬ï¼› æœ¬æ–‡æ¡£ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿæ˜¯ Ubuntu 22.04ï¼Œå…¶ä»–æ“ä½œç³»ç»Ÿå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ è¦æ±‚ # è‡³å°‘ä¸€å°ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼ˆä¾‹å¦‚ï¼šUbuntu 22.04ï¼‰ä½œä¸ºé›†ç¾¤èŠ‚ç‚¹ï¼Œæœ€å°‘ 2 æ ¸ 2G å†…å­˜ï¼› å¤šèŠ‚ç‚¹ä¹‹å‰ç½‘ç»œäº’é€šï¼Œä¸”èŠ‚ç‚¹ä¸»æœºåä¸å†²çªï¼› Master èŠ‚ç‚¹éœ€è¦å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š6443ã€2379-2380ã€10250ã€10251ã€10252ï¼› å‡†å¤‡å·¥ä½œ # ç¦ç”¨äº¤æ¢åˆ†åŒºï¼š\n# ä¸´æ—¶ç¦ç”¨äº¤æ¢åˆ†åŒº swapoff -a vim /etc/fstab # æ³¨é‡Šæ‰ swap åˆ†åŒºçš„é…ç½® é…ç½®ç³»ç»Ÿï¼š\ncat \u0026lt;\u0026lt;EOF | sudo tee /etc/modules-load.d/k8s.conf overlay br_netfilter EOF modprobe overlay modprobe br_netfilter # sysctl params required by setup, params persist across reboots cat \u0026lt;\u0026lt;EOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-iptables = 1 net.bridge.bridge-nf-call-ip6tables = 1 net.ipv4.ip_forward = 1 EOF # Apply sysctl params without reboot sysctl --system å®‰è£… containerd # å‚ç…§ containerd å®‰è£…ã€‚\napt install jq -y export LATEST=$(curl -s https://api.github.com/repos/containerd/containerd/releases/latest | jq -r .tag_name) LATEST=${LATEST#v} wget https://github.com/containerd/containerd/releases/download/v$LATEST/containerd-$LATEST-linux-amd64.tar.gz tar Cxzvf /usr/local containerd-$LATEST-linux-amd64.tar.gz # systemd é…ç½® wget https://raw.githubusercontent.com/containerd/containerd/main/containerd.service -O /lib/systemd/system/containerd.service systemctl daemon-reload systemctl enable --now containerd.service systemctl restart containerd.service K8s V1.24 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œkubelet é»˜è®¤ä½¿ç”¨ systemd ä½œä¸º cgroup é©±åŠ¨ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ containerd cgroup é©±åŠ¨ä¸å…¶ä¿æŒä¸€è‡´ï¼š\n# å¦‚æœæ²¡æœ‰ /etc/containerd/config.toml æ–‡ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºç›®å½• mkdir -p /etc/containerd # ç”Ÿæˆ containerd é»˜è®¤é…ç½®æ–‡ä»¶ containerd config default | tee /etc/containerd/config.toml # ä¿®æ”¹é…ç½®æ–‡ä»¶ vim /etc/containerd/config.toml # æ‰¾åˆ° [plugins.\u0026#34;io.containerd.grpc.v1.cri\u0026#34;.containerd.runtimes.runc.options]ï¼Œæ‰¾åˆ°å¹¶ä¿®æ”¹é…ç½®é¡¹ SystemdCgroup ä¸º true SystemdCgroup = true # é‡å¯ containerd systemctl restart containerd å®‰è£… kubeadmã€kubelet å’Œ kubectl # apt update apt install -y apt-transport-https ca-certificates curl curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg # å›½å†…ç½‘ç»œä½¿ç”¨ä¸‹é¢å‘½ä»¤æ›¿æ¢ # curl -fsSL https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - echo \u0026#39;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /\u0026#39; | tee /etc/apt/sources.list.d/kubernetes.list # å›½å†…ç½‘ç»œä½¿ç”¨ä¸‹é¢å‘½ä»¤æ›¿æ¢ # cat \u0026lt;\u0026lt; EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list # deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main # EOF apt update apt install -y kubelet kubeadm kubectl apt-mark hold kubelet kubeadm kubectl æ—©äº Debian 12 å’Œ Ubuntu 22.04 çš„ç‰ˆæœ¬ï¼Œ/etc/apt/keyrings ç›®å½•é»˜è®¤ä¸å­˜åœ¨ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼šsudo mkdir -m 755 /etc/apt/keyrings\nå®‰è£…é›†ç¾¤ # å›½å†…ç½‘ç»œæå‰æ‹‰å– registry.k8s.io/pause:3.9 é•œåƒï¼š\ndocker pull registry.aliyuncs.com/google_containers/pause:3.9 docker tag registry.aliyuncs.com/google_containers/pause:3.9 registry.k8s.io/pause:3.9 ä½¿ç”¨ kubeadm init åˆå§‹åŒ–é›†ç¾¤ï¼š\nsudo kubeadm init \\ --pod-network-cidr 10.244.0.0/16 \\ --kubernetes-version 1.29.0 \\ --control-plane-endpoint=\u0026lt;EXTERNAL_IP\u0026gt;:6443 \\ --ignore-preflight-errors=Swap Notes:\néœ€è¦ç¡®ä¿ --control-plane-endpoint ç«¯ç‚¹åœ¨æ‰§è¡Œç¯å¢ƒæ˜¯å¯ä»¥è®¿é—®çš„ï¼Œå¦‚æœå‚æ•°å€¼ä¸ºæœåŠ¡å™¨çš„å…¬ç½‘ IPï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦å¯¹å®‰å…¨ç»„å¼€é€š 6443 ç«¯å£; å›½å†…ç½‘ç»œæ‹‰å–é•œåƒä½¿ç”¨ä»£ç†æ·»åŠ å‘½ä»¤å‚æ•°ï¼š--image-repository registry.aliyuncs.com/google_containersã€‚ åˆå§‹åŒ–å®Œæˆåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œé…ç½®é›†ç¾¤è®¿é—®ç¯å¢ƒï¼š\nmkdir -p ~/.kube cp -i /etc/kubernetes/admin.conf ~/.kube/config chown $(id -u):$(id -g) $HOME/.kube/config æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€ï¼š\nkubectl get nodes å¦‚æœå…è®¸ Pod è°ƒåº¦åˆ° Master èŠ‚ç‚¹ï¼Œé‚£ä¹ˆéœ€è¦å»é™¤ Master èŠ‚ç‚¹çš„æ±¡ç‚¹ï¼š\nkubectl taint nodes --all node-role.kubernetes.io/control-plane- é›†ç¾¤ VIP # ä½¿ç”¨ kube-vip ä¸ºé›†ç¾¤ api-server é…ç½®è´Ÿè½½å‡è¡¡ã€‚\n# VIPï¼Œä¸é›†ç¾¤masterèŠ‚ç‚¹å¤„äºåŒä¸€ç½‘æ®µï¼Œå¹¶ä¸”æ²¡æœ‰è¢«å ç”¨ export VIP=172.16.246.147 # å¯ä»¥é€šè¿‡ ip addr æŸ¥çœ‹ export INTERFACE=ens160 KVVERSION=$(curl -sL https://api.github.com/repos/kube-vip/kube-vip/releases | jq -r \u0026#34;.[0].name\u0026#34;) alias kube-vip=\u0026#34;ctr image pull ghcr.io/kube-vip/kube-vip:$KVVERSION; ctr run --rm --net-host ghcr.io/kube-vip/kube-vip:$KVVERSION vip /kube-vip\u0026#34; # å®‰è£… runc apt install runc -y kube-vip manifest pod \\ --interface $INTERFACE \\ --address $VIP \\ --controlplane \\ --services \\ --arp \\ --leaderElection | tee /etc/kubernetes/manifests/kube-vip.yaml æ‰§è¡Œå®Œæˆåï¼Œå°†åœ¨ /etc/kubernetes/manifests/kube-vip.yaml ç›®å½•ä¸‹ç”Ÿæˆéƒ¨ç½²æ¸…å•æ–‡ä»¶ï¼Œå°†è¯¥æ–‡ä»¶åŒæ­¥åˆ°å…¶ä»– master èŠ‚ç‚¹å³å¯ã€‚\nä½¿ç”¨ vip ä½œä¸º control-plane-endpointï¼Œå¹¶ä¸”ä½¿ç”¨éœ€è¦é¢å¤–çš„ \u0026ndash;upload-certs å‚æ•°ï¼š\nkubeadm init \\ --pod-network-cidr 10.244.0.0/16 \\ --control-plane-endpoint=$VIP:6443 \\ --upload-certs å®‰è£…ç½‘ç»œæ’ä»¶ # å®‰è£… flannel ç½‘ç»œæ’ä»¶ï¼š\nkubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml flannel é»˜è®¤ä½¿ç”¨ CIDR ä¸º 10.244.0.0/16ï¼Œéœ€è¦ä¸ kubeadm init æ—¶æŒ‡å®šçš„ --pod-network-cidr å‚æ•°ä¸€è‡´ã€‚\nå®‰è£… metrics-server # kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œmetrics-server ç”±äºè¯ä¹¦é—®é¢˜æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œéœ€è¦ä¿®æ”¹ metrics-server çš„ Deployment é…ç½®ï¼Œæ·»åŠ  --kubelet-insecure-tls å‚æ•°ï¼š\nkubectl edit deployment metrics-server -n kube-system ... spec: ... template: ... spec: containers: - args: - --cert-dir=/tmp - --secure-port=4443 - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname - --kubelet-use-node-status-port - --metric-resolution=15s - --kubelet-insecure-tls éƒ¨ç½²åº”ç”¨ # kubectl create deployment nginx --image=nginx kubectl expose deployment nginx --name=nginx --port=80 --target-port=80 --type=NodePort å‚è€ƒ # Bootstrapping clusters with kubeadm Container Runtimes Â« kubeadm å®‰è£… Kubernetes (Docker)\nÂ» Kubeadm å‡çº§ K8s\n"},{"id":149,"href":"/kubernetes/kubeadm-upgrade/","title":"Kubeadm Upgrade","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubeadm å‡çº§ K8s\nKubeadm å‡çº§ K8s # æœ¬ç¯‡ä»¥å‡çº§ 1.29.0ï¼ˆæ—§ç‰ˆæœ¬ï¼š1.28.x ï¼‰ ç‰ˆæœ¬ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•é€šè¿‡ kubeadm å·¥å…·æ¥å‡çº§ K8s é›†ç¾¤ã€‚\næ³¨æ„ï¼š\nä¸æ”¯æŒè·¨ä¸»ç‰ˆæœ¬å‡çº§ï¼Œå¦‚ 1.27.x å‡çº§åˆ° 1.29.xï¼Œä¸­é—´å¿…é¡»å…ˆå‡çº§åˆ° 1.28.x ä¸»ç‰ˆæœ¬æ›´æ–°å¿…é¡»å…ˆå‡çº§åˆ°æœ€æ–°çš„æ¬¡ç‰ˆæœ¬ï¼Œå¦‚ 1.28.3 å‡çº§åˆ° 1.28.4ï¼Œç„¶åå†å‡çº§åˆ° 1.29.x å‡çº§æ­¥éª¤ # æ§åˆ¶èŠ‚ç‚¹ï¼ˆcontrol plane nodeï¼‰å‡çº§ å·¥ä½œèŠ‚ç‚¹ï¼ˆworker nodeï¼‰å‡çº§ å‡çº§è¿‡ç¨‹ # 1ã€å‡çº§è‡³å½“å‰ä¸»ç‰ˆæœ¬çš„æœ€æ–°æ¬¡ç‰ˆæœ¬ # sudo apt update sudo apt-cache madison kubeadm ä»¥ä¸Šå‘½ä»¤åï¼Œå°†å¯ä»¥å¾—åˆ°ç±»ä¼¼å¦‚ä¸‹è¾“å‡ºï¼š\n$ sudo apt-cache madison kubeadm kubeadm | 1.28.4-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb Packages kubeadm | 1.28.3-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb Packages kubeadm | 1.28.2-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb Packages kubeadm | 1.28.1-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb Packages kubeadm | 1.28.0-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb Packages ç¡®å®šå½“å‰ä¸»ç‰ˆæœ¬çš„æœ€æ–°æ¬¡ç‰ˆæœ¬ä¸º 1.28.4-1.1ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆæ§åˆ¶èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼‰ï¼š\nexport VERSION=1.28.4-1.1 sudo apt-mark unhold kubeadm \u0026amp;\u0026amp; \\ sudo apt-get update \u0026amp;\u0026amp; sudo apt-get install -y kubeadm=$VERSION \u0026amp;\u0026amp; \\ sudo apt-mark hold kubeadm sudo kubeadm version sudo kubeadm upgrade plan sudo kubeadm upgrade apply v$(echo $VERSION | cut -d\u0026#39;-\u0026#39; -f1) å…¶ä»–èŠ‚ç‚¹å‡çº§ï¼Œæœ€åä¸€æ­¥æ‰§è¡Œ sudo kubeadm upgrade node å‘½ä»¤ã€‚\nå‡çº§ kubectlã€kubeletï¼š\nå¦‚æœé›†ç¾¤åŒ…æ‹¬å¤šä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨å‡çº§å•ä¸ªèŠ‚ç‚¹ä¸Šçš„ kubelet æœåŠ¡å‰ï¼Œæœ€å¥½å…ˆå°†å½“å‰èŠ‚ç‚¹ç½®ä¸ºä¸å¯è°ƒåº¦çŠ¶æ€ï¼Œå¹¶ä¸”å°†å…¶ä¸Šçš„ Pod é©±é€åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚\nkubectl drain [current-node] --ignore-daemonsets ç­‰å¾…å½“å‰èŠ‚ç‚¹ä¸Šçš„ Pod é©±é€å®Œæˆåï¼Œå†å‡çº§ kubelet æœåŠ¡ã€‚å‡çº§å®Œæˆåï¼Œå†å°†å½“å‰èŠ‚ç‚¹ç½®ä¸ºå¯è°ƒåº¦çŠ¶æ€ã€‚\nkubectl uncordon [current-node] æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œå‡çº§ kubectlã€kubelet ç»„ä»¶ï¼š\nsudo apt-mark unhold kubelet kubectl \u0026amp;\u0026amp; \\ sudo apt-get update \u0026amp;\u0026amp; sudo apt-get install -y kubelet=$VERSION kubectl=$VERSION \u0026amp;\u0026amp; \\ sudo apt-mark hold kubelet kubectl # é‡å¯ kubelet æœåŠ¡ sudo systemctl daemon-reload sudo systemctl restart kubelet.service 2ã€å‡çº§è‡³ä¸‹ä¸€ä¸ªä¸»ç‰ˆæœ¬ # ä¿®æ”¹ /etc/apt/sources.list.d/kubernetes.list æ–‡ä»¶ï¼Œå°† 1.28 æ”¹ä¸º 1.29ï¼š\nsudo sed -i \u0026#39;s/1.28/1.29/g\u0026#39; /etc/apt/sources.list.d/kubernetes.list ç„¶åå‚ç…§ä¸Šé¢çš„æ­¥éª¤ï¼Œå‡çº§é›†ç¾¤åˆ°ä¸‹ä¸€ä¸ªä¸»ç‰ˆæœ¬ v1.29.xã€‚\nå‚è€ƒ # Upgrading kubeadm clusters Â« kubeadm å®‰è£… k8s (containerd)\nÂ» kubebuilder å®æˆ˜\n"},{"id":150,"href":"/kubernetes/kubebuilder-inaction/","title":"Kubebuilder Inaction","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / kubebuilder å®æˆ˜\nkubebuilder å®æˆ˜ # ç®€ä»‹ # kubebuilder æ˜¯ä¸€ä¸ªæ„å»º Operatorï¼ˆCRD + Controllerï¼‰çš„æ¡†æ¶çš„å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„æ„å»ºä¸€ä¸ª Operator é¡¹ç›®ï¼Œå¹¶æä¾›äº†ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ï¼Œä¾‹å¦‚ï¼šåˆ›å»º APIã€åˆ›å»º Controllerã€Webhook ç­‰ã€‚\nå®‰è£… # æ¡ä»¶ # kustomize curl -s \u0026#34;https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh\u0026#34; | bash controller-gen go install sigs.k8s.io/controller-tools/cmd/controller-gen@latest âš ï¸ æ³¨æ„ï¼šä»¥ä¸Šå‘½ä»¤éƒ½æ˜¯ç›´æ¥ä¸‹è½½äº†å¯¹åº”å‘½ä»¤å·¥å…·æœ€æ–°çš„ç‰ˆæœ¬ï¼Œåœ¨ä½¿ç”¨ kubebuilder åˆ›å»ºé¡¹ç›®ä¹‹åï¼Œåœ¨ Makefile æ–‡ä»¶ä¸­ä¼šæŒ‡å®š kustomize å’Œ controller-gen çš„ç‰ˆæœ¬ï¼Œä¸ºäº†é¿å…ä¸å…¼å®¹ï¼Œæ¨èä¸‹è½½å¯¹åº”æŒ‡å®šçš„ç‰ˆæœ¬ã€‚\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… kubebuilderï¼š\n# download kubebuilder and install locally. GOOS=$(go env GOOS) GOARCH=$(go env GOARCH) curl -L -o kubebuilder https://go.kubebuilder.io/dl/latest/$GOOS/$GOARCH chmod +x kubebuilder \u0026amp;\u0026amp; mv kubebuilder /usr/local/bin/ ä»£ç è‡ªåŠ¨è¡¥å…¨ï¼š\nsource \u0026lt;(kubebuilder completion bash) source \u0026lt;(kubebuilder completion zsh) # zsh echo \u0026#34;source \u0026lt;(kubebuilder completion zsh)\u0026#34; \u0026gt;\u0026gt; ~/.zshrc # bash echo \u0026#34;source \u0026lt;(kubebuilder completion bash)\u0026#34; \u0026gt;\u0026gt; ~/.bashrc åˆ›å»ºé¡¹ç›® # mkdir ./kube-acme \u0026amp;\u0026amp; cd ./kube-acme kubebuilder init --domain ketches.cn --repo github.com/ketches/kube-acme # å¦‚æœä¸å¼€å¯å¤š Group æ¨¡å¼ï¼Œç”Ÿæˆçš„ API æ–‡ä»¶è·¯å¾„ä¸ºï¼šapi/{version} # å¼€å¯å¤š Group æ¨¡å¼ï¼Œç”Ÿæˆ API çš„æ–‡ä»¶è·¯å¾„ä¸º apis/{grouop}/{version} kubebuilder edit --multigroup åˆ›å»ºé¡¹ç›®åï¼Œä¼šåœ¨ç›®å½•ä¸­ç”Ÿæˆ hack/boilerplate.go.txt æ–‡ä»¶ï¼Œç”¨äºkubebuilder ç”Ÿæˆ go æ–‡ä»¶çš„ç‰ˆæƒä¿¡æ¯ï¼Œå»ºè®®åœ¨å¼€å§‹ç¼–å†™ä»£ç ä¹‹å‰ä¿®æ”¹è¯¥æ–‡ä»¶ï¼Œä¾‹å¦‚ä½œè€…ä¿¡æ¯ã€‚\nåˆ›å»º API # kubebuilder create api --group acme --version v1alpha1 --kind DNSProvider # è¿ç»­è¾“å…¥ y ç¡®è®¤ç”Ÿæˆ API ä»¥åŠ Controller æ–‡ä»¶ åœ¨é›†ç¾¤ä¸­éƒ¨ç½² # å°†æ§åˆ¶å™¨ç¼–è¯‘æˆé•œåƒå¹¶æ¨é€åˆ°é•œåƒä»“åº“ï¼š\nmake docker-build docker-push IMG=ketches/kube-acme:v0.0.1 å°†æ§åˆ¶å™¨éƒ¨ç½²åˆ°é›†ç¾¤ä¸­ï¼š\nmake deploy IMG=ketches/kube-acme:v0.0.1 å¸è½½ CRD # ä»é›†ç¾¤ä¸­åˆ é™¤CRDï¼š\nmake uninstall å¸è½½æ§åˆ¶å™¨ # ä»é›†ç¾¤ä¸­å¸è½½æ§åˆ¶å™¨ï¼š\nmake undeploy Â« Kubeadm å‡çº§ K8s\nÂ» kubectl\n"},{"id":151,"href":"/kubernetes/kubectl/","title":"Kubectl","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / kubectl\nkubectl # å®‰è£… # å‚è€ƒæ–‡æ¡£ï¼š kubectl å®‰è£…æ–‡æ¡£\nå¸¸ç”¨å‘½ä»¤ # è‡ªåŠ¨è¡¥å…¨ # source \u0026lt;(kubectl completion bash) å¯ä»¥å°†ä¸Šé¢çš„å‘½ä»¤å†™å…¥ ~/.bashrc æˆ– /etc/bash.bashrc ä¸­ï¼Œè¿™æ ·æ¯æ¬¡ç™»å½•éƒ½ä¼šè‡ªåŠ¨è¡¥å…¨ã€‚\n$ vim ~/.bashrc ... source \u0026lt;(kubectl completion bash) å‘½ä»¤åˆ«å # alias k=kubectl complete -F __start_kubectl k Troubleshooting # Q1. _get_comp_words_by_ref: command not found # è§£å†³æ–¹æ³•ï¼š\napt install bash-completion -y source /usr/share/bash-completion/bash_completion source \u0026lt;(kubectl completion bash) Â« kubebuilder å®æˆ˜\nÂ» Kubernetes 0-1 Kubernetesæœ€ä½³å®è·µ\n"},{"id":152,"href":"/kubernetes/kubernetes-best-practice/","title":"Kubernetes Best Practice","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 Kubernetesæœ€ä½³å®è·µ\nKubernetes 0-1 Kubernetesæœ€ä½³å®è·µ # https://github.com/learnk8s/kubernetes-production-best-practices\nÂ« kubectl\nÂ» Kubernetes Dashboard\n"},{"id":153,"href":"/kubernetes/kubernetes-dashboard/","title":"Kubernetes Dashboard","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes Dashboard\nKubernetes Dashboard # Installation # Steps # ç™»å…¥Kubernetes Masteræœºå™¨ã€‚\nCopyæœ€æ–°çš„recommended.yamlæ–‡ä»¶å†…å®¹ï¼Œå†™å…¥æœ¬åœ°kubernetes-dashboard.yamlæ–‡ä»¶ã€‚recommended.yamlæ–‡ä»¶åœ°å€ï¼š kubernetes dashboard github\n![image-20191223173827866](\nC:\\Users\\dp\\AppData\\Roaming\\Typora\\typora-user-images\\image-20191223173827866.png)\n# Copyright 2017 The Kubernetes Authors. # # Licensed under the Apache License, Version 2.0 (the \u0026#34;License\u0026#34;); # you may not use this file except in compliance with the License. # You may obtain a copy of the License at # # http://www.apache.org/licenses/LICENSE-2.0 # # Unless required by applicable law or agreed to in writing, software # distributed under the License is distributed on an \u0026#34;AS IS\u0026#34; BASIS, # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. # See the License for the specific language governing permissions and # limitations under the License. apiVersion: v1 kind: Namespace metadata: name: kubernetes-dashboard --- apiVersion: v1 kind: ServiceAccount metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard namespace: kubernetes-dashboard --- kind: Service apiVersion: v1 metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard namespace: kubernetes-dashboard spec: # æ–°å¢type: NodePortä»¥åŠnodePort: 32100 #type: NodePort #ports: #- port: 443 #targetPort: 8443 #nodePort: 32100 #selector: #k8s-app: kubernetes-dashboard # æˆ–è€…æ–°å¢type: LoadBalancer type: LoadBalancer ports: - port: 443 targetPort: 8443 selector: k8s-app: kubernetes-dashboard --- # æ³¨é‡Šæ‰è¿™æ®µ #apiVersion: v1 #kind: Secret #metadata: # labels: # k8s-app: kubernetes-dashboard # name: kubernetes-dashboard-certs # namespace: kubernetes-dashboard #type: Opaque --- apiVersion: v1 kind: Secret metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard-csrf namespace: kubernetes-dashboard type: Opaque data: csrf: \u0026#34;\u0026#34; --- apiVersion: v1 kind: Secret metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard-key-holder namespace: kubernetes-dashboard type: Opaque --- kind: ConfigMap apiVersion: v1 metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard-settings namespace: kubernetes-dashboard --- kind: Role apiVersion: rbac.authorization.k8s.io/v1 metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard namespace: kubernetes-dashboard rules: # Allow Dashboard to get, update and delete Dashboard exclusive secrets. - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;secrets\u0026#34;] resourceNames: [\u0026#34;kubernetes-dashboard-key-holder\u0026#34;, \u0026#34;kubernetes-dashboard-certs\u0026#34;, \u0026#34;kubernetes-dashboard-csrf\u0026#34;] verbs: [\u0026#34;get\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;delete\u0026#34;] # Allow Dashboard to get and update \u0026#39;kubernetes-dashboard-settings\u0026#39; config map. - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;configmaps\u0026#34;] resourceNames: [\u0026#34;kubernetes-dashboard-settings\u0026#34;] verbs: [\u0026#34;get\u0026#34;, \u0026#34;update\u0026#34;] # Allow Dashboard to get metrics. - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;services\u0026#34;] resourceNames: [\u0026#34;heapster\u0026#34;, \u0026#34;dashboard-metrics-scraper\u0026#34;] verbs: [\u0026#34;proxy\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;services/proxy\u0026#34;] resourceNames: [\u0026#34;heapster\u0026#34;, \u0026#34;http:heapster:\u0026#34;, \u0026#34;https:heapster:\u0026#34;, \u0026#34;dashboard-metrics-scraper\u0026#34;, \u0026#34;http:dashboard-metrics-scraper\u0026#34;] verbs: [\u0026#34;get\u0026#34;] --- kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1 metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard rules: # Allow Metrics Scraper to get metrics from the Metrics server - apiGroups: [\u0026#34;metrics.k8s.io\u0026#34;] resources: [\u0026#34;pods\u0026#34;, \u0026#34;nodes\u0026#34;] verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;] --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard namespace: kubernetes-dashboard roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: kubernetes-dashboard subjects: - kind: ServiceAccount name: kubernetes-dashboard namespace: kubernetes-dashboard --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: kubernetes-dashboard roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: kubernetes-dashboard subjects: - kind: ServiceAccount name: kubernetes-dashboard namespace: kubernetes-dashboard --- kind: Deployment apiVersion: apps/v1 metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard namespace: kubernetes-dashboard spec: replicas: 1 revisionHistoryLimit: 10 selector: matchLabels: k8s-app: kubernetes-dashboard template: metadata: labels: k8s-app: kubernetes-dashboard spec: containers: - name: kubernetes-dashboard image: kubernetesui/dashboard:v2.0.0-beta8 imagePullPolicy: Always ports: - containerPort: 8443 protocol: TCP args: - --auto-generate-certificates - --namespace=kubernetes-dashboard # Uncomment the following line to manually specify Kubernetes API server Host # If not specified, Dashboard will attempt to auto discover the API server and connect # to it. Uncomment only if the default does not work. # - --apiserver-host=http://my-address:port volumeMounts: - name: kubernetes-dashboard-certs mountPath: /certs # Create on-disk volume to store exec logs - mountPath: /tmp name: tmp-volume livenessProbe: httpGet: scheme: HTTPS path: / port: 8443 initialDelaySeconds: 30 timeoutSeconds: 30 securityContext: allowPrivilegeEscalation: false readOnlyRootFilesystem: true runAsUser: 1001 runAsGroup: 2001 volumes: - name: kubernetes-dashboard-certs secret: secretName: kubernetes-dashboard-certs - name: tmp-volume emptyDir: {} serviceAccountName: kubernetes-dashboard nodeSelector: \u0026#34;beta.kubernetes.io/os\u0026#34;: linux # Comment the following tolerations if Dashboard must not be deployed on master tolerations: - key: node-role.kubernetes.io/master effect: NoSchedule --- kind: Service apiVersion: v1 metadata: labels: k8s-app: dashboard-metrics-scraper name: dashboard-metrics-scraper namespace: kubernetes-dashboard spec: ports: - port: 8000 targetPort: 8000 selector: k8s-app: dashboard-metrics-scraper --- kind: Deployment apiVersion: apps/v1 metadata: labels: k8s-app: dashboard-metrics-scraper name: dashboard-metrics-scraper namespace: kubernetes-dashboard spec: replicas: 1 revisionHistoryLimit: 10 selector: matchLabels: k8s-app: dashboard-metrics-scraper template: metadata: labels: k8s-app: dashboard-metrics-scraper annotations: seccomp.security.alpha.kubernetes.io/pod: \u0026#39;runtime/default\u0026#39; spec: containers: - name: dashboard-metrics-scraper image: kubernetesui/metrics-scraper:v1.0.1 ports: - containerPort: 8000 protocol: TCP livenessProbe: httpGet: scheme: HTTP path: / port: 8000 initialDelaySeconds: 30 timeoutSeconds: 30 volumeMounts: - mountPath: /tmp name: tmp-volume securityContext: allowPrivilegeEscalation: false readOnlyRootFilesystem: true runAsUser: 1001 runAsGroup: 2001 serviceAccountName: kubernetes-dashboard nodeSelector: \u0026#34;beta.kubernetes.io/os\u0026#34;: linux # Comment the following tolerations if Dashboard must not be deployed on master tolerations: - key: node-role.kubernetes.io/master effect: NoSchedule volumes: - name: tmp-volume emptyDir: {} æ³¨æ„ï¼šï¼š\néœ€è¦æ³¨é‡Šæ‰ä¸€æ®µï¼Œå› ä¸ºä¸æ³¨é‡Šæ‰çš„è¯ï¼Œå­˜åœ¨è¯ä¹¦è¿‡æœŸé—®é¢˜ï¼Œchromeã€safariä¸»æµæµè§ˆå™¨å°†æ— æ³•è®¿é—®ï¼Œå¥½åƒfirefoxå¯ä»¥ï¼›\nkubernetes dashboard serviceçš„typeå®šä¹‰ä¸ºNodePortï¼Œå¹¶æŒ‡å®šä¸€ä¸ªèŠ‚ç‚¹ç«¯å£32100ï¼›\nç”Ÿæˆè‡ªç­¾è¯ä¹¦è¯·æ±‚çš„keyï¼š openssl genrsa -out dashboard.key 2048 ç”Ÿæˆè‡ªç­¾è¯ä¹¦è¯·æ±‚ï¼š openssl req -new -out dashboard.csr -key dashboard.key -subj \u0026#39;/CN=\u0026lt;k8s master ip or domain name\u0026gt;\u0026#39; ç”Ÿæˆè‡ªç­¾è¯ä¹¦ # ä¸è®¾ç½®-daysï¼Œåˆ™é»˜è®¤365å¤©è¿‡æœŸ openssl x509 -days 3650 -req -in dashboard.csr -signkey dashboard.key -out dashboard.crt éƒ¨ç½²kubernetes dashboard kubectl apply -f kubernetes-dashboard.yaml ç”±äºkubernetes-dashboard.yamlæˆ‘ä»¬æ³¨é‡Šæ‰äº†kubernetes-dashboard-certsï¼Œpodè·‘ä¸èµ·æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºcerts kubectl create secret generic kubernetes-dashboard-certs --from-file=dashboard.key --from-file=dashboard.crt -n kubernetes-dashboard åˆ›å»ºè®¿é—®ç”¨æˆ·ï¼Œç”¨äºè®¿é—®kubernetes-dashboardï¼Œä»¥ä¸‹æ–‡æœ¬å†…å®¹å†™å…¥æœ¬åœ°admin-user.yamlæ–‡ä»¶ apiVersion: v1 kind: ServiceAccount metadata: name: admin-user namespace: kubernetes-dashboard --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: admin-user roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - kind: ServiceAccount name: admin-user namespace: kubernetes-dashboard kubectl apply -f admin-user.yaml è·å–ç™»å½•å¯†é’¥ kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk \u0026#39;{print $1}\u0026#39;) â€‹ ä¸Šé¢å‘½ä»¤è¾“å‡ºï¼Œæ‹¿åˆ°tokençš„å€¼\nIngressè½¬å‘ apiVersion: extensions/v1beta1 kind: Ingress metadata: name: kubedash namespace: kubernetes-dashboard spec: rules: - host: kubedash.example.tech http: paths: - path: / backend: serviceName: kubernetes-dashboard servicePort: 32100 è®¿é—® https://xxxx:32100 ï¼Œæ³¨æ„è¿™é‡Œä¸€å®šè¦ç”¨https é€‰æ‹©Tokenè®¿é—®ï¼Œè¾“å…¥tokenå³å¯ã€‚ References # https://www.cnblogs.com/life-of-coding/p/11794993.html https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/#deploying-the-dashboard-ui Â« Kubernetes 0-1 Kubernetesæœ€ä½³å®è·µ\nÂ» Kubernetes ä¸­èµ„æºåç§°è§„èŒƒ\n"},{"id":154,"href":"/kubernetes/kubernetes-naming-constraints/","title":"Kubernetes Naming Constraints","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes ä¸­èµ„æºåç§°è§„èŒƒ\nKubernetes ä¸­èµ„æºåç§°è§„èŒƒ # åœ¨Kubernetesä¸­ï¼ŒåŒä¸€ç§èµ„æºï¼ˆGVRï¼‰åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ä¸‹åç§°æ˜¯å”¯ä¸€ã€‚ä½†æ˜¯åç§°ä¹Ÿéœ€è¦éµå¾ªå‘½åè§„åˆ™ã€‚æœ¬ç¯‡ä¸»è¦ä»‹ç» Kubernetes ä¸­ä¸‰ç§èµ„æºåç§°çš„å‘½åè§„èŒƒã€‚\nDNS1123Subdomain # ä¸èƒ½è¶…è¿‡ 253 ä¸ªå­—ç¬¦ åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ï¼Œä»¥åŠ \u0026lsquo;-\u0026rsquo; å’Œ \u0026lsquo;.\u0026rsquo; å¿…é¡»ä»¥å­—æ¯æ•°å­—å¼€å¤´ å¿…é¡»ä»¥å­—æ¯æ•°å­—ç»“å°¾ ä»¥æ­¤è§„èŒƒçº¦æŸçš„èµ„æºæœ‰ï¼š\nIngress Pod ConfigMap NetworkPolicy DNS1123Label # æœ€å¤š 63 ä¸ªå­—ç¬¦ åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ï¼Œä»¥åŠ \u0026lsquo;-\u0026rsquo; å¿…é¡»ä»¥å­—æ¯æ•°å­—å¼€å¤´ å¿…é¡»ä»¥å­—æ¯æ•°å­—ç»“å°¾ ä»¥æ­¤è§„èŒƒçº¦æŸçš„èµ„æºæœ‰ï¼š\nNamespace Service DNS1035Label # æœ€å¤š 63 ä¸ªå­—ç¬¦ åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ï¼Œä»¥åŠ \u0026lsquo;-\u0026rsquo; å¿…é¡»ä»¥å­—æ¯å¼€å¤´ å¿…é¡»ä»¥å­—æ¯æ•°å­—ç»“å°¾ ä»¥æ­¤è§„èŒƒçº¦æŸçš„èµ„æºæœ‰ï¼š\nDeployment StatefulSet å»ºè®® # å¦‚æœèµ„æºå‘½åç¬¦åˆ DNS1035Label è§„èŒƒï¼Œé‚£ä¹ˆä¸€å®šç¬¦åˆ Kubernetes èµ„æºå‘½åè§„èŒƒã€‚å‡å¦‚åœ¨å®¹å™¨å¹³å°å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†å‘½åçº¦æŸæ›´åŠ ç»Ÿä¸€ï¼Œå»ºè®®ä½¿ç”¨ DNS1035Label è§„èŒƒæ¥çº¦æŸèµ„æºå‘½åã€‚\nå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼ˆGoï¼‰æ¥æ£€æŸ¥èµ„æºåç§°æ˜¯å¦ç¬¦åˆè§„èŒƒï¼š\nå¼•å…¥åŒ…ï¼š\ngo get k8s.io/apimachinery/pkg/util/validation ç¤ºä¾‹ä»£ç ï¼š\npackage main import ( \u0026#34;k8s.io/apimachinery/pkg/util/validation\u0026#34; ) func main() { namespace: = \u0026#34;test-ns\u0026#34; if msgs := validation.IsDNS1123Subdomain(namespace); len(msgs) \u0026gt; 0 { fmt.Println(\u0026#34;namespace name is not valid\u0026#34;) } } Â« Kubernetes Dashboard\nÂ» Kuberentes\n"},{"id":155,"href":"/kubernetes/kubernetes/","title":"Kubernetes","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kuberentes\nKuberentes # Â« Kubernetes ä¸­èµ„æºåç§°è§„èŒƒ\nÂ» KubeVirt åˆ›å»º Windows è™šæ‹Ÿæœº\n"},{"id":156,"href":"/kubernetes/kubevirt-create-windows-vm/","title":"Kubevirt Create Windows Vm","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / KubeVirt åˆ›å»º Windows è™šæ‹Ÿæœº\nKubeVirt åˆ›å»º Windows è™šæ‹Ÿæœº # virtctl image-upload --image-path windows-10.iso --pvc-name=windows-10-iso --size 10G --uploadproxy-url https://\u0026lt;cdi-uploadproxy.cdi.svc\u0026gt; --insecure --wait-secs 240 apiVersion: v1 kind: PersistentVolumeClaim metadata: name: windows-10-data spec: accessModes: - ReadWriteOnce resources: requests: storage: 40G storageClassName: longhorn volumeMode: Filesystem --- apiVersion: kubevirt.io/v1 kind: VirtualMachine metadata: name: windows-10 spec: running: true template: metadata: labels: kubevirt.io/domain: windows-10 spec: domain: cpu: cores: 4 devices: networkInterfaceMultiqueue: true #å¼€å¯ç½‘å¡å¤šé˜Ÿåˆ—æ¨¡å¼ blockMultiQueue: true #å¼€å¯ç£ç›˜å¤šé˜Ÿåˆ—æ¨¡å¼ disks: - cdrom: bus: sata name: virtiocontainerdisk - cdrom: bus: sata name: cdromiso bootOrder: 1 - disk: bus: virtio name: harddrive bootOrder: 2 interfaces: - masquerade: {} model: virtio name: default resources: requests: memory: 8G networks: - name: default pod: {} volumes: - name: cdromiso persistentVolumeClaim: claimName: windows-10-iso - name: harddrive persistentVolumeClaim: claimName: windows-10-data - containerDisk: image: kubevirt/virtio-container-disk name: virtiocontainerdisk Â« Kuberentes\nÂ» Kubevirt å®è·µ\n"},{"id":157,"href":"/kubernetes/kubevirt-practice/","title":"Kubevirt Practice","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubevirt å®è·µ\nKubevirt å®è·µ # ç®€ä»‹ # Kubevirt æ˜¯ Redhat å¼€æºçš„ä»¥å®¹å™¨æ–¹å¼è¿è¡Œè™šæ‹Ÿæœºçš„é¡¹ç›®ï¼Œä»¥ k8s add-on æ–¹å¼ï¼Œåˆ©ç”¨ k8s CRD ä¸ºå¢åŠ èµ„æºç±»å‹ VirtualMachineInstanceï¼ˆVMIï¼‰ï¼Œ ä½¿ç”¨å®¹å™¨çš„ image registry å»åˆ›å»ºè™šæ‹Ÿæœºå¹¶æä¾› VM ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ CRD çš„æ–¹å¼ä½¿å¾— kubevirt å¯¹è™šæ‹Ÿæœºçš„ç®¡ç†ä¸å±€é™äº pod ç®¡ç†æ¥å£ï¼Œä½†æ˜¯ä¹Ÿæ— æ³•ä½¿ç”¨ pod çš„ RS DS Deployment ç­‰ç®¡ç†èƒ½åŠ›ï¼Œä¹Ÿæ„å‘³ç€ kubevirt å¦‚æœæƒ³è¦åˆ©ç”¨ pod ç®¡ç†èƒ½åŠ›ï¼Œè¦è‡ªä¸»å»å®ç°ï¼Œç›®å‰ kubevirt å®ç°äº†ç±»ä¼¼ RS çš„åŠŸèƒ½ã€‚ kubevirt ç›®å‰æ”¯æŒçš„ runtime æ˜¯ docker å’Œ runcã€‚\nå®‰è£… # éƒ¨ç½² K8s èµ„æº # æœ€æ–°ç‰ˆæœ¬ export KUBEVIRT_VERSION=$(curl -s https://api.github.com/repos/kubevirt/kubevirt/releases/latest | jq -r .tag_name) echo $KUBEVIRT_VERSION # å®‰è£… CRD kubectl create -f https://github.com/kubevirt/kubevirt/releases/download/${KUBEVIRT_VERSION}/kubevirt-cr.yaml # å®‰è£…æ§åˆ¶å™¨ kubectl create -f https://github.com/kubevirt/kubevirt/releases/download/${KUBEVIRT_VERSION}/kubevirt-operator.yaml å®‰è£… virtctl å·¥å…· wget -O virtctl https://github.com/kubevirt/kubevirt/releases/download/${KUBEVIRT_VERSION}/virtctl-${KUBEVIRT_VERSION}-linux-amd64 chmod +x virtctl mv virtctl /usr/local/bin æ£€æŸ¥èµ„æºçŠ¶æ€ # éœ€è¦ç­‰å¾…æ‰€æœ‰ Pod å¤„äº Running çŠ¶æ€ kubectl get pods -n kubevirt # éœ€è¦ç­‰å¾… kubevirt å¤„äº Deployed çŠ¶æ€ kubectl -n kubevirt get kubevirt å¸è½½ å¸è½½é¦–å…ˆéœ€è¦åˆ é™¤ CRDï¼Œç„¶åå¸è½½æ§åˆ¶å™¨ã€‚\n# 0ã€è·å–å½“å‰ Kubevirt ç‰ˆæœ¬ export KUBEVIRT_VERSION=$(kubectl get kubevirts.kubevirt.io -n kubevirt kubevirt -o=jsonpath=\u0026#39;{.status.observedKubeVirtVersion}\u0026#39;) # 1ã€åˆ é™¤ CRD kubectl delete -f https://github.com/kubevirt/kubevirt/releases/download/${KUBEVIRT_VERSION}/kubevirt-cr.yaml # 2ã€å¸è½½æ§åˆ¶å™¨ kubectl delete -f kubectl create -f https://github.com/kubevirt/kubevirt/releases/download/${KUBEVIRT_VERSION}/kubevirt-operator.yaml æ¦‚å¿µ # è™šæ‹Ÿæœºï¼ˆVirtualMachineï¼‰ è™šæ‹Ÿæœºå®ä¾‹ï¼ˆVirtualMachineInstanceï¼‰ åˆ›å»ºè™šæ‹Ÿæœº # ç°åœ¨ä½ å¯ä»¥åƒåˆ›å»ºå…¶ä»–ä»»ä½• K8s èµ„æºä¸€æ ·ï¼Œå£°æ˜è™šæ‹Ÿæœºèµ„æºç„¶ååˆ›å»ºäº†ï¼Œå¦‚ä¸‹ï¼š\napiVersion: kubevirt.io/v1 kind: VirtualMachine metadata: name: testvm spec: running: false template: metadata: labels: kubevirt.io/size: small kubevirt.io/domain: testvm spec: domain: devices: disks: - name: containerdisk disk: bus: virtio - name: cloudinitdisk disk: bus: virtio interfaces: - name: default masquerade: {} resources: requests: memory: 64M networks: - name: default pod: {} volumes: - name: containerdisk containerDisk: image: quay.io/kubevirt/cirros-container-disk-demo - name: cloudinitdisk cloudInitNoCloud: userDataBase64: SGkuXG4= åˆ›å»ºè™šæ‹Ÿæœºï¼š\nkubectl apply -f testvm.yaml æŸ¥çœ‹è™šæ‹ŸæœºçŠ¶æ€ï¼Œè™šæ‹Ÿæœºåº”è¯¥å¤„äºæœªè¿è¡Œçš„çŠ¶æ€ï¼š\n# kubectl get vms kubectl get vms -o yaml testvm | grep -E \u0026#39;running:.*|$\u0026#39; è¿è¡Œè™šæ‹Ÿæœº # ä½¿ç”¨ virtctl start å‘½ä»¤è¿è¡Œè™šæ‹Ÿæœºï¼š\nvirtual start testvm æ³¨æ„ï¼š\nå¦‚æœé‡åˆ° virtctl start testvm dial tcp 127.0.0.1:8080: connect: connection refusedé—®é¢˜ï¼Œé€šè¿‡ kubectl proxy --port 8080 åœ¨æœ¬åœ°ä»£ç† K8s apiserver æœåŠ¡ã€‚\nç­‰å¾…ç‰‡åˆ»ï¼Œå†æ¬¡æŸ¥çœ‹è™šæ‹ŸæœºçŠ¶æ€ï¼Œè™šæ‹Ÿæœºåº”è¯¥å¤„äºæœªè¿è¡Œçš„çŠ¶æ€ï¼š\nkubectl get vms -o yaml testvm | grep -E \u0026#39;running:.*|$\u0026#39; kubectl get vmis kubectl get vms è®¿é—®è™šæ‹Ÿæœº # ä½¿ç”¨ virtual console å‘½ä»¤è®¿é—®è™šæ‹Ÿæœºï¼š\nvirtual console testvm æ³¨æ„ï¼š\nä½¿ç”¨é•œåƒ quay.io/kubevirt/cirros-container-disk-demo åˆ›å»ºçš„è™šæ‹Ÿæœºï¼Œé»˜è®¤è´¦å·å¯†ç ï¼šcirros/gocubsgoï¼› ä½¿ç”¨ ctrl+] é€€å‡ºã€‚ å…³é—­è™šæ‹Ÿæœº # ä½¿ç”¨ virtual stop å‘½ä»¤è®¿é—®è™šæ‹Ÿæœºï¼š\nvirtual stop testvm åˆ é™¤è™šæ‹Ÿæœºï¼š\nkubectl delete vms testvm ç£ç›˜è®¿é—® # lun # å°†å·ä»¥ lun çš„æ–¹å¼å…¬å¼€ç»™è™šæ‹Ÿæœºã€‚\npvcï¼š\napiVersion: v1 kind: PersistentVolumeClaim metadata: name: lun-pvc namespace: default spec: accessModes: - ReadWriteOnce resources: requests: storage: 1Gi storageClassName: longhorn volumeMode: Filesystem vmï¼š\napiVersion: kubevirt.io/v1 kind: VirtualMachine metadata: name: testvm spec: running: false template: metadata: labels: kubevirt.io/size: small kubevirt.io/domain: testvm spec: domain: devices: disks: - name: containerdisk disk: bus: virtio - name: cloudinitdisk disk: bus: virtio - name: lundisk lun: {} interfaces: - name: default masquerade: {} resources: requests: memory: 64M networks: - name: default pod: {} volumes: - name: containerdisk containerDisk: image: quay.io/kubevirt/cirros-container-disk-demo - name: cloudinitdisk cloudInitNoCloud: userDataBase64: SGkuXG4= - name: lundisk persistentVolumeClaim: claimName: lun-pvc disk # pvc:\napiVersion: v1 kind: PersistentVolumeClaim metadata: name: disk-pvc namespace: default spec: accessModes: - ReadWriteOnce resources: requests: storage: 1Gi storageClassName: longhorn volumeMode: Filesystem vm:\napiVersion: kubevirt.io/v1 kind: VirtualMachine metadata: name: testvm spec: running: false template: metadata: labels: kubevirt.io/size: small kubevirt.io/domain: testvm spec: domain: devices: disks: - name: containerdisk disk: bus: virtio - name: cloudinitdisk disk: bus: virtio - name: disk-pvc disk: bus: virtio interfaces: - name: default masquerade: {} resources: requests: memory: 64M networks: - name: default pod: {} volumes: - name: containerdisk containerDisk: image: quay.io/kubevirt/cirros-container-disk-demo - name: cloudinitdisk cloudInitNoCloud: userDataBase64: SGkuXG4= - name: disk-pvc persistentVolumeClaim: claimName: disk-pvc cdrom # å°†å·ä»¥ cdrom é©±åŠ¨å™¨çš„æ–¹å¼å…¬å¼€ç»™è™šæ‹Ÿæœºã€‚é»˜è®¤æƒ…å†µä¸‹åªè¯»ï¼Œå¯ä»¥é€šè¿‡ readonly: false è®¾ç½®ä¸ºå¯å†™ã€‚\npvc:\napiVersion: v1 kind: PersistentVolumeClaim metadata: name: cdrom-pvc namespace: default spec: accessModes: - ReadWriteOnce resources: requests: storage: 1Gi storageClassName: longhorn volumeMode: Filesystem vm:\napiVersion: kubevirt.io/v1 kind: VirtualMachine metadata: name: testvm spec: running: false template: metadata: labels: kubevirt.io/size: small kubevirt.io/domain: testvm spec: domain: devices: disks: - name: containerdisk disk: bus: virtio - name: cloudinitdisk disk: bus: virtio - name: disk-pvc cdrom: readonly: false bus: sata interfaces: - name: default masquerade: {} resources: requests: memory: 64M networks: - name: default pod: {} volumes: - name: containerdisk containerDisk: image: quay.io/kubevirt/cirros-container-disk-demo - name: cloudinitdisk cloudInitNoCloud: userDataBase64: SGkuXG4= - name: cdrom-pvc persistentVolumeClaim: claimName: cdrom-pvc æ’é”™ # ä½¿ç”¨ virtctl å·¥å…·è¿è¡Œè™šæ‹Ÿæœºæ—¶ï¼Œé‡åˆ° virtctl start testvm dial tcp 127.0.0.1:8080: connect: connection refused é”™è¯¯ï¼š è§£å†³æ–¹æ³•ï¼šæœ¬åœ°ä»£ç† K8s apiserver æœåŠ¡ã€‚\nkubectl proxy --port 8080 Â« KubeVirt åˆ›å»º Windows è™šæ‹Ÿæœº\nÂ» Kustomize\n"},{"id":158,"href":"/kubernetes/kustomize/","title":"Kustomize","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kustomize\nKustomize # Kustomize æ˜¯ä¸€ä¸ªé€šè¿‡ kustomization æ–‡ä»¶ å®šåˆ¶ Kubernetes å¯¹è±¡çš„å·¥å…·ã€‚å®ƒæä¾›ä»¥ä¸‹åŠŸèƒ½ç‰¹æ€§æ¥ç®¡ç†åº”ç”¨é…ç½®æ–‡ä»¶ï¼š\nä»å…¶ä»–æ¥æºç”Ÿæˆèµ„æº ä¸ºèµ„æºè®¾ç½®è´¯ç©¿æ€§ï¼ˆCross-Cuttingï¼‰å­—æ®µ ç»„ç»‡å’Œå®šåˆ¶èµ„æºé›†åˆ ä» 1.14 ç‰ˆæœ¬å¼€å§‹ï¼Œkubectl ä¹Ÿå¼€å§‹æ”¯æŒä½¿ç”¨ kustomization æ–‡ä»¶æ¥ç®¡ç† Kubernetes å¯¹è±¡ã€‚ è¦æŸ¥çœ‹åŒ…å« kustomization æ–‡ä»¶çš„ç›®å½•ä¸­çš„èµ„æºï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š\nkubectl kustomize \u0026lt;kustomization_directory\u0026gt; è¦åº”ç”¨è¿™äº›èµ„æºï¼Œä½¿ç”¨ --kustomize æˆ– -k å‚æ•°æ¥æ‰§è¡Œ kubectl applyï¼š\nkubectl apply -k \u0026lt;kustomization_directory\u0026gt; ç”Ÿæˆèµ„æº # ConfigMap å’Œ Secret åŒ…å«å…¶ä»– Kubernetes å¯¹è±¡ï¼ˆå¦‚ Podï¼‰æ‰€éœ€è¦çš„é…ç½®æˆ–æ•æ„Ÿæ•°æ®ã€‚ ConfigMap æˆ– Secret ä¸­æ•°æ®çš„æ¥æºå¾€å¾€æ˜¯é›†ç¾¤å¤–éƒ¨ï¼Œä¾‹å¦‚æŸä¸ª .properties æ–‡ä»¶æˆ–è€… SSH å¯†é’¥æ–‡ä»¶ã€‚ Kustomize æä¾› secretGenerator å’Œ configMapGeneratorï¼Œå¯ä»¥åŸºäºæ–‡ä»¶æˆ–å­—é¢å€¼æ¥ç”Ÿæˆ Secret å’Œ ConfigMapã€‚\nconfigMapGenerator # è¦åŸºäºæ–‡ä»¶æ¥ç”Ÿæˆ ConfigMapï¼Œå¯ä»¥åœ¨ configMapGenerator çš„ files åˆ—è¡¨ä¸­æ·»åŠ è¡¨é¡¹ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ ¹æ® .properties æ–‡ä»¶ä¸­çš„æ•°æ®æ¡ç›®æ¥ç”Ÿæˆ ConfigMap çš„ç¤ºä¾‹ï¼š\n# ç”Ÿæˆä¸€ä¸ª application.properties æ–‡ä»¶ cat \u0026lt;\u0026lt;EOF \u0026gt;application.properties FOO=Bar EOF cat \u0026lt;\u0026lt;EOF \u0026gt;./kustomization.yaml configMapGenerator: - name: example-configmap-1 files: - application.properties EOF æ‰€ç”Ÿæˆçš„ ConfigMap å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ£€æŸ¥ï¼š\nkubectl kustomize ./ æ‰€ç”Ÿæˆçš„ ConfigMap ä¸ºï¼š\napiVersion: v1 data: application.properties: | FOO=Bar kind: ConfigMap metadata: name: example-configmap-1-8mbdf7882g è¦ä» env æ–‡ä»¶ç”Ÿæˆ ConfigMapï¼Œè¯·åœ¨ configMapGenerator ä¸­çš„ envs åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæ¡ç›®ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨æ¥è‡ª .env æ–‡ä»¶çš„æ•°æ®ç”Ÿæˆ ConfigMap çš„ä¾‹å­ï¼š\n# åˆ›å»ºä¸€ä¸ª .env æ–‡ä»¶ cat \u0026lt;\u0026lt;EOF \u0026gt;.env FOO=Bar EOF cat \u0026lt;\u0026lt;EOF \u0026gt;./kustomization.yaml configMapGenerator: - name: example-configmap-1 envs: - .env EOF å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ç”Ÿæˆçš„ ConfigMapï¼š\nkubectl kustomize ./ ç”Ÿæˆçš„ ConfigMap ä¸ºï¼š\napiVersion: v1 data: FOO: Bar kind: ConfigMap metadata: name: example-configmap-1-42cfbf598f è¯´æ˜ï¼šï¼š\n.env æ–‡ä»¶ä¸­çš„æ¯ä¸ªå˜é‡åœ¨ç”Ÿæˆçš„ ConfigMap ä¸­æˆä¸ºä¸€ä¸ªå•ç‹¬çš„é”®ã€‚è¿™ä¸ä¹‹å‰çš„ç¤ºä¾‹ä¸åŒï¼Œ å‰ä¸€ä¸ªç¤ºä¾‹å°†ä¸€ä¸ªåä¸º application.properties çš„æ–‡ä»¶ï¼ˆåŠå…¶æ‰€æœ‰æ¡ç›®ï¼‰åµŒå…¥åˆ°åŒä¸€ä¸ªé”®çš„å€¼ä¸­ã€‚\nConfigMap ä¹Ÿå¯åŸºäºå­—é¢çš„é”®å€¼å¶å¯¹æ¥ç”Ÿæˆã€‚è¦åŸºäºé”®å€¼å¶å¯¹æ¥ç”Ÿæˆ ConfigMapï¼Œ åœ¨ configMapGenerator çš„ literals åˆ—è¡¨ä¸­æ·»åŠ è¡¨é¡¹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œ å±•ç¤ºå¦‚ä½•ä½¿ç”¨é”®å€¼å¶å¯¹ä¸­çš„æ•°æ®æ¡ç›®æ¥ç”Ÿæˆ ConfigMap å¯¹è±¡ï¼š\ncat \u0026lt;\u0026lt;EOF \u0026gt;./kustomization.yaml configMapGenerator: - name: example-configmap-2 literals: - FOO=Bar EOF å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥æ‰€ç”Ÿæˆçš„ ConfigMapï¼š\nkubectl kustomize ./ æ‰€ç”Ÿæˆçš„ ConfigMap ä¸ºï¼š\napiVersion: v1 data: FOO: Bar kind: ConfigMap metadata: name: example-configmap-2-g2hdhfc6tk è¦åœ¨ Deployment ä¸­ä½¿ç”¨ç”Ÿæˆçš„ ConfigMapï¼Œä½¿ç”¨ configMapGenerator çš„åç§°å¯¹å…¶è¿›è¡Œå¼•ç”¨ã€‚ Kustomize å°†è‡ªåŠ¨ä½¿ç”¨ç”Ÿæˆçš„åç§°æ›¿æ¢è¯¥åç§°ã€‚\nè¿™æ˜¯ä½¿ç”¨ç”Ÿæˆçš„ ConfigMap çš„ deployment ç¤ºä¾‹ï¼š\n# åˆ›å»ºä¸€ä¸ª application.properties æ–‡ä»¶ cat \u0026lt;\u0026lt;EOF \u0026gt;application.properties FOO=Bar EOF cat \u0026lt;\u0026lt;EOF \u0026gt;deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-app labels: app: my-app spec: selector: matchLabels: app: my-app template: metadata: labels: app: my-app spec: containers: - name: app image: my-app volumeMounts: - name: config mountPath: /config volumes: - name: config configMap: name: example-configmap-1 EOF cat \u0026lt;\u0026lt;EOF \u0026gt;./kustomization.yaml resources: - deployment.yaml configMapGenerator: - name: example-configmap-1 files: - application.properties EOF ç”Ÿæˆ ConfigMap å’Œ Deploymentï¼š\nkubectl kustomize ./ ç”Ÿæˆçš„ Deployment å°†é€šè¿‡åç§°å¼•ç”¨ç”Ÿæˆçš„ ConfigMapï¼š\napiVersion: v1 data: application.properties: | FOO=Bar kind: ConfigMap metadata: name: example-configmap-1-g4hk9g2ff8 --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: my-app name: my-app spec: selector: matchLabels: app: my-app template: metadata: labels: app: my-app spec: containers: - image: my-app name: app volumeMounts: - mountPath: /config name: config volumes: - configMap: name: example-configmap-1-g4hk9g2ff8 name: config secretGenerator # ä½ å¯ä»¥åŸºäºæ–‡ä»¶æˆ–è€…é”®å€¼å¶å¯¹æ¥ç”Ÿæˆ Secretã€‚è¦ä½¿ç”¨æ–‡ä»¶å†…å®¹æ¥ç”Ÿæˆ Secretï¼Œ åœ¨ secretGenerator ä¸‹é¢çš„ files åˆ—è¡¨ä¸­æ·»åŠ è¡¨é¡¹ã€‚ä½¿ç”¨å’Œ configMapGenerator åŸºæœ¬ä¸€è‡´ã€‚\nè®¾ç½®è´¯ç©¿æ€§å­—æ®µ # åœ¨é¡¹ç›®ä¸­ä¸ºæ‰€æœ‰ Kubernetes å¯¹è±¡è®¾ç½®è´¯ç©¿æ€§å­—æ®µæ˜¯ä¸€ç§å¸¸è§æ“ä½œã€‚ è´¯ç©¿æ€§å­—æ®µçš„ä¸€äº›ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š\nä¸ºæ‰€æœ‰èµ„æºè®¾ç½®ç›¸åŒçš„åå­—ç©ºé—´ ä¸ºæ‰€æœ‰å¯¹è±¡æ·»åŠ ç›¸åŒçš„å‰ç¼€æˆ–åç¼€ ä¸ºå¯¹è±¡æ·»åŠ ç›¸åŒçš„æ ‡ç­¾é›†åˆ ä¸ºå¯¹è±¡æ·»åŠ ç›¸åŒçš„æ³¨è§£é›†åˆ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\n# åˆ›å»ºä¸€ä¸ª deployment.yaml cat \u0026lt;\u0026lt;EOF \u0026gt;./deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: nginx-deployment labels: app: nginx spec: selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx EOF cat \u0026lt;\u0026lt;EOF \u0026gt;./kustomization.yaml namespace: my-namespace namePrefix: dev- nameSuffix: \u0026#34;-001\u0026#34; commonLabels: app: bingo commonAnnotations: oncallPager: 800-555-1212 resources: - deployment.yaml EOF æ‰§è¡Œ kubectl kustomize ./ æŸ¥çœ‹è¿™äº›å­—æ®µéƒ½è¢«è®¾ç½®åˆ° Deployment èµ„æºä¸Šï¼š\napiVersion: apps/v1 kind: Deployment metadata: annotations: oncallPager: 800-555-1212 labels: app: bingo name: dev-nginx-deployment-001 namespace: my-namespace spec: selector: matchLabels: app: bingo template: metadata: annotations: oncallPager: 800-555-1212 labels: app: bingo spec: containers: - image: nginx name: nginx ç»„ç»‡å’Œå®šåˆ¶èµ„æº # ä¸€ç§å¸¸è§çš„åšæ³•æ˜¯åœ¨é¡¹ç›®ä¸­æ„é€ èµ„æºé›†åˆå¹¶å°†å…¶æ”¾åˆ°åŒä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ä¸­ç®¡ç†ã€‚ Kustomize æä¾›åŸºäºä¸åŒæ–‡ä»¶æ¥ç»„ç»‡èµ„æºå¹¶å‘å…¶åº”ç”¨è¡¥ä¸æˆ–è€…å…¶ä»–å®šåˆ¶çš„èƒ½åŠ›ã€‚\nç»„ç»‡ # Kustomize æ”¯æŒç»„åˆä¸åŒçš„èµ„æºã€‚kustomization.yaml æ–‡ä»¶çš„ resources å­—æ®µå®šä¹‰é…ç½®ä¸­è¦åŒ…å«çš„èµ„æºåˆ—è¡¨ã€‚ ä½ å¯ä»¥å°† resources åˆ—è¡¨ä¸­çš„è·¯å¾„è®¾ç½®ä¸ºèµ„æºé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚ ä¸‹é¢æ˜¯ç”± Deployment å’Œ Service æ„æˆçš„ NGINX åº”ç”¨çš„ç¤ºä¾‹ï¼š\n# åˆ›å»º deployment.yaml æ–‡ä»¶ cat \u0026lt;\u0026lt;EOF \u0026gt; deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-nginx spec: selector: matchLabels: run: my-nginx replicas: 2 template: metadata: labels: run: my-nginx spec: containers: - name: my-nginx image: nginx ports: - containerPort: 80 EOF # åˆ›å»º service.yaml æ–‡ä»¶ cat \u0026lt;\u0026lt;EOF \u0026gt; service.yaml apiVersion: v1 kind: Service metadata: name: my-nginx labels: run: my-nginx spec: ports: - port: 80 protocol: TCP selector: run: my-nginx EOF # åˆ›å»º kustomization.yaml æ¥ç»„ç»‡ä»¥ä¸Šä¸¤ä¸ªèµ„æº cat \u0026lt;\u0026lt;EOF \u0026gt;./kustomization.yaml resources: - deployment.yaml - service.yaml EOF kubectl kustomize ./ æ‰€å¾—åˆ°çš„èµ„æºä¸­æ—¢åŒ…å« Deployment ä¹ŸåŒ…å« Service å¯¹è±¡ã€‚\nå®šåˆ¶ # è¡¥ä¸æ–‡ä»¶ï¼ˆPatchesï¼‰å¯ä»¥ç”¨æ¥å¯¹èµ„æºæ‰§è¡Œä¸åŒçš„å®šåˆ¶ã€‚ Kustomize é€šè¿‡ patchesStrategicMerge å’Œ patchesJson6902 æ”¯æŒä¸åŒçš„æ‰“è¡¥ä¸æœºåˆ¶ã€‚ patchesStrategicMerge çš„å†…å®¹æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„çš„åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªæ–‡ä»¶éƒ½åº”å¯è§£æä¸º ç­–ç•¥æ€§åˆå¹¶è¡¥ä¸ï¼ˆStrategic Merge Patchï¼‰ã€‚ è¡¥ä¸æ–‡ä»¶ä¸­çš„åç§°å¿…é¡»ä¸å·²ç»åŠ è½½çš„èµ„æºçš„åç§°åŒ¹é…ã€‚ å»ºè®®æ„é€ è§„æ¨¡è¾ƒå°çš„ã€ä»…åšä¸€ä»¶äº‹æƒ…çš„è¡¥ä¸ã€‚ ä¾‹å¦‚ï¼Œæ„é€ ä¸€ä¸ªè¡¥ä¸æ¥å¢åŠ  Deployment çš„å‰¯æœ¬ä¸ªæ•°ï¼›æ„é€ å¦å¤–ä¸€ä¸ªè¡¥ä¸æ¥è®¾ç½®å†…å­˜é™åˆ¶ã€‚\n# åˆ›å»º deployment.yaml æ–‡ä»¶ cat \u0026lt;\u0026lt;EOF \u0026gt; deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-nginx spec: selector: matchLabels: run: my-nginx replicas: 2 template: metadata: labels: run: my-nginx spec: containers: - name: my-nginx image: nginx ports: - containerPort: 80 EOF # ç”Ÿæˆä¸€ä¸ªè¡¥ä¸ increase_replicas.yaml cat \u0026lt;\u0026lt;EOF \u0026gt; increase_replicas.yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-nginx spec: replicas: 3 EOF # ç”Ÿæˆå¦ä¸€ä¸ªè¡¥ä¸ set_memory.yaml cat \u0026lt;\u0026lt;EOF \u0026gt; set_memory.yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-nginx spec: template: spec: containers: - name: my-nginx resources: limits: memory: 512Mi EOF cat \u0026lt;\u0026lt;EOF \u0026gt;./kustomization.yaml resources: - deployment.yaml patchesStrategicMerge: - increase_replicas.yaml - set_memory.yaml EOF æ‰§è¡Œ kubectl kustomize ./ æ¥æŸ¥çœ‹ Deploymentï¼š\napiVersion: apps/v1 kind: Deployment metadata: name: my-nginx spec: replicas: 3 selector: matchLabels: run: my-nginx template: metadata: labels: run: my-nginx spec: containers: - image: nginx name: my-nginx ports: - containerPort: 80 resources: limits: memory: 512Mi å¹¶éæ‰€æœ‰èµ„æºæˆ–è€…å­—æ®µéƒ½æ”¯æŒç­–ç•¥æ€§åˆå¹¶è¡¥ä¸ã€‚ä¸ºäº†æ”¯æŒå¯¹ä»»ä½•èµ„æºçš„ä»»ä½•å­—æ®µè¿›è¡Œä¿®æ”¹ï¼Œ Kustomize æä¾›é€šè¿‡ patchesJson6902 æ¥åº”ç”¨ JSON è¡¥ä¸çš„èƒ½åŠ›ã€‚ ä¸ºäº†ç»™ JSON è¡¥ä¸æ‰¾åˆ°æ­£ç¡®çš„èµ„æºï¼Œéœ€è¦åœ¨ kustomization.yaml æ–‡ä»¶ä¸­æŒ‡å®šèµ„æºçš„ç»„ï¼ˆgroupï¼‰ã€ ç‰ˆæœ¬ï¼ˆversionï¼‰ã€ç±»åˆ«ï¼ˆkindï¼‰å’Œåç§°ï¼ˆnameï¼‰ã€‚ ä¾‹å¦‚ï¼Œä¸ºæŸ Deployment å¯¹è±¡å¢åŠ å‰¯æœ¬ä¸ªæ•°çš„æ“ä½œä¹Ÿå¯ä»¥é€šè¿‡ patchesJson6902 æ¥å®Œæˆï¼š\n# åˆ›å»ºä¸€ä¸ª deployment.yaml æ–‡ä»¶ cat \u0026lt;\u0026lt;EOF \u0026gt; deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-nginx spec: selector: matchLabels: run: my-nginx replicas: 2 template: metadata: labels: run: my-nginx spec: containers: - name: my-nginx image: nginx ports: - containerPort: 80 EOF # åˆ›å»ºä¸€ä¸ª JSON è¡¥ä¸æ–‡ä»¶ cat \u0026lt;\u0026lt;EOF \u0026gt; patch.yaml - op: replace path: /spec/replicas value: 3 EOF # åˆ›å»ºä¸€ä¸ª kustomization.yaml cat \u0026lt;\u0026lt;EOF \u0026gt;./kustomization.yaml resources: - deployment.yaml patchesJson6902: - target: group: apps version: v1 kind: Deployment name: my-nginx path: patch.yaml EOF æ‰§è¡Œ kubectl kustomize ./ ä»¥æŸ¥çœ‹ replicas å­—æ®µè¢«æ›´æ–°ï¼š\napiVersion: apps/v1 kind: Deployment metadata: name: my-nginx spec: replicas: 3 selector: matchLabels: run: my-nginx template: metadata: labels: run: my-nginx spec: containers: - image: nginx name: my-nginx ports: - containerPort: 80 é™¤äº†è¡¥ä¸ä¹‹å¤–ï¼ŒKustomize è¿˜æä¾›å®šåˆ¶å®¹å™¨é•œåƒæˆ–è€…å°†å…¶ä»–å¯¹è±¡çš„å­—æ®µå€¼æ³¨å…¥åˆ°å®¹å™¨ä¸­çš„èƒ½åŠ›ï¼Œå¹¶ä¸”ä¸éœ€è¦åˆ›å»ºè¡¥ä¸ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨ kustomization.yaml æ–‡ä»¶çš„ images å­—æ®µè®¾ç½®æ–°çš„é•œåƒæ¥æ›´æ”¹å®¹å™¨ä¸­ä½¿ç”¨çš„é•œåƒã€‚\ncat \u0026lt;\u0026lt;EOF \u0026gt; deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-nginx spec: selector: matchLabels: run: my-nginx replicas: 2 template: metadata: labels: run: my-nginx spec: containers: - name: my-nginx image: nginx ports: - containerPort: 80 EOF cat \u0026lt;\u0026lt;EOF \u0026gt;./kustomization.yaml resources: - deployment.yaml images: - name: nginx newName: my.image.registry/nginx newTag: 1.4.0 EOF æ‰§è¡Œ kubectl kustomize ./ ä»¥æŸ¥çœ‹æ‰€ä½¿ç”¨çš„é•œåƒå·²è¢«æ›´æ–°ï¼š\napiVersion: apps/v1 kind: Deployment metadata: name: my-nginx spec: replicas: 2 selector: matchLabels: run: my-nginx template: metadata: labels: run: my-nginx spec: containers: - image: my.image.registry/nginx:1.4.0 name: my-nginx ports: - containerPort: 80 æœ‰äº›æ—¶å€™ï¼ŒPod ä¸­è¿è¡Œçš„åº”ç”¨å¯èƒ½éœ€è¦ä½¿ç”¨æ¥è‡ªå…¶ä»–å¯¹è±¡çš„é…ç½®å€¼ã€‚ ä¾‹å¦‚ï¼ŒæŸ Deployment å¯¹è±¡çš„ Pod éœ€è¦ä»ç¯å¢ƒå˜é‡æˆ–å‘½ä»¤è¡Œå‚æ•°ä¸­è¯»å–è¯»å– Service çš„åç§°ã€‚ ç”±äºåœ¨ kustomization.yaml æ–‡ä»¶ä¸­æ·»åŠ  namePrefix æˆ– nameSuffix æ—¶ Service åç§°å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œå»ºè®®ä¸è¦åœ¨å‘½ä»¤å‚æ•°ä¸­ç¡¬ç¼–ç  Service åç§°ã€‚ å¯¹äºè¿™ç§ä½¿ç”¨åœºæ™¯ï¼ŒKustomize å¯ä»¥é€šè¿‡ vars å°† Service åç§°æ³¨å…¥åˆ°å®¹å™¨ä¸­ã€‚\n# åˆ›å»ºä¸€ä¸ª deployment.yaml æ–‡ä»¶ï¼ˆå¼•ç”¨æ­¤å¤„çš„æ–‡æ¡£åˆ†éš”ç¬¦ï¼‰ cat \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; \u0026gt; deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-nginx spec: selector: matchLabels: run: my-nginx replicas: 2 template: metadata: labels: run: my-nginx spec: containers: - name: my-nginx image: nginx command: [\u0026#34;start\u0026#34;, \u0026#34;--host\u0026#34;, \u0026#34;$(MY_SERVICE_NAME)\u0026#34;] EOF # åˆ›å»ºä¸€ä¸ª service.yaml æ–‡ä»¶ cat \u0026lt;\u0026lt;EOF \u0026gt; service.yaml apiVersion: v1 kind: Service metadata: name: my-nginx labels: run: my-nginx spec: ports: - port: 80 protocol: TCP selector: run: my-nginx EOF cat \u0026lt;\u0026lt;EOF \u0026gt;./kustomization.yaml namePrefix: dev- nameSuffix: \u0026#34;-001\u0026#34; resources: - deployment.yaml - service.yaml vars: - name: MY_SERVICE_NAME objref: kind: Service name: my-nginx apiVersion: v1 EOF æ‰§è¡Œ kubectl kustomize ./ ä»¥æŸ¥çœ‹æ³¨å…¥åˆ°å®¹å™¨ä¸­çš„ Service åç§°æ˜¯ dev-my-nginx-001ï¼š\napiVersion: apps/v1 kind: Deployment metadata: name: dev-my-nginx-001 spec: replicas: 2 selector: matchLabels: run: my-nginx template: metadata: labels: run: my-nginx spec: containers: - command: - start - --host - dev-my-nginx-001 image: nginx name: my-nginx åŸºå‡†ï¼ˆBasesï¼‰ä¸è¦†ç›–ï¼ˆOverlaysï¼‰ # Kustomize ä¸­æœ‰ åŸºå‡†ï¼ˆbasesï¼‰ å’Œ è¦†ç›–ï¼ˆoverlaysï¼‰ çš„æ¦‚å¿µåŒºåˆ†ã€‚ åŸºå‡† æ˜¯åŒ…å« kustomization.yaml æ–‡ä»¶çš„ä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­åŒ…å«ä¸€ç»„èµ„æºåŠå…¶ç›¸å…³çš„å®šåˆ¶ã€‚ åŸºå‡†å¯ä»¥æ˜¯æœ¬åœ°ç›®å½•æˆ–è€…æ¥è‡ªè¿œç¨‹ä»“åº“çš„ç›®å½•ï¼Œåªè¦å…¶ä¸­å­˜åœ¨ kustomization.yaml æ–‡ä»¶å³å¯ã€‚ è¦†ç›– ä¹Ÿæ˜¯ä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­åŒ…å«å°†å…¶ä»– kustomization ç›®å½•å½“åš bases æ¥å¼•ç”¨çš„ kustomization.yaml æ–‡ä»¶ã€‚ åŸºå‡†ä¸äº†è§£è¦†ç›–çš„å­˜åœ¨ï¼Œä¸”å¯è¢«å¤šä¸ªè¦†ç›–æ‰€ä½¿ç”¨ã€‚ è¦†ç›–åˆ™å¯ä»¥æœ‰å¤šä¸ªåŸºå‡†ï¼Œä¸”å¯é’ˆå¯¹æ‰€æœ‰åŸºå‡†ä¸­çš„èµ„æºæ‰§è¡Œç»„ç»‡æ“ä½œï¼Œè¿˜å¯ä»¥åœ¨å…¶ä¸Šæ‰§è¡Œå®šåˆ¶ã€‚\n# åˆ›å»ºä¸€ä¸ªåŒ…å«åŸºå‡†çš„ç›®å½• mkdir base # åˆ›å»º base/deployment.yaml cat \u0026lt;\u0026lt;EOF \u0026gt; base/deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-nginx spec: selector: matchLabels: run: my-nginx replicas: 2 template: metadata: labels: run: my-nginx spec: containers: - name: my-nginx image: nginx EOF # åˆ›å»º base/service.yaml æ–‡ä»¶ cat \u0026lt;\u0026lt;EOF \u0026gt; base/service.yaml apiVersion: v1 kind: Service metadata: name: my-nginx labels: run: my-nginx spec: ports: - port: 80 protocol: TCP selector: run: my-nginx EOF # åˆ›å»º base/kustomization.yaml cat \u0026lt;\u0026lt;EOF \u0026gt; base/kustomization.yaml resources: - deployment.yaml - service.yaml EOF æ­¤åŸºå‡†å¯åœ¨å¤šä¸ªè¦†ç›–ä¸­ä½¿ç”¨ã€‚ä½ å¯ä»¥åœ¨ä¸åŒçš„è¦†ç›–ä¸­æ·»åŠ ä¸åŒçš„ namePrefix æˆ–å…¶ä»–è´¯ç©¿æ€§å­—æ®µã€‚ ä¸‹é¢æ˜¯ä¸¤ä¸ªä½¿ç”¨åŒä¸€åŸºå‡†çš„è¦†ç›–ï¼š\nmkdir dev cat \u0026lt;\u0026lt;EOF \u0026gt; dev/kustomization.yaml resources: - ../base namePrefix: dev- EOF mkdir prod cat \u0026lt;\u0026lt;EOF \u0026gt; prod/kustomization.yaml resources: - ../base namePrefix: prod- EOF å¦‚ä½•ä½¿ç”¨ Kustomize æ¥åº”ç”¨ã€æŸ¥çœ‹å’Œåˆ é™¤å¯¹è±¡ # åœ¨ kubectl å‘½ä»¤ä¸­ä½¿ç”¨ --kustomize æˆ– -k å‚æ•°æ¥è¯†åˆ«è¢« kustomization.yaml æ‰€ç®¡ç†çš„èµ„æºã€‚ æ³¨æ„ -k è¦æŒ‡å‘ä¸€ä¸ª kustomization ç›®å½•ã€‚ä¾‹å¦‚ï¼š\nkubectl apply -k \u0026lt;kustomization ç›®å½•\u0026gt;/ å‡å®šä½¿ç”¨ä¸‹é¢çš„ kustomization.yamlï¼š\n# åˆ›å»º deployment.yaml æ–‡ä»¶ cat \u0026lt;\u0026lt;EOF \u0026gt; deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: my-nginx spec: selector: matchLabels: run: my-nginx replicas: 2 template: metadata: labels: run: my-nginx spec: containers: - name: my-nginx image: nginx ports: - containerPort: 80 EOF # åˆ›å»º kustomization.yaml cat \u0026lt;\u0026lt;EOF \u0026gt;./kustomization.yaml namePrefix: dev- commonLabels: app: my-nginx resources: - deployment.yaml EOF æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åº”ç”¨ Deployment å¯¹è±¡ dev-my-nginxï¼š\n\u0026gt; kubectl apply -k ./ deployment.apps/dev-my-nginx created è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä¹‹ä¸€æ¥æŸ¥çœ‹ Deployment å¯¹è±¡ dev-my-nginxï¼š\nkubectl get -k ./ kubectl describe -k ./ æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ¯”è¾ƒ Deployment å¯¹è±¡ dev-my-nginx ä¸æ¸…å•è¢«åº”ç”¨ä¹‹åé›†ç¾¤å°†å¤„äºçš„çŠ¶æ€ï¼š\nkubectl diff -k ./ æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤åˆ é™¤ Deployment å¯¹è±¡ dev-my-nginxï¼š\n\u0026gt; kubectl delete -k ./ deployment.apps \u0026#34;dev-my-nginx\u0026#34; deleted Kustomize åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨ # å­—æ®µ ç±»å‹ è§£é‡Š namespace string ä¸ºæ‰€æœ‰èµ„æºæ·»åŠ åå­—ç©ºé—´ namePrefix string æ­¤å­—æ®µçš„å€¼å°†è¢«æ·»åŠ åˆ°æ‰€æœ‰èµ„æºåç§°å‰é¢ nameSuffix string æ­¤å­—æ®µçš„å€¼å°†è¢«æ·»åŠ åˆ°æ‰€æœ‰èµ„æºåç§°åé¢ commonLabels map[string]string è¦æ·»åŠ åˆ°æ‰€æœ‰èµ„æºå’Œé€‰æ‹©ç®—ç¬¦çš„æ ‡ç­¾ commonAnnotations map[string]string è¦æ·»åŠ åˆ°æ‰€æœ‰èµ„æºçš„æ³¨è§£ resources []string åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½å¿…é¡»èƒ½å¤Ÿè§£æä¸ºç°æœ‰çš„èµ„æºé…ç½®æ–‡ä»¶ configMapGenerator [] ConfigMapArgs åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½ä¼šç”Ÿæˆä¸€ä¸ª ConfigMap secretGenerator []SecretArgs[] SecretArgs åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½ä¼šç”Ÿæˆä¸€ä¸ª Secret generatorOptions GeneratorOptions æ›´æ”¹æ‰€æœ‰ ConfigMap å’Œ Secret ç”Ÿæˆå™¨çš„è¡Œä¸º bases []string åˆ—è¡¨ä¸­æ¯ä¸ªæ¡ç›®éƒ½åº”èƒ½è§£æä¸ºä¸€ä¸ªåŒ…å« kustomization.yaml æ–‡ä»¶çš„ç›®å½• patchesStrategicMerge []string åˆ—è¡¨ä¸­æ¯ä¸ªæ¡ç›®éƒ½èƒ½è§£æä¸ºæŸ Kubernetes å¯¹è±¡çš„ç­–ç•¥æ€§åˆå¹¶è¡¥ä¸ patchesJson6902 []Patch[] Patch åˆ—è¡¨ä¸­æ¯ä¸ªæ¡ç›®éƒ½èƒ½è§£æä¸ºä¸€ä¸ª Kubernetes å¯¹è±¡å’Œä¸€ä¸ª JSON è¡¥ä¸ vars [] Var æ¯ä¸ªæ¡ç›®ç”¨æ¥ä»æŸèµ„æºçš„å­—æ®µæ¥æå–æ–‡å­— images []Image[] images æ¯ä¸ªæ¡ç›®éƒ½ç”¨æ¥æ›´æ”¹é•œåƒçš„åç§°ã€æ ‡è®°ä¸/æˆ–æ‘˜è¦ï¼Œä¸å¿…ç”Ÿæˆè¡¥ä¸ configurations []string åˆ—è¡¨ä¸­æ¯ä¸ªæ¡ç›®éƒ½åº”èƒ½è§£æä¸ºä¸€ä¸ªåŒ…å« Kustomize è½¬æ¢å™¨é…ç½® çš„æ–‡ä»¶ crds []string åˆ—è¡¨ä¸­æ¯ä¸ªæ¡ç›®éƒ½åº”èƒ½å¤Ÿè§£æä¸º Kubernetes ç±»åˆ«çš„ OpenAPI å®šä¹‰æ–‡ä»¶ Â« Kubevirt å®è·µ\nÂ» Kubernetes 0-1 Podä¸­çš„livenessProbeå’ŒreadinessProbeè§£è¯»\n"},{"id":159,"href":"/kubernetes/liveness-readiness-probe/","title":"Liveness Readiness Probe","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 Podä¸­çš„livenessProbeå’ŒreadinessProbeè§£è¯»\nKubernetes 0-1 Podä¸­çš„livenessProbeå’ŒreadinessProbeè§£è¯» # å†™åœ¨å‰é¢ # K8så¯¹Podçš„å¥åº·çŠ¶æ€å¯ä»¥é€šè¿‡ä¸¤ç±»æ¢é’ˆæ¥æ£€æŸ¥ï¼šlivenessProbeå’ŒreadinessProbeï¼Œkubeleté€šè¿‡å®šæœŸæ‰§è¡Œè¿™ä¸¤ç±»æ¢é’ˆæ¥è¯Šæ–­å®¹å™¨çš„å¥åº·çŠ¶å†µã€‚\nlivenessProbeç®€ä»‹ # å­˜æ´»æŒ‡é’ˆï¼Œåˆ¤æ–­Podï¼ˆä¸­çš„åº”ç”¨å®¹å™¨ï¼‰æ˜¯å¦å¥åº·ï¼Œå¯ä»¥ç†è§£ä¸ºå¥åº·æ£€æŸ¥ã€‚æˆ‘ä»¬ä½¿ç”¨livenessProbeæ¥å®šæœŸçš„å»æ¢æµ‹ï¼Œå¦‚æœæ¢æµ‹æˆåŠŸï¼Œåˆ™PodçŠ¶æ€å¯ä»¥åˆ¤å®šä¸ºRunningï¼›å¦‚æœæ¢æµ‹å¤±è´¥ï¼Œå¯kubectlä¼šæ ¹æ®Podçš„é‡å¯ç­–ç•¥æ¥é‡å¯å®¹å™¨ã€‚\nå¦‚æœæœªç»™Podè®¾ç½®livenessProbeï¼Œåˆ™é»˜è®¤æ¢é’ˆæ°¸è¿œè¿”å›Successã€‚\nå½“æˆ‘ä»¬æ‰§è¡Œkubectl get podså‘½ä»¤ï¼Œè¾“å‡ºä¿¡æ¯ä¸­STATUSä¸€åˆ—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Podæ˜¯å¦å¤„äºRunningçŠ¶æ€ã€‚\nreadinessProbeç®€ä»‹ # å°±ç»ªæŒ‡é’ˆï¼Œå°±ç»ªçš„æ„æ€æ˜¯å·²ç»å‡†å¤‡å¥½äº†ï¼ŒPodçš„å°±ç»ªæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºè¿™ä¸ªPodå¯ä»¥æ¥å—è¯·æ±‚å’Œè®¿é—®ã€‚æˆ‘ä»¬ä½¿ç”¨readinessProbeæ¥å®šæœŸçš„å»æ¢æµ‹ï¼Œå¦‚æœæ¢æµ‹æˆåŠŸï¼Œåˆ™Pod çš„ReadyçŠ¶æ€åˆ¤å®šä¸ºTrueï¼›å¦‚æœæ¢æµ‹å¤±è´¥ï¼ŒPodçš„ReadyçŠ¶æ€åˆ¤å®šä¸ºFalseã€‚\nä¸livenessProbeä¸åŒçš„æ˜¯ï¼Œkubeletä¸ä¼šå¯¹readinessProbeçš„æ¢æµ‹æƒ…å†µæœ‰é‡å¯æ“ä½œã€‚\nå½“æˆ‘ä»¬æ‰§è¡Œkubectl get podså‘½ä»¤ï¼Œè¾“å‡ºä¿¡æ¯ä¸­READYä¸€åˆ—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Podçš„READYçŠ¶æ€æ˜¯å¦ä¸ºTrueã€‚\nå®šä¹‰å‚æ•° # livenessProbeå’ŒreadinessProbeçš„å®šä¹‰å‚æ•°æ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥é€šè¿‡kubectl explain pods.spec.containers.readinessProbeæˆ–kubectl explain pods.spec.containers.livenessProbeå‘½ä»¤äº†è§£ï¼š\nå°±ç»ªæ¢é’ˆçš„å‡ ç§ç±»å‹ï¼š\nhttpGetï¼š\nå‘å®¹å™¨å‘é€Http Getè¯·æ±‚ï¼Œè°ƒç”¨æˆåŠŸï¼ˆé€šè¿‡HttpçŠ¶æ€ç åˆ¤æ–­ï¼‰åˆ™ç¡®å®šPodå°±ç»ªï¼›\nä½¿ç”¨æ–¹å¼ï¼š\nlivenessProbe: httpGet: path: /app/healthz port: 80 execï¼š\nåœ¨å®¹å™¨å†…æ‰§è¡ŒæŸå‘½ä»¤ï¼Œå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼ˆé€šè¿‡å‘½ä»¤é€€å‡ºçŠ¶æ€ç ä¸º0åˆ¤æ–­ï¼‰åˆ™ç¡®å®šPodå°±ç»ªï¼›\nä½¿ç”¨æ–¹å¼ï¼š\nlivenessProbe: exec: command: - cat - /app/healthz tcpSocketï¼š\næ‰“å¼€ä¸€ä¸ªTCPè¿æ¥åˆ°å®¹å™¨çš„æŒ‡å®šç«¯å£ï¼Œè¿æ¥æˆåŠŸå»ºç«‹åˆ™ç¡®å®šPodå°±ç»ªã€‚\nä½¿ç”¨æ–¹å¼ï¼š\nlivenessProbe: tcpSocket: port: 80 ä¸€èˆ¬å°±ç»ªæ¢é’ˆä¼šåœ¨å¯åŠ¨å®¹å™¨ä¸€æ®µæ—¶é—´åæ‰å¼€å§‹ç¬¬ä¸€æ¬¡çš„å°±ç»ªæ¢æµ‹ï¼Œä¹‹ååšå‘¨æœŸæ€§æ¢æµ‹ã€‚æ‰€ä»¥åœ¨å®šä¹‰å°±ç»ªæŒ‡é’ˆæ—¶ï¼Œä¼šç»™ä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼š\ninitialDelaySecondsï¼šåœ¨åˆå§‹åŒ–å®¹å™¨å¤šå°‘ç§’åå¼€å§‹ç¬¬ä¸€æ¬¡å°±ç»ªæ¢æµ‹ï¼› timeoutSecondsï¼šå¦‚æœè¯¥æ¬¡å°±ç»ªæ¢æµ‹è¶…è¿‡å¤šå°‘ç§’åè¿˜æœªæˆåŠŸï¼Œåˆ¤å®šä¸ºè¶…æ—¶ï¼Œè¯¥æ¬¡æ¢æµ‹å¤±è´¥ï¼ŒPodä¸å°±ç»ªã€‚é»˜è®¤å€¼1ï¼Œæœ€å°å€¼1ï¼› periodSecondsï¼šå¦‚æœPodæœªå°±ç»ªï¼Œåˆ™æ¯éš”å¤šå°‘ç§’å‘¨æœŸæ€§çš„åšå°±ç»ªæ¢æµ‹ã€‚é»˜è®¤å€¼10ï¼Œæœ€å°å€¼1ï¼› failureThresholdï¼šå¦‚æœå®¹å™¨ä¹‹å‰æ¢æµ‹æˆåŠŸï¼Œåç»­è¿ç»­å‡ æ¬¡æ¢æµ‹å¤±è´¥ï¼Œåˆ™ç¡®å®šå®¹å™¨æœªå°±ç»ªã€‚é»˜è®¤å€¼3ï¼Œæœ€å°å€¼1ï¼› successThresholdï¼šå¦‚æœå®¹å™¨ä¹‹å‰æ¢æµ‹å¤±è´¥ï¼Œåç»­è¿ç»­å‡ æ¬¡æ¢æµ‹æˆåŠŸï¼Œåˆ™ç¡®å®šå®¹å™¨å°±ç»ªã€‚é»˜è®¤å€¼1ï¼Œæœ€å°å€¼1ã€‚ ä½¿ç”¨ç¤ºä¾‹ # ç›®å‰æˆ‘åœ¨docker hubæœ‰ä¸€ä¸ªæµ‹è¯•é•œåƒï¼šponeding/helloweb:v1ï¼Œå®¹å™¨å¯åŠ¨åï¼Œæœ‰ä¸€ä¸ªå¥åº·æ£€æŸ¥è·¯ç”±/healthz/return200ï¼Œè®¿é—®è¯¥è·¯ç”±çŠ¶æ€ç è¿”å›200ï¼›æœ‰ä¸€ä¸ªæ£€æŸ¥è·¯ç”±/health/return404ï¼Œè®¿é—®è¯¥è·¯ç”±çŠ¶æ€ç è¿”å›404ã€‚\nreadinessProbeç¤ºä¾‹ # åœ¨å®éªŒä¹‹å‰å…ˆäº†è§£ä¸€ä¸‹Podå’ŒServiceçš„è´Ÿè½½å‡è¡¡å…³ç³»ï¼šåœ¨K8sä¸­ï¼ŒServiceä½œä¸ºPodçš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæ˜¯é€šè¿‡Label SelectoråŒ¹é…Podçš„ã€‚ä½†æ˜¯è¿™å¥è¯æ²¡æœ‰è¯´å®Œæ•´ï¼Œå› ä¸ºè¿˜æœ‰ä¸€ä¸ªå¿…è¦æ¡ä»¶ï¼šPodå½“å‰å·²ç»å°±ç»ªã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒServiceé€šè¿‡Label SelectoråŒ¹é…å½“å‰å°±ç»ªçš„Podï¼Œè¿˜æœªå°±ç»ªçš„Podå°±ç®—labelSelectoråŒ¹é…ä¸Šäº†ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨Serviceçš„endpointsä¸­ï¼Œè¯·æ±‚æ˜¯ä¸ä¼šè¢«è½¬å‘è¿‡å»çš„ï¼Œå¦‚ä¸‹å›¾ç¤ºä¾‹ã€‚\nç¤ºä¾‹è¯´æ˜ï¼šæˆ‘ä»¬ä½¿ç”¨poneding/helloweb:v1é•œåƒå¯åŠ¨ä¸‰ä¸ªPodï¼Œä¸‰ä¸ªPodçš„Labeléƒ½è®¾ç½®æˆä¸€æ ·ï¼Œä¸ºäº†ä½¿ServiceåŒ¹é…åˆ°ï¼›ä¸‰ä¸ªPodå…¶ä¸­ä¸¤ä¸ªreadinessProbeä½¿ç”¨httpGetæ¢æµ‹/health/return200ï¼Œæ¨¡æ‹Ÿæ¢æµ‹æˆåŠŸï¼Œä¸€ä¸ªreadinessProbeä½¿ç”¨httpGetæ¢æµ‹/health/return404ï¼Œæ¨¡æ‹Ÿæ¢æµ‹å¤±è´¥ã€‚\nç¼–å†™æˆ‘ä»¬çš„helloweb-readinessProbe.yamlæ–‡ä»¶å¦‚ä¸‹ï¼š\napiVersion: v1 kind: Pod metadata: name: helloweb1 labels: app: helloweb spec: containers: - name: helloweb image: poneding/helloweb:v1 readinessProbe: httpGet: path: /healthz/return200 port: 80 initialDelaySeconds: 30 timeoutSeconds: 10 ports: - containerPort: 80 --- apiVersion: v1 kind: Pod metadata: name: helloweb2 labels: app: helloweb spec: containers: - name: helloweb image: poneding/helloweb:v1 readinessProbe: httpGet: path: /healthz/return200 port: 80 initialDelaySeconds: 30 timeoutSeconds: 10 ports: - containerPort: 80 --- apiVersion: v1 kind: Pod metadata: name: helloweb3 labels: app: helloweb spec: containers: - name: helloweb image: poneding/helloweb:v1 readinessProbe: httpGet: path: /healthz/return404 port: 80 initialDelaySeconds: 30 timeoutSeconds: 10 ports: - containerPort: 80 --- apiVersion: v1 kind: Service metadata: name: helloweb spec: selector: app: helloweb type: ClusterIP ports: - name: http port: 80 targetPort: 80 è¿è¡Œå‘½ä»¤éƒ¨ç½²Podå’ŒServiceï¼š\nkubectl apply -f helloweb-readinessProbe.yaml ä¹‹åï¼Œæˆ‘ä»¬æŸ¥çœ‹Podçš„å°±ç»ªæƒ…å†µï¼š\nå¯ä»¥çœ‹åˆ°Podåªæœ‰helloweb1å’Œhelloweb2å½“å‰ä½¿å¤„äºREADYï¼ˆå°±ç»ªï¼‰çš„çŠ¶æ€ï¼Œhelloweb3å°šæœªReadyï¼Œæˆ‘ä»¬æ¥ç€æŸ¥çœ‹helloweb serviceçš„endpointsï¼š\nå¯ä»¥çœ‹åˆ°Serviceçš„EndPointsåªå°†helloweb1ã€helloweb2 podçš„IPè´Ÿè½½ä¸Šäº†ã€‚\næŸ¥çœ‹æ—¥å¿—è®¿é—®æƒ…å†µï¼š\nå¯ä»¥çœ‹åˆ°æ¯éš”10ç§’ï¼ˆreadniessProbe.periodSecondsé»˜è®¤10sï¼‰å°±ä¼šåšä¸€æ¬¡å°±ç»ªæ¢æµ‹ã€‚\nlivenessProbeç¤ºä¾‹ # ç¼–å†™æˆ‘ä»¬çš„helloweb-livenessProbe.yamlæ–‡ä»¶å¦‚ä¸‹ï¼š\napiVersion: v1 kind: Pod metadata: name: helloweb4 labels: app: helloweb spec: containers: - name: helloweb image: poneding/helloweb:v1 livenessProbe: httpGet: path: /healthz/return200 port: 80 initialDelaySeconds: 30 timeoutSeconds: 10 ports: - containerPort: 80 --- apiVersion: v1 kind: Pod metadata: name: helloweb5 labels: app: helloweb spec: containers: - name: helloweb image: poneding/helloweb:v1 livenessProbe: httpGet: path: /healthz/return404 port: 80 initialDelaySeconds: 30 timeoutSeconds: 10 ports: - containerPort: 80 è¿è¡Œå‘½ä»¤éƒ¨ç½²Podå’ŒServiceï¼š\nkubectl apply -f helloweb-livenessProbe.yaml ä¹‹åï¼Œæˆ‘ä»¬æŸ¥çœ‹Podçš„å°±ç»ªæƒ…å†µï¼š\nå¯ä»¥çœ‹åˆ°helloweb4çš„STATUSçŠ¶æ€ä¸ºRunningï¼Œè€Œhelloweb5çš„STATUSçŠ¶æ€æœ€ç»ˆå˜ä¸ºCrashLoopBackOffï¼Œå¹¶ä¸”ä¸€ç›´åœ¨é‡å¯ã€‚\nç›¸ä¿¡åˆ°è¿™é‡Œï¼Œä½ å·²ç»å¯¹readniessProbeå’ŒlivenessProbeæœ‰ä¸€ä¸ªæ¸…æ™°çš„äº†è§£äº†ã€‚\nÂ« Kustomize\nÂ» local å­˜å‚¨å·å®è·µ\n"},{"id":160,"href":"/kubernetes/local-storageclass/","title":"Local Storageclass","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / local å­˜å‚¨å·å®è·µ\nlocal å­˜å‚¨å·å®è·µ # åœ¨ Kubernetes ä¸­æœ‰ä¸€ç§å­˜å‚¨å·ç±»å‹ä¸º localã€‚\nlocal å·æ‰€ä»£è¡¨çš„æ˜¯æŸä¸ªè¢«æŒ‚è½½çš„æœ¬åœ°å­˜å‚¨è®¾å¤‡ï¼Œä¾‹å¦‚ç£ç›˜ã€åˆ†åŒºæˆ–è€…ç›®å½•ã€‚\nlocal å·åªèƒ½ç”¨ä½œé™æ€åˆ›å»ºçš„æŒä¹…å·ã€‚ä¸æ”¯æŒåŠ¨æ€é…ç½®ã€‚\nä¸ hostPath å·ç›¸æ¯”ï¼Œlocal å·èƒ½å¤Ÿä»¥æŒä¹…å’Œå¯ç§»æ¤çš„æ–¹å¼ä½¿ç”¨ï¼Œè€Œæ— éœ€æ‰‹åŠ¨å°† Pod è°ƒåº¦åˆ°èŠ‚ç‚¹ã€‚ç³»ç»Ÿé€šè¿‡æŸ¥çœ‹ PersistentVolume çš„èŠ‚ç‚¹äº²å’Œæ€§é…ç½®ï¼Œå°±èƒ½äº†è§£å·çš„èŠ‚ç‚¹çº¦æŸã€‚\nç„¶è€Œï¼Œlocal å·ä»ç„¶å–å†³äºåº•å±‚èŠ‚ç‚¹çš„å¯ç”¨æ€§ï¼Œå¹¶ä¸é€‚åˆæ‰€æœ‰åº”ç”¨ç¨‹åºã€‚ å¦‚æœèŠ‚ç‚¹å˜å¾—ä¸å¥åº·ï¼Œé‚£ä¹ˆ local å·ä¹Ÿå°†å˜å¾—ä¸å¯è¢« Pod è®¿é—®ã€‚ä½¿ç”¨å®ƒçš„ Pod å°†ä¸èƒ½è¿è¡Œã€‚ ä½¿ç”¨ local å·çš„åº”ç”¨ç¨‹åºå¿…é¡»èƒ½å¤Ÿå®¹å¿è¿™ç§å¯ç”¨æ€§çš„é™ä½ï¼Œä»¥åŠå› åº•å±‚ç£ç›˜çš„è€ç”¨æ€§ç‰¹å¾è€Œå¸¦æ¥çš„æ½œåœ¨çš„æ•°æ®ä¸¢å¤±é£é™©ã€‚\nåˆ›å»º local-storage å­˜å‚¨ç±» # apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: local-storage provisioner: kubernetes.io/no-provisioner volumeBindingMode: WaitForFirstConsumer æ‰‹åŠ¨åˆ›å»º PV/PVC # 1ã€ä½¿ç”¨ local å·æ—¶ï¼Œä½ éœ€è¦è®¾ç½® PersistentVolume å¯¹è±¡çš„ nodeAffinity å­—æ®µã€‚ Kubernetes è°ƒåº¦ï¨¸ä½¿ç”¨ PersistentVolume çš„ nodeAffinity ä¿¡æ¯æ¥å°†ä½¿ç”¨ local å·çš„ Pod è°ƒåº¦åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ï¼›\n2ã€PersistentVolume å¯¹è±¡çš„ volumeMode å­—æ®µå¯è¢«è®¾ç½®ä¸º \u0026ldquo;Block\u0026rdquo; ï¼ˆè€Œä¸æ˜¯é»˜è®¤å€¼ \u0026ldquo;Filesystem\u0026rdquo;ï¼‰ï¼Œä»¥å°† local å·ä½œä¸ºåŸå§‹å—è®¾å¤‡æš´éœ²å‡ºæ¥ã€‚\napiVersion: v1 kind: PersistentVolumeClaim metadata: name: mysql-local-pvc namespace: default spec: accessModes: - ReadWriteOnce resources: requests: storage: 128Mi storageClassName: local-storage volumeMode: Filesystem volumeName: mysql-local-pv --- apiVersion: v1 kind: PersistentVolume metadata: name: mysql-local-pv spec: capacity: storage: 128Mi volumeMode: Filesystem accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Delete storageClassName: local-storage local: path: /mysql-data nodeAffinity: required: nodeSelectorTerms: - matchExpressions: - key: kubernetes.io/hostname operator: In values: - worker-01 âš  æ³¨æ„ï¼š\n1ã€æŒ‡å®šäº²å’ŒèŠ‚ç‚¹åç§°ï¼Œç¤ºä¾‹ä¸­ä¸º worker-01ï¼›\n2ã€æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šéœ€è¦ç¡®ä¿æœ¬åœ°ç›®å½•æ˜¯å­˜åœ¨çš„ï¼Œç¤ºä¾‹ä¸­ä¸º /mysql-dataã€‚\nåˆ›å»º Pod # apiVersion: apps/v1 kind: StatefulSet metadata: name: mysql labels: app: mysql spec: selector: matchLabels: app: mysql serviceName: mysql replicas: 1 template: metadata: labels: app: mysql spec: containers: - name: mysql image: mysql:8.0 env: - name: MYSQL_ROOT_PASSWORD value: \u0026#34;123456\u0026#34; volumeMounts: - name: data mountPath: /var/lib/mysql restartPolicy: Always volumes: - name: data persistentVolumeClaim: claimName: mysql-local-pvc å‚è€ƒ # https://kubernetes.io/zh-cn/docs/concepts/storage/volumes/#local lovo é¡¹ç›® # åŸºäº local å­˜å‚¨å·å®ç°ä¸€ä¸ªæ§åˆ¶å™¨åŠ¨æ€ç®¡ç† PVã€‚\nÂ« Kubernetes 0-1 Podä¸­çš„livenessProbeå’ŒreadinessProbeè§£è¯»\nÂ» Kubernetes 0-1 K8sè‡ªå»ºLoadBalancer\n"},{"id":161,"href":"/kubernetes/metallb/","title":"Metallb","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 K8sè‡ªå»ºLoadBalancer\nKubernetes 0-1 K8sè‡ªå»ºLoadBalancer # Metallbä»‹ç» # ä¸€èˆ¬åªæœ‰äº‘å¹³å°æ”¯æŒLoadBalancerï¼Œå¦‚æœè„±ç¦»äº‘å¹³å°ï¼Œè‡ªå·±æ­å»ºçš„K8sé›†ç¾¤ï¼ŒServiceçš„ç±»å‹ä½¿ç”¨LoadBalanceræ˜¯æ²¡æœ‰ä»»ä½•æ•ˆæœçš„ã€‚ä¸ºäº†è®©ç§æœ‰ç½‘ç»œä¸­çš„K8sé›†ç¾¤ä¹Ÿèƒ½ä½“éªŒåˆ°LoadBalabcerï¼ŒMetallbæˆä¸ºäº†è§£å†³æ–¹æ¡ˆã€‚\nMetallbè¿è¡Œåœ¨K8sé›†ç¾¤ä¸­ï¼Œç›‘è§†é›†ç¾¤å†…LoadBalancerç±»å‹çš„æœåŠ¡ï¼Œç„¶åä»é…ç½®çš„IPæ± ä¸­ä¸ºå…¶åˆ†é…ä¸€ä¸ªå¯ç”¨IPï¼Œä»¥ARP/NDPæˆ–BGPçš„æ–¹å¼å°†å…¶å¹¿æ’­å‡ºå»ï¼Œè¿™ä¸ªå¯ç”¨IPæˆä¸ºäº†LoadBalancerçš„Urlï¼Œå¯ä¾›é›†ç¾¤å¤–è®¿é—®ã€‚\nMetallbæ­å»ºè¿‡ç¨‹ # åˆ›å»ºå‘½åç©ºé—´ metallb-systemï¼š\nvim metallb-namespace.yaml å†™å…¥æ–‡ä»¶å†…å®¹ï¼š\napiVersion: v1 kind: Namespace metadata: name: metallb-system ä¸‹è½½metallb.yamlæ–‡ä»¶\nwget https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/metallb.yaml -O metallb.yaml --no-check-certificate å®šä¹‰LoadBalancerçš„IPæ± ï¼Œå…ˆåˆ›å»ºconfigmap\nvim metallb-configMap.yaml å†™å…¥æ–‡ä»¶å†…å®¹ï¼š\napiVersion: v1 kind: ConfigMap metadata: namespace: metallb-system name: config data: config: | address-pools: - name: default protocol: layer2 addresses: - 192.168.115.140-192.168.115.199 æ³¨æ„ï¼šIPæ± çš„ç½‘ç»œéœ€è¦å’ŒK8sé›†ç¾¤çš„IPå¤„äºåŒä¸€ç½‘æ®µï¼Œæˆ‘çš„K8sé›†ç¾¤ç½‘ç»œæ˜¯192.168.115.13xï¼Œè¿™é‡ŒIPæ± åˆ™æ˜¯ç»™åˆ°192.168.115.140-192.168.115.199çš„èŒƒå›´ã€‚\næ‰§è¡Œå‘½ä»¤ï¼š\nkubectl apply -f metallb-namespace.yaml kubectl create secret generic -n metallb-system memberlist --from-literal=secretkey=\u0026#34;$(openssl rand -base64 128)\u0026#34; kubectl apply -f metallb.yaml kubectl apply -f metallb-configMap.yaml LoadBalanceræµ‹è¯• # æˆ‘ä»¬ä½¿ç”¨ç±»å‹ä¸ºLoadBalancerçš„Serviceè¿›è¡Œæµ‹è¯•ï¼Œä»¥nginxæœåŠ¡ä¸ºä¾‹ã€‚\nkubectl create deployment nginx --image=nginx kubectl expose deployment nginx --port=80 --type=LoadBalancer æŸ¥çœ‹nginxæœåŠ¡ï¼š\n[root@k8s-master01 test]# kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.0.0.1 \u0026lt;none\u0026gt; 443/TCP 11h nginx LoadBalancer 10.0.0.82 192.168.115.140 80:31610/TCP 8s å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»ä¸ºnginxæœåŠ¡åˆ†é…äº†ä¸€ä¸ª192.168.115.140 çš„IPï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚\nÂ« local å­˜å‚¨å·å®è·µ\nÂ» ä½¿ç”¨ nfs æŒä¹…åŒ–å­˜å‚¨\n"},{"id":162,"href":"/kubernetes/nfs-as-pvc/","title":"Nfs as Pvc","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / ä½¿ç”¨ nfs æŒä¹…åŒ–å­˜å‚¨\nä½¿ç”¨ nfs æŒä¹…åŒ–å­˜å‚¨ # ä¸€èˆ¬äº‘å¹³å°éƒ½ä¼šæä¾›äº‘å­˜å‚¨æœåŠ¡ï¼Œå¦‚ AWS EBS æœåŠ¡ï¼ŒK8s å¯ä»¥ç›´æ¥ä½¿ç”¨äº‘å­˜å‚¨æœåŠ¡åˆ›å»º PV å’Œ PVC ä½œä¸º Volume çš„å­˜å‚¨åç«¯ã€‚å‡è®¾ä½ æ²¡æœ‰ä½¿ç”¨åˆ°äº‘å­˜å‚¨ï¼Œé‚£ä¹ˆ NFS å¯èƒ½ä¼šé€‚åˆä½ ã€‚\nNFSï¼ˆNetwork File Systemï¼‰ï¼Œç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œå…è®¸è®¡ç®—æœºä¹‹é—´å…±äº«å­˜å‚¨èµ„æºï¼Œè¿™é‡Œä¹Ÿå°±ä¸å…·ä½“ä»‹ç»äº†ã€‚\néƒ¨ç½² nfs # ä»¥ä¸‹å‘½ä»¤éœ€è¦rootæƒé™ï¼Œç¤ºä¾‹ä¸­æœºå™¨IPä¸º192.168.115.137ã€‚\nå®‰è£… nfsï¼š # Ubuntu \u0026amp; Debian apt install nfs-kernel-server -y # CentOS yum install nfs-util -y åˆ›å»ºå…±äº«ç›®å½•ï¼š mkdir /nfs/data -p ä¿®æ”¹ nfs çš„é»˜è®¤é…ç½®ï¼Œåœ¨æ–‡æœ«æ·»åŠ é…ç½®ï¼š vim /etc/exports /nfs/data *(rw,sync,no_root_squash) å…¶ä¸­ï¼š\n/nfs/dataï¼šå…±äº«ç›®å½• *ï¼šå¯¹æ‰€æœ‰å¼€æ”¾è®¿é—®ï¼Œå¯ä»¥é…ç½®æˆç½‘æ®µï¼ŒIPï¼ŒåŸŸåç­‰ rwï¼šè¯»å†™æƒé™ syncï¼šæ–‡ä»¶åŒæ—¶å†™å…¥ç£ç›˜å’Œå†…å­˜ no_root_squashï¼šå½“ç™»å½• NFS ä¸»æœºä½¿ç”¨å…±äº«ç›®å½•çš„ä½¿ç”¨è€…æ˜¯ root æ—¶ï¼Œå…¶æƒé™å°†è¢«è½¬æ¢æˆä¸ºåŒ¿åä½¿ç”¨è€…ï¼Œé€šå¸¸å®ƒçš„ UID ä¸ GIDï¼Œéƒ½ä¼šå˜æˆ nobody èº«ä»½ é‡å¯ rpcï¼Œnfs éœ€è¦å‘ rpc æ³¨å†Œï¼š systemctl restart rpcbind.service systemctl enable rpcbind.service é‡å¯ nfs æœåŠ¡ï¼š systemctl restart nfs-kernel-server.service systemctl enable nfs-kernel-server.service æŒ‚è½½å…±äº«ï¼Œåœ¨ fstab æ–‡ä»¶ä¸­æ·»åŠ é…ç½®ï¼š vim /etc/fstab 192.168.115.137:/nfs/data /nfs/data nfs rw,tcp,soft 0 0 åˆ›å»º PV # PersistentVolume ä½œä¸º K8s çš„å­˜å‚¨èµ„æºï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå®ƒå®šä¹‰ apacityï¼ˆå­˜å‚¨èƒ½åŠ›ï¼‰ï¼ŒaccessModesï¼ˆè®¿é—®æ¨¡å¼ï¼‰persistentVolumeReclaimPolicyï¼ˆå›æ”¶ç­–ç•¥ï¼‰ï¼Œå­˜å‚¨åª’ä»‹ç­‰ä¿¡æ¯ã€‚\nä¸‹é¢å®šä¹‰äº†ä¸€ä¸ª pv èµ„æºï¼Œæ–‡ä»¶åä¸º pv1.yaml\napiVersion: v1 kind: PersistentVolume metadata: name: pv1 spec: capacity: storage: 1Gi accessModes: - ReadWriteOnce persistentVolumeReclaimPolicy: Recycle nfs: path: /nfs/data server: 192.168.115.137 éœ€è¦å¯¹ AccessModes å’Œ PersistentVolumeReclaimPolicy åšç®€å•çš„æšä¸¾ä»‹ç»ï¼š\nAccessModes è®¿é—®æ¨¡å¼ # è®¾ç½®å¯¹ PV å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™ï¼š\nReadWriteOnceï¼ˆRWOï¼‰ï¼šè¯»å†™æƒé™ï¼Œåªèƒ½è¢«å•ä¸ªå®ä¾‹æŒ‚è½½\nReadOnlyManyï¼ˆROXï¼‰ï¼šåªè¯»æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªå®ä¾‹æŒ‚è½½\nReadWriteManyï¼ˆRWXï¼‰ï¼šè¯»å†™æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªå®ä¾‹æŒ‚è½½\nPersistentVolumeReclaimPolicy å›æ”¶ç­–ç•¥ # å½“æŒ‚è½½å®ä¾‹è¢«åˆ é™¤æ—¶ï¼Œè®¾ç½®å¯¹ PV å­˜å‚¨èµ„æºçš„å›æ”¶ç­–ç•¥ï¼š\nRetainï¼šä¿ç•™ Recycleï¼šæ¸…é™¤ Deleteï¼šåˆ é™¤ï¼Œä¸€èˆ¬ç”¨äºäº‘å­˜å‚¨æœåŠ¡åˆ é™¤å¯¹åº”çš„èµ„æºï¼Œå¦‚ AWS çš„ EBS ç°åœ¨åˆ›å»º pv:\nkubectl apply -f pv1.yaml æŸ¥çœ‹ pvï¼Œå¯ä»¥çœ‹åˆ°å½“å‰ pv1 çš„ STATUS ä¸º Available:\nkubectl get pv NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE pv1 1Gi RWO Recycle Available 48s è¿™é‡Œä¹Ÿéœ€è¦å¯¹ PV çš„çŠ¶æ€ä½œä¸‹ç®€å•ä»‹ç»ï¼š\nStatus # PV çš„ç”Ÿå‘½å‘¨æœŸåŒ…å«äº†å››ä¸ªé˜¶æ®µï¼š\nAvaliableï¼šå½“å‰æœªç»‘å®š PVCï¼Œå¤„äºå¯ç”¨çŠ¶æ€\nBoundï¼šå·²ç»è¢« PVC ç»‘å®šï¼Œä¸å¯ç”¨\nReleasedï¼šä¹‹å‰è¢« PVC ç»‘å®šï¼ŒPVC åˆ é™¤æ—¶ï¼ŒPV ä¼šè¢«é‡æ–°å£°æ˜ï¼Œå¾ˆçŸ­æš‚çš„ä¸€æ®µæ—¶é—´å†…å¤„äº Released çŠ¶æ€\nFailedï¼šPV è‡ªåŠ¨å›æ”¶å¤±è´¥\nåˆ›å»º PVC # ä¸‹é¢å®šä¹‰äº†ä¸€ä¸ª pvc èµ„æºï¼Œæ–‡ä»¶åä¸º pvc1.yaml\napiVersion: v1 kind: PersistentVolumeClaim metadata: name: pvc1 spec: accessModes: - ReadWriteOnce resources: requests: storage: 1Gi ç°åœ¨åˆ›å»º pvc\nkubectl apply -f pvc1.yaml æŸ¥çœ‹ PVCï¼Œå¯ä»¥çœ‹åˆ° pvc1 å·²ç»å¤„äº Bound çš„çŠ¶æ€ï¼Œè¯´æ˜å®ƒå·²ç»ç»‘å®šä¸Šäº†ä¸€ä¸ª PVï¼Œè€Œæˆ‘ä»¬ç›®å‰åªåˆ›å»ºäº†ä¸€ä¸ªåä¸º pv1 çš„ PV\nNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE pvc1 Bound pv1 1Gi RWO 3s å†æ¬¡æŸ¥çœ‹ PVï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è¢« pvc1 ç»‘å®šäº†ã€‚\nNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE pv1 1Gi RWO Recycle Bound default/pvc1 2m ç¡®å®å¦‚æˆ‘ä»¬æ‰€æƒ³ï¼Œpv1 è¢« pvc1 ç»‘å®šï¼Œå¹¶ä¸” pv1 çš„çŠ¶æ€ä¹Ÿæ›´æ–°æˆäº† Boundã€‚å…¶å®è¿™æ˜¯é›†ç¾¤è‡ªåŠ¨ä¸ºæˆ‘ä»¬çš„ PVC å¯»æ‰¾åˆ°çš„ç¬¦åˆæ¡ä»¶çš„ PVï¼š\nå½“å‰çŠ¶æ€å¤„äº Avaliable çš„ PV PV å®¹é‡ \u0026gt;= PVC ç”³è¯·å®¹é‡ pvc å’Œ pv çš„ AccessMode éœ€è¦ä¸€è‡´ å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨ä¸º PVC æŒ‡å®šç»‘å®šçš„ PVã€‚\nå®šä¹‰ PVï¼š\n... kind: PersistentVolume metadata: labels: app: pv1 .... å®šä¹‰ PVCï¼š\n... kind: PersistentVolumeClaim spec: selector: matchLabels: app: pv1 ... Volume ä½¿ç”¨ PVC # ... volumes: - name: www persistentVolumeClaim: claimName: pvc1 ... Â« Kubernetes 0-1 K8sè‡ªå»ºLoadBalancer\nÂ» Kubernetes 0-1 äº†è§£ Pod\n"},{"id":163,"href":"/kubernetes/pod-understood/","title":"Pod Understood","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 äº†è§£ Pod\nKubernetes 0-1 äº†è§£ Pod # Pod ä»‹ç» # Podï¼Œæ˜¯ K8s å¯¹è±¡æ¨¡å‹ä¸­çš„æœ€å°å•å…ƒï¼ŒPod é‡Œé¢åŒ…å«ç€ä¸€ç»„å®¹å™¨ï¼ˆå•ä¸ªå®¹å™¨æˆ–å¤šä¸ªç´§å¯†è€¦åˆçš„å®¹å™¨ï¼‰ï¼Œè¿™æ—¶å€™ Pod å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœºå™¨ï¼Œè€Œ Pod é‡Œé¢çš„å®¹å™¨åˆ™ç†è§£ä¸ºè¯¥æœºå™¨é‡Œé¢çš„è¿›ç¨‹ã€‚\nPod çš„å®¹å™¨è¿è¡Œæ—¶ç”±å®¹å™¨å¼•æ“æä¾›ï¼Œé»˜è®¤çš„å®¹å™¨å¼•æ“æ˜¯ Dockerï¼›å¹¶ä¸” K8s ç®¡ç†çš„æ˜¯ Podï¼Œè€Œä¸æ˜¯å®¹å™¨ã€‚\nä¸€ä¸ª Pod å†…éƒ¨çš„å®¹å™¨å…±äº«ï¼š\nå­˜å‚¨ï¼šä¸€ä¸ª Pod å¯ä»¥æŒ‡å®šä¸€ç»„å…±äº«å­˜å‚¨å·ã€‚ ç½‘ç»œï¼šæ¯ä¸ª Pod åˆ†é…ä¸€ä¸ªå”¯ä¸€ IPï¼ˆé›†ç¾¤å†… IPï¼‰ï¼Œå…±äº«ç½‘ç»œå‘½åç©ºé—´ï¼ŒåŒ…æ‹¬ IP åœ°å€å’Œç½‘ç»œç«¯å£ã€‚Pod å†…çš„å®¹å™¨å¯ä»¥ä½¿ç”¨ localhost äº’ç›¸é€šä¿¡ï¼Œé›†ç¾¤å†… Pod ä¸ Podé€šä¿¡å¯ä»¥ä½¿ç”¨ Pod åˆ†é…çš„ IPï¼Œä½†æ˜¯ç”±äº Pod çš„ IP æ˜¯éšæœºåˆ†é…çš„ï¼Œè¿™ç§äº’é€šä¿¡çš„æ–¹å¼ä¸å¤ªé€‚åˆä½¿ç”¨ã€‚ å°½ç®¡ä¸€ä¸ª Pod å†…å¯ä»¥åŒ…å«å¤šä¸ª Podï¼Œä½†æˆ‘ä»¬åœ¨éƒ¨ç½²åº”ç”¨å®¹å™¨æ—¶çš„æœ€ä½³å®è·µæ˜¯ä¸€ä¸ª Pod é‡Œé¢åªåŒ…å«ä¸€ä¸ªåº”ç”¨å®¹å™¨ä½œä¸ºä¸»å®¹å™¨ï¼Œå…¶ä»–å®¹å™¨ä¸ºä¸»å®¹å™¨æœåŠ¡ï¼Œç§°ä¹‹ä¸ºè¾…åŠ©å®¹å™¨ã€‚ä¾‹å¦‚ä¸»å®¹å™¨å´©æºƒäº†ï¼Œä¼šæœ‰ä¸€ä¸ªè¾…åŠ©å®¹å™¨å»é‡å¯ä¸»å®¹å™¨ã€‚è¾…åŠ©å®¹å™¨å¯ä»¥æœ‰ä¹Ÿå¯ä»¥æ²¡æœ‰ï¼Œå› ä¸º Pod é‡Œé¢å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥è¢« Pod çš„ç”Ÿå‘½å‘¨æœŸå–ä»£ï¼Œè€Œ Pod çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥é€šè¿‡ Pod ç®¡ç†å™¨æ¥ç®¡ç†ç»´æŠ¤ã€‚\nå°†æˆ‘ä»¬åº”ç”¨æœåŠ¡éš”ç¦»å•ç‹¬éƒ¨ç½²åœ¨ Pod çš„å¥½å¤„å¯ä»¥ç½—åˆ—ä»¥ä¸‹ï¼š\nPod å¯ä»¥åˆ†åˆ«çš„è°ƒåº¦åˆ°å„ä¸ª K8s èŠ‚ç‚¹ï¼Œå……åˆ†åˆ©ç”¨äº†èŠ‚ç‚¹çš„è®¡ç®—èµ„æºï¼› æ–¹ä¾¿æˆ‘ä»¬å•ç‹¬ä¸ºæŸä¸ªåº”ç”¨æœåŠ¡åšæ‰©ç¼©æ“ä½œã€‚ Pod åˆ›å»º # åœ¨K8sé›†ç¾¤ä¸­ä¸€èˆ¬ä¸ä¼šç›´æ¥å•ç‹¬åˆ›å»º Podï¼Œè€Œæ˜¯é€šè¿‡ Pod ç®¡ç†å™¨ã€‚å¦‚æœå•ç‹¬åˆ›å»º Podï¼ŒPodçš„è¿›ç¨‹è¢«ç»“æŸçš„è¯ï¼ŒPod å°±æ°¸è¿œè¢«åˆ é™¤ï¼›ä½¿ç”¨ Pod ç®¡ç†å™¨åˆ›å»ºå‡ºæ¥çš„Podï¼ŒPod ç®¡ç†å™¨ä¼šè´Ÿè´£ä¿è¯PodæŒ‰æœŸè°ƒåº¦ï¼Œå³ä½¿ Pod è¢«åˆ é™¤ï¼Œä¹Ÿä¼šé‡æ–°è¢«è°ƒåº¦èµ·æ¥ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒPod çš„ç”Ÿå­˜ç”± Pod ç®¡ç†å™¨å…¨æƒè´Ÿè´£ã€‚\nPod ç®¡ç†å™¨åŒ…å«å¾ˆå¤šç§ï¼Œç”±å¾ˆæ—©çš„ ReplicationController è¿‡æ¸¡åˆ° ReplicaSet å†è¿‡æ¸¡åˆ°å½“å‰æ™®éä½¿ç”¨çš„ Deploymentï¼Œå…¶å®è¿™ä¸‰è€…èƒ½åšçš„äº‹æƒ…æ˜¯ç±»ä¼¼çš„ï¼Œéƒ½æ˜¯è°ƒåº¦å’Œç›‘è§† Pod åˆ—è¡¨ï¼Œä¿è¯ Pod åˆ—è¡¨ä¸å£°æ˜çš„æ•°é‡å’Œå…¶ä»–æœŸæœ›ç›¸ç¬¦ã€‚\né™¤æ­¤ä¹‹å¤–è¿˜æœ‰å…¶ä»–çš„ç®¡ç†å™¨ï¼š\nStatefuleSetï¼šå¸¦çŠ¶æ€çš„ Pod ç®¡ç†å™¨ï¼Œéœ€è¦æŒä¹…å­˜å‚¨æ•°æ®ï¼Œä¸€èˆ¬ç”¨äºåˆ›å»ºæ•°æ®åº“ç±»å‹çš„åº”ç”¨å®ä¾‹ï¼Œå¦‚ mysqlï¼Œredisï¼› DaemonSetï¼šæ¯ä¸ªç¬¦åˆæ¡ä»¶çš„Nodeéƒ½åˆ†é…ä¸€ä¸ª Podï¼Œä¸€èˆ¬ç”¨äºåˆ›å»º agent æœåŠ¡ï¼Œå¦‚æ—¥å¿—æ”¶é›†ç»„ä»¶ï¼ŒæŒ‡æ ‡æ•°æ®æ”¶é›†ç»„ä»¶ç­‰ã€‚ ä¸€èˆ¬é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ›å»º Pod\nå•è¡Œå‘½ä»¤åˆ›å»º Pod kubectl run nginx --image=nginx:latest --replicas=2 ä»¥ä¸Šå‘½ä»¤å®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ª Deployment èµ„æºå’Œç”±å…¶ç®¡ç†çš„ 2 ä¸ª Podã€‚\nå®šä¹‰èµ„æºæ¸…å•ï¼Œåˆ›å»º Pod ä»¥yamlæˆ–è€…jsonæ ¼å¼å®šä¹‰ Pod èµ„æºï¼Œå¤§éƒ½é€‰æ‹© yamlã€‚å¦‚æœä½ ä½¿ç”¨VSCodeçš„è¯ï¼Œé‚£ä¹ˆ Kubernetes Support æ’ä»¶ä¼šæˆä¸ºä½ çš„åˆ©å™¨ã€‚\næˆ‘ä»¬å…ˆå®šä¹‰ä¸ªä¸€ä¸ª Pod çš„èµ„æºæ–‡ä»¶ pod-sample.yamlï¼š\napiVersion: v1 kind: Pod metadata: name: nginx labels: name: nginx spec: containers: - name: nginx image: nginx imagePullPolicy: Always restartPolicy: Never resources: requests: memory: \u0026#34;128Mi\u0026#34; cpu: \u0026#34;256m\u0026#34; limits: memory: \u0026#34;256Mi\u0026#34; cpu: \u0026#34;512m\u0026#34; ports: - containerPort: 80 ä»¥ä¸Šæ˜¯ä¸€ä¸ªç®€å•çš„Podå®šä¹‰æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªæ–‡ä»¶å¾—åˆ°è¿™äº›ä¿¡æ¯ï¼š\nè¿è¡Œnginxé•œåƒï¼Œä½œä¸ºPodçš„ä¸»å®¹å™¨ï¼Œå‘å¤–æš´éœ²80ç«¯å£ï¼› æ¯æ¬¡å¯åŠ¨è¿™ä¸ªPodéƒ½ä¼šä»ç½‘ç»œæ‹‰å–é•œåƒï¼› å¦‚æœä¸»å®¹å™¨ä¸å°å¿ƒæŒ‚äº†ï¼Œåˆ™ä¸ä¼šè¢«é‡å¯ï¼› å®¹å™¨å¯åŠ¨éœ€è¦çš„æœ€å°èµ„æºå’Œè¿è¡Œæœ€å¤§èµ„æºã€‚ ç„¶åé€šè¿‡ kubectl å‘½ä»¤åˆ›å»ºï¼ˆä¸‹é¢è¿™è¡Œå‘½ä»¤ä¹Ÿé€‚ç”¨äºæ›´æ–° Podï¼‰ï¼š\nkubectl apply -f pod-sample.yaml æŸ¥çœ‹Podï¼š\nkubectl get pod -o wide é€šè¿‡æŸ¥çœ‹ Pod çš„æè¿°ã€Pod é‡Œé¢å®¹å™¨çš„è¿è¡Œæ—¥å¿—ï¼Œæˆ–ç›´æ¥è¿›å…¥ Pod å®¹å™¨åˆ†æå®šä½é—®é¢˜ï¼š\n# æè¿° Pod è¯¦æƒ… kubectl describe pod \u0026lt;POD_NAME\u0026gt; # æŸ¥çœ‹ Pod å®¹å™¨æ§åˆ¶å°è¿è¡Œæ—¥å¿— kubectl logs \u0026lt;POD_NAME\u0026gt; # è¿›å…¥ Pod kubectl exec -it \u0026lt;POD_NAME\u0026gt; -c \u0026lt;CONTAINER_NAME\u0026gt; -- \u0026lt;COMMAND\u0026gt; åˆ é™¤ Podï¼š\nkubectl delete -f pod-sample.yaml kubectl delete pod \u0026lt;POD_NAME\u0026gt; Pod å­—æ®µ # é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®šä¹‰ Pod èµ„æºçš„å­—æ®µå³ä½œç”¨ï¼š\nkubectl explain pod kubectl explain pod.spec å¯¹ä¸€äº›å­—æ®µç®€å•ä»‹ç»ä¸€ä¸‹ï¼š\nimagePullPolicy # é•œåƒæ‹‰å–ç­–ç•¥ï¼Œæœ‰ä¸‰ç§ï¼ŒAlwaysã€IfNotPresentã€Never\nAlwaysï¼šæ¯æ¬¡éƒ½æ‹‰å–æœ€æ–°é•œåƒï¼Œé»˜è®¤ç­–ç•¥ï¼› IfNotPresentï¼šå¦‚æœ Pod è¢«è°ƒåº¦çš„Nodeä¸Šå·²ç»å­˜åœ¨é•œåƒäº†åˆ™ç›´æ¥ä½¿ç”¨é•œåƒï¼Œä¸å­˜åœ¨åœ¨æ‹‰å–ï¼› Neverï¼šåªä½¿ç”¨ Node ä¸Šçš„é•œåƒï¼Œå³ä½¿ä¸å­˜åœ¨ä¹Ÿä¸æ‹‰å–ã€‚ restartPolicy # Pod é‡å¯ç­–ç•¥ï¼Œæœ‰ä¸‰ç§ï¼šAlwaysã€OnFaliureã€Never\nAlwaysï¼šPod åªè¦ç»ˆæ­¢è¿è¡Œï¼Œkubelet å°±ä¼šé‡å¯å®ƒï¼› OnFaliureï¼šPodéæ­£å¸¸ç»ˆæ­¢ï¼Œé€€å‡ºç ä¸ä¸ºé›¶ï¼Œkubelet å°±ä¼šé‡å¯å®ƒï¼Œæ­£å¸¸é€€å‡ºä¸ä¼šé‡å¯ï¼› Neverï¼šé€€å‡ºäº†å°±ä¸é‡å¯ã€‚ nodeSelector # å®šä¹‰Lableå¯¹ï¼Œé€‰æ‹©è°ƒåº¦åˆ°æ‹¥æœ‰è¯¥ Label å¯¹çš„ Node èŠ‚ç‚¹ã€‚\nlivenessProbe # å­˜æ´»æŒ‡é’ˆï¼Œå¯ä»¥ç†è§£ä¸º Pod å†…å®¹å™¨è¿è¡Œçš„å¥åº·æ£€æŸ¥ï¼Œå¦‚æœå¥åº·æ£€æŸ¥æ²¡é€šè¿‡ï¼Œåˆ™é‡å¯ Pod å†…å®¹å™¨ï¼Œè¿™é‡Œé¢çš„å†…å®¹æœ‰ç‚¹å¤šï¼Œæœ‰æœºä¼šè¯¦ç»†è®²ã€‚\nreadinessProbe # å°±ç»ªæŒ‡é’ˆï¼Œä¹Ÿæ˜¯é€šè¿‡å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œå¯¹å¤–å‘ˆç° Pod çš„å°±ç»ªçŠ¶æ€ï¼Œå¦‚æœå¥åº·æ£€æŸ¥é€šè¿‡ï¼ŒPod çŠ¶æ€ä¸ºå°±ç»ªï¼Œå¯ä»¥æ¥å—å¤–éƒ¨æµé‡è¯·æ±‚ã€‚æµé‡æ— æ³•è½¬å‘åˆ°éå°±ç»ªçŠ¶æ€çš„ Podã€‚\ncommand # å®¹å™¨å¯åŠ¨æ—¶çš„å‘½ä»¤åˆ—è¡¨ï¼Œå’Œ Dockerfile ä¸­å®šä¹‰çš„ CMD ä½œç”¨ä¸€æ ·ã€‚\nargs # å®¹å™¨å¯åŠ¨å‘½ä»¤çš„å‚æ•°ã€‚\nenv # å®¹å™¨å†…çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ï¼Œå’Œ Dockerfile ä¸­å®šä¹‰çš„ ENV ä½œç”¨ä¸€æ ·ã€‚\nresource # å¯ä»¥å®šä¹‰å®¹å™¨å¯åŠ¨çš„æœ€å°å­—æ®µå’Œè¿è¡Œæœ€å¤§åˆ†é…èµ„æºï¼Œå¯¹ Pod çš„èµ„æºä½¿ç”¨çš„æ§åˆ¶ã€‚\nPod æ—¥å¿— # kubelet å®šä¹‰äº† pod çš„æ—¥å¿—è·¯å¾„ï¼Œå®¿ä¸»æœºç›®å½•ï¼š\n/var/log/pods/\u0026lt;pod-namespace\u0026gt;_\u0026lt;pod-name\u0026gt;_\u0026lt;pod-uid\u0026gt;/\u0026lt;contianer name\u0026gt;/\u0026lt;restart count\u0026gt;.log æ—¥å¿—æ–‡ä»¶åä¸º 0.logï¼Œ1.log\u0026hellip;ï¼Œè¿™é‡Œæ•°å­—ä½¿ç”¨çš„æ˜¯å®¹å™¨é‡å¯çš„æ¬¡æ•°ã€‚\nÂ« ä½¿ç”¨ nfs æŒä¹…åŒ–å­˜å‚¨\nÂ» Kubernetes ç¼–ç¨‹\n"},{"id":164,"href":"/kubernetes/prgramming-kubernetes/","title":"Prgramming Kubernetes","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes ç¼–ç¨‹\nKubernetes ç¼–ç¨‹ # å¼€å§‹ Kuberntes ç¼–ç¨‹ä¹‹æ—…ï½\nmkdir programming-kubernetes \u0026amp;\u0026amp; cd programming-kubernetes git mod init programming-kubernetes å¸¸ç”¨åŒ…ï¼š\nkubeconfig å¯¹åº”çš„ç»“æ„ clientcmdapi \u0026#34;k8s.io/client-go/tools/clientcmd/api\u0026#34; clientcmdapi.Config ç¼–å†™è‡ªå®šä¹‰ API # éšæœºç”Ÿæˆå­—ç¬¦ \u0026#34;k8s.io/apimachinery/pkg/util/rand\u0026#34; rand.String(5) å‚è€ƒï¼š\nkubernetes/code-generator: Generators for kube-like API types (github.com)\ncode-generator ä½¿ç”¨\nBç«™ code-generator ä»‹ç»\nmkdir hack vim hack/boilerplate.go.txt /* Copyright 2022 programming-kubernetes. Licensed under the Apache License, Version 2.0 (the \u0026#34;License\u0026#34;); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \u0026#34;AS IS\u0026#34; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. */ mkdir -p pkg/apis/demo/v1alpha vim pkg/apis/demo/v1alpha/doc.go /* Copyright 2022 programming-kubernetes. Licensed under the Apache License, Version 2.0 (the \u0026#34;License\u0026#34;); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \u0026#34;AS IS\u0026#34; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. */ // +k8s:deepcopy-gen=package // +groupName=demo.pk.io package v1alpha1 æ–‡ä»¶åç§°ä¸€å®šè¦æ˜¯ doc.goï¼Œè¦ä¸ç„¶æ— æ³•æˆåŠŸç”Ÿæˆ deepcopy ä»£ç ï¼›\n// +groupName=demo.pk.ioï¼Œå°†æ ¹æ®è¯¥æ³¨é‡Šåœ¨ client ä¸­ç”Ÿæˆå¯¹åº”çš„ç»„\nvim pkg/apis/demo/v1alpha/types.go /* Copyright 2022 programming-kubernetes. Licensed under the Apache License, Version 2.0 (the \u0026#34;License\u0026#34;); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \u0026#34;AS IS\u0026#34; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. */ package v1alpha1 import ( corev1 \u0026#34;k8s.io/api/core/v1\u0026#34; metav1 \u0026#34;k8s.io/apimachinery/pkg/apis/meta/v1\u0026#34; ) // +genclient // +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object // Foo - type Foo struct { metav1.TypeMeta `json:\u0026#34;,inline\u0026#34;` metav1.ObjectMeta `json:\u0026#34;metadata,omitempty\u0026#34; protobuf:\u0026#34;bytes,1,opt,name=metadata\u0026#34;` Spec FooSpec `json:\u0026#34;spec,omitempty\u0026#34; protobuf:\u0026#34;bytes,2,opt,name=spec\u0026#34;` Status FooStatus `json:\u0026#34;status,omitempty\u0026#34; protobuf:\u0026#34;bytes,3,opt,name=status\u0026#34;` } // +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object type FooList struct { metav1.TypeMeta `json:\u0026#34;,inline\u0026#34;` metav1.ListMeta `json:\u0026#34;metadata,omitempty\u0026#34; protobuf:\u0026#34;bytes,1,opt,name=metadata\u0026#34;` Items []Foo `json:\u0026#34;items\u0026#34; protobuf:\u0026#34;bytes,2,rep,name=items\u0026#34;` } type FooSpec struct { Name string `json:\u0026#34;name\u0026#34; protobuf:\u0026#34;bytes,1,opt,name=name\u0026#34;` Desc string `json:\u0026#34;desc\u0026#34; protobuf:\u0026#34;bytes,2,opt,name=desc\u0026#34;` } type FooStatus struct { Conditions []FooCondition `json:\u0026#34;conditions,omitempty\u0026#34; protobuf:\u0026#34;bytes,1,rep,name=conditions\u0026#34;` } type FooCondition struct { // Type of team condition. Type FooConditionType `json:\u0026#34;type\u0026#34; protobuf:\u0026#34;bytes,1,opt,name=type,casttype=TeamConditionType\u0026#34;` // Status of the condition, one of True, False, Unknown. Status corev1.ConditionStatus `json:\u0026#34;status\u0026#34; protobuf:\u0026#34;bytes,2,opt,name=status,casttype=k8s.io/api/core/v1.ConditionStatus\u0026#34;` // Last time the condition transitioned from one status to another. // +optional LastTransitionTime metav1.Time `json:\u0026#34;lastTransitionTime,omitempty\u0026#34; protobuf:\u0026#34;bytes,3,opt,name=lastTransitionTime\u0026#34;` // The reason for the condition\u0026#39;s last transition. // +optional Reason string `json:\u0026#34;reason,omitempty\u0026#34; protobuf:\u0026#34;bytes,4,opt,name=reason\u0026#34;` // A human readable message indicating details about the transition. // +optional Message string `json:\u0026#34;message,omitempty\u0026#34; protobuf:\u0026#34;bytes,5,opt,name=message\u0026#34;` } type FooConditionType string vim pkg/apis/demo/v1alpha/register.go /* Copyright 2022 Ketches. Licensed under the Apache License, Version 2.0 (the \u0026#34;License\u0026#34;); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \u0026#34;AS IS\u0026#34; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. */ package v1alpha1 import ( metav1 \u0026#34;k8s.io/apimachinery/pkg/apis/meta/v1\u0026#34; \u0026#34;k8s.io/apimachinery/pkg/runtime\u0026#34; \u0026#34;k8s.io/apimachinery/pkg/runtime/schema\u0026#34; ) var SchemeGroupVersion = schema.GroupVersion{Group: \u0026#34;demo.pk.io\u0026#34;, Version: \u0026#34;v1alpha1\u0026#34;} var ( SchemeBuilder runtime.SchemeBuilder localSchemeBuilder = \u0026amp;SchemeBuilder AddToScheme = localSchemeBuilder.AddToScheme ) func init() { // We only register manually written functions here. The registration of the // generated functions takes place in the generated files. The separation // makes the code compile even when the generated files are missing. localSchemeBuilder.Register(addKnownTypes) } // Resource takes an unqualified resource and returns a Group qualified GroupResource func Resource(resource string) schema.GroupResource { return SchemeGroupVersion.WithResource(resource).GroupResource() } // Adds the list of known types to the given scheme. func addKnownTypes(scheme *runtime.Scheme) error { scheme.AddKnownTypes(SchemeGroupVersion, \u0026amp;Foo{}, \u0026amp;FooList{}, ) scheme.AddKnownTypes(SchemeGroupVersion, \u0026amp;metav1.Status{}, ) metav1.AddToGroupVersion(scheme, SchemeGroupVersion) return nil } éœ€è¦åœ¨æœºå™¨ä¸Šå…‹éš†ä¸‹ k8s.io/code-generator ä»“åº“ï¼š\nmkdir -p $GOPATH/src/k8s.io \u0026amp;\u0026amp; cd $GOPATH/src/k8s.io git clone https://github.com/kubernetes/code-generator.git å›åˆ° programming-kubernetes/hack é¡¹ç›®ç›®å½•ï¼š\nmkdir hack \u0026amp;\u0026amp; cd hack vim update-codegen.sh #!/usr/bin/env bash # Copyright 2022 Ketches. # Licensed under the Apache License, Version 2.0 (the \u0026#34;License\u0026#34;); # you may not use this file except in compliance with the License. # You may obtain a copy of the License at # http://www.apache.org/licenses/LICENSE-2.0 # Unless required by applicable law or agreed to in writing, software # distributed under the License is distributed on an \u0026#34;AS IS\u0026#34; BASIS, # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. # See the License for the specific language governing permissions and # limitations under the License. set -o errexit set -o nounset set -o pipefail SCRIPT_ROOT=$(dirname \u0026#34;${BASH_SOURCE[0]}\u0026#34;)/.. # generate the code with: # - --output-base because this script should also be able to run inside the vendor dir of # k8s.io/kubernetes. The output-base is needed for the generators to output into the vendor dir # instead of the $GOPATH directly. For normal projects this can be dropped. ~/go/src/k8s.io/code-generator/generate-groups.sh \\ all \\ programming-kubernetes/pkg/client \\ programming-kubernetes/pkg/apis \\ \u0026#34;demo.dev:v1alpha1\u0026#34; \\ --output-base ${SCRIPT_ROOT}/.. \\ --go-header-file ${SCRIPT_ROOT}/hack/boilerplate.go.txt \u0026ldquo;demo:v1alpha1\u0026rdquo; éœ€è¦ä¿æŒ api çš„ç›®å½•ä¸€è‡´ï¼Œè€Œä¸æ˜¯ groupname\nå¦‚æœé¡¹ç›® mod åç§°ä¸­åŒ…å« â€œ/â€ï¼Œé‚£ä¹ˆé¡¹ç›®ä¹Ÿéœ€è¦æ”¾åœ¨å®Œæ•´çš„ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ mod åç§°ä¸º github.com/poneding/programming-kubernetesï¼Œé‚£ä¹ˆé¡¹ç›®ä¸€å®šè¦æ”¾åœ¨ [..]/github.com/poneding/programming-kubernetes ä¸‹ï¼Œæ­¤æ—¶ --output-base ä¹Ÿéœ€è¦è°ƒæ•´ï¼Œéœ€è¦å¢åŠ ç›®å½•æŸ¥æ‰¾é•¿åº¦ ${SCRIPT_ROOT}/../../..ã€‚\næµ‹è¯•ä½¿ç”¨è‡ªå®šä¹‰ API çš„ clientï¼Œinfromerï¼Œlister ç­‰ï¼š\n# programming-kubernets é¡¹ç›®ç›®å½• mkdir -p manifests/crd vim manitests/crd/demo-foo.yaml å®‰è£… controller-gen å·¥å…·\ngo install sigs.k8s.io/controller-tools/cmd/controller-gen@latest ç”Ÿæˆ crd yaml æ–‡ä»¶\ncontroller-gen Â« Kubernetes 0-1 äº†è§£ Pod\nÂ» Prometheus-ç›‘æ§Kongå®Œæ•´æ“ä½œ\n"},{"id":165,"href":"/kubernetes/prometheus-collect-kong-metrics/","title":"Prometheus Collect Kong Metrics","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Prometheus-ç›‘æ§Kongå®Œæ•´æ“ä½œ\nPrometheus-ç›‘æ§Kongå®Œæ•´æ“ä½œ # æœ¬ç¯‡è®°å½•ä½¿ç”¨Prometheusæ”¶é›†Kongæš´éœ²çš„/metricsæ¥å£ï¼Œæ”¶é›†æŒ‡æ ‡æ•°æ®ï¼Œä»è€Œå®ç°å¯¹Kongçš„ç›‘æ§ã€‚\nå…ˆå†³æ¡ä»¶ # Prometheuséƒ¨ç½²å®Œæˆï¼› Kongï¼ˆKong æœåŠ¡ï¼Œç«¯å£8000ï¼‰éƒ¨ç½²å®Œæˆï¼› Kong çš„Admin Apiï¼ˆç«¯å£8001ï¼‰éƒ¨ç½²å®Œæˆ Kongaï¼ˆKongçš„WebUIï¼Œç«¯å£1337ï¼‰éƒ¨ç½²å®Œæˆã€‚ Kongæ·»åŠ Prometheusæ’ä»¶ # ç™»å½•è¿›å…¥Kongaï¼› ç‚¹å‡»å³è¾¹èœå•æ â€PLUGINSâ€œï¼Œè¿›å…¥Pluginsç®¡ç†ï¼Œç‚¹å‡»â€œAnalytics \u0026amp; Monitoringâ€ï¼Œé€‰æ‹©æ·»åŠ Promethusæ’ä»¶ Kongæ·»åŠ metricsæ¥å£ # æˆ‘ä»¬çŸ¥é“Prometheusä¸»è¦é€šè¿‡è¯»å– http://host/metricsæ¥å£, æ¥æ”¶é›†ç›¸å…³æœåŠ¡çš„æ€§èƒ½æ•°æ®ï¼Œä½†æ˜¯Kongçš„metricsæ¥å£æœåŠ¡é»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œæ‰€ä»¥éœ€è¦å…ˆä¸ºKongæ·»åŠ /metricsã€‚\nç™»å½•è¿›å…¥Kongaï¼› ç‚¹å‡»å³è¾¹èœå•æ â€SERVICESâ€œï¼Œè¿›å…¥Servicesç®¡ç†ï¼Œç‚¹å‡»â€œADD NEW SERVICEâ€ æ·»åŠ é¡µé¢è¾“å…¥â€œNameâ€å’Œâ€œUrlâ€å‚æ•°å³å¯ï¼Œä¾‹å¦‚â€œNameâ€=â€œprometheusServiceâ€ï¼Œâ€œUrlâ€=â€œ http://localhost:8001/metricsâ€ æ·»åŠ å®ŒPrometheus Serviceä¹‹åï¼ŒServiceåˆ—è¡¨é€‰ä¸­å¹¶ç‚¹å‡»è¿›å…¥prometheusServiceï¼Œé€‰æ‹©â€Routesâ€œèœå•ï¼Œç‚¹å‡»â€œADD ROUTEâ€ æ·»åŠ é¡µé¢è¾“å…¥â€œPathsâ€å‚æ•°å³å¯ï¼Œä¾‹å¦‚â€œPathsâ€=[â€œ/metricsâ€]ï¼ˆPathå¿…é¡»ä»¥â€œ/â€ä¸ºé¦–ï¼‰ è¿™æ—¶å€™è®¿é—®â€œ http://localhost:8000/metricsâ€ï¼Œçœ‹åˆ°é¡µé¢å¦‚ä¸‹æ˜¾ç¤ºï¼Œè¯´æ˜å·²ç»æˆåŠŸçš„æ·»åŠ äº†metricsæ¥å£ Prometheusæ·»åŠ KongæŒ‡æ ‡æ”¶é›† # ä¿®æ”¹Prometheusé…ç½®æ–‡ä»¶ï¼Œprometheus.yml\nscrape_configsé…ç½®é¡¹ä¸‹æ·»åŠ å¦‚ä¸‹é…ç½®\n- job_name: \u0026#39;kong\u0026#39; scrape_interval: 5s static_configs: - targets: [\u0026#39;localhost:8000\u0026#39;] é…ç½®å®Œä¹‹åé‡å¯Prometheusï¼Œè®¿é—®â€œ http://localhost:9090/graphâ€\nå¯ä»¥çœ‹åˆ°ä¸€å·²ç»ç”Ÿæˆäº†å¾ˆå¤škongçš„æŒ‡æ ‡é¡¹ï¼Œå¦‚httpè®¿é—®ï¼Œnginxå½“å‰è®¿é—®é‡ç­‰æŒ‡æ ‡\nÂ« Kubernetes ç¼–ç¨‹\nÂ» Prometheus\n"},{"id":166,"href":"/kubernetes/prometheus/","title":"Prometheus","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Prometheus\nPrometheus # Intro # æ˜¯ä¸€ä¸ªé¢å‘äº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„å¼€æºçš„ç›‘æ§\u0026amp;æŠ¥è­¦å·¥å…·ã€‚\nå¼€æºï¼šç»§Kubernetesä¹‹åçš„ç¬¬äºŒä¸ªCNCFå¼€æºé¡¹ç›®ï¼ŒGoè¯­è¨€å¼€å‘ ç›‘æ§ï¼šé€šè¿‡HTTPæœåŠ¡å®šæ—¶ä»é…ç½®çš„ç›®æ ‡æ”¶é›†æŒ‡æ ‡æ•°æ®ï¼Œè¯†åˆ«æ•°æ®å±•ç¤ºè§„åˆ™ï¼Œå±•ç¤ºç›‘æ§ç³»ç»Ÿå’ŒæœåŠ¡æŒ‡æ ‡æ•°æ® æŠ¥è­¦ï¼šç›‘æ§åˆ°çš„æŒ‡æ ‡æ•°æ®è¾¾åˆ°æŸä¸€è®¾å®šå¥½çš„æ¡ä»¶æ—¶ï¼Œè§¦å‘æŠ¥è­¦æœºåˆ¶ æ—¶é—´åºåˆ—æ•°æ®åº“ï¼š æ—¶é—´åºåˆ—æ˜¯ç”±å”¯ä¸€çš„æŒ‡æ ‡åç§°ï¼ˆMetricsï¼‰å’Œä¸€ç»„æ ‡ç­¾ï¼ˆkey=valueï¼‰çš„å½¢å¼ç»„æˆ PromeQLï¼šåŸºäºPrometheusæ—¶é—´åºåˆ—æ•°æ®åº“çš„ä¸€ä¸ªçµæ´»çš„æŸ¥è¯¢è¯­è¨€ Prometheusçš„ç›‘æ§å¯¹è±¡ # èµ„æºç›‘æ§ï¼š\næœåŠ¡å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œåœ¨Kubernetesé›†ç¾¤ä¸­ï¼Œåˆ™å¯ä»¥åšåˆ°å¯¹Kubernetes Nodeã€ Deployment ã€Podçš„èµ„æºåˆ©ç”¨ä»¥åŠapiserverï¼Œcontroller-managerï¼Œetcdç­‰ç»„ä»¶çš„ç›‘æ§ã€‚\nåº”ç”¨ç›‘æ§ï¼š\nä¸šåŠ¡åº”ç”¨æš´éœ²ç«¯å£ä¾›Prometheusè°ƒç”¨å®ç°ç›‘æµ‹ï¼Œæ¯”å¦‚å®æ—¶çš„ç”¨æˆ·åœ¨çº¿äººæ•°ï¼Œæ•°æ®åº“çš„å½“å‰è¿æ¥æ•°ç­‰ã€‚\nPrometheusä¼˜åŠ¿ # æ”¯æŒæœºå™¨èµ„æºå’ŒåŠ¨æ€é…ç½®çš„åº”ç”¨ç›‘æ§ï¼› å¤šç»´æ•°æ®æ”¶é›†å’ŒæŸ¥è¯¢ï¼› æœåŠ¡ç‹¬ç«‹ï¼Œå°‘ä¾èµ–ã€‚ Prometheusç»„ä»¶ # Prometheus Serverï¼šé‡‡é›†ç›‘æ§æ•°æ®ï¼Œå­˜å‚¨æ—¶åºæŒ‡æ ‡ï¼Œæä¾›æ•°æ®æŸ¥è¯¢ï¼› Prometheus Client SDKï¼šå¯¹æ¥å¼€å‘å·¥å…·åŒ…ï¼Œæä¾›è‡ªå®šä¹‰çš„æŒ‡æ ‡æ•°æ®ç­‰ï¼› Push Gatewayï¼šæ¨é€æŒ‡æ ‡æ•°æ®çš„ç½‘å…³ç»„ä»¶ï¼› Third-part Exporterï¼šå¤–éƒ¨æŒ‡æ ‡é‡‡é›†ç³»ç»Ÿï¼Œæš´éœ²æ¥å£ä¾›Prometheusé‡‡é›†ï¼› AlertManagerï¼šæŒ‡æ ‡æ•°æ®çš„åˆ†æå‘Šè­¦ç®¡ç†å™¨ï¼› Architecture overview # ä¸Šå›¾æ¥æºäºå®˜ç½‘ï¼š\nå¤„ç†æµç¨‹ï¼š é…ç½®èµ„æºç›®æ ‡æˆ–åº”ç”¨æŠ“å–ï¼› æŠ“å–èµ„æºæˆ–åº”ç”¨æŒ‡æ ‡æ•°æ®ï¼› åˆ¶å®šæŠ¥è­¦è§„åˆ™ï¼Œæ¨é€æŠ¥è­¦ï¼› çµæ´»æŸ¥è¯¢è¯­è¨€ï¼Œç»“åˆGrafanaå±•ç¤º Installation \u0026amp; Start Up # 1. ä»¥æœåŠ¡è¿›ç¨‹è¿è¡ŒPrometheus # â€‹ åœ¨ubuntuç³»ç»Ÿä¸Šå®‰è£…Prometheusï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼\nç¬¬ä¸€ç§ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š\nwget https://github.com/prometheus/prometheus/releases/download/v2.13.1/prometheus-2.13.1.linux-amd64.tar.gz tar xvfz prometheus-2.13.1.linux-amd64.tar.gz # å¯åŠ¨Prometheus cd prometheus-2.13.1.linux-amd64 ./prometheus # åœæ­¢Prometheus ps -ef | grep prometheus # å®šä½Prometheusè¿›ç¨‹çš„pid kill -s 9 [pid] ç¬¬äºŒç§ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼ˆubuntuç³»ç»Ÿï¼‰ï¼š\nwget https://s3-eu-west-1.amazonaws.com/deb.robustperception.io/41EFC99D.gpg | sudo apt-key add - sudo apt-get update -y sudo apt-get install prometheus prometheus-node-exporter prometheus-pushgateway prometheus-alertmanager -y # å¯åŠ¨Prometheus sudo systemctl start prometheus sudo systemctl enable prometheus sudo systemctl status prometheus Service Proxy # é»˜è®¤Prometheusçš„è®¿é—®æ–¹å¼æ˜¯http://{ip/domain-name}:9090ï¼Œè€ŒæœåŠ¡å™¨ä¸€èˆ¬çš„æ˜¯ä¸ä¼šæš´éœ²9090ç«¯å£çš„ï¼Œè€Œæ˜¯æš´éœ²80ç«¯å£ï¼Œå…¶ä»–ç«¯å£ä»¥nginxä»£ç†è®¿é—®ã€‚\nä¸‹é¢çš„æ­¥éª¤ä¾¿æ˜¯å°†http://{ip/domain-name}:9090ä»£ç†ä¸ºhttp://{ip/domain-name}/prometheus\nâ€‹ Step 1 é…ç½®prometheusï¼š\né…ç½®\u0026ndash;web.external-url\nå¦‚æœæ˜¯ç¬¬ä¸€ç§æ–¹å¼å®‰è£…çš„Prometheusï¼Œåˆ™å¯åŠ¨Prometheusçš„å‘½ä»¤è¡Œéœ€è¦é™„å¸¦\u0026ndash;web.external-url=prometheusï¼Œå®Œæ•´å‘½ä»¤å¦‚ä¸‹ï¼š\n./prometheus --web.external-url=prometheus å¦‚æœæ˜¯ç¬¬äºŒç§æ–¹å¼å®‰è£…çš„Prometheusï¼Œåˆ™éœ€è¦åœ¨/etc/default/prometheusæ–‡ä»¶åœ¨ARGS=\u0026quot;\u0026quot;ä¸­æ·»åŠ å‚æ•°--web.external-url=prometheusï¼Œæ·»åŠ å®Œä¹‹åï¼Œæ–‡ä»¶åº”è¯¥æ˜¯åƒä¸‹é¢è¿™æ ·çš„ï¼š\né‡å¯prometheus\nsudo systemctl restart prometheus é‡å¯ä¹‹åï¼Œhttp://{ip/domain-name}:9090/prometheuså¯ä»¥è®¿é—®ã€‚\nâ€‹ Step 2 é…ç½®nginxï¼š\né»˜è®¤æœåŠ¡å™¨å·²ç»å®‰è£…äº†nginxã€‚\nnginx.confæ–‡ä»¶ï¼Œæ³¨é‡Šæ‰ä»¥ä¸‹è¡Œï¼š\n#include /etc/nginx/sites-enabled/*;\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\nsudo vim /etc/nginx/conf.d/prometheus.conf åœ¨æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š\nserver { location /prometheus { proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $http_host; proxy_redirect off; proxy_pass http://172.31.23.19:9090/prometheus; break; } } é‡å¯nginx\nsudo systemctl restart nginx.service é‡å¯ä¹‹åï¼Œhttp://{ip/domain-name}/prometheuså¯ä»¥è®¿é—®ã€‚\nåœæ­¢Prometheus # sudo systemctl stop prometheus 2.Dockerå¯åŠ¨Prometheus # docker run --name prometheus -d -p 127.0.0.1:9090:9090 prom/prometheus 3. Kubernetesè¿è¡ŒPrometheus # ConfigMap # Prometheusçš„é…ç½®æ–‡ä»¶\napiVersion: v1 kind: ConfigMap metadata: name: prometheus-config namespace: ns-prometheus data: prometheus.yml: | global: scrape_interval: 15s scrape_timeout: 15s scrape_configs: - job_name: \u0026#39;prometheus\u0026#39; static_configs: - targets: [\u0026#39;localhost:9090\u0026#39;] Deployment # apiVersion: app/v1 kind: Deployment metadata: name: prometheus namespace: ns-prometheus labels: app: prometheus spec: template: metadata: labels: app: prometheus spec: containers: - image: prom/prometheus name: prometheus imagePullPolicy: IfNotPresent args: - \u0026#34;--config.file=/etc/prometheus/prometheus.yml\u0026#34; - \u0026#34;--storage.tsdb.path=/prometheus\u0026#34; - \u0026#34;--storage.tsdb.retention=7d\u0026#34; - \u0026#34;--web.enable-admin-api\u0026#34; - \u0026#34;--web.enable-lifecycle\u0026#34; ports: - containerPort: 9090 name: http volumeMounts: - mountPath: \u0026#34;/prometheus\u0026#34; subPath: prometheus name: data - mountPath: \u0026#34;/etc/prometheus\u0026#34; name: config resources: requests: cpu: 1000m memory: 2Gi limits: cpu: 1000m memory: 2Gi securityContext: runAsUser: 0 volumes: - name: config configMap: name: prometheus-config - name: data persistentVolumeClaim: claimName: prometheus PersistentVolumeClaim # apiVersion: v1 kind: PersistentVolumeClaim metadata: name: prometheus namespace: ns-prometheus spec: accessModes: - ReadWriteOnce resources: requests: storage: 10Gi storageClassName: \u0026#34;rook-ceph-block\u0026#34; ServiceAccount # apiVersion: v1 kind: ServiceAccount metadata: name: prometheus namespace: ns-prometheus --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: prometheus rules: - apiGroups: - \u0026#34;\u0026#34; resources: - nodes - services - endpoints - pods - nodes/proxy verbs: - get - list - watch - apiGroups: - \u0026#34;\u0026#34; resources: - configmaps - nodes/metrics verbs: - get - nonResourceURLs: - /metrics verbs: - get --- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRoleBinding metadata: name: prometheus roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: prometheus subjects: - kind: ServiceAccount name: prometheus namespace: kube-ops Service # apiVersion: v1 kind: Service metadata: name: prometheus namespace: ns-prometheus labels: app: prometheus spec: selector: app: prometheus type: NodePort ports: - name: web port: 9090 targetPort: http Apply # kubectl apply -f . kubectl get svc -o wide -n ns-prometheus 4.å®˜æ–¹kubernetsè¿è¡ŒPrometheus # å‚è€ƒï¼š https://github.com/coreos/kube-prometheus\n5.Kuberneteséƒ¨ç½²Prometheus+Grafana # ä¸‹è½½ç›¸å…³k8sèµ„æºæ–‡ä»¶ git clone https://github.com/coreos/kube-prometheus.git ä¿®æ”¹æ–‡ä»¶kube-prometheus/manifests/prometheus-prometheus.yamlï¼Œåšè¿™ä¸€æ­¥çš„ç›®çš„æ˜¯ä¸ºprometheusçš„è®¿é—®åˆ†é…å­è·¯å¾„ï¼Œè®¿é—®æ–¹å¼ä¸ºhttp(s)://xxx/prometheus\nåœ¨prometheus.specä¸‹æ·»åŠ \nexternalUrl: prometheus routePrefix: prometheus ä¿®æ”¹æ–‡ä»¶kube-prometheus/manifests/grafana-deployment.yamlï¼Œåšè¿™ä¸€æ­¥çš„ç›®çš„æ˜¯ä¸ºgrafanaçš„è®¿é—®åˆ†é…å­è·¯å¾„ï¼Œè®¿é—®æ–¹å¼ä¸ºï¼šhttp(s)://xxx/grafana\nåœ¨deployment.spec.template.spec.container[0]ä¸‹æ·»åŠ \nenv: - name: GF_SERVER_ROOT_URL value: \u0026#34;http://localhost:3000/grafana\u0026#34; - name: GF_SERVER_SERVE_FROM_SUB_PATH value: \u0026#34;true\u0026#34; Apply k8sèµ„æº # å¯èƒ½éœ€è¦è¿è¡Œå¤šæ¬¡ä»¥ä¸‹å‘½ä»¤ï¼Œç¡®ä¿k8sèµ„æºéƒ½åˆ›å»º kubectl create -f manifests/setup -f manifests # !å¦‚æœè¦åˆ é™¤ä»¥ä¸Šåˆ›å»ºçš„k8sèµ„æºï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ kubectl delete --ignore-not-found=true -f manifests/ -f manifests/setup Ingressè½¬å‘ apiVersion: extensions/v1beta1 kind: Ingress metadata: name: prometheus namespace: monitoring spec: rules: - host: dp.example.tech http: paths: - path: /prometheus backend: serviceName: prometheus-k8s servicePort: 9090 - path: /grafana backend: serviceName: grafana servicePort: 3000 - path: /alertmanager backend: serviceName: alertmanager-main servicePort: 9093 Configuring Prometheus # â€‹ é…ç½®æ–‡ä»¶ä¸ºprometheus.ymlï¼Œæ–‡ä»¶æ ¼å¼ä¸ºyamlã€‚\nConcepts # Metrics # å­˜å‚¨ # Prometheus 2.x é»˜è®¤å°†æ—¶é—´åºåˆ—æ•°æ®åº“ä¿å­˜åœ¨æœ¬åœ°ç£ç›˜ä¸­ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å°†æ•°æ®ä¿å­˜åˆ°ä»»æ„ç¬¬ä¸‰æ–¹çš„å­˜å‚¨æœåŠ¡ä¸­ã€‚\næœ¬åœ°å­˜å‚¨ # Prometheus é‡‡ç”¨è‡ªå®šä¹‰çš„å­˜å‚¨æ ¼å¼å°†æ ·æœ¬æ•°æ®ä¿å­˜åœ¨æœ¬åœ°ç£ç›˜å½“ä¸­ã€‚\nå­˜å‚¨æ ¼å¼ # Prometheus æŒ‰ç…§ä¸¤ä¸ªå°æ—¶ä¸ºä¸€ä¸ªæ—¶é—´çª—å£ï¼Œå°†ä¸¤å°æ—¶å†…äº§ç”Ÿçš„æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªå—ï¼ˆBlockï¼‰ä¸­ã€‚æ¯ä¸ªå—éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç›®å½•ï¼Œé‡Œé¢å«è¯¥æ—¶é—´çª—å£å†…çš„æ‰€æœ‰æ ·æœ¬æ•°æ®ï¼ˆchunksï¼‰ï¼Œå…ƒæ•°æ®æ–‡ä»¶ï¼ˆmeta.jsonï¼‰ä»¥åŠç´¢å¼•æ–‡ä»¶ï¼ˆindexï¼‰ã€‚å…¶ä¸­ç´¢å¼•æ–‡ä»¶ä¼šå°†æŒ‡æ ‡åç§°å’Œæ ‡ç­¾ç´¢å¼•åˆ°æ ·æ¿æ•°æ®çš„æ—¶é—´åºåˆ—ä¸­ã€‚æ­¤æœŸé—´å¦‚æœé€šè¿‡ API åˆ é™¤æ—¶é—´åºåˆ—ï¼Œåˆ é™¤è®°å½•ä¼šä¿å­˜åœ¨å•ç‹¬çš„é€»è¾‘æ–‡ä»¶ tombstone å½“ä¸­ã€‚\nå½“å‰æ ·æœ¬æ•°æ®æ‰€åœ¨çš„å—ä¼šè¢«ç›´æ¥ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸ä¼šæŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚ä¸ºäº†ç¡®ä¿ Prometheus å‘ç”Ÿå´©æºƒæˆ–é‡å¯æ—¶èƒ½å¤Ÿæ¢å¤æ•°æ®ï¼ŒPrometheus å¯åŠ¨æ—¶ä¼šé€šè¿‡é¢„å†™æ—¥å¿—ï¼ˆwrite-ahead-log(WAL)ï¼‰é‡æ–°è®°å½•ï¼Œä»è€Œæ¢å¤æ•°æ®ã€‚é¢„å†™æ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨ wal ç›®å½•ä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶å¤§å°ä¸º 128MBã€‚wal æ–‡ä»¶åŒ…æ‹¬è¿˜æ²¡æœ‰è¢«å‹ç¼©çš„åŸå§‹æ•°æ®ï¼Œæ‰€ä»¥æ¯”å¸¸è§„çš„å—æ–‡ä»¶å¤§å¾—å¤šã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPrometheus ä¼šä¿ç•™ä¸‰ä¸ª wal æ–‡ä»¶ï¼Œä½†å¦‚æœæœ‰äº›é«˜è´Ÿè½½æœåŠ¡å™¨éœ€è¦ä¿å­˜ä¸¤ä¸ªå°æ—¶ä»¥ä¸Šçš„åŸå§‹æ•°æ®ï¼Œwal æ–‡ä»¶çš„æ•°é‡å°±ä¼šå¤§äº 3 ä¸ªã€‚\nPrometheusä¿å­˜å—æ•°æ®çš„ç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š\nrometheus æä¾›äº†å‡ ä¸ªå‚æ•°æ¥ä¿®æ”¹æœ¬åœ°å­˜å‚¨çš„é…ç½®ï¼Œæœ€ä¸»è¦çš„æœ‰ï¼š å¯åŠ¨å‚æ•° é»˜è®¤å€¼ å«ä¹‰ --storage.tsdb.path /data æ•°æ®å­˜å‚¨è·¯å¾„ --storage.tsdb.retention.time 15d æ ·æœ¬æ•°æ®åœ¨å­˜å‚¨ä¸­ä¿å­˜çš„æ—¶é—´ã€‚è¶…è¿‡è¯¥æ—¶é—´é™åˆ¶çš„æ•°æ®å°±ä¼šè¢«åˆ é™¤ã€‚ --storage.tsdb.retention.size 0 æ¯ä¸ªå—çš„æœ€å¤§å­—èŠ‚æ•°ï¼ˆä¸åŒ…æ‹¬ wal æ–‡ä»¶ï¼‰ã€‚å¦‚æœè¶…è¿‡é™åˆ¶ï¼Œæœ€æ—©çš„æ ·æœ¬æ•°æ®ä¼šè¢«ä¼˜å…ˆåˆ é™¤ã€‚æ”¯æŒçš„å•ä½æœ‰ KB, MB, GB, PBï¼Œä¾‹å¦‚ï¼šâ€œ512MBâ€ã€‚è¯¥å‚æ•°åªæ˜¯è¯•éªŒæ€§çš„ï¼Œå¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚ --storage.tsdb.retention è¯¥å‚æ•°ä» 2.7 ç‰ˆæœ¬å¼€å§‹å·²ç»è¢«å¼ƒç”¨ï¼Œä½¿ç”¨ --storage.tsdb.retention.time å‚æ•°æ›¿ä»£ åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPrometheus ä¸­å­˜å‚¨çš„æ¯ä¸€ä¸ªæ ·æœ¬å¤§æ¦‚å ç”¨1-2å­—èŠ‚å¤§å°ã€‚å¦‚æœéœ€è¦å¯¹ Prometheus Server çš„æœ¬åœ°ç£ç›˜ç©ºé—´åšå®¹é‡è§„åˆ’æ—¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š./data |- 01BKGV7JBM69T2G1BGBGM6KB12 # å— |- meta.json # å…ƒæ•°æ® |- wal # å†™å…¥æ—¥å¿— |- 000002 |- 000001 |- 01BKGTZQ1SYQJTR4PB43C8PD98 # å— |- meta.json #å…ƒæ•°æ® |- index # ç´¢å¼•æ–‡ä»¶ |- chunks # æ ·æœ¬æ•°æ® |- 000001 |- tombstones # é€»è¾‘æ•°æ® |- 01BKGTZQ1HHWHV8FBJXW1Y3W0K |- meta.json |- wal |-000001 æœ€åˆä¸¤ä¸ªå°æ—¶çš„å—æœ€ç»ˆä¼šåœ¨åå°è¢«å‹ç¼©æˆæ›´é•¿çš„å—ã€‚\n[info] æ³¨æ„ï¼š\næœ¬åœ°å­˜å‚¨ä¸å¯å¤åˆ¶ï¼Œæ— æ³•æ„å»ºé›†ç¾¤ï¼Œå¦‚æœæœ¬åœ°ç£ç›˜æˆ–èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œå­˜å‚¨å°†æ— æ³•æ‰©å±•å’Œè¿ç§»ã€‚å› æ­¤æˆ‘ä»¬åªèƒ½æŠŠæœ¬åœ°å­˜å‚¨è§†ä¸ºè¿‘æœŸæ•°æ®çš„çŸ­æš‚æ»‘åŠ¨çª—å£ã€‚å¦‚æœä½ å¯¹æ•°æ®æŒä¹…åŒ–çš„è¦æ±‚ä¸æ˜¯å¾ˆä¸¥æ ¼ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ç£ç›˜å­˜å‚¨å¤šè¾¾æ•°å¹´çš„æ•°æ®ã€‚\nå…³äºå­˜å‚¨æ ¼å¼çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ TSDB æ ¼å¼\næœ¬åœ°å­˜å‚¨é…ç½® # rometheus æä¾›äº†å‡ ä¸ªå‚æ•°æ¥ä¿®æ”¹æœ¬åœ°å­˜å‚¨çš„é…ç½®ï¼Œæœ€ä¸»è¦çš„æœ‰ï¼š\nå¯åŠ¨å‚æ•° é»˜è®¤å€¼ å«ä¹‰ \u0026ndash;storage.tsdb.path /data æ•°æ®å­˜å‚¨è·¯å¾„ \u0026ndash;storage.tsdb.retention.time 15d æ ·æœ¬æ•°æ®åœ¨å­˜å‚¨ä¸­ä¿å­˜çš„æ—¶é—´ã€‚è¶…è¿‡è¯¥æ—¶é—´é™åˆ¶çš„æ•°æ®å°±ä¼šè¢«åˆ é™¤ã€‚ \u0026ndash;storage.tsdb.retention.size 0 æ¯ä¸ªå—çš„æœ€å¤§å­—èŠ‚æ•°ï¼ˆä¸åŒ…æ‹¬ wal æ–‡ä»¶ï¼‰ã€‚å¦‚æœè¶…è¿‡é™åˆ¶ï¼Œæœ€æ—©çš„æ ·æœ¬æ•°æ®ä¼šè¢«ä¼˜å…ˆåˆ é™¤ã€‚æ”¯æŒçš„å•ä½æœ‰ KB, MB, GB, PBï¼Œä¾‹å¦‚ï¼šâ€œ512MBâ€ã€‚è¯¥å‚æ•°åªæ˜¯è¯•éªŒæ€§çš„ï¼Œå¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚ \u0026ndash;storage.tsdb.retention è¯¥å‚æ•°ä» 2.7 ç‰ˆæœ¬å¼€å§‹å·²ç»è¢«å¼ƒç”¨ï¼Œä½¿ç”¨ \u0026ndash;storage.tsdb.retention.time å‚æ•°æ›¿ä»£ åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPrometheus ä¸­å­˜å‚¨çš„æ¯ä¸€ä¸ªæ ·æœ¬å¤§æ¦‚å ç”¨1-2å­—èŠ‚å¤§å°ã€‚å¦‚æœéœ€è¦å¯¹ Prometheus Server çš„æœ¬åœ°ç£ç›˜ç©ºé—´åšå®¹é‡è§„åˆ’æ—¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š\nneeded_disk_space = retention_time_seconds * ingested_samples_per_second * bytes_per_sample ä»ä¸Šé¢å…¬å¼ä¸­å¯ä»¥çœ‹å‡ºåœ¨ä¿ç•™æ—¶é—´ï¼ˆretention_time_secondsï¼‰å’Œæ ·æœ¬å¤§å°ï¼ˆbytes_per_sampleï¼‰ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæƒ³å‡å°‘æœ¬åœ°ç£ç›˜çš„å®¹é‡éœ€æ±‚ï¼Œåªèƒ½é€šè¿‡å‡å°‘æ¯ç§’è·å–æ ·æœ¬æ•°ï¼ˆingested_samples_per_secondï¼‰çš„æ–¹å¼ã€‚å› æ­¤æœ‰ä¸¤ç§æ‰‹æ®µï¼Œä¸€æ˜¯å‡å°‘æ—¶é—´åºåˆ—çš„æ•°é‡ï¼ŒäºŒæ˜¯å¢åŠ é‡‡é›†æ ·æœ¬çš„æ—¶é—´é—´éš”ã€‚è€ƒè™‘åˆ° Prometheus ä¼šå¯¹æ—¶é—´åºåˆ—è¿›è¡Œå‹ç¼©æ•ˆç‡ï¼Œå‡å°‘æ—¶é—´åºåˆ—çš„æ•°é‡æ•ˆæœæ›´æ˜æ˜¾ã€‚\nå¦‚æœä½ çš„æœ¬åœ°å­˜å‚¨å‡ºç°æ•…éšœï¼Œæœ€å¥½çš„åŠæ³•æ˜¯åœæ­¢è¿è¡Œ Prometheus å¹¶åˆ é™¤æ•´ä¸ªå­˜å‚¨ç›®å½•ã€‚å› ä¸º Prometheus çš„æœ¬åœ°å­˜å‚¨ä¸æ”¯æŒé POSIX å…¼å®¹çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¸€æ—¦å‘ç”ŸæŸåï¼Œå°†æ— æ³•æ¢å¤ã€‚NFS åªæœ‰éƒ¨åˆ†å…¼å®¹ POSIXï¼Œå¤§éƒ¨åˆ†å®ç°éƒ½ä¸å…¼å®¹ POSIXã€‚\né™¤äº†åˆ é™¤æ•´ä¸ªç›®å½•ä¹‹å¤–ï¼Œä½ ä¹Ÿå¯ä»¥å°è¯•åˆ é™¤ä¸ªåˆ«å—ç›®å½•æ¥è§£å†³é—®é¢˜ã€‚åˆ é™¤æ¯ä¸ªå—ç›®å½•å°†ä¼šä¸¢å¤±å¤§çº¦ä¸¤ä¸ªå°æ—¶æ—¶é—´çª—å£çš„æ ·æœ¬æ•°æ®ã€‚æ‰€ä»¥ï¼ŒPrometheus çš„æœ¬åœ°å­˜å‚¨å¹¶ä¸èƒ½å®ç°é•¿æœŸçš„æŒä¹…åŒ–å­˜å‚¨ã€‚ï¼š\nå¦‚æœåŒæ—¶æŒ‡å®šäº†æ ·æœ¬æ•°æ®åœ¨å­˜å‚¨ä¸­ä¿å­˜çš„æ—¶é—´å’Œå¤§å°ï¼Œåˆ™å“ªä¸€ä¸ªå‚æ•°çš„é™åˆ¶å…ˆè§¦å‘ï¼Œå°±æ‰§è¡Œå“ªä¸ªå‚æ•°çš„ç­–ç•¥ã€‚\nè¿œç¨‹å­˜å‚¨ # Prometheus çš„æœ¬åœ°å­˜å‚¨æ— æ³•æŒä¹…åŒ–æ•°æ®ï¼Œæ— æ³•çµæ´»æ‰©å±•ã€‚ä¸ºäº†ä¿æŒPrometheusçš„ç®€å•æ€§ï¼ŒPrometheuså¹¶æ²¡æœ‰å°è¯•åœ¨è‡ªèº«ä¸­è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œè€Œæ˜¯é€šè¿‡å®šä¹‰ä¸¤ä¸ªæ ‡å‡†æ¥å£ï¼ˆremote_write/remote_readï¼‰ï¼Œè®©ç”¨æˆ·å¯ä»¥åŸºäºè¿™ä¸¤ä¸ªæ¥å£å¯¹æ¥å°†æ•°æ®ä¿å­˜åˆ°ä»»æ„ç¬¬ä¸‰æ–¹çš„å­˜å‚¨æœåŠ¡ä¸­ï¼Œè¿™ç§æ–¹å¼åœ¨ Promthues ä¸­ç§°ä¸º Remote Storageã€‚\nPrometheus å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥é›†æˆè¿œç¨‹å­˜å‚¨ã€‚\nRemote Write # ç”¨æˆ·å¯ä»¥åœ¨ Prometheus é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š Remote Writeï¼ˆè¿œç¨‹å†™ï¼‰çš„ URL åœ°å€ï¼Œä¸€æ—¦è®¾ç½®äº†è¯¥é…ç½®é¡¹ï¼ŒPrometheus å°†é‡‡é›†åˆ°çš„æ ·æœ¬æ•°æ®é€šè¿‡ HTTP çš„å½¢å¼å‘é€ç»™é€‚é…å™¨ï¼ˆAdaptorï¼‰ã€‚è€Œç”¨æˆ·åˆ™å¯ä»¥åœ¨é€‚é…å™¨ä¸­å¯¹æ¥å¤–éƒ¨ä»»æ„çš„æœåŠ¡ã€‚å¤–éƒ¨æœåŠ¡å¯ä»¥æ˜¯çœŸæ­£çš„å­˜å‚¨ç³»ç»Ÿï¼Œå…¬æœ‰äº‘çš„å­˜å‚¨æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ç­‰ä»»æ„å½¢å¼ã€‚\nRemote Read # å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒPromthues çš„ Remote Readï¼ˆè¿œç¨‹è¯»ï¼‰ä¹Ÿé€šè¿‡äº†ä¸€ä¸ªé€‚é…å™¨å®ç°ã€‚åœ¨è¿œç¨‹è¯»çš„æµç¨‹å½“ä¸­ï¼Œå½“ç”¨æˆ·å‘èµ·æŸ¥è¯¢è¯·æ±‚åï¼ŒPromthues å°†å‘ remote_read ä¸­é…ç½®çš„ URL å‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼ˆmatchers,rangesï¼‰ï¼ŒAdaptor æ ¹æ®è¯·æ±‚æ¡ä»¶ä»ç¬¬ä¸‰æ–¹å­˜å‚¨æœåŠ¡ä¸­è·å–å“åº”çš„æ•°æ®ã€‚åŒæ—¶å°†æ•°æ®è½¬æ¢ä¸º Promthues çš„åŸå§‹æ ·æœ¬æ•°æ®è¿”å›ç»™ Prometheus Serverã€‚\nå½“è·å–åˆ°æ ·æœ¬æ•°æ®åï¼ŒPromthues åœ¨æœ¬åœ°ä½¿ç”¨ PromQL å¯¹æ ·æœ¬æ•°æ®è¿›è¡ŒäºŒæ¬¡å¤„ç†ã€‚\n[info] æ³¨æ„ï¼š\nå¯ç”¨è¿œç¨‹è¯»è®¾ç½®åï¼ŒPrometheus ä»…ä»è¿œç¨‹å­˜å‚¨è¯»å–ä¸€ç»„æ—¶åºæ ·æœ¬æ•°æ®ï¼ˆæ ¹æ®æ ‡ç­¾é€‰æ‹©å™¨å’Œæ—¶é—´èŒƒå›´ï¼‰ï¼Œå¯¹äºè§„åˆ™æ–‡ä»¶çš„å¤„ç†ï¼Œä»¥åŠ Metadata API çš„å¤„ç†éƒ½åªåŸºäº Prometheus æœ¬åœ°å­˜å‚¨å®Œæˆã€‚è¿™ä¹Ÿå°±æ„å‘³ç€è¿œç¨‹è¯»åœ¨æ‰©å±•æ€§ä¸Šæœ‰ä¸€å®šçš„é™åˆ¶ï¼Œå› ä¸ºæ‰€æœ‰çš„æ ·æœ¬æ•°æ®éƒ½è¦é¦–å…ˆåŠ è½½åˆ° Prometheus Serverï¼Œç„¶åå†è¿›è¡Œå¤„ç†ã€‚æ‰€ä»¥ Prometheus æš‚æ—¶ä¸æ”¯æŒå®Œå…¨åˆ†å¸ƒå¼å¤„ç†ã€‚\nè¿œç¨‹è¯»å’Œè¿œç¨‹å†™åè®®éƒ½ä½¿ç”¨äº†åŸºäº HTTP çš„ snappy å‹ç¼©åè®®çš„ç¼“å†²åŒºç¼–ç ï¼Œç›®å‰è¿˜ä¸ç¨³å®šï¼Œåœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«æ›¿æ¢æˆåŸºäº HTTP/2 çš„ gRPC åè®®ï¼Œå‰ææ˜¯ Prometheus å’Œè¿œç¨‹å­˜å‚¨ä¹‹é—´çš„æ‰€æœ‰é€šä¿¡éƒ½æ”¯æŒ HTTP/2ã€‚\né…ç½®æ–‡ä»¶ # æƒ³çŸ¥é“å¦‚ä½•åœ¨ Prometheus ä¸­æ·»åŠ è¿œç¨‹å­˜å‚¨çš„é…ç½®ï¼Œè¯·å‚è€ƒå‰é¢çš„ç« èŠ‚ï¼š é…ç½®è¿œç¨‹å†™ å’Œ é…ç½®è¿œç¨‹è¯»ã€‚\nå…³äºè¯·æ±‚ä¸å“åº”æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹è¿œç¨‹å­˜å‚¨ç›¸å…³åè®®çš„ proto æ–‡ä»¶ï¼š\nsyntax = \u0026#34;proto3\u0026#34;; package prometheus; option go_package = \u0026#34;prompb\u0026#34;; import \u0026#34;types.proto\u0026#34;; import \u0026#34;gogoproto/gogo.proto\u0026#34;; message WriteRequest { repeated prometheus.TimeSeries timeseries = 1 [(gogoproto.nullable) = false]; } message ReadRequest { repeated Query queries = 1; } message ReadResponse { // In same order as the request\u0026#39;s queries. repeated QueryResult results = 1; } message Query { int64 start_timestamp_ms = 1; int64 end_timestamp_ms = 2; repeated prometheus.LabelMatcher matchers = 3; prometheus.ReadHints hints = 4; } message QueryResult { // Samples within a time series must be ordered by time. repeated prometheus.TimeSeries timeseries = 1; } æ”¯æŒçš„è¿œç¨‹å­˜å‚¨ # ç›®å‰ Prometheus ç¤¾åŒºä¹Ÿæä¾›äº†éƒ¨åˆ†å¯¹äºç¬¬ä¸‰æ–¹æ•°æ®åº“çš„ Remote Storage æ”¯æŒï¼š\nå­˜å‚¨æœåŠ¡ æ”¯æŒæ¨¡å¼ AppOptics write Chronix write Cortex read/write CrateDB read/write Elasticsearch write Gnocchi write Graphite write InfluxDB read/write IRONdb read/write Kafka write M3DB read/write OpenTSDB write PostgreSQL/TimescaleDB read/write SignalFx write Splunk write TiKV read/write VictoriaMetrics write Wavefront write è”é‚¦é›†ç¾¤ # è”é‚¦ä½¿å¾—ä¸€ä¸ª Prometheus æœåŠ¡å™¨å¯ä»¥ä»å¦ä¸€ä¸ª Prometheus æœåŠ¡å™¨æå–é€‰å®šçš„æ—¶åºã€‚\nä½¿ç”¨åœºæ™¯ # Prometheus è”é‚¦æœ‰ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚é€šå¸¸ï¼Œè”é‚¦è¢«ç”¨æ¥å®ç°å¯æ‰©å±•çš„ Prometheus ç›‘æ§è®¾ç½®ï¼Œæˆ–è€…å°†ç›¸å…³çš„æŒ‡æ ‡ä»ä¸€ä¸ªæœåŠ¡çš„ Prometheus æ‹‰å–åˆ°å¦ä¸€ä¸ª Prometheus ä¸­ã€‚\nåˆ†å±‚è”é‚¦ # åˆ†å±‚è”é‚¦å…è®¸ Prometheus èƒ½å¤Ÿæ‰©å±•åˆ°åå‡ ä¸ªæ•°æ®ä¸­å¿ƒå’Œä¸Šç™¾ä¸‡çš„èŠ‚ç‚¹ã€‚åœ¨æ­¤åœºæ™¯ä¸‹ï¼Œè”é‚¦æ‹“æ‰‘ç±»ä¼¼ä¸€ä¸ªæ ‘å½¢æ‹“æ‰‘ç»“æ„ï¼Œä¸Šå±‚çš„ Prometheus æœåŠ¡å™¨ä»å¤§é‡çš„ä¸‹å±‚ Prometheus æœåŠ¡å™¨ä¸­æ”¶é›†å’Œæ±‡èšçš„æ—¶åºæ•°æ®ã€‚\nä¾‹å¦‚ï¼Œä¸€ä¸ªè”é‚¦è®¾ç½®å¯èƒ½ç”±å¤šä¸ªæ•°æ®ä¸­å¿ƒä¸­çš„ Prometheus æœåŠ¡å™¨å’Œä¸€å¥—å…¨å±€ Prometheus æœåŠ¡å™¨ç»„æˆã€‚æ¯ä¸ªæ•°æ®ä¸­å¿ƒä¸­éƒ¨ç½²çš„ Prometheus æœåŠ¡å™¨è´Ÿè´£æ”¶é›†æœ¬åŒºåŸŸå†…ç»†ç²’åº¦çš„æ•°æ®ï¼ˆå®ä¾‹çº§åˆ«ï¼‰ï¼Œå…¨å±€ Prometheus æœåŠ¡å™¨ä»è¿™äº›ä¸‹å±‚ Prometheus æœåŠ¡å™¨ä¸­æ”¶é›†å’Œæ±‡èšæ•°æ®ï¼ˆä»»åŠ¡çº§åˆ«ï¼‰ï¼Œå¹¶å­˜å‚¨èšåˆåçš„æ•°æ®ã€‚è¿™æ ·å°±æä¾›äº†ä¸€ä¸ªèšåˆçš„å…¨å±€è§†è§’å’Œè¯¦ç»†çš„æœ¬åœ°è§†è§’ã€‚\nè·¨æœåŠ¡è”é‚¦ # åœ¨è·¨æœåŠ¡è”é‚¦ä¸­ï¼Œä¸€ä¸ªæœåŠ¡çš„ Prometheus æœåŠ¡å™¨è¢«é…ç½®æ¥æå–æ¥è‡ªå…¶ä»–æœåŠ¡çš„ Prometheus æœåŠ¡å™¨çš„æŒ‡å®šçš„æ•°æ®ï¼Œä»¥ä¾¿åœ¨ä¸€ä¸ª Prometheus æœåŠ¡å™¨ä¸­å¯¹ä¸¤ä¸ªæ•°æ®é›†å¯ç”¨å‘Šè­¦å’ŒæŸ¥è¯¢ã€‚\nä¾‹å¦‚ï¼Œä¸€ä¸ªè¿è¡Œå¤šç§æœåŠ¡çš„é›†ç¾¤è°ƒåº¦å™¨å¯ä»¥æš´éœ²åœ¨é›†ç¾¤ä¸Šè¿è¡Œçš„æœåŠ¡å®ä¾‹çš„èµ„æºä½¿ç”¨ä¿¡æ¯ï¼ˆä¾‹å¦‚å†…å­˜å’Œ CPU ä½¿ç”¨ç‡ï¼‰ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿è¡Œåœ¨é›†ç¾¤ä¸Šçš„æœåŠ¡åªéœ€è¦æš´éœ²æŒ‡å®šåº”ç”¨ç¨‹åºçº§åˆ«çš„æœåŠ¡æŒ‡æ ‡ã€‚é€šå¸¸ï¼Œè¿™ä¸¤ç§æŒ‡æ ‡é›†åˆ†åˆ«è¢«ä¸åŒçš„ Prometheus æœåŠ¡å™¨æŠ“å–ã€‚åˆ©ç”¨è”é‚¦ï¼Œç›‘æ§æœåŠ¡çº§åˆ«æŒ‡æ ‡çš„ Prometheus æœåŠ¡å™¨ä¹Ÿå¯ä»¥ä»é›†ç¾¤ä¸­ Prometheus æœåŠ¡å™¨æ‹‰å–å…¶ç‰¹å®šæœåŠ¡çš„é›†ç¾¤èµ„æºä½¿ç”¨ç‡æŒ‡æ ‡ï¼Œä»¥ä¾¿å¯ä»¥åœ¨è¯¥ Prometheus æœåŠ¡å™¨ä¸­ä½¿ç”¨è¿™ä¸¤ç»„æŒ‡æ ‡é›†ã€‚\né…ç½®è”é‚¦ # åœ¨ Prometheus æœåŠ¡å™¨ä¸­ï¼Œ/federate èŠ‚ç‚¹å…è®¸è·å–æœåŠ¡ä¸­è¢«é€‰ä¸­çš„æ—¶é—´åºåˆ—é›†åˆçš„å€¼ã€‚è‡³å°‘ä¸€ä¸ª match[] URL å‚æ•°å¿…é¡»è¢«æŒ‡å®šä¸ºè¦æš´éœ²çš„åºåˆ—ã€‚æ¯ä¸ª match[] å˜é‡éœ€è¦è¢«æŒ‡å®šä¸ºä¸€ä¸ª ä¸å˜çš„ç»´åº¦é€‰æ‹©å™¨åƒ up æˆ–è€… {job=\u0026quot;api-server\u0026quot;}ã€‚å¦‚æœæœ‰å¤šä¸ª match[] å‚æ•°ï¼Œåˆ™æ‰€æœ‰ç¬¦åˆçš„æ—¶åºæ•°æ®çš„é›†åˆéƒ½ä¼šè¢«é€‰æ‹©ã€‚\nä»ä¸€ä¸ª Prometheus æœåŠ¡å™¨è”é‚¦æŒ‡æ ‡åˆ°å¦ä¸€ä¸ª Prometheus æœåŠ¡å™¨ï¼Œé…ç½®ä½ çš„ç›®æ ‡ Prometheus æœåŠ¡å™¨ä»æºæœåŠ¡å™¨çš„ /federate èŠ‚ç‚¹æŠ“å–æŒ‡æ ‡æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿä½¿ç”¨ honor_lables æŠ“å–é€‰é¡¹ï¼ˆä¸é‡å†™æº Prometheus æœåŠ¡æš´éœ²çš„æ ‡ç­¾ï¼‰å¹¶ä¸”ä¼ é€’éœ€è¦çš„ match[] å‚æ•°ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ scrape_configs è”é‚¦ source-prometheus-{1,2,3}:9090 ä¸‰å° Prometheus æœåŠ¡å™¨ï¼Œä¸Šå±‚ Prometheus æŠ“å–å¹¶æ±‡æ€»ä»–ä»¬æš´éœ²çš„ä»»ä½•å¸¦ job=\u0026quot;prometheus\u0026quot; æ ‡ç­¾çš„åºåˆ—æˆ–åç§°ä»¥ job: å¼€å¤´çš„æŒ‡æ ‡ã€‚\nscrape_configs: - job_name: \u0026#39;federate\u0026#39; scrape_interval: 15s honor_labels: true metrics_path: \u0026#39;/federate\u0026#39; params: \u0026#39;match[]\u0026#39;: - \u0026#39;{job=\u0026#34;prometheus\u0026#34;}\u0026#39; - \u0026#39;{__name__=~\u0026#34;job:.*\u0026#34;}\u0026#39; static_configs: - targets: - \u0026#39;source-prometheus-1:9090\u0026#39; - \u0026#39;source-prometheus-2:9090\u0026#39; - \u0026#39;source-prometheus-3:9090\u0026#39; Monitor App # MSSQL # å‚è€ƒ\nç›‘æ§Mssqlåº”ç”¨\nåœ¨ä¸€å°å®‰è£…äº†Dockerçš„æœåŠ¡å™¨ä¸Šè¿è¡Œmssql-exporter\nexport MSSQL_PASS=\u0026#39;xxx\u0026#39; sudo docker run -e SERVER=db-dev-ms01.example.com -e USERNAME=starlightdba -e PASSWORD=$DEV_MSSQL_PASS -e DEBUG=app --rm -d -p 4000:4000 --name dev-mssql awaragi/prometheus-mssql-exporter æ³¨æ„ï¼šMssqlè´¦å·éœ€è¦æœ‰ç®¡ç†å‘˜æƒé™ã€‚\nprometheus.yamlæ–°å¢ç›‘æ§ çš„é…ç½®\nç›‘æ§MssqlæœåŠ¡å™¨ solved # Â« Prometheus-ç›‘æ§Kongå®Œæ•´æ“ä½œ\nÂ» PVC æ‰©å®¹\n"},{"id":167,"href":"/kubernetes/pvc-expansion/","title":"Pvc Expansion","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / PVC æ‰©å®¹\nPVC æ‰©å®¹ # K8s éƒ¨ç½²çš„ Kafka ç¨‹åºçªç„¶æŒ‚äº†ï¼ŒæŸ¥çœ‹ç›¸å…³æ—¥å¿—å‘ç°åŸæ¥æ˜¯æŒ‚æ—¥å¿—çš„ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œé‚£ä¹ˆç°åœ¨éœ€è¦å¯¹ç£ç›˜è¿›è¡Œæ‰©å®¹ã€‚\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œ PVC æ‰©å®¹çš„æ“ä½œï¼š\nkubectl edit pvc \u0026lt;pvc-name\u0026gt; -n \u0026lt;namespace\u0026gt; æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç°ï¼Œæ— æ³•å¯¹è¯¥ PVC è¿›è¡ŒåŠ¨æ€æ‰©å®¹ï¼Œéœ€è¦åˆ†é… PVC å­˜å‚¨çš„ StorageClass æ”¯æŒåŠ¨æ€æ‰©å®¹ã€‚\né‚£ä¹ˆæ€ä¹ˆæ˜¯çš„ StorageClass æ”¯æŒåŠ¨æ€æ‰©å®¹å‘¢ï¼Œå¾ˆç®€å•ï¼Œæ›´æ–° StorageClass å³å¯ã€‚\nkubectl edit storageclass \u0026lt;storageclass-name\u0026gt; æ·»åŠ å±æ€§ï¼š\nallowVolumeExpansion: true # å…è®¸å·æ‰©å…… ä¹‹åå†æ¬¡æ‰§è¡Œ PVC æ‰©å®¹çš„æ“ä½œå³å¯ã€‚\nÂ« Prometheus\nÂ» äº†è§£ Secret\n"},{"id":168,"href":"/kubernetes/secret-understood/","title":"Secret Understood","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / äº†è§£ Secret\näº†è§£ Secret # é€šå¸¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„é…ç½®éƒ½ä¼šåŒ…å«ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œè¯ä¹¦ï¼Œç§é’¥ç­‰ï¼Œä¸ºäº†ä¿è¯å…¶å®‰å…¨æ€§ï¼ŒK8s æä¾›äº† Secret èµ„æºå¯¹è±¡æ¥ä¿å­˜æ•æ„Ÿæ•°æ®ï¼Œå®ƒå’Œ CongfigMap ç±»ä¼¼ï¼Œä¹Ÿæ˜¯é”®å€¼å¯¹çš„æ˜ å°„ï¼Œå¹¶ä¸”ä½¿ç”¨æ–¹å¼ä¹Ÿå‡ ä¹ä¸€æ ·ã€‚\nä»‹ç» Secret # Secret ä¸­å­˜å‚¨ç€é”®å€¼å¯¹æ•°æ®ï¼Œå¯ä»¥\nä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ç»™å®¹å™¨ ä½œä¸ºæ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„ Volume Secret ä¼šå­˜å‚¨åœ¨ Pod æ‰€è°ƒåº¦çš„èŠ‚ç‚¹çš„å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯å†™å…¥ç£ç›˜ã€‚\nPod é»˜è®¤ç”Ÿæˆçš„ Secret # æ¯ä¸ª Pod éƒ½ä¼šè¢«è‡ªåŠ¨æŒ‚è½½ä¸€ä¸ª Secret å·ï¼Œåªéœ€è¦ä½¿ç”¨ kubectl desribe pod å‘½ä»¤å°±èƒ½çœ‹åˆ°ä¸€ä¸ªåç§°ç±»ä¼¼ default-token-n4q6m çš„ Secretï¼ŒSecret ä¹Ÿæ˜¯ä¸€ç§ K8s èµ„æºï¼Œæ‰€ä»¥ï¼Œå¯ä»¥ä½¿ç”¨ kubectl get secret æˆ– kubectl describe secret è·å–æŸ¥çœ‹ã€‚\nä»ä¸Šé¢å›¾ä¾‹å¯ä»¥çœ‹å‡ºï¼ŒPod é»˜è®¤ç”Ÿæˆçš„ Secret ä¼šåŒ…å«ä¸‰ä¸ªé…ç½®é¡¹ï¼šca.crtã€namespaceã€tokenã€‚å…¶å®è¿™ä¸‰ä¸ªé…ç½®é¡¹æ˜¯ Pod å†…éƒ¨å®‰å…¨è®¿é—®Kubernetes API æœåŠ¡çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè€Œåœ¨ kubectl describe pod çš„æ—¶å€™ï¼Œä½ å¯ä»¥çœ‹åˆ° Secret æ‰€æŒ‚è½½çš„å…·ä½“ç›®å½•åœ¨ /var/run/secrets/kubernetes.io/serviceaccount.\næ¯ä¸ª Pod ä¼šé»˜è®¤ç”Ÿæˆ default-token-xxxxx çš„ Secretï¼Œå¯ä»¥é€šè¿‡åœ¨Pod ä¸­å®šä¹‰ pod.spec.automountServiceAccountToken ä¸º false æ¥å…³é—­è¿™ç§é»˜è®¤è¡Œä¸ºã€‚\nåˆ›å»º Secret # å¯ä»¥ç›´æ¥é€šè¿‡ kubectl create secret å‘½ä»¤åˆ›å»ºï¼Œä¹Ÿå¯ä»¥å…ˆç¼–å†™ secret çš„ yaml æ–‡ä»¶å†ä½¿ç”¨ kubectl apply -f \u0026lt;filename\u0026gt; åˆ›å»ºï¼Œæ¨èä½¿ç”¨åè€…ã€‚\nå•è¡Œå‘½ä»¤åˆ›å»º Secret # åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹çš„ secretï¼š kubectl create secret generic first-secret --from-literal=user=admin --from-literal=password=admin123 åˆ›å»ºå®Œæˆä¹‹åï¼Œä½¿ç”¨ kubectl describe secret first-secret æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ª secret çš„é”®å€¼å†…å®¹å¹¶ä¸ä¼šç›´æ¥æ‰“å°å‡ºæ¥ï¼Œè€Œæ˜¯åªæ˜¾ç¤ºäº†å ç”¨äº†å¤šå°‘ä¸ªå­—èŠ‚ã€‚\nåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å†…å®¹çš„ Secret å‡å¦‚æˆ‘å½“å‰æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ secret.jsonï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;User\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;Password\u0026#34;: \u0026#34;admin123\u0026#34; } ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»º Secretï¼š\nkubectl create secret generic second-secret --from-file=secret.json åˆ›å»ºå®Œæˆä¹‹åï¼Œä½¿ç”¨ kubectl describe secret second-secret æŸ¥çœ‹ secret çš„é”®å€¼å†…å®¹ï¼ŒåŒæ ·ä¹Ÿä¸ä¼šå°†æ–‡ä»¶å†…å®¹æ˜¾ç¤ºå‡ºæ¥ï¼š\né»˜è®¤ä½¿ç”¨æ–‡ä»¶åç§° secret.json ä½œä¸ºé”®å€¼å¯¹çš„ keyï¼Œä¹Ÿå¯ä»¥é€šè¿‡ --from-file=second_secret=app.json æŒ‡å®š key ä¸º second_secretï¼›\nå¯ä»¥ä½¿ç”¨å¤šç»„ --from-file=\u0026lt;key\u0026gt;=\u0026lt;filename\u0026gt; å‚æ•°ï¼Œåœ¨ secret ä¸­å®šä¹‰å¤šç»„æ–‡ä»¶ï¼›\n--from-file= åé¢å¯ä»¥ç›´æ¥è·ŸæŸä¸ªæ–‡ä»¶è·¯å¾„ï¼Œè¿™æ ·ä¼šå°†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¼•å…¥åˆ° Secret;\n--from-literal å’Œ --from-file å¯ä»¥å…±åŒä½¿ç”¨ï¼Œé”®å€¼åˆå¹¶ã€‚\nåˆ é™¤åˆ›å»ºçš„ first-secret å’Œ second-secretï¼š\nkubectl delete secret first-secret kubectl delete secret second-secret åŸºäºèµ„æºæ¸…å•æ–‡ä»¶åˆ›å»º Secret # åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹çš„ Secretï¼š é¦–å…ˆå®šä¹‰ Secret çš„èµ„æºæ–‡ä»¶ first-secret.yamlï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\nå…ˆä½¿ç”¨ base64 å¯¹ secret èµ„æºæ–‡ä»¶ä¸­è¦ä¿å­˜çš„é”®å€¼ç¼–ç \necho \u0026#34;admin\u0026#34; | base64 # å¾—åˆ° YWRtaW4K echo \u0026#34;admin123\u0026#34; | base64 # å¾—åˆ° YWRtaW4xMjMK vim first-secret.yaml apiVersion: v1 kind: Secret metadata: name: first-secret data: user: \u0026#34;YWRtaW4K\u0026#34; password: \u0026#34;YWRtaW4xMjMK\u0026#34; ä½¿ç”¨ kubectl apply å‘½ä»¤åˆ›å»º Secret èµ„æºï¼š\nkubectl apply -f first-secret.yaml åˆ›å»ºå®Œæˆä¹‹åï¼Œä½¿ç”¨ kubectl describe secret first-secret æŸ¥çœ‹ã€‚\nå¯ä»¥åœ¨ data ä¸‹å®šä¹‰å¤šç»„é”®å€¼å¯¹ã€‚\nåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å†…å®¹çš„ Secret é¦–å…ˆå®šä¹‰ Secret çš„èµ„æºæ–‡ä»¶ second-secret.yamlï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\nå…ˆä½¿ç”¨ base64 å¯¹ä¸Šæ–‡ä¸­çš„ secret.json æ–‡ä»¶å†…å®¹ç¼–ç ï¼š\necho $(cat secret.json) | base64 # å¾—åˆ° eyAiVXNlciI6ICJhZG1pbiIsICJQYXNzd29yZCI6ICJhZG1pbjEyMyIgfQo= vim second-secret.yaml apiVersion: v1 kind: Secret metadata: name: second-secret data: secret.json: eyAiVXNlciI6ICJhZG1pbiIsICJQYXNzd29yZCI6ICJhZG1pbjEyMyIgfQo= ä½¿ç”¨ kubectl apply å‘½ä»¤åˆ›å»º Secret èµ„æºï¼š\nkubectl apply -f second-secret.yaml åˆ›å»ºå®Œæˆä¹‹åï¼Œä½¿ç”¨ kubectl describe secret second-secret æŸ¥çœ‹ã€‚\nå¯ä»¥åœ¨ data ä¸‹å®šä¹‰å¤šç»„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å’Œé”®å€¼å¯¹ä¸€èµ·å®šä¹‰ï¼›\nåˆ é™¤åˆ›å»ºçš„ first-secret å’Œ second-secretï¼š\nkubectl delete secret first-secret kubectl delete secret second-secret ä½¿ç”¨ Secret # Secret çš„ç”¨é€”ä¹Ÿä¸ ConfigMap ç›¸å·®æ— å‡ ï¼š\nä½¿ç”¨ Secret ä½œä¸ºå®¹å™¨çš„ç¯å¢ƒå˜é‡ ä½¿ç”¨ Secret ä½œä¸º Volume å‘å®¹å™¨æä¾›æ–‡ä»¶ ä½¿ç”¨ Secret ä½œä¸ºå®¹å™¨çš„ç¯å¢ƒå˜é‡ # å‡å¦‚æœ‰ä¸€ä¸ªåä¸º first-secret çš„ Secretï¼Œé‡Œé¢åŒ…å«äº†ä¸€ä¸ªé”®ä¸º userï¼Œæˆ‘æƒ³å°†è¿™ä¸ª Secret ä¸­ user é”®ç”¨åˆ°æˆ‘çš„ç¯å¢ƒå˜é‡ USER_NAME ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š\n... env: - name: USER_NAME valueFrom: secretKeyRef: name: first-secret key: user ... å¦‚æœæœ‰ä¸€ä¸ªåä¸º second-secret Secret ä¸­åŒ…å«å¤šä¸ªé”®å¦‚ USER_NAMEï¼ŒPASSWORDï¼Œæˆ‘æƒ³å°†è¿™ä¸ª Secret ä¸­æ‰€æœ‰çš„é”®éƒ½ç”¨åˆ°æˆ‘çš„ç¯å¢ƒå˜é‡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š\n... spec: container: - image: \u0026lt;some-image\u0026gt; envFrom: - prefix: MYSQL_ secretRef: name: second-secret ... å®¹å™¨å°†ä¼šç”Ÿæˆ DB_USER_NAMEï¼ŒDB_PASSWORD ç¯å¢ƒå˜é‡ï¼Œprefix ä¹Ÿå¯ä»¥ä¸é…ç½®ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ Secret çš„é”®ã€‚\næ³¨æ„ï¼š\nsecretRef ä¸ä¸Šé¢ secretKeyRef çš„åŒºåˆ«ï¼› å¦‚æœSecretä¸­æœ‰ä¸€ä¸ªä¸º USER-NAME é”®ï¼Œé‚£ä¹ˆå°†ä¸ä¼šç”Ÿæˆ MYSQL_USER-NAME çš„ç¯å¢ƒå˜é‡ï¼Œå› ä¸ºMYSQL_USER-NAME ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„ç¯å¢ƒå˜é‡åç§°ã€‚ ä½¿ç”¨ Secret ä¸ºå®¹å™¨çš„ Volume æä¾›æ–‡ä»¶ # ä¸Šæ¬¡çš„æ–‡ç« â€”â€”ã€Š äº†è§£ ConfigMapã€‹ä¸­ï¼Œä½¿ç”¨ ConfigMap å‘å®¹å™¨æä¾›æ–‡ä»¶ï¼Œè¿™æ¬¡ä½¿ç”¨ Secret æ¥å®é™…ä½¿ç”¨ä¸€ä¸‹ã€‚\næˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªæ–‡ä»¶ secret.json è¦ä¼ é€’åˆ°å®¹å™¨ä¸­ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;User\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;Password\u0026#34;: \u0026#34;admin123\u0026#34; } åˆ›å»º Secret\nkubectl create secret generic mockapi-secret --from-file=secret.json å®šä¹‰ mockapi-pod.yaml æ–‡ä»¶å¦‚ä¸‹ï¼š\napiVersion: v1 kind: Pod metadata: name: mockapi spec: containers: - name: mockapi image: poneding/mockapi:v1 ports: - containerPort: 80 volumeMounts: - mountPath: /app/mysettings/secret.json name: mockapi-secret subPath: secret.json volumes: - name: mockapi-secret secret: secretName: mockapi-secret åˆ›å»º Podï¼š\nkubectl apply -f mockapi-pod.yaml ä¸€æ®µæ—¶é—´åï¼Œå¯ä»¥éªŒè¯æ–‡ä»¶æ˜¯å¦æŒ‚è½½åˆ°å®¹å™¨ï¼š\nYeahï¼æ²¡æ¯›ç—…ã€‚\nä½¿ç”¨ Secret æ‹‰å–ç§æœ‰é•œåƒ # å½“æˆ‘ä»¬è¦è®¿é—®æ‹‰å–ç§æœ‰ä»“åº“æˆ–è€…ç§æœ‰é•œåƒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯èƒ½éœ€è¦ä½¿ç”¨åˆ° Secretã€‚\næ¯”å¦‚æˆ‘ç°åœ¨å°†æˆ‘ docker ä»“åº“ä¸­çš„é•œåƒ mockapi è®¾ç½®æˆç§æœ‰é•œåƒï¼Œè¿™æ˜¯æˆ‘ä½¿ç”¨è¯¥é•œåƒåˆ›å»º Pod æ˜¯ä¼šæ˜¾ç¤ºé•œåƒæ‹‰å–å¤±è´¥çš„ï¼Œå¾ˆæ˜æ˜¾ï¼Œæˆ‘éœ€è¦ç™»å½• dockerã€‚\nåˆ›å»ºé•œåƒä»“åº“ Secret kubectl create secret docker-registry docker-hub-secret --docker-username=\u0026lt;my_username\u0026gt; --docker-password=\u0026lt;my_password\u0026gt; ç§æœ‰ä»“åº“çš„è¯ä½¿ç”¨ --docker-server æŒ‡å®šï¼›\næ›´å¤šä½¿ç”¨ kubectl create secret docker-registry --help æŸ¥çœ‹\nPod ä¸­ä½¿ç”¨ imagePullSecrets: ... kind: Pod spec: imagePullSecrets: - name: docker-hub-secret containers: - name: mockapi image: poneding/mockapi:v1 ... ä½¿ç”¨ ServiceAccount å¦‚æœå¾ˆå¤šé•œåƒéƒ½è¦ä»ç§æœ‰ä»“åº“æ‹‰å–ï¼Œé‚£æœ€å¥½å°† secret æ·»åŠ åˆ°ä¸€ä¸ªå›ºå®šçš„ ServiceAccount ä¸­ï¼Œä¸€ä¸ª ServiceAccount å¯ä»¥åŒ…å«å¤šä¸ªé•œåƒä»“åº“ Secretï¼š\napiVersion: v1 kind: ServiceAccount metadata: name: docker-service-account imagePullSecrets: - name: docker-hub-secret - name: harbor-secret è¿™æ—¶ Pod ä½¿ç”¨ ServiceAccount å³å¯ï¼š\n... kind: Pod spec: serviceAccountName: docker-service-account ... Â« PVC æ‰©å®¹\nÂ» äº†è§£ Service\n"},{"id":169,"href":"/kubernetes/service-understood/","title":"Service Understood","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / äº†è§£ Service\näº†è§£ Service # Service ä»‹ç» # æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„è¯´æ³•ï¼Œåœ¨ K8s ä¸­ï¼ŒService æ˜¯å°†è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„ä¸€ç»„ Pod çš„åº”ç”¨å…¬å¼€ä¸ºç½‘ç»œæœåŠ¡çš„æŠ½è±¡æ–¹æ³•ï¼Œæ˜¯ K8s çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ï¼ŒService çš„ä¸»è¦ä½œç”¨æ˜¯ä½¿å®¢æˆ·ç«¯å‘ç° Pod å¹¶ä¸ä¹‹é€šä¿¡ã€‚\nç®€å•ç†è§£èµ·æ¥å°±æ˜¯ï¼Œç”± Service æä¾›ç»Ÿä¸€çš„å…¥å£åœ°å€ï¼Œç„¶åå°†è¯·æ±‚è´Ÿè½½åˆ†å‘åˆ°åç«¯ Pod çš„å®¹å™¨åº”ç”¨ã€‚\nä¸ºä»€ä¹ˆæœ‰ Service # é›†ç¾¤ä¸­éƒ¨ç½²äº† Podï¼Œåº”ç”¨æ˜¯æˆåŠŸçš„éƒ¨ç½²èµ·æ¥äº†ï¼Œä½†æ˜¯åªæ˜¯è‡³æ­¤çš„è¯ï¼ŒPod æä¾›æœåŠ¡è®¿é—®å­˜åœ¨ä»¥ä¸‹ä¸€äº›é—®é¢˜ã€‚\nPod æ˜¯çŸ­æš‚çš„ï¼Œå¯èƒ½ä¼šè¢«é”€æ¯æˆ–é‡æ–°è°ƒåº¦ï¼Œè¿™ä½¿å¾— Pod çš„ IP æ˜¯éšæ—¶å˜åŠ¨å’Œæ›´æ–°çš„ï¼› éƒ¨ç½²å¤šä¸ª Pod çš„ä¼¸ç¼©é—®é¢˜ï¼Œæµé‡åˆ†é…é—®é¢˜ï¼› é›†ç¾¤å¤–éƒ¨å®¢æˆ·ç«¯æ— æ³•ç›´æ¥è®¿é—® Podã€‚ è¿™æ—¶å€™å°±éœ€è¦ Serviceï¼ŒPod ä½œä¸º Service çš„åç«¯æä¾›æœåŠ¡ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æƒ³è±¡ï¼ŒService éœ€è¦å®Œæˆçš„äº‹æƒ…ï¼š\næœåŠ¡å‘ç°ï¼Œé€šè¿‡ Pod çš„ lable æŸ¥æ‰¾ç›®æ ‡ Podï¼Œå°†æŸ¥æ‰¾çš„ Pod çš„æ³¨å†Œåˆ°è‡ªå·±çš„åç«¯åˆ—è¡¨ï¼ŒPod çš„ IP ä¿¡æ¯å‘ç”Ÿæ›´æ”¹ï¼Œåç«¯åˆ—è¡¨ä¹ŸåŒæ­¥æ›´æ–°ï¼› è´Ÿè½½å‡è¡¡ï¼Œè¯·æ±‚åˆ°è¾¾ Service ä¹‹åï¼Œå°†è¯·æ±‚å‡è¡¡è½¬å‘çš„åç«¯åˆ—è¡¨ï¼› æœåŠ¡æš´éœ²ï¼šå¯¹å¤–æä¾›ç»Ÿä¸€çš„è¯·æ±‚åœ°å€ã€‚ åˆ›å»º Service # åœ¨åˆ›å»º Sercvice ä¹‹å‰æˆ‘ä»¬é¦–å…ˆåˆ›å»º service ä»£ç†çš„ Podï¼Œnginx-pod.yamlï¼š\napiVersion: v1 kind: Pod metadata: name: nginx labels: app: nginx spec: containers: - name: nginx image: nginx ports: - containerPort: 80 å…ˆç»™åˆ°ä¸€ä¸ªç®€å•çš„ Service å®šä¹‰å®ä¾‹ nginx-service.yamlï¼š\napiVersion: v1 kind: Service metadata: name: nginx spec: ports: - name: http port: 80 protocol: TCP targetPort: 80 selector: app: nginx type: LoadBalancer spec.ports.port æ˜¯ Service å¯¹å¤–æä¾›æœåŠ¡çš„ç«¯å£ï¼Œspec.ports.targetPort æ˜¯è½¬å‘åˆ° Pod å†…çš„è®¿é—®ç«¯å£ï¼›\né€šè¿‡ spec.selector å‘ç°åŒä¸€å‘½åç©ºé—´ä¸‹å¸¦æœ‰ app=nginx çš„ label çš„ Pod ä½œä¸ºåç«¯ã€‚\nåˆ›å»ºå‘½ä»¤ï¼š\nkubectl apply -f nginx-service.yaml Serviceä½œä¸ºPodçš„è´Ÿè½½å‡è¡¡å™¨ï¼Œä½¿ç”¨ service.spec.selector å­—æ®µå»åŒ¹é…Podï¼Œä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œnginx Serviceå°†é€šè¿‡ app: nginx çš„ label æŸ¥æ‰¾ Pod ä½œä¸ºåç«¯ã€‚\nåˆ›å»º Service ä¹‹åï¼ŒæŸ¥çœ‹ Service çš„åç«¯ï¼š\nkubectl get svc -o wide kubectl describe svc nginx åœ¨åˆ›å»º Sercvice ä¹‹å‰ï¼Œæˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå¸¦æœ‰ app: nginx label çš„ Podï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ° Service çš„ EndPoints ä¸­å·²ç»æœ‰äº†ä¸€ä¸ªåç«¯ï¼ˆ10.244.1.25ï¼‰äº†ï¼ŒEndpoint ä¹Ÿæ˜¯ä¸€ç§ K8s èµ„æºï¼Œå¯ä»¥ä½¿ç”¨ kubectl get ep å‘½ä»¤æŸ¥çœ‹ã€‚\né™¤äº†ä»¥ä¸Šä½¿ç”¨ yaml å®šä¹‰ Service ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»º Serviceï¼š\n# æš´éœ² Pod kubectl expose pod nginx --name=nginx --port=80 --target-port=80 --protocol=TCP --type=NodePort # æˆ–è€… Deployment ç®¡ç†çš„ Pod kubectl expose deploy nginx --name=nginx --port=80 --target-port=80 --protocol=TCP --type=LoadBalancer Service ç±»å‹ # é€šè¿‡ Service.spec.type å®šä¹‰ï¼Œæœ€å¸¸ç”¨çš„ä¸‰ç§ï¼šClusterIPï¼ˆé»˜è®¤ï¼‰ï¼ŒNodePortã€LoadBalancerã€‚\nCLusterIP # æŒ‡å®š type ä¸º ClusterIP æ—¶ï¼Œå®ƒå°†è¢«åˆ†é…ä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„ IPï¼Œåœ¨é›†ç¾¤å†…éƒ¨é€šè¿‡è®¿é—®å®ƒæ¥è®¿é—®åç«¯ Podï¼Œè¿™ç§ Service ä¸€èˆ¬åªä¾›é›†ç¾¤å†…éƒ¨è®¿é—®ã€‚\nNodePort # æŒ‡å®š type ä¸º NodePort æ—¶ï¼Œä¼šåœ¨æ‰€æœ‰èŠ‚ç‚¹åˆ†é…ä¸€ä¸ªç«¯å£ï¼ˆé»˜è®¤ä» 30000-32767 ï¼‰ä½œä¸º service çš„å…¥å£ï¼Œè®¿é—®æ–¹å¼ï¼š\u0026lt;protocol\u0026gt;://\u0026lt;node-ip\u0026gt;:\u0026lt;port\u0026gt;ï¼Œä½¿ç”¨ NodePort ç±»å‹æ—¶ï¼Œä¹Ÿä¼šé»˜è®¤åˆ†é…ä¸€ä¸ª ClusterIPï¼Œé™¤éä½¿ç”¨ ClusterIP: None å…é™¤åˆ†é…ã€‚\nç‰¹ç‚¹ï¼šï¼š\næ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯åŒä¸€ä¸ªç«¯å£ï¼› ç«¯å£æ˜¯æœ‰é™çš„ï¼Œ30000-32767 èŒƒå›´å†…åˆ†é…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ service.spec.ports.nodePort æŒ‡å®šç«¯å£ï¼Œä½†æŒ‡å®šçš„ç«¯å£å¿…é¡»åœ¨èŒƒå›´å†…ä¸”å°šæœªè¢«å ç”¨ï¼› å¤–éƒ¨è®¿é—®éœ€è¦ä½¿ç”¨åˆ° Node çš„ IPã€‚ LoadBalancer # éšæœºåˆ†é…ä¸€ä¸ª LoadBalancer ä½œä¸º Service çš„å…¥å£ï¼Œä¸€èˆ¬éœ€è¦äº‘æä¾›å•†çš„æ”¯æŒã€‚è¯·æ±‚åˆ°è¾¾ LoadBalancer åœ°å€åï¼Œå‡è¡¡è´Ÿè½½åˆ°åç«¯ Podï¼Œä½¿ç”¨ LoadBalancer ç±»å‹æ—¶ï¼Œä¹Ÿä¼šé»˜è®¤åˆ†é…ä¸€ä¸ª ClusterIPï¼Œå¹¶ä¸”ä¹Ÿä¼šåˆ†é…ä¸€ä¸ª NodePort ç«¯å£ï¼Œå®é™…ä¸Šæ¥è¯´ï¼ŒLoadBalancer æ˜¯åŸºäº NodePort å®ç°çš„ã€‚\nç‰¹ç‚¹ï¼š\nå¤–éƒ¨ç½‘ç»œå¯ä»¥é€šè¿‡ LoadBalancer çš„åœ°å€å’Œç«¯å£è®¿é—®åˆ°é›†ç¾¤å†… Service æœåŠ¡ã€‚ ExternalName # åˆ›å»ºä¸€ä¸ªæ–°çš„ Service ä»£ç†åˆ°å·²ç»å­˜åœ¨å¦å¤–ä¸€ä¸ª Serviceï¼Œå…è®¸è·¨å‘½åç©ºé—´ã€‚å¦‚ä¸‹ï¼Œåœ¨å‘½ä»¤ç©ºé—´ ns-b ä¸‹åˆ›å»º service è½¬å‘è®¿é—®åˆ° ns-a ä¸‹çš„ serviceã€‚\nkind: Service apiVersion: v1 metadata: name: nginx namespace: ns-b spec: selector: app: nginx type: ExternalName externalName: nginx.ns-a.svc.cluster.local ports: - name: http port: 80 targetPort: 80 å¦‚æœåªæ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ª Serviceï¼Œä½¿ç”¨æ„ä¹‰ä¸æ˜¯å¾ˆå¤§ï¼Œå› ä¸ºæœ¬æ¥å°±å¯ä»¥ç›´æ¥é€šè¿‡ nginx.ns-a.svc.cluster.local è·¨å‘½åç©ºé—´è®¿é—®ï¼Œä½†æ˜¯åœ¨ç»“åˆ Ingress æ—¶æœ‰ä¸€å®šçš„ä½¿ç”¨æ„ä¹‰ï¼Œå› ä¸º ingress æ— æ³•è·¨å‘½åç©ºé—´è½¬å‘ Serviceã€‚\nè®¿é—® Service # é€šè¿‡ ClusterIP è®¿é—®ï¼Œé™é›†ç¾¤å†…éƒ¨è®¿é—®ï¼› é€šè¿‡ Service Name è®¿é—®ï¼šå¦‚æœåœ¨åŒä¸€å‘½åç©ºé—´ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æœåŠ¡åç§° \u0026lt;service-name\u0026gt; è®¿é—®ï¼Œå¦‚æœä¸åœ¨åŒä¸€å‘½åç©ºé—´ï¼Œä½¿ç”¨æœåŠ¡åç§°å’Œå‘½åç©ºé—´åç§° \u0026lt;service-name\u0026gt;.\u0026lt;namespace-name\u0026gt; æˆ– \u0026lt;service-name\u0026gt;.\u0026lt;namespace-name\u0026gt;.svc.cluster.local è®¿é—®ï¼Œé›†ç¾¤å¤–å¯è®¿é—®ï¼› é€šè¿‡èŠ‚ç‚¹ç«¯å£ï¼ˆNodePortï¼‰è®¿é—®ï¼Œé›†ç¾¤å¤–å¯è®¿é—®ï¼› é€šè¿‡ ExternalIPï¼ˆä¸€èˆ¬æ˜¯ LoadBalancer çš„åœ°å€ï¼‰è®¿é—®ï¼Œé›†ç¾¤å¤–å¯è®¿é—®ã€‚ Â« äº†è§£ Secret\nÂ» Telepresence\n"},{"id":170,"href":"/kubernetes/telepresence/","title":"Telepresence","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Telepresence\nTelepresence # Telepresenceæ˜¯ä¸€æ¬¾\nÂ« äº†è§£ Service\nÂ» Kubernetes 0-1 ä½¿ç”¨preStopä¼˜é›…ç»ˆæ­¢Pod\n"},{"id":171,"href":"/kubernetes/terminate-pod-gracefully/","title":"Terminate Pod Gracefully","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Kubernetes 0-1 ä½¿ç”¨preStopä¼˜é›…ç»ˆæ­¢Pod\nKubernetes 0-1 ä½¿ç”¨preStopä¼˜é›…ç»ˆæ­¢Pod # Kuberneteså…è®¸Podç»ˆæ­¢ä¹‹å‰ï¼Œæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚\nå­—æ®µå®šä¹‰ # å­—æ®µå®šä¹‰ï¼špod.spec.containers.lifecycle.preStop\n$ kubectl explain pod.spec.containers.lifecycle.preStop KIND: Pod VERSION: v1 RESOURCE: preStop \u0026lt;Object\u0026gt; DESCRIPTION: PreStop is called immediately before a container is terminated due to an API request or management event such as liveness/startup probe failure, preemption, resource contention, etc. The handler is not called if the container crashes or exits. The reason for termination is passed to the handler. The Pod\u0026#39;s termination grace period countdown begins before the PreStop hooked is executed. Regardless of the outcome of the handler, the container will eventually terminate within the Pod\u0026#39;s termination grace period. Other management of the container blocks until the hook completes or until the termination grace period is reached. More info: https://kubernetes.io/docs/concepts/containers/container-lifecycle-hooks/#container-hooks Handler defines a specific action that should be taken FIELDS: exec \u0026lt;Object\u0026gt; One and only one of the following should be specified. Exec specifies the action to take. httpGet \u0026lt;Object\u0026gt; HTTPGet specifies the http request to perform. tcpSocket \u0026lt;Object\u0026gt; TCPSocket specifies an action involving a TCP port. TCP hooks not yet supported æœ‰ä¸‰ç§preStopæ–¹å¼ï¼š\nexecï¼š httpGetï¼š tcpSocketï¼š ç¤ºä¾‹ # ä½¿ç”¨æœ€ç®€å•çš„execä½œç¤ºä¾‹ï¼Œè¯¦ç»†æŸ¥çœ‹ä¸€ä¸‹execä¸‹éœ€è¦å®šä¹‰çš„å­—æ®µï¼š\n$ kubectl explain pod.spec.containers.lifecycle.preStop.exec KIND: Pod VERSION: v1 RESOURCE: exec \u0026lt;Object\u0026gt; DESCRIPTION: ... FIELDS: command \u0026lt;[]string\u0026gt; Command is the command line to execute inside the container, the working directory for the command is root (\u0026#39;/\u0026#39;) in the container\u0026#39;s filesystem. The command is simply exec\u0026#39;d, it is not run inside a shell, so traditional shell instructions (\u0026#39;|\u0026#39;, etc) won\u0026#39;t work. To use a shell, you need to explicitly call out to that shell. Exit status of 0 is treated as live/healthy and non-zero is unhealthy. æ¥ä¸‹æ¥æŒ‰ç…§å­—æ®µé‡Šä¹‰ï¼Œç›´æ¥å®šä¹‰ä¸€ä¸ªPodï¼š\n$ kubectl apply -f pod.yaml # pod.yamlæ–‡ä»¶å†…å®¹ï¼š apiVersion: v1 kind: Pod metadata: name: busybox namespace: default spec: containers: - name: busybox image: busybox command: [\u0026#34;/bin/sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;sleep 10m\u0026#34;] lifecycle: preStop: exec: command: [ \u0026#34;/bin/sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;echo this pod is stopping. \u0026gt; /stop.log \u0026amp;\u0026amp; sleep 10s\u0026#34;, ] åˆ é™¤podï¼š\nkubectl delete pod busybox åœ¨æ–°ç»ˆç«¯çª—å£ï¼ˆå› ä¸ºåˆ é™¤podä¼šå ç”¨ç»ˆç«¯çª—å£ï¼‰è·å–podå†…æ–‡ä»¶å†…å®¹ï¼Œéœ€è¦åœ¨podå®Œå…¨åˆ é™¤ä¹‹å‰ï¼ˆ10så†…ï¼Œä¹Ÿå¯ä»¥å°†è¯¥å€¼è®¾ç½®ç¨é•¿ä¸€ç‚¹ï¼‰ï¼š\n$ kubectl exec busybox -c busybox -- cat /stop.log # å¯ä»¥å¾—åˆ°æ—¥å¿—å†…å®¹ this pod is stopping. è¿™è¯´æ˜ï¼ŒpreStopç¡®å®ç”Ÿæ•ˆäº†ã€‚\nä½¿ç”¨åœºæ™¯ # ä½ çš„è¯·æ±‚å·²ç»åˆ°è¾¾äº†å½“å‰Podï¼Œç¡¬ç»ˆæ­¢ä¼šå¯¼è‡´è¯·æ±‚å¤±è´¥ï¼Œæˆ‘ä»¬å¸Œæœ›å·²ç»åˆ°è¾¾äº†å½“å‰Podçš„è¯·æ±‚å¤„ç†å®Œæˆå†å°†å…¶åœæ­¢æ‰ï¼Œå°½å¯èƒ½é¿å…è¯·æ±‚å¤±è´¥ï¼› Podå·²ç»æœ¬èº«å·²ç»æ³¨å†Œåˆ°äº†æœåŠ¡ä¸­å¿ƒï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨Podåœæ­¢ä¹‹å‰ï¼Œä¸»åŠ¨å‘æœåŠ¡æ³¨å†Œä¸­å¿ƒé€šçŸ¥ä¸‹çº¿ï¼› ç»“æŸè¯­ # ä¸preStopç›¸å¯¹åº”ï¼Œæœ‰ä¸€ä¸ªpostStartçš„æ¦‚å¿µï¼Œåœ¨å®¹å™¨åˆ›å»ºæˆåŠŸåæ‰§è¡Œï¼Œå¯ç”¨äºåˆå§‹åŒ–èµ„æºï¼Œå‡†å¤‡ç¯å¢ƒç­‰ï¼›\nå¦‚æœpreStopä¸postStartæ‰§è¡Œå¤±è´¥ï¼Œå°†ä¼šæ€æ­»å®¹å™¨ã€‚æ‰€ä»¥ä½œä¸ºé’©å­å‡½æ•°ï¼Œåº”è¯¥å°½é‡ä¿è¯å®ƒä»¬æ˜¯è½»é‡çš„ï¼›\nPodçš„ç»ˆæ­¢è¿‡ç¨‹ï¼š\nåˆ é™¤Pod =\u0026gt; Podè¢«æ ‡è®°ä¸ºTerminatingçŠ¶æ€ =\u0026gt; Serviceç§»é™¤è¯¥Podçš„endpoint =\u0026gt; kubeletç”„åˆ«TerminatingçŠ¶æ€çš„podï¼Œæ‰§è¡Œpodçš„preStopé’©å­ =\u0026gt; å¦‚æœæ‰§è¡ŒpreStopè¶…æ—¶ï¼ˆgrace periodï¼‰ ï¼Œkubeletå‘é€SIGTERMå¹¶ç­‰å¾…2ç§’ =\u0026gt; \u0026hellip;\nÂ« Telepresence\nÂ» Terraform\n"},{"id":172,"href":"/kubernetes/terraform/","title":"Terraform","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Terraform\nTerraform # åˆ›å»ºec2åŒæ—¶å®‰è£…åº”ç”¨çš„ä¸‰ç§æ–¹å¼ # Mode 1: userdata # éœ€è¦shellè„šæœ¬æ–‡ä»¶install_nginx.sh resource \u0026#34;aws_instance\u0026#34; \u0026#34;demo\u0026#34; { # ... # Mode 1: userdata user_data = \u0026#34;${file(\u0026#34;../templates/install_nginx.sh\u0026#34;)}\u0026#34; # ... } Mode 2: remote-exec # éœ€è¦è¿æ¥ä¸»æœºï¼Œconnection; å¯†é’¥æ–‡ä»¶xxx.pem resource \u0026#34;aws_instance\u0026#34; \u0026#34;demo\u0026#34; { # ... # Mode 2: remote-exec connection { host = \u0026#34;${self.private_ip}\u0026#34; private_key = \u0026#34;${file(\u0026#34;xxx.pem\u0026#34;)}\u0026#34; user = \u0026#34;${var.ansible_user}\u0026#34; } provisioner \u0026#34;remote-exec\u0026#34; { inline = [ \u0026#34;sudo apt-get update\u0026#34;, \u0026#34;sudo apt-get install -y nginx\u0026#34;, \u0026#34;sudo service nginx start\u0026#34; ] } # ... } Mode 3: local-exec with Ansible # éœ€è¦æ‰§è¡ŒTerraformå‘½ä»¤çš„ä¸»æœºå®‰è£…Ansible å¯†é’¥æ–‡ä»¶xxx.pem é¢å¤–çš„ansible-playbookæ–‡ä»¶ï¼Œç›®å½•../playbooks/install_nginx.yaml å®æˆ˜è¿‡ç¨‹ä¸­å‘ç°ï¼Œä½¿ç”¨Ansibleåœ¨ä¸»æœºè¿œç¨‹ä¸ºec2å®‰è£…nginxæ—¶ï¼Œéœ€è¦ç­‰å¾…ä¸€å®šæ—¶é—´(sleep 30)æ‰ä¼šæˆåŠŸï¼ŒçŒœæµ‹å¯èƒ½æ˜¯ç­‰å¾…ec2å®Œå…¨åˆ›å»ºæˆåŠŸå¹¶è¿è¡Œ(å®‰è£…pythonï¼Œæ¯•ç«ŸAnsibleå¯¹hostçš„å”¯ä¸€è¦æ±‚å°±æ˜¯python)ä¹‹åæ‰å¯ä»¥ä½¿ç”¨Ansibleï¼Œè¿™å¯èƒ½ä¼šæˆä¸ºä¸€ä¸ªå‘ã€‚ï¼š resource \u0026#34;aws_instance\u0026#34; \u0026#34;demo\u0026#34; { # ... # Mode 3: local-exec with ansible-playbook provisioner \u0026#34;local-exec\u0026#34; { command = \u0026lt;\u0026lt;EOT sleep 30; \u0026gt;nginx.ini; echo \u0026#34;[nginx]\u0026#34; | tee -a nginx.ini; chmod 600 xxx.pem; echo \u0026#34;${self.private_ip} ansible_user=${var.ansible_user} ansible_ssh_private_key_file=xxx.pem\u0026#34; | tee -a nginx.ini; export ANSIBLE_HOST_KEY_CHECKING=False; ansible-playbook -u ${var.ansible_user} --private-key xxx.pem -i nginx.ini ../playbooks/install_nginx.yaml EOT } # ... } Â« Kubernetes 0-1 ä½¿ç”¨preStopä¼˜é›…ç»ˆæ­¢Pod\nÂ» Velero + Minio å¤‡ä»½ä¸æ¢å¤\n"},{"id":173,"href":"/kubernetes/velero-minio-backup-restore-volume/","title":"Velero Minio Backup Restore Volume","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / Velero + Minio å¤‡ä»½ä¸æ¢å¤\nVelero + Minio å¤‡ä»½ä¸æ¢å¤ # å®‰è£… Minio # docker run -d --name minio \\\\ -p 9000:9000 \\\\ -p 9001:9001 \\\\ -e MINIO_ROOT_USER=minio \\\\ -e MINIO_ROOT_PASSWORD=minio \\\\ -v /minio-data:/data \\\\ quay.io/minio/minio:latest server /data --console-address \u0026#34;:9001\u0026#34; åˆ›å»º Bucket # è®¾ç½® Region # ç‚¹å‡»ä¿å­˜åï¼Œä¼šå‡ºç°ä¸€ä¸ªæ¨ªå¹…ï¼Œç‚¹å‡»æ¨ªå¹…ä¸Šçš„ Restart å³å¯ã€‚\nåˆ›å»º AccessKey # ä¿å­˜ AccessKey å’Œ SecretKey åˆ°æ–‡ä»¶ credentials-veleroï¼š\n[default] aws_access_key_id = \u0026lt;access_key\u0026gt; aws_secret_access_key = \u0026lt;secret_key\u0026gt; å®‰è£… Velero CLI # # linux wget \u0026lt;https://github.com/vmware-tanzu/velero/releases/download/v1.11.1/velero-v1.11.1-linux-amd64.tar.gz\u0026gt; tar -xvf velero-v1.11.1-linux-amd64.tar.gz mv velero-v1.11.1-linux-amd64/velero /usr/local/bin # completion bash source /usr/share/bash-completion/bash_completion echo \u0026#39;source \u0026lt;(velero completion bash)\u0026#39; \u0026gt;\u0026gt;~/.bashrc velero completion bash \u0026gt;/etc/bash_completion.d/velero echo \u0026#39;alias v=velero\u0026#39; \u0026gt;\u0026gt;~/.bashrc echo \u0026#39;complete -F __start_velero v\u0026#39; \u0026gt;\u0026gt;~/.bashrc # completion zsh source \u0026lt;(velero completion zsh) echo \u0026#39;alias v=velero\u0026#39; \u0026gt;\u0026gt;~/.zshrc echo \u0026#39;complete -F __start_velero v\u0026#39; \u0026gt;\u0026gt;~/.zshrc åœ¨é›†ç¾¤ä¸­å®‰è£… Velero # velero install \\ --provider aws \\ --plugins velero/velero-plugin-for-aws:main \\ --use-node-agent=true \\ --use-volume-snapshots=false \\ --bucket \u0026lt;your_minio_bucket\u0026gt; \\ --secret-file ./credentials-velero \\ --backup-location-config \\ region=\u0026lt;your_minio_region\u0026gt;,s3ForcePathStyle=\u0026#34;true\u0026#34;,s3Url=https://\u0026lt;your_minio_server\u0026gt;:9000 1ã€./credentials-velero æ–‡ä»¶ä¸­ä¿å­˜ minio çš„ AccessKey å’Œ SecretKey å†…å®¹ï¼›\n2ã€ä¿®æ”¹ bucketã€regionã€å’Œ minio çš„æœåŠ¡åœ°å€ã€‚\nå¤‡ä»½ # velero backup create mysql-backup --selector app=mysql --default-volumes-to-fs-backup è¿˜åŸ # velero restore create --from-backup mysql-backup Â« Terraform\nÂ» äº†è§£ Volume\n"},{"id":174,"href":"/kubernetes/volume-understood/","title":"Volume Understood","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / äº†è§£ Volume\näº†è§£ Volume # æˆ‘ä»¬çŸ¥é“å®¹å™¨ä¸å®¹å™¨ä¹‹é—´æ˜¯éš”ç¦»çš„ï¼Œæœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿã€‚å¹¶ä¸”å­˜å‚¨çš„æ–‡ä»¶æ€§è´¨æ—¶ä¸´æ—¶çš„ï¼Œå½“å®¹å™¨è¢«é”€æ¯æ—¶ï¼Œå®¹å™¨å†…çš„æ–‡ä»¶ä¸€å¹¶è¢«æ¸…é™¤ã€‚\nåœ¨ Pod å†…å¯èƒ½è¿è¡Œç€å¤šä¸ªå®¹å™¨ï¼Œè¿™å¯èƒ½éœ€è¦å®¹å™¨å…±äº«æ–‡ä»¶ã€‚åœ¨ K8s ä¸­ï¼ŒæŠ½è±¡é™¤äº† Volume çš„æ¦‚å¿µæ¥æ»¡è¶³è¿™ç§éœ€æ±‚ã€‚\nVolume ä»‹ç» # åœ¨ Docker ä¸­ï¼Œä¹Ÿæœ‰ Volume çš„æ¦‚å¿µï¼Œå®ƒæ˜¯å°†å®¹å™¨å†…æŸæ–‡ä»¶ç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœºçš„ç›®å½•ã€‚\nåœ¨ K8s ä¸­ï¼ŒVolume ä¾› Pod å†…çš„å®¹å™¨ä½¿ç”¨ï¼Œä¸€ä¸ªå®¹å™¨å¯ä»¥ä½¿ç”¨å¤šä¸ª Volumeï¼ŒåŒä¸€ Pod å†…çš„å¤šä¸ªå®¹å™¨å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸€ä¸ª Volumeï¼Œå®ç°æ–‡ä»¶å…±äº«ï¼Œæˆ–æ•°æ®æŒä¹…å­˜å‚¨ã€‚\nå®¹å™¨ä¸ Volume çš„ç®€å•å…³ç³»ï¼š\nVolume å®šä¹‰ # å®šä¹‰åœ¨ pod.spec.container å±æ€§ä¸‹ï¼š\nkind: Pod ... spec: container: ... volumeMounts: - mountPath: \u0026lt;path\u0026gt; name: \u0026lt;volume-name\u0026gt; subPath: \u0026lt;volume-path\u0026gt; volumes: - name: \u0026lt;volume-name\u0026gt; \u0026lt;volume-type\u0026gt;: ... mountPathï¼š å®¹å™¨å†…çš„ç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºè¯¥ç›®å½• subPathï¼šé»˜è®¤ä¼šå°† mountPath ç›´æ¥æ˜ å°„åˆ° volume çš„æ ¹ç›®å½•ï¼Œä½¿ç”¨ subpath æ˜ å°„åˆ° volume ç‰¹å®šçš„ç›®å½•ã€‚ Volume ç±»å‹ # Volume æœ‰å¤šç§ç±»å‹ï¼Œæœ‰çš„å¯ä»¥ç›´æ¥åœ¨é›†ç¾¤ä¸­ä½¿ç”¨ï¼Œæœ‰çš„åˆ™éœ€è¦ç¬¬ä¸‰æ–¹æœåŠ¡æˆ–äº‘å¹³å°çš„æ”¯æŒã€‚ç®€å•ç½—åˆ—å‡ ç§å¸¸è§ç±»å‹ï¼Œæ›´å¤šäº†ç±»å‹å‚è€ƒï¼š https://kubernetes.io/zh/docs/concepts/storage/volumes\nemptyDir # å¦‚æœæŒ‡å®š Volume ç±»å‹ä¸º emptyDirï¼Œå®ƒä¼šåœ¨ Pod åˆšè¢«è°ƒåº¦æ—¶ï¼Œåœ¨è¢«è°ƒåº¦åˆ°çš„èŠ‚ç‚¹ä¸Šåˆ›å»ºèµ·æ¥ã€‚å·åˆå§‹æ—¶æ—¶ç©ºçš„ï¼Œé‡Œé¢æ²¡æœ‰æ–‡ä»¶ï¼ŒPod å†…çš„å®¹å™¨å¯ä»¥åœ¨å·ä¸­å†™å…¥æ–‡ä»¶ã€‚å¤šä¸ªå®¹å™¨ç»‘å®šçš„ Volume å¦‚æœå­˜åœ¨ç›®å½•ç›¸åŒï¼Œåˆ™ç›®å½•å¯ä»¥è¢«å…±äº«è¯»å†™ã€‚\nå¦‚æœ Pod åœ¨è¯¥èŠ‚ç‚¹è¢«é”€æ¯ï¼Œé‚£ä¹ˆ emptyDir ä¹Ÿå°†è¢«æ°¸ä¹…åˆ é™¤ã€‚Pod å†…çš„å®¹å™¨å´©æºƒæˆ–é‡å¯æ˜¯ä¸ä¼šå½±å“ emptyDir çš„ç”Ÿå‘½å‘¨æœŸçš„ã€‚\nç”±äº emptyDir çš„ç”Ÿå‘½å‘¨æœŸå—Podå½±å“ï¼ŒemptyDir é€‚åˆçš„ä½¿ç”¨åœºæ™¯ä¹Ÿä¼šå—é™ï¼ŒemptyDir é€‚åˆä½¿ç”¨åœ¨æ•°æ®ä¸´æ—¶è®¡ç®—ï¼Œä¸´æ—¶ç¼“å­˜ç­‰ï¼Œä¸é€‚åˆå­˜å‚¨é…ç½®ä¿¡æ¯æˆ–æŒä¹…åŒ–æ•°æ®ã€‚\nä½¿ç”¨ç¤ºä¾‹ï¼š\napiVersion: v1 kind: Pod metadata: name: nginx-redis spec: containers: - image: nginx name: nginx volumeMounts: - name: dir mountPath: /shareDir - image: redis name: redis volumeMounts: - name: dir mountPath: /shareDir volumes: - name: dir emptyDir: {} å¦‚æœåœ¨ K8s ä¸­åˆ›å»ºä¸Šé¢è¿™ä¸ª Podï¼Œå®¹å™¨éƒ½è¿è¡Œèµ·æ¥åï¼Œåˆ†åˆ«è¿›å…¥ nginx å®¹å™¨å’Œ redis å®¹å™¨ï¼Œéƒ½å¯ä»¥åœ¨æ ¹ç›®å½•ä¸‹çœ‹åˆ° shareDir ç›®å½•ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªå®¹å™¨ä¸­å†™å…¥äº†æ–‡ä»¶ï¼Œå¦ä¸€ä¸ªå®¹å™¨ä¹Ÿå¯ä»¥è¯»å–åˆ°ã€‚å½“åˆ é™¤è¿™ä¸ª Podï¼Œå†é‡æ–°åˆ›å»ºåï¼Œä¹‹å‰å†™å…¥çš„æ–‡ä»¶ä¼šæ¶ˆå¤±ã€‚\nemptyDir å¯ä»¥æŒ‡å®šå­˜å‚¨ä»‹è´¨ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨èŠ‚ç‚¹çš„ç£ç›˜åˆ›å»ºèµ·æ¥çš„ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä»‹è´¨ä¸ºå†…å­˜ï¼Œè¿™ç§è¯»å†™æ›´å¿«ï¼š\nvolumes: - name: dir emptyDir: medium: Memory hostPath # hostPath å·æŒ‡å‘èŠ‚ç‚¹æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•ï¼Œå¦‚æœå¤šä¸ª Pod è¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹ï¼Œå¹¶ä¸”æŒ‡å‘ç›¸åŒçš„å·è·¯å¾„ï¼Œåˆ™ä»–ä»¬çœ‹çš„æ–‡ä»¶æ˜¯ç›¸åŒçš„ã€‚\nhostPath ç±»å‹çš„ Volume çš„ç”Ÿå‘½å‘¨æœŸä¸å—Podé™åˆ¶ï¼ŒPod è¢«åˆ é™¤ï¼ŒhostPath ä¸‹çš„æ–‡ä»¶ä»ç„¶ä¿ç•™ã€‚ç”±äº hostPath æ•°æ®åªä¼šä¿ç•™åœ¨èŠ‚ç‚¹ä¸Šï¼Œå½“ Pod è¢«é‡æ–°è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹æ—¶ï¼Œç›¸å¯¹æ¥è¯´æ•°æ®æ˜¯ä¸¢å¤±çš„ã€‚ä¸€èˆ¬å¯ä»¥ä½¿ç”¨ hostPath ä½œä¸º DaemonSetï¼ˆæ¯ä¸ªåŒ¹é…èŠ‚ç‚¹éƒ½è°ƒåº¦ä¸€ä¸ª Podï¼‰ç®¡ç†çš„ Pod çš„ Volumeã€‚\nä½¿ç”¨ç¤ºä¾‹ï¼š\napiVersion: v1 kind: Pod metadata: name: redis spec: containers: - image: redis name: redis volumeMounts: - name: dir mountPath: /data volumes: - name: dir hostPath: path: /vol/redis/data type: DirectoryOrCreate å½“æˆ‘ä»¬åˆ›å»ºä»¥ä¸Š Pod èµ„æºï¼Œå®¹å™¨è¿è¡Œèµ·æ¥ä¹‹åï¼Œåˆ™ä¼šåœ¨ Pod æ‰€è°ƒåº¦çš„å®¿ä¸»æœºä¸Šåˆ›å»º /vol/redis/data ç›®å½•ã€‚å¦‚æœæˆ‘ä»¬åˆ é™¤Podï¼Œå®¿ä¸»æœºä¸Šçš„ /vol/redis/data ç›®å½•ä¸ä¼šè¢«åˆ é™¤ã€‚\nhostPath çš„ type ç±»å‹ï¼Œé»˜è®¤ä¸ºç©ºï¼Œç›´æ¥ä½¿ç”¨ pathï¼Œå…¶ä»– type ä½¿ç”¨æ—¶ä¼šæ£€æŸ¥å’Œåˆå§‹åŒ– pathï¼š\nDirectoryOrCreateï¼Œå¦‚æœ hostPath å®šä¹‰çš„ path ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºç›®å½• Directoryï¼ŒhostPath å®šä¹‰çš„ path ç›®å½•å·²ç»å­˜åœ¨ï¼Œå¦åˆ™ä¼šå¼‚å¸¸ FileOrCreateï¼Œå¦‚æœ hostPath å®šä¹‰ çš„path æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–‡ä»¶ï¼Œå¦‚æœå‰ç¼€ç›®å½•ä¸å­˜åœ¨ä¹Ÿä¼šæŠ¥é”™ï¼Œéœ€è¦å…ˆä½¿ç”¨ DirectoryOrCreate åˆ›å»ºç›®å½• Fileï¼ŒhostPath å®šä¹‰çš„ path æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œå¦åˆ™ä¼šå¼‚å¸¸ persistentVolumeClaim # awsElasticBlockStore # ä½¿ç”¨ aws çš„å­˜å‚¨å·ä½œä¸º Pod çš„ Volumeï¼Œå®ƒå¯ä»¥è¢«å¤šä¸ª Pod å…±åŒä½¿ç”¨ï¼Œå¹¶ä¸”å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸å— Pod é™åˆ¶ï¼Œå½“ Pod è¢«é”€æ¯ï¼Œåªæ˜¯å–æ¶ˆäº†ç»‘å®šå…³ç³»ï¼Œå­˜å‚¨ä¸ä¼šè¢«åˆ é™¤ã€‚\nä½¿ç”¨ awsElasticBlockStore ä½œä¸º Volumeï¼Œéœ€è¦æå‰åœ¨ aws ä¸­åˆ› volumeï¼Œè·å–åˆ° volumeIDï¼Œç„¶å Pod çš„ Volume æŒ‡å®šawsElasticBlockStore çš„ volumeID å³å¯ã€‚\nä½¿ç”¨ aws-cli åˆ›å»º aws ä¸­çš„ volumeï¼š\naws ec2 create-volume --availability-zone=ap-southeast-1a --size=2 --volume-type=gp2 ä»¥ä¸Šå‘½ä»¤å®Œæˆä¼šè¾“å‡º volumeIDã€‚\nä½¿ç”¨ awsElasticBlockStore ä½œä¸º Pod çš„ Volume ç®€å•ç¤ºä¾‹ï¼Œå‰ææˆ‘ä»¬å·²ç»è·å–åˆ° äº†volumeID ä¸º vol-07afc8d24f8f08d2aï¼š\napiVersion: v1 kind: Pod metadata: name: redis labels: name: redis spec: containers: - name: redis image: redis volumeMounts: - mountPath: /data name: redis-data volumes: - name: redis-data awsElasticBlockStore: volumeID: vol-07afc8d24f8f08d2a å½“æˆ‘ä»¬åˆ›å»ºä»¥ä¸Š Pod èµ„æºï¼Œå®¹å™¨è¿è¡Œèµ·æ¥ä¹‹åï¼Œæˆ‘ä»¬è¿›å…¥ redis å®¹å™¨ï¼Œä½¿ç”¨ redis-cliå¾€redis ä¸­å†™å…¥ä¸€ä¸ªkey-valueåï¼Œç«‹å³é€€å‡ºå®¹å™¨ï¼Œåˆ é™¤ Pod å¹¶é‡æ–°åˆ›å»ºåï¼Œå†æ¬¡è¿›å…¥å®¹å™¨ï¼Œæ˜¯ä¾ç„¶å¯ä»¥è·å– key-value çš„ï¼Œè¿™è¯´æ˜ Volume æ•°æ®æ²¡æœ‰éš Pod è¢«åˆ é™¤ã€‚\nconfigMap # å­˜å‚¨é…ç½®é¡¹ä¿¡æ¯ï¼Œä¾› Volume ä½¿ç”¨ï¼Œåç»­å¯èƒ½ä¼šå•ç‹¬ä»‹ç»å®ƒçš„ä½¿ç”¨ã€‚\nSecret # å­˜å‚¨æ•æ„Ÿä¿¡æ¯çš„é…ç½®ï¼Œä¾› Volume ä½¿ç”¨ï¼Œåç»­å¯èƒ½ä¼šå•ç‹¬ä»‹ç»å®ƒçš„ä½¿ç”¨ã€‚\nÂ« Velero + Minio å¤‡ä»½ä¸æ¢å¤\nÂ» VPA\n"},{"id":175,"href":"/kubernetes/vpa/","title":"Vpa","section":"Kubernetes","content":" ğŸ  é¦–é¡µ / Kubernetes / VPA\nVPA # å®‰è£… # git clone https://github.com/kubernetes/autoscaler.git cd ./autoscaler/vertical-pod-autoscaler ./hack/vpa-up.sh å¸è½½ï¼š\n./hack/vpa-down.sh VPAè¿è¡Œæ¨¡å¼ # Autoï¼ˆé»˜è®¤æ¨¡å¼ï¼‰ï¼šVPAåœ¨podåˆ›å»ºæ—¶åˆ†é…èµ„æºè¯·æ±‚ï¼Œå¹¶ä½¿ç”¨é¦–é€‰çš„æ›´æ–°æœºåˆ¶åœ¨ç°æœ‰çš„podä¸Šæ›´æ–°å®ƒä»¬ã€‚ç›®å‰ï¼Œè¿™ç›¸å½“äºâ€œé‡å»ºâ€(è§ä¸‹æ–‡)ã€‚ä¸€æ—¦podè¯·æ±‚çš„å…è´¹é‡å¯(â€œåŸä½â€)æ›´æ–°å¯ç”¨ï¼Œå®ƒå°±å¯ä»¥è¢«â€œAutoâ€æ¨¡å¼ç”¨ä½œé¦–é€‰çš„æ›´æ–°æœºåˆ¶ã€‚æ³¨æ„:VPAçš„è¿™ä¸ªç‰¹æ€§æ˜¯å®éªŒæ€§çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‚¨çš„åº”ç”¨ç¨‹åºåœæœºã€‚\nRecreateï¼šVPAåœ¨podåˆ›å»ºæ—¶åˆ†é…èµ„æºè¯·æ±‚ï¼Œå¹¶åœ¨ç°æœ‰podä¸Šæ›´æ–°å®ƒä»¬ï¼Œå½“è¯·æ±‚çš„èµ„æºä¸æ–°å»ºè®®æœ‰æ˜¾è‘—å·®å¼‚æ—¶(å¦‚æœå®šä¹‰äº†podä¸­æ–­é¢„ç®—ï¼Œåˆ™è€ƒè™‘åˆ°å®ƒä»¬)ï¼Œå°†å®ƒä»¬èµ¶å‡ºç°æœ‰podã€‚è¿™ç§æ¨¡å¼åº”è¯¥å¾ˆå°‘ä½¿ç”¨ï¼Œåªæœ‰å½“æ‚¨éœ€è¦ç¡®ä¿åœ¨èµ„æºè¯·æ±‚æ›´æ”¹æ—¶é‡æ–°å¯åŠ¨podsæ—¶æ‰ä¼šä½¿ç”¨ã€‚å¦åˆ™æ›´å–œæ¬¢â€œè‡ªåŠ¨â€æ¨¡å¼ï¼Œè¿™å¯èƒ½ä¼šåˆ©ç”¨é‡æ–°å¯åŠ¨å…è´¹æ›´æ–°ï¼Œä¸€æ—¦ä»–ä»¬å¯ç”¨ã€‚æ³¨æ„:VPAçš„è¿™ä¸ªç‰¹æ€§æ˜¯å®éªŒæ€§çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‚¨çš„åº”ç”¨ç¨‹åºåœæœºã€‚\nInitialï¼šVPAåªåœ¨podåˆ›å»ºæ—¶åˆ†é…èµ„æºè¯·æ±‚ï¼Œä»¥åä¸ä¼šæ›´æ”¹å®ƒä»¬ã€‚\nOffï¼šVPAä¸ä¼šè‡ªåŠ¨æ›´æ”¹podsçš„èµ„æºéœ€æ±‚ã€‚è®¡ç®—å¹¶å¯ä»¥åœ¨VPAå¯¹è±¡ä¸­æ£€æŸ¥å»ºè®®ã€‚\nç¤ºä¾‹ # Â« äº†è§£ Volume\n"},{"id":176,"href":"/linux/","title":"Linux","section":"","content":" ğŸ  é¦–é¡µ / Linux\nLinux # certbot-auto ç”Ÿæˆè¯ä¹¦\nLinux-history è¾“å‡ºé™„å¸¦æ—¥æœŸ\nLinux å‘½ä»¤\nLinuxå¸¸ç”¨å‘½ä»¤\nLinux å¯ç”¨ crontab æ—¥å¿—\nLinux-å®‰å…¨ç™»å½•\nåˆ¶ä½œ Linux ç³»ç»Ÿå¯åŠ¨ U ç›˜\nLinux æŒ‚è½½ç£ç›˜\nshell å‘½ä»¤é—´éš”ç¬¦\nshell åŸºç¡€\nä½¿ç”¨ SSH Tunnel è¿æ¥ä¸­é—´ä»¶\ntee ä¿å­˜ stderr åˆ°æ–‡ä»¶\næœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶\nvim ä½¿ç”¨\n"},{"id":177,"href":"/linux/certbot-auto-gen-cert/","title":"Certbot Auto Gen Cert","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / certbot-auto ç”Ÿæˆè¯ä¹¦\ncertbot-auto ç”Ÿæˆè¯ä¹¦ # å®‰è£… # wget https://dl.eff.org/certbot-auto chmod a+x ./certbot-auto cp ./certbot-auto /usr/local/bin ç”Ÿæˆè¯ä¹¦ # æ¡ä»¶ï¼š\næå‰å·²ç»å°†åŸŸåè§£æåˆ°æœ¬æœåŠ¡å™¨ï¼› æœ¬æœåŠ¡å™¨ç«¯å£ 80ã€443 å¤„äºæœªè¢«å ç”¨çš„çŠ¶æ€ï¼Œå¦‚æœ web æœåŠ¡å ç”¨äº† 80 ç«¯å£ï¼Œéœ€è¦ä¸´æ—¶å…³é—­ã€‚ certbot-auto certonly --standalone --email poneding@gmail.com -d test.poneding.com ä»¥ä¸Šå‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œå°†ä¼šåœ¨ /etc/letsencrypt/live ç›®å½•ä¸‹ç”ŸæˆåŸŸåè¯ä¹¦æ–‡ä»¶ã€‚é»˜è®¤è¯ä¹¦æœ‰æ•ˆæœŸä¸º 3 ä¸ªæœˆã€‚\nnginx é…ç½®è¯ä¹¦ # å‚è€ƒç¤ºä¾‹ï¼š\nserver { listen 80; server_name abc.com; rewrite ^(.*) https://test.poneding.com permanent; } server{ listen 443 ssl default_server; listen [::]:443 ssl default_server; ssl_certificate /etc/letsencrypt/live/test.poneding.com/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/test.poneding.com/privkey.pem; server_name test.poneding.com; root /web/test.poneding.com/; } è¯ä¹¦ç»­æœŸ # é…ç½®å®šæ—¶ä»»åŠ¡\n0 3 1 * * certbot-auto renew --pre-hook \u0026#34;systemctl stop nginx\u0026#34; --renew-hook \u0026#34;systemctl start nginx\u0026#34; å‚è€ƒ # certbot æ–‡æ¡£ï¼š https://eff-certbot.readthedocs.io/en/stable/index.html Â» Linux-history è¾“å‡ºé™„å¸¦æ—¥æœŸ\n"},{"id":178,"href":"/linux/history-with-date/","title":"History With Date","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / Linux-history è¾“å‡ºé™„å¸¦æ—¥æœŸ\nLinux-history è¾“å‡ºé™„å¸¦æ—¥æœŸ # å¦‚æœæˆ‘ä»¬åœ¨ linux ç³»ç»Ÿä¸­æƒ³çœ‹å†å²çš„å‘½ä»¤è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ command å‘½ä»¤æ¥è·å–ã€‚\nhistory è¾“å‡ºå¤§æ¦‚ä¼šæ˜¯ä¸‹é¢è¿™ç§æ ·å­ï¼Œåªæœ‰ç®€å•çš„ command åˆ—è¡¨ã€‚\n1 ls 2 top 4 docker ps 5 df 6 ls é‚£ä¹ˆï¼Œå¦‚æœæƒ³çŸ¥é“å†å²æ‰§è¡Œçš„ command çš„æ—¶é—´è¯¥æ€ä¹ˆåšå‘¢ã€‚\næŒ‰ç…§å¦‚ä¸‹æ­¥éª¤ï¼Œä¸€æ­¥ä¸€æ­¥æ¥ã€‚\né¦–å…ˆè®¾ç½® HISTTIMEFORMAT å˜é‡ $ HISTTIMEFORMAT=\u0026#34;%d/%m/%y %T \u0026#34; # OR $ echo \u0026#39;export HISTTIMEFORMAT=\u0026#34;%d/%m/%y %T \u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.bash_profile ä½¿ç”¨ source å‘½ä»¤åŠ è½½ HISTTIMEFORMAT å˜é‡åˆ°å½“å‰ shell å‘½ä»¤çª— $ . ~/.bash_profile # OR $ source ~/.bash_profile å†æ¬¡è¿è¡Œ history å‘½ä»¤ï¼Œå·²ç»å¯ä»¥è¾“å‡ºé™„å¸¦æ‰§è¡Œæ—¶é—´çš„ history äº†ã€‚ 1 root 2020/02/18 11:28:19 ls 2 root 2020/02/18 11:28:21 top 4 root 2020/02/18 11:28:58 docker ps 5 root 2020/02/18 11:34:09 df 6 root 2020/02/18 11:34:15 ls Â« certbot-auto ç”Ÿæˆè¯ä¹¦\nÂ» Linux å‘½ä»¤\n"},{"id":179,"href":"/linux/linux-commands/","title":"Linux Commands","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / Linux å‘½ä»¤\nLinux å‘½ä»¤ # Linux å‘½ä»¤å¤§å…¨\ncat # catå‘½ä»¤ç”¨äºæŠŠæ¡£æ¡ˆä¸²è¿æ¥åä¼ åˆ°åŸºæœ¬è¾“å‡ºï¼ˆè¤å¹•æˆ–åŠ  \u0026gt; fileName åˆ°å¦ä¸€ä¸ªæ¡£æ¡ˆï¼‰\nä½¿ç”¨æƒé™ # æ‰€æœ‰ä½¿ç”¨è€…\nè¯­æ³•æ ¼å¼ # cat [-AbeEnstTuv] [--help] [--version] fileName å‚æ•°è¯´æ˜ # -n æˆ– \u0026ndash;number ç”± 1 å¼€å§‹å¯¹æ‰€æœ‰è¾“å‡ºçš„è¡Œæ•°ç¼–å·\n-b æˆ– \u0026ndash;number-nonblank å’Œ -n ç›¸ä¼¼ï¼Œåªä¸è¿‡å¯¹äºç©ºç™½è¡Œä¸ç¼–å·\n-s æˆ– \u0026ndash;squeeze-blank å½“é‡åˆ°æœ‰è¿ç»­ä¸¤è¡Œä»¥ä¸Šçš„ç©ºç™½è¡Œï¼Œå°±ä»£æ¢ä¸ºä¸€è¡Œçš„ç©ºç™½è¡Œ\n-v æˆ– \u0026ndash;show-nonprinting\nå®ä¾‹ # æŠŠ textfile1 çš„æ¡£æ¡ˆå†…å®¹åŠ ä¸Šè¡Œå·åè¾“å…¥ textfile2 è¿™ä¸ªæ¡£æ¡ˆé‡Œ\ncat -n textfile1 \u0026gt; textfile2 æŠŠ textfile1 å’Œ textfile2 çš„æ¡£æ¡ˆå†…å®¹åŠ ä¸Šè¡Œå·ï¼ˆç©ºç™½è¡Œä¸åŠ ï¼‰ä¹‹åå°†å†…å®¹é™„åŠ åˆ° textfile3 é‡Œã€‚\ncat -b textfile1 textfile2 \u0026gt;\u0026gt; textfile3 æ¸…ç©º/etc/test.txtæ¡£æ¡ˆå†…å®¹\ncat /dev/null \u0026gt; /etc/test.txt cat ä¹Ÿå¯ä»¥ç”¨æ¥åˆ¶ä½œé•œåƒæ–‡ä»¶ã€‚ä¾‹å¦‚è¦åˆ¶ä½œè½¯ç¢Ÿçš„åƒæ–‡ä»¶ï¼Œå°†è½¯ç¢Ÿæ”¾å¥½åæ‰“\ncat /dev/fd0 \u0026gt; OUTFILE ç›¸åçš„ï¼Œå¦‚æœæƒ³æŠŠ image file å†™åˆ°è½¯ç¢Ÿï¼Œè¯·æ‰“\ncat IMG_FILE \u0026gt; /dev/fd0 å†™å…¥å¤šè¡Œåˆ°æ–‡ä»¶ï¼š\ncat \u0026lt;\u0026lt; EOF \u0026gt; hello.txt Hello World EOF æ³¨ï¼š\n\\1. OUTFILE æŒ‡è¾“å‡ºçš„é•œåƒæ–‡ä»¶åã€‚ \\2. IMG_FILE æŒ‡é•œåƒæ–‡ä»¶ã€‚ \\3. è‹¥ä»é•œåƒæ–‡ä»¶å†™å› device æ—¶ï¼Œdevice å®¹é‡éœ€ä¸ç›¸å½“ã€‚ \\4. é€šå¸¸ç”¨åœ¨åˆ¶ä½œå¼€æœºç£ç‰‡ã€‚ chattr # Linux chattrå‘½ä»¤ç”¨äºæ”¹å˜æ–‡ä»¶å±æ€§ã€‚\nè¿™é¡¹æŒ‡ä»¤å¯æ”¹å˜å­˜æ”¾åœ¨ext2æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•å±æ€§ï¼Œè¿™äº›å±æ€§å…±æœ‰ä»¥ä¸‹8ç§æ¨¡å¼ï¼š\naï¼šè®©æ–‡ä»¶æˆ–ç›®å½•ä»…ä¾›é™„åŠ ç”¨é€”ã€‚ bï¼šä¸æ›´æ–°æ–‡ä»¶æˆ–ç›®å½•çš„æœ€åå­˜å–æ—¶é—´ã€‚ cï¼šå°†æ–‡ä»¶æˆ–ç›®å½•å‹ç¼©åå­˜æ”¾ã€‚ dï¼šå°†æ–‡ä»¶æˆ–ç›®å½•æ’é™¤åœ¨å€¾å€’æ“ä½œä¹‹å¤–ã€‚ iï¼šä¸å¾—ä»»æ„æ›´åŠ¨æ–‡ä»¶æˆ–ç›®å½•ã€‚ sï¼šä¿å¯†æ€§åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚ Sï¼šå³æ—¶æ›´æ–°æ–‡ä»¶æˆ–ç›®å½•ã€‚ uï¼šé¢„é˜²ä»¥å¤–åˆ é™¤ã€‚ è¯­æ³• # chattr [-RV][-v\u0026lt;ç‰ˆæœ¬ç¼–å·\u0026gt;][+/-/=\u0026lt;å±æ€§\u0026gt;][æ–‡ä»¶æˆ–ç›®å½•...] å‚æ•° # -R é€’å½’å¤„ç†ï¼Œå°†æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åŠå­ç›®å½•ä¸€å¹¶å¤„ç†ã€‚\n-v\u0026lt;ç‰ˆæœ¬ç¼–å·\u0026gt; è®¾ç½®æ–‡ä»¶æˆ–ç›®å½•ç‰ˆæœ¬ã€‚\n-V æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ã€‚\n+\u0026lt;å±æ€§\u0026gt; å¼€å¯æ–‡ä»¶æˆ–ç›®å½•çš„è¯¥é¡¹å±æ€§ã€‚\n-\u0026lt;å±æ€§\u0026gt; å…³é—­æ–‡ä»¶æˆ–ç›®å½•çš„è¯¥é¡¹å±æ€§ã€‚\n=\u0026lt;å±æ€§\u0026gt; æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„è¯¥é¡¹å±æ€§ã€‚\nå®ä¾‹ # ç”¨chattrå‘½ä»¤é˜²æ­¢ç³»ç»Ÿä¸­æŸä¸ªå…³é”®æ–‡ä»¶è¢«ä¿®æ”¹ï¼š\nchattr +i /etc/resolv.conf lsattr /etc/resolv.conf ä¼šæ˜¾ç¤ºå¦‚ä¸‹å±æ€§\n----i-------- /etc/resolv.conf è®©æŸä¸ªæ–‡ä»¶åªèƒ½å¾€é‡Œé¢è¿½åŠ æ•°æ®ï¼Œä½†ä¸èƒ½åˆ é™¤ï¼Œé€‚ç”¨äºå„ç§æ—¥å¿—æ–‡ä»¶ï¼š\nchattr +a /var/log/messages chgrp # Linux chgrpå‘½ä»¤ç”¨äºå˜æ›´æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€å±ç¾¤ç»„ã€‚\nåœ¨UNIXç³»ç»Ÿå®¶æ—é‡Œï¼Œæ–‡ä»¶æˆ–ç›®å½•æƒé™çš„æŒæ§ä»¥æ‹¥æœ‰è€…åŠæ‰€å±ç¾¤ç»„æ¥ç®¡ç†ã€‚æ‚¨å¯ä»¥ä½¿ç”¨chgrpæŒ‡ä»¤å»å˜æ›´æ–‡ä»¶ä¸ç›®å½•çš„æ‰€å±ç¾¤ç»„ï¼Œè®¾ç½®æ–¹å¼é‡‡ç”¨ç¾¤ç»„åç§°æˆ–ç¾¤ç»„è¯†åˆ«ç çš†å¯ã€‚\nè¯­æ³• # chgrp [-cfhRv][--help][--version][æ‰€å±ç¾¤ç»„][æ–‡ä»¶æˆ–ç›®å½•...] æˆ– chgrp [-cfhRv][--help][--reference=\u0026lt;å‚è€ƒæ–‡ä»¶æˆ–ç›®å½•\u0026gt;][--version][æ–‡ä»¶æˆ–ç›®å½•...] å‚æ•°è¯´æ˜ # -cæˆ–\u0026ndash;changes æ•ˆæœç±»ä¼¼\u0026quot;-v\u0026quot;å‚æ•°ï¼Œä½†ä»…å›æŠ¥æ›´æ”¹çš„éƒ¨åˆ†ã€‚\n-fæˆ–\u0026ndash;quietæˆ–\u0026ndash;silent ä¸æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚\n-hæˆ–\u0026ndash;no-dereference åªå¯¹ç¬¦å·è¿æ¥çš„æ–‡ä»¶ä½œä¿®æ”¹ï¼Œè€Œä¸æ›´åŠ¨å…¶ä»–ä»»ä½•ç›¸å…³æ–‡ä»¶ã€‚\n-Ræˆ–\u0026ndash;recursive é€’å½’å¤„ç†ï¼Œå°†æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åŠå­ç›®å½•ä¸€å¹¶å¤„ç†ã€‚\n-væˆ–\u0026ndash;verbose æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ã€‚\n\u0026ndash;help åœ¨çº¿å¸®åŠ©ã€‚\n\u0026ndash;reference=\u0026lt;å‚è€ƒæ–‡ä»¶æˆ–ç›®å½•\u0026gt; æŠŠæŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„æ‰€å±ç¾¤ç»„å…¨éƒ¨è®¾æˆå’Œå‚è€ƒæ–‡ä»¶æˆ–ç›®å½•çš„æ‰€å±ç¾¤ç»„ç›¸åŒã€‚\n\u0026ndash;version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚\nå®ä¾‹ # å®ä¾‹1ï¼šæ”¹å˜æ–‡ä»¶çš„ç¾¤ç»„å±æ€§ï¼š\nchgrp -v bin log2012.log è¾“å‡ºï¼š\n[root@localhost test]# ll ---xrw-r-- 1 root root 302108 11-13 06:03 log2012.log [root@localhost test]# chgrp -v bin log2012.log \u0026ldquo;log2012.log\u0026rdquo; çš„æ‰€å±ç»„å·²æ›´æ”¹ä¸º bin\n[root@localhost test]# ll ---xrw-r-- 1 root bin 302108 11-13 06:03 log2012.log è¯´æ˜ï¼š å°†log2012.logæ–‡ä»¶ç”±rootç¾¤ç»„æ”¹ä¸ºbinç¾¤ç»„\nå®ä¾‹2ï¼šæ ¹æ®æŒ‡å®šæ–‡ä»¶æ”¹å˜æ–‡ä»¶çš„ç¾¤ç»„å±æ€§\nchgrp --reference=log2012.log log2013.log è¾“å‡ºï¼š\n[root@localhost test]# ll ---xrw-r-- 1 root bin 302108 11-13 06:03 log2012.log -rw-r--r-- 1 root root 61 11-13 06:03 log2013.log [root@localhost test]# chgrp --reference=log2012.log log2013.log [root@localhost test]# ll ---xrw-r-- 1 root bin 302108 11-13 06:03 log2012.log -rw-r--r-- 1 root bin 61 11-13 06:03 log2013.log è¯´æ˜ï¼š æ”¹å˜æ–‡ä»¶log2013.log çš„ç¾¤ç»„å±æ€§ï¼Œä½¿å¾—æ–‡ä»¶log2013.logçš„ç¾¤ç»„å±æ€§å’Œå‚è€ƒæ–‡ä»¶log2012.logçš„ç¾¤ç»„å±æ€§ç›¸åŒ\nchmod # Linux/Unix çš„æ–‡ä»¶è°ƒç”¨æƒé™åˆ†ä¸ºä¸‰çº§ : æ–‡ä»¶æ‹¥æœ‰è€…ã€ç¾¤ç»„ã€å…¶ä»–ã€‚åˆ©ç”¨ chmod å¯ä»¥è—‰ä»¥æ§åˆ¶æ–‡ä»¶å¦‚ä½•è¢«ä»–äººæ‰€è°ƒç”¨ã€‚\nä½¿ç”¨æƒé™ : æ‰€æœ‰ä½¿ç”¨è€…\nè¯­æ³• # chmod [-cfvR] [--help] [--version] mode file... å‚æ•°è¯´æ˜ # mode : æƒé™è®¾å®šå­—ä¸²ï¼Œæ ¼å¼å¦‚ä¸‹ :\n[ugoa...][[+-=][rwxX]...][,...] å…¶ä¸­ï¼š\nu è¡¨ç¤ºè¯¥æ–‡ä»¶çš„æ‹¥æœ‰è€…ï¼Œg è¡¨ç¤ºä¸è¯¥æ–‡ä»¶çš„æ‹¥æœ‰è€…å±äºåŒä¸€ä¸ªç¾¤ä½“(group)è€…ï¼Œo è¡¨ç¤ºå…¶ä»–ä»¥å¤–çš„äººï¼Œa è¡¨ç¤ºè¿™ä¸‰è€…çš†æ˜¯ã€‚ + è¡¨ç¤ºå¢åŠ æƒé™ã€- è¡¨ç¤ºå–æ¶ˆæƒé™ã€= è¡¨ç¤ºå”¯ä¸€è®¾å®šæƒé™ã€‚ r è¡¨ç¤ºå¯è¯»å–ï¼Œw è¡¨ç¤ºå¯å†™å…¥ï¼Œx è¡¨ç¤ºå¯æ‰§è¡Œï¼ŒX è¡¨ç¤ºåªæœ‰å½“è¯¥æ–‡ä»¶æ˜¯ä¸ªå­ç›®å½•æˆ–è€…è¯¥æ–‡ä»¶å·²ç»è¢«è®¾å®šè¿‡ä¸ºå¯æ‰§è¡Œã€‚ -c : è‹¥è¯¥æ–‡ä»¶æƒé™ç¡®å®å·²ç»æ›´æ”¹ï¼Œæ‰æ˜¾ç¤ºå…¶æ›´æ”¹åŠ¨ä½œ\n-f : è‹¥è¯¥æ–‡ä»¶æƒé™æ— æ³•è¢«æ›´æ”¹ä¹Ÿä¸è¦æ˜¾ç¤ºé”™è¯¯è®¯æ¯\n-v : æ˜¾ç¤ºæƒé™å˜æ›´çš„è¯¦ç»†èµ„æ–™\n-R : å¯¹ç›®å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸å­ç›®å½•è¿›è¡Œç›¸åŒçš„æƒé™å˜æ›´(å³ä»¥é€’å›çš„æ–¹å¼é€ä¸ªå˜æ›´)\n\u0026ndash;help : æ˜¾ç¤ºè¾…åŠ©è¯´æ˜\n\u0026ndash;version : æ˜¾ç¤ºç‰ˆæœ¬\nå®ä¾‹ # å°†æ–‡ä»¶ file1.txt è®¾ä¸ºæ‰€æœ‰äººçš†å¯è¯»å– :\nchmod ugo+r file1.txt å°†æ–‡ä»¶ file1.txt è®¾ä¸ºæ‰€æœ‰äººçš†å¯è¯»å– :\nchmod a+r file1.txt å°†æ–‡ä»¶ file1.txt ä¸ file2.txt è®¾ä¸ºè¯¥æ–‡ä»¶æ‹¥æœ‰è€…ï¼Œä¸å…¶æ‰€å±åŒä¸€ä¸ªç¾¤ä½“è€…å¯å†™å…¥ï¼Œä½†å…¶ä»–ä»¥å¤–çš„äººåˆ™ä¸å¯å†™å…¥ :\nchmod ug+w,o-w file1.txt file2.txt å°† ex1.py è®¾å®šä¸ºåªæœ‰è¯¥æ–‡ä»¶æ‹¥æœ‰è€…å¯ä»¥æ‰§è¡Œ :\nchmod u+x ex1.py å°†ç›®å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸å­ç›®å½•çš†è®¾ä¸ºä»»ä½•äººå¯è¯»å– :\nchmod -R a+r * æ­¤å¤–chmodä¹Ÿå¯ä»¥ç”¨æ•°å­—æ¥è¡¨ç¤ºæƒé™å¦‚ :\nchmod 777 file è¯­æ³•ä¸ºï¼š\nchmod abc file å…¶ä¸­a,b,cå„ä¸ºä¸€ä¸ªæ•°å­—ï¼Œåˆ†åˆ«è¡¨ç¤ºUserã€Groupã€åŠOtherçš„æƒé™ã€‚\nr=4ï¼Œw=2ï¼Œx=1\nè‹¥è¦rwxå±æ€§åˆ™4+2+1=7ï¼› è‹¥è¦rw-å±æ€§åˆ™4+2=6ï¼› è‹¥è¦r-xå±æ€§åˆ™4+1=5ã€‚ chmod a=rwx file å’Œ\nchmod 777 file æ•ˆæœç›¸åŒ\nchmod ug=rwx,o=x file å’Œ\nchmod 771 file æ•ˆæœç›¸åŒ\nè‹¥ç”¨chmod 4755 filenameå¯ä½¿æ­¤ç¨‹åºå…·æœ‰rootçš„æƒé™\nfile # Linux fileå‘½ä»¤ç”¨äºè¾¨è¯†æ–‡ä»¶ç±»å‹ã€‚\né€šè¿‡fileæŒ‡ä»¤ï¼Œæˆ‘ä»¬å¾—ä»¥è¾¨è¯†è¯¥æ–‡ä»¶çš„ç±»å‹ã€‚\nè¯­æ³• # file [-beLvz][-f \u0026lt;åç§°æ–‡ä»¶\u0026gt;][-m \u0026lt;é­”æ³•æ•°å­—æ–‡ä»¶\u0026gt;...][æ–‡ä»¶æˆ–ç›®å½•...] å‚æ•°ï¼š\n-b åˆ—å‡ºè¾¨è¯†ç»“æœæ—¶ï¼Œä¸æ˜¾ç¤ºæ–‡ä»¶åç§°ã€‚ -c è¯¦ç»†æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼Œä¾¿äºæ’é”™æˆ–åˆ†æç¨‹åºæ‰§è¡Œçš„æƒ…å½¢ã€‚ -f\u0026lt;åç§°æ–‡ä»¶\u0026gt; æŒ‡å®šåç§°æ–‡ä»¶ï¼Œå…¶å†…å®¹æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶åç§°å‘¢æ„Ÿï¼Œè®©fileä¾åºè¾¨è¯†è¿™äº›æ–‡ä»¶ï¼Œæ ¼å¼ä¸ºæ¯åˆ—ä¸€ä¸ªæ–‡ä»¶åç§°ã€‚ -L ç›´æ¥æ˜¾ç¤ºç¬¦å·è¿æ¥æ‰€æŒ‡å‘çš„æ–‡ä»¶çš„ç±»åˆ«ã€‚ -m\u0026lt;é­”æ³•æ•°å­—æ–‡ä»¶\u0026gt; æŒ‡å®šé­”æ³•æ•°å­—æ–‡ä»¶ã€‚ -v æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚ -z å°è¯•å»è§£è¯»å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚ [æ–‡ä»¶æˆ–ç›®å½•\u0026hellip;] è¦ç¡®å®šç±»å‹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå¤šä¸ªæ–‡ä»¶ä¹‹é—´ä½¿ç”¨ç©ºæ ¼åˆ†å¼€ï¼Œå¯ä»¥ä½¿ç”¨shellé€šé…ç¬¦åŒ¹é…å¤šä¸ªæ–‡ä»¶ã€‚ å®ä¾‹ # æ˜¾ç¤ºæ–‡ä»¶ç±»å‹ï¼š\n[root@localhost ~]# file install.log install.log: UTF-8 Unicode text [root@localhost ~]# file -b install.log \u0026lt;== ä¸æ˜¾ç¤ºæ–‡ä»¶åç§° UTF-8 Unicode text [root@localhost ~]# file -i install.log \u0026lt;== æ˜¾ç¤ºMIMEç±»åˆ«ã€‚ install.log: text/plain; charset=utf-8 [root@localhost ~]# file -b -i install.log text/plain; charset=utf-8 æ˜¾ç¤ºç¬¦å·é“¾æ¥çš„æ–‡ä»¶ç±»å‹\n[root@localhost ~]# ls -l /var/mail lrwxrwxrwx 1 root root 10 08-13 00:11 /var/mail -\u0026gt; spool/mail [root@localhost ~]# file /var/mail /var/mail: symbolic link to `spool/mail\u0026#39; [root@localhost ~]# file -L /var/mail /var/mail: directory [root@localhost ~]# file /var/spool/mail /var/spool/mail: directory [root@localhost ~]# file -L /var/spool/mail /var/spool/mail: directory find # Linux find å‘½ä»¤ç”¨æ¥åœ¨æŒ‡å®šç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶ã€‚ä»»ä½•ä½äºå‚æ•°ä¹‹å‰çš„å­—ç¬¦ä¸²éƒ½å°†è¢«è§†ä¸ºæ¬²æŸ¥æ‰¾çš„ç›®å½•åã€‚å¦‚æœä½¿ç”¨è¯¥å‘½ä»¤æ—¶ï¼Œä¸è®¾ç½®ä»»ä½•å‚æ•°ï¼Œåˆ™ find å‘½ä»¤å°†åœ¨å½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾å­ç›®å½•ä¸æ–‡ä»¶ã€‚å¹¶ä¸”å°†æŸ¥æ‰¾åˆ°çš„å­ç›®å½•å’Œæ–‡ä»¶å…¨éƒ¨è¿›è¡Œæ˜¾ç¤ºã€‚\nè¯­æ³• # find path -option [ -print ] [ -exec -ok command ] {} ; å‚æ•°è¯´æ˜ :\nfind æ ¹æ®ä¸‹åˆ—è§„åˆ™åˆ¤æ–­ path å’Œ expressionï¼Œåœ¨å‘½ä»¤åˆ—ä¸Šç¬¬ä¸€ä¸ª - ( ) , ! ä¹‹å‰çš„éƒ¨ä»½ä¸º pathï¼Œä¹‹åçš„æ˜¯ expressionã€‚å¦‚æœ path æ˜¯ç©ºå­—ä¸²åˆ™ä½¿ç”¨ç›®å‰è·¯å¾„ï¼Œå¦‚æœ expression æ˜¯ç©ºå­—ä¸²åˆ™ä½¿ç”¨ -print ä¸ºé¢„è®¾ expressionã€‚\nexpression ä¸­å¯ä½¿ç”¨çš„é€‰é¡¹æœ‰äºŒä¸‰åä¸ªä¹‹å¤šï¼Œåœ¨æ­¤åªä»‹ç»æœ€å¸¸ç”¨çš„éƒ¨ä»½ã€‚\n-mount, -xdev : åªæ£€æŸ¥å’ŒæŒ‡å®šç›®å½•åœ¨åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸‹çš„æ–‡ä»¶ï¼Œé¿å…åˆ—å‡ºå…¶å®ƒæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶\n-amin n : åœ¨è¿‡å» n åˆ†é’Ÿå†…è¢«è¯»å–è¿‡\n-anewer file : æ¯”æ–‡ä»¶ file æ›´æ™šè¢«è¯»å–è¿‡çš„æ–‡ä»¶\n-atime n : åœ¨è¿‡å» n å¤©è¿‡è¯»å–è¿‡çš„æ–‡ä»¶\n-cmin n : åœ¨è¿‡å» n åˆ†é’Ÿå†…è¢«ä¿®æ”¹è¿‡\n-cnewer file :æ¯”æ–‡ä»¶ file æ›´æ–°çš„æ–‡ä»¶\n-ctime n : åœ¨è¿‡å» n å¤©è¿‡ä¿®æ”¹è¿‡çš„æ–‡ä»¶\n-empty : ç©ºçš„æ–‡ä»¶-gid n or -group name : gid æ˜¯ n æˆ–æ˜¯ group åç§°æ˜¯ name\n-ipath p, -path p : è·¯å¾„åç§°ç¬¦åˆ p çš„æ–‡ä»¶ï¼Œipath ä¼šå¿½ç•¥å¤§å°å†™\n-name name, -iname name : æ–‡ä»¶åç§°ç¬¦åˆ name çš„æ–‡ä»¶ã€‚iname ä¼šå¿½ç•¥å¤§å°å†™\n-size n : æ–‡ä»¶å¤§å° æ˜¯ n å•ä½ï¼Œb ä»£è¡¨ 512 ä½å…ƒç»„çš„åŒºå—ï¼Œc è¡¨ç¤ºå­—å…ƒæ•°ï¼Œk è¡¨ç¤º kilo bytesï¼Œw æ˜¯äºŒä¸ªä½å…ƒç»„ã€‚-type c : æ–‡ä»¶ç±»å‹æ˜¯ c çš„æ–‡ä»¶ã€‚\nd: ç›®å½•\nc: å­—å‹è£…ç½®æ–‡ä»¶\nb: åŒºå—è£…ç½®æ–‡ä»¶\np: å…·åè´®åˆ—\nf: ä¸€èˆ¬æ–‡ä»¶\nl: ç¬¦å·è¿ç»“\ns: socket\n-pid n : process id æ˜¯ n çš„æ–‡ä»¶\nä½ å¯ä»¥ä½¿ç”¨ ( ) å°†è¿ç®—å¼åˆ†éš”ï¼Œå¹¶ä½¿ç”¨ä¸‹åˆ—è¿ç®—ã€‚\nexp1 -and exp2\n! expr\n-not expr\nexp1 -or exp2\nexp1, exp2\nå®ä¾‹ # åˆ—å‡ºç»™å®šç›®å½•(base_path)ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å’Œå­ç›®å½•ï¼š\nfind base_path -print è¡¥å……ï¼šæ ¹æ®æ–‡ä»¶åå’Œæ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæœç´¢ï¼Œä½¿ç”¨é€‰é¡¹ -name æˆ– -iname (å¿½ç•¥å¤§å°å†™)ï¼š\nfind base_path -name â€˜xxxâ€™ -print find base_path -iname â€™xxxâ€˜ -print å¦å®šå‚æ•°ï¼Œå¯ä»¥ç”¨ ï¼æ’é™¤æ‰€æŒ‡å®šåˆ°çš„æ¨¡å¼ï¼š\næ­¤å¤„å°†æ‰“å°å‡ºé™¤ txt æ–‡æœ¬æ–‡ä»¶å¤–çš„çš„æ‰€æœ‰æ–‡ä»¶ã€‚\nåŸºäºç›®å½•æ·±åº¦çš„æœç´¢ï¼š\nfind å‘½ä»¤æŒ‡å®šéå†å®Œæ‰€æœ‰çš„å­ç›®å½•ã€‚ä½¿ç”¨ -maxdepth å’Œ-mindefth å¯ä»¥é™åˆ¶ find å‘½ä»¤éå†çš„ç›®å½•æ·±åº¦ï¼Œå¹¶ä¸” find å‘½ä»¤é»˜è®¤ä¸æœç´¢ç¬¦å·é“¾æ¥ï¼Œå¯ä»¥ç”¨ -L é€‰é¡¹æ”¹å˜è¿™ç§è¡Œä¸ºã€‚\nä¾‹å¦‚-maxdepthçš„å‚æ•°ä¸º1æ—¶ï¼ŒåªåŒ¹é…å½“å‰ç›®å½•ä¸‹ã€‚\n-mindepth çš„å‚æ•°ä»£è¡¨äº†å¼€å§‹è¿›è¡ŒåŒ¹é…çš„ç›®å½•åˆ° base_path çš„æœ€çŸ­è·ç¦»ã€‚\nåŸºäºæ–‡ä»¶ç±»å‹æœç´¢ï¼š\nä½¿ç”¨ -type å¯ä»¥æŒ‡å®šæœç´¢çš„æ–‡ä»¶ç±»å‹ï¼Œlinux/unix å°†æ‰€æœ‰çš„çš„ä¸€åˆ‡éƒ½è§†ä¸ºæ–‡ä»¶ï¼ˆæ–‡ä»¶ç±»å‹æœ‰ï¼šæ™®é€šæ–‡ä»¶ fï¼Œç›®å½• dï¼Œç¬¦å·é“¾æ¥ lï¼Œå­—ç¬¦è®¾å¤‡ cï¼Œå—è®¾å¤‡ bï¼Œå¥—æ¥å­— sï¼ŒFIFO-pï¼‰ï¼Œä½¿ç”¨ -type é€‰é¡¹æˆ‘ä»¬èƒ½å¤Ÿå¯¹æ–‡ä»¶ç±»å‹è¿›è¡Œè¿‡æ»¤ã€‚\næ­¤å¤„å°±ä¼šåªåŒ¹é…å‡ºç‰¹å®šé¡¹ä¸‹çš„æ‰€æœ‰æ™®é€šæ–‡ä»¶ï¼Œå’Œç›®å½•ã€‚\næ ¹æ®æ–‡ä»¶çš„æ—¶é—´æˆ³è¿›è¡Œæœç´¢ï¼š\nLinux/Unix æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸‰ç§æ—¶é—´æˆ³ï¼Œè®¿é—®æ—¶é—´ï¼ˆ-atimeï¼‰,ä¿®æ”¹æ—¶é—´ï¼ˆ-mtimeï¼‰,å˜åŒ–æ—¶é—´ï¼ˆ-ctimeï¼‰,å•ä½ä¸ºå¤©æ•°ï¼Œç”¨æ•´æ•°æŒ‡å®šï¼Œæ•°å­—å‰åŠ ä¸Š+ï¼Œè¡¨ç¤ºå¤§äºè¿™ä¸ªæ—¶é—´ï¼›åŠ ä¸Š-ï¼Œè¡¨ç¤ºå°äºè¿™ä¸ªå¤©æ•°ï¼›ä¸åŠ è¡¨ç¤ºåˆšå¥½è¿™ä¸ªå¤©æ•°ã€‚\næ­¤å¤„çš„æ–‡ä»¶æ˜¯æˆ‘åœ¨è¿›è¡Œæˆªå›¾ä¹‹å‰æ‰åˆ›å»ºçš„ï¼Œè®¿é—®ï¼Œä¿®æ”¹ï¼Œå˜åŒ–æ—¶é—´å‡å°äºä¸€å¤©ã€‚\nå½“ç„¶ç›¸åº”çš„ç”¨åˆ†é’Ÿä½œä¸ºå•ä½å°±å¯ä»¥ç”¨é€‰é¡¹ (-aminï¼‰(-mmin)(-cmin)ï¼Œå¦‚ä¸‹æˆ‘ä»¬æµ‹è¯•ä¿®æ”¹æ—¶é—´\nåŸºäºæ–‡ä»¶å¤§å°çš„æœç´¢ï¼š\nfind æä¾›äº†æŒ‡å®šæ–‡ä»¶å¤§å°çš„å•ä½é€‰é¡¹è¿›è€Œæœç´¢ç¬¦åˆå¤§å°æ–‡ä»¶çš„åŠŸèƒ½ï¼Œè¿™ä¸ªæœç´¢ä¹Ÿå¸¸å¸¸ä¼šè®©ç”¨æˆ·æ„Ÿåˆ°éå¸¸èˆ’æœï¼ˆb:å—ï¼Œ c:å­—èŠ‚ï¼Œ w:å­—ï¼Œ k:åƒå­—èŠ‚ï¼Œ M:å…†å­—èŠ‚ï¼Œ G:å‰å­—èŠ‚ï¼‰ã€‚\nåœ¨æœç´¢ä¹‹å‰æˆ‘ä»¬å…ˆç”¨ lsï¼ˆlistï¼‰æŒ‡ä»¤æ¥æŸ¥çœ‹ä¸‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ä¿¡æ¯ï¼š\nä¿¡æ¯çš„ç¬¬äº”åˆ—å°±æ˜¯å„æ–‡ä»¶ç›®å½•çš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œæˆ‘ä»¬é€šè¿‡æŒ‡å®šåŒ¹é…æ¡ä»¶æ¥æœç´¢ï¼š\nç»è¿‡æµ‹è¯•ï¼Œåœ¨å¼€å§‹ç›®å½•ä¸‹ï¼Œæ–‡ä»¶ç±»å‹ä¸ºæ™®é€šç›®å½•ï¼Œæ–‡ä»¶å¤§å°å¤§äº30ä¸ªå­—èŠ‚çš„æ–‡ä»¶å°±æ˜¯zl.txtäº†\nåŸºäºæ–‡ä»¶æƒé™å’Œæ‰€æœ‰æƒçš„åŒ¹é…ï¼š\n-perm é€‰é¡¹æŒ‡å®šäº† find æŒ‡åŒ¹é…æŒ‡å®šæƒé™çš„æ–‡ä»¶ï¼Œå‚æ•°ä¸ºæ–‡ä»¶å¯¹åº”çš„æƒé™ç ã€‚\næˆ‘ä»¬ä»ç„¶å¯å‚è€ƒâ‘¥ä¸­çš„æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯çš„ç¬¬ä¸€åˆ—ï¼Œæ­¤å¤„éœ€è¦æŒæ¡ä¸€å®šå…³äºæ–‡ä»¶æƒé™çš„çŸ¥è¯†ã€‚å¦‚ä¸‹æˆ‘ä»¬æŸ¥æ‰¾æƒé™ä¸º 644 çš„æ™®é€šæ–‡ä»¶ï¼Œå³ç”¨æˆ·å¯è¯»å†™ï¼Œç»„ç”¨æˆ·å¯è¯»ï¼Œå…¶ä»–å¯è¯»ã€‚\nä¹Ÿå¯ä»¥ç”¨é€‰é¡¹ -user,åŒ¹é…æŒ‡å®šç”¨æˆ·æ‰€æ‹¥æœ‰çš„æ–‡ä»¶ï¼Œå‚æ•°ä¸ºç”¨æˆ·åæˆ–è€…UID\nåˆ©ç”¨findæ‰§è¡Œç›¸åº”æ“ä½œï¼š\næ¯”å¦‚åˆ é™¤æ–‡ä»¶ï¼Œä½¿ç”¨ -delete é€‰é¡¹;åˆ é™¤æµ‹è¯•ç›®å½•ä¸‹æ‰€æœ‰çš„ .txt æ™®é€šæ–‡ä»¶\nè¿˜å¯ä»¥åˆ©ç”¨ -exec é€‰é¡¹ç»“åˆå…¶ä»–å‘½ä»¤å¯¹æ–‡ä»¶è¿›è¡Œæ›´é«˜æ•ˆçš„æ“ä½œï¼Œæ›´æ”¹æ–‡ä»¶çš„æ‰€å±æƒï¼Œå¤åˆ¶æ–‡ä»¶ç­‰ï¼Œfind å‘½ä»¤ä½¿ç”¨ä¸€å¯¹èŠ±æ‹¬å· {} ä»£è¡¨æ–‡ä»¶åï¼Œå¯¹äºæ¯ä¸€ä¸ªåŒ¹é…åˆ°çš„æ–‡ä»¶ï¼Œfind å‘½ä»¤ä¼šå°†{}æ›¿æ¢æˆç›¸åº”çš„æ–‡ä»¶å; å¦‚æœ -exec çš„å‘½ä»¤æœ‰å¤šä¸ªå‚æ•°æ—¶ï¼Œéœ€è¦æ³¨æ„ç»“å°¾ä½¿ç”¨ \u0026quot; ; \u0026quot; æˆ–è€… \u0026ldquo;+\u0026quot;,å‰è€…è¡¨ç¤ºè¿›è¡Œè½¬ä¹‰ï¼Œä¸ç„¶ç³»ç»Ÿä¼šä»¥ä¸ºæ˜¯ find å‘½ä»¤çš„ç»“å°¾ã€‚\næˆ‘ä»¬å°†æµ‹è¯•ç›®å½•ä¸‹çš„æ‰€æœ‰çš„ .txt æ–‡ä»¶ç”±ç”¨æˆ· lihongbo è½¬æ¢åˆ°ç”¨æˆ· litao999ï¼Œæˆ‘ä»¬å¿…é¡»ä»¥ root ç”¨æˆ·è¿›è¡Œæ­¤æ“ä½œï¼Œchown ç”¨äºæ›´æ”¹æƒé™ï¼š\næŒ‡å®š find è·³è¿‡ç‰¹å®šçš„ç›®å½•ï¼š\nä½¿ç”¨ -prune é€‰é¡¹å¯ä»¥è·³è¿‡æˆ‘ä»¬åœ¨æœå¯»çš„çš„ä¸€äº›æ˜æ˜¾æˆ‘ä»¬ä¸éœ€è¦çš„ç›®å½•\nè·³è¿‡äº† ./test1 ç›®å½•\néœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼šé€‰é¡¹å‡ºç°çš„å…ˆåæ¬¡åºæˆ‘ä»¬ä¹Ÿåº”è¯¥è€ƒè™‘åˆ°å†…ï¼Œå› ä¸ºå®ƒä¼šå½±å“åˆ°æ•´æ¡å‘½ä»¤çš„æ‰§è¡Œæ•ˆç‡ã€‚\necho # curl # è¿”å›httpStatusCode\ncurl -I -m 10 -o /dev/null -s -w %{http_code} http://localhost/version -I ä»…æµ‹è¯•HTTPå¤´ -m 10 æœ€å¤šæŸ¥è¯¢10s -o /dev/null å±è”½åŸæœ‰è¾“å‡ºä¿¡æ¯ -s silent æ¨¡å¼ï¼Œä¸è¾“å‡ºä»»ä½•ä¸œè¥¿ -w %{http_code} æ§åˆ¶é¢å¤–è¾“å‡º date # æŸ¥çœ‹ä»Šå¤©æ˜¯å½“å¹´ä¸­çš„ç¬¬å‡ å¤©\ndate \u0026#39;+%j\u0026#39; æŒ‰ç…§â€œå¹´-æœˆ-æ—¥ å°æ—¶ï¼šåˆ†é’Ÿï¼šç§’â€çš„æ ¼å¼æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ—¶é—´\ndate \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39; å°†ç³»ç»Ÿçš„å½“å‰æ—¶é—´è®¾ç½®ä¸º2017å¹´9æœˆ1æ—¥8ç‚¹30åˆ†\ndate -s \u0026#39;20170901 8:30:00\u0026#39; source å‘½ä»¤ # sourceå‘½ä»¤å°†æŒ‡å®šå‡½æ•°æ–‡ä»¶åŠ è½½åˆ°æŸä¸ªshellè„šæœ¬æ–‡ä»¶æˆ–å½“å‰å‘½ä»¤çª—å£ã€‚\nè¯­æ³• # åŸºæœ¬ä½¿ç”¨è¯­æ³•å¦‚ä¸‹ï¼š\nsource \u0026lt;filename\u0026gt; [arguments] source functions.sh source /path/to/functions.sh arg1 arg2 source functions.sh WWWROOT=/apache.jail PHPROOT=/fastcgi.php_jail ç¤ºä¾‹ # åˆ›å»ºä¸€ä¸ªshellè„šæœ¬æ–‡ä»¶mylib.shï¼Œå¦‚ä¸‹ï¼š\n#!/bin/bash JAIL_ROOT=/www/httpd is_root(){ [$(id -u) -eq 0] \u0026amp;\u0026amp; return $TRUE || return $FALSE } function to_lower() { local str=\u0026#34;$@\u0026#34; local output output=$(tr \u0026#39;[A-Z]\u0026#39; \u0026#39;[a-z]\u0026#39;\u0026lt;\u0026lt;\u0026lt;\u0026#34;${str}\u0026#34;) echo $output } å†åˆ›å»ºä¸€ä¸ªshellè„šæœ¬æ–‡ä»¶test.shï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨å¦‚ä¸‹çš„è¯­æ³•ä½¿ç”¨mylib.shçš„JAIL_ROOTå˜é‡ï¼Œè°ƒç”¨is_rootå‡½æ•°ï¼š\n#!/bin/bash # ä½¿ç”¨sourceå‘½ä»¤åŠ è½½mylib.sh source mylib.sh echo \u0026#34;JAIL_ROOT is set to $JAIL_ROOT\u0026#34; # è°ƒç”¨is_rootå‡½æ•°ï¼Œå¹¶æ‰“å°ç»“æœ is_root \u0026amp;\u0026amp; echo \u0026#34;You are logged in as root.\u0026#34; || echo \u0026#34;You are not logged in as root.\u0026#34; è¿è¡Œè¯¥æ–‡ä»¶ï¼š\nchmod +x test.sh ./test.sh è¿è¡Œç»“æœå¦‚ä¸‹ï¼š\nJAIL_ROOT is set to /www/httpd You are not logged in as root. åœ¨å½“å‰å‘½ä»¤ç›´æ¥è¿è¡Œ\nsource mylib.sh echo $JAIL_ROOT è¿è¡Œç»“æœï¼š\n/www/httpd Â« Linux-history è¾“å‡ºé™„å¸¦æ—¥æœŸ\nÂ» Linuxå¸¸ç”¨å‘½ä»¤\n"},{"id":180,"href":"/linux/linux-common-commands/","title":"Linux Common Commands","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / Linuxå¸¸ç”¨å‘½ä»¤\nLinuxå¸¸ç”¨å‘½ä»¤ # 1.æ–‡ä»¶å’Œç›®å½•ç›¸å…³ # cd .. åˆ‡æ¢åˆ°ä¸Šä¸€çº§ç›®å½• cd ../.. åˆ‡æ¢åˆ°ä¸Šä¸¤çº§ç›®å½• cd [dir] è¿›å…¥ dir ç›®å½• cd è¿›å…¥ä¸ªäººçš„ä¸»ç›®å½• cd ~[username] è¿›å…¥ä¸ªäººçš„ä¸»ç›®å½• cd - è¿›å…¥ä¸Šæ¬¡ç›®å½• pwd æŸ¥çœ‹ç›®å½•è·¯å¾„ ls æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„ç›®å½•å’Œæ–‡ä»¶ï¼ˆä¸åŒ…å«éšè—ç›®å½•æˆ–æ–‡ä»¶ï¼‰ ls -a æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶ ls -F æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ ï¼ˆä¸åŒ…å«ç›®å½•å’Œéšè—æ–‡ä»¶ï¼‰ ls -l æŸ¥çœ‹æ–‡ä»¶å’Œç›®å½•çš„è¯¦ç»†èµ„æ–™ ls *[0-9]* æŸ¥çœ‹åŒ…å«å­—ç¬¦çš„æ–‡ä»¶å’Œç›®å½• mkdir dir1 åˆ›å»ºç›®å½• mkdir dir1 dir2 mkdir -p dir1/dir1/dir1 åˆ›å»ºä¸€ä¸ªç›®å½•æ ‘ rm -f file1 åˆ é™¤æ–‡ä»¶ rmdir dir1 åˆ é™¤ç©º rm -rf dir1 åˆ é™¤åŒ…å«å†…å®¹çš„ç›®å½• rm -rf dir1 dir2 åˆ é™¤å¤šä¸ªç›®å½• mv dir1 dir2 é‡å‘½åæˆ–ç§»åŠ¨ä¸€ä¸ªç›®å½•ï¼ˆçœ‹ dir2 æ˜¯å¦å­˜åœ¨ï¼‰ cp file1 file2 å¤åˆ¶æ–‡ä»¶ cp dir/* . å¤åˆ¶æŸç›®å½•ä¸‹æ‰€æœ‰å†…å®¹åˆ°å½“å‰ç›®å½• cp -a dir1/dir2 . å¤åˆ¶ç›®å½•ä¸‹æ‰€æœ‰å†…å®¹åˆ°å½“å‰ç›®å½• cp -a dir1 dir2 å¤åˆ¶ä¸€ä¸ªç›®å½• ln -s dir1|file1 link1 åˆ›å»ºæ–‡ä»¶æˆ–ç›®å½• link çš„è½¯ä»¶é“¾æ¥ ln dir1|file1 link1 åˆ›å»ºæ–‡ä»¶æˆ–ç›®å½• link çš„ç‰©ç†é“¾æ¥ï¼Œä¹Ÿå«ç¡¬é“¾æ¥ [ è½¯é“¾æ¥å’Œç‰©ç†é“¾æ¥çš„åŒºåˆ«ï¼š 1. è½¯é“¾æ¥å¯ä»¥ç”¨äºç›®å½•å’Œæ–‡ä»¶ï¼Œç‰©ç†é“¾æ¥åªèƒ½ç”¨äºæ–‡ä»¶ï¼› 2. æºæ–‡ä»¶åˆ é™¤åï¼Œç‰©ç†é“¾æ¥ä»ç„¶å¯ä»¥æ‰“å¼€è®¿é—®(æ›´åƒå¤åˆ¶)ï¼Œè½¯é“¾æ¥åˆ™å·²ç»æŸå ] find /home/[user] -name æŸç›®å½•ä¸‹æœç´¢æ–‡ä»¶ find ~ -iname \u0026#39;*test*\u0026#39; # iname å¿½ç•¥å¤§å°å†™ zip file1.zip file1 file2 dir1 å°†æ–‡ä»¶å’Œç›®å½•å‹ç¼©æˆ zip æ–‡ä»¶ï¼ˆdir ä¸åŒ…å«å†…å®¹ï¼‰ zip -r file1.zip file1 file2 dir1 å°†æ–‡ä»¶å’Œç›®å½•å‹ç¼©æˆ zip æ–‡ä»¶ï¼ˆdir åŒ…å«å†…å®¹ï¼‰ unzip file1.zip è§£å‹ zip æ–‡ä»¶ tar -zxvf ***.tar.gz cat file1 æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶ tac file1 ä»æœ€åä¸€è¡Œå¼€å§‹åå‘æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ more file1 æŸ¥çœ‹ä¸€ä¸ªé•¿æ–‡ä»¶çš„å†…å®¹ less file1 ç±»ä¼¼äº \u0026#39;more\u0026#39; å‘½ä»¤ï¼Œä½†æ˜¯å®ƒå…è®¸åœ¨æ–‡ä»¶ä¸­å’Œæ­£å‘æ“ä½œä¸€æ ·çš„åå‘æ“ä½œ head -2 file1 æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶çš„å‰ä¸¤è¡Œ tail -2 file1 æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶çš„æœ€åä¸¤è¡Œ grep hello file1 æŸ¥è¯¢å…³é”®å­— â€˜helloâ€™ dump -0aj -f /tmp/home0.bak /home åˆ¶ä½œä¸€ä¸ª \u0026#39;/home\u0026#39; ç›®å½•çš„å®Œæ•´å¤‡ä»½ dump -1aj -f /tmp/home0.bak /home åˆ¶ä½œä¸€ä¸ª \u0026#39;/home\u0026#39; ç›®å½•çš„äº¤äº’å¼å¤‡ä»½ vi file1 //ç¼–è¾‘æ–‡ä»¶ # lsof (https://www.cnblogs.com/sparkbj/p/7161669.html) lsof # åˆ—å‡ºæ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶ lsof /path/file # æŸ¥çœ‹è°åœ¨ä½¿ç”¨æŸä¸ªæ–‡ä»¶ losf -u username # æŸ¥çœ‹æŸç”¨æˆ·æ‰“å¼€çš„æ–‡ä»¶ 2.ç³»ç»Ÿ # date æ˜¾ç¤ºå½“å‰æ—¶é—´ shutdown -h now å…³é—­ç³»ç»Ÿ reboot é‡å¯ logout æ³¨é”€ groupadd group_name åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ç»„ groupdel group_name åˆ é™¤ä¸€ä¸ªç”¨æˆ·ç»„ groupmod -n new_group_name old_group_name é‡å‘½åä¸€ä¸ªç”¨æˆ·ç»„ useradd -c \u0026#34;Name Surname \u0026#34; -g admin -d /home/user1 -s /bin/bash user1 åˆ›å»ºä¸€ä¸ªå±äº \u0026#34;admin\u0026#34; ç”¨æˆ·ç»„çš„ç”¨æˆ· usermod -a -G sudo dp å°†ç”¨æˆ·æ·»åŠ åˆ°sudoç»„ useradd user1 åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ· userdel -r user1 åˆ é™¤ä¸€ä¸ªç”¨æˆ· ( \u0026#39;-r\u0026#39; æ’é™¤ä¸»ç›®å½•) usermod -c \u0026#34;User FTP\u0026#34; -g system -d /ftp/user1 -s /bin/nologin user1 ä¿®æ”¹ç”¨æˆ·å±æ€§ passwd ä¿®æ”¹å¯†ç  passwd user1 ä¿®æ”¹ä¸€ä¸ªç”¨æˆ·çš„å£ä»¤ (åªå…è®¸rootæ‰§è¡Œ) # ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤å¯ç”¨äºæŸ¥çœ‹userå±äºå“ªä¸ªç»„ id user1 groups user1 # screen screen -dmS dp screen -ls screen -rd dp # æŸ¥çœ‹linuxç³»ç»Ÿ cat /proc/version uname -a lsb_release -a (é¦–é€‰) 3.æŠ€å·§ # # ä¸Šè¡Œå‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•° !$ $ mv /path/to/wrongfile /some/other/place mv: cannot stat \u0026#39;/path/to/wrongfile\u0026#39;: No such file or directory $ mv /path/to/rightfile !$ # ä¸Šè¡Œå‘½ä»¤çš„ç¬¬ n ä¸ªå‚æ•°ï¼Œ0,1,2,..,n !:n $ tar -cvf afolder afolder.tar # å†™åå‚æ•° tar: failed to open $ !:0 !:1 !:3 !:2 tar -cvf afolder.tar afolder # ä¸Šè¡Œå‘½ä»¤å‚æ•°èŒƒå›´ $ grep \u0026#39;(ping|pong)\u0026#39; afile # å†™é”™ egrep # Linux ä¸‹ grep æ˜¾ç¤ºå‰åå‡ è¡Œä¿¡æ¯ # æ ‡å‡† unix/linux ä¸‹çš„ grep é€šè¿‡ä¸‹é¢åƒæ•°æ§åˆ¶ä¸Šä¸‹æ–‡ grep -C 5 foo file æ˜¾ç¤º file æ–‡ä»¶é‡ŒåŒ¹é… foo å­—ä¸²é‚£è¡Œä»¥åŠä¸Šä¸‹ 5 è¡Œ grep -B 5 foo file æ˜¾ç¤º foo åŠå‰ 5 è¡Œ grep -A 5 foo file æ˜¾ç¤º foo åŠå 5 è¡Œ $ egrep !:1-$ egrep \u0026#39;(ping|pong)\u0026#39; afile ping # å‰ä¸€ä¸ªå‘½ä»¤ç»“æœè¿‡æ»¤ $ ps -ef | grep nginx # æŸ¥çœ‹ç«¯å£ lsof -i:[port] netstat -tunlp |grep [port] # è¿œç¨‹ sudo ssh -i xxx.pem ubuntu@192.168.1.1 # è¿œç¨‹ç›´æ¥è¿›å…¥æŸç›®å½• sudo ssh -i xxx.pem ubuntu@192.168.1.1 -t \u0026#39;/some/path; bash --login\u0026#39; # linux ç³»ç»Ÿé—´æ–‡ä»¶å¤åˆ¶ sudo scp -i ~/dp/k8s.dp.io/.ssh/id_rsa /home/ubuntu/hello.txt admin@bastion-k8s-dp-com-qcojf8-1198362181.ap-southeast-1.elb.amazonaws.com:~/ # shell æ–‡ä»¶å‡ºé”™å³é€€å‡º #!/usr/bin/env bash set -e -o pipefail # æŸ¥çœ‹ç³»ç»Ÿæ˜¯ 32 ä½è¿˜æ˜¯ 64 ä½ uname -a # é€€å‡º telnet ctrl+]ï¼Œç„¶åè¾“å…¥ quit # base64 ç¼–ç \u0026amp;åç¼–ç  echo -n \u0026#34;JayChou\u0026#34; | base64 echo -n SmF5Q2hvdQ== | base64 --decode apt # apt upgrade apt update [-y] apt install [pkg] [-y] apt remove/autoremove [pkg] [-y] apt purge CentOS # sudo dhclient sudo yum update -y su root vi /etc/sudoers # root ALL=(ALL) ALL åæ·»åŠ  xxx ALL=(ALL) ALL # æˆ–è€… xxx ALL=(ALL) NOPASSWD: ALL ï¼ˆä¸ç”¨å¯†ç ï¼‰ # wq!é€€å‡º ip addr cd /etc/sysconfig/network-scripts/ ls sudo vi ifcfg-ens33 # ONBOOT=no æ”¹æˆyes sudo ifup ens33 # æŸ¥çœ‹æ–‡ä»¶å¤§å° ls -ll ls -lh # æŸ¥çœ‹ç›®å½•å¤§å° du -sh ï¼Š du -sh /path/* è™šæ‹Ÿæœºé•œåƒæ–‡ä»¶ï¼š\nCentOS7\nä¸‹è½½åœ°å€ï¼š http://mirrors.aliyun.com/centos/7/isos/x86_64/CentOS-7-x86_64-DVD-2003.iso\nKitematic # Download: https://github.com/docker/kitematic/releases\ninstall on ubutnu:\nsudo dpkg -i Kitematic-0.17.11_amd64.deb sudo groupadd docker sudo usermod -aG docker $USER reboot ubutnu, then using Kitematic.\nsedæ›¿æ¢æ–‡æœ¬ # æ¯”å¦‚ hello.txt æ–‡æœ¬ä¸­å†…å®¹å¦‚ä¸‹ï¼š\nhello, Name! ç°ä½¿ç”¨çœŸå® Name æ›¿æ¢æ‰ #Name#ã€‚\nexport Name=JayChou sed -i \u0026#34;s/Name/$Name/g\u0026#34; hello.txt ä½†æ˜¯å¦‚æœæ›¿æ¢çš„æ–‡æœ¬ä¸­åŒ…å« / çš„è¯ï¼Œé‚£ä¹ˆä¸Šé¢è¿™ä¸ªå‘½ä»¤ä¼šå¤±è´¥ï¼šsed: -e expression #1, char 12: unknown option to\nä¾‹å¦‚\nexport Name=Jay/Chou sed -i \u0026#34;s/Name/$Name/g\u0026#34; hello.txt è¿™é‡Œä¸ºäº†ä¿ç•™è¢«æ›¿æ¢æ–‡æœ¬çš„ /ï¼Œæœ‰ä¸¤ç§æ–¹æ³•\nåœ¨è¢«æ›¿æ¢æ–‡æœ¬ä¸­ä½¿ç”¨è½¬ä¹‰ç¬¦å·ï¼š\nexport Name=Jay\\/Chou sed -i \u0026#34;s/Name/$Name/g\u0026#34; hello.txt ä½¿ç”¨ # ä»£æ›¿ / ä½œä¸º sed ä¸­æ›¿æ¢ä¸è¢«æ›¿æ¢å­—ç¬¦çš„åˆ†å‰²ç¬¦ï¼š\nexport Name=Jay/Chou sed -i \u0026#34;s#Name#$Name#g\u0026#34; hello.txt ä¿®æ”¹å‘½ä»¤è¡Œæ–‡ä»¶è·¯å¾„æ˜¾ç¤º # æ–‡ä»¶è·¯å¾„å¤ªé•¿ï¼Œå‘½ä»¤è¡Œå¾ˆéš¾çœ‹ï¼Œåªæ˜¾ç¤ºå½“å‰ç›®å½•ï¼š\nvim ~/.bashrc # å°†ä¸‹è¡Œçš„wæ”¹æˆW PS1=\u0026#39;${debian_chroot:+($debian_chroot)}\\u@\\h:\\W\\$\u0026#39; ç½‘ç»œå‘½åç©ºé—´ # sudo ip netns add newnetns sudo ip netns exec newnetns bash # è¿›å…¥å‘½åç©ºé—´å ä½¿ç”¨exité€€å‡º sudo ip netns exec newnetns bash -rcfile \u0026lt;(echo \u0026#34;PS1=\\\u0026#34;greenland\u0026gt; \\\u0026#34;\u0026#34;) sudo ip netns delete newnetns æ¸…ç†å·¥ä½œ # ä¸€ã€åˆ é™¤ç¼“å­˜\n1ï¼Œéå¸¸æœ‰ç”¨çš„æ¸…ç†å‘½ä»¤ï¼š\nsudo apt-get autoclean æ¸…ç†æ—§ç‰ˆæœ¬çš„è½¯ä»¶ç¼“å­˜ sudo apt-get clean æ¸…ç†æ‰€æœ‰è½¯ä»¶ç¼“å­˜ sudo apt-get autoremove åˆ é™¤ç³»ç»Ÿä¸å†ä½¿ç”¨çš„å­¤ç«‹è½¯ä»¶ è¿™ä¸‰ä¸ªå‘½ä»¤ä¸»è¦æ¸…ç†å‡çº§ç¼“å­˜ä»¥åŠæ— ç”¨åŒ…çš„ã€‚\n2ï¼Œæ¸…ç† opera firefox çš„ç¼“å­˜æ–‡ä»¶ï¼š\nls ~/.opera/cache4 ls ~/.mozilla/firefox/*.default/Cache 3ï¼Œæ¸…ç† Linux ä¸‹å­¤ç«‹çš„åŒ…ï¼š ç»ˆç«¯å‘½ä»¤ä¸‹æˆ‘ä»¬å¯ä»¥ç”¨ï¼š\nsudo apt-get install deborphan -y 4ï¼Œå¸è½½ï¼štracker è¿™ä¸ªä¸œè¥¿ä¸€èˆ¬æˆ‘åªè¦å®‰è£… ubuntu å°±ä¼šç¬¬ä¸€åˆ æ‰ tracker ä»–ä¸ä»…ä¼šäº§ç”Ÿå¤§é‡çš„ cache æ–‡ä»¶è€Œä¸”è¿˜ä¼šå½±å“å¼€æœºé€Ÿåº¦ã€‚å†è½¯ä»¶ä¸­å¿ƒåˆ é™¤ã€‚\né™„å½•ï¼š åŒ…ç®¡ç†çš„ä¸´æ—¶æ–‡ä»¶ç›®å½•: åŒ…åœ¨ /var/cache/apt/archives æ²¡æœ‰ä¸‹è½½å®Œçš„åœ¨ /var/cache/apt/archives/partial\näºŒã€åˆ é™¤è½¯ä»¶\nubuntu è½¯ä»¶çš„åˆ é™¤ä¸€èˆ¬ç”¨â€œubuntu è½¯ä»¶ä¸­å¿ƒâ€æˆ–â€œæ–°ç«‹å¾—â€å°±èƒ½æå®šï¼Œä½†æœ‰æ—¶ç”¨å‘½ä»¤ä¼¼ä¹æ›´å¿«æ›´å¥½ï½ï½\nsudo apt-get remove --purge è½¯ä»¶å sudo apt-get autoremove åˆ é™¤ç³»ç»Ÿä¸å†ä½¿ç”¨çš„å­¤ç«‹è½¯ä»¶ sudo apt-get autoclean æ¸…ç†æ—§ç‰ˆæœ¬çš„è½¯ä»¶ç¼“å­˜ dpkg -l |grep ^rc|awk \u0026#39;{print $2}\u0026#39; |sudo xargs dpkg -P æ¸…é™¤æ®‹ä½™çš„é…ç½®æ–‡ä»¶ ä¿è¯å¹²å‡€ã€‚\nä¸‰ã€åˆ é™¤å¤šä½™å†…æ ¸\n1ï¼Œé¦–å…ˆè¦ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹å½“å‰ Ubuntu ç³»ç»Ÿä½¿ç”¨çš„å†…æ ¸\nuname -a 2ï¼Œå†æŸ¥çœ‹æ‰€æœ‰å†…æ ¸\ndpkg --get-selections|grep linux 3ï¼Œæœ€åå°å¿ƒç¿¼ç¿¼åœ°åˆ é™¤å§\nsudo apt-get remove linux-image-2.6.32-22-generic psï¼šlinux-image-xxxxxx-generic å°±æ˜¯è¦åˆ é™¤çš„å†…æ ¸ç‰ˆæœ¬ è¿˜æœ‰ linux-headers-xxxxxx linux-headers-xxxxxx-generic æ€»ä¹‹ä¸­é—´æœ‰â€œxxxxxxâ€é‚£æ®µçš„æ—§å†…æ ¸éƒ½èƒ½åˆ ï¼Œæ³¨æ„ä¸€èˆ¬é€‰å†…æ ¸å·è¾ƒå°çš„åˆ é™¤ã€‚\nÂ« Linux å‘½ä»¤\nÂ» Linux å¯ç”¨ crontab æ—¥å¿—\n"},{"id":181,"href":"/linux/linux-enable-crontab-log/","title":"Linux Enable Crontab Log","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / Linux å¯ç”¨ crontab æ—¥å¿—\nLinux å¯ç”¨ crontab æ—¥å¿— # You can enable logging for cron jobs in order to track problems.\nYou need to edit the /etc/rsyslog.conf or /etc/rsyslog.d/50-default.conf (on Ubuntu) file and make sure you have the following line uncommented or add it if it is missing:\ncron.* /var/log/cron.log Then restart rsyslog and cron:\nsudo service rsyslog restart sudo service cron restart Cron jobs will log to /var/log/cron.log .\nÂ« Linuxå¸¸ç”¨å‘½ä»¤\nÂ» Linux-å®‰å…¨ç™»å½•\n"},{"id":182,"href":"/linux/linux-secure-login/","title":"Linux Secure Login","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / Linux-å®‰å…¨ç™»å½•\nLinux-å®‰å…¨ç™»å½• # æˆ‘ä»¬éƒ½çŸ¥é“\nroot æ˜¯ linux ç³»ç»Ÿé»˜è®¤çš„æœ€é«˜æƒé™è´¦å· linux ç³»ç»Ÿé»˜è®¤çš„ ssh ç«¯å£æ˜¯ 22 å¤§å¤šæ•°äººä¹ æƒ¯ä½¿ç”¨ user/password æ¥ç™»å½• linux ç³»ç»Ÿ å¾ˆé—æ†¾ï¼Œå¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰åšç‰¹æ®Šç­‰ç™»é™†é…ç½®ï¼Œé‚£ä¹ˆå…¶ä»–äººä¾¿å¯ä»¥åˆ©ç”¨ ssh ip:22 root/æš´åŠ›å¯†ç  æ¥ç ´è§£ç™»å…¥ä½  çš„ linux ç³»ç»Ÿï¼Œä¸€æ—¦è¢«ä»–ç ´è§£ï¼Œä½ çš„ç³»ç»Ÿå°±å¯ä»¥ä¸ºä»–æ‰€ç”¨äº†ã€‚\nä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼æ¥é¿å…å‘ç”Ÿè¿™ç±»å®‰å…¨é—®é¢˜ã€‚\n1. ç¦ç”¨ root è´¦å·ç™»å½• # ç¦ç”¨ root è´¦å·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¿…é¡»åˆ›å»ºå…¶ä»–ç™»å½•è´¦å·ï¼Œè¿™é‡Œå»ºè®®è´¦å·åä¸è¦ä¸º admin è¿™ç±»å¸¸è§ç”¨æˆ·åã€‚\nåˆ›å»ºç”¨æˆ·ï¼ˆä»¥ä¸‹éƒ½åŸºäº ubuntu ç³»ç»Ÿæ“ä½œï¼‰ adduser dp ç”¨æˆ·èµ‹æƒ æ­¤æ—¶åˆ›å»ºçš„ç”¨æˆ·ä¸èƒ½ä½¿ç”¨ sudo æƒé™ï¼Œè€ƒè™‘å°†ç”¨æˆ·åŠ å…¥ sudo ç»„\nusermod -a -G sudo dp å¹¶ä¸”ï¼Œä¸ºäº†é¿å…ä½¿ç”¨ sudo æƒé™éœ€è¦æ—¶ä¸æ—¶çš„è¾“å…¥å¯†ç çš„éº»çƒ¦ï¼Œè¿›è¡Œå…å¯†è®¾ç½®ã€‚åœ¨ /etc/sudoers æ–‡ä»¶ä¸­æ–°å¢è¡Œã€‚\ndp ALL=(ALL) NOPASSWD: ALL åˆ°äº†è¿™ä¸€æ­¥ï¼Œåº”è¯¥å°è¯•ä½¿ç”¨æ–°ç”¨æˆ·ç™»å½•ç³»ç»Ÿï¼Œå¦‚æœæˆåŠŸç™»å½•å†å¾€ä¸‹ç»§ç»­ã€‚ ç¦ç”¨ root ç™»å½• æ‰“å¼€ /etc/ssh/sshd_config æ–‡ä»¶ï¼Œæ‰¾åˆ° PermitRootLogin é¡¹ï¼Œä¿®æ”¹è¯¥é¡¹æˆå¦‚ä¸‹ï¼š\nPermitRootLogin no ä¿å­˜é…ç½®åï¼Œé‡å¯ ssh æœåŠ¡:\nsystemctl restart ssh è‡³æ­¤ï¼Œroot è´¦å·å·²ç»è¢«ç¦ç”¨è¿œç¨‹ç™»å½•äº†ã€‚\n2. æ›´æ”¹ ssh è¿œç¨‹ç«¯å£ # å¼ƒç”¨ 22 ç«¯å£ï¼Œä½¿ç”¨ 0~65535 èŒƒå›´å†…éšæœºç«¯å£ä½œä¸º ssh ç«¯å£ã€‚\nè¦åšçš„æ˜¯ä¿®æ”¹ /etc/ssh/sshd_conf æ–‡ä»¶ï¼Œæ‰¾åˆ° Port é¡¹ï¼Œä¿®æ”¹è¯¥é¡¹æˆå¦‚ä¸‹ï¼š\nPort 39855 ä¿å­˜é…ç½®åï¼Œé‡å¯ ssh æœåŠ¡:\nservice ssh restart è‡³æ­¤ï¼ŒæœåŠ¡å™¨ ssh è¿œç¨‹ç«¯å£å·²ç»ä¿®æ”¹ä¸º 39855ï¼Œä¸èƒ½å†ä½¿ç”¨ 22 ç«¯å£ç™»é™†ç³»ç»Ÿäº†ã€‚\n3. ä½¿ç”¨å¯†é’¥æ–‡ä»¶ç™»å½• # æœ¬åœ°åˆ›å»ºå¯†é’¥æ–‡ä»¶ï¼š\nssh-keygen -t rsa -C poneding@gmail.com -f ~/.ssh/id_rsa_poneding ä»¥ä¸Šå‘½ä»¤ä¼šé»˜è®¤åœ¨ ~/.ssh ç›®å½•ä¸‹ç”Ÿæˆ id_rsa_poneding ç§é’¥æ–‡ä»¶å’Œ id_rsa_poneding.pub æ–‡ä»¶ï¼Œå°† id_rsa_poneding.pub æ–‡ä»¶å†…å®¹è¿½åŠ åˆ°æœåŠ¡å™¨ ~/.ssh/authorized_keys æ–‡ä»¶ä¸­å³å¯ã€‚\nÂ« Linux å¯ç”¨ crontab æ—¥å¿—\nÂ» åˆ¶ä½œ Linux ç³»ç»Ÿå¯åŠ¨ U ç›˜\n"},{"id":183,"href":"/linux/make-bootable-udisk/","title":"Make Bootable Udisk","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / åˆ¶ä½œ Linux ç³»ç»Ÿå¯åŠ¨ U ç›˜\nåˆ¶ä½œ Linux ç³»ç»Ÿå¯åŠ¨ U ç›˜ # ä»¥åˆ¶ä½œ Ubuntu å¯åŠ¨ U ç›˜ä¸ºä¾‹ï¼šå·²ç»ä¸‹è½½äº† Ubuntu é•œåƒæ–‡ä»¶ï¼šubuntu-22.04.5-live-server-arm64.iso\nWindows ç³»ç»Ÿä¸‹åˆ¶ä½œ # ä½¿ç”¨ Rufus å·¥å…·ã€‚\nMac ç³»ç»Ÿä¸‹åˆ¶ä½œ # hdiutil convert -format UDRW -o ubuntu-2204 æŸ¥çœ‹ U ç›˜åç§°ï¼š\ndiskutil list å¸è½½ U ç›˜ï¼š\ndiskutil unmountDisk /dev/disk2 åˆ¶ä½œç›˜ï¼š\nsudo dd if=ubuntu-18.04.dmg of=/dev/rdisk2 bs=1m æ³¨æ„ï¼Œè¿™é‡Œ /dev/rdisk2 U ç›˜åç§°å‰åŠ äº†ä¸€ä¸ª rï¼Œåˆ¶ä½œé€Ÿåº¦ä¼šæ›´å¿«ã€‚\nç­‰å¾…åˆ¶ä½œå®Œæˆï¼Œå¼¹å‡º U ç›˜ï¼š\ndiskutil eject /dev/disk2 Linux ç³»ç»Ÿä¸‹åˆ¶ä½œ # ä¸ Mac ç³»ç»Ÿä¸‹åˆ¶ä½œç±»ä¼¼ï¼Œé¦–å…ˆæŸ¥çœ‹ U ç›˜åç§°ï¼š\nsudo fdisk -l å¸è½½ U ç›˜ï¼š\numount /dev/sda1 æ ¼å¼åŒ– U ç›˜ï¼š\nsudo mkfs.ntfs -f /dev/sda1 åˆ¶ä½œç›˜ï¼š\nsudo dd if=~/Downloads/ubuntu-22.04.5-live-server-arm64.iso of=/dev/sda1 ç­‰å¾…åˆ¶ä½œå®Œæˆï¼Œå¼¹å‡º U ç›˜ï¼š\nsudo eject eject /dev/sda Â« Linux-å®‰å…¨ç™»å½•\nÂ» Linux æŒ‚è½½ç£ç›˜\n"},{"id":184,"href":"/linux/mount-disk/","title":"Mount Disk","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / Linux æŒ‚è½½ç£ç›˜\nLinux æŒ‚è½½ç£ç›˜ # åœ¨ VMware ç•Œé¢æ·»åŠ é¢å¤–çš„è™šæ‹Ÿç¡¬ç›˜ã€‚ åœ¨ Linux ç³»ç»Ÿä¸­è¯†åˆ«å¹¶æŒ‚è½½è¿™ä¸ªæ–°ç¡¬ç›˜ã€‚ ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ­¥éª¤ï¼š\nè¯†åˆ«æ–°ç£ç›˜ # ç™»å½• Linux ç³»ç»Ÿï¼Œä½¿ç”¨ lsblk æˆ– fdisk å‘½ä»¤æ£€æŸ¥æ–°æ·»åŠ çš„ç£ç›˜è®¾å¤‡ã€‚\nlsblk æˆ–\nsudo fdisk -l ä½ åº”è¯¥èƒ½çœ‹åˆ°ä¸€ä¸ªæ–°çš„è®¾å¤‡ï¼Œä¾‹å¦‚ /dev/sdbï¼ˆæ ¹æ®ä½ å®é™…çš„è®¾å¤‡åç§°ï¼‰ã€‚\nåˆ†åŒºæ–°ç£ç›˜ # å¦‚æœç£ç›˜æ˜¯å…¨æ–°çš„ï¼Œéœ€è¦å…ˆä¸ºå…¶åˆ›å»ºåˆ†åŒºã€‚\nä½¿ç”¨ fdisk ä¸ºæ–°ç£ç›˜åˆ›å»ºåˆ†åŒºï¼š sudo fdisk /dev/sdb æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š â€¢ è¾“å…¥ n åˆ›å»ºæ–°åˆ†åŒºã€‚\nâ€¢ è¾“å…¥ p åˆ›å»ºä¸»åˆ†åŒºã€‚\nâ€¢ è¾“å…¥åˆ†åŒºå·ï¼ˆé€šå¸¸æ˜¯ 1ï¼‰ã€‚\nâ€¢ é€‰æ‹©åˆ†åŒºå¤§å°ï¼Œé»˜è®¤å€¼å¯ä»¥å°†æ•´ä¸ªç£ç›˜ç”¨äºä¸€ä¸ªåˆ†åŒºã€‚\nâ€¢ è¾“å…¥ w å†™å…¥æ›´æ”¹å¹¶é€€å‡ºã€‚\næ ¼å¼åŒ–æ–°åˆ†åŒº # ä½¿ç”¨ mkfs å‘½ä»¤æ ¼å¼åŒ–æ–°åˆ›å»ºçš„åˆ†åŒºï¼Œä¾‹å¦‚æ ¼å¼åŒ–ä¸º ext4 æ–‡ä»¶ç³»ç»Ÿï¼š\nsudo mkfs.ext4 /dev/sdb1 /dev/sdb1 æ˜¯åˆšåˆšåˆ›å»ºçš„åˆ†åŒºï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ã€‚\næŒ‚è½½æ–°åˆ†åŒº # åˆ›å»ºä¸€ä¸ªæŒ‚è½½ç‚¹å¹¶æŒ‚è½½åˆ†åŒºï¼š\nåˆ›å»ºæŒ‚è½½ç›®å½•ï¼Œä¾‹å¦‚ /mnt/newdiskï¼š sudo mkdir /mnt/newdisk æŒ‚è½½åˆ†åŒºï¼š sudo mount /dev/sdb1 /mnt/newdisk éªŒè¯æ˜¯å¦æŒ‚è½½æˆåŠŸï¼š df -h é…ç½®è‡ªåŠ¨æŒ‚è½½ # å¦‚æœä½ å¸Œæœ›ç³»ç»Ÿé‡å¯åè‡ªåŠ¨æŒ‚è½½è¯¥ç£ç›˜ï¼Œéœ€è¦å°†æŒ‚è½½ä¿¡æ¯å†™å…¥ /etc/fstab æ–‡ä»¶ã€‚\nè·å–åˆ†åŒºçš„ UUIDï¼š sudo blkid /dev/sdb1 è¿™ä¼šè¿”å›ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š\n/dev/sdb1: UUID=\u0026#34;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\u0026#34; TYPE=\u0026#34;ext4\u0026#34; ç¼–è¾‘ /etc/fstab æ–‡ä»¶ï¼š sudo vim /etc/fstab åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä¸€è¡Œï¼ŒæŒ‡å®šåˆ†åŒºçš„ UUIDã€æŒ‚è½½ç‚¹ã€æ–‡ä»¶ç³»ç»Ÿç±»å‹ç­‰ä¿¡æ¯ï¼š UUID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx /mnt/newdisk ext4 defaults 0 0 ä¿å­˜å¹¶é€€å‡ºã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•æŒ‚è½½æ˜¯å¦æ­£ç¡®ï¼š sudo mount -a Â« åˆ¶ä½œ Linux ç³»ç»Ÿå¯åŠ¨ U ç›˜\nÂ» shell å‘½ä»¤é—´éš”ç¬¦\n"},{"id":185,"href":"/linux/shell-command-interval-character/","title":"Shell Command Interval Character","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / shell å‘½ä»¤é—´éš”ç¬¦\nshell å‘½ä»¤é—´éš”ç¬¦ # æˆ‘ä»¬ç»å¸¸èƒ½çœ‹åˆ°Shellå‘½ä»¤é—´æœ‰å¾ˆå¤šä¸­é—´éš”ç¬¦ï¼š|ï¼Œ||ï¼Œ\u0026amp;\u0026amp; ç­‰ï¼Œå®ƒä»¬åˆ°åº•æœ‰ç€ä»€ä¹ˆæ ·çš„ä½œç”¨å‘¢ï¼Ÿä¸€ä¸€æ¥çœ‹ï¼š\n1. |ï¼š\né—´éš”ç¬¦ | èµ·ç€ç®¡é“çš„ä½œç”¨ï¼Œæ˜¯å°†ä¸Šä¸€æ¡å‘½ä»¤çš„ stdout ä½œä¸ºä¸‹ä¸€æ¡å‘½ä»¤çš„ stdinï¼š\nç¤ºä¾‹ï¼š\necho hello world! | tee hello.txt 2. ||ï¼š\nå‘½ä»¤è¢« || åˆ†å‰²ï¼Œåªæœ‰å½“å‰é¢çš„å‘½ä»¤å‘ç”Ÿé”™è¯¯ï¼Œæ‰ä¼šæ‰§è¡Œåé¢çš„å‘½ä»¤ã€‚\nç¤ºä¾‹ï¼š\n# å¦‚æœåˆ›ä¸šå¤±è´¥ï¼Œé‚£ä¹ˆå°±ç»§ç»­æ‰“å·¥ sh chuangye.sh || sh dagong.sh 3. \u0026amp;\u0026amp;ï¼š\nå‘½ä»¤è¢« \u0026amp;\u0026amp; åˆ†å‰²ï¼Œå‘½ä»¤ä¼šè¿ç»­æ‰§è¡Œï¼Œä½†æ˜¯å¦‚æœå‰é¢çš„å‘½ä»¤å‘ç”Ÿé”™è¯¯ï¼Œä¼šå½±å“åé¢çš„å‘½ä»¤ç»§ç»­æ‰§è¡Œã€‚\nç¤ºä¾‹ï¼š\n# æ´—äº†æ‰‹æ‰èƒ½åƒé¥­ sh wash_hand.sh \u0026amp;\u0026amp; sh eat.sh 4. ;ï¼š\nå‘½ä»¤è¢« ; åˆ†å‰²ï¼Œå‘½ä»¤ä¼šè¿ç»­æ‰§è¡Œï¼Œå³ä½¿å‰é¢çš„å‘½ä»¤å‘ç”Ÿé”™è¯¯ï¼Œä¹Ÿä¸å½±å“åé¢çš„å‘½ä»¤ç»§ç»­æ‰§è¡Œã€‚\nç¤ºä¾‹ï¼š\n# ä¸ç®¡æœ‰æ²¡æœ‰èµšåˆ°é’±ï¼Œéƒ½è¦å›å®¶è¿‡å¹´ sh earn_money.sh; sh go_home.sh 5. \u0026gt;ï¼š\nè¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–‡ä»¶ï¼Œæ–‡ä»¶å­˜åœ¨åˆ™ä¼šè¦†ç›–æ–‡ä»¶å†…å®¹ï¼‰\necho \u0026#34;Hello World\u0026#34; \u0026gt; hello.txt 6. \u0026raquo;ï¼š\nè¿½åŠ åˆ°æŒ‡å®šæ–‡ä»¶ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–‡ä»¶ï¼Œæ–‡ä»¶å­˜åœ¨åˆ™è¿½åŠ æ–‡ä»¶å†…å®¹ï¼‰\necho \u0026#34;Hello World\u0026#34; \u0026gt;\u0026gt; hello.txt Â« Linux æŒ‚è½½ç£ç›˜\nÂ» shell åŸºç¡€\n"},{"id":186,"href":"/linux/shell/","title":"Shell","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / shell åŸºç¡€\nshell åŸºç¡€ # shell æ³¨é‡Š # å•è¡Œæ³¨é‡Šï¼š\n# æ³¨é‡Šå†…å®¹ å¤šè¡Œæ³¨é‡Šï¼š\n:\u0026lt;\u0026lt;EOF æ³¨é‡Šå†…å®¹ æ³¨é‡Šå†…å®¹ æ³¨é‡Šå†…å®¹ EOF æˆ–\n:\u0026lt;\u0026lt;! æ³¨é‡Šå†…å®¹ æ³¨é‡Šå†…å®¹ æ³¨é‡Šå†…å®¹ ! æˆ–\n:\u0026lt;\u0026lt;\u0026#39; æ³¨é‡Šå†…å®¹ æ³¨é‡Šå†…å®¹ æ³¨é‡Šå†…å®¹ \u0026#39; shell å˜é‡ # å®šä¹‰å˜é‡ï¼š\nmy_name=\u0026#34;Ding Peng\u0026#34; ä½¿ç”¨å˜é‡ï¼š\n$my_name ${my_name} åªè¯»å˜é‡ï¼š\nmy_name=\u0026#34;Ding Peng\u0026#34; readonly my_name åˆ é™¤å˜é‡ï¼š\nunset my_name å˜é‡ç±»å‹ï¼š\nå±€éƒ¨å˜é‡ï¼šåœ¨è„šæœ¬æˆ–å‘½ä»¤ä¸­å®šä¹‰ï¼Œä»…åœ¨å½“å‰shellå®ä¾‹æœ‰æ•ˆ ç¯å¢ƒå˜é‡ï¼šæ‰€æœ‰shellå®ä¾‹æœ‰æ•ˆ shellå˜é‡ï¼šshellç¨‹åºè®¾ç½®çš„ç‰¹æ®Šå˜é‡ shell å­—ç¬¦ä¸² # å•å¼•å·ä¸åŒå¼•å·çš„åŒºåˆ«ï¼š\nå•å¼•å·é‡Œçš„ä»»ä½•å­—ç¬¦éƒ½ä¼šåŸæ ·è¾“å‡ºï¼Œå•å¼•å·å­—ç¬¦ä¸²ä¸­çš„å˜é‡æ˜¯æ— æ•ˆçš„ï¼› å•å¼•å·å­—ä¸²ä¸­ä¸èƒ½å‡ºç°å•ç‹¬ä¸€ä¸ªçš„å•å¼•å·ï¼ˆå¯¹å•å¼•å·ä½¿ç”¨è½¬ä¹‰ç¬¦åä¹Ÿä¸è¡Œï¼‰ï¼Œä½†å¯æˆå¯¹å‡ºç°ï¼Œä½œä¸ºå­—ç¬¦ä¸²æ‹¼æ¥ä½¿ç”¨ï¼› åŒå¼•å·é‡Œå¯ä»¥æœ‰å˜é‡ï¼› åŒå¼•å·é‡Œå¯ä»¥å‡ºç°è½¬ä¹‰å­—ç¬¦ my_name=\u0026#34;Ding Peng\u0026#34; hello_string=\u0026#34;Hllo,\\\u0026#34;$my_name\\\u0026#34;!\u0026#34; echo $hello_string è·å–å­—ç¬¦ä¸²é•¿åº¦ï¼š\nmy_name=\u0026#34;dp\u0026#34; echo ${#my_name} # è¾“å‡º5 æˆªå–å­—ç¬¦ä¸²ï¼š\nhello_world=\u0026#34;Hello World!\u0026#34; # ä»index 1æˆªå–4ä¸ªå­—ç¬¦ echo ${hello_world:1:4} # è¾“å‡ºello shell æ•°ç»„ # åªæœ‰ä»¥ä¸ºæ•°ç»„ï¼Œæ²¡æœ‰å¤šç»´æ•°ç»„\n# å®šä¹‰æ•°ç»„ï¼Œç©ºæ ¼éš”å¼€ names=(\u0026#39;Ding Peng\u0026#39; \u0026#39;Jay Chou\u0026#39; \u0026#34;Lebron James\u0026#34;) # è·å–æ•°ç»„å…ƒç´ ï¼Œæ ¹æ®indexè·å– echo ${names[1]} # è·å–æ•°ç»„é•¿åº¦ echo ${#names[@]} echo ${#names[*]} shell ä¼ å‚ # æ‰§è¡Œshellè„šæœ¬æ–‡ä»¶æ—¶ï¼Œä¼ é€’å‚æ•°\nå‡å¦‚æœ‰ä¸€ä¸ªtest.shæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n#!/bin/bash echo \u0026#34;Shell ä¼ é€’å‚æ•°å®ä¾‹ï¼\u0026#34;; # ä½¿ç”¨$næ¥æ”¶å‚æ•° echo \u0026#34;æ‰§è¡Œçš„æ–‡ä»¶åï¼š$0\u0026#34;; echo \u0026#34;ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºï¼š$1\u0026#34;; echo \u0026#34;ç¬¬äºŒä¸ªå‚æ•°ä¸ºï¼š$2\u0026#34;; chmod +x test.sh ./test.sh 1 2 ç¬¬ä¸€è¡Œå‘½ä»¤ç»™test.shæ·»åŠ å¯æ‰§è¡Œæƒé™\nç¬¬äºŒè¡Œå‘½ä»¤æ‰§è¡Œtest.shæ–‡ä»¶\nä»¥ä¸Šå‘½ä»¤å°†è¾“å‡ºï¼š\nShell ä¼ é€’å‚æ•°å®ä¾‹ï¼ æ‰§è¡Œçš„æ–‡ä»¶åï¼š./test.sh ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºï¼š1 ç¬¬äºŒä¸ªå‚æ•°ä¸ºï¼š2 å…¶ä»–å‚æ•°å¤„ç†ï¼š\nå‚æ•° è¯´æ˜ $# ä¼ é€’åˆ°è„šæœ¬çš„å‚æ•°ä¸ªæ•° $* ä»¥ä¸€ä¸ªå•å­—ç¬¦ä¸²æ˜¾ç¤ºæ‰€æœ‰å‘è„šæœ¬ä¼ é€’çš„å‚æ•° $$ è„šæœ¬è¿è¡Œçš„å½“å‰è¿›ç¨‹IDå· $@ ä¸$*ç›¸åŒï¼Œä½†æ˜¯ä½¿ç”¨æ—¶åŠ å¼•å·ï¼Œå¹¶åœ¨å¼•å·ä¸­è¿”å›æ¯ä¸ªå‚æ•°ã€‚ shell if æ§åˆ¶è¯­å¥ # if åé¢éœ€è¦æ¥è€… thenï¼š\nif [ condition-for-test ] then command ... fi æˆ–è€…ï¼Œ\nif [ condition-for-test ]; then command ... fi å¦‚ï¼š\n#!/bin/bash VAR=myvar if [ $VAR = myvar ]; then echo \u0026#34;1: \\$VAR is $VAR\u0026#34; # 1: $VAR is myvar fi if [ \u0026#34;$VAR\u0026#34; = myvar ]; then echo \u0026#34;2: \\$VAR is $VAR\u0026#34; # 2: $VAR is myvar fi if [ $VAR = \u0026#34;myvar\u0026#34; ]; then echo \u0026#34;3: \\$VAR is $VAR\u0026#34; # 3: $VAR is myvar fi if [ \u0026#34;$VAR\u0026#34; = \u0026#34;myvar\u0026#34; ]; then echo \u0026#34;4: \\$VAR is $VAR\u0026#34; # 4: $VAR is myvar fi ä¸Šé¢ï¼Œæˆ‘ä»¬åœ¨æ¯”è¾ƒæ—¶ï¼Œå¯ä»¥ç”¨åŒå¼•å·æŠŠå˜é‡å¼•ç”¨èµ·æ¥ã€‚\nä½†è¦æ³¨æ„å•å¼•å·çš„ä½¿ç”¨ã€‚\n#!/bin/bash VAR=myvar if [ \u0026#39;$VAR\u0026#39; = \u0026#39;myvar\u0026#39; ]; then echo \u0026#39;5a: $VAR is $VAR\u0026#39; else echo \u0026#34;5b: Not equal.\u0026#34; fibas # Output: # 5b: Not equal. ä¸Šé¢è¿™ä¸ªå°±æŠŠ '$VAR' å½“ä¸€ä¸ªå­—ç¬¦ä¸²äº†ã€‚\nä½†å¦‚æœå˜é‡æ˜¯å¤šä¸ªå•è¯ï¼Œæˆ‘ä»¬å°±å¿…é¡»ç”¨åˆ°åŒå¼•å·äº†ï¼Œå¦‚\n#!/bin/bash # è¿™æ ·å†™å°±æœ‰é—®é¢˜ VAR1=\u0026#34;my var\u0026#34; if [ $VAR1 = \u0026#34;my var\u0026#34; ]; then echo \u0026#34;\\$VAR1 is $VAR1\u0026#34; fi # Output # error [: too many arguments # ç”¨åŒå¼•å· if [ \u0026#34;$VAR1\u0026#34; = \u0026#34;my var\u0026#34; ]; then echo \u0026#34;\\$VAR1 is $VAR1\u0026#34; fi æ€»çš„æ¥è¯´ï¼ŒåŒå¼•å·å¯ä»¥ä¸€ç›´åŠ ä¸Šã€‚\nç©ºæ ¼é—®é¢˜ # æ¯”è¾ƒè¡¨è¾¾å¼ä¸­ï¼Œå¦‚æœ = å‰åæ²¡æœ‰ç©ºæ ¼ï¼Œé‚£ä¹ˆæ•´ä¸ªè¡¨æ³•å¼ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå•è¯ï¼Œå…¶åˆ¤æ–­ç»“æœä¸º True.\n#!/bin/bash VAR2=2 # ç”±äºè¢«è¯†åˆ«æˆä¸€ä¸ªå•è¯ï¼Œ [] é‡Œé¢ä¸º true if [ \u0026#34;$VAR2\u0026#34;=1 ]; then echo \u0026#34;$VAR2 is 1.\u0026#34; else echo \u0026#34;$VAR2 is not 1.\u0026#34; fi # Output # 2 is 1. # å‰ååŠ ä¸Šç©ºæ ¼å°±å¥½äº† if [ \u0026#34;$VAR2\u0026#34; = 1 ]; then echo \u0026#34;$VAR2 is 1.\u0026#34; else echo \u0026#34;$VAR2 is not 1.\u0026#34; fi # Output # 2 is not 1. å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ åœ¨åˆ¤æ–­ä¸­ï¼Œä¸­æ‹¬å· [ å’Œå˜é‡ä¹‹é—´ä¸€å®šè¦æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œ= æˆ–è€… ==ã€‚ å¦‚æœç¼ºå°‘äº†ç©ºæ ¼ï¼Œä½ å¯èƒ½ä¼šåˆ°è¿™ç±»ä¼¼è¿™æ ·çš„é”™è¯¯ï¼šunary operator expectedâ€™ or missing]` ã€‚\n# æ­£ç¡®ï¼Œ ç¬¦å·å‰åæœ‰ç©ºæ ¼ if [ $VAR2 = 1 ]; then echo \u0026#34;\\$VAR2 is 1.\u0026#34; else echo \u0026#34;It\u0026#39;s not 1.\u0026#34; fi # Output # 2 is 1. # é”™è¯¯ï¼Œ ç¬¦å·å‰åæ— ç©ºæ ¼ if [$VAR2=1]; then echo \u0026#34;$VAR2 is 1.\u0026#34; else echo \u0026#34;It\u0026#39;s not 1.\u0026#34; fi # Output # line 3: =1: command not found # line 5: [=1]: command not found # It\u0026#39;s not 1. æ–‡ä»¶æµ‹è¯•è¡¨è¾¾å¼ # å¯¹æ–‡ä»¶è¿›è¡Œç›¸å…³æµ‹è¯•ï¼Œåˆ¤æ–­çš„è¡¨è¾¾å¼å¦‚ä¸‹ï¼š\nè¡¨è¾¾å¼ True file1 -nt file2 file1 æ¯” file2 æ–°ã€‚ file1 -ot file2 file1 æ¯” file2 è€ã€‚ -d file æ–‡ä»¶fileå­˜åœ¨ï¼Œä¸”æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ -e file æ–‡ä»¶ file å­˜åœ¨ã€‚ -f file æ–‡ä»¶fileå­˜åœ¨ï¼Œä¸”ä¸ºæ™®é€šæ–‡ä»¶ã€‚ -L file æ–‡ä»¶fileå­˜åœ¨ï¼Œä¸”ä¸ºç¬¦å·è¿æ¥ã€‚ -O file æ–‡ä»¶ flle å­˜åœ¨, ä¸”ç”±æœ‰æ•ˆç”¨æˆ· ID æ‹¥æœ‰ã€‚ -r file æ–‡ä»¶ flle å­˜åœ¨, ä¸”æ˜¯ä¸€ä¸ªå¯è¯»æ–‡ä»¶ã€‚ -s file æ–‡ä»¶ flle å­˜åœ¨, ä¸”æ–‡ä»¶å¤§å°å¤§äº 0ã€‚ -w file æ–‡ä»¶ flle å¯å†™å…¥ã€‚ -x file æ–‡ä»¶ flle å¯å†™æ‰§è¡Œã€‚ å¯ä»¥ä½¿ç”¨ man test æŸ¥çœ‹è¯¦ç»†çš„è¯´æ˜ã€‚\nå½“è¡¨è¾¾å¼ä¸º True æ—¶ï¼Œæµ‹è¯•å‘½ä»¤è¿”å›é€€å‡ºçŠ¶æ€ 0ï¼Œè€Œè¡¨è¾¾å¼ä¸º False æ—¶è¿”å›é€€å‡ºçŠ¶æ€1ã€‚\n#!/bin/bash FILE=\u0026#34;/etc/resolv.conf\u0026#34; if [ -e \u0026#34;$FILE\u0026#34; ]; then if [ -f \u0026#34;$FILE\u0026#34; ]; then echo \u0026#34;$FILE is a file.\u0026#34; fi if [ -d \u0026#34;$FILE\u0026#34; ]; then echo \u0026#34;$FILE is a directory.\u0026#34; fi if [ -r \u0026#34;$FILE\u0026#34; ]; then echo \u0026#34;$FILE is readable.\u0026#34; fi fi å­—ç¬¦ä¸²æ¯”è¾ƒè¡¨è¾¾å¼ # è¡¨è¾¾å¼ True string1 = string2 æˆ– string1 == string2 ä¸¤å­—ç¬¦ç›¸ç­‰ string1 != string2 ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸ç›¸ç­‰ string1 \u0026gt; string2 string1 å¤§äº string2. string1 \u0026lt; string2 string1 å°äºstring2. -n string å­—ç¬¦ä¸²é•¿åº¦å¤§äº0 -z string å­—ç¬¦ä¸²é•¿åº¦ç­‰äº0 #!/bin/bash STRING=\u0026#34;\u0026#34; if [ -z \u0026#34;$STRING\u0026#34; ]; then echo \u0026#34;There is no string.\u0026#34; \u0026gt;\u0026amp;2 exit 1 fi # Output # There is no string. å…¶ä¸­ \u0026gt;\u0026amp;2 å°†é”™è¯¯ä¿¡æ¯å®šä½åˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºã€‚\næ•°å­—æ¯”è¾ƒè¡¨è¾¾å¼ # ä¸‹é¢è¿™äº›æ˜¯ç”¨æ¥æ¯”è¾ƒæ•°å­—çš„ä¸€äº›è¡¨è¾¾å¼ã€‚\n[â€¦] ((â€¦)) True [ â€œint1â€ -eq â€œint2â€ ] (( â€œint1â€ == â€œint2â€ )) ç›¸ç­‰. [ â€œint1â€ -nq â€œint2â€ ] (( â€œint1â€ != â€œint2â€ )) ä¸ç­‰. [ â€œint1â€ -lt â€œint2â€ ] (( â€œint1â€ \u0026lt; â€œint2â€ )) int2 å¤§äº int1. [ â€œint1â€ -le â€œint2â€ ] (( â€œint1â€ \u0026lt;= â€œint2â€ )) int2 å¤§äºç­‰äº int1. [ â€œint1â€ -gt â€œint2â€ ] (( â€œint1 \u0026gt; â€œint2â€ )) int1 å¤§äº int2 [ â€œint1â€ -ge â€œint2â€ ] (( â€œint1 \u0026gt;= â€œint2â€ )) int1 å¤§äºç­‰äº int2 shell è¿ç®—ç¬¦ # ç®—æ•°è¿ç®—ç¬¦ # val1=`expr 2 + 2` val2=`expr 2 - 2` val3=`expr 2 \\* 2` # *å‰é¢å¿…é¡»åŠ \\ val4=`expr 2 / 2` val5=`expr 2 % 2` echo \u0026#34;2 + 2: $val1\u0026#34; echo \u0026#34;2 - 2: $val2\u0026#34; echo \u0026#34;2 * 2: $val3\u0026#34; echo \u0026#34;2 / 2: $val4\u0026#34; echo \u0026#34;2 % 2: $val5\u0026#34; æ³¨æ„ï¼š\nä½¿ç”¨åå¼•å·è€Œä¸æ˜¯å•å¼•å·ï¼› å…³é”®å­—exprï¼› è¿ç®—ç¬¦å¦‚ï¼š+-*/% å­—ç¬¦å‰åéƒ½éœ€è¦ç©ºæ ¼ï¼Œå¦åˆ™è¢«è®¤ä¸ºæ˜¯å­—ç¬¦ä¸² å…¶ä»–ç®—æ•°è¿ç®—ç¬¦ï¼š\nè¿ç®—ç¬¦ è¯´æ˜ ç¤ºä¾‹ = èµ‹å€¼ a=$b == åˆ¤ç­‰ [ $a == $b ] è¿”å›0 != ä¸ç­‰ [ $a != $b ] è¿”å›1 å…³ç³»è¿ç®—ç¬¦ # è¿ç®—ç¬¦ è¯´æ˜ ç¤ºä¾‹ -eq ç­‰äº [ $a -eq $b ] -ne ä¸ç­‰äº -gt å¤§äº -lt å°äº -ge å¤§äºç­‰äº -le å°äºç­‰äº æ³¨æ„ï¼š\nå…³ç³»è¿ç®—ç¬¦åªé€‚ç”¨äºæ•°å­—ï¼Œä¸æ”¯æŒå­—ç¬¦ä¸²ï¼Œé™¤éå­—ç¬¦ä¸²çš„å€¼æ˜¯æ•°å­— å¸ƒå°”è¿ç®—ç¬¦ # è¿ç®—ç¬¦ è¯´æ˜ ç¤ºä¾‹ ! éè¿ç®— [ $a != $b ] -o æˆ–è¿ç®— [ $a -eq $b -o $c -eq $d ] -a ä¸è¿ç®— [ $a -eq $b -a $c -eq $d ] é€»è¾‘è¿ç®—ç¬¦ # è¿ç®—ç¬¦ è¯´æ˜ ç¤ºä¾‹ \u0026amp;\u0026amp; ä¸è¿ç®— [[ $a -eq $b \u0026amp;\u0026amp; $c -eq $d ]] || æˆ–è¿ç®— `[[ $a -eq $b è¯´æ˜ï¼š\néœ€è¦ä¸¤å±‚[] å­—ç¬¦ä¸²è¿ç®—ç¬¦ # è¿ç®—ç¬¦ è¯´æ˜ ç¤ºä¾‹ = åˆ¤ç­‰ [ $a = $b ] != ä¸ç­‰ [ $a != $b ] -z å­—ç¬¦é•¿åº¦æ˜¯å¦ä¸º0 [ -z $a ] -n å­—ç¬¦ä¸²é•¿åº¦ä¸ä¸º0 [ -n $b ] $ å­—ç¬¦ä¸²ä¸ä¸ºç©ºï¼Œemptyæˆ–whitespace [ $a ] æ–‡ä»¶æµ‹è¯•è¿ç®—ç¬¦ # è¿ç®—ç¬¦ è¯´æ˜ ç¤ºä¾‹ -b file æ˜¯å¦ä¸ºå—è®¾å¤‡æ–‡ä»¶ [ -b $filepath ] -c file æ˜¯å¦ä¸ºå­—ç¬¦è®¾å¤‡æ–‡ä»¶ -d file æ˜¯å¦ä¸ºç›®å½• -f file æ˜¯å¦ä¸ºæ™®é€šæ–‡ä»¶ï¼ˆéè®¾å¤‡æ–‡ä»¶ï¼‰ -g file æ˜¯å¦è®¾ç½®SGIDä½ -k file æ˜¯å¦è®¾ç½®äº†ç²˜ç€ä½ï¼ˆsticky bitï¼‰ -p file æ˜¯å¦æœ‰åç®¡é“ -u file æ˜¯å¦è®¾ç½®SUIDä½ -r file æ˜¯å¦å¯è¯» -w file æ˜¯å¦å¯å†™ -x file æ˜¯å¦å¯æ‰§è¡Œ -s file æ˜¯å¦ä¸ä¸ºç©ºæ–‡ä»¶ï¼ˆæ–‡ä»¶å¤§å°ä¸º0ï¼‰ -e file æ–‡ä»¶ï¼ˆç›®å½•ï¼‰æ˜¯å¦å­˜åœ¨ -S file æ–‡ä»¶æ˜¯å¦socket -L file æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ shell å‘½ä»¤ # echo # æ‰“å°å­—ç¬¦ä¸²ï¼š\nå¯ä»¥æ˜¯å¸¦åŒå¼•å·ï¼Œå•å¼•å·ï¼Œä¸å¸¦å¼•å· å¯ä»¥è½¬ä¹‰ å¯ä»¥ç”¨å‚æ•° echo \u0026#34;Hello World\u0026#34; echo \u0026#39;Hello World\u0026#39; echo Hello World name=\u0026#34;Ding Peng\u0026#34; echo \u0026#34;Hello, $name!\u0026#34; # -e å¼€å¯è½¬ä¹‰ echo -e \u0026#34;Hi Ding,\\n\u0026#34; # ä¸¤è¡Œä¹‹é—´ç©ºä¸€è¡Œ echo \u0026#34;Nice to meet you.\u0026#34; echo -e \u0026#34;Hi Jay,\\c\u0026#34; # ä¸ä¼šæ¢è¡Œï¼Œéƒ½åœ¨ä¸€è¡Œå†…è¾“å‡º echo \u0026#34;Nice to meet you.\u0026#34; echo -e \u0026#34;Hi James,\\r\u0026#34; # ä¼šæ¢è¡Œï¼Œä½†æ˜¯æ²¡æœ‰\\rä¹Ÿä¼šé»˜è®¤æ¢è¡Œçš„ã€‚ echo -e \u0026#34;Nice to meet you.\u0026#34; æ‰“å°åˆ°æŸæ–‡ä»¶ï¼š\necho \u0026#34;Hello World\u0026#34; \u0026gt; temp.txt å˜é‡ä¸è½¬ä¹‰ï¼ŒåŸæ ·è¾“å‡ºï¼š\necho \u0026#39;$name\u0026#39; echo \u0026#39;\\*\u0026#39; è¯´æ˜ï¼š\néœ€è¦ç”¨å•å¼•å· æ˜¾ç¤ºå‘½ä»¤æ‰§è¡Œç»“æœï¼š\necho `date` è¯´æ˜ï¼š\nä½¿ç”¨åå¼•å·ï¼Œä¸æ˜¯å•å¼•å· read # äº¤äº’ï¼Œè·å–æ§åˆ¶å°è¾“å…¥å¹¶èµ‹å€¼ç»™æŸå˜é‡\nread name echo $name printf # è¾“å‡ºå‘½ä»¤ï¼Œç§»æ¤æ€§ä¼˜äºechoã€‚é»˜è®¤ä¸æ¢è¡Œï¼Œå¯ä»¥åœ¨å­—ç¬¦ä¸²åæ·»åŠ \\n\nprintf \u0026#34;Hello\\n\u0026#34; é€šè¿‡ä»¥ä¸‹è„šæœ¬å­¦ä¹ printfå‘½ä»¤çš„ä¸€äº›æ ¼å¼åŒ–åŠŸèƒ½\nprintf \u0026#34;%-10s %-8s %-4s\\n\u0026#34; å§“å æ€§åˆ« ä½“é‡kg printf \u0026#34;%-10s %-8s %-4.2f\\n\u0026#34; éƒ­é– ç”· 66.1234 printf \u0026#34;%-10s %-8s %-4.2f\\n\u0026#34; æ¨è¿‡ ç”· 48.6543 printf \u0026#34;%-10s %-8s %-4.2f\\n\u0026#34; éƒ­èŠ™ å¥³ 47.9876 %s %c %d %féƒ½æ˜¯æ ¼å¼æ›¿ä»£ç¬¦ %-10s æŒ‡ä¸€ä¸ªå®½åº¦ä¸º10ä¸ªå­—ç¬¦ï¼ˆ-è¡¨ç¤ºå·¦å¯¹é½ï¼Œæ²¡æœ‰åˆ™è¡¨ç¤ºå³å¯¹é½ï¼‰ï¼Œä»»ä½•å­—ç¬¦éƒ½ä¼šè¢«æ˜¾ç¤ºåœ¨10ä¸ªå­—ç¬¦å®½çš„å­—ç¬¦å†…ï¼Œå¦‚æœä¸è¶³åˆ™è‡ªåŠ¨ä»¥ç©ºæ ¼å¡«å……ï¼Œè¶…è¿‡ä¹Ÿä¼šå°†å†…å®¹å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥ã€‚ %-4.2f æŒ‡æ ¼å¼åŒ–ä¸ºå°æ•°ï¼Œå…¶ä¸­.2æŒ‡ä¿ç•™2ä½å°æ•°ã€‚ shell å˜é‡å¼•ç”¨ # å½“ä½ è¦ä½¿ç”¨å˜é‡çš„æ—¶å€™ï¼Œç”¨ $ æ¥å¼•ç”¨ï¼Œ å¦‚æœåé¢è¦æ¥ä¸€äº›å…¶ä»–å­—ç¬¦ï¼Œå¯ä»¥ç”¨ {} æ‹¬èµ·æ¥ã€‚\n#!/bin/bash WORLD=\u0026#34;world world\u0026#34; echo \u0026#34;hello $WORLD\u0026#34; # hello world world echo \u0026#34;hello ${WORLD}2\u0026#34; # hello world world2 åœ¨ Bash ä¸­è¦æ³¨æ„ å•å¼•å· ' ï¼ŒåŒå¼•å· \u0026quot; ï¼Œåå¼•å· ` çš„åŒºåˆ«ã€‚\nå•å¼•å·ï¼ŒåŒå¼•å·éƒ½èƒ½ç”¨æ¥ä¿ç•™å¼•å·å†…çš„ä¸ºæ–‡å­—å€¼ï¼Œå…¶å·®åˆ«åœ¨äºï¼ŒåŒå¼•å·åœ¨é‡åˆ° $(å‚æ•°æ›¿æ¢) ï¼Œåå¼•å· `(å‘½ä»¤æ›¿æ¢) çš„æ—¶å€™æœ‰ä¾‹å¤–ï¼Œå•å¼•å·åˆ™å‰¥å¤ºå…¶ä¸­æ‰€æœ‰å­—ç¬¦çš„ç‰¹æ®Šå«ä¹‰ã€‚\nè€Œåå¼•å·çš„ä½œç”¨ å’Œ $() æ˜¯å·®ä¸å¤šçš„ã€‚ åœ¨æ‰§è¡Œä¸€æ¡å‘½ä»¤çš„æ—¶å€™ï¼Œä¼šå…ˆæ‰§è¡Œå…¶ä¸­çš„å‘½ä»¤ï¼Œå†æŠŠç»“æœæ”¾åˆ°åŸå‘½ä»¤ä¸­ã€‚\n#!/bin/bash var=\u0026#34;music\u0026#34; sports=\u0026#39;sports\u0026#39; echo \u0026#34;I like $var\u0026#34; # I like music echo \u0026#34;I like ${var}\u0026#34; # I like music echo I like $var # I like music echo \u0026#39;I like $var\u0026#39; # I like $var echo \u0026#34;I like \\$var\u0026#34; # I like $var echo \u0026#39;I like \\$var\u0026#39; # I like \\$var echo `bash -version` # GNU bash, version 5.0.17(1)-release (x86_64-pc-linux-gnu)... echo \u0026#39;bash -version\u0026#39; # bash -version shell ç»å…¸å®ä¾‹ # åˆ é™¤ç¡®è®¤ # #!/bin/bash delete_sure delete_sure(){ cat \u0026lt;\u0026lt; eof $(echo -e \u0026#34;\\033[1;36mNote:\\033[0m\u0026#34;) Delete the KubeSphere cluster, including the module kubesphere-system kubesphere-devops-system kubesphere-monitoring-system kubesphere-logging-system openpitrix-system. eof read -p \u0026#34;Please reconfirm that you want to delete the KubeSphere cluster. (yes/no) \u0026#34; ans while [[ \u0026#34;x\u0026#34;$ans != \u0026#34;xyes\u0026#34; \u0026amp;\u0026amp; \u0026#34;x\u0026#34;$ans != \u0026#34;xno\u0026#34; ]]; do read -p \u0026#34;Please reconfirm that you want to delete the KubeSphere cluster. (yes/no) \u0026#34; ans done if [[ \u0026#34;x\u0026#34;$ans == \u0026#34;xno\u0026#34; ]]; then exit fi } Â« shell å‘½ä»¤é—´éš”ç¬¦\nÂ» ä½¿ç”¨ SSH Tunnel è¿æ¥ä¸­é—´ä»¶\n"},{"id":187,"href":"/linux/ssh-tunnel-connect-middleware/","title":"SSH Tunnel Connect Middleware","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / ä½¿ç”¨ SSH Tunnel è¿æ¥ä¸­é—´ä»¶\nä½¿ç”¨ SSH Tunnel è¿æ¥ä¸­é—´ä»¶ # èƒŒæ™¯ # ä¸€èˆ¬çº¿ä¸Šçš„æ•°æ®åº“æ˜¯ä¸å…è®¸æœ¬æœºç›´æ¥è®¿é—®çš„ï¼Œåªèƒ½é€šè¿‡è·³æ¿æœºè®¿é—®ã€‚ä½†æ˜¯è¿™ä¹ˆå¤šçš„å¼€å‘äººå‘˜éƒ½è¦è®¿é—®æ•°æ®åº“çš„è¯ï¼Œè·³æ¿æœºçš„æ•°é‡å°±æœ‰å‹åŠ›äº†ã€‚\næœ¬ç¯‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ SSH Tunnel çš„æ–¹å¼è®¿é—®æ•°æ®åº“ï¼Œæ•°æ®åº“ä¸é™äº Sql Serverã€MySqlã€Mongodbã€Redis ç­‰ã€‚\nå‰ææ¡ä»¶ # å·²ç»æ‹¥æœ‰æ•°æ®åº“çš„ç™»å½•ä¿¡æ¯ï¼Œå¦‚æ•°æ®åº“è®¿é—®çš„ hostã€portã€userã€passwordï¼› æ‹¥æœ‰ä¸€å°å¯ä»¥è®¿é—®æ•°æ®åº“çš„è·³æ¿æœºç™»å½•æƒé™ï¼Œå¦‚è·³æ¿æœºçš„ IPã€userã€passwordï¼ˆæˆ–å¯†é’¥æ–‡ä»¶ï¼‰ï¼› æœ¬æœºå®‰è£…äº†æœ‰ SSH Tunnel åŠŸèƒ½çš„æ•°æ®åº“çš„å¯è§†åŒ–å·¥å…·ï¼Œå¦‚ DBeaverï¼ŒNavicateï¼ŒRobo 3T ç­‰ã€‚ RDB # ä½¿ç”¨ DBeaver æˆ– Navicate ç­‰å·¥å…·é€šè¿‡ SSH Tunnel æ–¹å¼è®¿é—®å…³ç³»å‹æ•°æ®åº“ï¼Œä»¥ Sql Server ä¸ºä¾‹ã€‚\næ‰“å¼€DBeaverï¼Œé€‰æ‹© Sql Server è¿æ¥ã€‚\nåœ¨è¿æ¥é…ç½®é¡µé¢ Mainï¼Œè¾“å…¥ Sql Server è¿æ¥çš„åŸºæœ¬ä¿¡æ¯ï¼Œè¿™é‡Œ host ç›´æ¥ä½¿ç”¨åŸæœ¬çš„æ•°æ®åº“ host å³å¯ã€‚\nåˆ‡è‡³ SSHï¼Œå‹¾é€‰ Use SSH Tunnelï¼Œè¾“å…¥è·³æ¿æœºçš„è¿æ¥é…ç½®å³å¯ã€‚\né…ç½®å®Œæˆï¼ŒOkè¿æ¥å³å¯ã€‚\nä½¿ç”¨ SSMS + SSH Tunnel è¿æ¥ Sql Server # æœ¬æœºéœ€è¦å®‰è£… SSMS å’Œ Putty å·¥å…·ã€‚\nè¿™ç¯‡æ–‡æ¡£å¯¹æˆ‘å¸®åŠ©å¾ˆå¤§ï¼š https://courses.cs.washington.edu/courses/cse444/11wi/resources/tunneling-instructions.html\næ‰“å¼€ Putty å·¥å…·ï¼Œåœ¨ Session åˆ›å»ºè·³æ¿æœºçš„è¿æ¥ã€‚\nå¹¶ä¸”åœ¨ Connection ä¸­é…ç½®ç™»å½•è´¦å·å’Œå¯†ç ï¼ˆæˆ–å¯†é’¥æ–‡ä»¶ï¼‰ã€‚\nç„¶ååœ¨ Connection=\u0026gt;SSH=\u0026gt;Tunnels ä¸­æ·»åŠ  Sql Server çš„ server ä¿¡æ¯\nåœ¨ Source Port ä¸­è¾“å…¥ \u0026lt;port\u0026gt;ï¼ˆSql Serverçš„é»˜è®¤ç«¯å£æ˜¯1433ï¼‰ï¼›\nåœ¨ Destination ä¸­è¾“å…¥ \u0026lt;host\u0026gt;:\u0026lt;port\u0026gt;ï¼ˆä¾‹å¦‚ï¼šdb.example.com:1433ï¼‰ï¼›\nè¾“å…¥å®Œä¹‹åç‚¹å‡»AddæŒ‰é’®ã€‚\nå®Œæˆæ“ä½œä¹‹åä½ çš„é¡µé¢ä¹Ÿåº”æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ã€‚\nå›åˆ° Connection=\u0026gt;SSHï¼Œå‹¾é€‰ Donâ€™t start as shell or command at all.\nä¸Šé¢çš„é…ç½®å®Œæˆåï¼Œç‚¹å‡» Openï¼Œåº”è¯¥ä¼šè·³å…¥å¦‚ä¸‹çš„è¿œç¨‹ç•Œé¢ã€‚\n**æ³¨æ„ï¼š**å¦‚æœæœ¬æœºå·²ç»å®‰è£…äº† Sql Server æ•°æ®åº“ï¼Œéœ€è¦ç°åœ¨ Service ä¸­åœæ‰æœ¬æœºçš„ SqlServer æœåŠ¡ï¼Œå¦åˆ™å¯èƒ½ä¼šé€ æˆç«¯å£å†²çªã€‚\nè¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ SSMS è¿æ¥æ•°æ®åº“æœåŠ¡äº†ã€‚\n**æ³¨æ„ï¼š**SSMS è¿æ¥é…ç½®é¡µé¢ï¼ŒServer name å¿…é¡»æ˜¯ 127.0.0.1 è€Œä¸æ˜¯åŸæœ¬çš„æ•°æ®åº“ hostã€‚\nNoSql # æ‰“å¼€ Robo 3Tï¼Œæ–°å»ºè¿æ¥ï¼Œå¹¶åœ¨ Connection é¡µé¢é…ç½® mongo çš„è¿æ¥ä¿¡æ¯ã€‚\nåˆ‡è‡³ SSH é¡µé¢ï¼Œå‹¾é€‰ Use SSH Tunnelï¼Œè¾“å…¥è·³æ¿æœºçš„è¿æ¥é…ç½®å³å¯ã€‚\né…ç½®å®Œæˆï¼ŒSave åè¿æ¥å³å¯ã€‚\nå…¶ä»–ä¾‹å¦‚Redisæ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨ Redis Desktop Manager SSH Tunnel è¿æ¥ã€‚\nÂ« shell åŸºç¡€\nÂ» tee ä¿å­˜ stderr åˆ°æ–‡ä»¶\n"},{"id":188,"href":"/linux/tee-keep-stderr/","title":"Tee Keep Stderr","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / tee ä¿å­˜ stderr åˆ°æ–‡ä»¶\ntee ä¿å­˜ stderr åˆ°æ–‡ä»¶ # teeå‘½ä»¤æ˜¯å°† stdout å†™å…¥åˆ°æŸæ–‡ä»¶å½“ä¸­ï¼Œä½†æ˜¯å¦‚ä½•å°† stderr ä¹Ÿå†™å…¥åˆ°æ–‡ä»¶å½“ä¸­ï¼Ÿ\nç¤ºä¾‹å¦‚ä¸‹ï¼š\n1.sh\necho exec 1.sh start! \u0026amp;\u0026amp; \\ cat hello.txt \u0026amp;\u0026amp; \\ echo exec 1.sh end! å‡å¦‚ hello.txt æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ‰§è¡Œ 1.sh æ–‡ä»¶ä¸­çš„ cat å‘½ä»¤å°†æŠ¥é”™ã€‚å¦‚æœæˆ‘ä»¬æƒ³å°†æ‰§è¡Œ 1.sh æ–‡ä»¶çš„è¾“å‡ºå†™å…¥åˆ°ä¸€ä¸ª log æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š\nsh 1.sh | tee 1.log æ‰§è¡Œä»¥ä¸Šå‘½ä»¤ï¼Œæ§åˆ¶å°çš„è¾“å‡ºæ˜¯ï¼š\n$ sh 1.sh | tee 1.log exec 1.sh start! cat: hello.txt: No such file or directory ä½†æ˜¯å†™å…¥åˆ° 1.log æ—¥å¿—æ–‡ä»¶ä¸­çš„å†…å®¹æ˜¯ï¼š\nexec 1.sh start! å¯ä»¥çœ‹åˆ°ï¼Œå¹¶æ²¡æœ‰å°†é”™è¯¯è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°†é”™è¯¯ä¸€å¹¶è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ\nä½¿ç”¨ä»¥ä¸‹åŠæ³•ï¼š\nsh 1.sh 2\u0026amp;\u0026gt;1 | tee 1.log è¿™ä¸‹æˆ‘ä»¬å°±èƒ½åŒæ—¶åœ¨æ§åˆ¶å°å’Œæ—¥å¿—æ–‡ä»¶ä¸­çœ‹åˆ°é”™è¯¯è¾“å‡ºäº†ã€‚\nç§‘æ™®ï¼š\nä¸Šè¿°å‘½ä»¤ä¸­ä½¿ç”¨åˆ°çš„ 2\u0026gt;\u0026amp;1 æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ\n0 stdinï¼Œ1 stdoutï¼Œ2 stderr\n2\u0026gt;\u0026amp;1ï¼šå°†æ ‡å‡†é”™è¯¯é‡å®šå‘è‡³æ ‡å‡†è¾“å‡º\nÂ« ä½¿ç”¨ SSH Tunnel è¿æ¥ä¸­é—´ä»¶\nÂ» æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶\n"},{"id":189,"href":"/linux/transfer-files-between-server-and-client/","title":"Transfer Files Between Server and Client","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶\næœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶ # scp # # å®¢æˆ·ç«¯ \u0026lt;= æœåŠ¡ç«¯ scp server_user@server_ip:/server_path /client_path # å®¢æˆ·ç«¯ =\u0026gt; æœåŠ¡ç«¯ scp /client_path server_user@server_ip:/server_path # ä¼ è¾“ç›®å½•ï¼šscp -r sftp # å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„è¿œç¨‹æ–‡ä»¶ä¼ è¾“å·¥å…·ã€‚\nç¬¬ä¸€æ­¥ï¼Œè¿æ¥æœåŠ¡ç«¯ï¼š\nsftp server_user@server_ip -i ssh_key_file ç¬¬äºŒæ­¥ï¼Œä¼ è¾“æ–‡ä»¶ï¼š\n# å®¢æˆ·ç«¯ \u0026lt;= æœåŠ¡ç«¯ get /server_path /client_path # å°†å®¢æˆ·ç«¯æ–‡ä»¶ä¼ è¾“åˆ°æœåŠ¡ç«¯ put /client_/file/_path /server_path # ä¼ è¾“æ–‡ä»¶å¤¹ï¼šget -rï¼Œput -r Â« tee ä¿å­˜ stderr åˆ°æ–‡ä»¶\nÂ» vim ä½¿ç”¨\n"},{"id":190,"href":"/linux/vim-common-commands/","title":"Vim Common Commands","section":"Linux","content":" ğŸ  é¦–é¡µ / Linux / vim ä½¿ç”¨\nvim ä½¿ç”¨ # è®¾ç½® # vim /etc/vim/vimrc æˆ–è€…å½“å‰ç¯å¢ƒè®¾ç½®\n:set paste :set nopaste :set number :set nonumber :set hlsearch :set nohlsearch :set cursorline :set nocursorline vimåˆ é™¤æ‰€æœ‰è¡Œ # ggdG æ’¤é”€ # u ctrl+r æŸ¥æ‰¾ # å¤§å°å†™é—®é¢˜ï¼š\né»˜è®¤å¤§å°å†™æ•æ„Ÿã€‚\nå¤§å°å†™ä¸æ•æ„Ÿï¼š/hello\\c\nå¤§å°å†™æ•æ„Ÿï¼š/hello\\C\nè®¾ç½®å¤§å°å†™æ•æ„Ÿï¼š\necs+:set ignorecaseï¼šè®¾ç½®é»˜è®¤å¿½ç•¥å¤§å°å†™æ•æ„Ÿ\necs+:set smartcaseï¼šå¦‚æœæŸ¥æ‰¾å­—ç¬¦ä¸­å­˜åœ¨å¤§å†™åˆ™è‡ªåŠ¨å¤§å°å†™æ•æ„Ÿ\næŸ¥æ‰¾å½“å‰å­—ç¬¦ï¼š\nå…‰æ ‡ç§»åŠ¨ # hï¼šå‘å·¦ jï¼šå‘ä¸‹ kï¼šå‘ä¸Š lï¼šå‘å³ æ›¿æ¢ # :s/jay/dp/g æ›¿æ¢å½“å‰è¡Œä¸­æ‰€æœ‰åŒ¹é… jay =\u0026gt; dp :1,$s/jay/dp/g æ›¿æ¢æ‰€æœ‰ :1,5s/jay/dp/g æ›¿æ¢ 1 åˆ° 5 è¡Œ ç¿»é¡µ # ctrl+fï¼šä¸‹ä¸€é¡µ ctrl+dï¼šä¸‹åŠé¡µ ctrl+bï¼šä¸Šä¸€é¡µ ctrl+uï¼šä¸ŠåŠé¡µ è¡Œæ“ä½œ # dGï¼šåˆ é™¤å½“å‰è¡Œåˆ°å°¾è¡Œ\nddï¼šåˆ é™¤å½“å‰è¡Œ\nyyï¼šå¤åˆ¶å½“å‰è¡Œ\npï¼šç²˜è´´è¡Œ\nddpï¼šä¸‹ä¸€è¡Œ\né€€å‡º # å¦‚æœä½ æ²¡æœ‰ sudo æƒé™æ‰“å¼€äº†æ–‡ä»¶ï¼Œä½†æ˜¯ä½ å·²ç»ç¼–å†™äº†å¾ˆå¤šå†…å®¹ï¼Œæ€ä¹ˆä¿å­˜æ¨å‡ºå‘¢ï¼š\n:w ! sudo tee % ä¿å­˜åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶ï¼š\n:w otherfile # ä¼šç”Ÿæˆæ–°æ–‡ä»¶ï¼Œä¿®æ”¹å†…å®¹ä½“ç°åœ¨æ–°æ–‡ä»¶ä¸­ï¼ŒåŸæ–‡ä»¶ä¸å˜ æŸ¥æ‰¾ # åœ¨ normal æ¨¡å¼ä¸‹æŒ‰ä¸‹ / å³å¯è¿›å…¥æŸ¥æ‰¾æ¨¡å¼ï¼Œè¾“å…¥è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²å¹¶æŒ‰ä¸‹å›è½¦ã€‚ Vim ä¼šè·³è½¬åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…ã€‚æŒ‰ä¸‹ n æŸ¥æ‰¾ä¸‹ä¸€ä¸ªï¼ŒæŒ‰ä¸‹ N æŸ¥æ‰¾ä¸Šä¸€ä¸ªã€‚\nVim æŸ¥æ‰¾æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ /vim$ åŒ¹é…è¡Œå°¾çš„ \u0026quot;vim\u0026quot;ã€‚ éœ€è¦æŸ¥æ‰¾ç‰¹æ®Šå­—ç¬¦éœ€è¦è½¬ä¹‰ï¼Œä¾‹å¦‚ /vim\\$ åŒ¹é… \u0026quot;vim$\u0026quot;ã€‚\næ³¨æ„æŸ¥æ‰¾å›è½¦åº”å½“ç”¨ \\nï¼Œè€Œæ›¿æ¢ä¸ºå›è½¦åº”å½“ç”¨ \\rï¼ˆç›¸å½“äº \u0026lt;CR\u0026gt;ï¼‰ã€‚\nå¤§å°å†™æ•æ„ŸæŸ¥æ‰¾ # åœ¨æŸ¥æ‰¾æ¨¡å¼ä¸­åŠ å…¥ \\c è¡¨ç¤ºå¤§å°å†™ä¸æ•æ„ŸæŸ¥æ‰¾ï¼Œ\\C è¡¨ç¤ºå¤§å°å†™æ•æ„ŸæŸ¥æ‰¾ã€‚ä¾‹å¦‚ï¼š\n/foo\\c å°†ä¼šæŸ¥æ‰¾æ‰€æœ‰çš„ \u0026quot;foo\u0026quot;,\u0026quot;FOO\u0026quot;,\u0026quot;Foo\u0026quot; ç­‰å­—ç¬¦ä¸²ã€‚\nå¤§å°å†™æ•æ„Ÿé…ç½® # Vim é»˜è®¤é‡‡ç”¨å¤§å°å†™æ•æ„Ÿçš„æŸ¥æ‰¾ï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å¸¸å¸¸å°†å…¶é…ç½®ä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼š\n\u0026#34; è®¾ç½®é»˜è®¤è¿›è¡Œå¤§å°å†™ä¸æ•æ„ŸæŸ¥æ‰¾ set ignorecase \u0026#34; å¦‚æœæœ‰ä¸€ä¸ªå¤§å†™å­—æ¯ï¼Œåˆ™åˆ‡æ¢åˆ°å¤§å°å†™æ•æ„ŸæŸ¥æ‰¾ set smartcase å°†ä¸Šè¿°è®¾ç½®ç²˜è´´åˆ°ä½ çš„ ~/.vimrcï¼Œé‡æ–°æ‰“å¼€ Vim å³å¯ç”Ÿæ•ˆã€‚\næŸ¥æ‰¾å½“å‰å•è¯ # åœ¨ normal æ¨¡å¼ä¸‹æŒ‰ä¸‹ * å³å¯æŸ¥æ‰¾å…‰æ ‡æ‰€åœ¨å•è¯ï¼ˆwordï¼‰ï¼Œ è¦æ±‚æ¯æ¬¡å‡ºç°çš„å‰åä¸ºç©ºç™½å­—ç¬¦æˆ–æ ‡ç‚¹ç¬¦å·ã€‚ä¾‹å¦‚å½“å‰ä¸º fooï¼Œ å¯ä»¥åŒ¹é… foo bar ä¸­çš„ fooï¼Œä½†ä¸å¯åŒ¹é… foobar ä¸­çš„ fooã€‚ è¿™åœ¨æŸ¥æ‰¾å‡½æ•°åã€å˜é‡åæ—¶éå¸¸æœ‰ç”¨ã€‚\næŒ‰ä¸‹ g* å³å¯æŸ¥æ‰¾å…‰æ ‡æ‰€åœ¨å•è¯çš„å­—ç¬¦åºåˆ—ï¼Œæ¯æ¬¡å‡ºç°å‰åå­—ç¬¦æ— è¦æ±‚ã€‚ å³ foo bar å’Œ foobar ä¸­çš„ foo å‡å¯è¢«åŒ¹é…åˆ°ã€‚\nå…¶ä»–è®¾ç½® # :set incsearch å¯ä»¥åœ¨æ•²é”®çš„åŒæ—¶æœç´¢ï¼ŒæŒ‰ä¸‹å›è½¦æŠŠç§»åŠ¨å…‰æ ‡ç§»åŠ¨åˆ°åŒ¹é…çš„è¯ï¼› æŒ‰ä¸‹ Esc å–æ¶ˆæœç´¢ã€‚\n:set wrapscan ç”¨æ¥è®¾ç½®åˆ°æ–‡ä»¶å°¾éƒ¨åæ˜¯å¦é‡æ–°ä»æ–‡ä»¶å¤´å¼€å§‹æœç´¢ã€‚\næŸ¥æ‰¾ä¸æ›¿æ¢ # :sï¼ˆsubstituteï¼‰å‘½ä»¤ç”¨æ¥æŸ¥æ‰¾å’Œæ›¿æ¢å­—ç¬¦ä¸²ã€‚è¯­æ³•å¦‚ä¸‹ï¼š\n:{ä½œç”¨èŒƒå›´}s/{ç›®æ ‡}/{æ›¿æ¢}/{æ›¿æ¢æ ‡å¿—} ä¾‹å¦‚ :%s/foo/bar/g ä¼šåœ¨å…¨å±€èŒƒå›´(%)æŸ¥æ‰¾ foo å¹¶æ›¿æ¢ä¸º barï¼Œæ‰€æœ‰å‡ºç°éƒ½ä¼šè¢«æ›¿æ¢ï¼ˆgï¼‰ã€‚\nä½œç”¨èŒƒå›´ # ä½œç”¨èŒƒå›´åˆ†ä¸ºå½“å‰è¡Œã€å…¨æ–‡ã€é€‰åŒºç­‰ç­‰ã€‚\nå½“å‰è¡Œï¼š\n:s/foo/bar/g å…¨æ–‡ï¼š\n:%s/foo/bar/g é€‰åŒºï¼Œåœ¨ Visual æ¨¡å¼ä¸‹é€‰æ‹©åŒºåŸŸåè¾“å…¥:ï¼ŒVim å³å¯è‡ªåŠ¨è¡¥å…¨ä¸º :'\u0026lt;,'\u0026gt;ã€‚\n:\u0026#39;\u0026lt;,\u0026#39;\u0026gt;s/foo/bar/g 2-11è¡Œï¼š\n:5,12s/foo/bar/g å½“å‰è¡Œ . ä¸æ¥ä¸‹æ¥ä¸¤è¡Œ +2ï¼š\n:.,+2s/foo/bar/g æ›¿æ¢æ ‡å¿— # ä¸Šæ–‡ä¸­å‘½ä»¤ç»“å°¾çš„ g å³æ˜¯æ›¿æ¢æ ‡å¿—ä¹‹ä¸€ï¼Œè¡¨ç¤ºå…¨å±€ global æ›¿æ¢ï¼ˆå³æ›¿æ¢ç›®æ ‡çš„æ‰€æœ‰å‡ºç°ï¼‰ã€‚ è¿˜æœ‰å¾ˆå¤šå…¶ä»–æœ‰ç”¨çš„æ›¿æ¢æ ‡å¿—ï¼š\nç©ºæ›¿æ¢æ ‡å¿—è¡¨ç¤ºåªæ›¿æ¢ä»å…‰æ ‡ä½ç½®å¼€å§‹ï¼Œç›®æ ‡çš„ç¬¬ä¸€æ¬¡å‡ºç°ï¼š\n:%s/foo/bar i è¡¨ç¤ºå¤§å°å†™ä¸æ•æ„ŸæŸ¥æ‰¾ï¼ŒI è¡¨ç¤ºå¤§å°å†™æ•æ„Ÿï¼š\n:%s/foo/bar/i # ç­‰æ•ˆäºæ¨¡å¼ä¸­çš„\\cï¼ˆä¸æ•æ„Ÿï¼‰æˆ–\\Cï¼ˆæ•æ„Ÿï¼‰ :%s/foo\\c/bar c è¡¨ç¤ºéœ€è¦ç¡®è®¤ï¼Œä¾‹å¦‚å…¨å±€æŸ¥æ‰¾ \u0026quot;foo\u0026quot; æ›¿æ¢ä¸º \u0026quot;bar\u0026quot; å¹¶ä¸”éœ€è¦ç¡®è®¤ï¼š\n:%s/foo/bar/gc å›è½¦åVimä¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°æ¯ä¸€æ¬¡ \u0026quot;foo\u0026quot; å‡ºç°çš„ä½ç½®ï¼Œå¹¶æç¤º\nreplace with bar (y/n/a/q/l/^E/^Y)? æŒ‰ä¸‹ y è¡¨ç¤ºæ›¿æ¢ï¼Œn è¡¨ç¤ºä¸æ›¿æ¢ï¼Œa è¡¨ç¤ºæ›¿æ¢æ‰€æœ‰ï¼Œq è¡¨ç¤ºé€€å‡ºæŸ¥æ‰¾æ¨¡å¼ï¼Œ l è¡¨ç¤ºæ›¿æ¢å½“å‰ä½ç½®å¹¶é€€å‡ºã€‚^E ä¸ ^Y æ˜¯å…‰æ ‡ç§»åŠ¨å¿«æ·é”®ï¼Œå‚è€ƒï¼š Vimä¸­å¦‚ä½•å¿«é€Ÿè¿›è¡Œå…‰æ ‡ç§»åŠ¨ã€‚\né«˜äº®è®¾ç½® # é«˜äº®é¢œè‰²è®¾ç½® # å¦‚æœä½ åƒæˆ‘ä¸€æ ·è§‰å¾—é«˜äº®çš„é¢œè‰²ä¸å¤ªèˆ’æœï¼Œå¯ä»¥åœ¨ ~/.vimrc ä¸­è¿›è¡Œè®¾ç½®ï¼š\nhighlight Search ctermbg=yellow ctermfg=black highlight IncSearch ctermbg=black ctermfg=yellow highlight MatchParen cterm=underline ctermbg=NONE ctermfg=NONE ä¸Šè¿°é…ç½®æŒ‡å®š Search ç»“æœçš„å‰æ™¯è‰²ï¼ˆforegroundï¼‰ä¸ºé»‘è‰²ï¼ŒèƒŒæ™¯è‰²ï¼ˆbackgroundï¼‰ä¸ºç°è‰²ï¼› æ¸è¿›æœç´¢çš„å‰æ™¯è‰²ä¸ºé»‘è‰²ï¼ŒèƒŒæ™¯è‰²ä¸ºé»„è‰²ï¼›å…‰æ ‡å¤„çš„å­—ç¬¦åŠ ä¸‹åˆ’çº¿ã€‚\næ›´å¤šçš„CTERMé¢œè‰²å¯ä»¥æŸ¥é˜…ï¼š http://vim.wikia.com/wiki/Xterm256_color_names_for_console_Vim\nç¦ç”¨/å¯ç”¨é«˜äº® # æœ‰æœ¨æœ‰è§‰å¾—æ¯æ¬¡æŸ¥æ‰¾æ›¿æ¢å Vim ä»ç„¶é«˜äº®ç€æœç´¢ç»“æœï¼Ÿ å¯ä»¥æ‰‹åŠ¨è®©å®ƒåœæ­¢é«˜äº®ï¼Œåœ¨ normal æ¨¡å¼ä¸‹è¾“å…¥ï¼š\n:nohighlight \u0026#34; ç­‰æ•ˆäº :nohl å…¶å®ä¸Šè¿°å‘½ä»¤ç¦ç”¨äº†æ‰€æœ‰é«˜äº®ï¼Œåªç¦ç”¨æœç´¢é«˜äº®çš„å‘½ä»¤æ˜¯ :set nohlsearchã€‚ ä¸‹æ¬¡æœç´¢æ—¶éœ€è¦ :set hlsearch å†æ¬¡å¯åŠ¨æœç´¢é«˜äº®ã€‚\nå»¶æ—¶ç¦ç”¨ # æ€ä¹ˆèƒ½å¤Ÿè®© Vim æŸ¥æ‰¾/æ›¿æ¢åä¸€æ®µæ—¶é—´è‡ªåŠ¨å–æ¶ˆé«˜äº®ï¼Œå‘ç”ŸæŸ¥æ‰¾æ—¶è‡ªåŠ¨å¼€å¯å‘¢ï¼Ÿ\n\u0026#34; å½“å…‰æ ‡ä¸€æ®µæ—¶é—´ä¿æŒä¸åŠ¨äº†ï¼Œå°±ç¦ç”¨é«˜äº® autocmd cursorhold * set nohlsearch \u0026#34; å½“è¾“å…¥æŸ¥æ‰¾å‘½ä»¤æ—¶ï¼Œå†å¯ç”¨é«˜äº® noremap n :set hlsearch\u0026lt;cr\u0026gt;n noremap N :set hlsearch\u0026lt;cr\u0026gt;N noremap / :set hlsearch\u0026lt;cr\u0026gt;/ noremap ? :set hlsearch\u0026lt;cr\u0026gt;? noremap * *:set hlsearch\u0026lt;cr\u0026gt; å°†ä¸Šè¿°é…ç½®ç²˜è´´åˆ° ~/.vimrcï¼Œé‡æ–°æ‰“å¼€ vim å³å¯ç”Ÿæ•ˆã€‚\nä¸€é”®ç¦ç”¨ # å¦‚æœå»¶æ—¶ç¦ç”¨æœç´¢é«˜äº®ä»ç„¶ä¸å¤Ÿèˆ’æœï¼Œå¯ä»¥è®¾ç½®å¿«æ·é”®æ¥ä¸€é”®ç¦ç”¨/å¼€å¯æœç´¢é«˜äº®ï¼š\nnoremap n :set hlsearch\u0026lt;cr\u0026gt;n noremap N :set hlsearch\u0026lt;cr\u0026gt;N noremap / :set hlsearch\u0026lt;cr\u0026gt;/ noremap ? :set hlsearch\u0026lt;cr\u0026gt;? noremap * *:set hlsearch\u0026lt;cr\u0026gt; nnoremap \u0026lt;c-h\u0026gt; :call DisableHighlight()\u0026lt;cr\u0026gt; function! DisableHighlight() set nohlsearch endfunc å¸Œæœ›å…³é—­é«˜äº®æ—¶åªéœ€è¦æŒ‰ä¸‹ Ctrl+Hï¼Œå½“å‘ç”Ÿä¸‹æ¬¡æœç´¢æ—¶åˆä¼šè‡ªåŠ¨å¯ç”¨ã€‚\nå‚è€ƒé˜…è¯» # XTERM 256è‰²ï¼š http://vim.wikia.com/wiki/Xterm256_color_names_for_console_Vim Vim Wikia - æŸ¥æ‰¾ä¸æ›¿æ¢ï¼š http://vim.wikia.com/wiki/Search_and_replace ç”¨ Vim æ‰“é€  IDE ç¯å¢ƒï¼š https://harttle.land/2015/11/04/vim-ide.html æœ¬æ–‡é‡‡ç”¨ çŸ¥è¯†å…±äº«ç½²å 4.0 å›½é™…è®¸å¯åè®®ï¼ˆCC-BY 4.0ï¼‰è¿›è¡Œè®¸å¯ï¼Œè½¬è½½æ³¨æ˜æ¥æºå³å¯ï¼š https://harttle.land/2016/08/08/vim-search-in-file.htmlã€‚å­¦è¯†ç²—æµ…å†™ä½œä»“ä¿ƒï¼Œå¦‚æœ‰é”™è¯¯è¾›è‹¦è¯„è®ºæˆ– é‚®ä»¶ æŒ‡å‡ºã€‚\nå†™å…¥ã€ä¿å­˜ã€é€€å‡º # :q[uit] \u0026#34; é€€å‡º :q! \u0026#34; å¼ºåˆ¶é€€å‡º :w[rite] \u0026#34; ä¿å­˜ :w! \u0026#34; å¼ºåˆ¶ä¿å­˜ï¼Œèƒ½ä¸èƒ½ä¿å­˜æˆåŠŸå–å†³äºç”¨æˆ·å¯¹æ–‡ä»¶çš„æƒé™ :w ! sudo tee % \u0026#34; å¦‚æœæ²¡æœ‰æƒé™ä¿å­˜ï¼Œè¯•è¯•è¿™ä¸ªå‘½ä»¤ ZZ \u0026#34; ä¸¤ä¸ªå¤§å†™çš„ Zï¼Œæ²¡æœ‰ä¿®æ”¹ç›´æ¥é€€å‡ºï¼Œæœ‰ä¿®æ”¹ä¿å­˜åé€€å‡º :w newfilename \u0026#34; å¦å­˜ä¸ºæ–°æ–‡ä»¶ :1, 10 w newfilename \u0026#34; å°† 1 åˆ° 10 è¡Œçš„å†…å®¹å¦å­˜ä¸ºæ–°æ–‡ä»¶ :1, 10 w \u0026gt;\u0026gt; filename \u0026#34; å°† 1 åˆ° 10 è¡Œçš„å†…å®¹å¦å­˜ä¸ºæ–°æ–‡ä»¶ :r filename \u0026#34; å°†ç›®æ ‡æ–‡ä»¶çš„å†…å®¹è¿½åŠ åˆ°å½“å‰å…‰æ ‡ä¸‹ä¸€è¡Œ :3 r filename \u0026#34; å°†ç›®æ ‡æ–‡ä»¶çš„å†…å®¹è¿½åŠ åˆ°ç¬¬ 3 è¡Œä¸€ä¸‹ :! ls \u0026#34; æš‚æ—¶ç¦»å¼€ Vim æŸ¥çœ‹å½“å‰ç›®å½•çš„æ–‡ä»¶ï¼Œå›è½¦åè¿”å› Vim å…‰æ ‡ç§»åŠ¨ # h \u0026#34; æ–¹å‘é”® â† j \u0026#34; æ–¹å‘é”® â†“ k \u0026#34; æ–¹å‘é”® â†‘ l \u0026#34; æ–¹å‘é”® â†’ 0 \u0026#34; ç§»åŠ¨åˆ°è¡Œé¦– $ \u0026#34; ç§»åŠ¨åˆ°è¡Œå°¾çš„å›è½¦ç¬¦ g_ \u0026#34; ç§»åŠ¨åˆ°è¡Œå°¾æœ€åä¸€ä¸ªéç©ºå­—ç¬¦ gg \u0026#34; ç§»åŠ¨åˆ°ç¬¬ä¸€è¡Œ G \u0026#34; ç§»åŠ¨åˆ°æœ€åä¸€è¡Œ\u0026#34; w \u0026#34; ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´ e \u0026#34; ç§»åŠ¨åˆ°å•è¯çš„ç»“å°¾ b \u0026#34; ç§»åŠ¨åˆ°å•è¯çš„å¼€å¤´ \u0026#34; ä¸å¸¸ç”¨ nh \u0026#34; å‘å·¦ç§»åŠ¨ n æ ¼ï¼Œn ä¸ºæ•°å­— nl \u0026#34; å‘å³ç§»åŠ¨ n æ ¼ nj \u0026#34; å‘ä¸‹ç§»åŠ¨ n è¡Œ nk \u0026#34; å‘ä¸Šç§»åŠ¨ n è¡Œ n\u0026lt;space\u0026gt; \u0026#34; å‘å³ç§»åŠ¨ n æ ¼ï¼ŒåŒ nl H \u0026#34; ç§»åŠ¨åˆ°å½“å‰å±å¹•ç¬¬ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ M \u0026#34; ç§»åŠ¨åˆ°å½“å‰å±å¹•ä¸­é—´è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ L \u0026#34; ç§»åŠ¨åˆ°å½“å‰å±å¹•æœ€åä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ + \u0026#34; ç§»åŠ¨åˆ°éç©ºç™½å­—ç¬¦çš„ä¸‹ä¸€è¡Œ - \u0026#34; ç§»åŠ¨åˆ°éç©ºç™½å­—ç¬¦çš„ä¸Šä¸€è¡Œ :n\u0026lt;cr\u0026gt; \u0026#34; è·³è½¬åˆ°ç¬¬ n è¡Œh \u0026#34; æ–¹å‘é”® â† j \u0026#34; æ–¹å‘é”® â†“ k \u0026#34; æ–¹å‘é”® â†‘ l \u0026#34; æ–¹å‘é”® â†’ 0 \u0026#34; ç§»åŠ¨åˆ°è¡Œé¦– $ \u0026#34; ç§»åŠ¨åˆ°è¡Œå°¾çš„å›è½¦ç¬¦ g_ \u0026#34; ç§»åŠ¨åˆ°è¡Œå°¾æœ€åä¸€ä¸ªéç©ºå­—ç¬¦ gg \u0026#34; ç§»åŠ¨åˆ°ç¬¬ä¸€è¡Œ G \u0026#34; ç§»åŠ¨åˆ°æœ€åä¸€è¡Œ\u0026#34; w \u0026#34; ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´ e \u0026#34; ç§»åŠ¨åˆ°å•è¯çš„ç»“å°¾ b \u0026#34; ç§»åŠ¨åˆ°å•è¯çš„å¼€å¤´ \u0026#34; ä¸å¸¸ç”¨ nh \u0026#34; å‘å·¦ç§»åŠ¨ n æ ¼ï¼Œn ä¸ºæ•°å­— nl \u0026#34; å‘å³ç§»åŠ¨ n æ ¼ nj \u0026#34; å‘ä¸‹ç§»åŠ¨ n è¡Œ nk \u0026#34; å‘ä¸Šç§»åŠ¨ n è¡Œ n\u0026lt;space\u0026gt; \u0026#34; å‘å³ç§»åŠ¨ n æ ¼ï¼ŒåŒ nl H \u0026#34; ç§»åŠ¨åˆ°å½“å‰å±å¹•ç¬¬ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ M \u0026#34; ç§»åŠ¨åˆ°å½“å‰å±å¹•ä¸­é—´è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ L \u0026#34; ç§»åŠ¨åˆ°å½“å‰å±å¹•æœ€åä¸€è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ + \u0026#34; ç§»åŠ¨åˆ°éç©ºç™½å­—ç¬¦çš„ä¸‹ä¸€è¡Œ - \u0026#34; ç§»åŠ¨åˆ°éç©ºç™½å­—ç¬¦çš„ä¸Šä¸€è¡Œ :n\u0026lt;cr\u0026gt; \u0026#34; è·³è½¬åˆ°ç¬¬ n è¡Œ ç¿»é¡µ # \u0026lt;c-f\u0026gt; \u0026#34; å‘ä¸‹ç§»åŠ¨ä¸€é¡µ \u0026lt;c-d\u0026gt; \u0026#34; å‘ä¸‹ç§»åŠ¨åŠé¡µ \u0026lt;c-b\u0026gt; \u0026#34; å‘ä¸Šç§»åŠ¨ä¸€é¡µ \u0026lt;c-u\u0026gt; \u0026#34; å‘ä¸Šç§»åŠ¨åŠé¡µ æŸ¥æ‰¾ä¸æ›¿æ¢ # /word \u0026#34; ä»å…‰æ ‡ä½ç½®å‘ä¸‹æœç´¢ word å•è¯ ?word \u0026#34; ä»å…‰æ ‡ä½ç½®å‘ä¸Šæœç´¢ word å•è¯ n \u0026#34; è‹±æ–‡å­—æ¯ nï¼Œæ ¹æ® / æˆ– ? æœç´¢çš„æ–¹å‘å®šä½åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…ç›®æ ‡ N \u0026#34; ä¸ n ç›¸åï¼Œå®šä½åŒ¹é…ç›®æ ‡ :n1,n2s/word1/word2/g \u0026#34; n1, n2 è¡¨ç¤ºæ•°å­—ï¼Œæ›¿æ¢ n1 è¡Œåˆ° n2 è¡Œçš„å•è¯ :1,$s/word1/word2/g \u0026#34; å…¨æ–‡æ›¿æ¢ï¼Œä¹Ÿå¯ä»¥å†™æˆ :%s/word1/word2/g :1,$s/word1/word2/gc \u0026#34; å…¨æ–‡æ›¿æ¢ï¼Œå¹¶å‡ºç°ç¡®è®¤æç¤º å¤åˆ¶ã€ç²˜è´´ã€åˆ é™¤ # x \u0026#34; å‘ååˆ é™¤ä¸€ä¸ªå­—ç¬¦ nx \u0026#34; å‘ååˆ é™¤ n ä¸ªå­—ç¬¦ X \u0026#34; å‘å‰åˆ é™¤ä¸€ä¸ªå­—ç¬¦ nX \u0026#34; å‘å‰åˆ é™¤ n ä¸ªå­—ç¬¦ dd \u0026#34; åˆ é™¤å½“å‰è¡Œ ndd \u0026#34; å‘ä¸‹åˆ é™¤ n è¡Œ d1G / dgg \u0026#34; åˆ é™¤ç¬¬ä¸€è¡Œåˆ°å½“å‰è¡Œçš„æ•°æ® dG \u0026#34; åˆ é™¤å½“å‰è¡Œåˆ°æœ€åä¸€è¡Œçš„æ•°æ® d$ \u0026#34; åˆ é™¤å½“å‰å­—ç¬¦åˆ°è¡Œå°¾ D \u0026#34; åˆ é™¤å½“å‰å­—ç¬¦åˆ°è¡Œå°¾ d0 \u0026#34; ä»è¡Œé¦–åˆ é™¤åˆ°å½“å‰å­—ç¬¦ yy \u0026#34; å¤åˆ¶å½“å‰è¡Œ Y \u0026#34; å¤åˆ¶å½“å‰è¡Œ nyy \u0026#34; ä»å½“å‰è¡Œå¼€å§‹å¤åˆ¶ n è¡Œ y1G / ygg \u0026#34; ä»ç¬¬ä¸€è¡Œå¤åˆ¶åˆ°å½“å‰è¡Œ yG \u0026#34; ä»å½“å‰è¡Œå¤åˆ¶åˆ°æœ€åä¸€è¡Œ y0 \u0026#34; ä»è¡Œé¦–å¤åˆ¶åˆ°å½“å‰å­—ç¬¦ y$ \u0026#34; ä»å½“å‰å­—ç¬¦å¤åˆ¶åˆ°è¡Œå°¾ p, P \u0026#34; é»è´´ï¼Œp é»è´´åˆ°å…‰æ ‡ä¸‹ä¸€è¡Œï¼ŒP é»è´´åˆ°å…‰æ ‡ä¸Šä¸€è¡Œ yyp \u0026#34; å¤åˆ¶å¹¶ç²˜è´´ ddp \u0026#34; åˆ é™¤å¹¶ç²˜è´´ï¼Œç›¸å½“äºä¸‹ç§»å½“å‰è¡Œ \u0026#34;+y \u0026#34; å¤åˆ¶æœ¬æ–‡åˆ°ç³»ç»Ÿå‰ªåˆ‡æ¿ \u0026#34;+p \u0026#34; ç²˜è´´ç³»ç»Ÿå‰ªåˆ‡æ¿åˆ° Vimï¼ˆä¸ä¼šå½±å“æ–‡æœ¬æ ¼å¼ï¼‰ æ’å…¥ # i \u0026#34; åœ¨å…‰æ ‡å‰è¿›å…¥ insert æ¨¡å¼ I \u0026#34; åœ¨å½“å‰è¡Œå·¦è¾¹ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦å‰è¿›å…¥ insert æ¨¡å¼ï¼Œç±»ä¼¼å…¶ä»–ç¼–è¾‘å™¨çš„ \u0026lt;c-a\u0026gt; å¿«æ·é”® a \u0026#34; åœ¨å…‰æ ‡åè¿›å…¥ insert æ¨¡å¼ A \u0026#34; åœ¨å½“å‰è¡Œå³è¾¹ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦å‰è¿›å…¥ insert æ¨¡å¼ï¼Œç±»ä¼¼å…¶ä»–ç¼–è¾‘å™¨çš„ \u0026lt;c-e\u0026gt; å¿«æ·é”® o \u0026#34; åœ¨å…‰æ ‡çš„ä¸‹ä¸€è¡Œæ’å…¥ O \u0026#34; åœ¨å…‰æ ‡çš„ä¸Šä¸€è¡Œæ’å…¥ s \u0026#34; åˆ é™¤å½“å‰å­—ç¬¦ï¼Œå¹¶è¿›å…¥ insert æ¨¡å¼ S \u0026#34; åˆ é™¤å½“å‰è¡Œï¼Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼ vc \u0026#34; åˆ é™¤å½“å‰å­—ç¬¦ï¼Œå¹¶è¿›å…¥ insert æ¨¡å¼ cc \u0026#34; åˆ é™¤å½“å‰è¡Œï¼Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼ c0 \u0026#34; åˆ é™¤å…‰æ ‡ä½ç½®åˆ°è¡Œé¦–ï¼Œå¹¶è¿›å…¥ insert æ¨¡å¼ cg_ \u0026#34; åˆ é™¤å…‰æ ‡ä½ç½®åˆ°è¡Œå°¾æœ€åä¸€ä¸ªéç©ºå­—ç¬¦ï¼Œå¹¶è¿›å…¥ insert æ¨¡å¼ ce \u0026#34; åˆ é™¤å…‰æ ‡ä½ç½®åˆ°å•è¯æœ«å°¾ï¼Œå¹¶è¿›å…¥ insert æ¨¡å¼ cw \u0026#34; åˆ é™¤å…‰æ ‡ä½ç½®åˆ°å•è¯æœ«å°¾ï¼Œå¹¶è¿›å…¥ insert æ¨¡å¼ ciw \u0026#34; åˆ é™¤å½“å‰å•è¯ï¼Œå¹¶è¿›å…¥ insert æ¨¡å¼ cip \u0026#34; åˆ é™¤æ•´ä¸ªæ®µè½ï¼Œå¹¶è¿›å…¥ insert æ¨¡å¼ ci( \u0026#34; åˆ é™¤å½“å‰æ‹¬å·å†…çš„å†…å®¹ï¼Œå¹¶è¿›å…¥ insert æ¨¡å¼ é€‚ç”¨äº ([{\u0026lt;\u0026#39;` ç­‰æ‰€æœ‰æˆå¯¹çš„æ ‡ç­¾ æ’¤é”€é‡åš # u \u0026#34; æ’¤é”€ \u0026lt;c-r\u0026gt; \u0026#34; é‡åš . \u0026#34; é‡å¤å®Œæˆæ“ä½œ æ›¿æ¢ # r \u0026#34; æ›¿æ¢å•ä¸ªå­—ç¬¦ï¼Œè‡ªåŠ¨è¿”å› normal æ¨¡å¼ R \u0026#34; è¿ç»­æ›¿æ¢å¤šä¸ªå­—ç¬¦ï¼Œæ‰‹åŠ¨ \u0026lt;esc\u0026gt; è¿”å› normal æ¨¡å¼ å¤§å°å†™ # ~ \u0026#34; å½“å‰å­—ç¬¦å¤§å°å†™åè½¬ g~~ \u0026#34; æ­£è¡Œå­—ç¬¦å¤§å°å†™åè½¬ vu \u0026#34; å½“å‰å­—ç¬¦å°å†™ vU \u0026#34; å½“å‰å­—ç¬¦å¤§å†™ vU \u0026#34; å½“å‰å­—ç¬¦å¤§å†™ viwu \u0026#34; å½“å‰å­—ç¬¦å°å†™ viwU \u0026#34; å½“å‰å­—ç¬¦å¤§å†™ ggguG \u0026#34; æ–‡æœ¬æ‰€æœ‰å­—ç¬¦å°å†™ gggUG \u0026#34; æ–‡æœ¬æ‰€æœ‰å­—ç¬¦å¤§å†™ :%s/\\\u0026lt;./\\u\u0026amp;/g \u0026#34; å°†æ‰€æœ‰å•è¯é¦–å­—æ¯å¤§å†™ï¼ˆéœ€è¦ä½¿ç”¨ :nohls å»æ‰é«˜äº®ï¼‰ :%s/\\\u0026lt;./\\l\u0026amp;/g \u0026#34; å°†æ‰€æœ‰å•è¯é¦–å­—æ¯å°å†™ :%s/.*/\\u\u0026amp; \u0026#34; å°†æ¯è¡Œç¬¬ä¸€ä¸ªå­—æ¯å¤§å†™ :%s/.*/\\l\u0026amp; \u0026#34; å°†æ¯è¡Œç¬¬ä¸€ä¸ªå­—æ¯å°å†™ å¤šçª—å£æ“ä½œ # :sp filename \u0026#34; ä¸Šä¸‹åˆ†å‰²çª—å£ :vs[p] filename \u0026#34; å·¦å³åˆ†å‰²çª—å£ \u0026lt;c-w\u0026gt;h[j[k[l]]] \u0026#34; æ ¹æ®æ–¹å‘é”®ç§»åŠ¨å…‰æ ‡åˆ°è¯¥æ–¹å‘çš„çª—å£ä¸Š \u0026lt;c-w\u0026gt;[N]\u0026gt; \u0026#34; N ä½æ•°å­—ï¼Œå¯é€‰ï¼Œå¢åŠ å½“å‰çª—å£ N åˆ—å®½\u0026#34; \u0026lt;c-w\u0026gt;[N]\u0026lt; \u0026#34; N ä½æ•°å­—ï¼Œå¯é€‰ï¼Œå‡å°‘å½“å‰çª—å£ N åˆ—å®½\u0026#34; \u0026lt;c-w\u0026gt;[N]+ \u0026#34; N ä½æ•°å­—ï¼Œå¯é€‰ï¼Œå¢åŠ å½“å‰çª—å£ N è¡Œé«˜\u0026#34; \u0026lt;c-w\u0026gt;[N]- \u0026#34; N ä½æ•°å­—ï¼Œå¯é€‰ï¼Œå‡å°‘å½“å‰çª—å£ N è¡Œé«˜\u0026#34; \u0026lt;c-w\u0026gt;= \u0026#34; å°†æ‰€æœ‰çª—å£è®¾ç½®ç­‰å®½é«˜ \u0026lt;c-w\u0026gt;[N]n \u0026#34; N ä½æ•°å­—ï¼Œå¯é€‰ï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çª—å£ N è¡Œé«˜ï¼Œé»˜è®¤ä¸ºæ•´ä¸ªçª—å£çš„ä¸€åŠ\u0026#34; \u0026lt;c-w\u0026gt;[N]s \u0026#34; N ä½æ•°å­—ï¼Œå¯é€‰ï¼Œå°†å½“å‰çª—å£å‚ç›´åˆ†å‰²ä¸ºä¸Šä¸‹ä¸¤ä¸ªçª—å£å±•ç¤º\u0026#34; \u0026#34; æ–°çª—å£å¯ä»¥ä¸º N è¡Œé«˜ï¼Œé»˜è®¤ä¸ºæ•´ä¸ªçª—å£çš„ä¸€åŠ\u0026#34; \u0026#34; ç±»ä¼¼äº :sp current_file\u0026#34; \u0026lt;c-w\u0026gt;[N]v \u0026#34; N ä½æ•°å­—ï¼Œå¯é€‰ï¼Œå°†å½“å‰çª—å£æ°´å¹³åˆ†å‰²ä¸ºå·¦å³ä¸¤ä¸ªçª—å£å±•ç¤º\u0026#34; \u0026#34; æ–°çª—å£å¯ä»¥ä¸º N åˆ—å®½ï¼Œé»˜è®¤ä¸ºæ•´ä¸ªçª—å£çš„ä¸€åŠ\u0026#34; \u0026#34; ç±»ä¼¼äº :vs current_file\u0026#34; \u0026lt;c-w\u0026gt;o \u0026#34; å…³é—­é™¤å½“å‰çª—å£å¤–çš„æ‰€æœ‰çª—å£ \u0026lt;c-w\u0026gt;r \u0026#34; é¡ºæ—¶é’ˆè½¬åŠ¨çª—å£ \u0026lt;c-w\u0026gt;R \u0026#34; é€†æ—¶é’ˆè½¬åŠ¨çª—å£ \u0026lt;c-w\u0026gt;x \u0026#34; å¯¹è°ƒå·¦å³æˆ–ä¸Šä¸‹ä¸¤ä¸ªå¯¹åº”çš„çª—å£ \u0026lt;c-w\u0026gt;q \u0026#34; é€€å‡ºçª—å£ :q \u0026#34; é€€å‡ºçª—å£ å¤šæ–‡ä»¶ç¼–è¾‘ # vim file1 file2 \u0026#34; åŒæ—¶æ‰“å¼€ä¸¤ä¸ªæ–‡ä»¶ :files \u0026#34; æŸ¥çœ‹ç°åœ¨ç¼–è¾‘çš„æ–‡ä»¶åˆ—è¡¨ï¼Œ%a ä»£è¡¨æ­£åœ¨æ“ä½œå“ªä¸ªæ–‡ä»¶ 1 %a \u0026#34;file1\u0026#34; line 1 2 \u0026#34;file2\u0026#34; line 0 :n \u0026#34; è·³åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œçš„ n å°±æ˜¯å­—æ¯ :N \u0026#34; è·³åˆ°ä¸Šä¸€ä¸ªæ–‡ä»¶ Â« æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¼ è¾“æ–‡ä»¶\n"},{"id":191,"href":"/middleware/","title":"Middleware","section":"","content":" ğŸ  é¦–é¡µ / æ•°æ®ä¸­é—´ä»¶\næ•°æ®ä¸­é—´ä»¶ # Elasticsearch\nMongoDB\nMySQL\nPostgres\nRedis\n"},{"id":192,"href":"/middleware/elasticsearch/","title":"Elasticsearch","section":"Middleware","content":" ğŸ  é¦–é¡µ / æ•°æ®ä¸­é—´ä»¶ / Elasticsearch\nElasticsearch # å…¨æ–‡æœç´¢\nAPI # é¢˜å¤–è¯ï¼š\nå¹‚ç­‰æ€§ï¼šå¤šæ¬¡æ‰§è¡ŒåŒæ ·çš„è¯·æ±‚ï¼Œèµ„æºåªèƒ½åˆ›å»ºæˆ–ä¿®æ”¹ä¸€æ¬¡\nPOST è¯·æ±‚ä¸æ˜¯å¹‚ç­‰æ€§çš„ï¼ŒåŒæ ·çš„æ•°æ®è¯·æ±‚ï¼Œä¼šé€ æˆä¸åŒçš„å½±å“\nPUT æ˜¯å¹‚ç­‰æ€§çš„ï¼ŒåŒæ ·çš„è¯·æ±‚é€ æˆçš„å½±å“æ˜¯ä¸€æ ·çš„\nåˆ›å»ºç´¢å¼• # PUT /users æŸ¥è¯¢ç´¢å¼• # è·å–å•ä¸ªç´¢å¼•\nGET /users è·å–æ‰€æœ‰ç´¢å¼•\nGET /_cat/indices?v åˆ é™¤ç´¢å¼• # DELETE /users åˆ›å»ºæ–‡æ¡£ # è¿™ä¸ªæ“ä½œæ˜¯åœ¨å•ä¸ªç´¢å¼•ä¸‹çš„\nPOST /users/_doc # ä¸€å®šéœ€è¦bodyï¼Œå¦åˆ™æŠ¥é”™ body: { \u0026#34;name\u0026#34;: \u0026#34;dp\u0026#34;, \u0026#34;age\u0026#34;: 18 } ä¸Šé¢è¿™ä¸ªæ–‡æ¡£åˆ›å»ºæ—¶ä¼šç”Ÿæˆéšæœº IDï¼ˆè¿”å›ç»“æœä¸­çš„ _idï¼‰ï¼Œä¸ä¾¿ç»´æŠ¤ï¼Œä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•è‡ªå®šä¹‰æ–‡æ¡£ IDï¼Œæ­¤æ—¶ç”±äº ID è‡ªå®šä¹‰äº†ï¼Œå°±è¦æ±‚å¹‚ç­‰ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ PUT æ–¹æ³•\nPOST | PUT /users/_doc/1002 PUT /users/_create/1003 # ä¸€å®šéœ€è¦bodyï¼Œå¦åˆ™æŠ¥é”™ body: { \u0026#34;name\u0026#34;: \u0026#34;dp\u0026#34;, \u0026#34;age\u0026#34;: 18 } æŸ¥è¯¢æ–‡æ¡£ # è·å–å•ä¸ªæ–‡æ¡£\nGET /users/_doc/1001 è·å–æ‰€æœ‰æ–‡æ¡£\nGET /users/_search ä¿®æ”¹æ–‡æ¡£ # PUT /users/_doc/1001 body: { \u0026#34;name\u0026#34;: \u0026#34;dp\u0026#34;, \u0026#34;age\u0026#34;: 28 } ä½ å¯èƒ½å‘ç°äº†ï¼ŒPUT æ—¢å¯ä»¥åˆ›å»ºä¹Ÿå¯ä»¥ä¿®æ”¹ã€‚\nä¿®æ”¹ç‰¹å®šå­—æ®µï¼ˆéå¹‚ç­‰ï¼‰\nPOST /users/_update/1001 body: { \u0026#34;doc\u0026#34;: { \u0026#34;age\u0026#34;: 29 } } åˆ é™¤æ–‡æ¡£ # DELETE /users/_doc/1001 å¤æ‚æŸ¥è¯¢ # æ¡ä»¶æŸ¥è¯¢ # GET /users/_search?q=name:dp æˆ–è€…é€šè¿‡è¯·æ±‚ä½“æŸ¥è¯¢\nGET /users/_search { \u0026#34;query\u0026#34;: { // \u0026#34;match\u0026#34;: { // \u0026#34;name\u0026#34;: \u0026#34;dp\u0026#34; // } // æŸ¥è¯¢æ‰€æœ‰ \u0026#34;match_all\u0026#34;: { } } // åˆ†é¡µ \u0026#34;from\u0026#34;: 0, \u0026#34;size\u0026#34;: 10, // è¿‡æ»¤å­—æ®µ \u0026#34;_source\u0026#34;: [\u0026#34;name\u0026#34;, \u0026#34;age\u0026#34;] // æ’åº \u0026#34;sort\u0026#34;: { \u0026#34;age\u0026#34;: { \u0026#34;order\u0026#34;: \u0026#34;asc|desc\u0026#34; } }, \u0026#34;highlight\u0026#34;: { \u0026#34;fields\u0026#34;: { \u0026#34;name\u0026#34;: {} } } } ä½¿ç”¨ matchï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶æ˜¯ \u0026ldquo;name\u0026rdquo;: \u0026ldquo;Hello World\u0026rdquo;ï¼ŒæŸ¥è¯¢ç»“æœä¼šæ˜¯ Helloï¼ŒWorld åˆ†åˆ«æŸ¥è¯¢çš„ç»“æœé›†åˆï¼Œå› ä¸º ES ä¼šå°†æŸ¥è¯¢å…³é”®è¯æ‹†è§£ï¼Œæ¯ä¸ªå•è¯éƒ½å•ç‹¬åŒ¹é…ç´¢å¼•ã€‚\nå¦‚æœé¦™è¦å®Œå…¨åŒ¹é…ï¼Œä½¿ç”¨ match_phraseã€‚\nå¤šæ¡ä»¶æŸ¥è¯¢ # GET /users/_search { \u0026#34;query\u0026#34;: { \u0026#34;bool\u0026#34;: { // must =\u0026gt; and; should =\u0026gt; or \u0026#34;must\u0026#34;: [ { \u0026#34;match\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;dp\u0026#34; } }, { \u0026#34;match\u0026#34;: { \u0026#34;age\u0026#34;: 28 } } ], \u0026#34;filter\u0026#34;: { \u0026#34;range\u0026#34;: { \u0026#34;age\u0026#34;: { \u0026#34;gt\u0026#34;: 18 } } } } } } èšåˆæŸ¥è¯¢ # { \u0026#34;aggs\u0026#34;: { // èšåˆæ“ä½œ \u0026#34;age_group\u0026#34;: { // åç§°ï¼Œéšæ„å‘½å \u0026#34;terms\u0026#34;: { // åˆ†ç»„ \u0026#34;field\u0026#34;: \u0026#34;age\u0026#34; // åˆ†ç»„å­—æ®µ }, \u0026#34;avg\u0026#34;: { // å¹³å‡å€¼ \u0026#34;field\u0026#34;: \u0026#34;age\u0026#34; // åˆ†ç»„å­—æ®µ } // æ­¤å¤–è¿˜æœ‰ max, min } }, \u0026#34;size\u0026#34;: 0 //ä¸æ˜¾ç¤ºåŸå§‹æ•°æ® } è®¾ç½® # è®¾ç½®é›†ç¾¤æœ€å¤§ç´¢å¼•æ•° # å¦‚æœé‡åˆ°é”™è¯¯ï¼š\nValidation Failed: 1: this action would add [2] total shards, but this cluster currently has [3000]/[3000] maximum shards open; é‚£ä¹ˆå¯¼è‡´è¯¥é—®é¢˜çš„åŸå› å¯èƒ½æ˜¯ç”±äºç°åˆ›å»ºçš„ index å¤ªå¤šï¼Œå·²ç»è¾¾åˆ°äº† cluster.max_shards_per_node çš„é™åˆ¶ï¼Œéœ€è¦è®¡åˆ’æ¸…é™¤ä¸€äº›æ— ç”¨çš„ index æˆ–è€…å¢åŠ esé›†ç¾¤èŠ‚ç‚¹ index é™åˆ¶ï¼š\nPUT /_cluster/settings { \u0026#34;transient\u0026#34;: { \u0026#34;cluster.max_shards_per_node\u0026#34;:5000 } } æˆ–è€…ä½¿ç”¨ curl è°ƒç”¨é›†ç¾¤è®¾ç½®çš„ api\ncurl -XPUT $CLUSTER_URL/_cluster/settings -H \u0026#39;Content-type: application/json\u0026#39; --data-binary $\u0026#39;{\u0026#34;transient\u0026#34;:{\u0026#34;cluster.max_shards_per_node\u0026#34;:5000}}\u0026#39; è®¾ç½®åˆ é™¤æƒé™ # åˆ é™¤æƒé™éœ€è¦\nPUT /_cluster/settings { \u0026#34;persistent\u0026#34; : { \u0026#34;action.destructive_requires_name\u0026#34; : \u0026#34;false\u0026#34; } } æˆ–è€…ä½¿ç”¨ curl è°ƒç”¨é›†ç¾¤è®¾ç½®çš„ api\ncurl -XPUT $CLUSTER_URL/_cluster/settings -H \u0026#39;Content-type: application/json\u0026#39; --data-binary $\u0026#39;{\u0026#34;persistent\u0026#34;:{\u0026#34;action.destructive_requires_name\u0026#34;:\u0026#34;false\u0026#34;}}\u0026#39; Â» MongoDB\n"},{"id":193,"href":"/middleware/mongodb/","title":"Mongodb","section":"Middleware","content":" ğŸ  é¦–é¡µ / æ•°æ®ä¸­é—´ä»¶ / MongoDB\nMongoDB # èµ„æ–™ # http://cw.hubwiz.com/card/c/543b2f3cf86387171814c026/1/1/1/ http://cw.hubwiz.com/card/c/5438c259032c7817c40298b5/1/1/1/ å®‰è£… # æŒ‰ç…§å®˜ç½‘ç»™å‡ºçš„æŒ‡å—åœ¨ ubuntu ç³»ç»Ÿå®‰è£… mongodï¼Œå‚è€ƒ https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/\néªŒè¯ mongo æ˜¯å¦å®‰è£…æˆåŠŸï¼šè¿›å…¥ ubuntu shell çª—å£ï¼Œç›´æ¥è¾“å…¥\nmongo --version çª—å£æ­£å¸¸è¾“å‡º mongo ç‰ˆæœ¬å°±è¯´æ˜ mongo å®‰è£…æˆåŠŸ\nå¯åŠ¨ mongo æœåŠ¡\nsudo systemctl statt mongod #/stop/restart åˆ›å»º dba ç”¨æˆ·å¹¶æ·»åŠ æƒé™éªŒè¯\nmongodb æ²¡æœ‰å¼€å¯æƒé™éªŒè¯ä¹‹å‰ï¼Œä½¿ç”¨ mongo å‘½ä»¤å¯ä»¥ç›´æ¥è¿æ¥æœ¬åœ° mongodbï¼›\nsudo mongo ä½¿ç”¨ db.createUser å‘½ä»¤åˆ›å»º dba ç”¨æˆ·,ä¸º dba ç”¨æˆ·æ·»åŠ æ‰€æœ‰ database çš„ç®¡ç†å‘˜æƒé™ï¼›\n\u0026gt; db.createUser({user:\u0026#34;dba\u0026#34;,pwd:\u0026#34;[your pass]\u0026#34;,roles:[ {role:\u0026#34;readWriteAnyDatabase\u0026#34;,db:\u0026#34;admin\u0026#34;},{role:\u0026#34;dbAdminAnyDatabase\u0026#34;,db:\u0026#34;admin\u0026#34;},{role:\u0026#34;userAdminAnyDatabase\u0026#34;,db:\u0026#34;admin\u0026#34;},{role:\u0026#34;clusterAdmin\u0026#34;,db:\u0026#34;admin\u0026#34;},{role:\u0026#34;restore\u0026#34;,db:\u0026#34;admin\u0026#34;},{role:\u0026#34;backup\u0026#34;,db:\u0026#34;admin\u0026#34;} ]}) Successfully added user: { \u0026#34;user\u0026#34; : \u0026#34;dba\u0026#34;, \u0026#34;roles\u0026#34; : [ // ... ] } dba åŒ…å«çš„ role:\nreadWriteAnyDatabase dbAdminAnyDatabase userAdminAnyDatabase clusterAdmin restore backup ä¿®æ”¹ mongod.conf æ–‡ä»¶ï¼Œmongodb å¯ä»¥å¯¹å¤–è®¿é—®ï¼Œå¹¶å¼€å¯æƒé™éªŒè¯\nsudo vim /etc/mongod.conf mongod.conf æ–‡ä»¶åŸå§‹å†…å®¹ï¼š mongod.conf ä¿®æ”¹åå†…å®¹ï¼š\næ³¨æ„ï¼šå¦‚æœä»…ä»…æ˜¯å°† bindIPAll é…ç½®ä¸º trueï¼Œå³å…è®¸å¤–éƒ¨ç½‘ç»œç½‘ç»œï¼Œè€Œæ²¡æœ‰å¼€å¯æƒé™éªŒè¯ï¼Œé‚£ä¹ˆå¤–éƒ¨å¯¹ mongodb æ‹¥æœ‰å¾ˆå¤§çš„æ“ä½œæƒé™ï¼Œå­˜åœ¨å¾ˆå¤§çš„å®‰å…¨é—®é¢˜ã€‚\nsudo service mongod restart ä¿®æ”¹å®Œ mongod.conf æ–‡ä»¶åä¸€å®šè¦é‡å¯ mongo æœåŠ¡ç”Ÿæ•ˆã€‚\nè®¾ç½®æƒé™éªŒè¯åå°±ï¼Œå¦‚æœç›´æ¥é€šè¿‡ mongo å‘½ä»¤è¿æ¥ mongodbï¼Œç»å¤§å¤šæ•°æ“ä½œéƒ½æ˜¯è¢«ç¦ç”¨çš„ï¼Œéœ€è¦é…ç½®æƒé™è¿æ¥\nsudo mongo [ip/domain name]:[port]/[database] -u username -p pwd # å¦‚ï¼š sudo mongo 10.0.0.1:27017/admin -u dba -p [your-pass] åˆ›å»º database\nuse devops ä½¿ç”¨ use [database]ï¼Œå¦‚æœ database ä¸å­˜åœ¨åˆ™ä¼šé»˜è®¤æ–°å»ºï¼› æ–°åˆ›å»ºä½†æ˜¯ä¸å­˜åœ¨æ•°æ®çš„ databaseï¼Œä½¿ç”¨ show dbs å°†çœ‹ä¸åˆ°ï¼Œé™¤éæ’å…¥æ•°æ® ä¹Ÿå¯ä»¥ä½¿ç”¨ db.createdatabase ä¸ºä¸“æœ‰ database åˆ›å»ºç”¨æˆ·\n\u0026gt; db.createUser({user:\u0026#34;devops\u0026#34;,pwd:\u0026#34;[your pass]\u0026#34;,roles:[{role:\u0026#34;readWrite\u0026#34;,db:\u0026#34;devops\u0026#34;}]}) Successfully added user: { \u0026#34;user\u0026#34; : \u0026#34;devops\u0026#34;, \u0026#34;roles\u0026#34; : [ { \u0026#34;role\u0026#34; : \u0026#34;readWrite\u0026#34;, \u0026#34;db\u0026#34; : \u0026#34;devops\u0026#34; } ] } devops æ’å…¥æ•°æ®\nsudo mongo 10.0.0.1:27017/devops -u devops -p [your-pass] \u0026gt;use devops \u0026gt;db.temp.insert({\u0026#34;name\u0026#34;:\u0026#34;devops.mongodb\u0026#34;}) æ³¨æ„ï¼š\ndb.temp.insertï¼Œå¦‚æœæ²¡æœ‰ temp collectionï¼Œåˆ™ä¼šé»˜è®¤åˆ›å»ºã€‚ å‘ï¼šè¿æ¥ mongo æ—¶ï¼Œå¦‚æœå¯†ç å¸¦æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚ï¼(å…¶ä»–æ²¡æµ‹)éœ€è¦åœ¨å¯†ç å‰åä½¿ç”¨å•å¼•å·å¼•ç”¨èµ·æ¥ï¼ï¼ï¼\nmongodb è§’è‰²ï¼š https://docs.mongodb.com/manual/reference/built-in-roles/\næ•°æ®åº“ç”¨æˆ·è§’è‰²ï¼šreadã€readWrite; æ•°æ®åº“ç®¡ç†è§’è‰²ï¼šdbAdminã€dbOwnerã€userAdminï¼› é›†ç¾¤ç®¡ç†è§’è‰²ï¼šclusterAdminã€clusterManagerã€clusterMonitorã€hostManagerï¼› å¤‡ä»½æ¢å¤è§’è‰²ï¼šbackupã€restoreï¼› æ‰€æœ‰æ•°æ®åº“è§’è‰²ï¼šreadAnyDatabaseã€readWriteAnyDatabaseã€userAdminAnyDatabaseã€dbAdminAnyDatabase è¶…çº§ç”¨æˆ·è§’è‰²ï¼šroot // è¿™é‡Œè¿˜æœ‰å‡ ä¸ªè§’è‰²é—´æ¥æˆ–ç›´æ¥æä¾›äº†ç³»ç»Ÿè¶…çº§ç”¨æˆ·çš„è®¿é—®ï¼ˆdbOwner ã€userAdminã€userAdminAnyDatabaseï¼‰ å†…éƒ¨è§’è‰²ï¼š__system åŸºç¡€æŸ¥è¯¢ # like æŸ¥è¯¢\nmongodb æŸ¥è¯¢\ndb.getCollection(\u0026#39;test\u0026#39;).find({\u0026#34;name\u0026#34;:{$regex:/dp/i}}) /dp/i å¿½ç•¥å¤§å°å†™ â€‹ python mongo æŸ¥è¯¢\ntest._get_collection().find( {\u0026#34;name\u0026#34;: {\u0026#39;$regex\u0026#39;: \u0026#39;dp\u0026#39;, \u0026#39;$options\u0026#39;: \u0026#39;i\u0026#39;}}) not likeæŸ¥è¯¢\nmongodbæŸ¥è¯¢\ndb.getCollection(\u0026#39;test\u0026#39;).find({\u0026#34;name\u0026#34;:{$not:/dp/i}}) â€‹ python mongo æŸ¥è¯¢\nimport re test._get_collection().find({\u0026#34;path\u0026#34;: {\u0026#39;$not\u0026#39;: re.compile(\u0026#39;dp\u0026#39;)}}) åˆ›å»ºç´¢å¼• # db.getCollection(\u0026#34;ColName\u0026#34;).createIndex({\u0026#34;Name\u0026#34;, 1}) # å¦‚æœé›†åˆæ•°æ®é‡æ¯”è¾ƒå¤§äº† é‚£ä¹ˆåˆ›å»ºç´¢å¼•ä¼šéå¸¸è€—æ—¶ï¼Œå»ºè®®ä½¿ç”¨åå°åˆ›å»º db.getCollection(\u0026#34;ColName\u0026#34;).createIndex({\u0026#34;Name\u0026#34;, 1}, {\u0026#34;background\u0026#34;: true}) ç”¨æˆ· # ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼š\ndb.changeUserPassword(\u0026#34;username\u0026#34;,\u0026#34;new_pwd\u0026#34;) Â« Elasticsearch\nÂ» MySQL\n"},{"id":194,"href":"/middleware/mysql/","title":"Mysql","section":"Middleware","content":" ğŸ  é¦–é¡µ / æ•°æ®ä¸­é—´ä»¶ / MySQL\nMySQL # å®‰è£… # Windows å®‰è£… MySQL # ä¸‹è½½ Mysql å®‰è£…åŒ…ï¼š https://dev.mysql.com/downloads/installer/\nä¸‹è½½å®Œæˆåï¼ŒåŒå‡» msi æ–‡ä»¶å®‰è£…ã€‚\nUbuntu å®‰è£… MySQL # sudo apt update sudo apt install mysql-server -y # åªå®‰è£… mysql å®¢æˆ·ç«¯ sudo apt install mysql-client -y Docker å®‰è£… MySQL # docker run -d --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7 Troubleshooting # Q1. root ç”¨æˆ·æœ¬åœ°ç™»å½• # ä½¿ç”¨å‘½ä»¤ mysql -u root -pï¼Œè¾“å…¥å¯†ç åç™»å½•å¤±è´¥ï¼Œæç¤ºå¦‚ä¸‹ï¼š\nAccess denied for user \u0026#39;root\u0026#39;@\u0026#39;localhost\u0026#39; è§£å†³æ–¹æ¡ˆï¼šï¼š\nä¿®æ”¹ mysqld.cnf é…ç½®æ–‡ä»¶\nsudo vim /etc/mysql/mysql.conf.d/mysqld.cnf åœ¨ [mysqld] å—çš„ skip-external-locking ä¸‹æ·»åŠ  skip-grant-tables\né‡å¯mysqlæœåŠ¡\nsudo systemctl restart mysql.service root æ— å¯†ç ç™»å½• mysql\nmysql -u root -p ä¿®æ”¹ root ç”¨æˆ·å¯†ç ä»¥åŠ plugin\n# ä¿®æ”¹ root ç”¨æˆ·å¯†ç  use mysql; update user set authentication_string=password(\u0026#34;123456\u0026#34;),plugin=\u0026#39;mysql_native_password\u0026#39; where user=\u0026#39;root\u0026#39;; flush privileges; # quit é€€å‡º quit æ³¨é‡Š etc/mysql/mysql.conf.d/mysqld.cnf åˆšæ–°åŠ çš„è¡Œ\n$ sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf ... #skip-grant-tables ... å†æ¬¡é‡å¯ mysql æœåŠ¡\nsudo systemctl restart mysql.service ä½¿ç”¨rootå¯†ç ç™»å½•mysql\nmysql -u root -p # Enter Passwordï¼š123456 Q2. åˆ›å»ºç”¨æˆ· # create user zhangsan identified by \u0026#39;zhangsan\u0026#39;; grant all privileges on zhangsanDb.* to zhangsan@\u0026#39;%\u0026#39; identified by \u0026#39;zhangsan\u0026#39;; flush privileges; é‡åˆ° Your password does not satisfy the current policy requirements é—®é¢˜ã€‚å¯†ç éªŒè¯æ— æ³•é€šè¿‡ã€‚\nè§£å†³æ–¹æ¡ˆï¼šï¼š\nSHOW VARIABLES LIKE \u0026#39;validate_password%\u0026#39;; set global validate_password_policy=LOW; MySQLé…ç½® # åˆ›å»ºç”¨æˆ· # use mysql; create user \u0026#39;admin\u0026#39;@\u0026#39;%\u0026#39; identified by \u0026#39;Admin@123\u0026#39;; %ï¼Œè¡¨ç¤ºå…è®¸æ‰€æœ‰è®¿é—®åœ°å€è¿œç¨‹è®¿é—®ï¼Œä¸€èˆ¬ root è´¦å·æ˜¯ä½¿ç”¨çš„\u0026rsquo;root\u0026rsquo;@\u0026rsquo;localhost'\ngrant all privileges on *.* to \u0026#39;admin\u0026#39;@\u0026#39;%\u0026#39; identified by \u0026#39;Admin@123\u0026#39; with grant option; *.*ï¼Œç¬¬ä¸€ä¸ª * è¡¨ç¤ºæ•°æ®åº“èµ„æºï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºè¡¨èµ„æºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸º store_db.t_order\nwith grant optionï¼Œè¡¨ç¤ºå…è®¸çº§è”æˆæƒ\nflush privileges; # æŸ¥çœ‹ç”¨æˆ· select user, host from user; MySQL å¼€å¯ binary logging # ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¦‚æœ MySQL éƒ¨ç½²åœ¨ Ubuntu ä¸Šï¼Œä¿®æ”¹ /etc/mysql/mysql.conf.d/mysqld.cnf æ–‡ä»¶ï¼Œå–æ¶ˆ server-idï¼Œlog_bin çš„é…ç½®é¡¹çš„æ³¨é‡Š; sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf server-id = 1 log_bin = /var/log/mysql/mysql-bin.log é‡å¯ MySQLã€‚ sudo service mysql restart AWS MySQL å¼€å¯ binary logging # å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_LogAccess.Concepts.MySQL.html#USER_LogAccess.MySQL.BinaryFormat\nMySQL æ‰§è¡Œè¿›ç¨‹ # show processlist # ç»“æŸæ‰§è¡Œè¿›ç¨‹ï¼Œåªåˆ é™¤ command ä¸ä¸º Sleep çš„å³å¯ kill \u0026lt;id\u0026gt; Mysql Join # Inner Join # select * from t_a inner join t_b on t_a.bid = t_b.id Right Join # select * from t_a right join t_b on t_a.bid = t_b.id Left Join # select * from t_a left join t_b on t_a.bid = t_b.id MySQLå¸¸ç”¨ # å­—ç¬¦ä¸² # æ‹¼æ¥å­—ç¬¦ä¸²ï¼š\nç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²\nselect concat(\u0026#34;hello, \u0026#34;,\u0026#34;world!\u0026#34;); # è¾“å‡º hello, world ä»¥æŸä¸ªåˆ†éš”ç¬¦æ‹¼æ¥å­—ç¬¦ä¸²\nselect concat_ws(\u0026#39;;\u0026#39;,\u0026#34;Apple\u0026#34;,\u0026#34;Orange\u0026#34;,\u0026#34;Banana\u0026#34;); # è¾“å‡º Apple;Orange;Banana æˆªå–å­—ç¬¦ä¸²ï¼š\næŸä¸ªå­—ç¬¦ä¸²ï¼Œä»ç¬¬ n ä¸ªï¼Œè¿”å›é•¿åº¦ä¸º l çš„å­—ç¬¦ä¸²\nselect substring(\u0026#39;hello, world!\u0026#39;,2,4); # æˆ–è€… select mid(\u0026#39;hello, world!\u0026#39;,2,4) # è¾“å‡º ello ä»å·¦/å³å¼€å§‹æˆªå›¾é•¿åº¦ä¸º l çš„å­—ç¬¦ä¸²\nselect left(\u0026#39;hello, world!\u0026#39;,4) # è¾“å‡º hell select right(\u0026#39;hello, world!\u0026#39;,4) # è¾“å‡º rld! æ›¿æ¢å­—ç¬¦ä¸²ï¼š\næŸä¸ªå­—ç¬¦ä¸²ï¼Œä»ç¬¬ n ä¸ªï¼Œé•¿åº¦ä¸º l çš„å­—ç¬¦ä¸² str1 æ›¿æ¢ä¸º str2\nselect insert(\u0026#39;hello, world!\u0026#39;,2,4,\u0026#39;xxxx\u0026#39;) # è¾“å‡º hxxx, world! æ›¿æ¢ç‰¹å®šå­—ç¬¦ä¸²\nselect replace(\u0026#39;hello, world!\u0026#39;,\u0026#39;ello\u0026#39;,\u0026#39;xxxx\u0026#39;) # è¾“å‡º hxxx, world! æŸ¥è¯¢å­—ç¬¦ä¸²ä½ç½®ï¼š\nselect locate(\u0026#39;ello\u0026#39;,\u0026#39;hello, world!\u0026#39;) # æˆ–è€… select position(\u0026#39;ello\u0026#39; IN \u0026#39;hello, world!\u0026#39;) # æˆ–è€… select instr(\u0026#39;hello, world!\u0026#39;,\u0026#39;ello\u0026#39;) # å‡è¾“å‡º 2 æ—¶é—´ # è·å–å½“å‰æ—¶é—´ï¼š\nselect now() æ ¼å¼åŒ–æ—¶é—´ï¼š\nselect date_format(now(),\u0026#39;%y-%m-%d\u0026#39;); æ ¼å¼åŒ–å‚æ•°\n%S, %s ä¸¤ä½æ•°å­—å½¢å¼çš„ç§’ï¼ˆ 00,01, \u0026hellip;, 59ï¼‰ %I, %i ä¸¤ä½æ•°å­—å½¢å¼çš„åˆ†ï¼ˆ 00,01, \u0026hellip;, 59ï¼‰ %H ä¸¤ä½æ•°å­—å½¢å¼çš„å°æ—¶ï¼Œ24 å°æ—¶ï¼ˆ00,01, \u0026hellip;, 23ï¼‰ %h ä¸¤ä½æ•°å­—å½¢å¼çš„å°æ—¶ï¼Œ12 å°æ—¶ï¼ˆ01,02, \u0026hellip;, 12ï¼‰ %k æ•°å­—å½¢å¼çš„å°æ—¶ï¼Œ24 å°æ—¶ï¼ˆ0,1, \u0026hellip;, 23ï¼‰ %l æ•°å­—å½¢å¼çš„å°æ—¶ï¼Œ12 å°æ—¶ï¼ˆ1, 2, \u0026hellip;, 12ï¼‰ %T 24 å°æ—¶çš„æ—¶é—´å½¢å¼ï¼ˆhh:mm:ssï¼‰ %r 12 å°æ—¶çš„æ—¶é—´å½¢å¼ï¼ˆhh:mm:ss AM æˆ–hh:mm:ss PMï¼‰ %p AMæˆ–PM %W ä¸€å‘¨ä¸­æ¯ä¸€å¤©çš„åç§°ï¼ˆSunday, Monday, \u0026hellip;, Saturdayï¼‰ %a ä¸€å‘¨ä¸­æ¯ä¸€å¤©åç§°çš„ç¼©å†™ï¼ˆSun, Mon, \u0026hellip;, Satï¼‰ %d ä¸¤ä½æ•°å­—è¡¨ç¤ºæœˆä¸­çš„å¤©æ•°ï¼ˆ00, 01,\u0026hellip;, 31ï¼‰ %e æ•°å­—å½¢å¼è¡¨ç¤ºæœˆä¸­çš„å¤©æ•°ï¼ˆ1, 2ï¼Œ \u0026hellip;, 31ï¼‰ %D è‹±æ–‡åç¼€è¡¨ç¤ºæœˆä¸­çš„å¤©æ•°ï¼ˆ1st, 2nd, 3rd,\u0026hellip;ï¼‰ %w ä»¥æ•°å­—å½¢å¼è¡¨ç¤ºå‘¨ä¸­çš„å¤©æ•°ï¼ˆ 0 = Sunday, 1=Monday, \u0026hellip;, 6=Saturdayï¼‰ %j ä»¥ä¸‰ä½æ•°å­—è¡¨ç¤ºå¹´ä¸­çš„å¤©æ•°ï¼ˆ 001, 002, \u0026hellip;, 366ï¼‰ %U å‘¨ï¼ˆ0, 1, 52ï¼‰ï¼Œå…¶ä¸­Sunday ä¸ºå‘¨ä¸­çš„ç¬¬ä¸€å¤© %u å‘¨ï¼ˆ0, 1, 52ï¼‰ï¼Œå…¶ä¸­Monday ä¸ºå‘¨ä¸­çš„ç¬¬ä¸€å¤© %M æœˆåï¼ˆJanuary, February, \u0026hellip;, Decemberï¼‰ %b ç¼©å†™çš„æœˆåï¼ˆ January, February,\u0026hellip;., Decemberï¼‰ %m ä¸¤ä½æ•°å­—è¡¨ç¤ºçš„æœˆä»½ï¼ˆ01, 02, \u0026hellip;, 12ï¼‰ %c æ•°å­—è¡¨ç¤ºçš„æœˆä»½ï¼ˆ1, 2, \u0026hellip;., 12ï¼‰ %Y å››ä½æ•°å­—è¡¨ç¤ºçš„å¹´ä»½ %y ä¸¤ä½æ•°å­—è¡¨ç¤ºçš„å¹´ä»½ %% ç›´æ¥å€¼â€œ%â€\næ•°æ®å¯¼å…¥å¯¼å‡º # A è¡¨æ•°æ®å†™å…¥ B è¡¨ï¼š\nå¦‚æœ a è¡¨å­—æ®µå’Œ b è¡¨å­—æ®µä¸€è‡´ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥\ninsert into t_b select * from t_a å¦‚æœåªå¸Œæœ› A è¡¨éƒ¨åˆ†å­—æ®µå†™å…¥ B è¡¨ï¼Œåˆ™ä½¿ç”¨ä»¥ä¸‹è¯­å¥\ninsert into t_b (t_b.f1,t_b.f2,...) select t_a.f1, t_a.f2, ... from t_a å¯ä»¥ä½¿ç”¨ as ä½¿å­—æ®µæ˜ å°„ï¼Œå¯ä»¥ä½¿ç”¨ where è¿‡æ»¤æ•°æ®\nÂ« MongoDB\nÂ» Postgres\n"},{"id":195,"href":"/middleware/postgres/","title":"Postgres","section":"Middleware","content":" ğŸ  é¦–é¡µ / æ•°æ®ä¸­é—´ä»¶ / Postgres\nPostgres # è‡ªå¢ Id æ•°æ®æ’å…¥æƒé™\nGRANT USAGE, SELECT, UPDATE ON ALL SEQUENCES IN SCHEMA public TO \u0026lt;user_name\u0026gt;; ä¿®æ”¹ç”¨æˆ·å¯†ç \nalter user postgres with password \u0026#39;admin123\u0026#39;; Â« MySQL\nÂ» Redis\n"},{"id":196,"href":"/middleware/redis/","title":"Redis","section":"Middleware","content":" ğŸ  é¦–é¡µ / æ•°æ®ä¸­é—´ä»¶ / Redis\nRedis # å®‰è£… # Docker å®‰è£… redis # sudo docker run --name redis-01 \\ -p 2501:6379 \\ -v /home/dp/apps/redis/redis-01/conf/redis.conf:/etc/redis/redis.conf \\ -v /home/dp/apps/redis/redis-01/data:/data \\ -d \\ redis:6.0 redis-server /etc/redis/redis.conf --appendonly yes redis.conf æ˜¯é…ç½®æ–‡ä»¶ redis-server /etc/redis/redis.confï¼Œå¯ç”¨é…ç½®ï¼Œå¦‚æœæ²¡æœ‰ redis-server åˆ™ redis é»˜è®¤æ˜¯æ— é…ç½®å¯åŠ¨ \u0026ndash;appendonly yes å¯ç”¨æ•°æ®æŒä¹…åŒ– redis.conf å‚ç…§ï¼š\nbind 127.0.0.1 # æ³¨é‡Šæ‰è¿™éƒ¨åˆ†ï¼Œä½¿ redis å¯ä»¥å¤–éƒ¨è®¿é—® daemonize no # ç”¨å®ˆæŠ¤çº¿ç¨‹çš„æ–¹å¼å¯åŠ¨ requirepass your_pwd # ç»™ redis è®¾ç½®å¯†ç  appendonly yes # redis æŒä¹…åŒ–ã€€é»˜è®¤æ˜¯ no tcp-keepalive 300 # é˜²æ­¢å‡ºç°è¿œç¨‹ä¸»æœºå¼ºè¿«å…³é—­äº†ä¸€ä¸ªç°æœ‰çš„è¿æ¥çš„é”™è¯¯ é»˜è®¤æ˜¯ 300 Â« Postgres\n"},{"id":197,"href":"/os/","title":"Os","section":"","content":" ğŸ  é¦–é¡µ / æ“ä½œç³»ç»Ÿ\næ“ä½œç³»ç»Ÿ # MacOS\nohmyzsh\nopenssl\nUbuntu\nWindows ä½¿ç”¨å§¿åŠ¿\n"},{"id":198,"href":"/os/macos/","title":"Macos","section":"Os","content":" ğŸ  é¦–é¡µ / æ“ä½œç³»ç»Ÿ / MacOS\nMacOS # CursorUIViewService æœªå“åº” # sudo defaults write /Library/Preferences/FeatureFlags/Domain/UIKit.plist redesigned_text_cursor -dict-add Enabled -bool NO # æ”¹å› sudo defaults write /Library/Preferences/FeatureFlags/Domain/UIKit.plist redesigned_text_cursor -dict-add Enabled -bool YES é™æ€å£çº¸ä½ç½® # å†å²ç³»ç»Ÿå£çº¸: /Users/dp/Library/Application Support/com.apple.mobileAssetDesktop å½“å‰ç³»ç»Ÿå£çº¸ï¼š/System/Library/Desktop Pictures åŠ¨æ€å£çº¸ï¼š/Library/Application Support/com.apple.idleassetsd/Customer/4KSDR240FPS\nGit å¿½ç•¥ .DS_Store æ–‡ä»¶ # # é…ç½®å…¨å±€å¿½ç•¥æ–‡ä»¶ git config --global core.excludesfile ~/.gitignore_global # æ·»åŠ  .DS_Store æ–‡ä»¶åˆ°å…¨å±€å¿½ç•¥æ–‡ä»¶ echo .DS_Store \u0026gt;\u0026gt; ~/.gitignore_global echo ._.DS_Store \u0026gt;\u0026gt; ~/.gitignore_global echo **/.DS_Store \u0026gt;\u0026gt; ~/.gitignore_global echo **/._.DS_Store \u0026gt;\u0026gt; ~/.gitignore_global é…ç½® PATH # åœ¨ç»ˆç«¯ä½¿ç”¨ export å‘½ä»¤è®¾ç½® PATH å¹¶ä¸èƒ½å…¨å±€ç”Ÿæ•ˆï¼Œå¦‚æœä½ æƒ³è®¾ç½®å…¨å±€ PATH ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š\nsudo mkdir /etc/paths.d/mypath vim /etc/paths.d/mypath /your/path æŸ¥çœ‹ç«¯å£å ç”¨å¹¶é€€å‡ºç¨‹åº # æœ‰æ—¶å€™ä½¿ç”¨ VSCode è°ƒè¯•æˆ–è¿è¡Œç¨‹åºåï¼Œæ— æ³•æˆåŠŸæ¨å‡ºç¨‹åºï¼Œç«¯å£ä¸€ç›´å ç”¨ã€‚\næŸ¥çœ‹ç«¯å£å ç”¨ï¼š\n# [port] æ›¿æ¢æˆä½ æƒ³æŸ¥çœ‹çš„ç«¯å£å·ï¼Œä¾‹å¦‚ï¼šsudo lsof -i tcp:8080 sudo lsof -i tcp:[port] ä¸Šè¿°å‘½ä»¤å¯ä»¥å¾—åˆ°ç¨‹åºçš„è¿›ç¨‹ PIDï¼Œé€€å‡ºè¿›ç¨‹ï¼š\n# [PID] æ›¿æ¢æˆç¨‹åºçš„è¿›ç¨‹ PID sudo kill -9 [PID] é‡ç½® Downie è¯•ç”¨ # rm -rfv ~/Library/Containers/com.charliemonroe.Downie-4/Data/Library/Application\\ Support/Downie\\ 4 é…ç½®å¿«æ·å‘½ä»¤ï¼š\nvim ~/.zsh alias reset-downie-trial=\u0026#39;rm -rfv ~/Library/Containers/com.charliemonroe.Downie-4/Data/Library/Application\\ Support/Downie\\ 4\u0026#39; è‡ªå®šä¹‰ PATH # mkdir -p ~/.dev/bin echo \u0026#34;export PATH=$PATH:~/.dev/bin\u0026#34; æ›´æ–° Python çš„è¯ä¹¦åŒ… # /Applications/Python\\ 3.6/Install\\ Certificates.command Mac ç¼“å­˜æ¸…ç† # go ç¼“å­˜æ¸…ç† # go clean -cache npm ç¼“å­˜æ¸…ç† # npm cache clean --force sudo npm cache clean --force yarn ç¼“å­˜æ¸…ç† # yarn cache clean rust ç¼“å­˜æ¸…ç† # # install cargo-cache cargo install cargo-cache # clean cache cargo cache --autoclean iTerm2 # è§£å†³ iTerm2 ä¸‹ä½¿ç”¨ Solarized Dark ä¸»é¢˜æ—¶ï¼Œzsh-autosuggestions æ˜¾ç¤ºé—®é¢˜ï¼š\nvim .oh-my-zsh/custom/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh æ‰¾åˆ°å¹¶é…ç½®ï¼šZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=10'\nexec zsh Go è°ƒè¯•é—®é¢˜ # å¦‚æœé‡åˆ° Failed to launch: could not launch process: can not run under Rosetta, check that the installed build of Go is right for your CPU architecture é—®é¢˜ï¼Œå°è¯•ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š\nå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ delveï¼š\ngo install github.com/go-delve/delve/cmd/dlv@latest å¸è½½ç¨‹åºæ–‡ä»¶æƒé™é—®é¢˜ # åœ¨å‚ç…§ Docker å®˜æ–¹æ–‡æ¡£ å¸è½½ Docker Desktop æ—¶ï¼Œé‡åˆ°äº†ç¨‹åºæ–‡ä»¶åˆ é™¤é—®é¢˜ï¼š\n$ rm -rf ~/Library/Containers/com.docker.docker rm: /Users/dp/Library/Containers/com.docker.docker/.com.apple.containermanagerd.metadata.plist: Operation not permitted rm: /Users/dp/Library/Containers/com.docker.docker: Operation not permitted è§£å†³æ–¹æ¡ˆï¼š\nè¿›å…¥ç³»ç»Ÿè®¾ç½® =\u0026gt; éšç§ä¸å®‰å…¨æ€§ =\u0026gt; å®Œå…¨ç£ç›˜è®¿é—®æƒé™ï¼Œæ·»åŠ ç»ˆç«¯ç¨‹åºå¦‚ iTerm è®¿é—®æƒé™ã€‚å†æ¬¡æ‰§è¡Œåˆ é™¤å‘½ä»¤ï¼ŒOKï½\nè®¾ç½® Dock æ æ˜¾ç¤ºé€Ÿåº¦ # defaults write com.apple.dock autohide-delay -float 0 \u0026amp;\u0026amp; defaults write com.apple.dock autohide-time-modifier -float 0.2 \u0026amp;\u0026amp; killall Dock é‡ç½®ï¼š\ndefaults delete com.apple.dock autohide-delay \u0026amp;\u0026amp; defaults delete com.apple.dock autohide-time-modifier \u0026amp;\u0026amp; killall Dock python # åœ¨ Mac ä¸Šå¸è½½äº†è€ç‰ˆæœ¬çš„ pythonï¼Œå¹¶å®‰è£…äº†æ–°ç‰ˆæœ¬çš„ python3 åï¼Œæ‰§è¡Œå‘½ä»¤æç¤ºï¼šenv: python: No such file or directory\nè§£å†³æ–¹å¼ï¼š\nsudo ln -s -f /usr/local/bin/python3 /usr/local/bin/python iTerm2 é…ç½® # clash-verge-rev # å¼€å¯æœåŠ¡æ¨¡å¼å’Œ TUN æ¨¡å¼åï¼Œå…³é—­åï¼ŒDNS æ— æ³•æ¢å¤ï¼Œå¯¼è‡´å†…ç½‘ç¯å¢ƒæ— æ³•è®¿é—®é—®é¢˜ã€‚\nè®¢é˜… =\u0026gt; å…¨å±€æ‰©å±•é…ç½®ï¼š\n# Profile Enhancement Merge Template for Clash Verge profile: store-selected: true dns: default-nameserver: - 192.168.141.155 - 192.168.141.157 - 223.5.5.5 - 114.114.114.114 nameserver: - 192.168.141.155 - 192.168.141.157 Lens # UI æ”¹ç‰ˆä¹‹å‰æœ€åä¸€ä¸ªç‰ˆæœ¬ä¸‹è½½åœ°å€ï¼š\nLens-2024.8.291605\nå®‰è£…ä¹‹åä¸ºäº†é¿å…å…¶è‡ªåŠ¨å‡çº§ï¼Œæ·»åŠ  hosts dns æ˜ å°„ï¼š\n127.0.0.1\tapi.k8slens.dev 127.0.0.1\tdownloads.k8slens.dev å¹¶ä¸”åœ¨ clash-verge ä¸­ç³»ç»Ÿä»£ç†ç»•è¿‡è®¾ç½®ä¸­æ·»åŠ ï¼š\n*.k8slens.dev Â» ohmyzsh\n"},{"id":199,"href":"/os/ohmyzsh/","title":"Ohmyzsh","section":"Os","content":" ğŸ  é¦–é¡µ / æ“ä½œç³»ç»Ÿ / ohmyzsh\nohmyzsh # macos # echo $SHELL /bin/zsh å®‰è£… ohmyzsh sh -c \u0026#34;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026#34; å®‰è£… zsh-autosuggestions git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions é…ç½® .zshrc æ–‡ä»¶æ·»åŠ  ohmyzsh æ’ä»¶ï¼š plugins=(git docker docker-compose kubectl autojump zsh-autosuggestions) linux # å®‰è£… zshï¼š sudo apt update sudo apt install zsh -y ä¿®æ”¹ shellï¼š chsh -s /usr/bin/zsh æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œå°†ä½¿ç”¨ zsh\necho $SHELL /usr/bin/zsh å®‰è£… ohmyzshï¼š sh -c \u0026#34;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026#34; å®‰è£… zsh-autosuggestionsï¼š git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions é…ç½® .zshrc æ–‡ä»¶æ·»åŠ  ohmyzsh æ’ä»¶ï¼š plugins=(git docker docker-compose kubectl autojump zsh-autosuggestions globalias) GLOBALIAS_FILTER_VALUES=(ls grep) Â« MacOS\nÂ» openssl\n"},{"id":200,"href":"/os/openssl/","title":"Openssl","section":"Os","content":" ğŸ  é¦–é¡µ / æ“ä½œç³»ç»Ÿ / openssl\nopenssl # openssl å¸¸ç”¨äºç”Ÿæˆè¯ä¹¦ã€ç­¾åã€åŠ å¯†ç­‰æ“ä½œã€‚å®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„å·¥å…·ï¼Œå¯ä»¥åœ¨ Linuxã€Windowsã€MacOS ç­‰æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚\nåŒ…å«ä¸‰ä¸ªç»„ä»¶ï¼š\nopensslï¼šå‘½ä»¤è¡Œå·¥å…· libcryptoï¼šåŠ å¯†ç®—æ³•åº“ libsslï¼šåŠ å¯†æ¨¡å—åº”ç”¨åº“ï¼Œå®ç°äº† SSL å’Œ TLS åè®® å¯¹ç§°åŠ å¯† # echo test \u0026gt; test.txt # åŠ å¯† openssl enc -e -des3 -a -salt -in test.txt -out test.txt.enc # è§£å¯† openssl enc -d -des3 -a -salt -in test.txt.enc -out test.txt.dec -saltï¼šåŠ ç›ï¼Œå¢åŠ ç ´è§£éš¾åº¦ï¼Œä½¿ç”¨ openssl é»˜è®¤ç›å€¼ -S [salt]ï¼šæŒ‡å®šç›å€¼\néå¯¹ç§°åŠ å¯† # ç”Ÿæˆå¯†é’¥å¯¹\nopenssl genrsa -out rsa_private_key.pem 2048 openssl rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem åŠ å¯†ï¼ˆå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼‰\necho test \u0026gt; test.txt # åŠ å¯† openssl rsautl -encrypt -inkey rsa_public_key.pem -pubin -in test.txt -out test.txt.enc # è§£å¯† openssl rsautl -decrypt -inkey rsa_private_key.pem -in test.txt.enc -out test.txt.dec æ•°å­—ç­¾åï¼ˆç§é’¥ç­¾åï¼Œå…¬é’¥éªŒè¯ï¼‰\necho test \u0026gt; test.txt # ç­¾å openssl dgst -sha256 -sign rsa_private_key.pem -out test.txt.sign test.txt # éªŒè¯ openssl dgst -sha256 -verify rsa_public_key.pem -signature test.txt.sign test.txt CA è¯ä¹¦ \u0026amp; é¢å‘è¯ä¹¦ # ç”Ÿæˆ CA ç§é’¥å’Œè¯ä¹¦\n# è‡³å°‘éœ€è¦è¾“å…¥ 4 ä½å¯†ç å£ä»¤ openssl req -new -x509 -days 3650 -keyout ca.key -out ca.crt ç”ŸæˆæœåŠ¡ç«¯ç§é’¥å’Œè¯ä¹¦\n# æœåŠ¡ç«¯ç§é’¥ openssl genrsa -out server.key 2048 # æœåŠ¡ç«¯è¯ä¹¦ç­¾ç½²è¯·æ±‚ï¼ˆcsrï¼‰ openssl req -new -key server.key -out server.csr # æœåŠ¡ç«¯è¯ä¹¦ openssl x509 -req -days 3650 -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯\n# æŸ¥çœ‹ CA è¯ä¹¦ openssl x509 -in ca.crt -noout -text # æŸ¥çœ‹æœåŠ¡ç«¯è¯ä¹¦ openssl x509 -in server.crt -noout -text Â« ohmyzsh\nÂ» Ubuntu\n"},{"id":201,"href":"/os/ubuntu/","title":"Ubuntu","section":"Os","content":" ğŸ  é¦–é¡µ / æ“ä½œç³»ç»Ÿ / Ubuntu\nUbuntu # ç»ˆç«¯é»˜è®¤ä½¿ç”¨è‹±æ–‡ # LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 ä¸‹è½½ arm64 æ¡Œé¢é•œåƒ # https://cdimage.ubuntu.com/jammy/daily-live/current/jammy-desktop-arm64.iso å…³é—­é˜²ç«å¢™ # sudo ufw disable sudo ufw status ä¿®æ”¹æ—¶åŒº # sudo cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime sudo timedatectl set-timezone Asia/Shanghai date # åŒæ­¥æ—¶é—´ sudo apt install ntpdate -y sudo ntpdate cn.pool.ntp.org è§£å†³è‹±æ–‡ç³»ç»Ÿä¸‹ä¸­æ–‡æ˜¾ç¤ºé—®é¢˜ # ä¿®æ”¹å­—ä½“ä¼˜å…ˆçº§\nsudo vim /etc/fonts/conf.avail/64-language-selector-prefer.conf æ³¨æ„ï¼šåœ¨ Ubuntu 23.10 æˆ–æ›´æ–°ç‰ˆæœ¬çš„ç³»ç»Ÿä¸Šä¿®æ”¹æ–‡ä»¶ï¼š\nsudo vim /etc/fonts/conf.d/64-language-selector-cjk-prefer.conf å°† `JP` å’Œ `KR` æ‰€åœ¨è¡Œå¾€ä¸‹è°ƒæ•´å³å¯ï¼Œè°ƒæ•´æˆå¦‚ä¸‹æ‰€ç¤ºï¼š ```xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE fontconfig SYSTEM \u0026#34;fonts.dtd\u0026#34;\u0026gt; \u0026lt;fontconfig\u0026gt; \u0026lt;alias\u0026gt; \u0026lt;family\u0026gt;sans-serif\u0026lt;/family\u0026gt; \u0026lt;prefer\u0026gt; \u0026lt;family\u0026gt;Noto Sans CJK SC\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Noto Sans CJK TC\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Noto Sans CJK HK\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Noto Sans CJK JP\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Noto Sans CJK KR\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Lohit Devanagari\u0026lt;/family\u0026gt; \u0026lt;/prefer\u0026gt; \u0026lt;/alias\u0026gt; \u0026lt;alias\u0026gt; \u0026lt;family\u0026gt;serif\u0026lt;/family\u0026gt; \u0026lt;prefer\u0026gt; \u0026lt;family\u0026gt;Noto Serif CJK SC\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Noto Serif CJK TC\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Noto Serif CJK JP\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Noto Serif CJK KR\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Lohit Devanagari\u0026lt;/family\u0026gt; \u0026lt;/prefer\u0026gt; \u0026lt;/alias\u0026gt; \u0026lt;alias\u0026gt; \u0026lt;family\u0026gt;monospace\u0026lt;/family\u0026gt; \u0026lt;prefer\u0026gt; \u0026lt;family\u0026gt;Noto Sans Mono CJK SC\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Noto Sans Mono CJK TC\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Noto Sans Mono CJK HK\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Noto Sans Mono CJK JP\u0026lt;/family\u0026gt; \u0026lt;family\u0026gt;Noto Sans Mono CJK KR\u0026lt;/family\u0026gt; \u0026lt;/prefer\u0026gt; \u0026lt;/alias\u0026gt; \u0026lt;/fontconfig\u0026gt; å®‰è£…æœç‹—è¾“å…¥æ³• # å‚ç…§å®˜æ–¹æ–‡æ¡£ï¼š https://pinyin.sogou.com/linux/help.php\n# ç¦ç”¨ctrl+shift+f vim ~/.config/sogoupinyin/conf/env.ini # æ‰¾åˆ°è¿™è¡ŒShortCutFanJian=1ï¼Œæ”¹ä¸ºShortCutFanJian=0 vim ~/.config/fcitx/conf/fcitx-chttrans.config # æ‰¾åˆ° #Hotkey=CTRL_SHIFT_Fï¼Œå–æ¶ˆæ³¨é‡Šï¼Œå¹¶æ”¹ä¸º #Hotkey=CTRL_SHIFT_] # ä¿å­˜ä¹‹åï¼Œé‡æ–°ç™»å½•å³å¯ ä¿®å¤ No Wi-Fi Adapter Found é—®é¢˜ # rfkill unblock all sudo /etc/init.d/networking restart sudo rm /etc/udev/rules.d/70-persistent-net.rules sudo reboot M720 é¼ æ ‡ä¼˜è”è¿æ¥ # ä¸‹è½½ Solaar\nsudo apt install solaar ä¸‹è½½å®Œæˆä¹‹åï¼Œæ’å…¥ USB æ¥æ”¶å™¨ï¼ŒM720 åˆ‡æ¢è‡³æœªè¢«å ç”¨çš„ Channelï¼Œå¹¶é‡æ–°å¯åŠ¨ï¼ˆOff =\u0026gt; Onï¼‰ã€‚\næ‰“å¼€ Solaar åº”ç”¨\nsolaar å¦‚æœæ²¡æœ‰å‘ç° M720 é¼ æ ‡ï¼Œåˆ™é‡å¯ Ubuntuï¼Œé‡å¯ä¹‹åå†æ¬¡æ‰“å¼€ Solaar ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°åˆ—è¡¨ä¸­å‡ºç° Solaarï¼Œç‚¹å‡» \u0026ldquo;Pair the device\u0026rdquo; å³å¯ã€‚\nUbuntu å¯ç”¨ä¸­æ–‡è¾“å…¥æ³• # å¥½åƒæ˜¯ Ubuntu 23.10 åæ”¯æŒã€‚\né¦–å…ˆéœ€è¦å®‰è£…ä¸­æ–‡è¯­è¨€ï¼› é€‰æ‹©è¾“å…¥æ³•ï¼ŒChineseï¼ŒåŒå‡»æ‰“å¼€ï¼› è¾“å…¥æ³•è®¾ç½®ï¼Œå–æ¶ˆè‹±æ–‡æ¨¡å¼ã€‚ è™šæ‹Ÿæœº # VMWare Fusion å¼€å¯å®¿ä¸»æœºå¤åˆ¶ç²˜è´´åŠŸèƒ½ï¼Œæ¡Œé¢ç‰ˆ Ubuntu ç³»ç»Ÿå®‰è£…æ’ä»¶ï¼š\nsudo apt install open-vm-tools open-vm-tools-desktop -y å®‰è£…å®Œä¹‹åï¼Œé‡å¯è™šæ‹Ÿæœºå³å¯ã€‚\nå‡çº§ # 22.04 -\u0026gt; 23.04 # sudo apt update sudo apt upgrade -y sudo apt install update-manager-core -y sudo vim /etc/update-manager/release-upgrades # modify Prompt=lts to Prompt=normal sudo sed -i \u0026#39;s/jammy/lunar/g\u0026#39; /etc/apt/sources.list sudo apt update sudo apt upgrade -y sudo apt dist-upgrade -y 23.04 -\u0026gt; 23.10 # sudo apt update sudo apt upgrade -y sudo do-release-upgrade è¾“å…¥æ³• # RIME è¾“å…¥æ³•ï¼š\nsudo apt install ibus-rime å®‰è£…å®Œæˆåï¼Œéœ€è¦æ³¨é”€å½“å‰ç”¨æˆ·é‡æ–°ç™»å½•æˆ–è€…ç›´æ¥é‡å¯ç”Ÿæ•ˆã€‚\né…ç½®ï¼š\nè¾“å…¥æ—¶æŒ‰ F4ï¼Œå¯ä»¥ç›´æ¥åœ¨è¾“å…¥ç•Œé¢é…ç½®ï¼Œä¾‹å¦‚é…ç½®é»˜è®¤ä½¿ç”¨ç®€ä½“ï¼Œé»˜è®¤ä½¿ç”¨è‹±æ–‡ç­‰ã€‚\ngnome-tweak å·¥å…· # ä¸‹è½½ï¼š\nsudo apt install gnome-tweaks -y åº”ç”¨ç•Œé¢æ‰¾åˆ° Tweak åº”ç”¨è¿è¡Œï¼Œæˆ–è€…ç›´æ¥ç»ˆç«¯è¾“å…¥ gnome-tweak è¿è¡Œã€‚\né…ç½®ï¼š\nåœ¨ 2K åˆ†è¾¨ç‡å±å¹•ä¸‹å¯ä»¥è°ƒæ•´é…ç½®ï¼šå­—ä½“ -\u0026gt; Scaling Factor -\u0026gt; è°ƒæ•´ä¸º 1.2ï¼› Ulauncher # å®‰è£…ï¼š\nexport VERSION=$(curl -s https://api.github.com/repos/Ulauncher/Ulauncher/releases/latest | jq -r .tag_name) wget https://github.com/Ulauncher/Ulauncher/releases/download/${VERSION}/ulauncher_${VERSION}_all.deb sudo dpkg -i ulauncher_${VERSION}_all.deb # å¦‚æœé‡åˆ°ä¾èµ–é—®é¢˜ï¼Œåˆ™è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š sudo apt install --fix-broken é…ç½® Alt+Space å¿«æ·é”®ï¼š\nSetting =\u0026gt; Keyboard =\u0026gt; Keyboard Shortcuts =\u0026gt; View and Customize Shortcuts\nç¬¬ä¸€æ­¥ï¼Œå…ˆé€šè¿‡è¾“å…¥ Alt+Space æŸ¥è¯¢å½“å‰å¿«æ·é”®å†²çªï¼Œåˆ é™¤å½“å‰å¿«æ·é”®ä½¿ç”¨ï¼›\nç¬¬äºŒæ­¥ï¼Œæ·»åŠ æ–°çš„è‡ªå®šä¹‰å¿«æ·é”®ï¼š\nNameï¼šUlauncher Commandï¼šulauncher-toggle Shortcutï¼šAlt+Space ssh è§£é”æ¡Œé¢ç™»é™† # é¦–å…ˆåœ¨ç»ˆç«¯é€šè¿‡ ssh è¿æ¥ç›®æ ‡ä¸»æœº\nssh user@server loginctl list-sessions # æ‰¾åˆ° STATE ä¸º active çš„è¾“å‡ºè¡Œçš„ SESSIONï¼Œä¾‹å¦‚ä¸º 5481 loginctl unlock-session 5481 æˆåŠŸä¹‹åï¼Œå†é€šè¿‡ä¾‹å¦‚ Microsoft Remote Desktop å·¥å…·ç™»é™†æ¡Œé¢ã€‚\nÂ« openssl\nÂ» Windows ä½¿ç”¨å§¿åŠ¿\n"},{"id":202,"href":"/os/windows/","title":"Windows","section":"Os","content":" ğŸ  é¦–é¡µ / æ“ä½œç³»ç»Ÿ / Windows ä½¿ç”¨å§¿åŠ¿\nWindows ä½¿ç”¨å§¿åŠ¿ # 0. æ¿€æ´» windows # ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå‘½ä»¤è¡Œï¼Œè¾“å…¥ä»¥ä¸‹ä¸‰è¡Œå‘½ä»¤ï¼š\nslmgr /ipk W269N-WFGWX-YVC9B-4J6C9-T83GX # ç­‰å¾…å¼¹çª—å‡ºç°ï¼Œç‚¹å‡»ç¡®å®šä¹‹åï¼Œå†ç»§ç»­æ‰§è¡Œä¸‹ä¸€è¡Œå‘½ä»¤ slmgr /skms kms.loli.best # slmgr /skms kms.03k.org # åŒæ ·éœ€è¦ç­‰å¾…å¼¹çª—å‡ºç°ï¼Œç‚¹å‡»ç¡®å®šä¹‹åï¼Œå†ç»§ç»­æ‰§è¡Œ slmgr /ato # æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥ä¼šå‡ºç°æ¿€æ´»æˆåŠŸçš„å¼¹çª— 1. Windows Terminal SSH è¿æ¥è¶…æ—¶è‡ªåŠ¨æ–­å¼€ # ä½¿ç”¨ Windows Terminal SSH è¿æ¥ linux æœåŠ¡å™¨ï¼Œæ¯è¿‡ä¸€æ®µæ—¶é—´åï¼Œå°±ä¼šè‡ªåŠ¨æ–­å¼€ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\næ‰“å¼€é…ç½®æ–‡ä»¶ %USERPROFILE%/.ssh/configï¼Œåœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½®è¡Œï¼š\nServerAliveInterval 60 2. VSCode æ­é… Remote-SSH # é…ç½®è¿œç¨‹è®¿é—®æ–‡ä»¶ %USERPROFILE%/.ssh/configï¼š\nå¯†é’¥æ–‡ä»¶è¿›è¡ŒSSHè¿æ¥ # Host aliyun HostName 11.11.11.11 User root IdentityFile ~/.ssh/aliyun_key ç”¨æˆ·å¯†ç è¿›è¡ŒSSHè¿æ¥ # Host ubuntu HostName 192.168.11.11 User dp ä½†æ˜¯å¦‚æœä½ ä¸æ˜¯ä½¿ç”¨å¯†é’¥å½¢å¼é…ç½®çš„è¯ï¼Œæ¯æ¬¡è¿æ¥æ—¶éƒ½éœ€è¦è¾“å…¥å¯†ç ã€‚\nè§£å†³æ–¹æ¡ˆï¼š\ncd ~/.ssh ssh-keygen -t rsa -C \u0026#34;remote\u0026#34; -f ubuntu å°†ç”Ÿæˆ ubuntu å’Œ ubuntu.pub æ–‡ä»¶ï¼Œå°† ubuntu.pub æ–‡ä»¶å†…å®¹è¿½åŠ æ‹·è´è‡³è¿œç¨‹æœåŠ¡å™¨ ~/.ssh/authorized_keys æ–‡ä»¶å³å¯ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºã€‚\n3. Powershell å‘½ä»¤ # æ¸…é™¤å†å²å‘½ä»¤\nRemove-Item (Get-PSReadlineOption).HistorySavePath 4. å®‰è£… windows11 è™šæ‹Ÿæœº # å®‰è£… windwos è™šæ‹Ÿæœºè·³è¿‡ç½‘ç»œçš„æ–¹æ³•ï¼ŒæŒ‰ä¸‹ Shift+F10 æˆ–è€…æ˜¯ Fn+Shift+F10 å¿«æ·é”®è°ƒå‡ºå‘½ä»¤æç¤ºç¬¦çª—å£ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š\noobe\\BypassNRO Â« Ubuntu\n"},{"id":203,"href":"/reading/","title":"Reading","section":"","content":" ğŸ  é¦–é¡µ / é˜…è¯»\né˜…è¯» # äº‘åŸç”Ÿåº”ç”¨å¼€å‘ï¼šOperatoråŸç†ä¸å®è·µ\næˆ‘çš„ç¬¬ä¸€æœ¬ç®—æ³•ä¹¦\næ·±å…¥ç†è§£è®¡ç®—æœºç½‘ç»œ.md\n"},{"id":204,"href":"/reading/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91Operator%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/","title":"äº‘åŸç”Ÿåº”ç”¨å¼€å‘ï¼š OperatoråŸç†ä¸å®è·µ","section":"Reading","content":" ğŸ  é¦–é¡µ / é˜…è¯» / äº‘åŸç”Ÿåº”ç”¨å¼€å‘ï¼šOperatoråŸç†ä¸å®è·µ\näº‘åŸç”Ÿåº”ç”¨å¼€å‘ï¼šOperatoråŸç†ä¸å®è·µ # 2. OperatoråŸç† # 2.2 client-goåŸç† # client-goä¸»è¦ç”¨åœ¨Kubernetesçš„Controllerä¸­ï¼ŒåŒ…æ‹¬å†…ç½®Controllerï¼ˆå¦‚kube-controller-managerï¼‰å’ŒCRDæ§åˆ¶å™¨ï¼›\nå®ç°å¯¹å„ç±»K8s APIèµ„æºçš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼›\nåŒ…å«Reflectorï¼ŒInformerï¼ŒIndexrç­‰ç»„ä»¶ã€‚\n2.2.1 client-goä»‹ç» # æ˜¯æ“ä½œk8sé›†ç¾¤èµ„æºçš„ç¼–ç¨‹å¼äº¤äº’å®¢æˆ·ç«¯ï¼Œåˆ©ç”¨å¯¹kube-apiserverçš„äº¤äº’è®¿é—®ï¼Œå®ç°å¯¹å„ç±»K8s APIèµ„æºçš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼›\nclient-goä¸ä»…è¢«k8sé¡¹ç›®æœ¬èº«ä½¿ç”¨ï¼ˆå¦‚kubectlï¼‰ï¼Œè¿˜åœ¨åŸºäºk8sçš„äºŒæ¬¡å¼€å‘ä¸­è¢«å¤–éƒ¨ç”¨æˆ·å¹¿æ³›ä½¿ç”¨ï¼šè‡ªå®šä¹‰æ§åˆ¶å™¨ï¼ŒOperatorç­‰ã€‚\nä½¿ç”¨ï¼š\nclient-goåº“æŠ½è±¡å°è£…äº†ä¸k8s reset apiçš„äº¤äº’ï¼Œä¾¿äºå¼€å‘è€…åŸºäºk8såšäºŒæ¬¡å¼€å‘ã€‚åˆ©ç”¨client-goæ“ä½œk8sèµ„æºçš„æµç¨‹åŸºæœ¬å¦‚ä¸‹ï¼š\né€šè¿‡kubeconfigä¿¡æ¯æ„é€ Configå®ä¾‹ï¼Œè¯¥å®ä¾‹è®°å½•äº†é›†ç¾¤è¯ä¹¦ï¼Œk8s apiserveråœ°å€ç­‰ä¿¡æ¯ï¼› æ ¹æ®Configå®ä¾‹æºå¸¦çš„ä¿¡æ¯æ„å»ºç‰¹å®šçš„å®¢æˆ·ç«¯ï¼ˆclientsetï¼Œdynamicsetç­‰ï¼‰ï¼› åˆ©ç”¨å®¢æˆ·ç«¯å‘k8s apiserverå‘èµ·è¯·æ±‚ï¼Œæ“ä½œk8sèµ„æºã€‚ ä»¥ä¸‹æ˜¯ä½¿ç”¨ client-go è·å– pod çš„ä»£ç æ¸…å•ï¼š\nfunc main() { var kubernetes *string if home := homeDir(); home != \u0026#34;\u0026#34; { kubeconfig := flag.String( \u0026#34;kubeconfig\u0026#34;, filePath.Join(home, \u0026#34;.kube\u0026#34;, \u0026#34;config\u0026#34;), \u0026#34;(optional) absolute path to the kubeconfig file\u0026#34;, ) } else { kubeconfig := flag.String(\u0026#34;kubeconfig\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;absolute path to the kubeconfig file\u0026#34;) } flag.Parse() // use the current context in kubeconfig config, err := clientcmd.BuildConfigFromFlags(\u0026#34;\u0026#34;, *kubeconfig) if err != nil { panic(err.Error()) } // create the clientset clientset, err := kubernetes.NewForConfig(config) if err != nil { panic(err.Error()) } for { pods, err := clientset.CoreV1().Pods(\u0026#34;\u0026#34;).List(context.TODO(), metav1.ListOptions{}) if err != nil { panic(err.Error) } // ... } } func homeDir() string { if h := os.Getenv(\u0026#34;HOME\u0026#34;); h != \u0026#34;\u0026#34; { return h } return os.Getenv(\u0026#34;USERPROFILE\u0026#34;) // windows } 2.2.2 client-go ä¸»ä½“ç»“æ„ # client-go æ”¯æŒ 4 ç§ä¸ k8s apiserver äº¤äº’çš„å®¢æˆ·ç«¯ï¼š\nRESTClient # æœ€åŸºç¡€çš„å®¢æˆ·ç«¯ï¼Œä¸»è¦å¯¹ HTTP è¯·æ±‚è¿›è¡Œå°è£…ï¼Œæ”¯æŒ JSON å’Œ Protobuf æ ¼å¼æ•°æ®ï¼›\npackage main import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; corev1 \u0026#34;k8s.io/api/core/v1\u0026#34; metav1 \u0026#34;k8s.io/apimachinery/pkg/apis/meta/v1\u0026#34; \u0026#34;k8s.io/client-go/kubernetes/scheme\u0026#34; \u0026#34;k8s.io/client-go/reset\u0026#34; \u0026#34;k8s.io/client-go/tools/clientcmd\u0026#34; ) func main() { // åŠ è½½é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆconfigå¯¹è±¡ config, err := clientcmd.BuildConfigFromFlags(\u0026#34;\u0026#34;, \u0026#34;/root/.kube/config\u0026#34;) if err != nil { panic(err.Error()) } // é…ç½®APIè·¯å¾„å’Œè¯·æ±‚çš„GV config.APIPath = \u0026#34;api\u0026#34; config.GroupVersion = \u0026amp;corev1.SchemeGroupVersion // é…ç½®æ•°æ®çš„ç¼–è§£ç å™¨ config.NegotiatedSerializer = scheme.Codecs // å®ä¾‹åŒ–RESTClientå¯¹è±¡ restclient, err := rest.RESTClientFor(config) if err != nil { panic(err.Error()) } result := \u0026amp;corev1.PodList{} err = restclient.Get(). Namespace(\u0026#34;default\u0026#34;). Resource(\u0026#34;pods\u0026#34;). VersionedParams(\u0026amp;metav1.ListOptions{Limit: 100}, scheme.ParameterCodec). Do(context.TODO()).Into(result) if err != nil { panic(err.Error) } for _, d := range result.Items { fmt.Printf( \u0026#34;NAMESPACE: %v \\t NAME: %v \\t STATUS: %v\\n\u0026#34;, d.Namespace, d.Name, d.Status.Phase, ) } } Clientset # k8s è‡ªèº«å†…ç½®èµ„æºçš„å®¢æˆ·ç«¯é›†åˆï¼Œä»…èƒ½æ“ä½œå·²çŸ¥ç±»å‹çš„å†…ç½®èµ„æºï¼Œå¦‚ Podï¼ŒService ç­‰ï¼›\npackage main DynamicClient # åŠ¨æ€å®¢æˆ·ç«¯ï¼Œå¯ä»¥å¯¹ä»»æ„k8sèµ„æºæ‰§è¡Œé€šç”¨æ“ä½œï¼ŒåŒ…æ‹¬CRDã€‚\né€šè¿‡åŠ¨æ€æŒ‡å®šGVRæ“ä½œä»»æ„k8sèµ„æºï¼Œä»¥ map[string]interface{} ç»“æ„å­˜å‚¨ k8s apiserver çš„è¿”å›æ•°æ®ï¼Œå†åˆ©ç”¨åå°„æœºåˆ¶åœ¨è¿è¡Œæ—¶è¿›è¡Œæ•°æ®ç»‘å®šã€‚è¿™ç§æ¾è€¦åˆçš„æ–¹å¼æ„å‘³ç€æ›´é«˜çš„çµæ´»æ€§ï¼Œä½†ä¸æ­¤åŒæ—¶ï¼Œä¹Ÿæ— æ³•è·å–å¼ºæ•°æ®ç±»å‹æ£€æŸ¥å’ŒéªŒè¯çš„å¥½å¤„ã€‚\nç†è§£DynamicClientï¼Œä½ å¯èƒ½éœ€è¦å¯¹è¿™ Object.runtime æ¥å£å’Œ Unstructured ç»“æ„ä½“æœ‰æ‰€äº†è§£ï¼š\nObject.runtimeï¼šk8sä¸­æ‰€æœ‰èµ„æºéƒ½å®ç°äº†è¯¥æ¥å£ï¼ŒåŒ…æ‹¬ DeepCopyObject å’Œ GetObjectKind æ–¹æ³•ï¼š Unstructuredï¼šåŒ…å« DiscoveryClient # å‘ç°å®¢æˆ·ç«¯ï¼Œå‘ç°apiserveræ”¯æŒçš„èµ„æºç»„ï¼Œèµ„æºç‰ˆæœ¬å’Œèµ„æºä¿¡æ¯ï¼ˆGVRï¼‰ï¼Œä½¿ç”¨kubectl api-versionså¯ä»¥è·å–æ”¯æŒçš„èµ„æºï¼›\nÂ» æˆ‘çš„ç¬¬ä¸€æœ¬ç®—æ³•ä¹¦\n"},{"id":205,"href":"/reading/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E6%9C%AC%E7%AE%97%E6%B3%95%E4%B9%A6/","title":"æˆ‘çš„ç¬¬ä¸€æœ¬ç®—æ³•ä¹¦","section":"Reading","content":" ğŸ  é¦–é¡µ / é˜…è¯» / æˆ‘çš„ç¬¬ä¸€æœ¬ç®—æ³•ä¹¦\næˆ‘çš„ç¬¬ä¸€æœ¬ç®—æ³•ä¹¦ # ä½œè€…ï¼šçŸ³ç”°ä¿è¾‰ï¼Œå®«å´ä¿®ä¸€\n1. ç®—æ³•çš„åŸºç¡€çŸ¥è¯† # 1.1 ä»€ä¹ˆæ˜¯ç®—æ³• # ç®—æ³•æ˜¯è®¡ç®—æœºè®¡ç®—å’Œè§£å†³é—®é¢˜çš„æ­¥éª¤ã€‚\né€‰æ‹©æ’åºï¼š\nfunc selectionSort(nums []int) []int { for i := 0; i \u0026lt; len(nums); i++ { min := i for j := i + 1; j \u0026lt; len(nums); j++ { if nums[j] \u0026lt; nums[min] { min = j } } nums[i], nums[min] = nums[min], nums[i] } return nums } Â« äº‘åŸç”Ÿåº”ç”¨å¼€å‘ï¼šOperatoråŸç†ä¸å®è·µ\nÂ» æ·±å…¥ç†è§£è®¡ç®—æœºç½‘ç»œ.md\n"},{"id":206,"href":"/reading/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/","title":"æ·±å…¥ç†è§£è®¡ç®—æœºç½‘ç»œ","section":"Reading","content":" ğŸ  é¦–é¡µ / é˜…è¯» / æ·±å…¥ç†è§£è®¡ç®—æœºç½‘ç»œ.md\näºŒè¿›åˆ¶æ•°çš„å››ç§è¡¨ç¤ºæ–¹æ³• # åŸç  # äºŒè¿›åˆ¶æ•°ç¬¬ä¸€ä½ç”¨æ¥è¡¨ç¤ºæ­£è´Ÿç¬¦å·ï¼Œ0 è¡¨ç¤º +ï¼Œ1 è¡¨ç¤º -ã€‚ åŸç å°±æ˜¯å¸¦æ­£è´Ÿç¬¦å·çš„äºŒè¿›åˆ¶æ•°ï¼Œä¾‹å¦‚ï¼Œ+3 åŸç ä¸º 00000011ï¼Œ-3 åŸç ä¸º 10000011ã€‚ åŸç è¡¨ç¤ºæ–¹æ³•ä¸­ï¼Œ0 æœ‰ +0 å’Œ -0 è¡¨ç°å½¢å¼ã€‚\nåç  # è¡¥ç  # åŸç åœ¨åŠ å‡æ³•è¿ç®—ä¸­çš„ä¸ä¾¿ï¼Œ\nç§»ç  # Â« æˆ‘çš„ç¬¬ä¸€æœ¬ç®—æ³•ä¹¦\n"},{"id":207,"href":"/rust/01-getting-started/","title":"01 Getting Started","section":"Rust","content":" ğŸ  é¦–é¡µ / Rust ç¼–ç¨‹ / Rust å…¥é—¨\nRust å…¥é—¨ # å®‰è£… # Linux \u0026amp; Macï¼š\ncurl --proto \u0026#39;=https\u0026#39; --tlsv1.2 https://sh.rustup.rs -sSf | sh ä¸€äº›å¸¸ç”¨çš„ Rust åŒ…ä¾èµ–äº C ä»£ç ï¼Œå› æ­¤å¯èƒ½éœ€è¦é¢å¤–å®‰è£… C ç¼–è¯‘å™¨ï¼Œåœ¨ Mac ä¸Šé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥è·å¾— C ç¼–è¯‘å™¨ï¼š\nxcode-select --install Ubuntu ä¸Šé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥è·å¾— C ç¼–è¯‘å™¨ï¼š\nsudo apt install build-essential Windowsï¼š\nWindows ç”¨æˆ·å¯ä»¥åœ¨ Rust å®˜ç½‘ ä¸‹è½½å®‰è£…ç¨‹åºã€‚\né…ç½®å‘½ä»¤è¡¥å…¨ # ç¬¬ä¸€ç§æ–¹å¼ï¼Œzsh æ·»åŠ  rust æ’ä»¶ï¼š\nvim ~/.zshrc æ‰¾åˆ° plugins é…ç½®ä½ç½®ï¼Œè¿½åŠ  rust:\nplugins=(... rust) ç¬¬äºŒç§æ–¹å¼ï¼š\næŸ¥çœ‹å¸®åŠ©ï¼š\nrustup completions --help ä»¥ Ubuntu ä¸ºä¾‹ï¼Œåˆ›å»ºç›®å½•ï¼š\nmkdir ~/.zfunc åœ¨ .zshrc æ–‡ä»¶ä¸­æ·»åŠ å†…å®¹ï¼š\nfpath+=~/.zfunc autoload -Uz compinit \u0026amp;\u0026amp; compinit ç”Ÿæˆè¡¥å…¨è„šæœ¬ï¼š\nrustup completions zsh \u0026gt; ~/.zfunc/_rustup rustup completions zsh cargo \u0026gt; ~/.zfunc/_cargo æ³¨é”€é‡æ–°ç™»å½•ä»¥ç”Ÿæ•ˆï¼Œæˆ–è€…ç›´æ¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\nexec zsh Hello, World # è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ \u0026ldquo;Hello, World!\u0026rdquo; ç¨‹åºå¼€å§‹ã€‚åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ main.rs å¹¶è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š\nfn main() { println!(\u0026#34;Hello, World!\u0026#34;); } è¦è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œä½¿ç”¨ rustc ç¼–è¯‘å™¨ï¼š\nrustc main.rs \u0026amp;\u0026amp; ./main æ‰§è¡Œåï¼Œä½ åº”è¯¥çœ‹åˆ°è¾“å‡º Hello, World!ã€‚\næ›´æ–° # rustup update å¸è½½ # rustup self uninstall é«˜çº§å§¿åŠ¿ # å®‰è£… rust åï¼ŒæŸ¥çœ‹ä¸€äº›é‡è¦çš„ç›®å½•ï¼š\n# æŸ¥çœ‹æ ¹ç›®å½• rustc --print sysroot # äºŒè¿›åˆ¶ç¨‹åºä½ç½® $(rustcÂ --printÂ sysroot)/bin # æºç ä½ç½® $(rustcÂ --printÂ sysroot)/lib/rustlib/src/ Â» Cargo ç®¡ç†å·¥å…·\n"},{"id":208,"href":"/rust/02-cargo/","title":"02 Cargo","section":"Rust","content":" ğŸ  é¦–é¡µ / Rust ç¼–ç¨‹ / Cargo ç®¡ç†å·¥å…·\nCargo ç®¡ç†å·¥å…· # cargo æ˜¯ Rust çš„æ„å»ºç³»ç»Ÿå’ŒåŒ…ç®¡ç†å™¨ã€‚\né…ç½®å›½å†… rsproxy æº # vim ~/.cargo/config.toml [source.crates-io] replace-with = \u0026#39;rsproxy-sparse\u0026#39; [source.rsproxy] registry = \u0026#34;https://rsproxy.cn/crates.io-index\u0026#34; [source.rsproxy-sparse] registry = \u0026#34;sparse+https://rsproxy.cn/index/\u0026#34; [registries.rsproxy] index = \u0026#34;https://rsproxy.cn/crates.io-index\u0026#34; [net] git-fetch-with-cli = true åˆ›å»ºé¡¹ç›® # cargo new hello-world cd hello-world å¯ä»¥ä½¿ç”¨ cargo new --vcs git hello-world åˆ›å»ºé¡¹ç›®å¹¶åˆå§‹åŒ– git ä»“åº“ï¼Œå®ƒå°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª .gitignore æ–‡ä»¶ã€‚\nç¼–è¯‘é¡¹ç›® # cargo build # ç¼–è¯‘ä¹‹åå°†åœ¨ target/debug ç›®å½•ä¸‹ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ # å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œ ./target/debug/hello-world é»˜è®¤æ„å»ºæ¨¡å¼æ˜¯ debugï¼Œé‡Œé¢åŒ…å«äº†å¤§é‡çš„ç¬¦å·å’Œè°ƒè¯•ä¿¡æ¯ï¼Œä¼˜åŒ–çº§åˆ«ä¸é«˜ã€‚å»ºè®®ä½¿ç”¨ relase æ¨¡å¼æ„å»ºå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒã€‚\nrelease æ¨¡å¼æ„å»ºèŠ±è´¹çš„æ—¶é—´è¾ƒé•¿ï¼Œä½†æ˜¯æ„å»ºå‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ™è¦ç²¾ç®€å¾ˆå¤šã€‚\ncargo build --release è¿è¡Œé¡¹ç›® # cargo run è¿½è¸ª panic ä½ç½®è¿è¡Œï¼š\nRUST_BACKTRACE=1 cargo run åˆ›å»ºç±»åŒ… # cargo new --lib mylib æ£€æµ‹é¡¹ç›®æ˜¯å¦å¯ä»¥ç¼–è¯‘ # cargo check å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæ›´æ–°ï¼‰ # cargo install --path . å¸è½½å¯æ‰§è¡Œæ–‡ä»¶ # cargo uninstall hello-world å‘å¸ƒé¡¹ç›® # å‘å¸ƒåˆ° crates.ioï¼Œéœ€è¦æ³¨å†Œè´¦å·ã€‚\nå¹¶ä¸”ï¼Œéœ€è¦åœ¨ Cargo.toml ä¸­æ·»åŠ éƒ¨åˆ†å†…å®¹ï¼Œä¾‹å¦‚ä½œè€…ã€æè¿°ã€è®¸å¯è¯å¿…è¦ä¿¡æ¯ä»¥åŠå…¶ä»–ä¿¡æ¯ï¼š\n[package] name = \u0026#34;hello-world\u0026#34; version = \u0026#34;0.1.0\u0026#34; edition = \u0026#34;2021\u0026#34; authors = [\u0026#34;Pone Ding \u0026lt;poneding@gmail.com\u0026gt;\u0026#34;] description = \u0026#34;A hello world program in Rust\u0026#34; license = \u0026#34;MIT OR Apache-2.0\u0026#34; readme = \u0026#34;README.md\u0026#34; keywords = [\u0026#34;hello\u0026#34;, \u0026#34;world\u0026#34;] categories = [\u0026#34;hello-world\u0026#34;] cargo publish # å¿½ç•¥æœªæäº¤çš„æ›´æ”¹ cargo publish --allow-dirty ä¾èµ–ç®¡ç† # ä¾èµ–çš„æ¥æº\ncrate.ioï¼šRust å®˜æ–¹ registryï¼ŒåŒ…å«å¤§é‡å¼€æºçš„ Rust åº“ï¼› gitï¼šrust ç‰ˆæœ¬çš„ git ä»“åº“ï¼Œé€‚ç”¨äºæœªå‘å¸ƒæˆ–è€…å¼€å‘é˜¶æ®µï¼› local crateï¼šæœ¬åœ° rust åº“ï¼Œå¯ç”¨äºè°ƒè¯•ã€‚ ç‰ˆæœ¬æ ¼å¼ # ä¾èµ–çš„ç‰ˆæœ¬èŒƒå›´è§„åˆ™å‚è€ƒå¦‚ä¸‹ï¼ŒåŸºäºè¿™æ ·çš„è§„åˆ™ï¼Œrust ä¼šä½¿ç”¨ç‰ˆæœ¬èŒƒå›´å†…æœ€å¤§ç‰ˆæœ¬å·ä½œä¸ºä¾èµ–çš„æœ€ç»ˆç‰ˆæœ¬ï¼Œä¾‹å¦‚å¦‚æœå®šä¹‰ç‰ˆæœ¬ä¸º some_crateÂ =Â \u0026quot;1.2.3\u0026quot; ä½†æ˜¯ some_crate å½“å‰æœ€é«˜ç‰ˆæœ¬ä¸º 1.8.9ï¼Œé‚£ä¹ˆ Cargo ä¼šè‡ªåŠ¨ä½¿ç”¨ Â·1.8.9Â· ç‰ˆæœ¬ä½œä¸ºä¾èµ–ã€‚\n[dependencies] some_crateÂ =Â \u0026#34;1.2.3\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[1.2.3, 2.0.0) some_crateÂ =Â \u0026#34;1.2\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[1.2.0, 2.0.0) some_crateÂ =Â \u0026#34;1\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[1.0.0, 2.0.0) some_crateÂ =Â \u0026#34;0.2.3\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[0.2.3, 0.3.0) some_crateÂ =Â \u0026#34;0.2\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[0.2.0, 0.3.0) some_crateÂ =Â \u0026#34;0\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[0.0.0, 1.0.0) some_crateÂ =Â \u0026#34;0.0\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[0.0.0, 0.1.0) some_crateÂ =Â \u0026#34;0.0.3\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[0.0.3, 0.0.4) some_crateÂ =Â \u0026#34;^1.2.3\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[1.2.3] some_crateÂ =Â \u0026#34;~1.2.3\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[1.2.3, 1.3.0) some_crateÂ =Â \u0026#34;~1.2\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[1.2.0, 1.3.0) some_crateÂ =Â \u0026#34;~1\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[1.0.0, 2.0.0) some_crateÂ =Â \u0026#34;*\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[0.0.0, ) some_crateÂ =Â \u0026#34;1.*\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[1.0.0, 2.0.0) some_crateÂ =Â \u0026#34;1.2.*\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[1.2.0, 1.3.0) some_crateÂ =Â \u0026#34;\u0026gt;=1.2,Â \u0026lt;Â 1.5\u0026#34;Â =\u0026gt;Â ç‰ˆæœ¬èŒƒå›´[1.2.0, 1.5.0) ä½¿ç”¨åˆ«åå¼•å…¥ä¸¤ä¸ªç‰ˆæœ¬ä¸åŒçš„åº“ï¼š\n[dependencies] some_crate_v1 = { version = \u0026#34;1.0.0\u0026#34;, package = \u0026#34;rand\u0026#34; } some_crate_v2 = { version = \u0026#34;2.0.0\u0026#34;, package = \u0026#34;rand\u0026#34; } æ·»åŠ ä¾èµ– # cargo add rand cargo add hello-world # æ·»åŠ ä¾èµ–å¹¶ä½¿ç”¨ features cargo add serde --features derive,serde_derive # æ·»åŠ  git ä»“åº“ä¾èµ–ï¼ŒCargo.toml ä¾èµ–ä¿¡æ¯ä¸­ä¼šåŒ…å« git åœ°å€ cargo add myrlib --git https://github.com/poneding/myrlib.git # æ·»åŠ æœ¬åœ°ä¾èµ– cargo add hello-world --path ../hello-world ä¾èµ–å¤–éƒ¨ç±»åº“ä»¥åŠå¼•ç”¨ï¼š\nCargo.toml:\n... [dependencies] rand = \u0026#34;0.8.5\u0026#34; main.rs:\nexternÂ crateÂ rand; useÂ rand::Rng; ä¾èµ–å†…éƒ¨ç±»åº“ä»¥åŠå¼•ç”¨ï¼š\nCargo.toml:\n... [dependencies] hello_lib = { path = \u0026#34;../hello_lib\u0026#34; } main.rs:\nexternÂ crateÂ hello_lib; æ›´æ–°ä¾èµ– # # æ›´æ–°æ‰€æœ‰ä¾èµ– cargo update # æ›´æ–°æŒ‡å®šä¾èµ– cargo update rand ç§»é™¤ä¾èµ– # cargo rm rand æ¸…é™¤ç¼–è¯‘ # cargo clean ç”Ÿæˆæ–‡æ¡£ # cargo doc æµ‹è¯• # cargo test workspace # ç›®å‰éœ€è¦æ‰‹åŠ¨åœ¨ workspace ç›®å½•ä¸‹åˆ›å»º Cargo.toml æ–‡ä»¶ã€‚\nvim Cargo.toml [workspace] resolver = \u0026#34;2\u0026#34; members = [ \u0026#34;hello_world\u0026#34;, \u0026#34;hello_lib\u0026#34;, ] æ£€æŸ¥ workspace ä¸‹ç¼–è¯‘ï¼š\ncargo check --workspace æ„å»º\n# æ„å»ºæ‰€æœ‰å·¥ä½œåŒºæˆå‘˜ cargo build # æ„å»ºå•ä¸ªå·¥ä½œåŒºæˆå‘˜ cargo build -p hello_world Â« Rust å…¥é—¨\nÂ» VSCode è°ƒè¯•\n"},{"id":209,"href":"/rust/03-vscode-debugging/","title":"03 Vscode Debugging","section":"Rust","content":" ğŸ  é¦–é¡µ / Rust ç¼–ç¨‹ / VSCode è°ƒè¯•\nVSCode è°ƒè¯• # 1. å®‰è£…æ’ä»¶ # CodeLLDB rust-analyzer 2. é…ç½® # é¡¹ç›®æ ¹ç›®å½•é…ç½® .vscode/launch.jsonï¼Œè°ƒè¯•è¿è¡Œæ—¶æ‰“å¼€ main.rs æ–‡ä»¶ã€‚\n{ \u0026#34;version\u0026#34;: \u0026#34;0.2.0\u0026#34;, \u0026#34;configurations\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;lldb\u0026#34;, \u0026#34;request\u0026#34;: \u0026#34;launch\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Debug Rust Project\u0026#34;, \u0026#34;cargo\u0026#34;: { \u0026#34;args\u0026#34;: [ \u0026#34;build\u0026#34;, \u0026#34;--target-dir=${fileDirname}/../target\u0026#34;, \u0026#34;--manifest-path=${fileDirname}/../Cargo.toml\u0026#34; ] }, \u0026#34;args\u0026#34;: [], \u0026#34;cwd\u0026#34;: \u0026#34;${workspaceFolder}\u0026#34; }, { \u0026#34;type\u0026#34;: \u0026#34;lldb\u0026#34;, \u0026#34;request\u0026#34;: \u0026#34;launch\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Debug Rust Unit Tests\u0026#34;, \u0026#34;cargo\u0026#34;: { \u0026#34;args\u0026#34;: [ \u0026#34;test\u0026#34;, \u0026#34;--no-run\u0026#34;, \u0026#34;--target-dir=${fileDirname}/../target\u0026#34;, \u0026#34;--manifest-path=${fileDirname}/../Cargo.toml\u0026#34; ] }, \u0026#34;args\u0026#34;: [], \u0026#34;cwd\u0026#34;: \u0026#34;${workspaceFolder}\u0026#34; } ] } æ”¯æŒ Wrokspace ä¸‹å¤š Rust é¡¹ç›®è°ƒè¯•ã€‚\nÂ« Cargo ç®¡ç†å·¥å…·\nÂ» Rust WASM ç¼–ç¨‹\n"},{"id":210,"href":"/rust/04-wasm-programming/","title":"04 Wasm Programming","section":"Rust","content":" ğŸ  é¦–é¡µ / Rust ç¼–ç¨‹ / Rust WASM ç¼–ç¨‹\nRust WASM ç¼–ç¨‹ # 1. åˆå§‹åŒ–é¡¹ç›® # cargo new hello-wasm cd hello-wasm 2. å®‰è£… wasm-pack # cargo install wasm-pack 3. ç¼–å†™ä»£ç  # ç¼–è¾‘ src/main.rs æ–‡ä»¶ï¼š\n// ä½¿ç”¨ wasm-bindgen åœ¨ Rust ä¸ JavaScript ä¹‹é—´é€šä¿¡ extern crate wasm_bindgen; use wasm_bindgen::prelude::*; #[wasm_bindgen] extern { pub fn alert(s: \u0026amp;str); } #[wasm_bindgen] pub fn greet(name: \u0026amp;str){ alert(\u0026amp;format!(\u0026#34;Hello, {}!\u0026#34;,name)); } ç¼–è¾‘ Cargo.toml æ–‡ä»¶ï¼š\n[package] name = \u0026#34;hello-wasm\u0026#34; version = \u0026#34;0.1.0\u0026#34; edition = \u0026#34;2021\u0026#34; authors = [\u0026#34;Pone Ding \u0026lt;poneding@gmail.com\u0026gt;\u0026#34;] description = \u0026#34;A sample project with wasm-pack\u0026#34; license = \u0026#34;MIT/Apache-2.0\u0026#34; repository = \u0026#34;https://github.com/poneding/hello-wasm\u0026#34; [lib] crate-type = [\u0026#34;cdylib\u0026#34;] [dependencies] wasm-bindgen = \u0026#34;0.2\u0026#34; 4. æ„å»ºé¡¹ç›® # wasm-pack build --scope [npm-username] Â« VSCode è°ƒè¯•\nÂ» String è¿˜æ˜¯ \u0026amp;str\n"},{"id":211,"href":"/rust/","title":"Rust","section":"","content":" ğŸ  é¦–é¡µ / Rust ç¼–ç¨‹\nRust ç¼–ç¨‹ # Rust å…¥é—¨\nCargo ç®¡ç†å·¥å…·\nVSCode è°ƒè¯•\nRust WASM ç¼–ç¨‹\nString è¿˜æ˜¯ \u0026amp;str\n"},{"id":212,"href":"/rust/rust-pin-unpin/","title":"Rust Pin Unpin","section":"Rust","content":" Rust Pin å’Œ Unpin # Pin å’Œ Unpin æ˜¯ Rust å¼‚æ­¥ç¼–ç¨‹ä¸­çš„æ¦‚å¿µã€‚\nRust ä¸­çš„ç±»å‹å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š\nç±»å‹çš„å€¼å¯ä»¥åœ¨å†…å­˜ä¸­å®‰å…¨çš„ç§»åŠ¨ï¼šç»å¤§å¤šæ•°çš„ç±»å‹ è‡ªå¼•ç”¨ç±»å‹ è‡ªå¼•ç”¨ç±»å‹ç¤ºä¾‹ï¼š\n"},{"id":213,"href":"/rust/string-str/","title":"String \u0026Str","section":"Rust","content":" ğŸ  é¦–é¡µ / Rust ç¼–ç¨‹ / String è¿˜æ˜¯ \u0026amp;str\nString è¿˜æ˜¯ \u0026amp;str # å¥½ç”¨çš„è§„åˆ™ï¼š\nå§‹ç»ˆåœ¨ç»“æ„ä½“ä¸­ä½¿ç”¨ Stringï¼› å‡½æ•°å…¥å‚ä½¿ç”¨ \u0026amp;strï¼Œå‡½æ•°å‡ºå‚ä½¿ç”¨ Stringï¼› å¦‚æœå‡½æ•°å‡ºå‚æ¥æºäºå…¥å‚ï¼Œå¹¶ä¸”å‡½æ•°ä¸­æ²¡æœ‰æ”¹å˜å…¥å‚ï¼Œé‚£ä¹ˆå‡ºå‚ä½¿ç”¨ \u0026amp;strã€‚ éµå¾ªä»¥ä¸Šçš„è§„åˆ™ï¼Œå¤§éƒ¨åˆ†åœºæ™¯ä½ å°†å¾ˆå¥½çš„é¿å¼€ String \u0026amp;str ä½¿ç”¨å›°éš¾ï¼Œå³ä½¿æœ‰é—®é¢˜ï¼Œç¼–è¯‘å™¨ä¼šå‘ŠçŸ¥ä½ é—®é¢˜æ‰€åœ¨ã€‚\nÂ« Rust WASM ç¼–ç¨‹\n"},{"id":214,"href":"/solutions/","title":"Solutions","section":"","content":" ğŸ  é¦–é¡µ / solutions\nsolutions # dbeaver-password.md\nMacOS åˆ é™¤å¾ˆæ…¢\nvscode-terminal-chinese.md\n"},{"id":215,"href":"/solutions/dbeaver-password/","title":"Dbeaver Password","section":"Solutions","content":" ğŸ  é¦–é¡µ / solutions / dbeaver-password.md\næŸ¥çœ‹ dbeaver å·²ä¿å­˜çš„æ•°æ®åº“å¯†ç ï¼š\n1ã€è·å–å·¥ä½œç©ºé—´è·¯å¾„\n2ã€ä½¿ç”¨å·¥ä½œç©ºé—´è·¯å¾„ï¼ŒæŸ¥æ‰¾åˆ°æ•°æ®åº“è¿æ¥è®¤è¯ä¿¡æ¯æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š/Users/dp/Library/DBeaverData/workspace6/General/.dbeaver/credentials-config.json\n3ã€ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è§£æå¯†ç ï¼š\nopenssl aes-128-cbc -d \\ -K babb4a9f774ab853c96c2d653dfe544a \\ -iv 00000000000000000000000000000000 \\ -in /Users/dp/Library/DBeaverData/workspace6/General/.dbeaver/credentials-config.json | dd bs=1 skip=16 2\u0026gt;/dev/null Â» MacOS åˆ é™¤å¾ˆæ…¢\n"},{"id":216,"href":"/solutions/macos-slow-delete/","title":"Macos Slow Delete","section":"Solutions","content":" ğŸ  é¦–é¡µ / solutions / MacOS åˆ é™¤å¾ˆæ…¢\nMacOS åˆ é™¤å¾ˆæ…¢ # å½“æˆ‘ä»¬åœ¨ MacOS ä¸Šåˆ é™¤æ–‡å­—æ—¶ï¼Œä¼šè§‰å¾—åˆ é™¤çš„é€Ÿåº¦å¾ˆæ…¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹è®¾ç½®è§£å†³ï¼š\nç³»ç»Ÿè®¾ç½® =\u0026gt; é”®ç›˜ =\u0026gt; é”®é‡å¤é€Ÿç‡è°ƒè‡³æœ€å¿«ï¼Œé‡å¤å‰å»¶è¿Ÿè°ƒè‡³æœ€çŸ­ã€‚\nÂ« dbeaver-password.md\nÂ» vscode-terminal-chinese.md\n"},{"id":217,"href":"/solutions/vscode-terminal-chinese/","title":"Vscode Terminal Chinese","section":"Solutions","content":" ğŸ  é¦–é¡µ / qa / vscode-terminal-chinese.md\næŸ¥çœ‹é…ç½®ï¼Œeditor.accessibilitySupportï¼Œå¦‚æœå‘ç°é…ç½®ä¸º onï¼Œé‚£ä¹ˆåˆ‡æ¢ä¸º auto å³å¯ã€‚\nÂ« dbeaver-password.md\n"}]