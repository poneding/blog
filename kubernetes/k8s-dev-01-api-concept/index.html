<!doctype html><html lang=cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ğŸ  é¦–é¡µ / Kubernetes / Kubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ
Kubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ # åœ¨ K8s é›†ç¾¤ä¸­ï¼ŒAPI æ˜¯ä¸€åˆ‡çš„åŸºç¡€ï¼ŒK8s çš„æ‰€æœ‰èµ„æºå¯¹è±¡éƒ½æ˜¯é€šè¿‡ API æ¥ç®¡ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®šåˆ¶å¼€å‘çš„æ—¶å€™ï¼Œé¦–å…ˆè¦äº†è§£ K8s çš„ API æ¦‚å¿µã€‚
åŸºæœ¬æ¦‚å¿µ # Groupï¼ˆGï¼‰ï¼š
API ç»„ï¼Œä¾‹å¦‚ï¼šappsã€networking.k8s.io ç­‰
Versionï¼ˆVï¼‰ï¼š
API ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼šv1alpha1ã€v1ã€v2 ç­‰
Resourceï¼ˆRï¼‰ï¼š
API èµ„æºï¼Œä¾‹å¦‚ï¼špodsï¼Œconfigmaps ç­‰
Kindï¼ˆKï¼‰ï¼š
API ç±»å‹ï¼Œä¾‹å¦‚ï¼šDeploymentï¼ŒService ç­‰ é€šè¿‡ kubectl api-versions è·å–é›†ç¾¤ä¸­æ‰€æœ‰ API çš„ç‰ˆæœ¬åˆ—è¡¨ï¼š
$ kubectl api-versions acme.cert-manager.io/v1 admissionregistration.k8s.io/v1 apiextensions.k8s.io/v1 apiregistration.k8s.io/v1 apps/v1 authentication.k8s.io/v1 é€šè¿‡ kubectl api-resources å‘½ä»¤è·å–é›†ç¾¤æ‰€æœ‰ API çš„èµ„æºåˆ—è¡¨ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°èµ„æºçš„ç®€å†™åç§°ï¼Œç‰ˆæœ¬ä»¥åŠç±»å‹ï¼š
$ kubectl api-resources NAME SHORTNAMES APIVERSION NAMESPACED KIND bindings v1 true Binding componentstatuses cs v1 false ComponentStatus configmaps cm v1 true ConfigMap endpoints ep v1 true Endpoints events ev v1 true Event limitranges limits v1 true LimitRange namespaces ns v1 false Namespace nodes no v1 false Node API èµ„æºç«¯ç‚¹ # GVR ç«¯ç‚¹ï¼š"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://blog.poneding.com/kubernetes/k8s-dev-01-api-concept/"><meta property="og:site_name" content="ç§‹æ²³è½å¶"><meta property="og:title" content="ç§‹æ²³è½å¶"><meta property="og:description" content="ğŸ  é¦–é¡µ / Kubernetes / Kubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ
Kubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ # åœ¨ K8s é›†ç¾¤ä¸­ï¼ŒAPI æ˜¯ä¸€åˆ‡çš„åŸºç¡€ï¼ŒK8s çš„æ‰€æœ‰èµ„æºå¯¹è±¡éƒ½æ˜¯é€šè¿‡ API æ¥ç®¡ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®šåˆ¶å¼€å‘çš„æ—¶å€™ï¼Œé¦–å…ˆè¦äº†è§£ K8s çš„ API æ¦‚å¿µã€‚
åŸºæœ¬æ¦‚å¿µ # Groupï¼ˆGï¼‰ï¼š
API ç»„ï¼Œä¾‹å¦‚ï¼šappsã€networking.k8s.io ç­‰
Versionï¼ˆVï¼‰ï¼š
API ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼šv1alpha1ã€v1ã€v2 ç­‰
Resourceï¼ˆRï¼‰ï¼š
API èµ„æºï¼Œä¾‹å¦‚ï¼špodsï¼Œconfigmaps ç­‰
Kindï¼ˆKï¼‰ï¼š
API ç±»å‹ï¼Œä¾‹å¦‚ï¼šDeploymentï¼ŒService ç­‰ é€šè¿‡ kubectl api-versions è·å–é›†ç¾¤ä¸­æ‰€æœ‰ API çš„ç‰ˆæœ¬åˆ—è¡¨ï¼š
$ kubectl api-versions acme.cert-manager.io/v1 admissionregistration.k8s.io/v1 apiextensions.k8s.io/v1 apiregistration.k8s.io/v1 apps/v1 authentication.k8s.io/v1 é€šè¿‡ kubectl api-resources å‘½ä»¤è·å–é›†ç¾¤æ‰€æœ‰ API çš„èµ„æºåˆ—è¡¨ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°èµ„æºçš„ç®€å†™åç§°ï¼Œç‰ˆæœ¬ä»¥åŠç±»å‹ï¼š
$ kubectl api-resources NAME SHORTNAMES APIVERSION NAMESPACED KIND bindings v1 true Binding componentstatuses cs v1 false ComponentStatus configmaps cm v1 true ConfigMap endpoints ep v1 true Endpoints events ev v1 true Event limitranges limits v1 true LimitRange namespaces ns v1 false Namespace nodes no v1 false Node API èµ„æºç«¯ç‚¹ # GVR ç«¯ç‚¹ï¼š"><meta property="og:locale" content="cn"><meta property="og:type" content="article"><meta property="article:section" content="kubernetes"><meta property="article:modified_time" content="2024-06-13T15:37:18+08:00"><title>K8s Dev 01 API Concept | ç§‹æ²³è½å¶</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/logo.png><link rel=canonical href=https://blog.poneding.com/kubernetes/k8s-dev-01-api-concept/><link rel=stylesheet href=/book.min.4964903a822a7acb10dac6d1ab524833c97fb5f99b141976bcb8a47d539be9c0.css integrity="sha256-SWSQOoIqessQ2sbRq1JIM8l/tfmbFBl2vLikfVOb6cA=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/cn.search.min.8d45e130fd4c0db67414daf87640a1178f4db2612dc2ec10408eb474a34b4c25.js integrity="sha256-jUXhMP1MDbZ0FNr4dkChF49NsmEtwuwQQI60dKNLTCU=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><link rel=stylesheet href=/css/syntax.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>ç§‹æ²³è½å¶</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=æœç´¢ aria-label=æœç´¢ maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><p>ğŸ¦‰ é›†ä¸­èµ·æ¥çš„æ„å¿—å¯ä»¥å‡»ç©¿é¡½çŸ³ã€‚</p><hr><ul><li><p><a href=/><strong>ğŸ  é¦–é¡µ</strong></a></p></li><li><p><strong>ğŸ“Œ ç½®é¡¶æ–‡ç« </strong></p><ul><li><a href=/git/common-usage/>Git å¸¸ç”¨</a></li><li><a href=/kubernetes/kubeadm-install-k8s-docker/>å®‰è£… Kubernetes (Docker)</a></li></ul></li><li><p><strong>ğŸ“Œ ç½®é¡¶åˆ†ç±»</strong></p><ul><li><a href=/go/>Golang ç¼–ç¨‹</a></li><li><a href=/kubernetes/>Kubernetes</a></li><li><a href=/rust/>Rust ç¼–ç¨‹</a></li><li><a href=/git/>Git</a></li></ul></li></ul><hr><ul><li><strong>ğŸ—ƒï¸ å¼€æºé¡¹ç›®</strong><ul><li><a href=https://github.com/ketches/registry-proxy>registry-proxy</a></li><li><a href=https://github.com/poneding/mdi>mdi</a></li></ul></li></ul><hr><ul><li><a href=https://github.com/poneding target=_blank rel=noopener>ğŸ™ GitHub</a></li><li><a href=mailto:poneding@gmail.com target=_blank rel=noopener>ğŸ“¬ é‚®ç®±</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>K8s Dev 01 API Concept</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#åŸºæœ¬æ¦‚å¿µ>åŸºæœ¬æ¦‚å¿µ</a></li><li><a href=#api-èµ„æºç«¯ç‚¹>API èµ„æºç«¯ç‚¹</a></li><li><a href=#apiservice>APIService</a></li><li><a href=#åˆ›å»ºä¸€ä¸ª-crd>åˆ›å»ºä¸€ä¸ª CRD</a><ul><li><a href=#openapi>OpenAPI</a></li></ul></li><li><a href=#å‚è€ƒ>å‚è€ƒ</a></li></ul></nav></aside></header><article class="markdown book-article"><p><a href=/>ğŸ  é¦–é¡µ</a> /
<a href=/kubernetes/>Kubernetes</a> / Kubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ</p><h1 id=kubernetes-å®šåˆ¶å¼€å‘-01k8s-api-æ¦‚å¿µ>Kubernetes å®šåˆ¶å¼€å‘ 01ï¼šK8s API æ¦‚å¿µ
<a class=anchor href=#kubernetes-%e5%ae%9a%e5%88%b6%e5%bc%80%e5%8f%91-01k8s-api-%e6%a6%82%e5%bf%b5>#</a></h1><p>åœ¨ K8s é›†ç¾¤ä¸­ï¼ŒAPI æ˜¯ä¸€åˆ‡çš„åŸºç¡€ï¼ŒK8s çš„æ‰€æœ‰èµ„æºå¯¹è±¡éƒ½æ˜¯é€šè¿‡ API æ¥ç®¡ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®šåˆ¶å¼€å‘çš„æ—¶å€™ï¼Œé¦–å…ˆè¦äº†è§£ K8s çš„ API æ¦‚å¿µã€‚</p><h2 id=åŸºæœ¬æ¦‚å¿µ>åŸºæœ¬æ¦‚å¿µ
<a class=anchor href=#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5>#</a></h2><p><strong>Groupï¼ˆGï¼‰</strong>ï¼š</p><p>API ç»„ï¼Œä¾‹å¦‚ï¼š<code>apps</code>ã€<code>networking.k8s.io</code> ç­‰</p><p><strong>Versionï¼ˆVï¼‰</strong>ï¼š</p><p>API ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼š<code>v1alpha1</code>ã€<code>v1</code>ã€<code>v2</code> ç­‰</p><p><strong>Resourceï¼ˆRï¼‰</strong>ï¼š</p><p>API èµ„æºï¼Œä¾‹å¦‚ï¼š<code>pods</code>ï¼Œ<code>configmaps</code> ç­‰</p><p><strong>Kindï¼ˆKï¼‰</strong>ï¼š</p><p>API ç±»å‹ï¼Œä¾‹å¦‚ï¼šDeploymentï¼ŒService ç­‰
é€šè¿‡ <code>kubectl api-versions</code> è·å–é›†ç¾¤ä¸­æ‰€æœ‰ API çš„ç‰ˆæœ¬åˆ—è¡¨ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl api-versions
</span></span><span class=line><span class=cl>acme.cert-manager.io/v1
</span></span><span class=line><span class=cl>admissionregistration.k8s.io/v1
</span></span><span class=line><span class=cl>apiextensions.k8s.io/v1
</span></span><span class=line><span class=cl>apiregistration.k8s.io/v1
</span></span><span class=line><span class=cl>apps/v1
</span></span><span class=line><span class=cl>authentication.k8s.io/v1
</span></span></code></pre></div><p>é€šè¿‡ <code>kubectl api-resources</code> å‘½ä»¤è·å–é›†ç¾¤æ‰€æœ‰ API çš„èµ„æºåˆ—è¡¨ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°èµ„æºçš„ç®€å†™åç§°ï¼Œç‰ˆæœ¬ä»¥åŠç±»å‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl api-resources
</span></span><span class=line><span class=cl>NAME                              SHORTNAMES   APIVERSION                             NAMESPACED   KIND
</span></span><span class=line><span class=cl>bindings                                       v1                                     <span class=nb>true</span>         Binding
</span></span><span class=line><span class=cl>componentstatuses                 cs           v1                                     <span class=nb>false</span>        ComponentStatus
</span></span><span class=line><span class=cl>configmaps                        cm           v1                                     <span class=nb>true</span>         ConfigMap
</span></span><span class=line><span class=cl>endpoints                         ep           v1                                     <span class=nb>true</span>         Endpoints
</span></span><span class=line><span class=cl>events                            ev           v1                                     <span class=nb>true</span>         Event
</span></span><span class=line><span class=cl>limitranges                       limits       v1                                     <span class=nb>true</span>         LimitRange
</span></span><span class=line><span class=cl>namespaces                        ns           v1                                     <span class=nb>false</span>        Namespace
</span></span><span class=line><span class=cl>nodes                             no           v1                                     <span class=nb>false</span>        Node
</span></span></code></pre></div><h2 id=api-èµ„æºç«¯ç‚¹>API èµ„æºç«¯ç‚¹
<a class=anchor href=#api-%e8%b5%84%e6%ba%90%e7%ab%af%e7%82%b9>#</a></h2><p>GVR ç«¯ç‚¹ï¼š</p><ul><li><code>/api</code>ï¼Œåªä¼šè·å–åˆ° v1 çš„ APIVersionï¼ˆç»„åä¸ºç©ºï¼‰</li><li><code>/apis</code>ï¼Œè·å–åˆ°æ‰€æœ‰éæ ¸å¿ƒ API çš„ APIGroupList</li><li><code>/api/v1</code>ï¼Œè·å–åˆ° APIResourceList</li><li><code>/apis/{g}/</code>ï¼Œè·å–åˆ° APIGroup</li><li><code>/apis/{g}/v1</code>ï¼Œè·å–åˆ° APIResourceList</li></ul><p>å‘½åç©ºé—´èµ„æºç«¯ç‚¹ï¼š</p><ul><li>æ ¸å¿ƒ apiï¼š<code>/api/{v}/namespaces/{ns}/{r}</code>ï¼Œä¾‹å¦‚ï¼š/api/v1/namespaces/default/configmaps</li><li>å…¶ä»– apiï¼š<code>/apis/{g}/{v}/namespaces/{ns}/{r}</code>ï¼Œä¾‹å¦‚ï¼šapis/apps/v1/namespaces/default/deployments</li></ul><p>é›†ç¾¤èµ„æºç«¯ç‚¹ï¼š</p><ul><li>æ ¸å¿ƒ apiï¼š<code>/api/{v}/{r}</code>ï¼Œä¾‹å¦‚ï¼š/api/v1/nodes</li><li>å…¶ä»–èµ„æºï¼š<code>/apis/{g}/{v}/{r}</code>ï¼Œä¾‹å¦‚ï¼š/apis/rbac.authorization.k8s.io/v1/clusterroles</li></ul><p>åœ¨ä½¿ç”¨ <code>kubectl get</code> å‘½ä»¤è·å–é›†ç¾¤èµ„æºå®ä¾‹æ—¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  <code>-v 6</code> æŸ¥çœ‹æ‰§è¡Œå‘½ä»¤çš„è¯·æ±‚ç«¯ç‚¹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ k get nodes -v <span class=m>6</span>
</span></span><span class=line><span class=cl>I0915 11:32:43.715795   <span class=m>18197</span> loader.go:373<span class=o>]</span> Config loaded from file:  /Users/dp/.kube/config
</span></span><span class=line><span class=cl>I0915 11:32:43.855325   <span class=m>18197</span> round_trippers.go:553<span class=o>]</span> GET https://127.0.01:6443/api/v1/nodes?limit<span class=o>=</span><span class=m>500</span> <span class=m>200</span> OK in <span class=m>135</span> milliseconds
</span></span><span class=line><span class=cl>NAME    STATUS   ROLES           AGE    VERSION
</span></span><span class=line><span class=cl><span class=nb>local</span>   Ready    control-plane   115d   v1.27.2
</span></span></code></pre></div><h2 id=apiservice>APIService
<a class=anchor href=#apiservice>#</a></h2><p>æ¯ä¸ª API ç‰ˆæœ¬éƒ½å¯¹åº”ä¸€ä¸ª APIServiceï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ k api-versions <span class=p>|</span> wc -l
</span></span><span class=line><span class=cl>  <span class=m>30</span>
</span></span><span class=line><span class=cl>$ k get apiservices.apiregistration.k8s.io<span class=p>|</span> wc -l
</span></span><span class=line><span class=cl>  <span class=m>30</span>
</span></span></code></pre></div><h2 id=åˆ›å»ºä¸€ä¸ª-crd>åˆ›å»ºä¸€ä¸ª CRD
<a class=anchor href=#%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa-crd>#</a></h2><p><em>foo-crd.yaml</em>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apiextensions.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>CustomResourceDefinition</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># å›ºå®šæ ¼å¼ {kind_plural}.{group}ï¼Œå…¶ä¸­ foos å¯¹åº” spec.names.pluralï¼Œplay.ketches.io å¯¹åº” spec.group</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>foos.play.ketches.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>play.ketches.io</span><span class=w> </span><span class=c># èµ„æºç»„ï¼Œç”¨åœ¨ URL æ ‡è¯†èµ„æºæ‰€å± Groupï¼Œå¦‚ /apis/play.ketches.io/v1/foos ä¹‹ foos.play.ketches.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>names</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Foo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>listKind</span><span class=p>:</span><span class=w> </span><span class=l>FooList</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>plural</span><span class=p>:</span><span class=w> </span><span class=l>foos </span><span class=w> </span><span class=c># èµ„æºåå¤æ•°ï¼Œç”¨åœ¨ URL æ ‡è¯†èµ„æºç±»å‹ï¼Œå¦‚ /apis/play.ketches.io/v1/foos ä¹‹ foos</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>singular</span><span class=p>:</span><span class=w> </span><span class=l>foo</span><span class=w> </span><span class=c># èµ„æºåå•æ•°ï¼Œå¯ç”¨äº kubectl åŒ¹é…èµ„æº</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>shortNames</span><span class=p>:</span><span class=w>   </span><span class=c># èµ„æºç®€ç§°ï¼Œå¯ç”¨äº kubectl åŒ¹é…èµ„æº</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>fo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scope</span><span class=p>:</span><span class=w> </span><span class=l>Namespaced</span><span class=w> </span><span class=c># Namespaced/Cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>versions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>served</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=c># æ˜¯å¦å¯ç”¨è¯¥ç‰ˆæœ¬ï¼Œå¯ä½¿ç”¨è¯¥æ ‡è¯†å¯åŠ¨/ç¦ç”¨è¯¥ç‰ˆæœ¬ API</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=c># å”¯ä¸€è½å­˜å‚¨ç‰ˆæœ¬ï¼Œå¦‚æœ CRD å«æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œåªèƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬è¢«æ ‡è¯†ä¸º true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>schema</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>openAPIV3Schema</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>object</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>properties</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>object</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>required</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;msg&#34;</span><span class=p>]</span><span class=w> </span><span class=c># å¿…é¡»èµ‹å€¼</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>properties</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>msg</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>maxLength</span><span class=p>:</span><span class=w> </span><span class=m>6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>additionalPrinterColumns</span><span class=p>:</span><span class=w> </span><span class=c># å£°æ˜ kubectl get è¾“å‡ºåˆ—ï¼Œé»˜è®¤åœ¨ name åˆ—ä¹‹å¤–é¢å¤–è¾“å‡º age åˆ—ï¼Œæ”¹ä¸ºé¢å¤–è¾“å‡º age åˆ—ï¼Œmessage åˆ—</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>age</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>jsonPath</span><span class=p>:</span><span class=w> </span><span class=l>.metadata.creationTimestamp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>message</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>jsonPath</span><span class=p>:</span><span class=w> </span><span class=l>.spec.msg</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span></code></pre></div><p>è·å– CRD å¯¹åº”çš„ APIServiceï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~ k get apiservices.apiregistration.k8s.io v1.play.ketches.io
</span></span><span class=line><span class=cl>NAME                 SERVICE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>v1.play.ketches.io   Local     True        3h26m
</span></span></code></pre></div><p>ä¸€èˆ¬è¿™æ—¶å€™ SERVICE ä¸º Localï¼Œè¡¨ç¤º å¯¹è¯¥èµ„æºçš„ APIService è¯·æ±‚ä¼šåœ¨æœ¬åœ°å¤„ç†ï¼Œä¹Ÿå°±æ˜¯ kube-apiserver å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ”¹ä¸ºä¸€ä¸ªåœ¨é›†ç¾¤ä¸­è¿è¡Œçš„ Service åï¼Œä¾‹å¦‚ï¼šdefault/play-v1-svcã€‚ä½ éœ€è¦ä¿®æ”¹ APIService çš„å£°æ˜ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apiregistration.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>APIService</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kube-aggregator.kubernetes.io/automanaged</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>v1.play.ketches.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>play.ketches.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>groupPriorityMinimum</span><span class=p>:</span><span class=w> </span><span class=m>1000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>versionPriority</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>play-v1-svc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>insecureSkipTLSVerify</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><p>è¿™æ—¶å€™å¯¹ <code>play.ketches.io/v1</code> ç»„ä¸‹çš„èµ„æºçš„è¯·æ±‚å¤„ç†ä¼šäº¤ç»™è¯¥æœåŠ¡ã€‚
å³ï¼š<code>/apis/play.ketches.io/v1/namespaces/{ns}/foos/*</code> => <code>default/play-v1-svc</code>ï¼Œå…¶å®è¿™å°±æ˜¯ä¸€ä¸ª è‡ªå®šä¹‰çš„ apiserver äº†ã€‚
ä½†æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ apiserver éœ€è¦å®ç°ä»¥ä¸‹è¿™äº›å¤„ç†ï¼ˆHandlerï¼‰ï¼š</p><ul><li>for API Discovery<ul><li>/apis</li><li>/apis/play.ketches.io</li><li>/apis/play.ketches.io/v1</li></ul></li><li>for OpenAPI Schema<ul><li>/openapi/v2</li><li>/openapi/v3</li></ul></li><li>for Foo CRUD<ul><li>/apis/play.ketches.io/v1/foos</li><li>/apis/play.ketches.io/v1/namespaces/{namespace}/foos</li><li>/apis/play.ketches.io/v1/namespaces/{namespace}/foos/{name}</li></ul></li></ul><h3 id=openapi>OpenAPI
<a class=anchor href=#openapi>#</a></h3><p>API çš„ Schema ä¼š
<code>kubectl explain</code> å‘½ä»¤è¾“å‡ºå†…å®¹æ¥æºäº OpenAPI Specã€‚</p><h2 id=å‚è€ƒ>å‚è€ƒ
<a class=anchor href=#%e5%8f%82%e8%80%83>#</a></h2><ul><li><a href=https://www.zeng.dev/post/2023-k8s-api-by-crd>K8s CustomResourceDefinitions (CRD) åŸç†</a></li><li><a href=https://www.zeng.dev/post/2023-k8s-apiserver-from-scratch/>å®ç°ä¸€ä¸ªæç®€ K8s apiserver</a></li></ul><hr><p><a href=/kubernetes/k8s-deploy-zookeeper-kafka/>Â« Kubernetes 0-1 K8séƒ¨ç½²Zookeeperå’ŒKafka</a></p><p><a href=/kubernetes/k8s-dev-02-crd/>Â» Kubernetes å®šåˆ¶å¼€å‘ 02ï¼šCRD</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/poneding/blog/commit/5faa4f1be5d4525c49e513962394eae7c15fb6f2 title='æœ€åä¿®æ”¹è€… poneding | 2024/06/13' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt>
<span>2024/06/13</span></a></div><div><a class="flex align-center" href=https://github.com/poneding/blog/edit/master/content/kubernetes/k8s-dev-01-api-concept.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>ç¼–è¾‘æœ¬é¡µ</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=poneding/blog data-repo-id=R_kgDOMITIHg data-category=General data-category-id=DIC_kwDOMITIHs4CgB4x data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#åŸºæœ¬æ¦‚å¿µ>åŸºæœ¬æ¦‚å¿µ</a></li><li><a href=#api-èµ„æºç«¯ç‚¹>API èµ„æºç«¯ç‚¹</a></li><li><a href=#apiservice>APIService</a></li><li><a href=#åˆ›å»ºä¸€ä¸ª-crd>åˆ›å»ºä¸€ä¸ª CRD</a><ul><li><a href=#openapi>OpenAPI</a></li></ul></li><li><a href=#å‚è€ƒ>å‚è€ƒ</a></li></ul></nav></div></aside></main></body></html>