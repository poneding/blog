<!doctype html><html lang=cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='ğŸ  é¦–é¡µ / AWS / Cluster AutoScaler
Cluster AutoScaler # æˆ‘å½“å‰å·²ç»æœ‰äº†ä¸€ä¸ªEKSæœåŠ¡æ­å»ºèµ·æ¥çš„K8sé›†ç¾¤ï¼Œæˆ‘ç°åœ¨å¸Œæœ›æˆ‘çš„é›†ç¾¤æ‹¥æœ‰è‡ªåŠ¨ä¼¸ç¼©ï¼ˆä½“ç°åœ¨èŠ‚ç‚¹çš„æ‰©ç¼©ï¼‰çš„èƒ½åŠ›ã€‚
å½“æˆ‘çš„é›†ç¾¤èµ„æºå……è¶³ï¼Œè€Œæˆ‘éƒ¨ç½²åœ¨é›†ç¾¤ä¸­çš„åº”ç”¨åªä½¿ç”¨åˆ°äº†å¾ˆå°‘é‡çš„èµ„æºï¼Œæˆ‘å¸Œæœ›é›†ç¾¤å›æ”¶èµ„æºä»¥èŠ‚çœè´¹ç”¨ï¼›å½“æˆ‘çš„åº”ç”¨æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå½“å‰é›†ç¾¤èµ„æºä¸è¶³æ—¶ï¼Œæˆ‘å¸Œæœ›é›†ç¾¤èƒ½å¢åŠ èŠ‚ç‚¹ï¼Œä»¥æ»¡è¶³åº”ç”¨çš„éƒ¨ç½²æ¡ä»¶ã€‚
é‚£ä¹ˆæœ¬ç¯‡å°±æ˜¯ä»‹ç»å¦‚ä½•é€šè¿‡ä½¿ç”¨Kubernetes Cluster Autoscalerè®©ä½ çš„é›†ç¾¤æ‹¥æœ‰è‡ªåŠ¨ä¼¸ç¼©çš„èƒ½åŠ›ï¼Œè€Œä¸ç”¨ä½ æ—¶åˆ»å…³æ³¨é›†ç¾¤çš„èµ„æºæ˜¯å¦è¿‡äºå®½æ¾æˆ–ç´§å¼ ã€‚
NodeGroupæ·»åŠ Tag # æˆ‘ä»¬åˆ›å»ºEKSæ—¶ï¼Œéœ€è¦å®šä¹‰NodeGroupï¼Œä¸€èˆ¬åœ¨è¿™ä¸ªNodeGroupä¸­å®šä¹‰:
asg_desired_capacityï¼šæœŸæœ›åˆ›å»ºçš„Nodeæ•°é‡ï¼›
asg_max_sizeï¼šæœ€å°Nodeæ•°é‡ï¼Œé»˜è®¤ä¸º1ï¼›
asg_min_sizeï¼šæœ€å¤§Nodeæ•°é‡ã€‚
å®šä¹‰çš„NodeGroupä¼šç”ŸæˆAuto Scaling Groupèµ„æºï¼Œå¹¶ä¸”ç”±Auto Scaling Groupæ¥ç®¡ç†Nodeçš„åˆ›å»ºã€‚
ç°åœ¨éœ€è¦åšçš„å°±æ˜¯ä¸ºä½ çš„Auto Scaling Groupæ·»åŠ Tagã€‚
tagé”®å€¼ï¼š
Tag Key Tag Value k8s.io/cluster-autoscaler/<your_cluster_name> owned k8s.io/cluster-autoscaler/enabled true ç¬¬ä¸€ä¸ªTag Keyä¸­çš„é›†ç¾¤å<your_cluster_name>éœ€è¦æ›¿æ¢ï¼›
Tag Valueçš„å€¼æ˜¯ä»€ä¹ˆä¸é‡è¦ï¼Œä¸»è¦æ˜¯éœ€è¦è¿™ä¸¤ä¸ªTag Keyæ¥è¯†åˆ«æ˜¯å¦å¯¹è¿™ä¸ªé›†ç¾¤å¼€å¯Auto Scalingçš„èƒ½åŠ›ã€‚
æ·»åŠ Policy # åˆ›å»ºIAMç­–ç•¥ï¼Œå°†æ–°åˆ›å»ºçš„ç­–ç•¥Attachåˆ°é›†ç¾¤èŠ‚ç‚¹ç»‘å®šçš„IAM roleä¸Šï¼Œè®©ä½ çš„é›†ç¾¤èŠ‚ç‚¹æ‹¥æœ‰è‡ªåŠ¨ä¼¸ç¼©çš„èƒ½åŠ›ã€‚
IAMç­–ç•¥Jsonå†…å®¹ï¼š
{ "Version": "2012-10-17", "Statement": [ { "Action": [ "autoscaling:DescribeAutoScalingGroups", "autoscaling:DescribeAutoScalingInstances", "autoscaling:DescribeLaunchConfigurations", "autoscaling:DescribeTags", "autoscaling:SetDesiredCapacity", "autoscaling:TerminateInstanceInAutoScalingGroup", "ec2:DescribeLaunchTemplateVersions" ], "Resource": "*", "Effect": "Allow" } ] } éƒ¨ç½²Cluster AutoScaler # åœ¨é›†ç¾¤ä¸­éƒ¨ç½²Cluster AutoScalerï¼Œå‡†å¤‡èµ„æºæ¸…å•æ–‡ä»¶cluster-autoscaler.'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://blog.poneding.com/aws/cluster-autoscaler/"><meta property="og:site_name" content="ç§‹æ²³è½å¶"><meta property="og:title" content="ç§‹æ²³è½å¶"><meta property="og:description" content='ğŸ  é¦–é¡µ / AWS / Cluster AutoScaler
Cluster AutoScaler # æˆ‘å½“å‰å·²ç»æœ‰äº†ä¸€ä¸ªEKSæœåŠ¡æ­å»ºèµ·æ¥çš„K8sé›†ç¾¤ï¼Œæˆ‘ç°åœ¨å¸Œæœ›æˆ‘çš„é›†ç¾¤æ‹¥æœ‰è‡ªåŠ¨ä¼¸ç¼©ï¼ˆä½“ç°åœ¨èŠ‚ç‚¹çš„æ‰©ç¼©ï¼‰çš„èƒ½åŠ›ã€‚
å½“æˆ‘çš„é›†ç¾¤èµ„æºå……è¶³ï¼Œè€Œæˆ‘éƒ¨ç½²åœ¨é›†ç¾¤ä¸­çš„åº”ç”¨åªä½¿ç”¨åˆ°äº†å¾ˆå°‘é‡çš„èµ„æºï¼Œæˆ‘å¸Œæœ›é›†ç¾¤å›æ”¶èµ„æºä»¥èŠ‚çœè´¹ç”¨ï¼›å½“æˆ‘çš„åº”ç”¨æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå½“å‰é›†ç¾¤èµ„æºä¸è¶³æ—¶ï¼Œæˆ‘å¸Œæœ›é›†ç¾¤èƒ½å¢åŠ èŠ‚ç‚¹ï¼Œä»¥æ»¡è¶³åº”ç”¨çš„éƒ¨ç½²æ¡ä»¶ã€‚
é‚£ä¹ˆæœ¬ç¯‡å°±æ˜¯ä»‹ç»å¦‚ä½•é€šè¿‡ä½¿ç”¨Kubernetes Cluster Autoscalerè®©ä½ çš„é›†ç¾¤æ‹¥æœ‰è‡ªåŠ¨ä¼¸ç¼©çš„èƒ½åŠ›ï¼Œè€Œä¸ç”¨ä½ æ—¶åˆ»å…³æ³¨é›†ç¾¤çš„èµ„æºæ˜¯å¦è¿‡äºå®½æ¾æˆ–ç´§å¼ ã€‚
NodeGroupæ·»åŠ Tag # æˆ‘ä»¬åˆ›å»ºEKSæ—¶ï¼Œéœ€è¦å®šä¹‰NodeGroupï¼Œä¸€èˆ¬åœ¨è¿™ä¸ªNodeGroupä¸­å®šä¹‰:
asg_desired_capacityï¼šæœŸæœ›åˆ›å»ºçš„Nodeæ•°é‡ï¼›
asg_max_sizeï¼šæœ€å°Nodeæ•°é‡ï¼Œé»˜è®¤ä¸º1ï¼›
asg_min_sizeï¼šæœ€å¤§Nodeæ•°é‡ã€‚
å®šä¹‰çš„NodeGroupä¼šç”ŸæˆAuto Scaling Groupèµ„æºï¼Œå¹¶ä¸”ç”±Auto Scaling Groupæ¥ç®¡ç†Nodeçš„åˆ›å»ºã€‚
ç°åœ¨éœ€è¦åšçš„å°±æ˜¯ä¸ºä½ çš„Auto Scaling Groupæ·»åŠ Tagã€‚
tagé”®å€¼ï¼š
Tag Key Tag Value k8s.io/cluster-autoscaler/<your_cluster_name> owned k8s.io/cluster-autoscaler/enabled true ç¬¬ä¸€ä¸ªTag Keyä¸­çš„é›†ç¾¤å<your_cluster_name>éœ€è¦æ›¿æ¢ï¼›
Tag Valueçš„å€¼æ˜¯ä»€ä¹ˆä¸é‡è¦ï¼Œä¸»è¦æ˜¯éœ€è¦è¿™ä¸¤ä¸ªTag Keyæ¥è¯†åˆ«æ˜¯å¦å¯¹è¿™ä¸ªé›†ç¾¤å¼€å¯Auto Scalingçš„èƒ½åŠ›ã€‚
æ·»åŠ Policy # åˆ›å»ºIAMç­–ç•¥ï¼Œå°†æ–°åˆ›å»ºçš„ç­–ç•¥Attachåˆ°é›†ç¾¤èŠ‚ç‚¹ç»‘å®šçš„IAM roleä¸Šï¼Œè®©ä½ çš„é›†ç¾¤èŠ‚ç‚¹æ‹¥æœ‰è‡ªåŠ¨ä¼¸ç¼©çš„èƒ½åŠ›ã€‚
IAMç­–ç•¥Jsonå†…å®¹ï¼š
{ "Version": "2012-10-17", "Statement": [ { "Action": [ "autoscaling:DescribeAutoScalingGroups", "autoscaling:DescribeAutoScalingInstances", "autoscaling:DescribeLaunchConfigurations", "autoscaling:DescribeTags", "autoscaling:SetDesiredCapacity", "autoscaling:TerminateInstanceInAutoScalingGroup", "ec2:DescribeLaunchTemplateVersions" ], "Resource": "*", "Effect": "Allow" } ] } éƒ¨ç½²Cluster AutoScaler # åœ¨é›†ç¾¤ä¸­éƒ¨ç½²Cluster AutoScalerï¼Œå‡†å¤‡èµ„æºæ¸…å•æ–‡ä»¶cluster-autoscaler.'><meta property="og:locale" content="cn"><meta property="og:type" content="article"><meta property="article:section" content="aws"><meta property="article:modified_time" content="2024-06-13T15:37:18+08:00"><title>Cluster Autoscaler | ç§‹æ²³è½å¶</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/logo.png><link rel=canonical href=https://blog.poneding.com/aws/cluster-autoscaler/><link rel=stylesheet href=/book.min.4964903a822a7acb10dac6d1ab524833c97fb5f99b141976bcb8a47d539be9c0.css integrity="sha256-SWSQOoIqessQ2sbRq1JIM8l/tfmbFBl2vLikfVOb6cA=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/cn.search.min.c88a2593d2dfc6d2a9c4b8f176003ff200e64eb6b705a52d80e6eff4653d3daf.js integrity="sha256-yIolk9LfxtKpxLjxdgA/8gDmTra3BaUtgObv9GU9Pa8=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><link rel=stylesheet href=/css/syntax.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>ç§‹æ²³è½å¶</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=æœç´¢ aria-label=æœç´¢ maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><p>ğŸ¦‰ é›†ä¸­èµ·æ¥çš„æ„å¿—å¯ä»¥å‡»ç©¿é¡½çŸ³ã€‚</p><hr><ul><li><p><a href=/><strong>ğŸ  é¦–é¡µ</strong></a></p></li><li><p><strong>ğŸ“Œ ç½®é¡¶æ–‡ç« </strong></p><ul><li><a href=/git/common-usage/>Git å¸¸ç”¨</a></li><li><a href=/kubernetes/kubeadm-install-k8s-docker/>å®‰è£… Kubernetes (Docker)</a></li></ul></li><li><p><strong>ğŸ“Œ ç½®é¡¶åˆ†ç±»</strong></p><ul><li><a href=/go/>Golang ç¼–ç¨‹</a></li><li><a href=/kubernetes/>Kubernetes</a></li><li><a href=/rust/>Rust ç¼–ç¨‹</a></li><li><a href=/git/>Git</a></li></ul></li></ul><hr><ul><li><strong>ğŸ—ƒï¸ å¼€æºé¡¹ç›®</strong><ul><li><a href=https://github.com/ketches/registry-proxy>registry-proxy</a></li><li><a href=https://github.com/poneding/mdi>mdi</a></li></ul></li></ul><hr><ul><li><a href=https://github.com/poneding target=_blank rel=noopener>ğŸ™ GitHub</a></li><li><a href=mailto:poneding@gmail.com target=_blank rel=noopener>ğŸ“¬ é‚®ç®±</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Cluster Autoscaler</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#nodegroupæ·»åŠ tag>NodeGroupæ·»åŠ Tag</a></li><li><a href=#æ·»åŠ policy>æ·»åŠ Policy</a></li><li><a href=#éƒ¨ç½²cluster-autoscaler>éƒ¨ç½²Cluster AutoScaler</a></li><li><a href=#æŸ¥çœ‹cluster-autoscaler>æŸ¥çœ‹Cluster AutoScaler</a></li><li><a href=#åˆ†æåŸç†>åˆ†æåŸç†</a></li></ul></nav></aside></header><article class="markdown book-article"><p><a href=/>ğŸ  é¦–é¡µ</a> /
<a href=/aws/>AWS</a> / Cluster AutoScaler</p><h1 id=cluster-autoscaler>Cluster AutoScaler
<a class=anchor href=#cluster-autoscaler>#</a></h1><p><img src=https://fs.poneding.com/images/eks.jpg alt=eks.jpg></p><p>æˆ‘å½“å‰å·²ç»æœ‰äº†ä¸€ä¸ªEKSæœåŠ¡æ­å»ºèµ·æ¥çš„K8sé›†ç¾¤ï¼Œæˆ‘ç°åœ¨å¸Œæœ›æˆ‘çš„é›†ç¾¤æ‹¥æœ‰è‡ªåŠ¨ä¼¸ç¼©ï¼ˆä½“ç°åœ¨èŠ‚ç‚¹çš„æ‰©ç¼©ï¼‰çš„èƒ½åŠ›ã€‚</p><p>å½“æˆ‘çš„é›†ç¾¤èµ„æºå……è¶³ï¼Œè€Œæˆ‘éƒ¨ç½²åœ¨é›†ç¾¤ä¸­çš„åº”ç”¨åªä½¿ç”¨åˆ°äº†å¾ˆå°‘é‡çš„èµ„æºï¼Œæˆ‘å¸Œæœ›é›†ç¾¤å›æ”¶èµ„æºä»¥èŠ‚çœè´¹ç”¨ï¼›å½“æˆ‘çš„åº”ç”¨æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå½“å‰é›†ç¾¤èµ„æºä¸è¶³æ—¶ï¼Œæˆ‘å¸Œæœ›é›†ç¾¤èƒ½å¢åŠ èŠ‚ç‚¹ï¼Œä»¥æ»¡è¶³åº”ç”¨çš„éƒ¨ç½²æ¡ä»¶ã€‚</p><p>é‚£ä¹ˆæœ¬ç¯‡å°±æ˜¯ä»‹ç»å¦‚ä½•é€šè¿‡ä½¿ç”¨<strong>Kubernetes Cluster Autoscaler</strong>è®©ä½ çš„é›†ç¾¤æ‹¥æœ‰è‡ªåŠ¨ä¼¸ç¼©çš„èƒ½åŠ›ï¼Œè€Œä¸ç”¨ä½ æ—¶åˆ»å…³æ³¨é›†ç¾¤çš„èµ„æºæ˜¯å¦è¿‡äºå®½æ¾æˆ–ç´§å¼ ã€‚</p><h2 id=nodegroupæ·»åŠ tag>NodeGroupæ·»åŠ Tag
<a class=anchor href=#nodegroup%e6%b7%bb%e5%8a%a0tag>#</a></h2><p>æˆ‘ä»¬åˆ›å»ºEKSæ—¶ï¼Œéœ€è¦å®šä¹‰NodeGroupï¼Œä¸€èˆ¬åœ¨è¿™ä¸ªNodeGroupä¸­å®šä¹‰:</p><ul><li><p>asg_desired_capacityï¼šæœŸæœ›åˆ›å»ºçš„Nodeæ•°é‡ï¼›</p></li><li><p>asg_max_sizeï¼šæœ€å°Nodeæ•°é‡ï¼Œé»˜è®¤ä¸º1ï¼›</p></li><li><p>asg_min_sizeï¼šæœ€å¤§Nodeæ•°é‡ã€‚</p></li></ul><p>å®šä¹‰çš„NodeGroupä¼šç”ŸæˆAuto Scaling Groupèµ„æºï¼Œå¹¶ä¸”ç”±Auto Scaling Groupæ¥ç®¡ç†Nodeçš„åˆ›å»ºã€‚</p><p><img src=https://fs.poneding.com/images/image-20200709094437775.png alt=image-20200709094437775></p><p>ç°åœ¨éœ€è¦åšçš„å°±æ˜¯ä¸ºä½ çš„Auto Scaling Groupæ·»åŠ Tagã€‚</p><p>tagé”®å€¼ï¼š</p><table><thead><tr><th>Tag Key</th><th>Tag Value</th></tr></thead><tbody><tr><td>k8s.io/cluster-autoscaler/&lt;your_cluster_name></td><td>owned</td></tr><tr><td>k8s.io/cluster-autoscaler/enabled</td><td>true</td></tr></tbody></table><blockquote><p>ç¬¬ä¸€ä¸ªTag Keyä¸­çš„é›†ç¾¤å&lt;your_cluster_name>éœ€è¦æ›¿æ¢ï¼›</p><p>Tag Valueçš„å€¼æ˜¯ä»€ä¹ˆä¸é‡è¦ï¼Œä¸»è¦æ˜¯éœ€è¦è¿™ä¸¤ä¸ªTag Keyæ¥è¯†åˆ«æ˜¯å¦å¯¹è¿™ä¸ªé›†ç¾¤å¼€å¯Auto Scalingçš„èƒ½åŠ›ã€‚</p></blockquote><h2 id=æ·»åŠ policy>æ·»åŠ Policy
<a class=anchor href=#%e6%b7%bb%e5%8a%a0policy>#</a></h2><p>åˆ›å»ºIAMç­–ç•¥ï¼Œå°†æ–°åˆ›å»ºçš„ç­–ç•¥Attachåˆ°é›†ç¾¤èŠ‚ç‚¹ç»‘å®šçš„IAM roleä¸Šï¼Œè®©ä½ çš„é›†ç¾¤èŠ‚ç‚¹æ‹¥æœ‰è‡ªåŠ¨ä¼¸ç¼©çš„èƒ½åŠ›ã€‚</p><p>IAMç­–ç•¥Jsonå†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Version&#34;</span><span class=p>:</span> <span class=s2>&#34;2012-10-17&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Statement&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;autoscaling:DescribeAutoScalingGroups&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;autoscaling:DescribeAutoScalingInstances&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;autoscaling:DescribeLaunchConfigurations&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;autoscaling:DescribeTags&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;autoscaling:SetDesiredCapacity&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;autoscaling:TerminateInstanceInAutoScalingGroup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;ec2:DescribeLaunchTemplateVersions&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=éƒ¨ç½²cluster-autoscaler>éƒ¨ç½²Cluster AutoScaler
<a class=anchor href=#%e9%83%a8%e7%bd%b2cluster-autoscaler>#</a></h2><p>åœ¨é›†ç¾¤ä¸­éƒ¨ç½²Cluster AutoScalerï¼Œå‡†å¤‡èµ„æºæ¸…å•æ–‡ä»¶cluster-autoscaler.yamlï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ServiceAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>k8s-addon</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler.addons.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>kube-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>k8s-addon</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler.addons.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;events&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;endpoints&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;create&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;patch&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;pods/eviction&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;create&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;pods/status&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;update&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;endpoints&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resourceNames</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;cluster-autoscaler&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;update&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;nodes&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;update&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;pods&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;services&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;replicationcontrollers&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;persistentvolumeclaims&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;persistentvolumes&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;get&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;extensions&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;replicasets&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;daemonsets&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;get&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;policy&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;poddisruptionbudgets&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;apps&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;statefulsets&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;replicasets&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;daemonsets&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;get&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;storage.k8s.io&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;storageclasses&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;csinodes&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;get&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;batch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;extensions&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;jobs&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;patch&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;coordination.k8s.io&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;leases&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;create&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;coordination.k8s.io&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resourceNames</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;cluster-autoscaler&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;leases&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;update&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Role</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>kube-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>k8s-addon</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler.addons.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;configmaps&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;create&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;watch&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;configmaps&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resourceNames</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>[</span><span class=s2>&#34;cluster-autoscaler-status&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;cluster-autoscaler-priority-expander&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;delete&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;update&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;watch&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRoleBinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>k8s-addon</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler.addons.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ServiceAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>kube-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>RoleBinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>kube-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>k8s-addon</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler.addons.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>k8s-app</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Role</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ServiceAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>kube-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>kube-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>prometheus.io/scrape</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>prometheus.io/port</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;8085&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>cluster-autoscaler.kubernetes.io/safe-to-evict</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;false&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>serviceAccountName</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>us.gcr.io/k8s-artifacts-prod/autoscaling/cluster-autoscaler:v1.16.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>100m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>300Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=l>100m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>300Mi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>./cluster-autoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- --<span class=l>v=4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- --<span class=l>stderrthreshold=info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- --<span class=l>cloud-provider=aws</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- --<span class=l>skip-nodes-with-local-storage=false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- --<span class=l>expander=least-waste</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- --<span class=l>node-group-auto-discovery=asg:tag=k8s.io/cluster-autoscaler/enabled,k8s.io/cluster-autoscaler/&lt;your_cluster_name&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- --<span class=l>balance-similar-node-groups</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- --<span class=l>skip-nodes-with-system-pods=false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ssl-certs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/etc/ssl/certs/ca-certificates.crt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Always&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ssl-certs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>hostPath</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/etc/ssl/certs/ca-bundle.crt&#34;</span><span class=w>
</span></span></span></code></pre></div><p>èµ„æºæ¸…å•å†…å®¹æ¯”è¾ƒé•¿ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ cluster-autoscaler çš„ Deployment èµ„æºä¸­å®šä¹‰çš„ command ä¸­ï¼Œæœ‰ä¸€è¡Œä½ ä¼šè§‰å¾—çœ¼ç†Ÿï¼Œæ²¡é”™å°±æ˜¯æˆ‘ä»¬ä¸Šé¢ä¸º Auto Scale Group æ·»åŠ çš„ Tagï¼Œè¿™é‡Œä½ ä¹Ÿéœ€è¦æ›¿æ¢ä½ çš„é›†ç¾¤å &lt;your_cluster_name>ï¼Œæ­¤å¤–ä½ å¯èƒ½éœ€è¦æ›¿æ¢ä½¿ç”¨åˆ°çš„é•œåƒï¼Œä½ å¯ä»¥åœ¨
<a href=https://github.com/kubernetes/autoscaler/releases>Cluster AutoScaler å‘ç‰ˆé¡µé¢</a>å»æ‰¾å¯¹åº”çš„é•œåƒç‰ˆæœ¬ã€‚ä¾‹å¦‚æˆ‘çš„K8sé›†ç¾¤æ˜¯1.16ï¼Œé‚£ä¹ˆæˆ‘éœ€è¦æ‰¾ä¸€ä¸ª1.16.xç‰ˆæœ¬çš„é•œåƒã€‚ä¸Šé¢èµ„æºæ¸…å•é‡Œå°±æ˜¯ä½¿ç”¨äº† <code>us.gcr.io/k8s-artifacts-prod/autoscaling/cluster-autoscaler:v1.16.5</code> çš„é•œåƒã€‚</p><p><img src=https://fs.poneding.com/images/image-20200709101706463.png alt=image-20200709101706463></p><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ›å»º Cluster AutoScaler èµ„æºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f cluster-autoscaler.yaml
</span></span></code></pre></div><h2 id=æŸ¥çœ‹cluster-autoscaler>æŸ¥çœ‹Cluster AutoScaler
<a class=anchor href=#%e6%9f%a5%e7%9c%8bcluster-autoscaler>#</a></h2><p>æˆ‘ä»¬éƒ¨ç½²å®Œæˆä¹‹åï¼ŒCluster é»˜è®¤æ¯ 10s æ£€æŸ¥ä¸€æ¬¡é›†ç¾¤çš„èµ„æºæƒ…å†µï¼Œå¹¶æ ¹æ®èµ„æºæƒ…å†µåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©ç¼©å®¹ã€‚</p><p>ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹Cluster AutoScalerçš„æ£€æŸ¥æƒ…å†µï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl logs -f deployment.apps/cluster-autoscaler -n kube-system
</span></span></code></pre></div><p><img src=https://fs.poneding.com/images/image-20200709102312935.png alt=image-20200709102312935></p><h2 id=åˆ†æåŸç†>åˆ†æåŸç†
<a class=anchor href=#%e5%88%86%e6%9e%90%e5%8e%9f%e7%90%86>#</a></h2><p>ä½ å¯ä»¥é€šè¿‡çªç„¶å¢åŠ Podç¤ºä¾‹æ•°é‡ï¼Œå¹¶ä¸”å¢åŠ  Pod çš„ <code>resource.request.cpu/memory</code> è®¾ç½®ä¸ºè¾ƒé«˜çš„å€¼ï¼Œè¿™æ ·æ¥æ¨¡æ‹Ÿé›†ç¾¤èµ„æºç´§å¼ çš„åœºæ™¯ï¼Œè§‚å¯Ÿé›†ç¾¤èŠ‚ç‚¹æ˜¯å¦ä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œä¹‹åå°†å¢åŠ çš„ Pod èµ„æºåˆ é™¤ï¼Œå†è§‚å¯Ÿé›†ç¾¤èŠ‚ç‚¹æ˜¯å¦è‡ªåŠ¨å›æ”¶ã€‚è¿™é‡Œæˆ‘å·²ç»å®è·µè¿‡äº†ï¼Œç”±äºæ¼”ç¤ºèµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œå¯èƒ½ä¼šè€—è´¹å¾ˆé•¿çš„ç¯‡å¹…ï¼Œæ‰€ä»¥è¿™é‡Œå°±çœå»äº†ï¼Œä½ å¯ä»¥äº²è‡ªåŠ¨æ‰‹å®è·µå°è¯•ã€‚</p><p>ç›¸ä¿¡æœ‰ä¸€ä¸ªç–‘é—®ä¸€ç›´ç¯ç»•ç€ï¼ŒCluster AutoScaleræ˜¯æ€ä¹ˆåšåˆ°è‡ªåŠ¨ä¼¸ç¼©çš„å‘¢ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰ç»™å‡ºç±»ä¼¼äºCPUè¶…è¿‡75%å°±æ‰©å®¹çš„ä¼¸ç¼©æ¡ä»¶ã€‚æˆ‘æ²¡æœ‰æ·±å…¥å»ç ”ç©¶ï¼Œä½†æ˜¯æˆ‘è‡ªå·±æ ¹æ®Cluster AutoScalerçš„æ—¥å¿—è¾“å‡ºç†è§£äº†ä¸€ä¸‹ã€‚</p><p>Podçš„ç”³è¯·çš„èµ„æºï¼ˆresources.requestsï¼‰ä¸ç°æœ‰èŠ‚ç‚¹èµ„æºä½œæ¯”è¾ƒï¼Œå¦‚æœå‘ç°é›†ç¾¤èµ„æºè¶…å‡ºç”³è¯·çš„èµ„æºèƒ½å¤Ÿä½¿å¾—æˆ‘ä»¬ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹çš„è¯ï¼Œé‚£ä¹ˆCluster AutoScalerä¾¿ä¼šä¿®æ”¹Auto Scaling Groupçš„asg_desired_capacityå€¼ï¼Œä¾‹å¦‚-1ï¼Œä½†æ˜¯ä¸ä¼šå°äºasg_max_sizeã€‚å½“æœ‰æ–°Podéƒ¨ç½²ï¼Œå‘ç°é›†ç¾¤èµ„æºè¾¾ä¸åˆ°æ–°Podç”³è¯·çš„èµ„æºæ—¶ï¼Œé‚£ä¹ˆCluster AutoScalerä¾¿ä¼šä¿®æ”¹Auto Scaling Groupçš„asg_desired_capacityå€¼ï¼Œä¾‹å¦‚+1ï¼Œä½†æ˜¯ä¸ä¼šå¤§äºasg_max_sizeã€‚åªè¦ä¿®æ”¹äº†Auto Scaling Groupçš„asg_desired_capacityå€¼ï¼Œé‚£ä¹ˆé›†ç¾¤èŠ‚ç‚¹ä¾¿ä¼šè‡ªåŠ¨ä¼¸ç¼©ã€‚</p><hr><p><a href=/aws/build-eks-cluster/>Â« æ­å»ºEKSé›†ç¾¤</a></p><p><a href=/aws/create-eks-cluster/>Â» åˆ›å»º EKS é›†ç¾¤</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/poneding/blog/commit/5faa4f1be5d4525c49e513962394eae7c15fb6f2 title='æœ€åä¿®æ”¹è€… poneding | 2024/06/13' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt>
<span>2024/06/13</span></a></div><div><a class="flex align-center" href=https://github.com/poneding/blog/edit/master/content/aws/cluster-autoscaler.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>ç¼–è¾‘æœ¬é¡µ</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=poneding/blog data-repo-id=R_kgDOMITIHg data-category=General data-category-id=DIC_kwDOMITIHs4CgB4x data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#nodegroupæ·»åŠ tag>NodeGroupæ·»åŠ Tag</a></li><li><a href=#æ·»åŠ policy>æ·»åŠ Policy</a></li><li><a href=#éƒ¨ç½²cluster-autoscaler>éƒ¨ç½²Cluster AutoScaler</a></li><li><a href=#æŸ¥çœ‹cluster-autoscaler>æŸ¥çœ‹Cluster AutoScaler</a></li><li><a href=#åˆ†æåŸç†>åˆ†æåŸç†</a></li></ul></nav></div></aside></main></body></html>