<!doctype html><html lang=cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ğŸ  é¦–é¡µ / DevOps / Ansible
Ansible # ä»‹ç» # ä¸€æ¬¾è½»é‡çº§çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œåªéœ€è¦ä¸€å°ä¸»æœºå®‰è£…Ansibleï¼Œä¾¿å¯ä»¥ç®¡ç†å…¶ä»–å¯è¿é€šçš„LinuxæœåŠ¡å™¨ã€‚
å¼€æº
python
ç‰¹ç‚¹ # è‡ªåŠ¨åŒ–å¼•æ“ï¼Œå®ç°ç®¡ç†é…ç½®ï¼Œåº”ç”¨éƒ¨ç½²ï¼ŒæœåŠ¡ç¼–æ’åŠå…¶ä»–å„ç§æœåŠ¡å™¨ç®¡ç†éœ€æ±‚ï¼› ä½¿ç”¨ç®€å•ï¼Œå…·æœ‰å®¢æˆ·ç«¯çš„ç‰¹ç‚¹ï¼› åŸºäºsshå®ç°é…ç½®ç®¡ç†ï¼› ä¾èµ–pythonï¼› åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒäº‘æœåŠ¡æ“ä½œã€‚ å®‰è£… # â€‹ ç”±äºAnsibleä½¿ç”¨Pythonå¼€å‘ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨pipå®‰è£…
pip install ansible â€‹ ä¹Ÿå¯ä»¥ä½¿ç”¨yumæˆ–apt-getå®‰è£…
yum install ansible -y apt-get install ansible -y ansible --version â€‹ åªéœ€è¦åœ¨Control Nodeä¸Šå®‰è£…å³å¯ã€‚
ä¸»è¦æ¦‚å¿µ # Control nodeï¼š
å®‰è£…äº†Ansibleçš„ä¸»æœºéƒ½å¯ä»¥ç§°ä¹‹ä¸ºControl nodeï¼Œåè¿‡æ¥è¯´ï¼ŒAnsibleå®‰è£…åœ¨Contriol Nodeä¸Šï¼›
ä¸€èˆ¬ä¸ºlinuxæœºå™¨ï¼ˆæ³¨ï¼šç›®å‰ä¹Ÿå·²ç»å¯¹windowsåšäº†æ”¯æŒï¼‰ã€‚
Managed nodesï¼š
å¾…ç®¡ç†çš„ç½‘ç»œè®¾å¤‡æˆ–è€…æœåŠ¡å™¨ï¼›
linuxæœºå™¨ï¼ˆå®‰è£…äº†pythonï¼‰ã€‚
Inventoryï¼š
Modulesï¼š
Tasksï¼š
Ansibleé…ç½® # â€‹ é…ç½®æ–‡ä»¶ä½ç½®ï¼š/etc/ansible/ansible.cfgï¼Œä¸ºiniæ ¼å¼æ–‡ä»¶ã€‚
é…ç½®ç¤ºä¾‹ # â€‹ inventoryï¼šä¸»æœºæ¸…å•é…ç½®æ–‡ä»¶ä½ç½®ï¼Œåœ¨ä½¿ç”¨Ansibleå‘½ä»¤æ—¶ï¼Œä¹Ÿå¼€å§‹-i <path>æŒ‡å®šï¼›
â€‹ host_key_checkingï¼šå½“know_hostsä¸­ä¸å­˜åœ¨çš„ä¸»æœºï¼ˆå³å°šæœªè®¿é—®è¿‡çš„ä¸»æœºï¼Œæ˜¯å¦éœ€è¦è¾“å…¥å¯†é’¥ï¼‰ï¼›
â€‹ become_userï¼šsudoç”¨æˆ·ï¼›"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://blog.poneding.com/devops/ansible/"><meta property="og:site_name" content="ç§‹æ²³è½å¶"><meta property="og:title" content="ç§‹æ²³è½å¶"><meta property="og:description" content="ğŸ  é¦–é¡µ / DevOps / Ansible
Ansible # ä»‹ç» # ä¸€æ¬¾è½»é‡çº§çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œåªéœ€è¦ä¸€å°ä¸»æœºå®‰è£…Ansibleï¼Œä¾¿å¯ä»¥ç®¡ç†å…¶ä»–å¯è¿é€šçš„LinuxæœåŠ¡å™¨ã€‚
å¼€æº
python
ç‰¹ç‚¹ # è‡ªåŠ¨åŒ–å¼•æ“ï¼Œå®ç°ç®¡ç†é…ç½®ï¼Œåº”ç”¨éƒ¨ç½²ï¼ŒæœåŠ¡ç¼–æ’åŠå…¶ä»–å„ç§æœåŠ¡å™¨ç®¡ç†éœ€æ±‚ï¼› ä½¿ç”¨ç®€å•ï¼Œå…·æœ‰å®¢æˆ·ç«¯çš„ç‰¹ç‚¹ï¼› åŸºäºsshå®ç°é…ç½®ç®¡ç†ï¼› ä¾èµ–pythonï¼› åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒäº‘æœåŠ¡æ“ä½œã€‚ å®‰è£… # â€‹ ç”±äºAnsibleä½¿ç”¨Pythonå¼€å‘ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨pipå®‰è£…
pip install ansible â€‹ ä¹Ÿå¯ä»¥ä½¿ç”¨yumæˆ–apt-getå®‰è£…
yum install ansible -y apt-get install ansible -y ansible --version â€‹ åªéœ€è¦åœ¨Control Nodeä¸Šå®‰è£…å³å¯ã€‚
ä¸»è¦æ¦‚å¿µ # Control nodeï¼š
å®‰è£…äº†Ansibleçš„ä¸»æœºéƒ½å¯ä»¥ç§°ä¹‹ä¸ºControl nodeï¼Œåè¿‡æ¥è¯´ï¼ŒAnsibleå®‰è£…åœ¨Contriol Nodeä¸Šï¼›
ä¸€èˆ¬ä¸ºlinuxæœºå™¨ï¼ˆæ³¨ï¼šç›®å‰ä¹Ÿå·²ç»å¯¹windowsåšäº†æ”¯æŒï¼‰ã€‚
Managed nodesï¼š
å¾…ç®¡ç†çš„ç½‘ç»œè®¾å¤‡æˆ–è€…æœåŠ¡å™¨ï¼›
linuxæœºå™¨ï¼ˆå®‰è£…äº†pythonï¼‰ã€‚
Inventoryï¼š
Modulesï¼š
Tasksï¼š
Ansibleé…ç½® # â€‹ é…ç½®æ–‡ä»¶ä½ç½®ï¼š/etc/ansible/ansible.cfgï¼Œä¸ºiniæ ¼å¼æ–‡ä»¶ã€‚
é…ç½®ç¤ºä¾‹ # â€‹ inventoryï¼šä¸»æœºæ¸…å•é…ç½®æ–‡ä»¶ä½ç½®ï¼Œåœ¨ä½¿ç”¨Ansibleå‘½ä»¤æ—¶ï¼Œä¹Ÿå¼€å§‹-i <path>æŒ‡å®šï¼›
â€‹ host_key_checkingï¼šå½“know_hostsä¸­ä¸å­˜åœ¨çš„ä¸»æœºï¼ˆå³å°šæœªè®¿é—®è¿‡çš„ä¸»æœºï¼Œæ˜¯å¦éœ€è¦è¾“å…¥å¯†é’¥ï¼‰ï¼›
â€‹ become_userï¼šsudoç”¨æˆ·ï¼›"><meta property="og:locale" content="cn"><meta property="og:type" content="article"><meta property="article:section" content="devops"><meta property="article:modified_time" content="2024-06-13T15:37:18+08:00"><title>Ansible | ç§‹æ²³è½å¶</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/logo.png><link rel=canonical href=https://blog.poneding.com/devops/ansible/><link rel=stylesheet href=/book.min.4964903a822a7acb10dac6d1ab524833c97fb5f99b141976bcb8a47d539be9c0.css integrity="sha256-SWSQOoIqessQ2sbRq1JIM8l/tfmbFBl2vLikfVOb6cA=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/cn.search.min.57a418049e0989ee9e28232750ce0b90a00959fae43bc3fa7340c0ca41b2f7b1.js integrity="sha256-V6QYBJ4Jie6eKCMnUM4LkKAJWfrkO8P6c0DAykGy97E=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><link rel=stylesheet href=/css/syntax.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>ç§‹æ²³è½å¶</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=æœç´¢ aria-label=æœç´¢ maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><p>ğŸ¦‰ é›†ä¸­èµ·æ¥çš„æ„å¿—å¯ä»¥å‡»ç©¿é¡½çŸ³ã€‚</p><hr><ul><li><p><a href=/><strong>ğŸ  é¦–é¡µ</strong></a></p></li><li><p><strong>ğŸ“Œ ç½®é¡¶æ–‡ç« </strong></p><ul><li><a href=/git/common-usage/>Git å¸¸ç”¨</a></li><li><a href=/kubernetes/kubeadm-install-k8s-docker/>å®‰è£… Kubernetes (Docker)</a></li></ul></li><li><p><strong>ğŸ“Œ ç½®é¡¶åˆ†ç±»</strong></p><ul><li><a href=/go/>Golang ç¼–ç¨‹</a></li><li><a href=/kubernetes/>Kubernetes</a></li><li><a href=/rust/>Rust ç¼–ç¨‹</a></li><li><a href=/git/>Git</a></li></ul></li></ul><hr><ul><li><strong>ğŸ—ƒï¸ å¼€æºé¡¹ç›®</strong><ul><li><a href=https://github.com/ketches/registry-proxy>registry-proxy</a></li><li><a href=https://github.com/poneding/mdi>mdi</a></li></ul></li></ul><hr><ul><li><a href=https://github.com/poneding target=_blank rel=noopener>ğŸ™ GitHub</a></li><li><a href=mailto:poneding@gmail.com target=_blank rel=noopener>ğŸ“¬ é‚®ç®±</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Ansible</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#ä»‹ç»>ä»‹ç»</a><ul><li><a href=#ç‰¹ç‚¹>ç‰¹ç‚¹</a></li></ul></li><li><a href=#å®‰è£…>å®‰è£…</a></li><li><a href=#ä¸»è¦æ¦‚å¿µ>ä¸»è¦æ¦‚å¿µ</a></li><li><a href=#ansibleé…ç½®>Ansibleé…ç½®</a><ul><li><a href=#é…ç½®ç¤ºä¾‹>é…ç½®ç¤ºä¾‹</a></li></ul></li><li><a href=#ä¸»æœºæ¸…å•inventory>ä¸»æœºæ¸…å•(Inventory)</a><ul><li><a href=#formats>Formats</a></li><li><a href=#hosts>Hosts</a></li><li><a href=#group>Group</a></li><li><a href=#inventoryå†…ç½®å‚æ•°>Inventoryå†…ç½®å‚æ•°</a></li></ul></li><li><a href=#æ¨¡å—modules>æ¨¡å—(Modules)</a><ul><li><a href=#å¸¸ç”¨æ¨¡å—>å¸¸ç”¨æ¨¡å—</a></li></ul></li><li><a href=#ä»»åŠ¡tasks>ä»»åŠ¡(Tasks)</a></li><li><a href=#ansibleç”¨æ³•>Ansibleç”¨æ³•</a><ul><li><a href=#ansibleå‘½ä»¤>ansibleå‘½ä»¤</a></li><li><a href=#anisble-playbook>Anisble playbook</a></li></ul></li><li><a href=#ansibleåŸç†>AnsibleåŸç†</a></li><li><a href=#æ¼”ç¤º>æ¼”ç¤º</a></li><li><a href=#è¸©å‘è®°å½•>è¸©å‘è®°å½•</a></li><li><a href=#å…¶ä»–>å…¶ä»–</a><ul><li><a href=#é¢„ç¼–è¯‘>é¢„ç¼–è¯‘</a></li><li><a href=#pythonçš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜>pythonçš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜</a></li><li><a href=#å·¥å…·å¯¹æ¯”>å·¥å…·å¯¹æ¯”</a></li></ul></li><li><a href=#å‚è€ƒ>å‚è€ƒ</a></li></ul></nav></aside></header><article class="markdown book-article"><p><a href=/>ğŸ  é¦–é¡µ</a> /
<a href=/devops/>DevOps</a> / Ansible</p><h1 id=ansible>Ansible
<a class=anchor href=#ansible>#</a></h1><h2 id=ä»‹ç»>ä»‹ç»
<a class=anchor href=#%e4%bb%8b%e7%bb%8d>#</a></h2><ul><li><p>ä¸€æ¬¾è½»é‡çº§çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œåªéœ€è¦ä¸€å°ä¸»æœºå®‰è£…Ansibleï¼Œä¾¿å¯ä»¥ç®¡ç†å…¶ä»–å¯è¿é€šçš„LinuxæœåŠ¡å™¨ã€‚</p></li><li><p>å¼€æº</p></li><li><p>python</p></li></ul><h3 id=ç‰¹ç‚¹>ç‰¹ç‚¹
<a class=anchor href=#%e7%89%b9%e7%82%b9>#</a></h3><ol><li>è‡ªåŠ¨åŒ–å¼•æ“ï¼Œå®ç°ç®¡ç†é…ç½®ï¼Œåº”ç”¨éƒ¨ç½²ï¼ŒæœåŠ¡ç¼–æ’åŠå…¶ä»–å„ç§æœåŠ¡å™¨ç®¡ç†éœ€æ±‚ï¼›</li><li>ä½¿ç”¨ç®€å•ï¼Œå…·æœ‰å®¢æˆ·ç«¯çš„ç‰¹ç‚¹ï¼›</li><li>åŸºäºsshå®ç°é…ç½®ç®¡ç†ï¼›</li><li>ä¾èµ–pythonï¼›</li><li>åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒäº‘æœåŠ¡æ“ä½œã€‚</li></ol><h2 id=å®‰è£…>å®‰è£…
<a class=anchor href=#%e5%ae%89%e8%a3%85>#</a></h2><p>â€‹ ç”±äºAnsibleä½¿ç”¨Pythonå¼€å‘ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨pipå®‰è£…</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>pip install ansible
</span></span></code></pre></div><p>â€‹ ä¹Ÿå¯ä»¥ä½¿ç”¨yumæˆ–apt-getå®‰è£…</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yum install ansible -y
</span></span><span class=line><span class=cl>apt-get install ansible -y
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ansible --version
</span></span></code></pre></div><p>â€‹ åªéœ€è¦åœ¨Control Nodeä¸Šå®‰è£…å³å¯ã€‚</p><h2 id=ä¸»è¦æ¦‚å¿µ>ä¸»è¦æ¦‚å¿µ
<a class=anchor href=#%e4%b8%bb%e8%a6%81%e6%a6%82%e5%bf%b5>#</a></h2><ul><li><p><strong>Control node</strong>ï¼š</p><p>å®‰è£…äº†Ansibleçš„ä¸»æœºéƒ½å¯ä»¥ç§°ä¹‹ä¸ºControl nodeï¼Œåè¿‡æ¥è¯´ï¼ŒAnsibleå®‰è£…åœ¨Contriol Nodeä¸Šï¼›</p><p>ä¸€èˆ¬ä¸ºlinuxæœºå™¨ï¼ˆæ³¨ï¼šç›®å‰ä¹Ÿå·²ç»å¯¹windowsåšäº†æ”¯æŒï¼‰ã€‚</p></li><li><p><strong>Managed nodes</strong>ï¼š</p><p>å¾…ç®¡ç†çš„ç½‘ç»œè®¾å¤‡æˆ–è€…æœåŠ¡å™¨ï¼›</p><p>linuxæœºå™¨ï¼ˆå®‰è£…äº†pythonï¼‰ã€‚</p></li><li><p><strong>Inventory</strong>ï¼š</p></li><li><p><strong>Modules</strong>ï¼š</p></li><li><p><strong>Tasks</strong>ï¼š</p><p><img src=https://fs.poneding.com/images/image-20191126103012999.png alt=image-20191126103012999></p></li></ul><h2 id=ansibleé…ç½®>Ansibleé…ç½®
<a class=anchor href=#ansible%e9%85%8d%e7%bd%ae>#</a></h2><p>â€‹ é…ç½®æ–‡ä»¶ä½ç½®ï¼š/etc/ansible/ansible.cfgï¼Œä¸ºiniæ ¼å¼æ–‡ä»¶ã€‚</p><h3 id=é…ç½®ç¤ºä¾‹>é…ç½®ç¤ºä¾‹
<a class=anchor href=#%e9%85%8d%e7%bd%ae%e7%a4%ba%e4%be%8b>#</a></h3><p>â€‹ inventoryï¼šä¸»æœºæ¸…å•é…ç½®æ–‡ä»¶ä½ç½®ï¼Œåœ¨ä½¿ç”¨Ansibleå‘½ä»¤æ—¶ï¼Œä¹Ÿå¼€å§‹<code>-i &lt;path></code>æŒ‡å®šï¼›</p><p>â€‹ host_key_checkingï¼šå½“know_hostsä¸­ä¸å­˜åœ¨çš„ä¸»æœºï¼ˆå³å°šæœªè®¿é—®è¿‡çš„ä¸»æœºï¼Œæ˜¯å¦éœ€è¦è¾“å…¥å¯†é’¥ï¼‰ï¼›</p><p>â€‹ become_userï¼šsudoç”¨æˆ·ï¼›</p><p><img src=https://fs.poneding.com/images/image-20191126091436329.png alt=image-20191126091436329></p><h2 id=ä¸»æœºæ¸…å•inventory>ä¸»æœºæ¸…å•(Inventory)
<a class=anchor href=#%e4%b8%bb%e6%9c%ba%e6%b8%85%e5%8d%95inventory>#</a></h2><p>â€‹ åœ¨ä¸€ä¸ªiniæˆ–yamlæ–‡ä»¶ä¸­ç®¡ç†<code>Managed nodes</code>æ¸…å•ï¼Œé»˜è®¤å®‰è£…<code>ansible</code>åï¼Œåœ¨<code>/etc/ansible/hosts</code>æ–‡ä»¶ä¸­ç®¡ç†ï¼ˆåæ–‡ç»Ÿä¸€ç§°ä¹‹ä¸ºä¸»æœºæ¸…å•æ–‡ä»¶ï¼‰ï¼Œä¸€èˆ¬æ˜¯å°†<code>maneged nodes</code>çš„ip addressæˆ–host nameç­‰ä¿¡æ¯å­˜å‚¨åˆ°ä¸»æœºæ¸…å•æ–‡ä»¶ä¸­ã€‚</p><h3 id=formats>Formats
<a class=anchor href=#formats>#</a></h3><p>â€‹ ä¸»æœºæ¸…å•æ–‡ä»¶æ ¼å¼å…¼å®¹ä¸¤ç§ï¼š</p><ul><li><p>iniï¼Œå› ä¸ºé…ç½®æ–¹ä¾¿ç®€å•ï¼Œä¸€èˆ¬å¸¸é€‰ã€‚</p><pre tabindex=0><code>mail.example.com

[webservers]
foo.example.com
bar.example.com
</code></pre></li><li><p>yaml</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>all:
</span></span><span class=line><span class=cl>  hosts:
</span></span><span class=line><span class=cl>    mail.example.com:
</span></span><span class=line><span class=cl>  children:
</span></span><span class=line><span class=cl>    webservers:
</span></span><span class=line><span class=cl>      hosts:
</span></span><span class=line><span class=cl>        foo.example.com:
</span></span><span class=line><span class=cl>        bar.example.com:
</span></span></code></pre></div></li></ul><h3 id=hosts>Hosts
<a class=anchor href=#hosts>#</a></h3><p>â€‹ é…ç½®éœ€è¦ç®¡ç†çš„ä¸»æœºhost nameæˆ–ip addressã€‚</p><h3 id=group>Group
<a class=anchor href=#group>#</a></h3><p>â€‹ å¦‚æœæƒ³ç®¡ç†æŸä¸€æ‰¹ä¸»æœºï¼Œå¯ä»¥å°†è¿™å¤šä¸ªhosté…ç½®åˆ°ç»Ÿä¸€ä¸ªgroupä¸‹ã€‚æ–¹ä¾¿å¯¹è¿™ç»„ä¸»æœºçš„æ‰¹é‡ç®¡ç†ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>webserver<span class=o>]</span>
</span></span><span class=line><span class=cl>webserver01.com
</span></span><span class=line><span class=cl>webserver02.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>dbserver<span class=o>]</span>
</span></span><span class=line><span class=cl>dbserver01.com
</span></span><span class=line><span class=cl>dbserver02.com
</span></span></code></pre></div><h4 id=groupå˜é‡>Groupå˜é‡
<a class=anchor href=#group%e5%8f%98%e9%87%8f>#</a></h4><p>ä½œç”¨åœ¨groupä¸Šçš„å˜é‡ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>webserver<span class=o>]</span>
</span></span><span class=line><span class=cl>webserver01.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>webserver:vars<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>ansible_ssh_user</span><span class=o>=</span>ubuntu
</span></span></code></pre></div><h4 id=nested-group>Nested group
<a class=anchor href=#nested-group>#</a></h4><p>â€‹ ä¸€ä¸ªç»„åŒ…å«å…¶ä»–ç»„ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>allserver:children<span class=o>]</span>
</span></span><span class=line><span class=cl>webserver
</span></span><span class=line><span class=cl>dbserver
</span></span></code></pre></div><h3 id=inventoryå†…ç½®å‚æ•°>Inventoryå†…ç½®å‚æ•°
<a class=anchor href=#inventory%e5%86%85%e7%bd%ae%e5%8f%82%e6%95%b0>#</a></h3><table><thead><tr><th style=text-align:left>å‚æ•°å</th><th style=text-align:left>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td style=text-align:left>ansible_ssh_host</td><td style=text-align:left>å®šä¹‰ä¸»æœºçš„sshåœ°å€</td></tr><tr><td style=text-align:left>ansible_ssh_port</td><td style=text-align:left>å®šä¹‰ä¸»æœºçš„sshç«¯å£</td></tr><tr><td style=text-align:left>ansible_ssh_user</td><td style=text-align:left>å®šä¹‰ä¸»æœºçš„sshè®¤è¯ç”¨æˆ·</td></tr><tr><td style=text-align:left>ansible_ssh_pass</td><td style=text-align:left>å®šä¹‰ä¸»æœºçš„sshè®¤è¯å¯†ç </td></tr><tr><td style=text-align:left>ansible_sudo</td><td style=text-align:left>å®šä¹‰ä¸»æœºçš„sudoç”¨æˆ·</td></tr><tr><td style=text-align:left>ansible_sudo_pass</td><td style=text-align:left>å®šä¹‰ä¸»æœºçš„sudoå¯†ç </td></tr><tr><td style=text-align:left>ansible_sudo_exe</td><td style=text-align:left>å®šä¹‰ä¸»æœºçš„sudoè·¯å¾„</td></tr><tr><td style=text-align:left>ansible_connection</td><td style=text-align:left>å®šä¹‰ä¸»æœºè¿æ¥æ–¹å¼ï¼›ä¸ä¸»æœºçš„è¿æ¥ç±»å‹.æ¯”å¦‚ï¼šlocalï¼Œsshæˆ–è€…paramikoï¼›Ansible 1.2ä»¥å‰é»˜è®¤ä½¿ç”¨paramikoã€‚1.2ä»¥åçš„ç‰ˆæœ¬é»˜è®¤ä½¿ç”¨â€˜smartâ€™ï¼Œâ€˜smartâ€™æ–¹å¼ä¼šæ ¹æ®æ˜¯å¦æ”¯æŒControlPersistï¼Œæ¥åˆ¤æ–­sshæ–¹å¼æ˜¯å¦å¯è¡Œ</td></tr><tr><td style=text-align:left>ansible_ssh_private_key_file</td><td style=text-align:left>å®šä¹‰ä¸»æœºç§é’¥æ–‡ä»¶</td></tr><tr><td style=text-align:left>ansible_shell_type</td><td style=text-align:left>å®šä¹‰ä¸»æœºshellç±»å‹</td></tr><tr><td style=text-align:left>ansible_python_interpreter</td><td style=text-align:left>å®šä¹‰ä¸»æœºpythonè§£é‡Šå™¨è·¯å¾„</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>webserver<span class=o>]</span>
</span></span><span class=line><span class=cl>webserver01.com
</span></span><span class=line><span class=cl>webserver02.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>webserver:vars<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>ansible_ssh_private_key_file</span><span class=o>=</span>~/singapore.pem
</span></span></code></pre></div><h2 id=æ¨¡å—modules>æ¨¡å—(Modules)
<a class=anchor href=#%e6%a8%a1%e5%9d%97modules>#</a></h2><p>â€‹ AnsibleåŠŸèƒ½çš„å•å…ƒï¼Œä¸€ä¸ªAnsibleåŠŸèƒ½å¯¹åº”æœ‰ä¸€ä¸ªModuleã€‚</p><h3 id=å¸¸ç”¨æ¨¡å—>å¸¸ç”¨æ¨¡å—
<a class=anchor href=#%e5%b8%b8%e7%94%a8%e6%a8%a1%e5%9d%97>#</a></h3><h4 id=filehttpsdocsansiblecomansiblelatestmodulesfile_modulehtmlfile-module><a href=https://docs.ansible.com/ansible/latest/modules/file_module.html#file-module>file</a>
<a class=anchor href=#filehttpsdocsansiblecomansiblelatestmodulesfile_modulehtmlfile-module>#</a></h4><p>è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚åˆ›å»ºåˆ é™¤æ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶æƒé™ç­‰ã€‚</p><blockquote><ul><li>pathï¼šæ‰§è¡Œæ–‡ä»¶ã€ç›®å½•çš„è·¯å¾„</li><li>recurseï¼šé€’å½’è®¾ç½®æ–‡ä»¶å±æ€§ï¼Œåªå¯¹ç›®å½•æœ‰æ•ˆ</li><li>groupï¼šå®šä¹‰æ–‡ä»¶ã€ç›®å½•çš„å±ç»„</li><li>modeï¼šå®šä¹‰æ–‡ä»¶ã€ç›®å½•çš„æƒé™</li><li>ownerï¼šå®šä¹‰æ–‡ä»¶ã€ç›®å½•çš„æ‰€æœ‰è€…</li><li>srcï¼šè¦è¢«é“¾æ¥çš„æºæ–‡ä»¶è·¯å¾„ï¼Œåªåº”ç”¨ä¸stateä¸ºlinkçš„æƒ…å†µ</li><li>destï¼šè¢«é“¾æ¥åˆ°çš„è·¯å¾„ï¼Œåªåº”ç”¨äºstateä¸ºlinkçš„æƒ…å†µ</li><li>forceï¼šåœ¨ä¸¤ç§æƒ…å†µä¸‹ä¼šå¼ºåˆ¶åˆ›å»ºè½¯é“¾æ¥ï¼Œä¸€ç§æ˜¯æºæ–‡ä»¶ä¸å­˜åœ¨ä½†ä¹‹åä¼šå»ºç«‹çš„æƒ…å†µï¼›ä¸€ç§æ˜¯ç›®æ ‡è½¯é“¾æ¥å·²ç»å­˜åœ¨ï¼Œéœ€è¦å…ˆå–æ¶ˆä¹‹å‰çš„è½¯é“¾æ¥ï¼Œç„¶ååˆ›å»ºæ–°çš„è½¯é“¾æ¥ï¼Œé»˜è®¤å€¼ noã€‚</li></ul></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ansible servers -m file -a <span class=s1>&#39;path=~/temp state=directory&#39;</span>  <span class=c1># åˆ›å»ºç›®å½•</span>
</span></span><span class=line><span class=cl>ansible servers -m file -a <span class=s1>&#39;path=~/temp/test1.txt state=touch&#39;</span>  <span class=c1># åˆ›å»ºæ–‡ä»¶</span>
</span></span></code></pre></div><h4 id=copy-httpsdocsansiblecomansiblelatestmodulescopy_modulehtmlcopy-module-><a href=https://docs.ansible.com/ansible/latest/modules/copy_module.html#copy-module>copy</a>
<a class=anchor href=#copy-httpsdocsansiblecomansiblelatestmodulescopy_modulehtmlcopy-module->#</a></h4><p>å°†Control Nodeä¸Šçš„ç›®å½•æˆ–æ–‡ä»¶æ‹·è´è‡³Managed Nodesã€‚</p><blockquote><ul><li>srcï¼šæŒ‡å®šè¦å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶æˆ–ç›®å½•ã€‚å¦‚æœè·¯å¾„ä»¥ / ç»“å°¾ï¼Œåˆ™åªå¤åˆ¶ç›®å½•é‡Œçš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰ä»¥ / ç»“å°¾ï¼Œåˆ™å¤åˆ¶åŒ…å«ç›®å½•åœ¨å†…çš„æ•´ä¸ªå†…å®¹</li><li>destï¼šæ–‡ä»¶å¤åˆ¶çš„ç›®çš„åœ°ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œå¦‚æœæºæ–‡ä»¶æ˜¯ä¸€ä¸ªç›®å½•ï¼Œé‚£ä¹ˆdestæŒ‡å‘çš„ä¹Ÿå¿…é¡»æ˜¯ä¸€ä¸ªç›®å½•</li><li>forceï¼šé»˜è®¤å–å€¼ä¸ºyesï¼Œè¡¨ç¤ºç›®æ ‡ä¸»æœºåŒ…å«æ­¤æ–‡ä»¶ï¼Œä½†å†…å®¹ä¸åŒæ—¶ï¼Œè¦†ç›–ã€‚</li><li>backupï¼šé»˜è®¤å–å€¼ä¸ºnoï¼Œå¦‚æœä¸ºyesï¼Œåœ¨è¦†ç›–å‰å°†åŸæ–‡ä»¶è¿›è¡Œå¤‡ä»½</li><li>directory_modeï¼šé€’å½’è®¾å®šç›®å½•æƒé™ï¼Œé»˜è®¤ä¸ºç³»ç»Ÿé»˜è®¤æƒé™</li><li>othersï¼šæ‰€æœ‰fileæ¨¡å—é‡Œçš„é€‰é¡¹éƒ½å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨</li></ul></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>touch test2.txt
</span></span><span class=line><span class=cl>ansible servers -m copy -a <span class=s1>&#39;src=test2.txt dest=~/temp/test2.txt&#39;</span>  <span class=c1># æ‹·è´æ–‡ä»¶åˆ°æœåŠ¡å™¨</span>
</span></span></code></pre></div><h4 id=commandhttpsdocsansiblecomansiblelatestmodulescommand_modulehtmlcommand-module><a href=https://docs.ansible.com/ansible/latest/modules/command_module.html#command-module>command</a>
<a class=anchor href=#commandhttpsdocsansiblecomansiblelatestmodulescommand_modulehtmlcommand-module>#</a></h4><p>â€‹ ç›´æ¥è¦æ±‚ä¸»æœºæ¸…å•æ‰§è¡Œå‘½ä»¤ã€‚</p><pre tabindex=0><code>ansible servers -m command -a &#34;touch ~/temp/test3.txt&#34;
ansible servers -m command -a &#34;sudo apt update&#34;
ansible servers -m command -a &#34;sudo apt install nginx -y&#34;
ansible servers -m command -a &#34;sudo apt autoremove nginx -y&#34;
</code></pre><blockquote><p>ä¸æ”¯æŒshellå˜é‡ï¼Œå¦‚$NAME, &lt;,>,&,| ç­‰</p></blockquote><h4 id=shellhttpsdocsansiblecomansiblelatestmodulesshell_modulehtmlshell-module><a href=https://docs.ansible.com/ansible/latest/modules/shell_module.html#shell-module>shell</a>
<a class=anchor href=#shellhttpsdocsansiblecomansiblelatestmodulesshell_modulehtmlshell-module>#</a></h4><p>â€‹ å¯ä»¥å…ˆç¼–è¾‘shellè„šæœ¬ï¼Œç„¶åè¦æ±‚ä¸»æœºæ¸…å•æ‰§è¡Œshellè„šæœ¬é‡Œçš„å‘½ä»¤ã€‚</p><pre tabindex=0><code>- name: Execute the command in remote shell; stdout goes to the specified file on the remote.
  shell: somescript.sh &gt;&gt; somelog.txt

- name: Change the working directory to somedir/ before executing the command.
  shell: somescript.sh &gt;&gt; somelog.txt
  args:
    chdir: somedir/
</code></pre><blockquote><p>æ³¨æ„ï¼šshellè„šæœ¬å¿…é¡»æœ‰å¯æ‰§è¡Œçš„æƒé™</p><pre tabindex=0><code>    - name: &#39;chmod shell&#39;
      command: chmod 777 somedir/somescript.sh
</code></pre></blockquote><h4 id=apt-httpsdocsansiblecomansiblelatestmodulesapt_modulehtmlapt-module-><a href=https://docs.ansible.com/ansible/latest/modules/apt_module.html#apt-module>apt</a>
<a class=anchor href=#apt-httpsdocsansiblecomansiblelatestmodulesapt_modulehtmlapt-module->#</a></h4><p>â€‹ ubuntu/debian åŒ…ã€åº”ç”¨ç®¡ç†ã€‚</p><blockquote><p><strong>update_cache</strong> : yes/noï¼Œé»˜è®¤noï¼Œæ“ä½œä¹‹å‰æ˜¯å¦ apt-get update</p><p><strong>state</strong> ï¼š</p><ul><li>absent : ç§»é™¤</li><li>latest ï¼šæœ€æ–°</li><li>present: ç›®å‰ç¨³å®šçš„ï¼Œé»˜è®¤</li></ul><p><strong>autoremove</strong> :yes/no,é»˜è®¤noï¼Œç§»é™¤ä¾èµ–</p><p><strong>autoclean</strong> ï¼šyes/no,é»˜è®¤noï¼Œç§»é™¤ç¼“å­˜</p></blockquote><pre tabindex=0><code>ansible servers -m apt -a &#34;name=nginx update_cache=yes&#34; -b

# append to playbook
- name: Install nginx
  apt:
    name: nginx
    state: latest
    update_cache: yes
    
ansible servers -m apt -a &#34;name=nginx state=absent autoremove=yes autoclean=yes&#34; -b
</code></pre><h4 id=yum>yum
<a class=anchor href=#yum>#</a></h4><p>â€‹ CentOsç®¡ç†ç¨‹åºåŒ…ã€‚</p><h4 id=servicehttpsdocsansiblecomansiblelatestmodulesservice_modulehtmlservice-module><a href=https://docs.ansible.com/ansible/latest/modules/service_module.html#service-module>service</a>
<a class=anchor href=#servicehttpsdocsansiblecomansiblelatestmodulesservice_modulehtmlservice-module>#</a></h4><p>â€‹ ç®¡ç†æœåŠ¡çš„æ¨¡å—ï¼Œç”¨æ¥å¯åŠ¨ã€åœæ­¢ã€é‡å¯æœåŠ¡ã€‚</p><blockquote><p><strong>enabled</strong> :yes/noï¼Œé»˜è®¤no.æ˜¯å¦å¼€æœºå¯åŠ¨ã€‚</p><p><strong>name</strong> ï¼šæœåŠ¡å</p><p><strong>state</strong> ï¼š</p><ul><li>reloaded</li><li>restarted</li><li>started</li><li>stopped</li></ul><p><strong>sleep</strong> ï¼šå¦‚æœæ˜¯restartedï¼Œéœ€è¦ç­‰å¾…å¤šé•¿ç§’åå†é‡å¯ å¦‚ï¼š10ï¼Œç­‰å¾…10ç§’åé‡å¯</p></blockquote><pre tabindex=0><code>ansible servers -m service -a &#34;name=nginx state=started&#34;

# playbook
- name: Start service nginx, if not started
  service:
    name: nginx
    state: started
    
ansible servers -m service -a &#34;name=nginx state=stoped&#34;
</code></pre><h4 id=unarchive>unarchive
<a class=anchor href=#unarchive>#</a></h4><p>â€‹ è§£å‹ç¼©ã€‚</p><h4 id=git>git
<a class=anchor href=#git>#</a></h4><ul><li><p>Managedéœ€è¦å·²ç»å®‰è£…gitã€‚</p></li><li><p>æ‰§è¡Œgitç›¸å…³æ“ä½œã€‚</p></li></ul><h2 id=ä»»åŠ¡tasks>ä»»åŠ¡(Tasks)
<a class=anchor href=#%e4%bb%bb%e5%8a%a1tasks>#</a></h2><p>â€‹ Ansibleæ‰§è¡Œçš„å•å…ƒï¼Œä¸€èˆ¬æ”¾åœ¨Playbookä¸­ï¼Œå¤šä¸ªTaskä¸€èµ·æ‰§è¡Œï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œå¯å¤ç”¨ã€‚</p><p>â€‹ å®šä¹‰æ–¹å¼ï¼š</p><pre tabindex=0><code>-name: names
  module: action 
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>- name: ansible-playbook demo
</span></span><span class=line><span class=cl>  hosts: servers
</span></span><span class=line><span class=cl>  tasks:
</span></span><span class=line><span class=cl>    - name: create temp dir
</span></span><span class=line><span class=cl>      file:
</span></span><span class=line><span class=cl>        path: ~/temp
</span></span><span class=line><span class=cl>        state: directory
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    - name: create test1.txt
</span></span><span class=line><span class=cl>      file:
</span></span><span class=line><span class=cl>        path: ~/temp/test1.txt
</span></span><span class=line><span class=cl>        state: touch
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    - name: copy test2.txt
</span></span><span class=line><span class=cl>      copy:
</span></span><span class=line><span class=cl>        src: test2.txt
</span></span><span class=line><span class=cl>        dest: ~/temp/test2.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    - name: copy test.sh
</span></span><span class=line><span class=cl>      copy:
</span></span><span class=line><span class=cl>        src: test.sh
</span></span><span class=line><span class=cl>        dest: ~/temp/test.sh 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    - name: <span class=s1>&#39;chmod shell&#39;</span>
</span></span><span class=line><span class=cl>      command: chmod <span class=m>777</span> ~/temp/test.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    - name: <span class=nb>exec</span> shell
</span></span><span class=line><span class=cl>      shell: ~/temp/test.sh
</span></span><span class=line><span class=cl>      args:
</span></span><span class=line><span class=cl>        executable: /bin/bash
</span></span></code></pre></div><h2 id=ansibleç”¨æ³•>Ansibleç”¨æ³•
<a class=anchor href=#ansible%e7%94%a8%e6%b3%95>#</a></h2><h3 id=ansibleå‘½ä»¤>ansibleå‘½ä»¤
<a class=anchor href=#ansible%e5%91%bd%e4%bb%a4>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ansible &lt;hosts&gt; -m &lt;module_name&gt; -a &lt;arguments&gt; -i &lt;hosts_path&gt;
</span></span></code></pre></div><blockquote><p>hosts:</p><ul><li>all æˆ– *ï¼Œæ‰€æœ‰hostsæ–‡ä»¶ä¸­é…ç½®çš„ä¸»æœº</li><li>ip address</li><li>host name</li><li>group name</li><li>å¤šä¸ªhostæˆ–groupå¯ç”¨ï¼šåˆ†éš”</li><li>æ”¯æŒæ­£åˆ™åŒ¹é…ï¼šå¦‚é…ç½®äº†ä¸€ä¸ªwebserverçš„ä¸»æœºï¼Œå¯ç”¨ansible ~web* -m pingåŒ¹é…åˆ°</li></ul><p>module_nameï¼šä¾‹å¦‚pingï¼Œcommandï¼Œaptçš„ä»»åŠ¡æ¨¡å—</p><p>arguments: æ‰§è¡Œmoduleçš„å‚æ•°ï¼Œä¾‹å¦‚ <code>ansible -m command -a "touch hello.txt"</code></p><p>hosts_pathï¼šä¸»æœºæ¸…å•æ–‡ä»¶ä½ç½®ï¼Œé»˜è®¤/etc/ansible/etcï¼Œä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®š</p></blockquote><h4 id=ansibleå‘½ä»¤å‚æ•°>Ansibleå‘½ä»¤å‚æ•°
<a class=anchor href=#ansible%e5%91%bd%e4%bb%a4%e5%8f%82%e6%95%b0>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>-h<span class=o>]</span>  <span class=c1># å¸®åŠ©</span>
</span></span><span class=line><span class=cl><span class=o>[</span>--version<span class=o>]</span>  <span class=c1># Ansibleç‰ˆæœ¬</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-v<span class=o>]</span>  <span class=c1># verbost</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-b<span class=o>]</span>  <span class=c1># sudoè¿è¡Œï¼Œå¯ä»¥ä»¥sudoæƒé™è¿è¡Œ</span>
</span></span><span class=line><span class=cl><span class=o>[</span>--become-method BECOME_METHOD<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>--become-user BECOME_USER<span class=o>]</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>-K<span class=o>]</span>  <span class=c1># æç¤ºè¾“å…¥sudoå¯†ç ï¼Œå½“ä¸æ˜¯NOPASSWDæ¨¡å¼æ—¶ä½¿ç”¨</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-i INVENTORY<span class=o>]</span>  <span class=c1># æŒ‡å®šhostsæ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤default=/etc/ansible/hosts</span>
</span></span><span class=line><span class=cl><span class=o>[</span>--list-hosts<span class=o>]</span> <span class=c1># æ‰“å°æœ‰ä¸»æœºåˆ—è¡¨</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-o<span class=o>]</span>  <span class=c1># å‹ç¼©è¾“å‡ºï¼Œæ‘˜è¦è¾“å‡º</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-t TREE<span class=o>]</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>-k<span class=o>]</span> <span class=c1># æç¤ºè¾“å…¥sshç™»å½•å¯†ç ã€‚å½“ä½¿ç”¨å¯†ç éªŒè¯çš„æ—¶å€™ç”¨</span>
</span></span><span class=line><span class=cl><span class=o>[</span>--private-key PRIVATE_KEY_FILE<span class=o>]</span>  <span class=c1># sshè¿æ¥çš„ç§é’¥æ–‡ä»¶ä½ç½®</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-u REMOTE_USER<span class=o>]</span> <span class=c1># sshè¿æ¥çš„ç”¨æˆ·åï¼Œé»˜è®¤ç”¨rootï¼Œansible.cfgä¸­å¯ä»¥é…ç½®</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-c CONNECTION<span class=o>]</span>  <span class=c1># è¿æ¥ç±»å‹ï¼ˆdefault=smartï¼‰ï¼Œä¾‹å¦‚è¿˜æœ‰local</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-T TIMEOUT<span class=o>]</span> <span class=c1># è¶…æ—¶é™åˆ¶</span>
</span></span><span class=line><span class=cl><span class=o>[</span>--ask-vault-pass <span class=p>|</span> --vault-password-file VAULT_PASSWORD_FILES<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-f FORKS<span class=o>]</span>   <span class=c1># forkå¤šå°‘ä¸ªè¿›ç¨‹å¹¶å‘å¤„ç†ï¼Œé»˜è®¤ä¸º5ä¸ª</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-M MODULE_PATH<span class=o>]</span>  <span class=c1># æ¨¡å—çš„æ‰§è¡Œæ–‡ä»¶ä½ç½®ï¼Œä¸€èˆ¬ç”¨äºæ‰©å±•æ¨¡å—</span>
</span></span><span class=line><span class=cl><span class=o>[</span>--playbook-dir BASEDIR<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-a MODULE_ARGS<span class=o>]</span>  <span class=c1># æ¨¡å—çš„å‚æ•°</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-m MODULE_NAME<span class=o>]</span> <span class=c1># è¦æ‰§è¡Œçš„æ¨¡å—ï¼Œé»˜è®¤ä¸ºcommand</span>
</span></span></code></pre></div><h3 id=anisble-playbook>Anisble playbook
<a class=anchor href=#anisble-playbook>#</a></h3><p>â€‹ é¢„å…ˆå®šä¹‰å¥½æ‰€æœ‰éœ€è¦æ‰§è¡Œçš„æ“ä½œï¼Œå½¢æˆä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œæ‰§è¡Œè¯¥è„šæœ¬æ–‡ä»¶å³å¯ï¼Œæ–¹ä¾¿ç®¡ç†å’Œå¤ç”¨ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ansible-playbook -i &lt;hosts_path&gt; &lt;playbook_path&gt;
</span></span></code></pre></div><blockquote><p>hosts_pathï¼šä¸»æœºæ¸…å•æ–‡ä»¶ä½ç½®</p><p>playbook_path: playbook yamlæ–‡ä»¶ä½ç½®</p><p>-Cï¼šåŠ åœ¨ansible-playbookå‘½ä»¤åï¼Œç”¨äºéªŒè¯palybookæ–‡ä»¶æ˜¯å¦æœ‰è¯¯</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>- name: Install prometheus on ubuntu
</span></span><span class=line><span class=cl>  hosts: prometheus
</span></span><span class=line><span class=cl>  become: yes
</span></span><span class=line><span class=cl>  tasks:
</span></span><span class=line><span class=cl>    - name: <span class=s2>&#34;Step 1: Import prometheus public GPG Key&#34;</span>
</span></span><span class=line><span class=cl>      apt_key:
</span></span><span class=line><span class=cl>        url: https://s3-eu-west-1.amazonaws.com/deb.robustperception.io/41EFC99D.gpg
</span></span><span class=line><span class=cl>        state: present
</span></span><span class=line><span class=cl>    - name: <span class=s2>&#34;Step 2: Reload local package database&#34;</span>
</span></span><span class=line><span class=cl>      apt: 
</span></span><span class=line><span class=cl>        update_cache: yes
</span></span><span class=line><span class=cl>    - name: <span class=s2>&#34;Step 3: Install prometheus&#34;</span>
</span></span><span class=line><span class=cl>      apt:
</span></span><span class=line><span class=cl>        name: prometheus
</span></span><span class=line><span class=cl>        update_cache: yes
</span></span><span class=line><span class=cl>    - name: <span class=s2>&#34;Step 4: Install prometheus-node-exporter&#34;</span>
</span></span><span class=line><span class=cl>      apt:
</span></span><span class=line><span class=cl>        name: prometheus-node-exporter
</span></span><span class=line><span class=cl>        update_cache: yes
</span></span><span class=line><span class=cl>    - name: <span class=s2>&#34;Step 5: Install prometheus-pushgateway&#34;</span>
</span></span><span class=line><span class=cl>      apt:
</span></span><span class=line><span class=cl>        name: prometheus-pushgateway
</span></span><span class=line><span class=cl>        update_cache: yes
</span></span><span class=line><span class=cl>    - name: <span class=s2>&#34;Step 6: Install prometheus-alertmanager&#34;</span>
</span></span><span class=line><span class=cl>      apt:
</span></span><span class=line><span class=cl>        name: prometheus-alertmanager
</span></span><span class=line><span class=cl>        update_cache: yes
</span></span><span class=line><span class=cl>    - name: <span class=s2>&#34;Step 7: Start prometheus service&#34;</span>
</span></span><span class=line><span class=cl>      service:
</span></span><span class=line><span class=cl>        name: prometheus
</span></span><span class=line><span class=cl>        enabled: yes
</span></span><span class=line><span class=cl>        state: started
</span></span></code></pre></div><h4 id=playbook-å‚æ•°>playbook å‚æ•°
<a class=anchor href=#playbook-%e5%8f%82%e6%95%b0>#</a></h4><blockquote><p><strong>name</strong> ï¼šæ ‡è¯†plaoybookæ–‡ä»¶æ‰§è¡Œå†…å®¹</p><p><strong>hosts</strong>: inventory</p><p><strong>become</strong>: yes/noï¼Œé»˜è®¤noï¼Œæ˜¯å¦ä½¿ç”¨sudoæ‰§è¡Œ</p><p><strong>tasks</strong> : é¢„å…ˆå®šä¹‰å¥½çš„ansibleå‘½ä»¤ï¼Œmanaged nodeå°†ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ</p><p><strong>handles</strong>: ä½¿ç”¨notifyè§¦å‘</p><pre tabindex=0><code> # ä¿®æ”¹nginxé…ç½®åï¼Œè®¾ç½®é‡å¯
 - name: write the nginx config file
    template: src=/somepath/nginx.j2 dest=/data/nginx/conf/nginx.conf
    notify:
    - restart nginx
  handlers:
  - name: enable nginx
    service: name=nginx state=restarted
</code></pre><p><strong>when</strong>: å½“æ»¡è¶³æ¡ä»¶æ—¶æ‰æ‰§è¡Œï¼Œå¤šæ¡ä»¶å¯ä»¥ä½¿ç”¨andã€or</p><pre tabindex=0><code>tasks:
  - name: &#34;shut down Debian flavored systems&#34;
    command: /sbin/shutdown -t now
    when: ansible_os_family == &#34;Debian&#34;
</code></pre></blockquote><p>å¸¸ç”¨ç”¨æ³•**ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># --list-hosts(ç®€å†™ä¸º--list)</span>
</span></span><span class=line><span class=cl>ansible webserver --list-hosts 
</span></span></code></pre></div><h2 id=ansibleåŸç†>AnsibleåŸç†
<a class=anchor href=#ansible%e5%8e%9f%e7%90%86>#</a></h2><p><img src=https://fs.poneding.com/images/image-20191128160037603.png alt=image-20191128160037603></p><blockquote><p>ansibleå‘½ä»¤</p><p>ansibleå‘½ä»¤æ‰€ä½¿ç”¨çš„æ¨¡å—ï¼Œå‚æ•°</p></blockquote><h2 id=æ¼”ç¤º>æ¼”ç¤º
<a class=anchor href=#%e6%bc%94%e7%a4%ba>#</a></h2><ul><li>ansible.cfg</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>host_key_checking</span> <span class=o>=</span> False
</span></span><span class=line><span class=cl><span class=nv>remote_tmp</span> <span class=o>=</span> /tmp/.ansible-<span class=si>${</span><span class=nv>USER</span><span class=si>}</span>/tmp
</span></span></code></pre></div><ul><li>hostsä¸»æœºæ¸…å•</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>ubuntu:vars<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>ansible_ssh_private_key_file</span><span class=o>=</span>~/singapore.pem
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>ubuntu<span class=o>]</span>
</span></span><span class=line><span class=cl>172.30.2.252 <span class=nv>ansible_ssh_user</span><span class=o>=</span>ubuntu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>mysql:vars<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>ansible_private_key_file</span><span class=o>=</span>~/dev-mysql.pem
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>mysql<span class=o>]</span>
</span></span><span class=line><span class=cl>172.31.22.159 <span class=nv>ansible_ssh_user</span><span class=o>=</span>ubuntu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>servers:children<span class=o>]</span>
</span></span><span class=line><span class=cl>ubuntu
</span></span><span class=line><span class=cl>mysql
</span></span></code></pre></div><ul><li>ansibleæ“ä½œ</li></ul><p><a href=https://docs.ansible.com/ansible/latest/modules/list_of_files_modules.html>æ–‡ä»¶æ“ä½œ</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># åˆ›å»ºç›®å½•</span>
</span></span><span class=line><span class=cl>ansible servers -m file -a <span class=s1>&#39;path=~/temp state=directory mode=0755&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»ºæ–‡ä»¶</span>
</span></span><span class=line><span class=cl>ansible servers -m file -a <span class=s1>&#39;path=~/temp/test1.txt state=touch&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Control Nodeåˆ†å‘æ–‡ä»¶è‡³Managed Nodes</span>
</span></span><span class=line><span class=cl>ansible servers -m copy -a <span class=s1>&#39;src=index.html dest=~/temp/test2.txt&#39;</span>
</span></span></code></pre></div><h2 id=è¸©å‘è®°å½•>è¸©å‘è®°å½•
<a class=anchor href=#%e8%b8%a9%e5%9d%91%e8%ae%b0%e5%bd%95>#</a></h2><ul><li><p>é—®é¢˜1</p><p>è¿æ¥awsçš„linuxå®ä¾‹æ—¶ï¼Œéœ€è¦åœ¨/etc/ansible/hostså®šä¹‰çš„å‚æ•°</p><pre tabindex=0><code>[ubuntu:vars]
ansible_private_key_file=/home/ubuntu/singapore.pem

[ubuntu]
192.168.0.1 ansible_ssh_user=ubuntu
</code></pre></li><li><p>é—®é¢˜2</p><p>ä½¿ç”¨dockeråˆ›å»ºå¯ä»¥sshè¿æ¥çš„ubuntuå®¹å™¨ï¼Œæ— æ³•ä½¿ç”¨rootè¿æ¥ï¼Œä½†æ˜¯ä½¿ç”¨å…¶ä»–useræ—¶ï¼Œåœ¨<code>ansible local -m ping</code>æ—¶ä¹Ÿä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜ã€‚</p><pre tabindex=0><code>Authentication or permission failure.  In some cases, you may have been able to authenticate and did not have permissions on the remote directory. Consider changing the remote temp path in ansible.cfg to a path rooted in &#34;/tmp&#34;....
</code></pre><p>å…¶å®ä¸Šé¢çš„ä¿¡æ¯å·²ç»æœ‰äº†ä¸€äº›æç¤ºï¼Œä¿®æ”¹/etc/ansible/ansible.cfgçš„remote_tmpé…ç½®</p><pre tabindex=0><code>remote_tmp     = /tmp/.ansible-${USER}/tmp
</code></pre></li><li><p>é—®é¢˜3</p><p>å¦‚æœåœ¨ä½¿ç”¨pemæ–‡ä»¶è¿æ¥æœåŠ¡å™¨æ—¶é‡åˆ°<code>Permissions 0664 for '/home/ubuntu/dev-mysql.pem' are too open.\r\nIt is required that your private key files are NOT accessible by others.</code>é—®é¢˜ã€‚</p><p>ä¿®æ”¹æ–‡ä»¶æƒé™å³å¯</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo chmod <span class=m>400</span> /path/to/file.pem
</span></span></code></pre></div></li><li><p>é—®é¢˜4</p><p>Failed to lock apt for exclusive operation</p><p>æ·»åŠ </p><pre tabindex=0><code>become: yes
</code></pre></li></ul><h2 id=å…¶ä»–>å…¶ä»–
<a class=anchor href=#%e5%85%b6%e4%bb%96>#</a></h2><h3 id=é¢„ç¼–è¯‘>é¢„ç¼–è¯‘
<a class=anchor href=#%e9%a2%84%e7%bc%96%e8%af%91>#</a></h3><h3 id=pythonçš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜>pythonçš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜
<a class=anchor href=#python%e7%9a%84%e7%89%88%e6%9c%ac%e5%85%bc%e5%ae%b9%e9%97%ae%e9%a2%98>#</a></h3><p>ansible v2.7åŠæ›´é«˜ç‰ˆæœ¬é»˜è®¤ä¼˜å…ˆæ”¯æŒpython3ï¼Œå¦‚æœå¯¹ç‰¹å®šçš„hostæ”¯æŒå•ç‹¬çš„pythonç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®<code>ansible_python_interpreter</code> inventoryå‚æ•°è®¾ç½®ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>webservers<span class=o>]</span>
</span></span><span class=line><span class=cl>webserver1.com <span class=nv>ansible_python_interpreter</span><span class=o>=</span>/usr/bin/python2.4
</span></span></code></pre></div><h3 id=å·¥å…·å¯¹æ¯”>å·¥å…·å¯¹æ¯”
<a class=anchor href=#%e5%b7%a5%e5%85%b7%e5%af%b9%e6%af%94>#</a></h3><h2 id=å‚è€ƒ>å‚è€ƒ
<a class=anchor href=#%e5%8f%82%e8%80%83>#</a></h2><p><a href=https://juejin.im/entry/5c48751fe51d45731470c6eb>Ansibleå…¥é—¨</a></p><p><a href=https://docs.ansible.com/ansible/latest/index.html>Ansible Docs</a></p><hr><p><a href=/devops/agile/>Â« Agile</a></p><p><a href=/devops/bule-green-rollback-gray/>Â» è“ç»¿éƒ¨ç½²ã€æ»šåŠ¨éƒ¨ç½²å’Œç°åº¦éƒ¨ç½²</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/poneding/blog/commit/5faa4f1be5d4525c49e513962394eae7c15fb6f2 title='æœ€åä¿®æ”¹è€… poneding | 2024/06/13' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt>
<span>2024/06/13</span></a></div><div><a class="flex align-center" href=https://github.com/poneding/blog/edit/master/content/devops/ansible.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>ç¼–è¾‘æœ¬é¡µ</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=poneding/blog data-repo-id=R_kgDOMITIHg data-category=General data-category-id=DIC_kwDOMITIHs4CgB4x data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#ä»‹ç»>ä»‹ç»</a><ul><li><a href=#ç‰¹ç‚¹>ç‰¹ç‚¹</a></li></ul></li><li><a href=#å®‰è£…>å®‰è£…</a></li><li><a href=#ä¸»è¦æ¦‚å¿µ>ä¸»è¦æ¦‚å¿µ</a></li><li><a href=#ansibleé…ç½®>Ansibleé…ç½®</a><ul><li><a href=#é…ç½®ç¤ºä¾‹>é…ç½®ç¤ºä¾‹</a></li></ul></li><li><a href=#ä¸»æœºæ¸…å•inventory>ä¸»æœºæ¸…å•(Inventory)</a><ul><li><a href=#formats>Formats</a></li><li><a href=#hosts>Hosts</a></li><li><a href=#group>Group</a></li><li><a href=#inventoryå†…ç½®å‚æ•°>Inventoryå†…ç½®å‚æ•°</a></li></ul></li><li><a href=#æ¨¡å—modules>æ¨¡å—(Modules)</a><ul><li><a href=#å¸¸ç”¨æ¨¡å—>å¸¸ç”¨æ¨¡å—</a></li></ul></li><li><a href=#ä»»åŠ¡tasks>ä»»åŠ¡(Tasks)</a></li><li><a href=#ansibleç”¨æ³•>Ansibleç”¨æ³•</a><ul><li><a href=#ansibleå‘½ä»¤>ansibleå‘½ä»¤</a></li><li><a href=#anisble-playbook>Anisble playbook</a></li></ul></li><li><a href=#ansibleåŸç†>AnsibleåŸç†</a></li><li><a href=#æ¼”ç¤º>æ¼”ç¤º</a></li><li><a href=#è¸©å‘è®°å½•>è¸©å‘è®°å½•</a></li><li><a href=#å…¶ä»–>å…¶ä»–</a><ul><li><a href=#é¢„ç¼–è¯‘>é¢„ç¼–è¯‘</a></li><li><a href=#pythonçš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜>pythonçš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜</a></li><li><a href=#å·¥å…·å¯¹æ¯”>å·¥å…·å¯¹æ¯”</a></li></ul></li><li><a href=#å‚è€ƒ>å‚è€ƒ</a></li></ul></nav></div></aside></main></body></html>