<!doctype html><html lang=cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ğŸ  é¦–é¡µ / Kubernetes / Kustomize
Kustomize # Kustomize æ˜¯ä¸€ä¸ªé€šè¿‡ kustomization æ–‡ä»¶ å®šåˆ¶ Kubernetes å¯¹è±¡çš„å·¥å…·ã€‚å®ƒæä¾›ä»¥ä¸‹åŠŸèƒ½ç‰¹æ€§æ¥ç®¡ç†åº”ç”¨é…ç½®æ–‡ä»¶ï¼š
ä»å…¶ä»–æ¥æºç”Ÿæˆèµ„æº ä¸ºèµ„æºè®¾ç½®è´¯ç©¿æ€§ï¼ˆCross-Cuttingï¼‰å­—æ®µ ç»„ç»‡å’Œå®šåˆ¶èµ„æºé›†åˆ ä» 1.14 ç‰ˆæœ¬å¼€å§‹ï¼Œkubectl ä¹Ÿå¼€å§‹æ”¯æŒä½¿ç”¨ kustomization æ–‡ä»¶æ¥ç®¡ç† Kubernetes å¯¹è±¡ã€‚ è¦æŸ¥çœ‹åŒ…å« kustomization æ–‡ä»¶çš„ç›®å½•ä¸­çš„èµ„æºï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š
kubectl kustomize <kustomization_directory> è¦åº”ç”¨è¿™äº›èµ„æºï¼Œä½¿ç”¨ --kustomize æˆ– -k å‚æ•°æ¥æ‰§è¡Œ kubectl applyï¼š
kubectl apply -k <kustomization_directory> ç”Ÿæˆèµ„æº # ConfigMap å’Œ Secret åŒ…å«å…¶ä»– Kubernetes å¯¹è±¡ï¼ˆå¦‚ Podï¼‰æ‰€éœ€è¦çš„é…ç½®æˆ–æ•æ„Ÿæ•°æ®ã€‚ ConfigMap æˆ– Secret ä¸­æ•°æ®çš„æ¥æºå¾€å¾€æ˜¯é›†ç¾¤å¤–éƒ¨ï¼Œä¾‹å¦‚æŸä¸ª .properties æ–‡ä»¶æˆ–è€… SSH å¯†é’¥æ–‡ä»¶ã€‚ Kustomize æä¾› secretGenerator å’Œ configMapGeneratorï¼Œå¯ä»¥åŸºäºæ–‡ä»¶æˆ–å­—é¢å€¼æ¥ç”Ÿæˆ Secret å’Œ ConfigMapã€‚
configMapGenerator # è¦åŸºäºæ–‡ä»¶æ¥ç”Ÿæˆ ConfigMapï¼Œå¯ä»¥åœ¨ configMapGenerator çš„ files åˆ—è¡¨ä¸­æ·»åŠ è¡¨é¡¹ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ ¹æ® ."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://blog.poneding.com/kubernetes/kustomize/"><meta property="og:site_name" content="ç§‹æ²³è½å¶"><meta property="og:title" content="ç§‹æ²³è½å¶"><meta property="og:description" content="ğŸ  é¦–é¡µ / Kubernetes / Kustomize
Kustomize # Kustomize æ˜¯ä¸€ä¸ªé€šè¿‡ kustomization æ–‡ä»¶ å®šåˆ¶ Kubernetes å¯¹è±¡çš„å·¥å…·ã€‚å®ƒæä¾›ä»¥ä¸‹åŠŸèƒ½ç‰¹æ€§æ¥ç®¡ç†åº”ç”¨é…ç½®æ–‡ä»¶ï¼š
ä»å…¶ä»–æ¥æºç”Ÿæˆèµ„æº ä¸ºèµ„æºè®¾ç½®è´¯ç©¿æ€§ï¼ˆCross-Cuttingï¼‰å­—æ®µ ç»„ç»‡å’Œå®šåˆ¶èµ„æºé›†åˆ ä» 1.14 ç‰ˆæœ¬å¼€å§‹ï¼Œkubectl ä¹Ÿå¼€å§‹æ”¯æŒä½¿ç”¨ kustomization æ–‡ä»¶æ¥ç®¡ç† Kubernetes å¯¹è±¡ã€‚ è¦æŸ¥çœ‹åŒ…å« kustomization æ–‡ä»¶çš„ç›®å½•ä¸­çš„èµ„æºï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š
kubectl kustomize <kustomization_directory> è¦åº”ç”¨è¿™äº›èµ„æºï¼Œä½¿ç”¨ --kustomize æˆ– -k å‚æ•°æ¥æ‰§è¡Œ kubectl applyï¼š
kubectl apply -k <kustomization_directory> ç”Ÿæˆèµ„æº # ConfigMap å’Œ Secret åŒ…å«å…¶ä»– Kubernetes å¯¹è±¡ï¼ˆå¦‚ Podï¼‰æ‰€éœ€è¦çš„é…ç½®æˆ–æ•æ„Ÿæ•°æ®ã€‚ ConfigMap æˆ– Secret ä¸­æ•°æ®çš„æ¥æºå¾€å¾€æ˜¯é›†ç¾¤å¤–éƒ¨ï¼Œä¾‹å¦‚æŸä¸ª .properties æ–‡ä»¶æˆ–è€… SSH å¯†é’¥æ–‡ä»¶ã€‚ Kustomize æä¾› secretGenerator å’Œ configMapGeneratorï¼Œå¯ä»¥åŸºäºæ–‡ä»¶æˆ–å­—é¢å€¼æ¥ç”Ÿæˆ Secret å’Œ ConfigMapã€‚
configMapGenerator # è¦åŸºäºæ–‡ä»¶æ¥ç”Ÿæˆ ConfigMapï¼Œå¯ä»¥åœ¨ configMapGenerator çš„ files åˆ—è¡¨ä¸­æ·»åŠ è¡¨é¡¹ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ ¹æ® ."><meta property="og:locale" content="cn"><meta property="og:type" content="article"><meta property="article:section" content="kubernetes"><meta property="article:modified_time" content="2024-06-13T15:37:18+08:00"><title>Kustomize | ç§‹æ²³è½å¶</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/logo.png><link rel=canonical href=https://blog.poneding.com/kubernetes/kustomize/><link rel=stylesheet href=/book.min.4964903a822a7acb10dac6d1ab524833c97fb5f99b141976bcb8a47d539be9c0.css integrity="sha256-SWSQOoIqessQ2sbRq1JIM8l/tfmbFBl2vLikfVOb6cA=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/cn.search.min.6e539ae72e8c3ebaf673623e091da36b956e4aaf00c542396b36d91e641d85cc.js integrity="sha256-blOa5y6MPrr2c2I+CR2ja5VuSq8AxUI5azbZHmQdhcw=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><link rel=stylesheet href=/css/syntax.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>ç§‹æ²³è½å¶</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=æœç´¢ aria-label=æœç´¢ maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><p>ğŸ¦‰ é›†ä¸­èµ·æ¥çš„æ„å¿—å¯ä»¥å‡»ç©¿é¡½çŸ³ã€‚</p><hr><ul><li><p><a href=/><strong>ğŸ  é¦–é¡µ</strong></a></p></li><li><p><strong>ğŸ“Œ ç½®é¡¶æ–‡ç« </strong></p><ul><li><a href=/git/common-usage/>Git å¸¸ç”¨</a></li><li><a href=/kubernetes/kubeadm-install-k8s-docker/>å®‰è£… Kubernetes (Docker)</a></li></ul></li><li><p><strong>ğŸ“Œ ç½®é¡¶åˆ†ç±»</strong></p><ul><li><a href=/go/>Golang ç¼–ç¨‹</a></li><li><a href=/kubernetes/>Kubernetes</a></li><li><a href=/rust/>Rust ç¼–ç¨‹</a></li><li><a href=/git/>Git</a></li></ul></li></ul><hr><ul><li><strong>ğŸ—ƒï¸ å¼€æºé¡¹ç›®</strong><ul><li><a href=https://github.com/ketches/registry-proxy>registry-proxy</a></li><li><a href=https://github.com/poneding/mdi>mdi</a></li></ul></li></ul><hr><ul><li><a href=https://github.com/poneding target=_blank rel=noopener>ğŸ™ GitHub</a></li><li><a href=mailto:poneding@gmail.com target=_blank rel=noopener>ğŸ“¬ é‚®ç®±</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Kustomize</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#ç”Ÿæˆèµ„æº>ç”Ÿæˆèµ„æº</a><ul><li><a href=#configmapgenerator>configMapGenerator</a></li><li><a href=#è®¾ç½®è´¯ç©¿æ€§å­—æ®µ>è®¾ç½®è´¯ç©¿æ€§å­—æ®µ</a></li><li><a href=#ç»„ç»‡å’Œå®šåˆ¶èµ„æº>ç»„ç»‡å’Œå®šåˆ¶èµ„æº</a></li></ul></li><li><a href=#åŸºå‡†basesä¸è¦†ç›–overlays>åŸºå‡†ï¼ˆBasesï¼‰ä¸è¦†ç›–ï¼ˆOverlaysï¼‰</a></li><li><a href=#å¦‚ä½•ä½¿ç”¨-kustomize-æ¥åº”ç”¨æŸ¥çœ‹å’Œåˆ é™¤å¯¹è±¡>å¦‚ä½•ä½¿ç”¨ Kustomize æ¥åº”ç”¨ã€æŸ¥çœ‹å’Œåˆ é™¤å¯¹è±¡</a></li><li><a href=#kustomize-åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨>Kustomize åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨</a></li></ul></nav></aside></header><article class="markdown book-article"><p><a href=/>ğŸ  é¦–é¡µ</a> /
<a href=/kubernetes/>Kubernetes</a> / Kustomize</p><h1 id=kustomize>Kustomize
<a class=anchor href=#kustomize>#</a></h1><p>Kustomize æ˜¯ä¸€ä¸ªé€šè¿‡
<a href=https://kubectl.docs.kubernetes.io/references/kustomize/glossary/#kustomization>kustomization æ–‡ä»¶</a> å®šåˆ¶ Kubernetes å¯¹è±¡çš„å·¥å…·ã€‚å®ƒæä¾›ä»¥ä¸‹åŠŸèƒ½ç‰¹æ€§æ¥ç®¡ç†åº”ç”¨é…ç½®æ–‡ä»¶ï¼š</p><ul><li>ä»å…¶ä»–æ¥æºç”Ÿæˆèµ„æº</li><li>ä¸ºèµ„æºè®¾ç½®è´¯ç©¿æ€§ï¼ˆCross-Cuttingï¼‰å­—æ®µ</li><li>ç»„ç»‡å’Œå®šåˆ¶èµ„æºé›†åˆ</li></ul><p>ä» 1.14 ç‰ˆæœ¬å¼€å§‹ï¼Œ<code>kubectl</code> ä¹Ÿå¼€å§‹æ”¯æŒä½¿ç”¨ kustomization æ–‡ä»¶æ¥ç®¡ç† Kubernetes å¯¹è±¡ã€‚ è¦æŸ¥çœ‹åŒ…å« kustomization æ–‡ä»¶çš„ç›®å½•ä¸­çš„èµ„æºï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl kustomize &lt;kustomization_directory&gt;
</span></span></code></pre></div><p>è¦åº”ç”¨è¿™äº›èµ„æºï¼Œä½¿ç”¨ <code>--kustomize</code> æˆ– <code>-k</code> å‚æ•°æ¥æ‰§è¡Œ <code>kubectl apply</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl apply -k &lt;kustomization_directory&gt;
</span></span></code></pre></div><h2 id=ç”Ÿæˆèµ„æº>ç”Ÿæˆèµ„æº
<a class=anchor href=#%e7%94%9f%e6%88%90%e8%b5%84%e6%ba%90>#</a></h2><p>ConfigMap å’Œ Secret åŒ…å«å…¶ä»– Kubernetes å¯¹è±¡ï¼ˆå¦‚ Podï¼‰æ‰€éœ€è¦çš„é…ç½®æˆ–æ•æ„Ÿæ•°æ®ã€‚ ConfigMap æˆ– Secret ä¸­æ•°æ®çš„æ¥æºå¾€å¾€æ˜¯é›†ç¾¤å¤–éƒ¨ï¼Œä¾‹å¦‚æŸä¸ª <code>.properties</code> æ–‡ä»¶æˆ–è€… SSH å¯†é’¥æ–‡ä»¶ã€‚ Kustomize æä¾› <code>secretGenerator</code> å’Œ <code>configMapGenerator</code>ï¼Œå¯ä»¥åŸºäºæ–‡ä»¶æˆ–å­—é¢å€¼æ¥ç”Ÿæˆ Secret å’Œ ConfigMapã€‚</p><h3 id=configmapgenerator>configMapGenerator
<a class=anchor href=#configmapgenerator>#</a></h3><p>è¦åŸºäºæ–‡ä»¶æ¥ç”Ÿæˆ ConfigMapï¼Œå¯ä»¥åœ¨ <code>configMapGenerator</code> çš„ <code>files</code> åˆ—è¡¨ä¸­æ·»åŠ è¡¨é¡¹ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªæ ¹æ® <code>.properties</code> æ–‡ä»¶ä¸­çš„æ•°æ®æ¡ç›®æ¥ç”Ÿæˆ ConfigMap çš„ç¤ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># ç”Ÿæˆä¸€ä¸ª  application.properties æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;application.properties
</span></span></span><span class=line><span class=cl><span class=s>FOO=Bar
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>configMapGenerator:
</span></span></span><span class=line><span class=cl><span class=s>- name: example-configmap-1
</span></span></span><span class=line><span class=cl><span class=s>  files:
</span></span></span><span class=line><span class=cl><span class=s>  - application.properties
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p>æ‰€ç”Ÿæˆçš„ ConfigMap å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ£€æŸ¥ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl kustomize ./
</span></span></code></pre></div><p>æ‰€ç”Ÿæˆçš„ ConfigMap ä¸ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>application.properties</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    FOO=Bar    </span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>example-configmap-1-8mbdf7882g</span><span class=w>
</span></span></span></code></pre></div><p>è¦ä» env æ–‡ä»¶ç”Ÿæˆ ConfigMapï¼Œè¯·åœ¨ <code>configMapGenerator</code> ä¸­çš„ <code>envs</code> åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæ¡ç›®ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨æ¥è‡ª <code>.env</code> æ–‡ä»¶çš„æ•°æ®ç”Ÿæˆ ConfigMap çš„ä¾‹å­ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># åˆ›å»ºä¸€ä¸ª .env æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;.env
</span></span></span><span class=line><span class=cl><span class=s>FOO=Bar
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>configMapGenerator:
</span></span></span><span class=line><span class=cl><span class=s>- name: example-configmap-1
</span></span></span><span class=line><span class=cl><span class=s>  envs:
</span></span></span><span class=line><span class=cl><span class=s>  - .env
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ç”Ÿæˆçš„ ConfigMapï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl kustomize ./
</span></span></code></pre></div><p>ç”Ÿæˆçš„ ConfigMap ä¸ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>FOO</span><span class=p>:</span><span class=w> </span><span class=l>Bar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>example-configmap-1-42cfbf598f</span><span class=w>
</span></span></span></code></pre></div><p><strong>è¯´æ˜ï¼š</strong>ï¼š</p><p><code>.env</code> æ–‡ä»¶ä¸­çš„æ¯ä¸ªå˜é‡åœ¨ç”Ÿæˆçš„ ConfigMap ä¸­æˆä¸ºä¸€ä¸ªå•ç‹¬çš„é”®ã€‚è¿™ä¸ä¹‹å‰çš„ç¤ºä¾‹ä¸åŒï¼Œ å‰ä¸€ä¸ªç¤ºä¾‹å°†ä¸€ä¸ªåä¸º <code>application.properties</code> çš„æ–‡ä»¶ï¼ˆåŠå…¶æ‰€æœ‰æ¡ç›®ï¼‰åµŒå…¥åˆ°åŒä¸€ä¸ªé”®çš„å€¼ä¸­ã€‚</p><p>ConfigMap ä¹Ÿå¯åŸºäºå­—é¢çš„é”®å€¼å¶å¯¹æ¥ç”Ÿæˆã€‚è¦åŸºäºé”®å€¼å¶å¯¹æ¥ç”Ÿæˆ ConfigMapï¼Œ åœ¨ <code>configMapGenerator</code> çš„ <code>literals</code> åˆ—è¡¨ä¸­æ·»åŠ è¡¨é¡¹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œ å±•ç¤ºå¦‚ä½•ä½¿ç”¨é”®å€¼å¶å¯¹ä¸­çš„æ•°æ®æ¡ç›®æ¥ç”Ÿæˆ ConfigMap å¯¹è±¡ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>configMapGenerator:
</span></span></span><span class=line><span class=cl><span class=s>- name: example-configmap-2
</span></span></span><span class=line><span class=cl><span class=s>  literals:
</span></span></span><span class=line><span class=cl><span class=s>  - FOO=Bar
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p>å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥æ‰€ç”Ÿæˆçš„ ConfigMapï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl kustomize ./
</span></span></code></pre></div><p>æ‰€ç”Ÿæˆçš„ ConfigMap ä¸ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>FOO</span><span class=p>:</span><span class=w> </span><span class=l>Bar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>example-configmap-2-g2hdhfc6tk</span><span class=w>
</span></span></span></code></pre></div><p>è¦åœ¨ Deployment ä¸­ä½¿ç”¨ç”Ÿæˆçš„ ConfigMapï¼Œä½¿ç”¨ configMapGenerator çš„åç§°å¯¹å…¶è¿›è¡Œå¼•ç”¨ã€‚ Kustomize å°†è‡ªåŠ¨ä½¿ç”¨ç”Ÿæˆçš„åç§°æ›¿æ¢è¯¥åç§°ã€‚</p><p>è¿™æ˜¯ä½¿ç”¨ç”Ÿæˆçš„ ConfigMap çš„ deployment ç¤ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># åˆ›å»ºä¸€ä¸ª application.properties æ–‡ä»¶</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>cat &lt;&lt;EOF &gt;application.properties</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>FOO=Bar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>EOF</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>cat &lt;&lt;EOF &gt;deployment.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>configMap</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>example-configmap-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>EOF</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>cat &lt;&lt;EOF &gt;./kustomization.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>deployment.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>configMapGenerator</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>example-configmap-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>files</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>application.properties</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=l>EOF</span><span class=w>
</span></span></span></code></pre></div><p>ç”Ÿæˆ ConfigMap å’Œ Deploymentï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl kustomize ./
</span></span></code></pre></div><p>ç”Ÿæˆçš„ Deployment å°†é€šè¿‡åç§°å¼•ç”¨ç”Ÿæˆçš„ ConfigMapï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>application.properties</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    FOO=Bar    </span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>example-configmap-1-g4hk9g2ff8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>my-app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>configMap</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>example-configmap-1-g4hk9g2ff8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config</span><span class=w>
</span></span></span></code></pre></div><h4 id=secretgenerator>secretGenerator
<a class=anchor href=#secretgenerator>#</a></h4><p>ä½ å¯ä»¥åŸºäºæ–‡ä»¶æˆ–è€…é”®å€¼å¶å¯¹æ¥ç”Ÿæˆ Secretã€‚è¦ä½¿ç”¨æ–‡ä»¶å†…å®¹æ¥ç”Ÿæˆ Secretï¼Œ åœ¨ <code>secretGenerator</code> ä¸‹é¢çš„ <code>files</code> åˆ—è¡¨ä¸­æ·»åŠ è¡¨é¡¹ã€‚ä½¿ç”¨å’Œ <code>configMapGenerator</code> åŸºæœ¬ä¸€è‡´ã€‚</p><h3 id=è®¾ç½®è´¯ç©¿æ€§å­—æ®µ>è®¾ç½®è´¯ç©¿æ€§å­—æ®µ
<a class=anchor href=#%e8%ae%be%e7%bd%ae%e8%b4%af%e7%a9%bf%e6%80%a7%e5%ad%97%e6%ae%b5>#</a></h3><p>åœ¨é¡¹ç›®ä¸­ä¸ºæ‰€æœ‰ Kubernetes å¯¹è±¡è®¾ç½®è´¯ç©¿æ€§å­—æ®µæ˜¯ä¸€ç§å¸¸è§æ“ä½œã€‚ è´¯ç©¿æ€§å­—æ®µçš„ä¸€äº›ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p><ul><li>ä¸ºæ‰€æœ‰èµ„æºè®¾ç½®ç›¸åŒçš„åå­—ç©ºé—´</li><li>ä¸ºæ‰€æœ‰å¯¹è±¡æ·»åŠ ç›¸åŒçš„å‰ç¼€æˆ–åç¼€</li><li>ä¸ºå¯¹è±¡æ·»åŠ ç›¸åŒçš„æ ‡ç­¾é›†åˆ</li><li>ä¸ºå¯¹è±¡æ·»åŠ ç›¸åŒçš„æ³¨è§£é›†åˆ</li></ul><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># åˆ›å»ºä¸€ä¸ª deployment.yaml</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;./deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: apps/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Deployment
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: nginx-deployment
</span></span></span><span class=line><span class=cl><span class=s>  labels:
</span></span></span><span class=line><span class=cl><span class=s>    app: nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    matchLabels:
</span></span></span><span class=line><span class=cl><span class=s>      app: nginx
</span></span></span><span class=line><span class=cl><span class=s>  template:
</span></span></span><span class=line><span class=cl><span class=s>    metadata:
</span></span></span><span class=line><span class=cl><span class=s>      labels:
</span></span></span><span class=line><span class=cl><span class=s>        app: nginx
</span></span></span><span class=line><span class=cl><span class=s>    spec:
</span></span></span><span class=line><span class=cl><span class=s>      containers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: nginx
</span></span></span><span class=line><span class=cl><span class=s>        image: nginx
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>namespace: my-namespace
</span></span></span><span class=line><span class=cl><span class=s>namePrefix: dev-
</span></span></span><span class=line><span class=cl><span class=s>nameSuffix: &#34;-001&#34;
</span></span></span><span class=line><span class=cl><span class=s>commonLabels:
</span></span></span><span class=line><span class=cl><span class=s>  app: bingo
</span></span></span><span class=line><span class=cl><span class=s>commonAnnotations:
</span></span></span><span class=line><span class=cl><span class=s>  oncallPager: 800-555-1212
</span></span></span><span class=line><span class=cl><span class=s>resources:
</span></span></span><span class=line><span class=cl><span class=s>- deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p>æ‰§è¡Œ <code>kubectl kustomize ./</code> æŸ¥çœ‹è¿™äº›å­—æ®µéƒ½è¢«è®¾ç½®åˆ° Deployment èµ„æºä¸Šï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>oncallPager</span><span class=p>:</span><span class=w> </span><span class=m>800-555-1212</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>bingo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>dev-nginx-deployment-001</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>my-namespace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>bingo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>oncallPager</span><span class=p>:</span><span class=w> </span><span class=m>800-555-1212</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>bingo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span></code></pre></div><h3 id=ç»„ç»‡å’Œå®šåˆ¶èµ„æº>ç»„ç»‡å’Œå®šåˆ¶èµ„æº
<a class=anchor href=#%e7%bb%84%e7%bb%87%e5%92%8c%e5%ae%9a%e5%88%b6%e8%b5%84%e6%ba%90>#</a></h3><p>ä¸€ç§å¸¸è§çš„åšæ³•æ˜¯åœ¨é¡¹ç›®ä¸­æ„é€ èµ„æºé›†åˆå¹¶å°†å…¶æ”¾åˆ°åŒä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ä¸­ç®¡ç†ã€‚ Kustomize æä¾›åŸºäºä¸åŒæ–‡ä»¶æ¥ç»„ç»‡èµ„æºå¹¶å‘å…¶åº”ç”¨è¡¥ä¸æˆ–è€…å…¶ä»–å®šåˆ¶çš„èƒ½åŠ›ã€‚</p><h4 id=ç»„ç»‡>ç»„ç»‡
<a class=anchor href=#%e7%bb%84%e7%bb%87>#</a></h4><p>Kustomize æ”¯æŒç»„åˆä¸åŒçš„èµ„æºã€‚<code>kustomization.yaml</code> æ–‡ä»¶çš„ <code>resources</code> å­—æ®µå®šä¹‰é…ç½®ä¸­è¦åŒ…å«çš„èµ„æºåˆ—è¡¨ã€‚ ä½ å¯ä»¥å°† <code>resources</code> åˆ—è¡¨ä¸­çš„è·¯å¾„è®¾ç½®ä¸ºèµ„æºé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚ ä¸‹é¢æ˜¯ç”± Deployment å’Œ Service æ„æˆçš„ NGINX åº”ç”¨çš„ç¤ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># åˆ›å»º deployment.yaml æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: apps/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Deployment
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    matchLabels:
</span></span></span><span class=line><span class=cl><span class=s>      run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>  replicas: 2
</span></span></span><span class=line><span class=cl><span class=s>  template:
</span></span></span><span class=line><span class=cl><span class=s>    metadata:
</span></span></span><span class=line><span class=cl><span class=s>      labels:
</span></span></span><span class=line><span class=cl><span class=s>        run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>    spec:
</span></span></span><span class=line><span class=cl><span class=s>      containers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>        image: nginx
</span></span></span><span class=line><span class=cl><span class=s>        ports:
</span></span></span><span class=line><span class=cl><span class=s>        - containerPort: 80
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»º service.yaml æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; service.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Service
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>  labels:
</span></span></span><span class=line><span class=cl><span class=s>    run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  ports:
</span></span></span><span class=line><span class=cl><span class=s>  - port: 80
</span></span></span><span class=line><span class=cl><span class=s>    protocol: TCP
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»º kustomization.yaml æ¥ç»„ç»‡ä»¥ä¸Šä¸¤ä¸ªèµ„æº</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>resources:
</span></span></span><span class=line><span class=cl><span class=s>- deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>- service.yaml
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p><code>kubectl kustomize ./</code> æ‰€å¾—åˆ°çš„èµ„æºä¸­æ—¢åŒ…å« Deployment ä¹ŸåŒ…å« Service å¯¹è±¡ã€‚</p><h4 id=å®šåˆ¶>å®šåˆ¶
<a class=anchor href=#%e5%ae%9a%e5%88%b6>#</a></h4><p>è¡¥ä¸æ–‡ä»¶ï¼ˆPatchesï¼‰å¯ä»¥ç”¨æ¥å¯¹èµ„æºæ‰§è¡Œä¸åŒçš„å®šåˆ¶ã€‚ Kustomize é€šè¿‡ <code>patchesStrategicMerge</code> å’Œ <code>patchesJson6902</code> æ”¯æŒä¸åŒçš„æ‰“è¡¥ä¸æœºåˆ¶ã€‚ <code>patchesStrategicMerge</code> çš„å†…å®¹æ˜¯ä¸€ä¸ªæ–‡ä»¶è·¯å¾„çš„åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªæ–‡ä»¶éƒ½åº”å¯è§£æä¸º
<a href=https://github.com/kubernetes/community/blob/master/contributors/devel/sig-api-machinery/strategic-merge-patch.md>ç­–ç•¥æ€§åˆå¹¶è¡¥ä¸ï¼ˆStrategic Merge Patchï¼‰</a>ã€‚ è¡¥ä¸æ–‡ä»¶ä¸­çš„åç§°å¿…é¡»ä¸å·²ç»åŠ è½½çš„èµ„æºçš„åç§°åŒ¹é…ã€‚ å»ºè®®æ„é€ è§„æ¨¡è¾ƒå°çš„ã€ä»…åšä¸€ä»¶äº‹æƒ…çš„è¡¥ä¸ã€‚ ä¾‹å¦‚ï¼Œæ„é€ ä¸€ä¸ªè¡¥ä¸æ¥å¢åŠ  Deployment çš„å‰¯æœ¬ä¸ªæ•°ï¼›æ„é€ å¦å¤–ä¸€ä¸ªè¡¥ä¸æ¥è®¾ç½®å†…å­˜é™åˆ¶ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># åˆ›å»º deployment.yaml æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: apps/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Deployment
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    matchLabels:
</span></span></span><span class=line><span class=cl><span class=s>      run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>  replicas: 2
</span></span></span><span class=line><span class=cl><span class=s>  template:
</span></span></span><span class=line><span class=cl><span class=s>    metadata:
</span></span></span><span class=line><span class=cl><span class=s>      labels:
</span></span></span><span class=line><span class=cl><span class=s>        run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>    spec:
</span></span></span><span class=line><span class=cl><span class=s>      containers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>        image: nginx
</span></span></span><span class=line><span class=cl><span class=s>        ports:
</span></span></span><span class=line><span class=cl><span class=s>        - containerPort: 80
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆä¸€ä¸ªè¡¥ä¸ increase_replicas.yaml</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; increase_replicas.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: apps/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Deployment
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  replicas: 3
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆå¦ä¸€ä¸ªè¡¥ä¸ set_memory.yaml</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; set_memory.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: apps/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Deployment
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  template:
</span></span></span><span class=line><span class=cl><span class=s>    spec:
</span></span></span><span class=line><span class=cl><span class=s>      containers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>        resources:
</span></span></span><span class=line><span class=cl><span class=s>          limits:
</span></span></span><span class=line><span class=cl><span class=s>            memory: 512Mi
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>resources:
</span></span></span><span class=line><span class=cl><span class=s>- deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>patchesStrategicMerge:
</span></span></span><span class=line><span class=cl><span class=s>- increase_replicas.yaml
</span></span></span><span class=line><span class=cl><span class=s>- set_memory.yaml
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p>æ‰§è¡Œ <code>kubectl kustomize ./</code> æ¥æŸ¥çœ‹ Deploymentï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=l>512Mi</span><span class=w>
</span></span></span></code></pre></div><p>å¹¶éæ‰€æœ‰èµ„æºæˆ–è€…å­—æ®µéƒ½æ”¯æŒç­–ç•¥æ€§åˆå¹¶è¡¥ä¸ã€‚ä¸ºäº†æ”¯æŒå¯¹ä»»ä½•èµ„æºçš„ä»»ä½•å­—æ®µè¿›è¡Œä¿®æ”¹ï¼Œ Kustomize æä¾›é€šè¿‡ <code>patchesJson6902</code> æ¥åº”ç”¨
<a href=https://tools.ietf.org/html/rfc6902>JSON è¡¥ä¸</a>çš„èƒ½åŠ›ã€‚ ä¸ºäº†ç»™ JSON è¡¥ä¸æ‰¾åˆ°æ­£ç¡®çš„èµ„æºï¼Œéœ€è¦åœ¨ <code>kustomization.yaml</code> æ–‡ä»¶ä¸­æŒ‡å®šèµ„æºçš„ç»„ï¼ˆgroupï¼‰ã€ ç‰ˆæœ¬ï¼ˆversionï¼‰ã€ç±»åˆ«ï¼ˆkindï¼‰å’Œåç§°ï¼ˆnameï¼‰ã€‚ ä¾‹å¦‚ï¼Œä¸ºæŸ Deployment å¯¹è±¡å¢åŠ å‰¯æœ¬ä¸ªæ•°çš„æ“ä½œä¹Ÿå¯ä»¥é€šè¿‡ <code>patchesJson6902</code> æ¥å®Œæˆï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># åˆ›å»ºä¸€ä¸ª deployment.yaml æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: apps/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Deployment
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    matchLabels:
</span></span></span><span class=line><span class=cl><span class=s>      run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>  replicas: 2
</span></span></span><span class=line><span class=cl><span class=s>  template:
</span></span></span><span class=line><span class=cl><span class=s>    metadata:
</span></span></span><span class=line><span class=cl><span class=s>      labels:
</span></span></span><span class=line><span class=cl><span class=s>        run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>    spec:
</span></span></span><span class=line><span class=cl><span class=s>      containers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>        image: nginx
</span></span></span><span class=line><span class=cl><span class=s>        ports:
</span></span></span><span class=line><span class=cl><span class=s>        - containerPort: 80
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»ºä¸€ä¸ª JSON è¡¥ä¸æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; patch.yaml
</span></span></span><span class=line><span class=cl><span class=s>- op: replace
</span></span></span><span class=line><span class=cl><span class=s>  path: /spec/replicas
</span></span></span><span class=line><span class=cl><span class=s>  value: 3
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»ºä¸€ä¸ª kustomization.yaml</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>resources:
</span></span></span><span class=line><span class=cl><span class=s>- deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>patchesJson6902:
</span></span></span><span class=line><span class=cl><span class=s>- target:
</span></span></span><span class=line><span class=cl><span class=s>    group: apps
</span></span></span><span class=line><span class=cl><span class=s>    version: v1
</span></span></span><span class=line><span class=cl><span class=s>    kind: Deployment
</span></span></span><span class=line><span class=cl><span class=s>    name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>  path: patch.yaml
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p>æ‰§è¡Œ <code>kubectl kustomize ./</code> ä»¥æŸ¥çœ‹ <code>replicas</code> å­—æ®µè¢«æ›´æ–°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></div><p>é™¤äº†è¡¥ä¸ä¹‹å¤–ï¼ŒKustomize è¿˜æä¾›å®šåˆ¶å®¹å™¨é•œåƒæˆ–è€…å°†å…¶ä»–å¯¹è±¡çš„å­—æ®µå€¼æ³¨å…¥åˆ°å®¹å™¨ä¸­çš„èƒ½åŠ›ï¼Œå¹¶ä¸”ä¸éœ€è¦åˆ›å»ºè¡¥ä¸ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨ <code>kustomization.yaml</code> æ–‡ä»¶çš„ <code>images</code> å­—æ®µè®¾ç½®æ–°çš„é•œåƒæ¥æ›´æ”¹å®¹å™¨ä¸­ä½¿ç”¨çš„é•œåƒã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: apps/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Deployment
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    matchLabels:
</span></span></span><span class=line><span class=cl><span class=s>      run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>  replicas: 2
</span></span></span><span class=line><span class=cl><span class=s>  template:
</span></span></span><span class=line><span class=cl><span class=s>    metadata:
</span></span></span><span class=line><span class=cl><span class=s>      labels:
</span></span></span><span class=line><span class=cl><span class=s>        run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>    spec:
</span></span></span><span class=line><span class=cl><span class=s>      containers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>        image: nginx
</span></span></span><span class=line><span class=cl><span class=s>        ports:
</span></span></span><span class=line><span class=cl><span class=s>        - containerPort: 80
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>resources:
</span></span></span><span class=line><span class=cl><span class=s>- deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>images:
</span></span></span><span class=line><span class=cl><span class=s>- name: nginx
</span></span></span><span class=line><span class=cl><span class=s>  newName: my.image.registry/nginx
</span></span></span><span class=line><span class=cl><span class=s>  newTag: 1.4.0
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p>æ‰§è¡Œ <code>kubectl kustomize ./</code> ä»¥æŸ¥çœ‹æ‰€ä½¿ç”¨çš„é•œåƒå·²è¢«æ›´æ–°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>my.image.registry/nginx:1.4.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></div><p>æœ‰äº›æ—¶å€™ï¼ŒPod ä¸­è¿è¡Œçš„åº”ç”¨å¯èƒ½éœ€è¦ä½¿ç”¨æ¥è‡ªå…¶ä»–å¯¹è±¡çš„é…ç½®å€¼ã€‚ ä¾‹å¦‚ï¼ŒæŸ Deployment å¯¹è±¡çš„ Pod éœ€è¦ä»ç¯å¢ƒå˜é‡æˆ–å‘½ä»¤è¡Œå‚æ•°ä¸­è¯»å–è¯»å– Service çš„åç§°ã€‚ ç”±äºåœ¨ <code>kustomization.yaml</code> æ–‡ä»¶ä¸­æ·»åŠ  <code>namePrefix</code> æˆ– <code>nameSuffix</code> æ—¶ Service åç§°å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œå»ºè®®ä¸è¦åœ¨å‘½ä»¤å‚æ•°ä¸­ç¡¬ç¼–ç  Service åç§°ã€‚ å¯¹äºè¿™ç§ä½¿ç”¨åœºæ™¯ï¼ŒKustomize å¯ä»¥é€šè¿‡ <code>vars</code> å°† Service åç§°æ³¨å…¥åˆ°å®¹å™¨ä¸­ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># åˆ›å»ºä¸€ä¸ª deployment.yaml æ–‡ä»¶ï¼ˆå¼•ç”¨æ­¤å¤„çš„æ–‡æ¡£åˆ†éš”ç¬¦ï¼‰</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;&#39;EOF&#39; &gt; deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: apps/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Deployment
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    matchLabels:
</span></span></span><span class=line><span class=cl><span class=s>      run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>  replicas: 2
</span></span></span><span class=line><span class=cl><span class=s>  template:
</span></span></span><span class=line><span class=cl><span class=s>    metadata:
</span></span></span><span class=line><span class=cl><span class=s>      labels:
</span></span></span><span class=line><span class=cl><span class=s>        run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>    spec:
</span></span></span><span class=line><span class=cl><span class=s>      containers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>        image: nginx
</span></span></span><span class=line><span class=cl><span class=s>        command: [&#34;start&#34;, &#34;--host&#34;, &#34;$(MY_SERVICE_NAME)&#34;]
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»ºä¸€ä¸ª service.yaml æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; service.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Service
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>  labels:
</span></span></span><span class=line><span class=cl><span class=s>    run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  ports:
</span></span></span><span class=line><span class=cl><span class=s>  - port: 80
</span></span></span><span class=line><span class=cl><span class=s>    protocol: TCP
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>namePrefix: dev-
</span></span></span><span class=line><span class=cl><span class=s>nameSuffix: &#34;-001&#34;
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>resources:
</span></span></span><span class=line><span class=cl><span class=s>- deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>- service.yaml
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>vars:
</span></span></span><span class=line><span class=cl><span class=s>- name: MY_SERVICE_NAME
</span></span></span><span class=line><span class=cl><span class=s>  objref:
</span></span></span><span class=line><span class=cl><span class=s>    kind: Service
</span></span></span><span class=line><span class=cl><span class=s>    name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>    apiVersion: v1
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p>æ‰§è¡Œ <code>kubectl kustomize ./</code> ä»¥æŸ¥çœ‹æ³¨å…¥åˆ°å®¹å™¨ä¸­çš„ Service åç§°æ˜¯ <code>dev-my-nginx-001</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>dev-my-nginx-001</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>start</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- --<span class=l>host</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>dev-my-nginx-001</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-nginx</span><span class=w>
</span></span></span></code></pre></div><h2 id=åŸºå‡†basesä¸è¦†ç›–overlays>åŸºå‡†ï¼ˆBasesï¼‰ä¸è¦†ç›–ï¼ˆOverlaysï¼‰
<a class=anchor href=#%e5%9f%ba%e5%87%86bases%e4%b8%8e%e8%a6%86%e7%9b%96overlays>#</a></h2><p>Kustomize ä¸­æœ‰ <strong>åŸºå‡†ï¼ˆbasesï¼‰</strong> å’Œ <strong>è¦†ç›–ï¼ˆoverlaysï¼‰</strong> çš„æ¦‚å¿µåŒºåˆ†ã€‚ <strong>åŸºå‡†</strong> æ˜¯åŒ…å« <code>kustomization.yaml</code> æ–‡ä»¶çš„ä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­åŒ…å«ä¸€ç»„èµ„æºåŠå…¶ç›¸å…³çš„å®šåˆ¶ã€‚ åŸºå‡†å¯ä»¥æ˜¯æœ¬åœ°ç›®å½•æˆ–è€…æ¥è‡ªè¿œç¨‹ä»“åº“çš„ç›®å½•ï¼Œåªè¦å…¶ä¸­å­˜åœ¨ <code>kustomization.yaml</code> æ–‡ä»¶å³å¯ã€‚ <strong>è¦†ç›–</strong> ä¹Ÿæ˜¯ä¸€ä¸ªç›®å½•ï¼Œå…¶ä¸­åŒ…å«å°†å…¶ä»– kustomization ç›®å½•å½“åš <code>bases</code> æ¥å¼•ç”¨çš„ <code>kustomization.yaml</code> æ–‡ä»¶ã€‚ <strong>åŸºå‡†</strong>ä¸äº†è§£è¦†ç›–çš„å­˜åœ¨ï¼Œä¸”å¯è¢«å¤šä¸ªè¦†ç›–æ‰€ä½¿ç”¨ã€‚ è¦†ç›–åˆ™å¯ä»¥æœ‰å¤šä¸ªåŸºå‡†ï¼Œä¸”å¯é’ˆå¯¹æ‰€æœ‰åŸºå‡†ä¸­çš„èµ„æºæ‰§è¡Œç»„ç»‡æ“ä½œï¼Œè¿˜å¯ä»¥åœ¨å…¶ä¸Šæ‰§è¡Œå®šåˆ¶ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># åˆ›å»ºä¸€ä¸ªåŒ…å«åŸºå‡†çš„ç›®å½•</span>
</span></span><span class=line><span class=cl>mkdir base
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»º base/deployment.yaml</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; base/deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: apps/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Deployment
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    matchLabels:
</span></span></span><span class=line><span class=cl><span class=s>      run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>  replicas: 2
</span></span></span><span class=line><span class=cl><span class=s>  template:
</span></span></span><span class=line><span class=cl><span class=s>    metadata:
</span></span></span><span class=line><span class=cl><span class=s>      labels:
</span></span></span><span class=line><span class=cl><span class=s>        run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>    spec:
</span></span></span><span class=line><span class=cl><span class=s>      containers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>        image: nginx
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»º base/service.yaml æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; base/service.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Service
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>  labels:
</span></span></span><span class=line><span class=cl><span class=s>    run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  ports:
</span></span></span><span class=line><span class=cl><span class=s>  - port: 80
</span></span></span><span class=line><span class=cl><span class=s>    protocol: TCP
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»º base/kustomization.yaml</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; base/kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>resources:
</span></span></span><span class=line><span class=cl><span class=s>- deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>- service.yaml
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p>æ­¤åŸºå‡†å¯åœ¨å¤šä¸ªè¦†ç›–ä¸­ä½¿ç”¨ã€‚ä½ å¯ä»¥åœ¨ä¸åŒçš„è¦†ç›–ä¸­æ·»åŠ ä¸åŒçš„ <code>namePrefix</code> æˆ–å…¶ä»–è´¯ç©¿æ€§å­—æ®µã€‚ ä¸‹é¢æ˜¯ä¸¤ä¸ªä½¿ç”¨åŒä¸€åŸºå‡†çš„è¦†ç›–ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir dev
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; dev/kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>resources:
</span></span></span><span class=line><span class=cl><span class=s>- ../base
</span></span></span><span class=line><span class=cl><span class=s>namePrefix: dev-
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mkdir prod
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; prod/kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>resources:
</span></span></span><span class=line><span class=cl><span class=s>- ../base
</span></span></span><span class=line><span class=cl><span class=s>namePrefix: prod-
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><h2 id=å¦‚ä½•ä½¿ç”¨-kustomize-æ¥åº”ç”¨æŸ¥çœ‹å’Œåˆ é™¤å¯¹è±¡>å¦‚ä½•ä½¿ç”¨ Kustomize æ¥åº”ç”¨ã€æŸ¥çœ‹å’Œåˆ é™¤å¯¹è±¡
<a class=anchor href=#%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8-kustomize-%e6%9d%a5%e5%ba%94%e7%94%a8%e6%9f%a5%e7%9c%8b%e5%92%8c%e5%88%a0%e9%99%a4%e5%af%b9%e8%b1%a1>#</a></h2><p>åœ¨ <code>kubectl</code> å‘½ä»¤ä¸­ä½¿ç”¨ <code>--kustomize</code> æˆ– <code>-k</code> å‚æ•°æ¥è¯†åˆ«è¢« <code>kustomization.yaml</code> æ‰€ç®¡ç†çš„èµ„æºã€‚ æ³¨æ„ <code>-k</code> è¦æŒ‡å‘ä¸€ä¸ª kustomization ç›®å½•ã€‚ä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl apply -k &lt;kustomization ç›®å½•&gt;/
</span></span></code></pre></div><p>å‡å®šä½¿ç”¨ä¸‹é¢çš„ <code>kustomization.yaml</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># åˆ›å»º deployment.yaml æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>apiVersion: apps/v1
</span></span></span><span class=line><span class=cl><span class=s>kind: Deployment
</span></span></span><span class=line><span class=cl><span class=s>metadata:
</span></span></span><span class=line><span class=cl><span class=s>  name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>spec:
</span></span></span><span class=line><span class=cl><span class=s>  selector:
</span></span></span><span class=line><span class=cl><span class=s>    matchLabels:
</span></span></span><span class=line><span class=cl><span class=s>      run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>  replicas: 2
</span></span></span><span class=line><span class=cl><span class=s>  template:
</span></span></span><span class=line><span class=cl><span class=s>    metadata:
</span></span></span><span class=line><span class=cl><span class=s>      labels:
</span></span></span><span class=line><span class=cl><span class=s>        run: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>    spec:
</span></span></span><span class=line><span class=cl><span class=s>      containers:
</span></span></span><span class=line><span class=cl><span class=s>      - name: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>        image: nginx
</span></span></span><span class=line><span class=cl><span class=s>        ports:
</span></span></span><span class=line><span class=cl><span class=s>        - containerPort: 80
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»º kustomization.yaml</span>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;./kustomization.yaml
</span></span></span><span class=line><span class=cl><span class=s>namePrefix: dev-
</span></span></span><span class=line><span class=cl><span class=s>commonLabels:
</span></span></span><span class=line><span class=cl><span class=s>  app: my-nginx
</span></span></span><span class=line><span class=cl><span class=s>resources:
</span></span></span><span class=line><span class=cl><span class=s>- deployment.yaml
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åº”ç”¨ Deployment å¯¹è±¡ <code>dev-my-nginx</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>&gt; kubectl apply -k ./
</span></span><span class=line><span class=cl>deployment.apps/dev-my-nginx created
</span></span></code></pre></div><p>è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä¹‹ä¸€æ¥æŸ¥çœ‹ Deployment å¯¹è±¡ <code>dev-my-nginx</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get -k ./
</span></span><span class=line><span class=cl>kubectl describe -k ./
</span></span></code></pre></div><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ¯”è¾ƒ Deployment å¯¹è±¡ <code>dev-my-nginx</code> ä¸æ¸…å•è¢«åº”ç”¨ä¹‹åé›†ç¾¤å°†å¤„äºçš„çŠ¶æ€ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl diff -k ./
</span></span></code></pre></div><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤åˆ é™¤ Deployment å¯¹è±¡ <code>dev-my-nginx</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>&gt; kubectl delete -k ./
</span></span><span class=line><span class=cl>deployment.apps <span class=s2>&#34;dev-my-nginx&#34;</span> deleted
</span></span></code></pre></div><h2 id=kustomize-åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨>Kustomize åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨
<a class=anchor href=#kustomize-%e5%8a%9f%e8%83%bd%e7%89%b9%e6%80%a7%e5%88%97%e8%a1%a8>#</a></h2><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>namespace</td><td>string</td><td>ä¸ºæ‰€æœ‰èµ„æºæ·»åŠ åå­—ç©ºé—´</td></tr><tr><td>namePrefix</td><td>string</td><td>æ­¤å­—æ®µçš„å€¼å°†è¢«æ·»åŠ åˆ°æ‰€æœ‰èµ„æºåç§°å‰é¢</td></tr><tr><td>nameSuffix</td><td>string</td><td>æ­¤å­—æ®µçš„å€¼å°†è¢«æ·»åŠ åˆ°æ‰€æœ‰èµ„æºåç§°åé¢</td></tr><tr><td>commonLabels</td><td>map[string]string</td><td>è¦æ·»åŠ åˆ°æ‰€æœ‰èµ„æºå’Œé€‰æ‹©ç®—ç¬¦çš„æ ‡ç­¾</td></tr><tr><td>commonAnnotations</td><td>map[string]string</td><td>è¦æ·»åŠ åˆ°æ‰€æœ‰èµ„æºçš„æ³¨è§£</td></tr><tr><td>resources</td><td>[]string</td><td>åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½å¿…é¡»èƒ½å¤Ÿè§£æä¸ºç°æœ‰çš„èµ„æºé…ç½®æ–‡ä»¶</td></tr><tr><td>configMapGenerator</td><td>[]
<a href=https://github.com/kubernetes-sigs/kustomize/blob/master/api/types/configmapargs.go#L7>ConfigMapArgs</a></td><td>åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½ä¼šç”Ÿæˆä¸€ä¸ª ConfigMap</td></tr><tr><td>secretGenerator</td><td>[]SecretArgs[]
<a href=https://github.com/kubernetes-sigs/kustomize/blob/master/api/types/secretargs.go#L7>SecretArgs</a></td><td>åˆ—è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½ä¼šç”Ÿæˆä¸€ä¸ª Secret</td></tr><tr><td>generatorOptions</td><td><a href=https://github.com/kubernetes-sigs/kustomize/blob/master/api/types/generatoroptions.go#L7>GeneratorOptions</a></td><td>æ›´æ”¹æ‰€æœ‰ ConfigMap å’Œ Secret ç”Ÿæˆå™¨çš„è¡Œä¸º</td></tr><tr><td>bases</td><td>[]string</td><td>åˆ—è¡¨ä¸­æ¯ä¸ªæ¡ç›®éƒ½åº”èƒ½è§£æä¸ºä¸€ä¸ªåŒ…å« kustomization.yaml æ–‡ä»¶çš„ç›®å½•</td></tr><tr><td>patchesStrategicMerge</td><td>[]string</td><td>åˆ—è¡¨ä¸­æ¯ä¸ªæ¡ç›®éƒ½èƒ½è§£æä¸ºæŸ Kubernetes å¯¹è±¡çš„ç­–ç•¥æ€§åˆå¹¶è¡¥ä¸</td></tr><tr><td>patchesJson6902</td><td>[]Patch[]
<a href=https://github.com/kubernetes-sigs/kustomize/blob/master/api/types/patch.go#L10>Patch</a></td><td>åˆ—è¡¨ä¸­æ¯ä¸ªæ¡ç›®éƒ½èƒ½è§£æä¸ºä¸€ä¸ª Kubernetes å¯¹è±¡å’Œä¸€ä¸ª JSON è¡¥ä¸</td></tr><tr><td>vars</td><td>[]
<a href=https://github.com/kubernetes-sigs/kustomize/blob/master/api/types/var.go#L19>Var</a></td><td>æ¯ä¸ªæ¡ç›®ç”¨æ¥ä»æŸèµ„æºçš„å­—æ®µæ¥æå–æ–‡å­—</td></tr><tr><td>images</td><td>[]Image[]
<a href=https://github.com/kubernetes-sigs/kustomize/blob/master/api/types/image.go#L8>images</a></td><td>æ¯ä¸ªæ¡ç›®éƒ½ç”¨æ¥æ›´æ”¹é•œåƒçš„åç§°ã€æ ‡è®°ä¸/æˆ–æ‘˜è¦ï¼Œä¸å¿…ç”Ÿæˆè¡¥ä¸</td></tr><tr><td>configurations</td><td>[]string</td><td>åˆ—è¡¨ä¸­æ¯ä¸ªæ¡ç›®éƒ½åº”èƒ½è§£æä¸ºä¸€ä¸ªåŒ…å«
<a href=https://github.com/kubernetes-sigs/kustomize/tree/master/examples/transformerconfigs>Kustomize è½¬æ¢å™¨é…ç½®</a> çš„æ–‡ä»¶</td></tr><tr><td>crds</td><td>[]string</td><td>åˆ—è¡¨ä¸­æ¯ä¸ªæ¡ç›®éƒ½åº”èƒ½å¤Ÿè§£æä¸º Kubernetes ç±»åˆ«çš„ OpenAPI å®šä¹‰æ–‡ä»¶</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><hr><p><a href=/kubernetes/kubevirt-practice/>Â« Kubevirt å®è·µ</a></p><p><a href=/kubernetes/liveness-readiness-probe/>Â» Kubernetes 0-1 Podä¸­çš„livenessProbeå’ŒreadinessProbeè§£è¯»</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/poneding/blog/commit/5faa4f1be5d4525c49e513962394eae7c15fb6f2 title='æœ€åä¿®æ”¹è€… poneding | 2024/06/13' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt>
<span>2024/06/13</span></a></div><div><a class="flex align-center" href=https://github.com/poneding/blog/edit/master/content/kubernetes/kustomize.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>ç¼–è¾‘æœ¬é¡µ</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=poneding/blog data-repo-id=R_kgDOMITIHg data-category=General data-category-id=DIC_kwDOMITIHs4CgB4x data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#ç”Ÿæˆèµ„æº>ç”Ÿæˆèµ„æº</a><ul><li><a href=#configmapgenerator>configMapGenerator</a></li><li><a href=#è®¾ç½®è´¯ç©¿æ€§å­—æ®µ>è®¾ç½®è´¯ç©¿æ€§å­—æ®µ</a></li><li><a href=#ç»„ç»‡å’Œå®šåˆ¶èµ„æº>ç»„ç»‡å’Œå®šåˆ¶èµ„æº</a></li></ul></li><li><a href=#åŸºå‡†basesä¸è¦†ç›–overlays>åŸºå‡†ï¼ˆBasesï¼‰ä¸è¦†ç›–ï¼ˆOverlaysï¼‰</a></li><li><a href=#å¦‚ä½•ä½¿ç”¨-kustomize-æ¥åº”ç”¨æŸ¥çœ‹å’Œåˆ é™¤å¯¹è±¡>å¦‚ä½•ä½¿ç”¨ Kustomize æ¥åº”ç”¨ã€æŸ¥çœ‹å’Œåˆ é™¤å¯¹è±¡</a></li><li><a href=#kustomize-åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨>Kustomize åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨</a></li></ul></nav></div></aside></main></body></html>