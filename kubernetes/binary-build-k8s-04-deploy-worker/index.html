<!doctype html><html lang=cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ğŸ  é¦–é¡µ / Kubernetes / äºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node
äºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node # å†™åœ¨å‰é¢ # è®°å½•å’Œåˆ†äº«ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ï¼Œç”±äºæ“ä½œæ¯”è¾ƒå†—é•¿ï¼Œå¤§æ¦‚ä¼šåˆ†å››ç¯‡å†™å®Œï¼š
æœºå™¨å‡†å¤‡ï¼š éƒ¨ç½² etcd é›†ç¾¤ï¼š éƒ¨ç½² Masterï¼š éƒ¨ç½² Nodeï¼š K8s çš„ Node ä¸Šéœ€è¦è¿è¡Œ kubelet å’Œ kube-proxyã€‚æœ¬ç¯‡ä»‹ç»åœ¨ Node æœºå™¨å®‰è£…è¿™ä¸¤ä¸ªç»„ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®‰è£…é€šä¿¡éœ€è¦çš„ cni æ’ä»¶ã€‚
æœ¬ç¯‡çš„æ‰§è¡Œå‘½ä»¤éœ€è¦åœ¨å‡†å¤‡çš„ä¸¤å°Nodeæœºå™¨ä¸Šæ‰§è¡Œã€‚
å®‰è£… docker # å¯ä»¥å‚ç…§å®˜ç½‘ï¼š https://docs.docker.com/engine/install/
# å¸è½½è€ç‰ˆæœ¬æˆ–é‡è£… docker æ—¶æ‰§è¡Œç¬¬ä¸€è¡Œ yum remove docker \ docker-client \ docker-client-latest \ docker-common \ docker-latest \ docker-latest-logrotate \ docker-logrotate \ docker-engine -y # å®‰è£… docker yum install -y yum-utils yum-config-manager \ --add-repo \ https://download."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://blog.poneding.com/kubernetes/binary-build-k8s-04-deploy-worker/"><meta property="og:site_name" content="ç§‹æ²³è½å¶"><meta property="og:title" content="ç§‹æ²³è½å¶"><meta property="og:description" content="ğŸ  é¦–é¡µ / Kubernetes / äºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node
äºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node # å†™åœ¨å‰é¢ # è®°å½•å’Œåˆ†äº«ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ï¼Œç”±äºæ“ä½œæ¯”è¾ƒå†—é•¿ï¼Œå¤§æ¦‚ä¼šåˆ†å››ç¯‡å†™å®Œï¼š
æœºå™¨å‡†å¤‡ï¼š éƒ¨ç½² etcd é›†ç¾¤ï¼š éƒ¨ç½² Masterï¼š éƒ¨ç½² Nodeï¼š K8s çš„ Node ä¸Šéœ€è¦è¿è¡Œ kubelet å’Œ kube-proxyã€‚æœ¬ç¯‡ä»‹ç»åœ¨ Node æœºå™¨å®‰è£…è¿™ä¸¤ä¸ªç»„ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®‰è£…é€šä¿¡éœ€è¦çš„ cni æ’ä»¶ã€‚
æœ¬ç¯‡çš„æ‰§è¡Œå‘½ä»¤éœ€è¦åœ¨å‡†å¤‡çš„ä¸¤å°Nodeæœºå™¨ä¸Šæ‰§è¡Œã€‚
å®‰è£… docker # å¯ä»¥å‚ç…§å®˜ç½‘ï¼š https://docs.docker.com/engine/install/
# å¸è½½è€ç‰ˆæœ¬æˆ–é‡è£… docker æ—¶æ‰§è¡Œç¬¬ä¸€è¡Œ yum remove docker \ docker-client \ docker-client-latest \ docker-common \ docker-latest \ docker-latest-logrotate \ docker-logrotate \ docker-engine -y # å®‰è£… docker yum install -y yum-utils yum-config-manager \ --add-repo \ https://download."><meta property="og:locale" content="cn"><meta property="og:type" content="article"><meta property="article:section" content="kubernetes"><meta property="article:modified_time" content="2024-06-13T15:37:18+08:00"><title>Binary Build K8s 04 Deploy Worker | ç§‹æ²³è½å¶</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/logo.png><link rel=canonical href=https://blog.poneding.com/kubernetes/binary-build-k8s-04-deploy-worker/><link rel=stylesheet href=/book.min.4964903a822a7acb10dac6d1ab524833c97fb5f99b141976bcb8a47d539be9c0.css integrity="sha256-SWSQOoIqessQ2sbRq1JIM8l/tfmbFBl2vLikfVOb6cA=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/cn.search.min.9f1280cc6ffc9a2ae3298c04635ca288dcdeca4e30c80efc0616f03ee573a6c7.js integrity="sha256-nxKAzG/8mirjKYwEY1yiiNzeyk4wyA78BhbwPuVzpsc=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><link rel=stylesheet href=/css/syntax.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>ç§‹æ²³è½å¶</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=æœç´¢ aria-label=æœç´¢ maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><p>ğŸ¦‰ é›†ä¸­èµ·æ¥çš„æ„å¿—å¯ä»¥å‡»ç©¿é¡½çŸ³ã€‚</p><hr><ul><li><p><a href=/><strong>ğŸ  é¦–é¡µ</strong></a></p></li><li><p><strong>ğŸ“Œ ç½®é¡¶æ–‡ç« </strong></p><ul><li><a href=/git/common-usage/>Git å¸¸ç”¨</a></li><li><a href=/kubernetes/kubeadm-install-k8s-docker/>å®‰è£… Kubernetes (Docker)</a></li></ul></li><li><p><strong>ğŸ“Œ ç½®é¡¶åˆ†ç±»</strong></p><ul><li><a href=/go/>Golang ç¼–ç¨‹</a></li><li><a href=/kubernetes/>Kubernetes</a></li><li><a href=/rust/>Rust ç¼–ç¨‹</a></li><li><a href=/git/>Git</a></li></ul></li></ul><hr><ul><li><strong>ğŸ—ƒï¸ å¼€æºé¡¹ç›®</strong><ul><li><a href=https://github.com/ketches/registry-proxy>registry-proxy</a></li><li><a href=https://github.com/poneding/mdi>mdi</a></li></ul></li></ul><hr><ul><li><a href=https://github.com/poneding target=_blank rel=noopener>ğŸ™ GitHub</a></li><li><a href=mailto:poneding@gmail.com target=_blank rel=noopener>ğŸ“¬ é‚®ç®±</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Binary Build K8s 04 Deploy Worker</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#å†™åœ¨å‰é¢>å†™åœ¨å‰é¢</a></li><li><a href=#å®‰è£…-docker>å®‰è£… docker</a></li><li><a href=#å®‰è£…-kubelet>å®‰è£… kubelet</a></li><li><a href=#å®‰è£…-kube-proxy>å®‰è£… kube-proxy</a></li><li><a href=#éƒ¨ç½²-cni-ç½‘ç»œæ’ä»¶>éƒ¨ç½² cni ç½‘ç»œæ’ä»¶</a></li><li><a href=#éƒ¨ç½²-flannel-é›†ç¾¤ç½‘ç»œ>éƒ¨ç½² Flannel é›†ç¾¤ç½‘ç»œ</a></li><li><a href=#k8s-é›†ç¾¤æµ‹è¯•>K8s é›†ç¾¤æµ‹è¯•</a></li><li><a href=#ç»“æŸè¯­>ç»“æŸè¯­</a></li></ul></nav></aside></header><article class="markdown book-article"><p><a href=/>ğŸ  é¦–é¡µ</a> /
<a href=/kubernetes/>Kubernetes</a> / äºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node</p><h1 id=äºŒè¿›åˆ¶æ­å»º-k8s---4-éƒ¨ç½²-node>äºŒè¿›åˆ¶æ­å»º K8s - 4 éƒ¨ç½² Node
<a class=anchor href=#%e4%ba%8c%e8%bf%9b%e5%88%b6%e6%90%ad%e5%bb%ba-k8s---4-%e9%83%a8%e7%bd%b2-node>#</a></h1><h2 id=å†™åœ¨å‰é¢>å†™åœ¨å‰é¢
<a class=anchor href=#%e5%86%99%e5%9c%a8%e5%89%8d%e9%9d%a2>#</a></h2><p>è®°å½•å’Œåˆ†äº«ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¯¦ç»†è¿‡ç¨‹ï¼Œç”±äºæ“ä½œæ¯”è¾ƒå†—é•¿ï¼Œå¤§æ¦‚ä¼šåˆ†å››ç¯‡å†™å®Œï¼š</p><ol><li><strong><a href=/kubernetes/binary-build-k8s-01-prepare-nodes/>æœºå™¨å‡†å¤‡</a></strong>ï¼š</li><li><strong><a href=/kubernetes/binary-build-k8s-02-deploy-etcd/>éƒ¨ç½² etcd é›†ç¾¤</a></strong>ï¼š</li><li><strong><a href=/kubernetes/binary-build-k8s-03-deploy-master/>éƒ¨ç½² Master</a></strong>ï¼š</li><li><strong><a href=/kubernetes/binary-build-k8s-04-deploy-worker/>éƒ¨ç½² Node</a></strong>ï¼š</li></ol><p>K8s çš„ Node ä¸Šéœ€è¦è¿è¡Œ kubelet å’Œ kube-proxyã€‚æœ¬ç¯‡ä»‹ç»åœ¨ Node æœºå™¨å®‰è£…è¿™ä¸¤ä¸ªç»„ä»¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®‰è£…é€šä¿¡éœ€è¦çš„ cni æ’ä»¶ã€‚</p><p>æœ¬ç¯‡çš„æ‰§è¡Œå‘½ä»¤éœ€è¦åœ¨å‡†å¤‡çš„ä¸¤å°Nodeæœºå™¨ä¸Šæ‰§è¡Œã€‚</p><h2 id=å®‰è£…-docker>å®‰è£… docker
<a class=anchor href=#%e5%ae%89%e8%a3%85-docker>#</a></h2><p>å¯ä»¥å‚ç…§å®˜ç½‘ï¼š
<a href=https://docs.docker.com/engine/install/>https://docs.docker.com/engine/install/</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># å¸è½½è€ç‰ˆæœ¬æˆ–é‡è£… docker æ—¶æ‰§è¡Œç¬¬ä¸€è¡Œ</span>
</span></span><span class=line><span class=cl>yum remove docker <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-client <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-client-latest <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-common <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-latest <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-latest-logrotate <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-logrotate <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-engine -y
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®‰è£… docker</span>
</span></span><span class=line><span class=cl>yum install -y yum-utils
</span></span><span class=line><span class=cl>yum-config-manager <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --add-repo <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    https://download.docker.com/linux/centos/docker-ce.repo
</span></span><span class=line><span class=cl>yum install docker-ce docker-ce-cli containerd.io -y
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ Docker ç‰ˆæœ¬</span>
</span></span><span class=line><span class=cl>docker version
</span></span></code></pre></div><p>å¯åŠ¨ Docker</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl <span class=nb>enable</span> docker
</span></span><span class=line><span class=cl>systemctl start docker
</span></span></code></pre></div><h2 id=å®‰è£…-kubelet>å®‰è£… kubelet
<a class=anchor href=#%e5%ae%89%e8%a3%85-kubelet>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> /root/kubernetes/resources
</span></span><span class=line><span class=cl>tar -zxvf ./kubernetes-node-linux-amd64.tar.gz
</span></span><span class=line><span class=cl>mkdir /etc/kubernetes/<span class=o>{</span>ssl,bin<span class=o>}</span> -p
</span></span><span class=line><span class=cl>cp kubernetes/node/bin/kubelet ./kubernetes/node/bin/kube-proxy /etc/kubernetes/bin
</span></span><span class=line><span class=cl><span class=nb>cd</span> /etc/kubernetes
</span></span></code></pre></div><p>å‡†å¤‡ kubelet é…ç½®æ–‡ä»¶</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim kubelet
</span></span></code></pre></div><p>æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œåœ¨ k8s-node01 å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>KUBELET_ARGS</span><span class=o>=</span><span class=s2>&#34;--logtostderr=false \
</span></span></span><span class=line><span class=cl><span class=s2>--v=2 \
</span></span></span><span class=line><span class=cl><span class=s2>--log-dir=/var/log/kubernetes  \
</span></span></span><span class=line><span class=cl><span class=s2>--enable-server=true \
</span></span></span><span class=line><span class=cl><span class=s2>--kubeconfig=/etc/kubernetes/kubelet.kubeconfig \
</span></span></span><span class=line><span class=cl><span class=s2>--hostname-override=k8s-node01 \
</span></span></span><span class=line><span class=cl><span class=s2>--network-plugin=cni \
</span></span></span><span class=line><span class=cl><span class=s2>--bootstrap-kubeconfig=/etc/kubernetes/bootstrap.kubeconfig \
</span></span></span><span class=line><span class=cl><span class=s2>--config=/etc/kubernetes/kubelet-config.yml \
</span></span></span><span class=line><span class=cl><span class=s2>--cert-dir=/etc/kubernetes/ssl&#34;</span>
</span></span></code></pre></div><p>åœ¨ k8s-node02 å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>KUBELET_ARGS</span><span class=o>=</span><span class=s2>&#34;--logtostderr=false \
</span></span></span><span class=line><span class=cl><span class=s2>--v=2 \
</span></span></span><span class=line><span class=cl><span class=s2>--log-dir=/var/log/kubernetes  \
</span></span></span><span class=line><span class=cl><span class=s2>--enable-server=true \
</span></span></span><span class=line><span class=cl><span class=s2>--kubeconfig=/etc/kubernetes/kubelet.kubeconfig \
</span></span></span><span class=line><span class=cl><span class=s2>--hostname-override=k8s-node02 \
</span></span></span><span class=line><span class=cl><span class=s2>--network-plugin=cni \
</span></span></span><span class=line><span class=cl><span class=s2>--bootstrap-kubeconfig=/etc/kubernetes/bootstrap.kubeconfig \
</span></span></span><span class=line><span class=cl><span class=s2>--config=/etc/kubernetes/kubelet-config.yml \
</span></span></span><span class=line><span class=cl><span class=s2>--cert-dir=/etc/kubernetes/ssl&#34;</span>
</span></span></code></pre></div><p>å‡†å¤‡ bootstrap.kubeconfig æ–‡ä»¶</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim /etc/kubernetes/bootstrap.kubeconfig
</span></span></code></pre></div><p>æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>clusters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>cluster</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>certificate-authority</span><span class=p>:</span><span class=w> </span><span class=l>/etc/kubernetes/ssl/ca.pem</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=l>https://192.168.115.131:6443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>context</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=l>kubelet-bootstrap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>current-context</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>preferences</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>users</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubelet-bootstrap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=l>d5c5d767b64db39db132b433e9c45fbc</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>æ³¨æ„ï¼štoken çš„å€¼éœ€è¦æ›¿æ¢ä¸º master ç”Ÿæˆçš„ token.csv ä¸­æ‰€ç”¨çš„ tokenã€‚</p></blockquote><p>å‡†å¤‡ kubelet-config.yml æ–‡ä»¶</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim kubelet-config.yml
</span></span></code></pre></div><p>æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kind: KubeletConfiguration
</span></span><span class=line><span class=cl>apiVersion: kubelet.config.k8s.io/v1beta1
</span></span><span class=line><span class=cl>address: 0.0.0.0
</span></span><span class=line><span class=cl>port: <span class=m>10250</span>
</span></span><span class=line><span class=cl>readOnlyPort: <span class=m>10255</span>
</span></span><span class=line><span class=cl>cgroupDriver: cgroupfs
</span></span><span class=line><span class=cl>clusterDNS:
</span></span><span class=line><span class=cl>- 10.0.0.2
</span></span><span class=line><span class=cl>clusterDomain: cluster.local 
</span></span><span class=line><span class=cl>failSwapOn: <span class=nb>false</span>
</span></span><span class=line><span class=cl>authentication:
</span></span><span class=line><span class=cl>  anonymous:
</span></span><span class=line><span class=cl>    enabled: <span class=nb>false</span>
</span></span><span class=line><span class=cl>  webhook:
</span></span><span class=line><span class=cl>    cacheTTL: 2m0s
</span></span><span class=line><span class=cl>    enabled: <span class=nb>true</span>
</span></span><span class=line><span class=cl>  x509:
</span></span><span class=line><span class=cl>    clientCAFile: /etc/kubernetes/ssl/ca.pem 
</span></span><span class=line><span class=cl>authorization:
</span></span><span class=line><span class=cl>  mode: Webhook
</span></span><span class=line><span class=cl>  webhook:
</span></span><span class=line><span class=cl>    cacheAuthorizedTTL: 5m0s
</span></span><span class=line><span class=cl>    cacheUnauthorizedTTL: 30s
</span></span><span class=line><span class=cl>evictionHard:
</span></span><span class=line><span class=cl>  imagefs.available: 15%
</span></span><span class=line><span class=cl>  memory.available: 100Mi
</span></span><span class=line><span class=cl>  nodefs.available: 10%
</span></span><span class=line><span class=cl>  nodefs.inodesFree: 5%
</span></span><span class=line><span class=cl>maxOpenFiles: <span class=m>1000000</span>
</span></span><span class=line><span class=cl>maxPods: <span class=m>110</span>
</span></span></code></pre></div><p>å‡†å¤‡ kubelet.kubeconfig æ–‡ä»¶</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim kubelet.kubeconfig
</span></span></code></pre></div><p>æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>kubelet.kubeconfig</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>clusters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>cluster</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>certificate-authority</span><span class=p>:</span><span class=w> </span><span class=l>/etc/kubernetes/ssl/ca.pem</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=l>https://192.168.115.131:6443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>context</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=l>default-auth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default-context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>current-context</span><span class=p>:</span><span class=w> </span><span class=l>default-context</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>preferences</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>users</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default-auth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>client-certificate</span><span class=p>:</span><span class=w> </span><span class=l>/etc/kubernetes/ssl/kubelet-client-current.pem</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>client-key</span><span class=p>:</span><span class=w> </span><span class=l>/etc/kubernetes/ssl/kubelet-client-current.pem</span><span class=w>
</span></span></span></code></pre></div><p>å‡†å¤‡kubeletæœåŠ¡é…ç½®æ–‡ä»¶</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim /usr/lib/systemd/system/kubelet.service
</span></span></code></pre></div><p>æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Kubelet</span>
</span></span><span class=line><span class=cl><span class=na>Documentation</span><span class=o>=</span><span class=s>https://github.com/GoogleCloudPlatform/kubernetes</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>docker.service</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>docker.service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>/etc/kubernetes/kubelet</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/etc/kubernetes/bin/kubelet $KUBELET_ARGS</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></span></code></pre></div><p>å¯åŠ¨ kubeletï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl daemon-reload
</span></span><span class=line><span class=cl>systemctl start kubelet
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> kubelet
</span></span><span class=line><span class=cl>systemctl status kubelet
</span></span></code></pre></div><p>ç»™ Node é¢å‘è¯ä¹¦ï¼Œåœ¨ Master ä¸Šæ‰§è¡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get csr
</span></span><span class=line><span class=cl><span class=c1># è¾“å‡ºå¦‚ä¸‹</span>
</span></span><span class=line><span class=cl>NAME                                                   AGE   SIGNERNAME                                    REQUESTOR           CONDITION
</span></span><span class=line><span class=cl>node-csr-a-BmW9xMglOXlUdwBjD2QQphXLdu4iwtamEIIbhJKcY   10m   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending
</span></span><span class=line><span class=cl>node-csr-zDDrVyKH7ug8fTUcDjdvDgh-f9rVCyoHuLMGaWbykAQ   10m   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending
</span></span></code></pre></div><p>å¾—åˆ°è¯ä¹¦çš„ NAMEï¼Œç»™å…¶ Approveï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl certificate approve node-csr-a-BmW9xMglOXlUdwBjD2QQphXLdu4iwtamEIIbhJKcY
</span></span><span class=line><span class=cl>kubectl certificate approve node-csr-zDDrVyKH7ug8fTUcDjdvDgh-f9rVCyoHuLMGaWbykAQ 
</span></span></code></pre></div><p>å†æ¬¡æŸ¥çœ‹è¯ä¹¦ï¼Œè¯ä¹¦çš„ CONDITION å°±ä¼šæ›´æ–°äº†</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get csr
</span></span><span class=line><span class=cl><span class=c1># è¾“å‡ºå¦‚ä¸‹</span>
</span></span><span class=line><span class=cl>NAME                                                   AGE     SIGNERNAME                                    REQUESTOR           CONDITION
</span></span><span class=line><span class=cl>node-csr-a-BmW9xMglOXlUdwBjD2QQphXLdu4iwtamEIIbhJKcY   10m   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Approved,Issued
</span></span><span class=line><span class=cl>node-csr-zDDrVyKH7ug8fTUcDjdvDgh-f9rVCyoHuLMGaWbykAQ   10m   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Approved,Issued
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ä½¿ç”¨æŸ¥çœ‹ Node çš„å‘½ä»¤ï¼Œåº”è¯¥å¯ä»¥è·å–åˆ° Node ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get node
</span></span><span class=line><span class=cl><span class=c1># è¾“å‡ºå¦‚ä¸‹</span>
</span></span><span class=line><span class=cl>NAME         STATUS     ROLES    AGE     VERSION
</span></span><span class=line><span class=cl>k8s-node01   NotReady   &lt;none&gt;   50s   v1.18.3
</span></span><span class=line><span class=cl>k8s-node02   NotReady   &lt;none&gt;   56s   v1.18.3
</span></span></code></pre></div><h2 id=å®‰è£…-kube-proxy>å®‰è£… kube-proxy
<a class=anchor href=#%e5%ae%89%e8%a3%85-kube-proxy>#</a></h2><p>å‡†å¤‡ kube-proxy é…ç½®æ–‡ä»¶</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim kube-proxy
</span></span></code></pre></div><p>æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>KUBE<span class=nb>_</span>PROXY<span class=nb>_</span>ARGS=&#34;--logtostderr=false <span class=k>\</span>
</span></span><span class=line><span class=cl>--v=2 <span class=k>\</span>
</span></span><span class=line><span class=cl>--log-dir=/var/log/kubernetes <span class=k>\</span>
</span></span><span class=line><span class=cl>--config=/etc/kubernetes/kube-proxy-config.yml&#34;
</span></span></code></pre></div><p>å‡†å¤‡ kube-proxy-config.yml æ–‡ä»¶</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim /etc/kubernetes/kube-proxy-config.yml
</span></span></code></pre></div><p>æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œåœ¨ k8s-node01 å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kind: KubeProxyConfiguration
</span></span><span class=line><span class=cl>apiVersion: kubeproxy.config.k8s.io/v1alpha1
</span></span><span class=line><span class=cl>address: 0.0.0.0
</span></span><span class=line><span class=cl>metricsBindAddress: 0.0.0.0:10249
</span></span><span class=line><span class=cl>iclientConnection:
</span></span><span class=line><span class=cl>  kubeconfig: /etc/kubernetes/kube-proxy.kubeconfig
</span></span><span class=line><span class=cl>hostnameOverride: k8s-node01
</span></span><span class=line><span class=cl>clusterCIDR: 10.0.0.0/24
</span></span><span class=line><span class=cl>mode: ipvs
</span></span><span class=line><span class=cl>ipvs:
</span></span><span class=line><span class=cl>  scheduler: <span class=s2>&#34;rr&#34;</span>
</span></span><span class=line><span class=cl>iptables:
</span></span><span class=line><span class=cl>  masqueradeAll: <span class=nb>true</span>
</span></span></code></pre></div><p>åœ¨ k8s-node02 å†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>KubeProxyConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>kubeproxy.config.k8s.io/v1alpha1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>address</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metricsBindAddress</span><span class=p>:</span><span class=w> </span><span class=m>0.0.0.0</span><span class=p>:</span><span class=m>10249</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>clientConnection</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kubeconfig</span><span class=p>:</span><span class=w> </span><span class=l>/etc/kubernetes/kube-proxy.kubeconfig</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>hostnameOverride</span><span class=p>:</span><span class=w> </span><span class=l>k8s-node02</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>clusterCIDR</span><span class=p>:</span><span class=w> </span><span class=m>10.0.0.0</span><span class=l>/24</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>mode</span><span class=p>:</span><span class=w> </span><span class=l>ipvs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ipvs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scheduler</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;rr&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>iptables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>masqueradeAll</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><p>å‡†å¤‡ kube-proxy.kubeconfig æ–‡ä»¶</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim /etc/kubernetes/kube-proxy.kubeconfig
</span></span></code></pre></div><p>æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>clusters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>cluster</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>certificate-authority</span><span class=p>:</span><span class=w> </span><span class=l>/etc/kubernetes/ssl/ca.pem</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=l>https://192.168.115.131:6443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>context</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=l>kube-proxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>current-context</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>preferences</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>users</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kube-proxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>client-certificate</span><span class=p>:</span><span class=w> </span><span class=l>/etc/kubernetes/ssl/kube-proxy.pem</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>client-key</span><span class=p>:</span><span class=w> </span><span class=l>/etc/kubernetes/ssl/kube-proxy-key.pem</span><span class=w>
</span></span></span></code></pre></div><p>å‡†å¤‡ kube-proxy æœåŠ¡é…ç½®æ–‡ä»¶</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim /usr/lib/systemd/system/kube-proxy.service
</span></span></code></pre></div><p>æ‰§è¡Œä¸Šè¡Œå‘½ä»¤ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Kube-Proxy</span>
</span></span><span class=line><span class=cl><span class=na>Documentation</span><span class=o>=</span><span class=s>https://github.com/GoogleCloudPlatform/kubernetes</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class=line><span class=cl><span class=na>Requires</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>EnvironmentFile</span><span class=o>=</span><span class=s>/etc/kubernetes/kube-proxy</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/etc/kubernetes/bin/kube-proxy $KUBE_PROXY_ARGS</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target</span>
</span></span></code></pre></div><p>å¯åŠ¨ kubeletï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl daemon-reload
</span></span><span class=line><span class=cl>systemctl start kube-proxy
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> kube-proxy
</span></span><span class=line><span class=cl>systemctl status kube-proxy
</span></span></code></pre></div><h2 id=éƒ¨ç½²-cni-ç½‘ç»œæ’ä»¶>éƒ¨ç½² cni ç½‘ç»œæ’ä»¶
<a class=anchor href=#%e9%83%a8%e7%bd%b2-cni-%e7%bd%91%e7%bb%9c%e6%8f%92%e4%bb%b6>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /root/kubernetes/resources
</span></span><span class=line><span class=cl>mkdir -p /opt/cni/bin /etc/cni/net.d
</span></span><span class=line><span class=cl>tar -zxvf cni-plugins-linux-amd64-v0.8.6.tgz -C /opt/cni/bin
</span></span></code></pre></div><h2 id=éƒ¨ç½²-flannel-é›†ç¾¤ç½‘ç»œ>éƒ¨ç½² Flannel é›†ç¾¤ç½‘ç»œ
<a class=anchor href=#%e9%83%a8%e7%bd%b2-flannel-%e9%9b%86%e7%be%a4%e7%bd%91%e7%bb%9c>#</a></h2><p>éœ€è¦åœ¨ Master æœºå™¨ä¸Šæ‰§è¡Œ</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /root/kubernetes/resources
</span></span><span class=line><span class=cl>kubectl apply -f kube-flannel.yml
</span></span></code></pre></div><p>åˆ›å»ºè§’è‰²ç»‘å®š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create clusterrolebinding kube-apiserver:kubelet-apis --clusterrole<span class=o>=</span>system:kubelet-api-admin --user kubernetes
</span></span></code></pre></div><h2 id=k8s-é›†ç¾¤æµ‹è¯•>K8s é›†ç¾¤æµ‹è¯•
<a class=anchor href=#k8s-%e9%9b%86%e7%be%a4%e6%b5%8b%e8%af%95>#</a></h2><p>éƒ¨ç½²ä¸€ä¸ª nginx çš„ deploymentï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create deployment nginx --image<span class=o>=</span>nginx
</span></span><span class=line><span class=cl><span class=c1># åœ¨ç­‰å¾…å‡ ç§’åï¼Œè·å– deployment</span>
</span></span><span class=line><span class=cl>kubectl get deployment
</span></span><span class=line><span class=cl>ifconfig cni0
</span></span><span class=line><span class=cl>kubectl expose deployment nginx --port<span class=o>=</span><span class=m>80</span> --type<span class=o>=</span>NodePort
</span></span><span class=line><span class=cl>kubectl get svc
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ° nginx å·²ç»å¯åŠ¨æˆåŠŸã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>nginx   1/1     <span class=m>1</span>            <span class=m>1</span>           7m7s
</span></span></code></pre></div><blockquote><p>æ³¨æ„ï¼šå¦‚æœå¯åŠ¨å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç”±äºç½‘ç»œåŸå› æ‹‰å–é•œåƒå¤±è´¥å¯¼è‡´ã€‚å¯ä»¥é€šè¿‡ <code>kubectl describe pod &lt;pod-name></code> æŸ¥çœ‹ã€‚</p></blockquote><p>ä½¿ç”¨ service æš´éœ² K8s é›†ç¾¤å†…éƒ¨ Pod æœåŠ¡ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl expose deployment nginx --port<span class=o>=</span><span class=m>80</span> --type<span class=o>=</span>NodePort
</span></span><span class=line><span class=cl><span class=c1># è·å– service</span>
</span></span><span class=line><span class=cl>kubectl get svc
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œservice å°† nginx çš„æœåŠ¡è½¬å‘åˆ°äº† 31839 ç«¯å£</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>        AGE
</span></span><span class=line><span class=cl>kubernetes   ClusterIP   10.0.0.1     &lt;none&gt;        443/TCP        10h
</span></span><span class=line><span class=cl>nginx        NodePort    10.0.0.101   &lt;none&gt;        80:31839/TCP   10s
</span></span></code></pre></div><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬åœ¨ Node æœºå™¨ä¸Šä½¿ç”¨è¯¥ç«¯å£è®¿é—® nginxï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸè®¿é—®ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>[root@k8s-node01]# curl 192.168.115.132:31839
</span></span><span class=line><span class=cl>&lt;!DOCTYPE html&gt;
</span></span><span class=line><span class=cl>&lt;html&gt;
</span></span><span class=line><span class=cl>&lt;head&gt;
</span></span><span class=line><span class=cl>&lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span></span><span class=line><span class=cl>&lt;style&gt;
</span></span><span class=line><span class=cl>    body <span class=nb>{</span>
</span></span><span class=line><span class=cl>        width: 35em;
</span></span><span class=line><span class=cl>        margin: 0 auto;
</span></span><span class=line><span class=cl>        font-family: Tahoma, Verdana, Arial, sans-serif;
</span></span><span class=line><span class=cl>    <span class=nb>}</span>
</span></span><span class=line><span class=cl>&lt;/style&gt;
</span></span><span class=line><span class=cl>&lt;/head&gt;
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
</span></span><span class=line><span class=cl>&lt;p&gt;If you see this page, the nginx web server is successfully installed and
</span></span><span class=line><span class=cl>working. Further configuration is required.&lt;/p&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;p&gt;For online documentation and support please refer to
</span></span><span class=line><span class=cl>&lt;a href=&#34;http://nginx.org/&#34;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
</span></span><span class=line><span class=cl>Commercial support is available at
</span></span><span class=line><span class=cl>&lt;a href=&#34;http://nginx.com/&#34;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
</span></span><span class=line><span class=cl>&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span></code></pre></div><p>å¥½äº†ï¼Œè‡³æ­¤ç¬¬å››æ®µè½<strong>éƒ¨ç½² Node</strong>ä¹Ÿé¡ºåˆ©ç»“æŸã€‚</p><h2 id=ç»“æŸè¯­>ç»“æŸè¯­
<a class=anchor href=#%e7%bb%93%e6%9d%9f%e8%af%ad>#</a></h2><p>åœ¨ä½¿ç”¨äºŒè¿›åˆ¶æ­å»º K8s é›†ç¾¤çš„è¿‡ç¨‹ä¸­ï¼Œæ­å»ºçš„è¿‡ç¨‹å‚è€ƒäº†å¾ˆå¤šå›­å‹çš„åšå®¢ã€‚ç”±äºæˆ‘æ˜¯ä½¿ç”¨æœ€æ–°çš„ K8sã€etcd ç‰ˆæœ¬æ­å»ºçš„ï¼Œé‡åˆ°äº†å¾ˆå¤šçš„é—®é¢˜ï¼Œä½†æ²¡æœ‰å…³ç³»ï¼Œå¥½äº‹å¤šç£¨ã€‚</p><p>åœ¨é‡åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œå‡ ä¹éƒ½æ˜¯é€šè¿‡æŸ¥çœ‹ K8s ä¸­ç»„ä»¶çš„è¿è¡ŒçŠ¶æ€å’Œæ—¥å¿—æ¥å¯»æ‰¾é—®é¢˜æ ¹æºå’Œè§£å†³æ–¹æ¡ˆçš„ã€‚</p><p>å¤§éƒ¨åˆ†é—®é¢˜éƒ½æ˜¯å‡ºåœ¨é…ç½®æ–¹é¢ï¼Œæˆ–æ˜¯æ–‡ä»¶è·¯å¾„é…ç½®é—®é¢˜ï¼Œæˆ–æ˜¯æ–°ç‰ˆæœ¬çš„é…ç½®ä¸å…¼å®¹é—®é¢˜ã€‚</p><hr><p><a href=/kubernetes/binary-build-k8s-03-deploy-master/>Â« äºŒè¿›åˆ¶æ­å»º K8s - 3 éƒ¨ç½² Master</a></p><p><a href=/kubernetes/cloud-native-understood/>Â» Kubernetes 0-1 å°è¯•ç†è§£äº‘åŸç”Ÿ</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/poneding/blog/commit/5faa4f1be5d4525c49e513962394eae7c15fb6f2 title='æœ€åä¿®æ”¹è€… poneding | 2024/06/13' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt>
<span>2024/06/13</span></a></div><div><a class="flex align-center" href=https://github.com/poneding/blog/edit/master/content/kubernetes/binary-build-k8s-04-deploy-worker.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>ç¼–è¾‘æœ¬é¡µ</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=poneding/blog data-repo-id=R_kgDOMITIHg data-category=General data-category-id=DIC_kwDOMITIHs4CgB4x data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#å†™åœ¨å‰é¢>å†™åœ¨å‰é¢</a></li><li><a href=#å®‰è£…-docker>å®‰è£… docker</a></li><li><a href=#å®‰è£…-kubelet>å®‰è£… kubelet</a></li><li><a href=#å®‰è£…-kube-proxy>å®‰è£… kube-proxy</a></li><li><a href=#éƒ¨ç½²-cni-ç½‘ç»œæ’ä»¶>éƒ¨ç½² cni ç½‘ç»œæ’ä»¶</a></li><li><a href=#éƒ¨ç½²-flannel-é›†ç¾¤ç½‘ç»œ>éƒ¨ç½² Flannel é›†ç¾¤ç½‘ç»œ</a></li><li><a href=#k8s-é›†ç¾¤æµ‹è¯•>K8s é›†ç¾¤æµ‹è¯•</a></li><li><a href=#ç»“æŸè¯­>ç»“æŸè¯­</a></li></ul></nav></div></aside></main></body></html>