<!doctype html><html lang=cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="🏠 首页 / Kubernetes / Kubernetes 定制开发 01：K8s API 概念
Kubernetes 定制开发 01：K8s API 概念 # 在 K8s 集群中，API 是一切的基础，K8s 的所有资源对象都是通过 API 来管理的，所以我们在定制开发的时候，首先要了解 K8s 的 API 概念。
基本概念 # Group（G）：
API 组，例如：apps、networking.k8s.io 等
Version（V）：
API 版本，例如：v1alpha1、v1、v2 等
Resource（R）：
API 资源，例如：pods，configmaps 等
Kind（K）：
API 类型，例如：Deployment，Service 等 通过 kubectl api-versions 获取集群中所有 API 的版本列表：
$ kubectl api-versions acme.cert-manager.io/v1 admissionregistration.k8s.io/v1 apiextensions.k8s.io/v1 apiregistration.k8s.io/v1 apps/v1 authentication.k8s.io/v1 通过 kubectl api-resources 命令获取集群所有 API 的资源列表，并且可以看到资源的简写名称，版本以及类型：
$ kubectl api-resources NAME SHORTNAMES APIVERSION NAMESPACED KIND bindings v1 true Binding componentstatuses cs v1 false ComponentStatus configmaps cm v1 true ConfigMap endpoints ep v1 true Endpoints events ev v1 true Event limitranges limits v1 true LimitRange namespaces ns v1 false Namespace nodes no v1 false Node API 资源端点 # GVR 端点："><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://blog.poneding.com/kubernetes/k8s-dev-01-api-concept/"><meta property="og:site_name" content="秋河落叶"><meta property="og:title" content="秋河落叶"><meta property="og:description" content="🏠 首页 / Kubernetes / Kubernetes 定制开发 01：K8s API 概念
Kubernetes 定制开发 01：K8s API 概念 # 在 K8s 集群中，API 是一切的基础，K8s 的所有资源对象都是通过 API 来管理的，所以我们在定制开发的时候，首先要了解 K8s 的 API 概念。
基本概念 # Group（G）：
API 组，例如：apps、networking.k8s.io 等
Version（V）：
API 版本，例如：v1alpha1、v1、v2 等
Resource（R）：
API 资源，例如：pods，configmaps 等
Kind（K）：
API 类型，例如：Deployment，Service 等 通过 kubectl api-versions 获取集群中所有 API 的版本列表：
$ kubectl api-versions acme.cert-manager.io/v1 admissionregistration.k8s.io/v1 apiextensions.k8s.io/v1 apiregistration.k8s.io/v1 apps/v1 authentication.k8s.io/v1 通过 kubectl api-resources 命令获取集群所有 API 的资源列表，并且可以看到资源的简写名称，版本以及类型：
$ kubectl api-resources NAME SHORTNAMES APIVERSION NAMESPACED KIND bindings v1 true Binding componentstatuses cs v1 false ComponentStatus configmaps cm v1 true ConfigMap endpoints ep v1 true Endpoints events ev v1 true Event limitranges limits v1 true LimitRange namespaces ns v1 false Namespace nodes no v1 false Node API 资源端点 # GVR 端点："><meta property="og:locale" content="cn"><meta property="og:type" content="article"><meta property="article:section" content="kubernetes"><meta property="article:modified_time" content="2024-06-13T15:37:18+08:00"><title>K8s Dev 01 API Concept | 秋河落叶</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/logo.png><link rel=canonical href=https://blog.poneding.com/kubernetes/k8s-dev-01-api-concept/><link rel=stylesheet href=/book.min.4964903a822a7acb10dac6d1ab524833c97fb5f99b141976bcb8a47d539be9c0.css integrity="sha256-SWSQOoIqessQ2sbRq1JIM8l/tfmbFBl2vLikfVOb6cA=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/cn.search.min.8d45e130fd4c0db67414daf87640a1178f4db2612dc2ec10408eb474a34b4c25.js integrity="sha256-jUXhMP1MDbZ0FNr4dkChF49NsmEtwuwQQI60dKNLTCU=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><link rel=stylesheet href=/css/syntax.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>秋河落叶</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><p>🦉 集中起来的意志可以击穿顽石。</p><hr><ul><li><p><a href=/><strong>🏠 首页</strong></a></p></li><li><p><strong>📌 置顶文章</strong></p><ul><li><a href=/git/common-usage/>Git 常用</a></li><li><a href=/kubernetes/kubeadm-install-k8s-docker/>安装 Kubernetes (Docker)</a></li></ul></li><li><p><strong>📌 置顶分类</strong></p><ul><li><a href=/go/>Golang 编程</a></li><li><a href=/kubernetes/>Kubernetes</a></li><li><a href=/rust/>Rust 编程</a></li><li><a href=/git/>Git</a></li></ul></li></ul><hr><ul><li><strong>🗃️ 开源项目</strong><ul><li><a href=https://github.com/ketches/registry-proxy>registry-proxy</a></li><li><a href=https://github.com/poneding/mdi>mdi</a></li></ul></li></ul><hr><ul><li><a href=https://github.com/poneding target=_blank rel=noopener>🐙 GitHub</a></li><li><a href=mailto:poneding@gmail.com target=_blank rel=noopener>📬 邮箱</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>K8s Dev 01 API Concept</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#基本概念>基本概念</a></li><li><a href=#api-资源端点>API 资源端点</a></li><li><a href=#apiservice>APIService</a></li><li><a href=#创建一个-crd>创建一个 CRD</a><ul><li><a href=#openapi>OpenAPI</a></li></ul></li><li><a href=#参考>参考</a></li></ul></nav></aside></header><article class="markdown book-article"><p><a href=/>🏠 首页</a> /
<a href=/kubernetes/>Kubernetes</a> / Kubernetes 定制开发 01：K8s API 概念</p><h1 id=kubernetes-定制开发-01k8s-api-概念>Kubernetes 定制开发 01：K8s API 概念
<a class=anchor href=#kubernetes-%e5%ae%9a%e5%88%b6%e5%bc%80%e5%8f%91-01k8s-api-%e6%a6%82%e5%bf%b5>#</a></h1><p>在 K8s 集群中，API 是一切的基础，K8s 的所有资源对象都是通过 API 来管理的，所以我们在定制开发的时候，首先要了解 K8s 的 API 概念。</p><h2 id=基本概念>基本概念
<a class=anchor href=#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5>#</a></h2><p><strong>Group（G）</strong>：</p><p>API 组，例如：<code>apps</code>、<code>networking.k8s.io</code> 等</p><p><strong>Version（V）</strong>：</p><p>API 版本，例如：<code>v1alpha1</code>、<code>v1</code>、<code>v2</code> 等</p><p><strong>Resource（R）</strong>：</p><p>API 资源，例如：<code>pods</code>，<code>configmaps</code> 等</p><p><strong>Kind（K）</strong>：</p><p>API 类型，例如：Deployment，Service 等
通过 <code>kubectl api-versions</code> 获取集群中所有 API 的版本列表：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl api-versions
</span></span><span class=line><span class=cl>acme.cert-manager.io/v1
</span></span><span class=line><span class=cl>admissionregistration.k8s.io/v1
</span></span><span class=line><span class=cl>apiextensions.k8s.io/v1
</span></span><span class=line><span class=cl>apiregistration.k8s.io/v1
</span></span><span class=line><span class=cl>apps/v1
</span></span><span class=line><span class=cl>authentication.k8s.io/v1
</span></span></code></pre></div><p>通过 <code>kubectl api-resources</code> 命令获取集群所有 API 的资源列表，并且可以看到资源的简写名称，版本以及类型：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl api-resources
</span></span><span class=line><span class=cl>NAME                              SHORTNAMES   APIVERSION                             NAMESPACED   KIND
</span></span><span class=line><span class=cl>bindings                                       v1                                     <span class=nb>true</span>         Binding
</span></span><span class=line><span class=cl>componentstatuses                 cs           v1                                     <span class=nb>false</span>        ComponentStatus
</span></span><span class=line><span class=cl>configmaps                        cm           v1                                     <span class=nb>true</span>         ConfigMap
</span></span><span class=line><span class=cl>endpoints                         ep           v1                                     <span class=nb>true</span>         Endpoints
</span></span><span class=line><span class=cl>events                            ev           v1                                     <span class=nb>true</span>         Event
</span></span><span class=line><span class=cl>limitranges                       limits       v1                                     <span class=nb>true</span>         LimitRange
</span></span><span class=line><span class=cl>namespaces                        ns           v1                                     <span class=nb>false</span>        Namespace
</span></span><span class=line><span class=cl>nodes                             no           v1                                     <span class=nb>false</span>        Node
</span></span></code></pre></div><h2 id=api-资源端点>API 资源端点
<a class=anchor href=#api-%e8%b5%84%e6%ba%90%e7%ab%af%e7%82%b9>#</a></h2><p>GVR 端点：</p><ul><li><code>/api</code>，只会获取到 v1 的 APIVersion（组名为空）</li><li><code>/apis</code>，获取到所有非核心 API 的 APIGroupList</li><li><code>/api/v1</code>，获取到 APIResourceList</li><li><code>/apis/{g}/</code>，获取到 APIGroup</li><li><code>/apis/{g}/v1</code>，获取到 APIResourceList</li></ul><p>命名空间资源端点：</p><ul><li>核心 api：<code>/api/{v}/namespaces/{ns}/{r}</code>，例如：/api/v1/namespaces/default/configmaps</li><li>其他 api：<code>/apis/{g}/{v}/namespaces/{ns}/{r}</code>，例如：apis/apps/v1/namespaces/default/deployments</li></ul><p>集群资源端点：</p><ul><li>核心 api：<code>/api/{v}/{r}</code>，例如：/api/v1/nodes</li><li>其他资源：<code>/apis/{g}/{v}/{r}</code>，例如：/apis/rbac.authorization.k8s.io/v1/clusterroles</li></ul><p>在使用 <code>kubectl get</code> 命令获取集群资源实例时，可以通过添加 <code>-v 6</code> 查看执行命令的请求端点：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ k get nodes -v <span class=m>6</span>
</span></span><span class=line><span class=cl>I0915 11:32:43.715795   <span class=m>18197</span> loader.go:373<span class=o>]</span> Config loaded from file:  /Users/dp/.kube/config
</span></span><span class=line><span class=cl>I0915 11:32:43.855325   <span class=m>18197</span> round_trippers.go:553<span class=o>]</span> GET https://127.0.01:6443/api/v1/nodes?limit<span class=o>=</span><span class=m>500</span> <span class=m>200</span> OK in <span class=m>135</span> milliseconds
</span></span><span class=line><span class=cl>NAME    STATUS   ROLES           AGE    VERSION
</span></span><span class=line><span class=cl><span class=nb>local</span>   Ready    control-plane   115d   v1.27.2
</span></span></code></pre></div><h2 id=apiservice>APIService
<a class=anchor href=#apiservice>#</a></h2><p>每个 API 版本都对应一个 APIService：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ k api-versions <span class=p>|</span> wc -l
</span></span><span class=line><span class=cl>  <span class=m>30</span>
</span></span><span class=line><span class=cl>$ k get apiservices.apiregistration.k8s.io<span class=p>|</span> wc -l
</span></span><span class=line><span class=cl>  <span class=m>30</span>
</span></span></code></pre></div><h2 id=创建一个-crd>创建一个 CRD
<a class=anchor href=#%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa-crd>#</a></h2><p><em>foo-crd.yaml</em>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apiextensions.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>CustomResourceDefinition</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># 固定格式 {kind_plural}.{group}，其中 foos 对应 spec.names.plural，play.ketches.io 对应 spec.group</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>foos.play.ketches.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>play.ketches.io</span><span class=w> </span><span class=c># 资源组，用在 URL 标识资源所属 Group，如 /apis/play.ketches.io/v1/foos 之 foos.play.ketches.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>names</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Foo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>listKind</span><span class=p>:</span><span class=w> </span><span class=l>FooList</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>plural</span><span class=p>:</span><span class=w> </span><span class=l>foos </span><span class=w> </span><span class=c># 资源名复数，用在 URL 标识资源类型，如 /apis/play.ketches.io/v1/foos 之 foos</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>singular</span><span class=p>:</span><span class=w> </span><span class=l>foo</span><span class=w> </span><span class=c># 资源名单数，可用于 kubectl 匹配资源</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>shortNames</span><span class=p>:</span><span class=w>   </span><span class=c># 资源简称，可用于 kubectl 匹配资源</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>fo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scope</span><span class=p>:</span><span class=w> </span><span class=l>Namespaced</span><span class=w> </span><span class=c># Namespaced/Cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>versions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>served</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=c># 是否启用该版本，可使用该标识启动/禁用该版本 API</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> </span><span class=c># 唯一落存储版本，如果 CRD 含有多个版本，只能有一个版本被标识为 true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>schema</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>openAPIV3Schema</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>object</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>properties</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>object</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>required</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;msg&#34;</span><span class=p>]</span><span class=w> </span><span class=c># 必须赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>properties</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>msg</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>maxLength</span><span class=p>:</span><span class=w> </span><span class=m>6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>additionalPrinterColumns</span><span class=p>:</span><span class=w> </span><span class=c># 声明 kubectl get 输出列，默认在 name 列之外额外输出 age 列，改为额外输出 age 列，message 列</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>age</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>jsonPath</span><span class=p>:</span><span class=w> </span><span class=l>.metadata.creationTimestamp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>message</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>jsonPath</span><span class=p>:</span><span class=w> </span><span class=l>.spec.msg</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span></span></span></code></pre></div><p>获取 CRD 对应的 APIService：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>~ k get apiservices.apiregistration.k8s.io v1.play.ketches.io
</span></span><span class=line><span class=cl>NAME                 SERVICE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>v1.play.ketches.io   Local     True        3h26m
</span></span></code></pre></div><p>一般这时候 SERVICE 为 Local，表示 对该资源的 APIService 请求会在本地处理，也就是 kube-apiserver 处理，我们可以将其改为一个在集群中运行的 Service 名，例如：default/play-v1-svc。你需要修改 APIService 的声明：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apiregistration.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>APIService</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kube-aggregator.kubernetes.io/automanaged</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>v1.play.ketches.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=l>play.ketches.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>groupPriorityMinimum</span><span class=p>:</span><span class=w> </span><span class=m>1000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>versionPriority</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>play-v1-svc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>insecureSkipTLSVerify</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><p>这时候对 <code>play.ketches.io/v1</code> 组下的资源的请求处理会交给该服务。
即：<code>/apis/play.ketches.io/v1/namespaces/{ns}/foos/*</code> => <code>default/play-v1-svc</code>，其实这就是一个 自定义的 apiserver 了。
但是一个自定义的 apiserver 需要实现以下这些处理（Handler）：</p><ul><li>for API Discovery<ul><li>/apis</li><li>/apis/play.ketches.io</li><li>/apis/play.ketches.io/v1</li></ul></li><li>for OpenAPI Schema<ul><li>/openapi/v2</li><li>/openapi/v3</li></ul></li><li>for Foo CRUD<ul><li>/apis/play.ketches.io/v1/foos</li><li>/apis/play.ketches.io/v1/namespaces/{namespace}/foos</li><li>/apis/play.ketches.io/v1/namespaces/{namespace}/foos/{name}</li></ul></li></ul><h3 id=openapi>OpenAPI
<a class=anchor href=#openapi>#</a></h3><p>API 的 Schema 会
<code>kubectl explain</code> 命令输出内容来源于 OpenAPI Spec。</p><h2 id=参考>参考
<a class=anchor href=#%e5%8f%82%e8%80%83>#</a></h2><ul><li><a href=https://www.zeng.dev/post/2023-k8s-api-by-crd>K8s CustomResourceDefinitions (CRD) 原理</a></li><li><a href=https://www.zeng.dev/post/2023-k8s-apiserver-from-scratch/>实现一个极简 K8s apiserver</a></li></ul><hr><p><a href=/kubernetes/k8s-deploy-zookeeper-kafka/>« Kubernetes 0-1 K8s部署Zookeeper和Kafka</a></p><p><a href=/kubernetes/k8s-dev-02-crd/>» Kubernetes 定制开发 02：CRD</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/poneding/blog/commit/5faa4f1be5d4525c49e513962394eae7c15fb6f2 title='最后修改者 poneding | 2024/06/13' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt>
<span>2024/06/13</span></a></div><div><a class="flex align-center" href=https://github.com/poneding/blog/edit/master/content/kubernetes/k8s-dev-01-api-concept.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>编辑本页</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=poneding/blog data-repo-id=R_kgDOMITIHg data-category=General data-category-id=DIC_kwDOMITIHs4CgB4x data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#基本概念>基本概念</a></li><li><a href=#api-资源端点>API 资源端点</a></li><li><a href=#apiservice>APIService</a></li><li><a href=#创建一个-crd>创建一个 CRD</a><ul><li><a href=#openapi>OpenAPI</a></li></ul></li><li><a href=#参考>参考</a></li></ul></nav></div></aside></main></body></html>