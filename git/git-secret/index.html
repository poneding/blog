<!doctype html><html lang=cn dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="🏠 首页 / Git / 使用 git-secret 保护仓库敏感数据
使用 git-secret 保护仓库敏感数据 # 如何保护 git 仓库中的敏感数据，例如数据库连接字符串，账号密码等？
首先，最好先将仓库设置成私有仓库！然后，
第一种方式：带有敏感数据的文件加入到. gitignore，不提交到仓库中； 第二种方式：敏感数据库文件加密后再提交到仓库中，这个就是今天要说的 git-secret。 这两种方式都有优缺点：
第一种方式，较为靠谱，敏感文件在 git 仓库之外，根本上避免仓库敏感数据的泄露，但是敏感文件不受版本控制了，开发人员需要在其他频道同步敏感文件的更新，而且使用到自动部署时需要另外去拉取敏感数据，最好是有自己的敏感数据配置中心统一管理；
第二种方式，使用 git-secret 加密敏感文件，这样敏感文件被仓库 ignore 掉，转而提交加密后的文件，但是敏感文件如果更新了开发人员要记得再次加密。
git-secret 简介 # git-secret 是一个在 git 仓库中加密文件的工具，将敏感文件加密，得到加密文件，将文件保存到仓库中，这样敏感文件也是版本控制，你可以获取到该文件的所有提交记录。
使用 gpg 和所有信任用户的公钥加密文件，每个信任用户可以使用个人密钥解密文件，如果用户离开团队，将删除用户的公钥即可，他也就不能再解密文件了。
git-secret 使用 # 假设我现在有一个仓库 git-secret-demo，仓库下有一个包含敏感信息的文件 secret.json：
我现在想做的是使用 git-secret 将 secret.json 文件加密。
首先得安装 gpg 工具 # Debian & Ubuntu sudo apt install gnupg -y ​ # Macos brew install gnupg 本地创建 gpg RSA 密钥对 gpg --gen-key 在创建时需要输入自己的用户名和邮箱，并且需要输入你的加密密码。"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://blog.poneding.com/git/git-secret/"><meta property="og:site_name" content="秋河落叶"><meta property="og:title" content="秋河落叶"><meta property="og:description" content="🏠 首页 / Git / 使用 git-secret 保护仓库敏感数据
使用 git-secret 保护仓库敏感数据 # 如何保护 git 仓库中的敏感数据，例如数据库连接字符串，账号密码等？
首先，最好先将仓库设置成私有仓库！然后，
第一种方式：带有敏感数据的文件加入到. gitignore，不提交到仓库中； 第二种方式：敏感数据库文件加密后再提交到仓库中，这个就是今天要说的 git-secret。 这两种方式都有优缺点：
第一种方式，较为靠谱，敏感文件在 git 仓库之外，根本上避免仓库敏感数据的泄露，但是敏感文件不受版本控制了，开发人员需要在其他频道同步敏感文件的更新，而且使用到自动部署时需要另外去拉取敏感数据，最好是有自己的敏感数据配置中心统一管理；
第二种方式，使用 git-secret 加密敏感文件，这样敏感文件被仓库 ignore 掉，转而提交加密后的文件，但是敏感文件如果更新了开发人员要记得再次加密。
git-secret 简介 # git-secret 是一个在 git 仓库中加密文件的工具，将敏感文件加密，得到加密文件，将文件保存到仓库中，这样敏感文件也是版本控制，你可以获取到该文件的所有提交记录。
使用 gpg 和所有信任用户的公钥加密文件，每个信任用户可以使用个人密钥解密文件，如果用户离开团队，将删除用户的公钥即可，他也就不能再解密文件了。
git-secret 使用 # 假设我现在有一个仓库 git-secret-demo，仓库下有一个包含敏感信息的文件 secret.json：
我现在想做的是使用 git-secret 将 secret.json 文件加密。
首先得安装 gpg 工具 # Debian & Ubuntu sudo apt install gnupg -y ​ # Macos brew install gnupg 本地创建 gpg RSA 密钥对 gpg --gen-key 在创建时需要输入自己的用户名和邮箱，并且需要输入你的加密密码。"><meta property="og:locale" content="cn"><meta property="og:type" content="article"><meta property="article:section" content="git"><meta property="article:modified_time" content="2024-06-13T15:37:18+08:00"><title>Git Secret | 秋河落叶</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/logo.png><link rel=canonical href=https://blog.poneding.com/git/git-secret/><link rel=stylesheet href=/book.min.4964903a822a7acb10dac6d1ab524833c97fb5f99b141976bcb8a47d539be9c0.css integrity="sha256-SWSQOoIqessQ2sbRq1JIM8l/tfmbFBl2vLikfVOb6cA=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/cn.search.min.a4898d10c6cfdc36ae4d635f188afb447967af569ddd5f310cafeefcad2816f3.js integrity="sha256-pImNEMbP3DauTWNfGIr7RHlnr1ad3V8xDK/u/K0oFvM=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><link rel=stylesheet href=/css/syntax.css></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>秋河落叶</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><p>🦉 集中起来的意志可以击穿顽石。</p><hr><ul><li><p><a href=/><strong>🏠 首页</strong></a></p></li><li><p><strong>📌 置顶文章</strong></p><ul><li><a href=/git/common-usage/>Git 常用</a></li><li><a href=/kubernetes/kubeadm-install-k8s-docker/>安装 Kubernetes (Docker)</a></li></ul></li><li><p><strong>📌 置顶分类</strong></p><ul><li><a href=/go/>Golang 编程</a></li><li><a href=/kubernetes/>Kubernetes</a></li><li><a href=/rust/>Rust 编程</a></li><li><a href=/git/>Git</a></li></ul></li></ul><hr><ul><li><strong>🗃️ 开源项目</strong><ul><li><a href=https://github.com/ketches/registry-proxy>registry-proxy</a></li><li><a href=https://github.com/poneding/mdi>mdi</a></li></ul></li></ul><hr><ul><li><a href=https://github.com/poneding target=_blank rel=noopener>🐙 GitHub</a></li><li><a href=mailto:poneding@gmail.com target=_blank rel=noopener>📬 邮箱</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Git Secret</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#git-secret-简介><strong>git-secret 简介</strong></a></li><li><a href=#git-secret-使用><strong>git-secret 使用</strong></a></li><li><a href=#git-secret-常用命令><strong>git-secret 常用命令</strong></a></li></ul></nav></aside></header><article class="markdown book-article"><p><a href=/>🏠 首页</a> /
<a href=/git/>Git</a> / 使用 git-secret 保护仓库敏感数据</p><h1 id=使用-git-secret-保护仓库敏感数据>使用 git-secret 保护仓库敏感数据
<a class=anchor href=#%e4%bd%bf%e7%94%a8-git-secret-%e4%bf%9d%e6%8a%a4%e4%bb%93%e5%ba%93%e6%95%8f%e6%84%9f%e6%95%b0%e6%8d%ae>#</a></h1><p>如何保护 git 仓库中的敏感数据，例如数据库连接字符串，账号密码等？</p><p>首先，最好先将仓库设置成私有仓库！然后，</p><ul><li>第一种方式：带有敏感数据的文件加入到. gitignore，不提交到仓库中；</li><li>第二种方式：敏感数据库文件加密后再提交到仓库中，这个就是今天要说的 <strong>git-secret</strong>。</li></ul><p>这两种方式都有优缺点：</p><p>第一种方式，较为靠谱，敏感文件在 git 仓库之外，根本上避免仓库敏感数据的泄露，但是敏感文件不受版本控制了，开发人员需要在其他频道同步敏感文件的更新，而且使用到自动部署时需要另外去拉取敏感数据，最好是有自己的敏感数据配置中心统一管理；</p><p>第二种方式，使用 git-secret 加密敏感文件，这样敏感文件被仓库 ignore 掉，转而提交加密后的文件，但是敏感文件如果更新了开发人员要记得再次加密。</p><h2 id=git-secret-简介><strong>git-secret 简介</strong>
<a class=anchor href=#git-secret-%e7%ae%80%e4%bb%8b>#</a></h2><p>git-secret 是一个在 git 仓库中加密文件的工具，将敏感文件加密，得到加密文件，将文件保存到仓库中，这样敏感文件也是版本控制，你可以获取到该文件的所有提交记录。</p><p>使用 gpg 和所有信任用户的公钥加密文件，每个信任用户可以使用个人密钥解密文件，如果用户离开团队，将删除用户的公钥即可，他也就不能再解密文件了。</p><h2 id=git-secret-使用><strong>git-secret 使用</strong>
<a class=anchor href=#git-secret-%e4%bd%bf%e7%94%a8>#</a></h2><p>假设我现在有一个仓库 git-secret-demo，仓库下有一个包含敏感信息的文件 secret.json：</p><p><img src=https://fs.poneding.com/images/202305160835285.png alt=202305160835285></p><p>我现在想做的是使用 git-secret 将 secret.json 文件加密。</p><ul><li>首先得安装 gpg 工具</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Debian &amp; Ubuntu</span>
</span></span><span class=line><span class=cl>sudo apt install gnupg -y
</span></span><span class=line><span class=cl>​
</span></span><span class=line><span class=cl><span class=c1># Macos</span>
</span></span><span class=line><span class=cl>brew install gnupg
</span></span></code></pre></div><ul><li>本地创建 gpg RSA 密钥对</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gpg --gen-key
</span></span></code></pre></div><p>在创建时需要输入自己的用户名和邮箱，并且需要输入你的加密密码。</p><p><img src=https://fs.poneding.com/images/202305160835334.png alt=202305160835334></p><p>导出你的公钥文件，你可以拿到这个公钥文件交给 git 仓库管理员，让他把你加入到仓库的信任用户列表：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gpg --armor --export ding.peng@email.cn &gt; dp-public-key.gpg
</span></span></code></pre></div><p><img src=https://fs.poneding.com/images/202305160835376.png alt=202305160835376></p><p>导入公钥文件，git 仓库管理员将公钥文件导入本地环境，之后可以将本地环境中的公钥加入到 git-secret 信任用户列表：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gpg --import other-pulic-key.gpg
</span></span></code></pre></div><p>查看本地密钥对列表</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gpg --list-key
</span></span></code></pre></div><p><img src=https://fs.poneding.com/images/202305160835439.png alt=202305160835439></p><ul><li>安装 git-secret</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Debian &amp; Ubuntu</span>
</span></span><span class=line><span class=cl>sudo apt install git-secret -y
</span></span><span class=line><span class=cl>​
</span></span><span class=line><span class=cl><span class=c1># Macos</span>
</span></span><span class=line><span class=cl>brew install git-secret
</span></span></code></pre></div><ul><li>使用 <code>git secret init</code> 初始化，在仓库根目录下执行</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git secret init
</span></span></code></pre></div><p><img src=https://fs.poneding.com/images/202305160835464.png alt=202305160835464></p><p>默认会在仓库下生成 .gitsecret 目录和 .gitignore 文件。</p><ul><li>将用户加入到 git-secret 信任用户列表</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git secret tell ding.peng@email.cn
</span></span></code></pre></div><p><img src=https://fs.poneding.com/images/202305160835521.png alt=202305160835521></p><ul><li>添加加密文件到 git-secret</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git secret add -i secret.json
</span></span></code></pre></div><p><img src=https://fs.poneding.com/images/202305160835620.png alt=202305160835620></p><p>这里 <code>-i</code> 自动将要加密的文件添加到 <code>.gitignore</code></p><p>此时使用如下命令可以在目录下看到生成的 <code>secret.json.secret</code> 的加密后文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git secret hide
</span></span></code></pre></div><p><img src=https://fs.poneding.com/images/202305160835909.png alt=202305160835909></p><p>到这时，你的加密文件不会提交到仓库中，从 git 仓库新克隆下来的时候是没有加密文件的，你需要解密文件才能得到文件，例如我现在删除加密文件，然后再通过解密加密过的文件重新得到敏感文件，使用命令:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git secret reveal <span class=c1># 第一次使用该命令需要输入信任用户的密码</span>
</span></span></code></pre></div><p><img src=https://fs.poneding.com/images/202305160835973.png alt=202305160835973></p><p>从以上截图，你可以看到敏感文件 <code>secret.json</code> 失而复得的整个过程。</p><h2 id=git-secret-常用命令><strong>git-secret 常用命令</strong>
<a class=anchor href=#git-secret-%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4>#</a></h2><p>除了上面使用过的命令，你可能还会用到以下命令：</p><p><img src=https://fs.poneding.com/images/202305160835992.png alt=202305160835992></p><ul><li>**git secret usage：**列出 git secret 可用命令。</li><li>**git secret whoknows：**查看当前 git 仓库允许访问私密文件的用户邮箱列表。</li><li><strong>git secret add</strong>：添加加密文件。</li><li>**git secret remove：**移除加密文件。</li><li>**git secret list：**列出加密文件。</li><li>**git secret changes：**查看加密文件的更改记录。</li><li>**git secret clean：**清除所有加密文件。</li><li>**git secret removeperson：**移除信任用户。</li></ul><hr><p><a href=/git/common-usage/>« Git 常用</a></p><p><a href=/git/github-action-best-practice/>» Github Action 使用最佳实践</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/poneding/blog/commit/5faa4f1be5d4525c49e513962394eae7c15fb6f2 title='最后修改者 poneding | 2024/06/13' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt>
<span>2024/06/13</span></a></div><div><a class="flex align-center" href=https://github.com/poneding/blog/edit/master/content/git/git-secret.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>编辑本页</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments><script src=https://giscus.app/client.js data-repo=poneding/blog data-repo-id=R_kgDOMITIHg data-category=General data-category-id=DIC_kwDOMITIHs4CgB4x data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#git-secret-简介><strong>git-secret 简介</strong></a></li><li><a href=#git-secret-使用><strong>git-secret 使用</strong></a></li><li><a href=#git-secret-常用命令><strong>git-secret 常用命令</strong></a></li></ul></nav></div></aside></main></body></html>