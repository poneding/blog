[ğŸ  é¦–é¡µ](../_index.md) / [DevOps](_index.md) / nginx

# nginx

## nginxç®€ä»‹

é«˜æ€§èƒ½çš„åå‘ä»£ç†å·¥å…·ï¼Œè´Ÿè½½å‡è¡¡å™¨ï¼›

## nginxé…ç½®

### å…¨å±€é…ç½®

### eventé…ç½®

### httpé…ç½®

#### é…ç½®åå‘ä»£ç†

**æ­£å‘ä»£ç†**ï¼š

åœ¨å›½å†…æ˜¯

é…ç½®location:

```nginx
localtion [ = | ~ | ~* | ^~] uri {

}
```

- =ï¼šç”¨äºä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„urlå‰ï¼Œè¦æ±‚è¯·æ±‚å­—ç¬¦ä¸²ä¸uriä¸¥æ ¼åŒ¹é…ï¼›
- ~ï¼šç”¨äºè¡¨ç¤ºuriåŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”åŒºåˆ†å¤§å°å†™ï¼›
- ~*ï¼šç”¨äºè¡¨ç¤ºuriåŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”ä¸åŒºåˆ†å¤§å°å†™ï¼›
- ^~ï¼šç”¨äºä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„uriå‰ï¼Œè¦æ±‚nginxæœåŠ¡å™¨æ‰¾åˆ°è¡¨ç¤ºuiå’Œè¯·æ±‚å­—ç¬¦ä¸²åŒ¹é…åº¦æœ€é«˜çš„locationåï¼Œç«‹å³ä½¿ç”¨æ­¤locationå¤„ç†è¯·æ±‚

#### é…ç½®è´Ÿè½½å‡è¡¡

å°†è´Ÿè½½åˆ†æ‘Šåˆ°ä¸åŒçš„æœåŠ¡å•å…ƒï¼Œä¿è¯æœåŠ¡çš„å¿«é€Ÿå“åº”ï¼Œé«˜å¯ç”¨ã€‚

![image-20200216174849571](https://fs.poneding.com/images/image-20200216174849571.png)

```nginx
upstream myserver {
 server 192.168.0.1:8081;
 server 192.168.0.2:8082;
}
server {
 listen 80;
 server_name 192.168.0.1;
 
 location / {
  proxy_pass http://myserver;
  root  html;
  index  index.html index.htm;
 }
}
```

**å‡è¡¡ç­–ç•¥**ï¼š

1. **è½®è¯¢ç­–ç•¥**ï¼š

   nginxé»˜è®¤ä½¿ç”¨çš„å‡è¡¡ç­–ç•¥ï¼ŒæŒ‰è¯·æ±‚æ—¶é—´å…ˆåé¡ºåºé€ä¸€åˆ†é…åˆ°åç«¯æœåŠ¡å™¨åˆ—è¡¨ï¼Œå¦‚æœæŸåç«¯æœåŠ¡å™¨downæ‰äº†ï¼Œåˆ™è‡ªåŠ¨å‰”é™¤æœåŠ¡å™¨åˆ—è¡¨ã€‚

2. **æƒé‡ç­–ç•¥**ï¼š

   åç«¯æœåŠ¡å™¨é…ç½®weightå€¼ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œè¯¥å€¼é…ç½®è¶Šå¤§ï¼Œåˆ™å‡è¡¡åˆ°è¯¥æœåŠ¡å™¨ä¸Šçš„è¯·æ±‚è¶Šå¤šã€‚

   ```nginx
   upstream myserver {
    server 192.168.0.1:8081  weight=1;
    server 192.168.0.2:8082 weight=2;
   }
   ```

3. **IP-Hashç­–ç•¥**ï¼š

   æ ¹æ®è¯·æ±‚å®¢æˆ·ç«¯çš„IP çš„hashå€¼ç»™å…¶åˆ†é…å›ºå®šçš„æŸä¸ªæœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessioné—®é¢˜ã€‚

   ```nginx
   upstream myserver {
    ip_hash;
    server 192.168.0.1:8081;
    server 192.168.0.2:8082;
   }
   ```

4. **Fairç­–ç•¥**ï¼š

   æ ¹æ®åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´åˆ†é…ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚

   ```nginx
   upstream myserver {
    server 192.168.0.1:8081;
    server 192.168.0.2:8082;
    fair;
   }
   ```

#### é…ç½®åŠ¨é™åˆ†ç¦»

é™æ€æœåŠ¡å™¨ç”¨äºå“åº”htmlã€cssã€jsã€å›¾ç‰‡ç­‰é™æ€èµ„æºçš„è®¿é—®ï¼ŒåŠ¨æ€æœåŠ¡å™¨ç”¨äºå“åº”ä¸šåŠ¡å¤„ç†ç­‰ã€‚

```nginx
 location /www/ {
  root  /data/;
  index  index.html index.htm;
 }
 
 location /image/ {
  root  /data/;
  autoindex  on;   # åˆ—å‡ºimageç›®å½•ä¸‹çš„é™æ€æ–‡ä»¶
 }
```

![image-20200610124408207](https://fs.poneding.com/images/image-20200610124408207.png)

## Nginxå¸¸ç”¨å‘½ä»¤

### é‡å¯

é€‚ç”¨äºä¿®æ”¹äº†é…ç½®æ–‡ä»¶ä¹‹åï¼Œé‡æ–°åŠ è½½

```bash
nginx -s reload
```

### æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®

```bash
# æ£€æŸ¥é»˜è®¤é…ç½®æ–‡ä»¶ /etc/nginx/nginx.conf
nginx -t

# æ£€æŸ¥æŒ‡å®šé…ç½®æ–‡ä»¶
nginx -t -c /etc/nginx/conf.d/default.conf
```

---
[Â« Jaeger](jeager.md)
